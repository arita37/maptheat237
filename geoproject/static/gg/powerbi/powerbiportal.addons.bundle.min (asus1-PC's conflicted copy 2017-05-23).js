
window.parseTimeMarkers = window.parseTimeMarkers || {};
window.parseTimeMarkers['powerbiportal.addons.bundle.min.js'] = {
    nominalStart: Date.now(),
    start: Date.now()
};
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},powerbi;!(function(e){var t;!(function(t){function r(t){var r=t[0].toLowerCase()+t.slice(1),n=e.infonav.components[t];angular.module("powerbi.infonavbootstrap").component(r,n)}angular.module("powerbi.infonavbootstrap",["powerbi.common"]).factory("interpretHttpService",["$timeout","promiseFactory",function(e,r){return t.services.createInterpretHttpService(e,r)}]).factory("interpretProbe",["interpretHttpService","promiseFactory","$timeout","featureSwitchService",function(e,r,n,a){return t.services.createInterpretProbeService(e,r,n,a)}]),t.registerInfonavBootstrapComponent=r})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Server=0]="Server",e[e.User=1]="User"})(t=e.SpanSource||(e.SpanSource={}));var r;!(function(e){e[e.None=0]="None",e[e.LinguisticSchemaAutoGenerated=1]="LinguisticSchemaAutoGenerated",e[e.LinguisticSchemaNotAvailable=2]="LinguisticSchemaNotAvailable",e[e.LinguisticSchemaIsStillLoading=4]="LinguisticSchemaIsStillLoading",e[e.InvalidDataModel=8]="InvalidDataModel",e[e.DataRetrievalFailed=16]="DataRetrievalFailed",e[e.DataRetrievalSkipped=32]="DataRetrievalSkipped",e[e.DuplicateExecuteSemanticQuery=64]="DuplicateExecuteSemanticQuery"})(r=e.InterpretWarnings||(e.InterpretWarnings={}));var n;!(function(e){e[e.AdjectivePhrasing=0]="AdjectivePhrasing",e[e.AttributePhrasing=1]="AttributePhrasing",e[e.VerbPhrasing=2]="VerbPhrasing"})(n=e.PhrasingType||(e.PhrasingType={}));var a;!(function(e){e[e.Integer=0]="Integer",e[e.Number=1]="Number",e[e.String=2]="String"})(a=e.InputType||(e.InputType={}))})(t=e.contracts||(e.contracts={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.Data=1]="Data",e[e.QueryMetadata=2]="QueryMetadata",e[e.VisualConfiguration=4]="VisualConfiguration",e[e.SupportPodQueries=64]="SupportPodQueries",e[e.Cortana=128]="Cortana",e[e.Personality=256]="Personality",e[e.TermBindings=512]="TermBindings",e[e.Diagnostics=1024]="Diagnostics"})(t=e.InterpretRequestOptions||(e.InterpretRequestOptions={}))})(t=e.contracts||(e.contracts={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.openTileAction="/openQnA",e.openTileEventName="openQnaTile",e.pinSelectedVisual="pinSelectedVisual",e.showQnaStart="showQnaStart",e.ScopedInstanceProviderName="infonav",e.DefaultVisualMaxWidth=1024,e.DefaultVisualMaxHeight=768})(t=e.constants||(e.constants={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var a=r(t);return n(a,e)}function r(e){var t;if(_.isEmpty(e))return t;for(var r=0,n=e;r<n.length;r++){var a=n[r];if(t&&a.Language!==t){t=void 0;break}t=a.Language}return t}function n(e,t){var r="";if(e){var n=!1,i=a(t.currentLanguageLocale);e=a(e);var s=o[e];s&&(r=s.resStringSuffix,n=s.preview),n||e!==i||(r="")}return t.get("Qna_Input_Placeholder"+r)}function a(e){if(e){var t=e.split("-");return t[0].toLowerCase()}}var o={en:{resStringSuffix:"_English"},es:{resStringSuffix:"_Spanish",preview:!0}};e.getPlaceholderText=t})(t=e.QnaLanguageUtil||(e.QnaLanguageUtil={}))})(t=e.utils||(e.utils={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,n=e.common.helpers.ModelConverterHelper;!(function(e){function t(e,t){return{DbMonikers:_(e).filter((function(e){return e&&n.getIsQnaSupported(e,t)&&!_.isEmpty(e.vsName)&&!_.isEmpty(e.dbName)})).filter((function(e){return e&&!_.isEmpty(e.vsName)&&!_.isEmpty(e.dbName)})).map((function(e){return{VirtualServerName:e.vsName,DatabaseName:e.dbName}})).value()}}e.createInterpretRequestScope=t})(r=t.InterpretUtil||(t.InterpretUtil={}))})(r=t.utils||(t.utils={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,n=jsCommon.Lazy,a=e.visuals.plugins;!(function(e){function t(e){var t=i.getValue();return t[e]}function r(e){var t=s.getValue();return t[e]}function o(e,t){for(var r=[],n={},a=0,o=t.length;a<o;a++){var i=t[a];n[i.vsName+i.dbName]=i}for(var s=e.configs,c=0,u=s.length;c<u;c++){var l=s[c],p=l.Query||e.queryDefn,d=l.DataShapeBinding||e.dataShapeBinding,f=l.QueryMetadata||e.queryMetadata,i=n[e.virtualServerName+e.databaseName];null!=i&&r.push({config:{Query:p,QueryMetadata:f,DataShapeBinding:d,VisualizationType:l.VisualizationType,VisualElements:l.VisualElements},model:i,dataViewSource:e.dataViewSource})}return r}var i=new n(function(){var e={};return e[3]=a.card,e[31]=a.lineClusteredColumnComboChart,e[29]=a.multiRowCard,e[7]=a.clusteredBarChart,e[10]=a.clusteredColumnChart,e[20]=a.donutChart,e[16]=a.funnel,e[30]=a.gauge,e[22]=a.heatMap,e[9]=a.hundredPercentStackedBarChart,e[12]=a.hundredPercentStackedColumnChart,e[4]=a.lineChart,e[1]=a.map,e[19]=a.filledMap,e[2]=a.matrix,e[5]=a.pieChart,e[6]=a.scatterChart,e[8]=a.barChart,e[11]=a.columnChart,e[0]=a.table,e[17]=a.treemap,e[23]=a.waterfallChart,e[26]=a.stackedAreaChart,e[32]=a.areaChart,e}),s=new n(function(){var e={};return e[a.card.name]=3,e[a.lineClusteredColumnComboChart.name]=31,e[a.multiRowCard.name]=29,e[a.clusteredBarChart.name]=7,e[a.clusteredColumnChart.name]=10,e[a.donutChart.name]=20,e[a.funnel.name]=16,e[a.gauge.name]=30,e[a.heatMap.name]=22,e[a.hundredPercentStackedBarChart.name]=9,e[a.hundredPercentStackedColumnChart.name]=12,e[a.lineChart.name]=4,e[a.map.name]=1,e[a.filledMap.name]=19,e[a.matrix.name]=2,e[a.pieChart.name]=5,e[a.scatterChart.name]=6,e[a.barChart.name]=8,e[a.columnChart.name]=11,e[a.table.name]=0,e[a.treemap.name]=17,e[a.waterfallChart.name]=23,e[a.stackedAreaChart.name]=26,e[a.areaChart.name]=32,e});e.getPlugin=t,e.getType=r,e.interpretResultToConfig=o})(r=t.visualUtil||(t.visualUtil={}))})(r=t.utils||(t.utils={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r,n=e.visuals.plugins,a=e.explore.QueryProjectionBuilderCoreUtils.QueryProjectionBuilder,o=e.infonav.utils.visualUtil;!(function(e){function t(e,t,r){var n=o.getPlugin(e);if(null!=n){var a;switch(e){case 3:case 29:case 0:a=new i(n,t,r);break;case 2:a=new m(n,t,r);break;case 20:case 16:case 4:case 26:case 32:case 5:case 23:a=new s(n,t,r);break;case 7:case 10:case 9:case 12:case 8:case 11:a=new c(n,t,r);break;case 1:case 22:a=new p(n,t,r);break;case 19:a=new d(n,t,r);break;case 17:a=new f(n,t,r);break;case 6:a=new l(n,t,r);break;case 30:a=new u(n,t,r);break;default:return}return a}}e.createProjectionBuilder=t})(r=t.QueryProjectionBuilderUtils||(t.QueryProjectionBuilderUtils={}));var i=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 1===e.length&&e[0].name===a.ValuesRole},t.prototype.build=function(e){var t={};if(1===this.projectionsInfo.length)return a.addValuesRole(t,this.projectionsInfo[0]),t;for(var r=e.Primary.Groupings,n=r[0].Projections,o=0,i=n.length;o<i;o++)a.addValuesRole(t,this.projectionsInfo[n[o]]);return t},t})(a),s=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return this.plugin.name===n.funnel.name?4===e.length&&e[0].name===a.CategoryRole&&e[1].name===a.YRole&&e[2].name===a.GradientRole&&e[3].name===a.TooltipRole:4===e.length&&e[0].name===a.CategoryRole&&e[1].name===a.SeriesRole&&e[2].name===a.YRole&&e[3].name===a.TooltipRole},t.prototype.build=function(e){var t=e.Primary.Groupings,r={};if(this.processPrimaryGroup(t[0],r),e.Secondary){var n=e.Secondary.Groupings;1===n.length&&this.processSecondaryGroup(n[0],r)}return r},t.prototype.processPrimaryGroup=function(e,t){for(var r=e.Projections,n=0,o=r.length;n<o;n++){var i=r[n],s=this.projectionsInfo[i];0===s.metadata.kind?a.addCategoryRole(t,s):1===s.metadata.kind&&a.addYRole(t,s)}},t.prototype.processSecondaryGroup=function(e,t){for(var r=e.Projections,n=0,o=r.length;n<o;n++){var i=r[n];a.addSeriesRole(t,this.projectionsInfo[i])}},t})(a),c=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 5===e.length&&e[0].name===a.CategoryRole&&e[1].name===a.SeriesRole&&e[2].name===a.YRole&&e[3].name===a.GradientRole&&e[4].name===a.TooltipRole},t})(s),u=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 5===e.length&&e[0].name===a.YRole&&e[1].name===a.MinValueRole&&e[2].name===a.MaxValueRole&&e[3].name===a.TargetValueRole&&e[4].name===a.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var r=e.Projections,n=0,o=0,i=r;o<i.length;o++){var s=i[o],c=this.projectionsInfo[s];if(1===c.metadata.kind){switch(n){case 0:a.addYRole(t,c);break;case 1:a.addTargetValueRole(t,c);break;case 2:a.addMaxValueRole(t,c);break;case 3:a.addMinValueRole(t,c);break;case 4:a.addTooltipRole(t,c)}n++}}},t})(s),l=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 8===e.length&&e[0].name===a.CategoryRole&&e[1].name===a.SeriesRole&&e[2].name===a.XRole&&e[3].name===a.YRole&&e[4].name===a.SizeRole&&e[5].name===a.GradientRole&&e[6].name===a.PlayRole&&e[7].name===a.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var r=e.Projections,n=0,o=0,i=r.length;o<i;o++){var s=r[o],c=this.projectionsInfo[s];if(0===c.metadata.kind)a.addCategoryRole(t,c);else if(1===c.metadata.kind){switch(n){case 0:a.addXRole(t,c);break;case 1:a.addYRole(t,c);break;case 2:a.addSizeRole(t,c);break;case 3:a.addGradientRole(t,c);break;case 4:a.addTooltipRole(t,c)}n++}}},t})(s),p=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 7===e.length&&e[0].name===a.CategoryRole&&e[1].name===a.SeriesRole&&e[2].name===a.YRole&&e[3].name===a.XRole&&e[4].name===a.SizeRole&&e[5].name===a.GradientRole&&e[6].name===a.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var r=e.Projections,n=0,o=0,i=r;o<i.length;o++){var s=i[o],c=this.projectionsInfo[s];if(0===c.metadata.kind)a.addCategoryRole(t,c);else if(1===c.metadata.kind){switch(n){case 0:a.addSizeRole(t,c);break;case 1:a.addXRole(t,c);break;case 2:a.addYRole(t,c);break;case 3:a.addGradientRole(t,c);break;case 4:a.addTooltipRole(t,c)}n++}}},t})(s),d=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 6===e.length&&e[0].name===a.CategoryRole&&e[1].name===a.SeriesRole&&e[2].name===a.YRole&&e[3].name===a.XRole&&e[4].name===a.SizeRole&&e[5].name===a.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var r=e.Projections,n=0,o=0,i=r;o<i.length;o++){var s=i[o],c=this.projectionsInfo[s];if(0===c.metadata.kind)a.addCategoryRole(t,c);else if(1===c.metadata.kind){switch(n){case 0:a.addSizeRole(t,c);break;case 1:a.addXRole(t,c);break;case 2:a.addYRole(t,c);break;case 3:a.addTooltipRole(t,c)}n++}}},t})(s),f=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 5===e.length&&e[0].name===a.GroupRole&&e[1].name===a.DetailsRole&&e[2].name===a.ValuesRole&&e[3].name===a.GradientRole&&e[4].name===a.TooltipRole},t.prototype.processPrimaryGroup=function(e,t){for(var r=e.Projections,n=0,o=r.length;n<o;n++){var i=r[n],s=this.projectionsInfo[i];0===s.metadata.kind?a.addGroupRole(t,s):1===s.metadata.kind&&a.addValuesRole(t,s)}},t.prototype.processSecondaryGroup=function(e,t){for(var r=e.Projections,n=0,o=r.length;n<o;n++){var i=r[n];a.addDetailsRole(t,this.projectionsInfo[i])}},t})(s),m=(function(e){function t(t,r,n){return e.call(this,t,r,n)||this}return __extends(t,e),t.prototype.validatePlugin=function(){var e=this.plugin.capabilities.dataRoles;return 3===e.length&&e[0].name===a.RowsRole&&e[1].name===a.ColumnsRole&&e[2].name===a.ValuesRole},t.prototype.build=function(e){var t=e.Primary.Groupings,r={};if(this.processPrimaryGroups(t,r),e.Secondary){var n=e.Secondary.Groupings;this.processSecondaryGroups(n,r)}return r},t.prototype.processPrimaryGroups=function(e,t){if(e)for(var r=0,n=e.length;r<n;r++)this.processPrimaryGroup(e[r],t)},t.prototype.processSecondaryGroups=function(e,t){if(e)for(var r=0,n=e.length;r<n;r++)this.processSecondaryGroup(e[r],t)},t.prototype.processPrimaryGroup=function(e,t){for(var r=e.Projections,n=0,o=r.length;n<o;n++){var i=(r[n],this.projectionsInfo[r[n]]);0===i.metadata.kind?a.addRowsRole(t,i):1===i.metadata.kind&&a.addValuesRole(t,i)}},t.prototype.processSecondaryGroup=function(e,t){for(var r=e.Projections,n=0,o=r.length;n<o;n++)a.addColumnsRole(t,this.projectionsInfo[r[n]])},t})(a)})(r=t.util||(t.util={}))})(r=t.infonav||(t.infonav={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var n=e.common.helpers.ModelConverterHelper,a=(function(){function r(e,r,n,a,o,i){this.$timeout=e,this.featureSwitchService=r,this.promiseFactory=n,this.interpretProbeService=a,this.conceptualSchemaProxy=o,this.localizationService=i,this.placeholder=t.utils.QnaLanguageUtil.getPlaceholderText(i),this.sendInterpretProbe()}return r.createOptions=function(){return{additionalServices:["$timeout","featureSwitchService","promiseFactory","interpretProbe","conceptualSchemaProxy","localizationService"]}},r.prototype.launchQna=function(){this.showQna(),this.$timeout((function(){return $(".qnaInputContainer #content").focus()}))},r.prototype.sendInterpretProbe=function(e){var a=this,o=_.filter(this.models,(function(e){return e&&n.getIsQnaSupported(e,a.featureSwitchService.featureSwitches)})),i=this.interpretProbeService.probe(o||[],e),s=this.promiseFactory.defer();return i.then((function(e){a.placeholder=t.utils.QnaLanguageUtil.getPlaceholderText(a.localizationService,e),r.preloadConceptualSchemas(a.models||[],a.conceptualSchemaProxy),s.resolve({})}),(function(){s.reject()})),s.promise},r.preloadConceptualSchemas=function(e,t){for(var n=3,a=Math.min(e.length,n),o=0,i=_.take(e,a);o<i.length;o++){var s=i[o];t.get(r.createDataSourceArray(s))}},r.createDataSourceArray=function(t){return e.explore.contracts.createDataSourceArray([{type:"dsr",id:t.id,packageId:t.packageId,name:void 0,dsr:{schemaName:void 0,vsName:t.vsName,dbName:t.dbName,modelId:t.id}}])},r})();r.QnaInputLauncherController=a,a.$inject=a.createOptions().additionalServices})(r=t.controllers||(t.controllers={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){t.QnaInputLauncher={templateUrl:"qnaInputLauncher/qnaInputLauncher.html",bindings:{models:"=",showQna:"="},controller:e.controllers.QnaInputLauncherController}})(t=e.components||(e.components={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={})),powerbi.infonav.registerInfonavBootstrapComponent("QnaInputLauncher");var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function n(e,t,r,n,o){var i=6e5;return new a(e,t,r,n,o||i)}r.createInterpretProbeService=n;var a=(function(){function r(e,t,r,n,a){this.interpretHttpService=e,this.promiseFactory=t,this.timeoutService=r,this.featureSwitchService=n,this.probePromiseCache=new o(a)}return r.prototype.probe=function(e,r,n){var a=t.utils.InterpretUtil.createInterpretRequestScope(e,this.featureSwitchService.featureSwitches);return _.isEmpty(a.DbMonikers)?this.promiseFactory.reject():this.probeInternal(a,r,n).promise},r.prototype.isProbeCompleted=function(e){var t=this.probePromiseCache.getPromise(e);return t&&t.isComplete},r.prototype.probeInternal=function(e,t,r){var n=this,a=this.probePromiseCache.getPromise(e);if(!a){var o=this.promiseFactory.defer();a={promise:o.promise,waitingInterprets:[],isComplete:!1},this.probePromiseCache.setPromise(e,a),this.sendProbeRequest(e,t).then((function(e){o.resolve(e.data)}),(function(){o.reject(),n.probePromiseCache.clearPromise(e)})),o.promise.finally((function(){a.isComplete=!0;var e=a.waitingInterprets,t=e.length;if(t>0){var r=e[t-1].runToCompletion();r.finally((function(){for(var r=0;r<t-1;r++)e[r].reject()}))}a.waitingInterprets=[]}))}return r&&a.waitingInterprets.push(r),a},r.prototype.sendProbeRequest=function(t,r){var n=6e4,a=e.common.httpService.powerbiRequestOptions(r,"InterpretProbe");return a.timeout=n,this.interpretHttpService.probe(t,r)},r})(),o=(function(){function e(e){this.cache={},this.expirationInMilliseconds=e}return e.prototype.getPromise=function(t){var r=e.getCacheKey(t),n=this.cache[r];return n&&n.expiration<Date.now()&&(delete this.cache[r],n=void 0),n},e.prototype.setPromise=function(t,r){r.expiration=Date.now()+this.expirationInMilliseconds,this.cache[e.getCacheKey(t)]=r},e.prototype.clearPromise=function(t){delete this.cache[e.getCacheKey(t)]},e.getCacheKey=function(e){return _(e.DbMonikers).sortBy((function(e){return e.VirtualServerName})).sortBy((function(e){return e.DatabaseName})).map((function(e){return e.DatabaseName+":"+e.VirtualServerName})).value().join("::")},e})()})(r=t.services||(t.services={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={})),angular.module("powerbi.infonavbootstrap").run(["$templateCache",function(e){e.put("qnaInputLauncher/qnaInputLauncher.html",'<span class="qnaInputLauncher" ng-click="$ctrl.launchQna()"><span class="glyphicon pbi-glyph-qna icon"></span><span class="qnaInputLauncherText" ng-bind="$ctrl.placeholder"></span></span>')}]);var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function n(e,t){return new i(e,t)}r.createInterpretHttpService=n;var a=25e3,o=6e4,i=(function(){function r(e,t){this.timeoutService=e,this.promiseFactory=t}return r.prototype.probe=function(r,n){var a=e.common.httpService.powerbiRequestOptions(n,"InterpretProbe");a.timeout=o;var i={Scope:r,Options:t.contracts.InterpretRequestOptions.SupportPodQueries};return e.common.httpService.post("/explore/interpretation/interpretprobe/",i,a)},r.prototype.interpret=function(t,r,n){var o=e.common.httpService.powerbiRequestOptions(r,"Interpret"),i=this.promiseFactory.defer();return o.timeout=i.promise,this.timeoutService((function(){return i.resolve({})}),a),n&&n.then((function(){return i.resolve({})})),e.common.httpService.post("/explore/interpretation/interpret/",t,o)},r})()})(r=t.services||(t.services={}))})(t=e.infonav||(e.infonav={}))})(powerbi||(powerbi={}));;var __extends=this&&this.__extends||function(e,i){function t(){this.constructor=e}for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n]);e.prototype=null===i?Object.create(i):(t.prototype=i.prototype,new t)},powerbi;!(function(e){var i;!(function(i){var t;!(function(e){e[e.NavigationPane=0]="NavigationPane",e[e.Notification=1]="Notification",e[e.Desktop=2]="Desktop",e[e.DirectNavigation=3]="DirectNavigation",e[e.ReloadButton=4]="ReloadButton",e[e.InFocusMode=5]="InFocusMode",e[e.ContentTile=6]="ContentTile",e[e.DashboardTile=7]="DashboardTile",e[e.InsightsPaneTile=8]="InsightsPaneTile",e[e.Email=9]="Email"})(t=i.InsightEntryPoint||(i.InsightEntryPoint={}));var n;!(function(e){e[e.ShowInsightsCard=0]="ShowInsightsCard",e[e.InFocusMode=1]="InFocusMode"})(n=i.PinInsightEntryPoint||(i.PinInsightEntryPoint={}));var r;!(function(e){e[e.ModelError=0]="ModelError",e[e.SystemError=1]="SystemError"})(r=i.InsightErrorType||(i.InsightErrorType={}));var s;!(function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"})(s=i.InsightFeedback||(i.InsightFeedback={}));var o;!(function(e){e[e.ClientCache=0]="ClientCache",e[e.ServiceQuickMode=1]="ServiceQuickMode",e[e.ServiceThoroughMode=2]="ServiceThoroughMode"})(o=i.InsightSource||(i.InsightSource={}));var a;!(function(e){e[e.Min=0]="Min",e[e.Max=1]="Max",e[e.All=2]="All"})(a=i.SummaryFactType||(i.SummaryFactType={}));var l;!(function(e){e[e.Loading=0]="Loading",e[e.ReadyWithoutInsightsLoaded=1]="ReadyWithoutInsightsLoaded",e[e.ReadyWithInsightsLoaded=2]="ReadyWithInsightsLoaded"})(l=i.InsightState||(i.InsightState={})),i.InsightsShowInsights=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h,p,y,m){void 0===a&&(a=!1),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===g&&(g=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1),void 0===p&&(p=void 0),void 0===y&&(y=!1),void 0===m&&(m=!1);var f={insightCount:i,entryPoint:t,contentProviderId:n,hashedModelId:r,isScoped:s,parentId:o,isError:a,errorSource:l,errorCode:c,errorMessage:u,activityName:d,activityId:g,isDebug:v,isCancelled:h,pingLatency:p,isAppInactive:y,isInCapacity:m},I={name:"PBI.Insights.ShowInsights",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={insightCount:f.insightCount,entryPoint:e.telemetry.InsightEntryPoint[f.entryPoint],contentProviderId:f.contentProviderId,hashedModelId:f.hashedModelId,isScoped:f.isScoped,parentId:f.parentId},t=typeof f.isError;("boolean"===t&&!!f.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=f.isError);var t=typeof f.errorSource;("boolean"===t&&!!f.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[f.errorSource]);var t=typeof f.errorCode;("boolean"===t&&!!f.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=f.errorCode);var t=typeof f.errorMessage;("boolean"===t&&!!f.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=f.errorMessage);var t=typeof f.activityName;("boolean"===t&&!!f.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=f.activityName);var t=typeof f.activityId;("boolean"===t&&!!f.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=f.activityId);var t=typeof f.isDebug;("boolean"===t&&!!f.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=f.isDebug);var t=typeof f.isCancelled;("boolean"===t&&!!f.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=f.isCancelled);var t=typeof f.pingLatency;("boolean"===t&&!!f.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=f.pingLatency);var t=typeof f.isAppInactive;("boolean"===t&&!!f.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=f.isAppInactive);var t=typeof f.isInCapacity;return("boolean"===t&&!!f.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=f.isInCapacity),i},info:f,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsShowInsightsLoggers&&(I.loggers=e.telemetry.InsightsShowInsightsLoggers),I},i.InsightsGetInsights=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h,p){void 0===s&&(s=!1),void 0===o&&(o=void 0),void 0===a&&(a=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=!1),void 0===g&&(g=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===p&&(p=!1);var y={insightCount:i,source:t,errorType:n,parentId:r,isError:s,errorSource:o,errorCode:a,errorMessage:l,activityName:c,activityId:u,isDebug:d,isCancelled:g,pingLatency:v,isAppInactive:h,isInCapacity:p},m={name:"PBI.Insights.GetInsights",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={insightCount:y.insightCount,source:e.telemetry.InsightSource[y.source],errorType:e.telemetry.InsightErrorType[y.errorType],parentId:y.parentId},t=typeof y.isError;("boolean"===t&&!!y.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=y.isError);var t=typeof y.errorSource;("boolean"===t&&!!y.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[y.errorSource]);var t=typeof y.errorCode;("boolean"===t&&!!y.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=y.errorCode);var t=typeof y.errorMessage;("boolean"===t&&!!y.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=y.errorMessage);var t=typeof y.activityName;("boolean"===t&&!!y.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=y.activityName);var t=typeof y.activityId;("boolean"===t&&!!y.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=y.activityId);var t=typeof y.isDebug;("boolean"===t&&!!y.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=y.isDebug);var t=typeof y.isCancelled;("boolean"===t&&!!y.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=y.isCancelled);var t=typeof y.pingLatency;("boolean"===t&&!!y.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=y.pingLatency);var t=typeof y.isAppInactive;("boolean"===t&&!!y.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=y.isAppInactive);var t=typeof y.isInCapacity;return("boolean"===t&&!!y.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=y.isInCapacity),i},info:y,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsGetInsightsLoggers&&(m.loggers=e.telemetry.InsightsGetInsightsLoggers),m},i.InsightsViewInsightInFocus=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h,p,y,m,f,I,S){void 0===u&&(u=!1),void 0===d&&(d=void 0),void 0===g&&(g=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0),void 0===p&&(p=void 0),void 0===y&&(y=!1),void 0===m&&(m=!1),void 0===f&&(f=void 0),void 0===I&&(I=!1),void 0===S&&(S=!1);var C={rank:i,type:t,insightType:n,commonColumnCount:r,commonHighlightFilterCount:s,commonQueryFilterCount:o,relevanceScore:a,source:l,parentId:c,isError:u,errorSource:d,errorCode:g,errorMessage:v,activityName:h,activityId:p,isDebug:y,isCancelled:m,pingLatency:f,isAppInactive:I,isInCapacity:S},b={name:"PBI.Insights.ViewInsightInFocus",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={rank:C.rank,type:C.type,insightType:C.insightType,commonColumnCount:C.commonColumnCount,commonHighlightFilterCount:C.commonHighlightFilterCount,commonQueryFilterCount:C.commonQueryFilterCount,relevanceScore:C.relevanceScore,source:e.telemetry.InsightSource[C.source],parentId:C.parentId},t=typeof C.isError;("boolean"===t&&!!C.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=C.isError);var t=typeof C.errorSource;("boolean"===t&&!!C.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[C.errorSource]);var t=typeof C.errorCode;("boolean"===t&&!!C.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=C.errorCode);var t=typeof C.errorMessage;("boolean"===t&&!!C.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=C.errorMessage);var t=typeof C.activityName;("boolean"===t&&!!C.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=C.activityName);var t=typeof C.activityId;("boolean"===t&&!!C.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=C.activityId);var t=typeof C.isDebug;("boolean"===t&&!!C.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=C.isDebug);var t=typeof C.isCancelled;("boolean"===t&&!!C.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=C.isCancelled);var t=typeof C.pingLatency;("boolean"===t&&!!C.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=C.pingLatency);var t=typeof C.isAppInactive;("boolean"===t&&!!C.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=C.isAppInactive);var t=typeof C.isInCapacity;return("boolean"===t&&!!C.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=C.isInCapacity),i},info:C,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsViewInsightInFocusLoggers&&(b.loggers=e.telemetry.InsightsViewInsightInFocusLoggers),b},i.InsightsPinInsight=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h,p,y,m,f){void 0===l&&(l=!1),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===g&&(g=void 0),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===p&&(p=!1),void 0===y&&(y=void 0),void 0===m&&(m=!1),void 0===f&&(f=!1);var I={rank:i,type:t,insightType:n,pinEntryPoint:r,source:s,relevanceScore:o,parentId:a,isError:l,errorSource:c,errorCode:u,errorMessage:d,activityName:g,activityId:v,isDebug:h,isCancelled:p,pingLatency:y,isAppInactive:m,isInCapacity:f},S={name:"PBI.Insights.PinInsight",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={rank:I.rank,type:I.type,insightType:I.insightType,pinEntryPoint:e.telemetry.PinInsightEntryPoint[I.pinEntryPoint],source:e.telemetry.InsightSource[I.source],relevanceScore:I.relevanceScore,parentId:I.parentId},t=typeof I.isError;("boolean"===t&&!!I.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=I.isError);var t=typeof I.errorSource;("boolean"===t&&!!I.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[I.errorSource]);var t=typeof I.errorCode;("boolean"===t&&!!I.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=I.errorCode);var t=typeof I.errorMessage;("boolean"===t&&!!I.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=I.errorMessage);var t=typeof I.activityName;("boolean"===t&&!!I.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=I.activityName);var t=typeof I.activityId;("boolean"===t&&!!I.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=I.activityId);var t=typeof I.isDebug;("boolean"===t&&!!I.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=I.isDebug);var t=typeof I.isCancelled;("boolean"===t&&!!I.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=I.isCancelled);var t=typeof I.pingLatency;("boolean"===t&&!!I.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=I.pingLatency);var t=typeof I.isAppInactive;("boolean"===t&&!!I.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=I.isAppInactive);var t=typeof I.isInCapacity;return("boolean"===t&&!!I.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=I.isInCapacity),i},info:I,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsPinInsightLoggers&&(S.loggers=e.telemetry.InsightsPinInsightLoggers),S},i.InsightsWarnings=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h){void 0===r&&(r=!1),void 0===s&&(s=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===d&&(d=!1),void 0===g&&(g=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var p={warning:i,attempt:t,parentId:n,isError:r,errorSource:s,errorCode:o,errorMessage:a,activityName:l,activityId:c,isDebug:u,isCancelled:d,pingLatency:g,isAppInactive:v,isInCapacity:h},y={name:"PBI.Insights.Warnings",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={warning:p.warning,attempt:p.attempt,parentId:p.parentId},t=typeof p.isError;("boolean"===t&&!!p.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=p.isError);var t=typeof p.errorSource;("boolean"===t&&!!p.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[p.errorSource]);var t=typeof p.errorCode;("boolean"===t&&!!p.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=p.errorCode);var t=typeof p.errorMessage;("boolean"===t&&!!p.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=p.errorMessage);var t=typeof p.activityName;("boolean"===t&&!!p.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=p.activityName);var t=typeof p.activityId;("boolean"===t&&!!p.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=p.activityId);var t=typeof p.isDebug;("boolean"===t&&!!p.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=p.isDebug);var t=typeof p.isCancelled;("boolean"===t&&!!p.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=p.isCancelled);var t=typeof p.pingLatency;("boolean"===t&&!!p.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=p.pingLatency);var t=typeof p.isAppInactive;("boolean"===t&&!!p.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=p.isAppInactive);var t=typeof p.isInCapacity;return("boolean"===t&&!!p.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=p.isInCapacity),i},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsWarningsLoggers&&(y.loggers=e.telemetry.InsightsWarningsLoggers),y},i.InsightsConversionFailure=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h){void 0===r&&(r=!1),void 0===s&&(s=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=!1),void 0===d&&(d=!1),void 0===g&&(g=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1);var p={insightType:i,message:t,parentId:n,isError:r,errorSource:s,errorCode:o,errorMessage:a,activityName:l,activityId:c,isDebug:u,isCancelled:d,pingLatency:g,isAppInactive:v,isInCapacity:h},y={name:"PBI.Insights.ConversionFailure",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={insightType:p.insightType,message:p.message,parentId:p.parentId},t=typeof p.isError;("boolean"===t&&!!p.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=p.isError);var t=typeof p.errorSource;("boolean"===t&&!!p.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[p.errorSource]);var t=typeof p.errorCode;("boolean"===t&&!!p.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=p.errorCode);var t=typeof p.errorMessage;("boolean"===t&&!!p.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=p.errorMessage);var t=typeof p.activityName;("boolean"===t&&!!p.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=p.activityName);var t=typeof p.activityId;("boolean"===t&&!!p.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=p.activityId);var t=typeof p.isDebug;("boolean"===t&&!!p.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=p.isDebug);var t=typeof p.isCancelled;("boolean"===t&&!!p.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=p.isCancelled);var t=typeof p.pingLatency;("boolean"===t&&!!p.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=p.pingLatency);var t=typeof p.isAppInactive;("boolean"===t&&!!p.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=p.isAppInactive);var t=typeof p.isInCapacity;return("boolean"===t&&!!p.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=p.isInCapacity),i},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsConversionFailureLoggers&&(y.loggers=e.telemetry.InsightsConversionFailureLoggers),y},i.InsightsVisualFailedRendering=function(i,t,n,r,s,o,a,l,c,u,d,g,v){void 0===n&&(n=!1),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===d&&(d=void 0),void 0===g&&(g=!1),void 0===v&&(v=!1);var h={visualsFailedRendering:i,parentId:t,isError:n,errorSource:r,errorCode:s,errorMessage:o,activityName:a,activityId:l,isDebug:c,isCancelled:u,pingLatency:d,isAppInactive:g,isInCapacity:v},p={name:"PBI.Insights.VisualFailedRendering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={visualsFailedRendering:h.visualsFailedRendering,parentId:h.parentId},t=typeof h.isError;("boolean"===t&&!!h.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=h.isError);var t=typeof h.errorSource;("boolean"===t&&!!h.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[h.errorSource]);var t=typeof h.errorCode;("boolean"===t&&!!h.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=h.errorCode);var t=typeof h.errorMessage;("boolean"===t&&!!h.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=h.errorMessage);var t=typeof h.activityName;("boolean"===t&&!!h.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=h.activityName);var t=typeof h.activityId;("boolean"===t&&!!h.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=h.activityId);var t=typeof h.isDebug;("boolean"===t&&!!h.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=h.isDebug);var t=typeof h.isCancelled;("boolean"===t&&!!h.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=h.isCancelled);var t=typeof h.pingLatency;("boolean"===t&&!!h.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=h.pingLatency);var t=typeof h.isAppInactive;("boolean"===t&&!!h.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=h.isAppInactive);var t=typeof h.isInCapacity;return("boolean"===t&&!!h.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=h.isInCapacity),i},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsVisualFailedRenderingLoggers&&(p.loggers=e.telemetry.InsightsVisualFailedRenderingLoggers),p},i.InsightsScopedInputVisualFeatures=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h,p,y){void 0===o&&(o=!1),void 0===a&&(a=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===g&&(g=!1),void 0===v&&(v=!1),void 0===h&&(h=void 0),void 0===p&&(p=!1),void 0===y&&(y=!1);var m={tileAction:i,columns:t,filters:n,highlights:r,parentId:s,isError:o,errorSource:a,errorCode:l,errorMessage:c,activityName:u,activityId:d,isDebug:g,isCancelled:v,pingLatency:h,isAppInactive:p,isInCapacity:y},f={name:"PBI.Insights.ScopedInputVisualFeatures",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={tileAction:m.tileAction,columns:m.columns,filters:m.filters,highlights:m.highlights,parentId:m.parentId},t=typeof m.isError;("boolean"===t&&!!m.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=m.isError);var t=typeof m.errorSource;("boolean"===t&&!!m.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[m.errorSource]);var t=typeof m.errorCode;("boolean"===t&&!!m.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=m.errorCode);var t=typeof m.errorMessage;("boolean"===t&&!!m.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=m.errorMessage);var t=typeof m.activityName;("boolean"===t&&!!m.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=m.activityName);var t=typeof m.activityId;("boolean"===t&&!!m.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=m.activityId);var t=typeof m.isDebug;("boolean"===t&&!!m.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=m.isDebug);var t=typeof m.isCancelled;("boolean"===t&&!!m.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=m.isCancelled);var t=typeof m.pingLatency;("boolean"===t&&!!m.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=m.pingLatency);var t=typeof m.isAppInactive;("boolean"===t&&!!m.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=m.isAppInactive);var t=typeof m.isInCapacity;return("boolean"===t&&!!m.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=m.isInCapacity),i},info:m,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsScopedInputVisualFeaturesLoggers&&(f.loggers=e.telemetry.InsightsScopedInputVisualFeaturesLoggers),f},i.InsightsFeedback=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h,p,y,m){void 0===a&&(a=!1),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===g&&(g=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1),void 0===p&&(p=void 0),void 0===y&&(y=!1),void 0===m&&(m=!1);var f={feedback:i,columns:t,filters:n,highlights:r,source:s,parentId:o,isError:a,errorSource:l,errorCode:c,errorMessage:u,activityName:d,activityId:g,isDebug:v,isCancelled:h,pingLatency:p,isAppInactive:y,isInCapacity:m},I={name:"PBI.Insights.Feedback",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={feedback:e.telemetry.InsightFeedback[f.feedback],columns:f.columns,filters:f.filters,highlights:f.highlights,source:e.telemetry.InsightSource[f.source],parentId:f.parentId},t=typeof f.isError;("boolean"===t&&!!f.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=f.isError);var t=typeof f.errorSource;("boolean"===t&&!!f.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[f.errorSource]);var t=typeof f.errorCode;("boolean"===t&&!!f.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=f.errorCode);var t=typeof f.errorMessage;("boolean"===t&&!!f.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=f.errorMessage);var t=typeof f.activityName;("boolean"===t&&!!f.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=f.activityName);var t=typeof f.activityId;("boolean"===t&&!!f.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=f.activityId);var t=typeof f.isDebug;("boolean"===t&&!!f.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=f.isDebug);var t=typeof f.isCancelled;("boolean"===t&&!!f.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=f.isCancelled);var t=typeof f.pingLatency;("boolean"===t&&!!f.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=f.pingLatency);var t=typeof f.isAppInactive;("boolean"===t&&!!f.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=f.isAppInactive);var t=typeof f.isInCapacity;return("boolean"===t&&!!f.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=f.isInCapacity),i},info:f,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsFeedbackLoggers&&(I.loggers=e.telemetry.InsightsFeedbackLoggers),I},i.InsightsShowSummaryInsights=function(i,t,n,r,s,o,a,l,c,u,d,g,v){void 0===n&&(n=!1),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),void 0===l&&(l=void 0),void 0===c&&(c=!1),void 0===u&&(u=!1),void 0===d&&(d=void 0),void 0===g&&(g=!1),void 0===v&&(v=!1);var h={insightCount:i,parentId:t,isError:n,errorSource:r,errorCode:s,errorMessage:o,activityName:a,activityId:l,isDebug:c,isCancelled:u,pingLatency:d,isAppInactive:g,isInCapacity:v},p={name:"PBI.Insights.ShowSummaryInsights",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={insightCount:h.insightCount,parentId:h.parentId},t=typeof h.isError;("boolean"===t&&!!h.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=h.isError);var t=typeof h.errorSource;("boolean"===t&&!!h.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[h.errorSource]);var t=typeof h.errorCode;("boolean"===t&&!!h.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=h.errorCode);var t=typeof h.errorMessage;("boolean"===t&&!!h.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=h.errorMessage);var t=typeof h.activityName;("boolean"===t&&!!h.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=h.activityName);var t=typeof h.activityId;("boolean"===t&&!!h.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=h.activityId);var t=typeof h.isDebug;("boolean"===t&&!!h.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=h.isDebug);var t=typeof h.isCancelled;("boolean"===t&&!!h.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=h.isCancelled);var t=typeof h.pingLatency;("boolean"===t&&!!h.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=h.pingLatency);var t=typeof h.isAppInactive;("boolean"===t&&!!h.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=h.isAppInactive);var t=typeof h.isInCapacity;return("boolean"===t&&!!h.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=h.isInCapacity),i},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsShowSummaryInsightsLoggers&&(p.loggers=e.telemetry.InsightsShowSummaryInsightsLoggers),p},i.InsightsInteraction=function(i,t,n,r,s,o,a,l,c,u,d,g,v,h,p,y){void 0===o&&(o=!1),void 0===a&&(a=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===g&&(g=!1),void 0===v&&(v=!1),void 0===h&&(h=void 0),void 0===p&&(p=!1),void 0===y&&(y=!1);var m={summaryFactType:i,measureNumber:t,insightState:n,visualType:r,parentId:s,isError:o,errorSource:a,errorCode:l,errorMessage:c,activityName:u,activityId:d,isDebug:g,isCancelled:v,pingLatency:h,isAppInactive:p,isInCapacity:y},f={name:"PBI.Insights.Interaction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={summaryFactType:e.telemetry.SummaryFactType[m.summaryFactType],measureNumber:m.measureNumber,insightState:e.telemetry.InsightState[m.insightState],visualType:m.visualType,parentId:m.parentId},t=typeof m.isError;("boolean"===t&&!!m.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=m.isError);var t=typeof m.errorSource;("boolean"===t&&!!m.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[m.errorSource]);var t=typeof m.errorCode;("boolean"===t&&!!m.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=m.errorCode);var t=typeof m.errorMessage;("boolean"===t&&!!m.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=m.errorMessage);var t=typeof m.activityName;("boolean"===t&&!!m.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=m.activityName);var t=typeof m.activityId;("boolean"===t&&!!m.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=m.activityId);var t=typeof m.isDebug;("boolean"===t&&!!m.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=m.isDebug);var t=typeof m.isCancelled;("boolean"===t&&!!m.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=m.isCancelled);var t=typeof m.pingLatency;("boolean"===t&&!!m.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=m.pingLatency);var t=typeof m.isAppInactive;("boolean"===t&&!!m.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=m.isAppInactive);var t=typeof m.isInCapacity;return("boolean"===t&&!!m.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=m.isInCapacity),i},info:m,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsInteractionLoggers&&(f.loggers=e.telemetry.InsightsInteractionLoggers),f},i.InsightsNoResponse=function(i,t,n,r,s,o,a,l,c,u,d,g){void 0===t&&(t=!1),void 0===n&&(n=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===d&&(d=!1),void 0===g&&(g=!1);var v={parentId:i,isError:t,errorSource:n,errorCode:r,errorMessage:s,activityName:o,activityId:a,isDebug:l,isCancelled:c,pingLatency:u,isAppInactive:d,isInCapacity:g},h={name:"PBI.Insights.NoResponse",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={parentId:v.parentId},t=typeof v.isError;("boolean"===t&&!!v.isError!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isError=v.isError);var t=typeof v.errorSource;("boolean"===t&&!!v.errorSource!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorSource=e.telemetry.ErrorSource[v.errorSource]);var t=typeof v.errorCode;("boolean"===t&&!!v.errorCode!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorCode=v.errorCode);var t=typeof v.errorMessage;("boolean"===t&&!!v.errorMessage!=!1||"undefined"!==t&&"boolean"!==t)&&(i.errorMessage=v.errorMessage);var t=typeof v.activityName;("boolean"===t&&!!v.activityName!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityName=v.activityName);var t=typeof v.activityId;("boolean"===t&&!!v.activityId!=!1||"undefined"!==t&&"boolean"!==t)&&(i.activityId=v.activityId);var t=typeof v.isDebug;("boolean"===t&&!!v.isDebug!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isDebug=v.isDebug);var t=typeof v.isCancelled;("boolean"===t&&!!v.isCancelled!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isCancelled=v.isCancelled);var t=typeof v.pingLatency;("boolean"===t&&!!v.pingLatency!=!1||"undefined"!==t&&"boolean"!==t)&&(i.pingLatency=v.pingLatency);var t=typeof v.isAppInactive;("boolean"===t&&!!v.isAppInactive!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isAppInactive=v.isAppInactive);var t=typeof v.isInCapacity;return("boolean"===t&&!!v.isInCapacity!=!1||"undefined"!==t&&"boolean"!==t)&&(i.isInCapacity=v.isInCapacity),i},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.InsightsNoResponseLoggers&&(h.loggers=e.telemetry.InsightsNoResponseLoggers),h}})(i=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){function t(e,t){void 0===t&&(t=[]);var n=i.directives[e],r=e[0].toLowerCase()+e.slice(1);t.push((function(){var e=Function.prototype.bind.apply(n,[null]);return new e})),angular.module("powerbi.insights").directive(r,t)}angular.module("powerbi.insights.directives",[]),angular.module("powerbi.insights.controllers",[]);var n=["powerbi.insights.controllers","powerbi.insights.directives"];angular.module("powerbi.insights",n).factory("insightsCacheService",[function(){return i.services.createInsightsCacheService()}]).factory("insightsProxy",["promiseFactory","syncService","featureSwitchService",function(i,t,n){return e.insights.proxies.createInsightsService(e.common.httpService,i,t,n)}]).factory("visualHostService",["geolocationService","geocoder","promiseFactory","moduleLoader",function(i,t,n,r){return e.explore.services.createVisualHostServices(n,r,i,t)}]).run(["scopedProvider",function(t){t.register("visualPlugin",{services:["promiseFactory","featureSwitchService"],fn:function(i,t){return e.insights.services.createInsightsVisualPluginService(i,t)}},i.constants.scopedInstanceProviderName)}]).factory("insightsService",["conceptualSchemaProxy","dataProxy","dataReaderProvider","displayNameService","featureSwitchService","insightsCacheService","insightsProxy","localizationService","telemetryService","visualHostService","notificationToast","errorService","themeService","aggrOps","promiseFactory","scriptVisuals",function(t,n,r,s,o,a,l,c,u,d,g,v,h,p,y,m){var f=i.services.createInsightsVisualPluginService(y,o),I=e.explore.services.createVisualPluginOps(f),S=e.explore.services.createFilterGenerator(e.common.createEventBridge(),f,p,e.explore.services.createVisualRelationshipService(f,I),{getSelectedHostFilters:function(){
return null}},u,m);return i.services.createInsightsService(t,n,r,s,o,a,l,c,u,d,f,I,g,v,h,p,S,y)}]).factory("summaryInsightsService",["conceptualSchemaProxy","dataProxy","displayNameService","dataReaderProvider","featureSwitchService","insightsService","promiseFactory","telemetryService","localizationService","aggrOps","themeService","scriptVisuals",function(t,n,r,s,o,a,l,c,u,d,g,v){var h=i.services.createInsightsVisualPluginService(l,o),p=e.explore.services.createVisualPluginOps(h),y=e.explore.services.createFilterGenerator(e.common.createEventBridge(),h,d,e.explore.services.createVisualRelationshipService(h,p),{getSelectedHostFilters:function(){return null}},c,v);return i.services.createSummaryInsightsService(t,n,r,s,h,p,o,a,l,c,u,d,y,g)}]),i.registerInsightsDirective=t})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(e){var i;!(function(e){var i;!(function(e){e[e.Data=0]="Data",e[e.Schema=1]="Schema"})(i=e.InsightSource||(e.InsightSource={}));var t;!(function(e){e[e.None=0]="None",e[e.Attribution=1]="Attribution",e[e.ChangePoint=2]="ChangePoint",e[e.Correlation=3]="Correlation",e[e.CrossMeasureCorrelation=4]="CrossMeasureCorrelation",e[e.Outlier=5]="Outlier",e[e.OutstandingFirst=6]="OutstandingFirst",e[e.OutstandingLast=7]="OutstandingLast",e[e.OutstandingTop2=8]="OutstandingTop2",e[e.Seasonality=9]="Seasonality",e[e.SetRelationship=10]="SetRelationship",e[e.Trend=11]="Trend",e[e.ComplexTimeSeries=12]="ComplexTimeSeries",e[e.LowVariance=13]="LowVariance",e[e.ClusterAndOutlier=14]="ClusterAndOutlier"})(t=e.InsightType||(e.InsightType={}));var n;!(function(e){e[e.None=0]="None",e[e.NoMeasures=1]="NoMeasures",e[e.NoDimensions=2]="NoDimensions",e[e.NoFilteredComponents=4]="NoFilteredComponents",e[e.InvalidModel=8]="InvalidModel",e[e.TooManyFailedQueries=16]="TooManyFailedQueries",e[e.DataMinerTimeoutExceeded=32]="DataMinerTimeoutExceeded",e[e.IN4DataMinerException=64]="IN4DataMinerException",e[e.ModelUnavailable=128]="ModelUnavailable",e[e.InsightsServiceException=256]="InsightsServiceException",e[e.DidNotRunAllComponents=512]="DidNotRunAllComponents",e[e.MaxNumberOfQueriesReached=1024]="MaxNumberOfQueriesReached",e[e.DidNotSelectAllComponentsToRun=2048]="DidNotSelectAllComponentsToRun",e[e.TooFewQueriesIssued=4096]="TooFewQueriesIssued",e[e.ConnectionPoolTimeoutExceeded=8192]="ConnectionPoolTimeoutExceeded",e[e.DataModelTooSimple=16384]="DataModelTooSimple",e[e.DataModelTooComplex=32768]="DataModelTooComplex",e[e.DataMinerTimeoutExhausted=65536]="DataMinerTimeoutExhausted",e[e.FailedConnections=131072]="FailedConnections",e[e.SlowToOpenConnections=262144]="SlowToOpenConnections",e[e.InvalidScope=524288]="InvalidScope",e[e.CacheException=1048576]="CacheException",e[e.MaxNumberOfRequestsReached=2097152]="MaxNumberOfRequestsReached",e[e.InsightStoreException=4194304]="InsightStoreException",e[e.InsightConversionError=8388608]="InsightConversionError"})(n=e.InsightsWarnings||(e.InsightsWarnings={}));var r;!(function(e){e[e.Dimension=0]="Dimension",e[e.FilterValue=1]="FilterValue",e[e.FocusValue=2]="FocusValue",e[e.Measure=3]="Measure",e[e.Other=4]="Other",e[e.Text=5]="Text"})(r=e.DescriptionItemType||(e.DescriptionItemType={}))})(i=e.contracts||(e.contracts={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(e){var i;!(function(e){var i=(function(){function e(){}return e.prototype.visit=function(e){return e.Attribution?this.visitAttribution(e.Attribution):e.ChildCorrelation?this.visitChildCorrelation(e.ChildCorrelation):e.Seasonality?this.visitSeasonality(e.Seasonality):e.Trend?this.visitTrend(e.Trend):e.CrossMeasureCorrelation?this.visitCrossMeasureCorrelation(e.CrossMeasureCorrelation):null},e.prototype.visitAttribution=function(e){return this.visitDefault()},e.prototype.visitChildCorrelation=function(e){return this.visitDefault()},e.prototype.visitCrossMeasureCorrelation=function(e){return this.visitDefault()},e.prototype.visitSeasonality=function(e){return this.visitDefault()},e.prototype.visitTrend=function(e){return this.visitDefault()},e.prototype.visitDefault=function(){return null},e})();e.InsightFeatureVisitor=i;var t;!(function(e){e[e.Ordinal=0]="Ordinal",e[e.Ticks=1]="Ticks",e[e.Milliseconds=2]="Milliseconds",e[e.Seconds=3]="Seconds",e[e.Minutes=4]="Minutes",e[e.Hours=5]="Hours",e[e.Days=6]="Days",e[e.Weeks=7]="Weeks",e[e.Months=8]="Months",e[e.Quarters=9]="Quarters",e[e.Semesters=10]="Semesters",e[e.Years=11]="Years",e[e.Decades=12]="Decades",e[e.Centuries=13]="Centuries"})(t=e.IntervalUnit||(e.IntervalUnit={}))})(i=e.contracts||(e.contracts={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){var t;!(function(t){var n=e.explore.services.createVisualQueryGenerator,r=(function(){function t(t,r){var s=this;if(this.scope=t,this.services=r,this.sortService=e.explore.services.createSortService(this.services.displayNameService,this.services.featureSwitchService,this.services.visualPlugin),this.visualQueryGenerator=n({dataReaders:this.services.dataReaderProvider,displayNameService:this.services.displayNameService,plugin:this.services.visualPlugin,pluginOps:this.services.visualPluginOps,sortService:this.sortService,featureSwitchService:this.services.featureSwitchService,aggrOps:this.services.aggrOps,filterGenerator:this.services.filterGenerator,transformPluginService:e.data.transforms.createTransformPluginService(),telemetryService:this.services.telemetryService}),this.scope.zeroInsightsLearnMoreLink=i.constants.zeroInsightsLink,this.scope.subsetDataSearchedLink=i.constants.subsetDataSearchedLink,this.scope.canShowInsights=function(){return s.canShowInsights()},this.scope.showInFocusMode=function(e,i){return s.showInFocusMode(e,i)},this.scope.pinInsight=function(e,i){return s.pinInsight(e,i)},this.scope.reloadInsights=function(e){return s.reloadInsights(e)},this.scope.insightsDevModeEnabled=this.services.featureSwitchService.featureSwitches.insightsDevModeEnabled,this.scope.viewModel)this.showInsights();else var o=t.$watch("viewModel",(function(){s.scope.viewModel&&(o(),s.showInsights())}))}return t.createOptions=function(){return{scopedServiceRoot:!0,scopedDependencies:["filterGenerator","visualPlugin","visualPluginOps"],scopedProviderInstanceName:i.constants.scopedInstanceProviderName,additionalServices:["aggrOps","conceptualSchemaProxy","dataReaderProvider","displayNameService","featureSwitchService","localizationService","telemetryService","insightsService","inFocusService"]}},t.prototype.showInsights=function(t,n,r){var s=this;this.scope.noInsightsFound=!1,this.scope.numberOfInsightsText="";var o=this.createDataSource(this.scope.viewModel.contract.model);this.scope.viewModel.dataSources=e.explore.contracts.createDataSourceArray([o]),t&&(this.services.insightsService.removeInsights(this.scope.viewModel.contract.model,n),this.insightsResult=null);var a=this.services.telemetryService.startEvent(e.telemetry.InsightsShowInsights,0,this.scope.viewModel.entryPoint,this.scope.viewModel.contract.model.contentProviderId,e.getHashCode(this.scope.viewModel.contract.model.dbName),!1);this.services.insightsService.getInsights(!1,i.services.RequestType.Initial,this.scope.viewModel.contract.model,this.scope.viewModel.entryPoint,i.proxies.wireContracts.RequestOptions.ThoroughMode,a.event,n,r,null,null,t).then((function(i){s.insightsResult=i;var t=s.insightsResult.insightsContainers;s.scope.viewModel.insightContainers=t;var n=t?t.length:0;s.scope.noInsightsFound=n<=0,s.scope.numberOfInsightsText="Number of insights found: "+n,a.event.info.insightCount=n,s.showInsightsEvent=a.event,s.insightsResult.isError&&n<=0?a.reject():a.resolve(),s.insightsResult.fromCache||s.services.rootScope.$emit(e.insights.constants.insightsLoadedEventName,s.scope.viewModel.contract.model,!s.scope.noInsightsFound)}))},t.prototype.canShowInsights=function(){return this.insightsResult&&2===this.insightsResult.status},t.prototype.showInFocusMode=function(t,n){var r=this;if(n.stopPropagation(),this.scope.viewModel.insightContainers){var s=this.scope.viewModel.insightContainers[t];this.services.insightsService.getPinDataForInsight(this.scope.viewModel.contract.model,s,(function(n){r.services.telemetryService.logChildEvent(r.showInsightsEvent,e.telemetry.InsightsViewInsightInFocus,t,s.visual.type,i.contracts.InsightType[s.contract.insight.Type],null,null,null,null,s.source);var o={showInsightsEvent:r.showInsightsEvent,insightContainerModel:s,canPin:!0};r.services.rootScope.$emit(i.constants.viewInsightInFocus,n,o)}))}},t.prototype.pinInsight=function(t,n){var r=this;if(n.stopPropagation(),this.scope.viewModel.insightContainers){var s=this.scope.viewModel.insightContainers[t];this.services.insightsService.getPinDataForInsight(this.scope.viewModel.contract.model,s,(function(n){r.services.telemetryService.logChildEvent(r.showInsightsEvent,e.telemetry.InsightsPinInsight,t,s.visual.type,i.contracts.InsightType[s.contract.insight.Type],e.telemetry.PinInsightEntryPoint.ShowInsightsCard,s.source,null),r.services.rootScope.$emit(i.constants.pinInsightContainer,n,!0)}))}},t.prototype.reloadInsights=function(t){var n=this.scope.numberOfInsightsRequested,r=this.scope.timeoutInSec,s=""===n||isNaN(n)||t?null:parseInt(n,10),o=""===r||isNaN(r)||t?null:1e3*parseInt(r,10);this.scope.viewModel=i.models.ViewModelFactory.createInsightCanvasModel(this.scope.viewModel.contract),this.scope.viewModel=this.scope.viewModel,this.scope.viewModel.entryPoint=e.telemetry.InsightEntryPoint.ReloadButton,this.showInsights(!0,s,o)},t.prototype.createDataSource=function(e){return{type:"dsr",id:e.id,name:void 0,dsr:{schemaName:void 0,vsName:e.vsName,dbName:e.dbName,modelId:e.id}}},t.prototype.getModel=function(){return this.scope.viewModel},t})();t.InsightsCanvasController=r})(t=i.controllers||(i.controllers={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(t){var n;!(function(n){var r=e.data.services.SemanticQuerySerializer,s=(function(){function n(e,i){var n=this;this.scope=e,this.services=i,this.scope.viewModel=t.models.ViewModelFactory.createInsightPaneModel(),this.scope.selectInsight=function(e,i){return n.selectInsight(e,i)},this.scope.pinInsight=function(e,i){return n.pinInsight(e,i)},this.scope.addReferenceLineAndSelect=function(e,i){return n.addReferenceLineAndSelect(e,i)},this.scope.closePane=function(){return n.closePane()};var r=this.scope.$on(t.constants.clearInsightSelectionEvent,(function(e){n.clearInsightSelection()})),s=this.scope.$on(t.constants.getRelatedInsightsEvent,(function(e){n.services.$timeout((function(){n.getInsightsForSelection()}))})),o=this.scope.$watch("visual()",(function(){n.getSummary()}));this.scope.$on("$destroy",(function(){r(),s(),o()})),this.getInsightsForSelection()}return n.createOptions=function(){return{scopedServiceRoot:!1,scopedDependencies:["visualPlugin","visualAuthoring"],scopedProviderInstanceName:t.constants.scopedInstanceProviderName,additionalServices:["insightsService","summaryInsightsService","localizationService","telemetryService","promiseFactory","dataProxy","dataReaderProvider","featureSwitchService","$timeout"]}},n.prototype.closePane=function(){this.scope.$emit(t.constants.insightClosePaneEvent)},n.prototype.clearInsightSelection=function(){if(null!=this.scope.viewModel.selectedInsightId){var e=this.getInsightContainer(this.scope.viewModel.selectedInsightId);e&&(e.isSelected=!1),this.scope.viewModel.selectedInsightId=null}},n.prototype.selectInsight=function(e,i){e.stopPropagation(),this.resetFactSelection(),this.scope.viewModel.selectedInsightId=i;var n=this.getInsightContainer(i);n&&(n.isSelected=!0),this.scope.$emit(t.constants.insightSelectedEvent,{model:this.scope.model(),insightContainerModel:n,showInsightsEvent:this.scope.viewModel.insights.showInsightsEvent,rerunInsights:!0}),this.logVisualSelection(i)},n.prototype.pinInsight=function(n,r){var s=this;n.stopPropagation();var o=this.getInsightContainer(r);this.services.insightsService.getPinDataForInsight(this.scope.model(),o,(function(n){s.services.telemetryService.logChildEvent(s.scope.viewModel.insights.showInsightsEvent,e.telemetry.InsightsPinInsight,r,o.visual.type,i.contracts.InsightType[o.contract.insight.Type],e.telemetry.PinInsightEntryPoint.ShowInsightsCard,o.source,o.contract.relevance.Score),s.services.rootScope.$emit(t.constants.pinInsightContainer,n,!0)}))},n.prototype.getInsightsForSelection=function(){this.scope.viewModel.isLoading&&null===this.scope.viewModel.selectedInsightId||(this.scope.viewModel.isLoading=!0,this.getSummary(),this.getRelatedInsights())},n.prototype.getRelatedInsights=function(){var i=this,n=this.scope.visualContract(),r=this.scope.visual();this.scope.viewModel.insights=null,this.scope.viewModel.visualTitle=this.scope.visualTitle(),this.scope.viewModel.selectedInsightId=null;var s=[];if(n&&r){this.originalQueryFilters=this.services.insightsService.getFiltersFromQuery(n);var o=this.services.insightsService.getFiltersFromSelection(this.scope.explorationContract());this.originalHighlightFilters=_.isEmpty(o)?this.services.insightsService.getHighlightFiltersFromVisual(r):o,s=this.originalQueryFilters.concat(this.originalHighlightFilters),this.originalVisualColumns=n.config.singleVisual.query.defn.select()}var a,l=this.scope.tileAction&&this.scope.tileAction()===e.common.constants.openInsightsActionName;a=this.scope.parentEvent()?this.services.telemetryService.startChildEvent(this.scope.parentEvent(),e.telemetry.InsightsShowInsights,0,this.services.insightsService.getScopedInsightsSource(),this.scope.model().contentProviderId,e.getHashCode(this.scope.model().dbName),!0):this.services.telemetryService.startEvent(e.telemetry.InsightsShowInsights,0,this.services.insightsService.getScopedInsightsSource(),this.scope.model().contentProviderId,e.getHashCode(this.scope.model().dbName),!0);var c=[this.getRelatedInsightsDeferred(n,s,t.proxies.wireContracts.RequestOptions.ThoroughMode,l,a.event)];this.services.featureSwitchService.featureSwitches.insightsStoreEnabled&&c.push(this.getRelatedInsightsDeferred(n,s,t.proxies.wireContracts.RequestOptions.QuickMode,l,a.event));var u=!1;setTimeout((function(){u||(i.services.telemetryService.logEvent(e.telemetry.InsightsNoResponse),i.insightsLoaded(n))}),t.constants.syncServiceWaitTimeout),this.services.promiseFactory.all(c).then((function(e){u=!0,i.insightsLoaded(n);var t=e[0],r=e[1],s=t.insightsContainers?t.insightsContainers.length:0,o=r.insightsContainers?r.insightsContainers.length:0,l=s+o;a.event.info.insightCount=l,l<=0&&(t.isError||r.isError)?a.reject():a.resolve();var c=i.services.insightsService.getNumberOfColumns(n);a&&a.event&&i.logInputVisualFeatures(a.event,i.originalQueryFilters,i.originalHighlightFilters,c)}))},n.prototype.getRelatedInsightsDeferred=function(e,i,n,r,s){var o=this,a=this.services.promiseFactory.defer(),l=n===t.proxies.wireContracts.RequestOptions.ThoroughMode?t.constants.relatedInsightsNumberOfRequestedInsights:t.constants.relatedQuickModeInsightsNumberOfRequestedInsights,c=this.services.insightsService.getInsights(!1,t.services.RequestType.Initial,this.scope.model(),this.services.insightsService.getScopedInsightsSource(),n,s,l,t.constants.relatedInsightsTimeoutInMs,null,this.getQueryDefinition(e,i),!0);return c&&c.then((function(t){if(t.insightsContainers){var n=0;if(e&&r&&(n=o.dedupeOriginalInsight(e.config.singleVisual.visualType,i,t)),t.insightsContainers.length-n>=l){var s=_.min(t.insightsContainers,(function(e){return e.contract.relevance.Score}));s&&(s.isVisible=!1)}if(o.scope.viewModel.insights){var c=o.scope.viewModel.insights.insightsContainers,u=[];u=u.concat(o.scope.viewModel.insights.insightsContainers);for(var d=0,g=t.insightsContainers;d<g.length;d++){var v=g[d],h=_.find(c,(function(e){return e.contract.insight.Description===v.contract.insight.Description}));h||(v.contract.id=u.length,u.push(v))}u=_.sortBy(u,(function(e){return e.contract.relevance.Score})).reverse(),o.scope.viewModel.insights.insightsContainers=u}else o.scope.viewModel.insights=t}a.resolve(t)})),a.promise},n.prototype.insightsLoaded=function(e){this.scope.viewModel.isLoading=!1},n.prototype.dedupeOriginalInsight=function(i,t,n){for(var s=0,o=0,a=n.insightsContainers;o<a.length;o++){var l=a[o];if(i===e.infonav.utils.visualUtil.getPlugin(l.contract.insight.VisualConfiguration.VisualizationType).name){for(var c=this.services.insightsService.getFiltersFromHighlights(l.contract.config.singleVisual.objects),u=r.deserializeQuery(l.contract.insight.VisualConfiguration.QueryCommand.Query),d=0,g=u.where();d<g.length;d++){var v=g[d];c.push(new e.data.SemanticFilter(u.from(),[v]))}if(this.areSameFilters(c,t)&&this.areSameColumns(u.select(),this.originalVisualColumns)){1===n.insightsContainers.length?n.insightsContainers=[]:(s++,l.isVisible=!1);break}}}return s},n.prototype.areSameFilters=function(i,t){if(i.length!==t.length)return!1;for(var n=0,r=i;n<r.length;n++){var s=r[n];if(!_.filter(t,(function(i){return e.data.SemanticFilter.isSameFilter(s,i)})))return!1}return!0},n.prototype.areSameColumns=function(i,t){if(i.length!==t.length)return!1;for(var n=0,r=i;n<r.length;n++){var s=r[n];if(!_.filter(t,(function(i){return s.name===i.name&&e.data.SQExpr.equals(s.expr,i.expr)})))return!1}return!0},n.prototype.getQueryDefinition=function(e,i){if(e){var t=e.config.singleVisual.query.defn;if(t){for(var n=0,s=i;n<s.length;n++){var o=s[n];t=t.addSemanticFilter(o)}return r.serializeQuery(t)}}return null},n.prototype.logInputVisualFeatures=function(i,t,n,r){var s=this.scope.tileAction();this.services.telemetryService.logChildEvent(i,e.telemetry.InsightsScopedInputVisualFeatures,s,r,t?t.length:0,n?n.length:0)},n.prototype.logVisualSelection=function(t){for(var n=this.getInsightContainer(t),s=this.services.insightsService.getFiltersFromHighlights(n.contract.config.singleVisual.objects),o=r.deserializeQuery(n.contract.insight.VisualConfiguration.QueryCommand.Query),a=0,l=o.where();a<l.length;a++){var c=l[a];s.push(new e.data.SemanticFilter(o.from(),[c]))}for(var u=0,d=0,g=this.originalQueryFilters;d<g.length;d++)for(var v=g[d],h=0,p=s;h<p.length;h++){var y=p[h];e.data.SemanticFilter.isSameFilter(v,y)&&u++}for(var m=0,f=0,I=this.originalHighlightFilters;f<I.length;f++)for(var S=I[f],C=0,b=s;C<b.length;C++){var y=b[C];e.data.SemanticFilter.isSameFilter(S,y)&&m++}for(var w=0,M=0,E=o.select();M<E.length;M++)for(var F=E[M],T=0,P=this.originalVisualColumns;T<P.length;T++){var D=P[T];F.name===D.name&&e.data.SQExpr.equals(F.expr,D.expr)&&w++}this.services.telemetryService.logChildEvent(this.scope.viewModel.insights.showInsightsEvent,e.telemetry.InsightsViewInsightInFocus,t,n.visual.type,i.contracts.InsightType[n.contract.insight.Type],w,m,u,n.contract.relevance.Score,n.source)},n.prototype.getSummary=function(){var e=this,i=this.services.summaryInsightsService.getSummary(this.scope.visualContract(),this.scope.model(),this.scope.visual(),this.scope.parentEvent());i&&i.then((function(i){e.scope.viewModel.summaryInsights=i}))},n.prototype.addReferenceLineAndSelect=function(i,t){var n=_.find(this.scope.viewModel.summaryInsights.summaryInsightsCards[i].facts,(function(e){return e.type===t})),r=this.scope.visual();if(n){if(n.isSelected)n.isSelected=!1,this.services.summaryInsightsService.removeAnnotationsFromVisualContract(this.scope.visualContract(),this.scope.explorationContract());else if(n.isSelectable){var s=this.scope.viewModel.insights?this.scope.viewModel.insights.insightsContainers.length>0?e.telemetry.InsightState.ReadyWithInsightsLoaded:e.telemetry.InsightState.ReadyWithoutInsightsLoaded:e.telemetry.InsightState.Loading,o=r.type;this.services.telemetryService.logChildEvent(this.scope.viewModel.summaryInsights.showSummaryInsightsEvent,e.telemetry.InsightsInteraction,t,i,s,o),this.resetFactSelection(),n.isSelected=!0,this.services.summaryInsightsService.updateVisualContractWithAnnotations(this.scope.visualContract(),n.value,r,this.scope.explorationContract())}this.services.visualAuthoring.raiseVisualContainerChanged(this.scope.visualContract())}},n.prototype.resetFactSelection=function(){for(var e=0,i=this.scope.viewModel.summaryInsights.summaryInsightsCards;e<i.length;e++)for(var t=i[e],n=0,r=t.facts;n<r.length;n++){var s=r[n];s.isSelected=!1}},n.prototype.getInsightContainer=function(e){return _.find(this.scope.viewModel.insights.insightsContainers,(function(i){return i.contract.id===e}))},n.prototype.getInsightCount=function(){return this.scope.viewModel.insights.insightsContainers.length},n})();n.InsightsPaneController=s})(n=t.controllers||(t.controllers={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){var t;!(function(t){var n=(function(){function t(){this.restrict="E",this.replace=!0,this.templateUrl="views/insightsPane.html",this.scope={model:"&",visualContract:"&",explorationContract:"&",tileAction:"&?",visualTitle:"&",visual:"&",parentEvent:"&"},this.controller=e.common.createController(i.controllers.InsightsPaneController),this.link=function(e,t,n){function r(){o(a)&&setTimeout((function(){var n=s(e.viewModel.selectedInsightId,null);if(n){var r=t.find(i.constants.paneSelector);r.animate({scrollTop:r.scrollTop()+n.offset-a.offset},500)}}),i.constants.waitForDOMUpdateInMs)}function s(n,r){for(var s,o,a=t.find(i.constants.cardSelector),l=0;l<a.length;l++){var c=a.eq(l),u=angular.element(c).scope();if(u&&u.insight.contract.id===n){o=l,s=c;break}}if(s){var d=t.find(i.constants.paneSelector).scrollTop()+s.position().top;if(null!=r){var g=_.findIndex(e.viewModel.insights.insightsContainers,(function(e){return e.contract.id===r}));o>g&&(d-=i.constants.getRelatedInsightsLinkHeight)}return{insightCard:s,offset:d}}return null}function o(e){var n=t.find(i.constants.paneSelector),r=n.scrollTop(),s=r+n.height(),o=e.offset,a=o+e.insightCard.height();return o>r&&o<s||a>r&&a<s}var a;e.$watch((function(){return e.viewModel.selectedInsightId}),(function(e,i){a=null!=e?s(e,i):null})),e.$watch((function(){return t.find(i.constants.cardSelector).length}),(function(i,t){t>0&&t!==i&&null!=e.viewModel.selectedInsightId&&r()}))}}return t})();t.InsightsPane=n})(t=i.directives||(i.directives={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={})),powerbi.insights.registerInsightsDirective("InsightsPane",[]);var powerbi;!(function(e){var i;!(function(e){var i;!(function(e){var i=(function(){function e(){this.restrict="E",this.replace=!0,this.templateUrl="views/insightContainer.html",this.scope={viewModel:"="}}return e})();e.InsightContainer=i})(i=e.directives||(e.directives={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={})),powerbi.insights.registerInsightsDirective("InsightContainer",[]);var powerbi;!(function(e){var i;!(function(i){var t;!(function(t){var n=(function(){function t(){this.restrict="E",this.templateUrl="views/insightsCanvas.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(i.controllers.InsightsCanvasController)}return t})();t.InsightsCanvas=n})(t=i.directives||(i.directives={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={})),powerbi.insights.registerInsightsDirective("InsightsCanvas",[]);var powerbi;!(function(e){var i;!(function(e){var i;!(function(e){var i=(function(){function e(){this.restrict="E",this.replace=!0,this.templateUrl="views/insightCard.html",this.scope={viewModel:"="}}return e})();e.InsightCard=i})(i=e.directives||(e.directives={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={})),powerbi.insights.registerInsightsDirective("InsightCard",[]);var powerbi;!(function(e){var i;!(function(e){var i;!(function(e){var i=(function(){function e(){this.restrict="E",this.replace=!0,this.templateUrl="views/summaryInsightCard.html",this.scope={viewModel:"="}}return e})();e.SummaryInsightCard=i})(i=e.directives||(e.directives={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={})),powerbi.insights.registerInsightsDirective("SummaryInsightCard",[]);var powerbi;!(function(e){var i;!(function(e){var i;!(function(e){e.numberOfInsightsRequested=40,e.timeoutInMs=16e3,e.viewportWidth=320,e.viewportHeight=220,e.insightsLoadedEventName="insightsLoaded",e.maxCachedInsights=10,e.viewInsightInFocus="viewInsightInFocus",e.pinInsightContainer="pinInsightContainer",e.scopedInstanceProviderName="insights",e.minimumCachedInsights=3,e.visualRenderingTimeoutMs=5e3,e.timeoutMultiplier=1.5,e.insightsUrlParams="insightsSource",e.insightsSourceDesktop="Desktop",e.insightsSourceNavigationPane="Dashboard",e.insightsSourceToast="Toast",e.insightsSourceInFocus="InFocusMode",e.insightsSourceReportTile="ReportTile",e.clearInsightSelectionEvent="clearInsightSelection",e.getRelatedInsightsEvent="getRelatedInsights",e.insightClosePaneEvent="insightClosePane",e.insightSelectedEvent="insightSelected",e.insightsOnSelectionEvent="insightsOnSelectionEvent",e.maxHighlightFilters=5,e.relatedInsightsNumberOfRequestedInsights=11,e.relatedQuickModeInsightsNumberOfRequestedInsights=6,e.relatedInsightsTimeoutInMs=8e3,e.relatedInsightsViewportHeight=180,e.relatedInsightsViewportWidth=330,e.syncServiceWaitTimeout=6e4,e.getRelatedInsightsLinkHeight=26,e.waitForDOMUpdateInMs=500,e.paneSelector=".content",e.cardSelector=".insightCard",e.aggregateKindEnum=3,e.subtotalKindEnum=1,e.scatterChartVisualName="scatterChart",e.tableVisualName="table",e.matrixVisualName="matrix",e.referenceLinePropertyName="y1AxisReferenceLine",e.waterfallVisualName="waterfallChart",e.zeroInsightsLink="https://go.microsoft.com/fwlink/?LinkId=692069",e.subsetDataSearchedLink="https://go.microsoft.com/fwlink/?LinkId=692068"})(i=e.constants||(e.constants={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){var t;!(function(t){var n;!(function(t){function n(){return{visualTitle:"",insights:void 0,isLoading:!1,message:"",summaryInsights:void 0,insightsExpanded:!0,summaryExpanded:!0,selectedInsightId:null}}function r(i,t,n,r,o,a,l){return{id:i,measureName:t,facts:[s(e.telemetry.SummaryFactType.Min,o,a,l.get("SummaryInsights_Min"),!0),s(e.telemetry.SummaryFactType.Max,r,a,l.get("SummaryInsights_Max"),!0),s(e.telemetry.SummaryFactType.All,n,a,l.get("SummaryInsights_All"),!1)]}}function s(i,t,n,r,s){return{type:i,formattedValue:e.visuals.valueFormatter.format(t,n),value:t,caption:r,isSelectable:s,isSelected:!1}}function o(i){return{contract:i,dataSources:void 0,insightContainers:[],entryPoint:e.telemetry.InsightEntryPoint.DirectNavigation}}function a(t,n,r){return{contract:t,title:t.config.singleVisual.title,subtitle:t.config.singleVisual.subtitle,visual:null,isLoading:!0,isSelected:!1,isVisible:!0,insightGroup:i.utils.getInsightGroupText(t.insight.Type,n),dataViewSource:void 0,source:r===i.proxies.wireContracts.RequestOptions.QuickMode?e.telemetry.InsightSource.ServiceQuickMode:e.telemetry.InsightSource.ServiceThoroughMode}}function l(t,n){if(t.dataViewSource=n?n.dataViewSource:null,t.isLoading=!1,t.contract.insight.Type===i.contracts.InsightType.LowVariance){var r=t.visual.dataTransforms.objects,s=n.dataReaderResult.dataView.categorical;if(r&&s&&s.values[0]){var o=s.values[0].minLocal>=0&&s.values[0].maxLocal>=0;o?r.valueAxis=[{properties:{start:e.data.SQExprBuilder.integer(0)}}]:r.valueAxis=[{properties:{end:e.data.SQExprBuilder.integer(0)}}]}}}t.createInsightPaneModel=n,t.createSummaryInsightCardModel=r,t.createSummaryFactModel=s,t.createInsightCanvasModel=o,t.createInsightContainerModel=a,t.updateInsightContainerVisual=l})(n=t.ViewModelFactory||(t.ViewModelFactory={}))})(t=i.models||(i.models={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){var t;!(function(t){function n(e,i,t,n){return new a(e,i,t,n)}var r,s=jsCommon.EnumExtensions,o=e.insights.contracts.InsightsWarnings;!(function(e){var i;!(function(e){e[e.ThoroughMode=0]="ThoroughMode",e[e.QuickMode=1]="QuickMode"})(i=e.RequestOptions||(e.RequestOptions={}))})(r=t.wireContracts||(t.wireContracts={})),t.createInsightsService=n;var a=(function(){function t(e,i,t,n){this.httpService=e,this.promiseFactory=i,this.featureSwitchService=n,this.pendingInsightsRequests={},t.addInsightsListener(this)}return t.prototype.deriveInsights=function(e,i,t,n,r,s,o){return this.featureSwitchService.featureSwitches.insightsSyncServiceEnabled?this.deriveInsightsAsync(e,i,t,n,r,s,o):this.deriveInsightsSync(e,i,t,n,r,s,o)},t.prototype.deriveInsightsSync=function(n,r,s,o,a,l,c){var u=this,d=this.promiseFactory.defer(),g=null;(l||c)&&(g={TopicQuery:l,InsightType:c});var v={VirtualServerName:n.virtualServerName,DatabaseName:n.databaseName,RequestedInsights:null==o?i.constants.numberOfInsightsRequested:o,TimeoutInMS:null==a?i.constants.timeoutInMs:a,Scope:g,Options:r};return this.httpService.post(t._deriveInsightEndPointUrl,v,e.common.httpService.powerbiRequestOptions()).then((function(e){if(0===e.data.Insights.length){var i=u.getMostFatalErrorCode(e.data.Warnings);i?s.reject({errorCode:i}):s.resolve(),d.reject({RequestId:e.requestId,Warnings:e.data.Warnings})}else d.resolve(u.CreateInsightContainers(e.data))}),(function(e){var i=u.getErrorCode(e);s.reject({errorCode:i}),d.reject({ErrorCode:i,RequestId:e.requestId,Warnings:null})})),d.promise},t.prototype.deriveInsightsAsync=function(n,r,s,o,a,l,c){var u=this,d=this.promiseFactory.defer(),g=null;(l||c)&&(g={TopicQuery:l,InsightType:c});var v={DatabaseName:n.databaseName,RequestedInsights:o?o:i.constants.numberOfInsightsRequested,TimeoutInMS:a?a:i.constants.timeoutInMs,VirtualServerName:n.virtualServerName,Scope:g,ModelId:n.modelId,Options:r};return this.httpService.post(t._deriveInsightAsyncEndPointUrl,v,e.common.httpService.powerbiRequestOptions()).then((function(e){u.pendingInsightsRequests[e.data.JobId]={deferredPromise:d,getInsightsEvent:s}}),(function(e){var i=u.getErrorCode(e);s.reject({errorCode:i}),d.reject({ErrorCode:i,RequestId:e.requestId,Warnings:null})})),d.promise},t.prototype.onInsightsAvailable=function(i){var n=this,r=t._deriveInsightAsyncEndPointUrl+"/"+i+"/results",s=this.pendingInsightsRequests[i];this.httpService.get(r,e.common.httpService.powerbiRequestOptions()).then((function(e){if(0===e.data.Results.Insights.length&&s){var i=n.getMostFatalErrorCode(e.data.Results.Warnings);i?s.getInsightsEvent.reject({errorCode:i}):s.getInsightsEvent.resolve(),s.deferredPromise.reject({RequestId:e.requestId,Warnings:e.data.Results.Warnings})}else s&&s.deferredPromise.resolve(n.CreateInsightContainers(e.data.Results))}),(function(e){if(s){var i=n.getErrorCode(e);s.getInsightsEvent.reject({errorCode:i}),s.deferredPromise.reject({ErrorCode:i,RequestId:e.requestId,Warnings:null})}}))},t.prototype.getErrorCode=function(e){var i=void 0;return e&&(e.error?i=e.error.code:e.status&&(i=e.status.toString())),i},t.prototype.getMostFatalErrorCode=function(e){var i;return this.shouldCheckFatalWarnings&&(s.hasFlag(e,o.InvalidModel)?i=o[o.InvalidModel]:s.hasFlag(e,o.ModelUnavailable)?i=o[o.ModelUnavailable]:s.hasFlag(e,o.InsightsServiceException)?i=o[o.InsightsServiceException]:s.hasFlag(e,o.CacheException)?i=o[o.CacheException]:s.hasFlag(e,o.ConnectionPoolTimeoutExceeded)?i=o[o.ConnectionPoolTimeoutExceeded]:s.hasFlag(e,o.IN4DataMinerException)&&(i=o[o.IN4DataMinerException])),i},t.prototype.shouldCheckFatalWarnings=function(e){return!(s.hasFlag(e,o.NoMeasures)||s.hasFlag(e,o.NoDimensions)||s.hasFlag(e,o.NoFilteredComponents))},t.prototype.CreateInsightContainers=function(e){for(var i=[],t=0;t<e.Insights.length;t++)i.push({Insight:e.Insights[t],Relevance:e.Relevances?e.Relevances[t]:void 0});return i},t})();a._deriveInsightEndPointUrl="insights/derive",a._deriveInsightAsyncEndPointUrl="insights/derive/queue"})(t=i.proxies||(i.proxies={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){var t;!(function(t){function n(e,i,t,n){return new d(e,i,t,n)}var r=jsCommon.Color,s=e.common.utils.ColorUtility,o=e.formattingService,a=i.contracts.InsightType,l=i.contracts.IntervalUnit,c=e.data.services.SemanticQuerySerializer,u=e.explore.contracts.VisualQuery;t.createInsightContainerFactory=n;
var d=(function(){function i(e,i,t,n){this.visualPlugin=e,this.displayNameService=i,this.localizationService=t,this.themeService=n,this.insightFeatureVisitor=new g(this.localizationService)}return i.prototype.createInsightContainer=function(i,t,n){var r=i.Insight,s=c.deserializeQuery(r.VisualConfiguration.QueryCommand.Query),o=e.explore.infonav.util.QueryProjectionBuilderUtils.createProjectionBuilder(r.VisualConfiguration.VisualizationType,s,n).build(r.VisualConfiguration.QueryCommand.Binding),l=this.themeService.getColors("Insights"),d={visualType:e.infonav.utils.visualUtil.getPlugin(r.VisualConfiguration.VisualizationType).name,query:new u(s,o),title:void 0,subtitle:void 0,objects:{dataPoint:this.generateHighlight(r,l)}};if(this.isCategoricalVisual(r)&&(d.objects.categoryAxis=[{properties:{axisType:e.data.SQExprBuilder.text("Categorical")}}]),this.isTrendVisual(r)){var g=l[2].value;d.objects.trend=[{properties:{show:e.data.SQExprBuilder.boolean(!0),style:e.data.SQExprBuilder.text("solid")}}],d.objects.dataPoint.push({selector:{metadata:e.data.DataViewRegression.regressionYQueryName},properties:{fill:{solid:{color:e.data.SQExprBuilder.text(g)}}}})}this.isLegendVisual(r)&&(d.objects.legend=[{properties:{show:e.data.SQExprBuilder.boolean(!0),position:e.data.SQExprBuilder.text("RightCenter")}}]),r.Type===a.ClusterAndOutlier&&(d.objects.fillPoint=[{properties:{show:e.data.SQExprBuilder.boolean(!0)}}]);var v=this.visualPlugin.capabilities(d.visualType),h=this.displayNameService.getVisualTitle(d,n,v);return d.title=h.titleComponents.title,d.subtitle=h.titleComponents.subtitle,{id:t,config:{singleVisual:d},insight:r,details:this.getInsightDetails(r.Features,this.insightFeatureVisitor),relevance:i.Relevance}},i.prototype.getInsightDetails=function(e,i){if(!_.isEmpty(e)){for(var t=[],n=0,r=e;n<r.length;n++){var s=r[n];t.push(i.visit(s))}return t}return null},i.prototype.isCategoricalVisual=function(e){return 7===e.VisualConfiguration.VisualizationType||10===e.VisualConfiguration.VisualizationType||9===e.VisualConfiguration.VisualizationType||12===e.VisualConfiguration.VisualizationType||8===e.VisualConfiguration.VisualizationType||11===e.VisualConfiguration.VisualizationType},i.prototype.isLegendVisual=function(e){return 5===e.VisualConfiguration.VisualizationType||20===e.VisualConfiguration.VisualizationType||12===e.VisualConfiguration.VisualizationType},i.prototype.isTrendVisual=function(e){return e.Type===a.Trend||e.Type===a.CrossMeasureCorrelation},i.prototype.generateHighlight=function(i,t){var n,r=this,s=i.VisualConfiguration.QueryCommand.Binding.Highlights;if(!_.isEmpty(s)){var o=c.deserializeFilter(s[0]);n=o?o.where():null}var l=!_.isEmpty(n),u=i.Type===a.ClusterAndOutlier?t[10].value:t[this.getInsightColorIndex(i.Type)].value,d=this.getDefaultColor(i.Type,u,l),g=[],v={selector:null,properties:{defaultColor:{solid:{color:e.data.SQExprBuilder.text(d)}}}};if(g.push(v),l){var h=_.map(n,(function(e){return r.flattenComparisons(e.condition)}));h=_.sortBy(h,(function(e){return e.length})).reverse();for(var p=this.getHighlightColors(i.Type,u,t,h),y=0;y<h.length;y++)for(var m=h[y],f=m.length,I=0;I<f;I++){var S={selector:{data:[e.data.createDataViewScopeIdentity(m[I])]},properties:{fill:{solid:{color:e.data.SQExprBuilder.text(p[y])}}}};g.push(S)}}return g},i.prototype.flattenComparisons=function(i){if(!i)return[];if(i instanceof e.data.SQOrExpr){var t=i;return this.flattenComparisons(t.left).concat(this.flattenComparisons(t.right))}if(i instanceof e.data.SQInExpr){var n=i;if(1===n.args.length){for(var r=[],s=0,o=n.values;s<o.length;s++){var a=o[s];if(1!==a.length)return[i];r.push(e.data.SQExprBuilder.compare(0,n.args[0],a[0]))}return r}}return[i]},i.prototype.getInsightColorIndex=function(e){switch(e){case a.Attribution:return 0;case a.LowVariance:return 3;case a.CrossMeasureCorrelation:case a.ClusterAndOutlier:return 1;case a.Outlier:return 7;case a.ChangePoint:return 6;case a.ComplexTimeSeries:case a.Trend:case a.Seasonality:return 5;case a.Correlation:return 9;case a.OutstandingFirst:case a.OutstandingLast:case a.OutstandingTop2:return 8;default:return 0}},i.prototype.getDefaultColor=function(e,i,t){if(e===a.ClusterAndOutlier||!t)return i;var n=s.getShadePctSequence(i);return r.shadeColor(i,n[1])},i.prototype.getHighlightColors=function(e,i,t,n){var r=[];if(_.isEmpty(n))return r;if(e===a.ClusterAndOutlier)for(var s=[t[11].value,t[12].value,t[13].value,t[14].value],o=0,l=0;l<n.length;l++)1===n[l].length?r.push(t[2].value):(r.push(s[o%s.length]),o++);else for(var l=0;l<n.length;l++)r.push(i);return r},i})(),g=(function(e){function i(i){var t=e.call(this)||this;return t.localizationService=i,t}return __extends(i,e),i.prototype.visitAttribution=function(e){return this.localizationService.format(this.localizationService.get("Insights_AttributionDetails"),this.formatNumber(100*e.Percentage))},i.prototype.visitChildCorrelation=function(e){return this.localizationService.format(this.localizationService.get("Insights_ChildCorrelationDetails"),this.formatNumber(100*e.PercentOfTotal))},i.prototype.visitCrossMeasureCorrelation=function(e){return this.localizationService.format(this.localizationService.get("Insights_CrossMeasureCorrelationDetails"),this.formatNumber(e.CorrelationFactor))},i.prototype.visitSeasonality=function(e){return this.localizationService.format(this.localizationService.get("Insights_SeasonalityDetails"),this.formatNumber(e.Period),this.getIntervalUnitText(e.PeriodUnit,1===e.Period,e.Dimension.DisplayName))},i.prototype.visitTrend=function(e){return this.localizationService.format(e.Slope<0?this.localizationService.get("Insights_TrendDecreasingDetails"):this.localizationService.get("Insights_TrendIncreasingDetails"),this.formatNumber(100*e.Slope),this.getIntervalUnitText(e.SlopeInterval,!0,e.Dimension.DisplayName))},i.prototype.formatNumber=function(e){return o.formatValue(e,Math.floor(e)===e?"F0":"F1")},i.prototype.getIntervalUnitText=function(e,i,t){if(e===l.Ordinal)return t;var n="Insights_";return n+=l[e],n+=i?"Singular":"Plural",this.localizationService.get(n)},i})(i.contracts.InsightFeatureVisitor);t.InsightFeatureDetailsVisitor=g})(t=i.services||(i.services={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(e){var i;!(function(i){function t(){return new n}i.createInsightsCacheService=t;var n=(function(){function i(){this.insightsCache=[]}return i.prototype.getInsights=function(e,i,t){var n=this.removeInsights(e,t);return n&&!this.isExpired(n,i)?(this.insightsCache.push(n),n):null},i.prototype.setInsights=function(i,t,n){var r=this.getKey(i,n),s=this.removeInsights(i,n);return null!==s?s.insightsContainers=[]:(this.insightsCache.splice(0,this.insightsCache.length-e.constants.maxCachedInsights+1),s={key:r,showInsightsEvent:t,insertTimestamp:new Date,status:1}),this.insightsCache.push(s),s},i.prototype.removeInsights=function(e,i){var t=this.getKey(e,i),n=_.remove(this.insightsCache,(function(e){return e.key===t}));return n.length>0?n[0]:null},i.prototype.getKey=function(e,i){var t=JSON.stringify(e);return t+=null!=i?i:""},i.prototype.isExpired=function(e,i){return e.insertTimestamp&&e.insertTimestamp.getTime()<=i},i})()})(i=e.services||(e.services={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){var t;!(function(t){function n(e,i,t,n,r,s,o,a,l,u,d,g,v,h,p,y,m,f){return new c(e,i,t,n,r,s,o,a,l,u,d,g,v,h,p,y,m,f)}var r,s=e.explore.services.createVisualQueryGenerator,o=jsCommon.EnumExtensions,a=e.insights.contracts.InsightsWarnings,l=e.common.helpers.ModelConverterHelper;!(function(e){e[e.Initial=0]="Initial",e[e.FailedRetry=1]="FailedRetry",e[e.InsufficientInsightsRetry=2]="InsufficientInsightsRetry"})(r=t.RequestType||(t.RequestType={})),t.createInsightsService=n;var c=(function(){function n(i,t,n,r,o,a,l,c,u,d,g,v,h,p,y,m,f,I){this.conceptualSchemaProxy=i,this.dataProxy=t,this.displayNameService=r,this.featureSwitchService=o,this.insightsCacheService=a,this.insightsProxy=l,this.localizationService=c,this.telemetryService=u,this.visualHostService=d,this.visualPlugin=g,this.notificationToastService=h,this.errorService=p,this.themeService=y,this.promiseFactory=I,this.sortService=e.explore.services.createSortService(this.displayNameService,this.featureSwitchService,this.visualPlugin),this.visualQueryGenerator=s({dataReaders:n,displayNameService:this.displayNameService,plugin:this.visualPlugin,pluginOps:v,sortService:this.sortService,featureSwitchService:this.featureSwitchService,aggrOps:m,filterGenerator:f,transformPluginService:e.data.transforms.createTransformPluginService(),telemetryService:this.telemetryService})}return n.prototype.getInsightsStatus=function(e,i){var t={databaseName:e.dbName,virtualServerName:e.vsName,modelId:e.id},n=l.convertRefreshTimeToJsDateTime(e.lastRefreshTime),r=n&&n.getTime()||0,s=this.insightsCacheService.getInsights(t,r,i);return s?s.status:0},n.prototype.removeInsights=function(e,i){var t={databaseName:e.dbName,virtualServerName:e.vsName,modelId:e.id};this.insightsCacheService.removeInsights(t,i)},n.prototype.getInsights=function(n,s,c,u,d,g,v,h,p,y,m,f){var I=this;f||(f=this.promiseFactory.defer());var S={databaseName:c.dbName,virtualServerName:c.vsName,modelId:c.id},C=l.convertRefreshTimeToJsDateTime(c.lastRefreshTime),b=C&&C.getTime()||0,w=this.insightsCacheService.getInsights(S,b,v);if(y||m||!w){var M=!1,E=p;!E&&n&&(E=this.notificationToastService.notify({title:this.localizationService.get("Insights_LoadingTitle"),message:this.localizationService.format("Insights_LoadingSubtitle",[c.displayName]),notificationType:e.common.NotificationToastType.Loading,sticky:!0}));var F,T=this.createDataSource(c),P=e.explore.contracts.createDataSourceArray([T]),D=d===i.proxies.wireContracts.RequestOptions.ThoroughMode?e.telemetry.InsightSource.ServiceThoroughMode:e.telemetry.InsightSource.ServiceQuickMode;F=g?this.telemetryService.startChildEvent(g,e.telemetry.InsightsGetInsights,0,D,null):this.telemetryService.startEvent(e.telemetry.InsightsGetInsights,0,D,null),w=y?{key:null,showInsightsEvent:g,insertTimestamp:new Date,status:1}:this.insightsCacheService.setInsights(S,g,v),this.conceptualSchemaProxy.get(P).then((function(l){I.insightsProxy.deriveInsights(S,d,F,v,h,y,i.contracts.InsightType.None).then((function(n){var r=t.createInsightContainerFactory(I.visualPlugin,I.displayNameService,I.localizationService,I.themeService),s=[],o=n.length,a=0,c=0,u=$.Deferred();u.then((function(){I.notifyInsightsLoadingDone(w,E,0!==c,f,F,!1)}));for(var v=0;v<o;v++){n[v].Insight.Description=i.utils.toSentenceCase(n[v].Insight.Description);var h=void 0;try{h=r.createInsightContainer(n[v],v,l);var p={viewport:y?{height:i.constants.relatedInsightsViewportHeight,width:i.constants.relatedInsightsViewportWidth,scale:1}:{height:i.constants.viewportHeight,width:i.constants.viewportWidth,scale:1},type:h.config.singleVisual.visualType,hostServices:I.visualHostService,interactivityOptions:{overflow:"hidden"},allowInvalidDataView:!0,visualPlugin:I.visualPlugin,animateOnDataChanged:!1};s.push(i.models.ViewModelFactory.createInsightContainerModel(h,I.localizationService,d)),I.loadInsightData(a++,l,h,p,P,(function(e,t,n,r){if(!M){c++,u&&(u.resolve(),u=null);var o=s[e];n.data={dataView:t&&t.dataReaderResult?t.dataReaderResult.dataView:null,dataViewSource:t&&t.dataViewSource?t.dataViewSource:null},n.dataTransforms=r.transforms,o.visual=n,i.models.ViewModelFactory.updateInsightContainerVisual(o,t)}}))}catch(t){t.message&&I.telemetryService.logChildEvent(g,e.telemetry.InsightsConversionFailure,i.contracts.InsightType[i[v].Type],t.message)}}if(w.insightsContainers=s,window.DEBUG){for(var m=[],v=0;v<s.length;v++)m.push(s[v].contract);window.console.log("Insights",m)}F.event.info.insightCount=n.length,F.resolve(),window.setTimeout((function(){M=!0;var i=n.length-c;I.telemetryService.logChildEvent(g,e.telemetry.InsightsVisualFailedRendering,i),0===c&&I.notifyInsightsLoadingDone(w,E,!1,f,F,!1)}),i.constants.visualRenderingTimeoutMs)}),(function(t){t.Warnings?(w.insightsWarnings=t.Warnings,I.logWarnings(F.event,t.Warnings,s===r.Initial?0:1),o.hasFlag(t.Warnings,i.contracts.InsightsWarnings.NoMeasures)||o.hasFlag(t.Warnings,i.contracts.InsightsWarnings.NoDimensions)||o.hasFlag(t.Warnings,i.contracts.InsightsWarnings.NoFilteredComponents)?F.event.info.errorType=e.telemetry.InsightErrorType.ModelError:F.event.info.errorType=e.telemetry.InsightErrorType.SystemError,o.hasFlag(t.Warnings,a.InvalidModel)||o.hasFlag(t.Warnings,a.IN4DataMinerException)||o.hasFlag(t.Warnings,a.ModelUnavailable)||o.hasFlag(t.Warnings,a.InsightsServiceException)||o.hasFlag(t.Warnings,a.CacheException)?(I.insightsCacheService.removeInsights(S,v),I.errorService.error(I.localizationService.get("Insights_Error"),"Insights_Error",{requestId:t.RequestId})):s!==r.FailedRetry&&(o.hasFlag(t.Warnings,a.ConnectionPoolTimeoutExceeded)||o.hasFlag(t.Warnings,a.DidNotRunAllComponents)||o.hasFlag(t.Warnings,a.TooFewQueriesIssued)&&!o.hasFlag(t.Warnings,a.DataModelTooSimple))&&(I.insightsCacheService.removeInsights(S,v),I.getInsights(n,r.FailedRetry,c,u,d,g,v,Math.round(h?h*i.constants.timeoutMultiplier:i.constants.timeoutInMs*i.constants.timeoutMultiplier),E,y,m,f))):t.ErrorCode&&(I.insightsCacheService.removeInsights(S,v),I.errorService.error(I.localizationService.get("Insights_Error"),"Insights_Error",{requestId:t.RequestId})),I.notifyInsightsLoadingDone(w,E,!1,f,F,null!=t.ErrorCode)}))}),(function(e){var i="Unknown";e.serviceError&&(i=e.serviceError.errorCode?e.serviceError.errorCode:e.serviceError.statusCode.toString()),F.reject({errorCode:"ClientConceptualSchemaLoadError: "+i}),I.notifyInsightsLoadingDone(w,E,!1,f,F,!0),I.insightsCacheService.removeInsights(S,v),I.errorService.error(I.localizationService.get("Insights_Error"),"Insights_Error",{requestId:e.requestId})}))}else{var x=void 0;if(w.showInsightsEvent&&(x=this.telemetryService.startChildEvent(w.showInsightsEvent,e.telemetry.InsightsGetInsights,w.insightsContainers?w.insightsContainers.length:0,e.telemetry.InsightSource.ClientCache,null),x.resolve()),w.insightsContainers)for(var N=0,V=w.insightsContainers;N<V.length;N++){var L=V[N];L.source=e.telemetry.InsightSource.ClientCache}f.resolve({insightsContainers:w.insightsContainers,fromCache:!0,status:w.status,showInsightsEvent:w.showInsightsEvent,getInsightsEvent:x?x.event:null,isError:!1})}return f.promise},n.prototype.getPinDataForInsight=function(i,t,n){var r=this;if(i&&t&&n){var s=this.createDataSource(i),o=e.explore.contracts.createDataSourceArray([s]);this.conceptualSchemaProxy.get(o).then((function(s){var a=e.explore.util.VisualContainerUtils.describeForPinning(r.displayNameService,s,t.contract.config.singleVisual.query,r.visualPlugin.capabilities(t.visual.type),t.contract.insight.VisualConfiguration.QueryMetadata.Filters),l={config:t.contract.config.singleVisual,dataSources:o,schema:s,additionalFilters:null},c=r.visualQueryGenerator.execute(l),u=c.options.query.command,d={visualContainer:t.contract,visualType:t.visual.type,dataViewSource:t.dataViewSource,query:u,queryMetadata:a.queryMetadata,elements:a.visualElements,objects:t.contract.config.singleVisual.objects,modelId:i.id,packageId:i.packageId,action:{action:e.common.constants.openInsightsActionName},utterance:"",dataTransforms:c.transforms};n(d)}),(function(){}))}},n.prototype.getFiltersFromQuery=function(e){if(e&&!_.isEmpty(e.filters)){for(var i=[],t=0,n=e.filters;t<n.length;t++){var r=n[t];r&&r.filter&&i.push(r.filter)}return i}return[]},n.prototype.getFiltersFromHighlights=function(t){var n=[];if(t&&t.dataPoint){for(var r=[],s=0,o=t.dataPoint;s<o.length;s++){var a=o[s];if(a.selector&&a.selector.data&&(r=r.concat(a.selector.data),r.length>i.constants.maxHighlightFilters))return[]}r.length>0&&n.push(e.DataViewScopeIdentity.filterFromIdentity(r))}return n},n.prototype.getHighlightFiltersFromVisual=function(t){if(!t||_.isEmpty(t.dataViews))return[];var n=t.dataViews[0];if(!n||!n.categorical||_.isEmpty(n.categorical.categories))return[];for(var r=[],s=n.categorical.categories,o=0,a=s;o<a.length;o++){var l=a[o],c=[];if(!_.isEmpty(l.objects))for(var u=0;u<l.objects.length&&!(l.objects[u]&&l.objects[u].dataPoint&&(c.push(l.identity[u]),c.length>i.constants.maxHighlightFilters));u++);c.length>0&&c.length<=i.constants.maxHighlightFilters&&r.push(e.DataViewScopeIdentity.filterFromIdentity(c))}for(var d=n.categorical.values,g=d?d.grouped():[],v=[],h=0,p=g;h<p.length;h++){var y=p[h];y.objects&&y.objects.dataPoint&&v.push(y.identity)}return v.length>0&&v.length<=i.constants.maxHighlightFilters&&r.push(e.DataViewScopeIdentity.filterFromIdentity(v)),r},n.prototype.getFiltersFromSelection=function(i){var t=[];if(i&&!_.isEmpty(i.sections))for(var n=0,r=i.sections;n<r.length;n++){var s=r[n];s.crossHighlight&&s.crossHighlight.selection&&t.push(e.data.Selector.filterFromSelector(s.crossHighlight.selection))}return t},n.prototype.getNumberOfColumns=function(e){if(e){var i=e.config.singleVisual.query.defn.select();return i?i.length:0}return 0},n.prototype.notifyInsightsLoadingDone=function(e,i,t,n,r,s){e.status=2,this.notificationToastService.hide(i),n.resolve({insightsContainers:e?e.insightsContainers:null,fromCache:!1,status:e?e.status:null,showInsightsEvent:e?e.showInsightsEvent:null,getInsightsEvent:r,isError:s})},n.prototype.createDataSource=function(e){return{type:"dsr",id:e.id,name:void 0,dsr:{schemaName:void 0,vsName:e.vsName,dbName:e.dbName,modelId:e.id}}},n.prototype.setScopedInsightsSource=function(e){this.scopedInsightEntryPoint=e},n.prototype.getScopedInsightsSource=function(){return this.scopedInsightEntryPoint?this.scopedInsightEntryPoint:e.telemetry.InsightEntryPoint.InFocusMode},n.prototype.loadInsightData=function(e,i,t,n,r,s){var o={config:t.config.singleVisual,dataSources:r,schema:i,additionalFilters:null},a=this.visualQueryGenerator.execute(o);this.executeQueryForCurrentModel(a,(function(i){s(e,i,n,a)}))},n.prototype.executeQueryForCurrentModel=function(e,i){this.dataProxy.execute(e.options).then((function(e){i(e)}))},n.prototype.logWarnings=function(i,t,n){for(var r in a){var s=parseInt(r,10);!isNaN(s)&&0!==s&&o.hasFlag(t,s)&&this.telemetryService.logChildEvent(i,e.telemetry.InsightsWarnings,a[r],n)}},n})()})(t=i.services||(i.services={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){var t;!(function(i){function t(e,i){return new r(e,i)}function n(i){switch(i){case e.visuals.plugins.clusteredBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.clusteredBarChart,(function(){return new e.visuals.CartesianChart({chartType:5,animator:new e.visuals.WebColumnChartAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.columnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.columnChart,(function(){return new e.visuals.CartesianChart({chartType:4,animator:new e.visuals.WebColumnChartAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.donutChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.donutChart,(function(){return new e.visuals.DonutChart({animator:new e.visuals.WebDonutChartAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.hundredPercentStackedBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.hundredPercentStackedBarChart,(function(){return new e.visuals.CartesianChart({chartType:7,animator:new e.visuals.WebColumnChartAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.hundredPercentStackedColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.hundredPercentStackedColumnChart,(function(){return new e.visuals.CartesianChart({chartType:8,animator:new e.visuals.WebColumnChartAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.lineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.lineChart,(function(){return new e.visuals.CartesianChart({chartType:0,animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.areaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.areaChart,(function(){return new e.visuals.CartesianChart({chartType:1,animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.pieChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.pieChart,(function(){return new e.visuals.DonutChart({sliceWidthRatio:0,animator:new e.visuals.WebDonutChartAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.scatterChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.scatterChart,(function(){return new e.visuals.CartesianChart({chartType:9,animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0})}),void 0);default:return e.Prototype.inherit(e.visuals.plugins[i])}}i.createInsightsVisualPluginService=t;var r=(function(){function i(i,t){var r=this;this.promiseFactory=i,this.featureSwitchService=t,this.storage=new e.visualHost.visualPluginServiceHelpers.VisualPluginStorage,_.forOwn(e.visuals.plugins,(function(e,i){r.storage.loadPlugin(i,n(i))}))}return i.prototype.getPlugin=function(e){return this.storage.getLoadedPlugin(e)},i.prototype.getVisuals=function(){return this.storage.getLoadedPlugins()},i.prototype.capabilities=function(e){var i=this.getPlugin(e);return i?i.capabilities:void 0},i.prototype.ensureBuiltInPlugins=function(){return this.promiseFactory.resolve(null)},i.prototype.ensureTrustedVisualPlugins=function(e){},i.prototype.ensurePlugins=function(e,i){return null},i.prototype.ensurePlugin=function(e,i){return null},i.prototype.isCustomVisual=function(i){return e.visualHost.utils.isCustomVisual(this.getPlugin(i),i)},i.prototype.getInteractivityOptions=function(){return{overflow:"hidden",isVisualInteractive:!1}},i.prototype.isScriptVisual=function(i){return e.visualHost.utils.isScriptVisual(this.getPlugin(i))},i.prototype.isScriptVisualQueryable=function(){return e.visualHost.utils.isScriptVisualQueryable(this.featureSwitchService.featureSwitches)},i.prototype.isLightWeightRenderingVisual=function(i){return e.visualHost.utils.isLightWeightRenderingVisual(this.getPlugin(i))},i.prototype.getTelemetryHostInformation=function(){return{name:"Insights"}},i.prototype.getStorage=function(){return this.storage},i})()})(t=i.services||(i.services={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(i){var t;!(function(t){function n(e,i,t,n,r,s,o,l,c,u,d,g,v,h){return new a(e,i,t,n,r,s,o,l,c,u,d,g,v,h)}var r=e.data.services.SemanticQuerySerializer,s=e.explore.services.createVisualQueryGenerator,o=e.explore.util.VisualContainerUtils;t.createSummaryInsightsService=n;var a=(function(){function t(i,t,n,r,o,a,l,c,u,d,g,v,h,p){this.conceptualSchemaProxy=i,this.dataProxy=t,this.displayNameService=n,this.dataReaderProvider=r,this.visualPlugin=o,this.featureSwitchService=l,this.insightService=c,this.promiseFactory=u,this.telemetryService=d,this.localizationService=g,this.aggrOps=v,this.filterGenerator=h,this.themeService=p,this.visualQueryGenerator=s({dataReaders:this.dataReaderProvider,displayNameService:this.displayNameService,plugin:this.visualPlugin,pluginOps:a,sortService:e.explore.services.createSortService(this.displayNameService,this.featureSwitchService,this.visualPlugin),featureSwitchService:this.featureSwitchService,aggrOps:v,filterGenerator:h,transformPluginService:e.data.transforms.createTransformPluginService(),telemetryService:this.telemetryService})}return t.prototype.getSummary=function(i,t,n,r){var s,a=this,l=this.promiseFactory.defer();if(s=r?this.telemetryService.startChildEvent(r,e.telemetry.InsightsShowSummaryInsights,0):this.telemetryService.startEvent(e.telemetry.InsightsShowSummaryInsights,0),i&&t){var c=this.insightService.createDataSource(t),u=e.explore.contracts.createDataSourceArray([c]);this.conceptualSchemaProxy.get(u).then((function(e){var t=a.insightService.getFiltersFromQuery(i),r=a.getQueryDefinition(i,t),c={config:i.config.singleVisual,dataSources:u,schema:e,additionalFilters:null},d=a.visualQueryGenerator.execute(c);if(a.isSummarySupported(d,n)){a.updateCommand(d,r,i);for(var g=[],v=0,h=0,p=i.config.singleVisual.query.defn.select();h<p.length;h++){var y=p[h];if(a.isMeasure(y)){var m=void 0,f=y.expr.getConceptualProperty(e);f&&(m=f.format);var I=o.getVisualCapabilities(i,a.visualPlugin);g.push({index:v,name:a.displayNameService.getDisplayName(y.expr,e,I),format:m})}v++}a.getMeasureValues(c,d,r,i,g).then((function(e){s.event.info.insightCount=e.length,s.resolve(),l.resolve({showSummaryInsightsEvent:s.event,summaryInsightsCards:e})}))}else s.resolve(),l.resolve({showSummaryInsightsEvent:s.event,summaryInsightsCards:[]})}))}else s.resolve(),l.resolve({showSummaryInsightsEvent:s.event,summaryInsightsCards:[]});return l.promise},t.prototype.isSummarySupported=function(e,t){var n=e.options.query.command;return n.Commands[0].SemanticQueryDataShapeCommand.Binding&&n.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction&&n.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction.Primary&&!n.Commands[0].SemanticQueryDataShapeCommand.Binding.Secondary&&t&&t.type!==i.constants.scatterChartVisualName&&t.type!==i.constants.tableVisualName&&t.type!==i.constants.matrixVisualName},t.prototype.updateCommand=function(e,t,n){var r=e.options.query.command;r.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction.Primary.Top={Count:1},r.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction.Primary.Sample=null,r.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction.Primary.Bottom=null,r.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction.Primary.Window=null,r.Commands[0].SemanticQueryDataShapeCommand.Query=t,r.Commands[0].SemanticQueryDataShapeCommand.Binding.Aggregates=[];for(var s=0,o=0,a=n.config.singleVisual.query.defn.select();o<a.length;o++){var l=a[o];this.isMeasure(l)&&r.Commands[0].SemanticQueryDataShapeCommand.Binding.Aggregates.push({Select:s,Kind:i.constants.aggregateKindEnum}),s++}r.Commands[0].SemanticQueryDataShapeCommand.Binding.Primary.Groupings[0].Subtotal=i.constants.subtotalKindEnum},t.prototype.getMeasureValues=function(e,t,n,r,s){var o=this,a=this.promiseFactory.defer();return this.dataProxy.execute(t.options).then((function(e){for(var t=e.dataReaderResult.dataView,n=[],r=0,l=0,c=s;l<c.length;l++){var u=c[l],d=_.find(t.categorical.values,(function(e){return e.source.index===s[r].index})),g=_.find(t.matrix.rows.root.children,(function(e){return e.isSubtotal}));d&&g&&g.values[r]&&(n.push(i.models.ViewModelFactory.createSummaryInsightCardModel(r,u.name,g.values[r].value,d.max,d.min,u.format,o.localizationService)),r++)}a.resolve(n)}),(function(e){a.reject(e)})),a.promise},t.prototype.updateVisualContractWithAnnotations=function(t,n,r,s){t.config.singleVisual.objects||(t.config.singleVisual.objects={});var a=o.getVisualCapabilities(t,this.visualPlugin);if(!(r.dataTransforms.splits&&r.dataTransforms.splits.length>1||r.type===i.constants.waterfallVisualName))if(a.objects[i.constants.referenceLinePropertyName]){var l=this.createReferenceLine(n);t.config.singleVisual.objects[i.constants.referenceLinePropertyName]=[l]}else if(r&&r.data&&r.data.dataView)for(var c=r.data.dataView,u=c.categorical,d=0,g=u.values;d<g.length;d++){var v=g[d],h=_.zip(u.categories[0].identity,u.categories[0].values,v.values),p=_.find(h,(function(e){return e[2]===n}));if(p){var y=t.config.singleVisual.query.defn.select(),m=y[v.source.index].name,f=e.visuals.SelectionId.createWithIdAndMeasure(p[0],m,!0);this.filterGenerator.setFilterOnSelectData(s,[f.getSelector()],s.sections[0],null);break}}},t.prototype.removeAnnotationsFromVisualContract=function(e,t){delete e.config.singleVisual.objects[i.constants.referenceLinePropertyName],this.filterGenerator.clearCrossHighlight(t.sections[0])},t.prototype.createReferenceLine=function(i){return{selector:{id:"0"},properties:{show:e.data.SQExprBuilder.boolean(!0),value:i instanceof Date?e.data.SQExprBuilder.dateTime(i):e.data.SQExprBuilder.double(i),transparency:e.data.SQExprBuilder.double(20),lineColor:{solid:{color:e.data.SQExprBuilder.text(this.themeService.getColors("Insights")[2].value)}},position:e.data.SQExprBuilder.text(e.visuals.referenceLinePosition.front)}}},t.prototype.isMeasure=function(i){return i.expr instanceof e.data.SQAggregationExpr||i.expr instanceof e.data.SQMeasureRefExpr||i.expr instanceof e.data.SQPropRefExpr&&(3===i.expr.kind||4===i.expr.kind)},t.prototype.getQueryDefinition=function(e,i){if(e){var t=e.config.singleVisual.query.defn;if(t){for(var n=0,s=i;n<s.length;n++){var o=s[n];t=t.addSemanticFilter(o)}return r.serializeQuery(t)}}return null},t})();t.SummaryInsightsService=a})(t=i.services||(i.services={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var i;!(function(e){var i;!(function(i){function t(e){return e[0].toUpperCase()+e.slice(1)}function n(e,i){switch(e){case r.Attribution:return i.get("Insights_MajorityGroup");case r.OutstandingFirst:case r.OutstandingLast:case r.OutstandingTop2:return i.get("Insights_CategoryOutliersGroup");case r.Outlier:return i.get("Insights_TimeSeriesOutliersGroup");case r.ChangePoint:return i.get("Insights_ChangePointsGroup");case r.ComplexTimeSeries:case r.Trend:return i.get("Insights_TrendGroup");case r.Seasonality:return i.get("Insights_SeasonalityGroup");case r.Correlation:return i.get("Insights_SteadyShareGroup");case r.CrossMeasureCorrelation:return i.get("Insights_CorrelationGroup");case r.ClusterAndOutlier:return i.get("Insights_ClusterGroup");case r.LowVariance:return i.get("Insights_LowVarianceGroup");case r.SetRelationship:return i.get("Insights_SetRelationshipGroup");default:return""}}var r=e.contracts.InsightType;i.toSentenceCase=t,i.getInsightGroupText=n})(i=e.utils||(e.utils={}))})(i=e.insights||(e.insights={}))})(powerbi||(powerbi={})),angular.module("powerbi.insights").run(["$templateCache",function(e){e.put("views/insightCard.html",'<div class="insightCard"><div class="visualContainer" ng-class="{ \'selected\': viewModel.isSelected }" ng-click="$parent.$parent.selectInsight($event, viewModel.contract.id)"> <button class="insightCardPinVisualBtn" ng-click="$parent.$parent.pinInsight($event, viewModel.contract.id)" localize-tooltip="PinVisual_ToolTip"><i class="glyphicon pbi-glyph-pinned glyph-small"></i></button><div class="title" ng-bind="viewModel.title" ng-attr-title="{{viewModel.title}}"></div><div class="subtitle" ng-bind="viewModel.subtitle"></div><visual class="visual" view-model="viewModel.visual" allow-deferred-rendering="::true"></visual><div class="group" ng-bind="viewModel.insightGroup" ng-attr-title="{{viewModel.insightGroup}}"></div><div class="description"><span ng-bind="viewModel.contract.insight.Description" ng-if="!viewModel.contract.insight.StructuredDescription"></span><span ng-repeat="descriptionItem in viewModel.contract.insight.StructuredDescription" ng-bind="descriptionItem.Text" ng-attr-title="{{descriptionItem.Hover}}" ng-class="{\'highlightedDescriptionToken\': descriptionItem.Hover}"></span></div></div></div>'),e.put("views/insightContainer.html",'<div><div class="insightTile"><div class="insightVisual"><div class="tileHeader"><div class="title" ng-bind="viewModel.title" ng-attr-title="{{viewModel.title}}"></div><div class="subtitle" ng-bind="viewModel.subtitle"></div></div><visual class="insightChart" ng-if="viewModel.isLoading === false" view-model="viewModel.visual" allow-deferred-rendering="::true"></visual><spinner class="insightLoadingSpinner" ng-show="viewModel.isLoading === true"></spinner></div><div class="insightMetadata"><div class="insightGroup" ng-bind="viewModel.insightGroup" ng-attr-title="{{viewModel.insightGroup}}"></div><div class="description" ng-bind="viewModel.contract.insight.Description" ng-if="!viewModel.contract.insight.StructuredDescription" ng-class="{short: $parent.insightsDevModeEnabled && viewModel.contract.details}"></div><div class="description" ng-if="viewModel.contract.insight.StructuredDescription" ng-class="{short: $parent.insightsDevModeEnabled && viewModel.contract.details}"><span ng-repeat="descriptionItem in viewModel.contract.insight.StructuredDescription" ng-bind="descriptionItem.Text" ng-attr-title="{{descriptionItem.Hover}}" ng-class="{\'highlightedDescriptionToken\': descriptionItem.Hover}"></span></div><div ng-if="::$parent.insightsDevModeEnabled" ng-show="viewModel.contract.details" class="statisticsContainer"><div class="statisticsDescription" ng-repeat="detail in viewModel.contract.details track by $index" ng-bind="detail"></div></div></div></div></div>'),
e.put("views/insightsCanvas.html",'<div ng-class="{noInsightsFound: noInsightsFound}"><div class="layoutTop"><div id="insightsCanvasTitleSection" class="trimmedTextWithEllipsis"><span class="insightsCanvasTitle" localize="Insights_CanvasTitle"></span><span ng-bind="viewModel.contract.model.displayName"></span><span class="insightsCanvasTitle" localize="Insights_CanvasTitleSuffix"></span> <button class="insightsRefreshButton" ng-click="reloadInsights(true)" ng-show="canShowInsights()" localize-tooltip="Insights_Refresh"><i class="glyphicon pbi-glyph-refresh glyph-small"></i></button></div><div class="insightsCanvasSubtitleSection" ng-show="canShowInsights()"><span localize="Insights_SubsetDataSearched"></span><span><a ng-href="{{subsetDataSearchedLink}}" localize="LearnMore" target="_blank"></a></span></div><div class="devModeSection" ng-show="::insightsDevModeEnabled"><div class="section" ng-bind="numberOfInsightsText"></div><div class="section"> <span>Requested insights</span> <input id="requestedInsightsTextBox" type="text" ng-model="numberOfInsightsRequested"/> <span>Timeout in sec</span> <input id="timeoutTextBox" type="text" ng-model="timeoutInSec"/> <button class="primary" ng-click="reloadInsights(false)">Reload</button></div></div></div><div class="layoutBottom" ng-class="{devMode: insightsDevModeEnabled}"><div class="insightsCanvas"><div class="loadingSection" ng-show="!canShowInsights() && viewModel"><h2 localize="Insights_SearchingInsightsTitle"></h2><spinner class="loadingSectionSpinner"></spinner><div localize="Insights_SearchingInsightsSubtitle"></div></div><div ng-show="canShowInsights()"><div><div class="insightContainer" ng-repeat="visual in viewModel.insightContainers track by visual.contract.id" ng-show="visual.visual && visual.isVisible && !visual.isLoading" ng-click="showInFocusMode(visual.contract.id, $event);"><insight-container view-model="visual"></insight-container><div class="optionsMenu"> <button class="optionsButton" ng-click="pinInsight(visual.contract.id, $event)" localize-tooltip="PinVisual_ToolTip"><i class="glyphicon pbi-glyph-pinned glyph-small"></i></button> <button class="optionsButton" ng-click="showInFocusMode(visual.contract.id, $event)" localize-tooltip="TileEditor_InFocusTile"><i class="glyphicon pbi-glyph-miniexpand glyph-small"></i></button></div></div></div><div class="noInsightsContainer"><div class="noInsightsFoundTitle" localize="Insights_NoInsightsFoundTitle"></div><div class="noInsightsFoundText" localize="Insights_NoInsightsFoundText"></div><div class="noInsightsFoundText" localize="Insights_NoInsightsFoundSubtext"></div><div class="learnMore"><a ng-href="{{zeroInsightsLearnMoreLink}}" localize="LearnMore" target="_blank"></a></div></div></div></div></div></div>'),e.put("views/insightsPane.html",'<div class="insightsPane"><div class="header"><i class="closeButton glyphicon pbi-glyph-close glyph-mini" ng-click="closePane()"></i></div><div class="content"><div class="summaryInsights" ng-if="viewModel.summaryInsights.summaryInsightsCards.length> 0"><div class="contentHeader" ng-click="viewModel.summaryExpanded = !viewModel.summaryExpanded"><span localize="InsightsPane_SummaryTitle"></span><i ng-class="{\'chevron\': true, \'glyphicon\': true, \'glyph-small\': true, \'pbi-glyph-chevronupmedium\': viewModel.summaryExpanded, \'pbi-glyph-chevrondownmedium\': !viewModel.summaryExpanded}"></i></div><div class="contentBody summaryCards" ng-class="{expandedContent: viewModel.summaryExpanded}"><summary-insight-card ng-repeat="summaryInsight in viewModel.summaryInsights.summaryInsightsCards track by summaryInsight.id" view-model="summaryInsight" ng-class="{summaryInsightCard: true, hidden: !viewModel.summaryExpanded, separator: !$last}"></summary-insight-card></div></div><div class="contentHeader" ng-click="viewModel.insightsExpanded = !viewModel.insightsExpanded"><span localize="InsightsPane_InsightsTitle"></span><i ng-class="{\'chevron\': true, \'glyphicon\': true, \'glyph-small\': true, \'pbi-glyph-chevronupmedium\': viewModel.insightsExpanded, \'pbi-glyph-chevrondownmedium\': !viewModel.insightsExpanded}"></i></div><div class="contentBody" ng-class="{expandedContent: viewModel.insightsExpanded, hidden: !viewModel.insightsExpanded}"><div class="insightsMessageContainer"><span class="insightsMessage" localize="Insights_PaneSearching" ng-if="viewModel.isLoading" localize-fragments><b fragment-index="0" ng-bind="viewModel.visualTitle"></b></span> <span class="insightsMessage" localize="Insights_FinishedLoadingNoInsightsSubtitle" ng-if="!viewModel.isLoading && !(viewModel.insights && viewModel.insights.insightsContainers && viewModel.insights.insightsContainers.length>0)" localize-fragments><b fragment-index="0" ng-bind="viewModel.visualTitle"></b></span></div><div class="loadingSectionSpinner" ng-if="viewModel.isLoading && viewModel.insightsExpanded"></div><insight-card ng-repeat="insight in viewModel.insights.insightsContainers track by insight.contract.id" view-model="insight" ng-show="viewModel.insightsExpanded && insight.visual && !insight.isLoading && insight.isVisible"></insight-card></div></div></div>'),e.put("views/summaryInsightCard.html",'<div><div class="summaryInsightContent"><div class="summaryTitle" ng-bind="viewModel.measureName"></div><div class="summaryContent"><div ng-repeat="fact in viewModel.facts track by fact.type" ng-click="$parent.$parent.addReferenceLineAndSelect(viewModel.id, fact.type) " ng-class="{item: true, selectableSummary: fact.isSelectable, selected: fact.isSelected}"><div class="itemValue" ng-bind="fact.formattedValue" ng-attr-title="{{fact.formattedValue}}"></div><div class="itemCaption" ng-bind="fact.caption"></div></div></div></div></div>')}]);;var __awaiter=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(n,o){function r(e){try{c(a.next(e))}catch(e){o(e)}}function s(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(r,s)}c((a=a.apply(e,t)).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return a([e,t])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,o,r,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return{next:i(0),throw:i(1),return:i(2)}},powerbi;!(function(e){var t;!(function(t){var i;!(function(e){e[e.None=0]="None",e[e.UsageMetrics=1]="UsageMetrics",e[e.ManageUsers=2]="ManageUsers",e[e.Auditing=3]="Auditing",e[e.TenantSettings=4]="TenantSettings",e[e.CapacitySettings=5]="CapacitySettings"})(i=t.AdminPortalTab||(t.AdminPortalTab={})),t.SettingsAdminAuditing=function(t,i,a,n,o,r,s,c,l,d,u,g){void 0===i&&(i=!1),void 0===a&&(a=void 0),void 0===n&&(n=void 0),void 0===o&&(o=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===d&&(d=void 0),void 0===u&&(u=!1),void 0===g&&(g=!1);var p={parentId:t,isError:i,errorSource:a,errorCode:n,errorMessage:o,activityName:r,activityId:s,isDebug:c,isCancelled:l,pingLatency:d,isAppInactive:u,isInCapacity:g},v={name:"PBI.Settings.AdminAuditing",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:p.parentId},i=typeof p.isError;("boolean"===i&&!!p.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=p.isError);var i=typeof p.errorSource;("boolean"===i&&!!p.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]);var i=typeof p.errorCode;("boolean"===i&&!!p.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=p.errorCode);var i=typeof p.errorMessage;("boolean"===i&&!!p.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=p.errorMessage);var i=typeof p.activityName;("boolean"===i&&!!p.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=p.activityName);var i=typeof p.activityId;("boolean"===i&&!!p.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=p.activityId);var i=typeof p.isDebug;("boolean"===i&&!!p.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=p.isDebug);var i=typeof p.isCancelled;("boolean"===i&&!!p.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=p.isCancelled);var i=typeof p.pingLatency;("boolean"===i&&!!p.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=p.pingLatency);var i=typeof p.isAppInactive;("boolean"===i&&!!p.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=p.isAppInactive);var i=typeof p.isInCapacity;return("boolean"===i&&!!p.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=p.isInCapacity),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.SettingsAdminAuditingLoggers&&(v.loggers=e.telemetry.SettingsAdminAuditingLoggers),v},t.SettingsOpenGatewaySettings=function(t,i,a,n,o,r,s,c,l,d,u,g){void 0===i&&(i=!1),void 0===a&&(a=void 0),void 0===n&&(n=void 0),void 0===o&&(o=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===d&&(d=void 0),void 0===u&&(u=!1),void 0===g&&(g=!1);var p={parentId:t,isError:i,errorSource:a,errorCode:n,errorMessage:o,activityName:r,activityId:s,isDebug:c,isCancelled:l,pingLatency:d,isAppInactive:u,isInCapacity:g},v={name:"PBI.Settings.OpenGatewaySettings",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:p.parentId},i=typeof p.isError;("boolean"===i&&!!p.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=p.isError);var i=typeof p.errorSource;("boolean"===i&&!!p.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]);var i=typeof p.errorCode;("boolean"===i&&!!p.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=p.errorCode);var i=typeof p.errorMessage;("boolean"===i&&!!p.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=p.errorMessage);var i=typeof p.activityName;("boolean"===i&&!!p.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=p.activityName);var i=typeof p.activityId;("boolean"===i&&!!p.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=p.activityId);var i=typeof p.isDebug;("boolean"===i&&!!p.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=p.isDebug);var i=typeof p.isCancelled;("boolean"===i&&!!p.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=p.isCancelled);var i=typeof p.pingLatency;("boolean"===i&&!!p.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=p.pingLatency);var i=typeof p.isAppInactive;("boolean"===i&&!!p.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=p.isAppInactive);var i=typeof p.isInCapacity;return("boolean"===i&&!!p.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=p.isInCapacity),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.SettingsOpenGatewaySettingsLoggers&&(v.loggers=e.telemetry.SettingsOpenGatewaySettingsLoggers),v},t.SettingsGetUsageMetricsDashboardId=function(t,i,a,n,o,r,s,c,l,d,u,g){void 0===i&&(i=!1),void 0===a&&(a=void 0),void 0===n&&(n=void 0),void 0===o&&(o=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===d&&(d=void 0),void 0===u&&(u=!1),void 0===g&&(g=!1);var p={parentId:t,isError:i,errorSource:a,errorCode:n,errorMessage:o,activityName:r,activityId:s,isDebug:c,isCancelled:l,pingLatency:d,isAppInactive:u,isInCapacity:g},v={name:"PBI.Settings.GetUsageMetricsDashboardId",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:p.parentId},i=typeof p.isError;("boolean"===i&&!!p.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=p.isError);var i=typeof p.errorSource;("boolean"===i&&!!p.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]);var i=typeof p.errorCode;("boolean"===i&&!!p.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=p.errorCode);var i=typeof p.errorMessage;("boolean"===i&&!!p.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=p.errorMessage);var i=typeof p.activityName;("boolean"===i&&!!p.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=p.activityName);var i=typeof p.activityId;("boolean"===i&&!!p.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=p.activityId);var i=typeof p.isDebug;("boolean"===i&&!!p.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=p.isDebug);var i=typeof p.isCancelled;("boolean"===i&&!!p.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=p.isCancelled);var i=typeof p.pingLatency;("boolean"===i&&!!p.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=p.pingLatency);var i=typeof p.isAppInactive;("boolean"===i&&!!p.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=p.isAppInactive);var i=typeof p.isInCapacity;return("boolean"===i&&!!p.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=p.isInCapacity),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.SettingsGetUsageMetricsDashboardIdLoggers&&(v.loggers=e.telemetry.SettingsGetUsageMetricsDashboardIdLoggers),v},t.SettingsGetTenantSettings=function(t,i,a,n,o,r,s,c,l,d,u,g){void 0===i&&(i=!1),void 0===a&&(a=void 0),void 0===n&&(n=void 0),void 0===o&&(o=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===d&&(d=void 0),void 0===u&&(u=!1),void 0===g&&(g=!1);var p={parentId:t,isError:i,errorSource:a,errorCode:n,errorMessage:o,activityName:r,activityId:s,isDebug:c,isCancelled:l,pingLatency:d,isAppInactive:u,isInCapacity:g},v={name:"PBI.Settings.GetTenantSettings",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:p.parentId},i=typeof p.isError;("boolean"===i&&!!p.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=p.isError);var i=typeof p.errorSource;("boolean"===i&&!!p.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]);var i=typeof p.errorCode;("boolean"===i&&!!p.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=p.errorCode);var i=typeof p.errorMessage;("boolean"===i&&!!p.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=p.errorMessage);var i=typeof p.activityName;("boolean"===i&&!!p.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=p.activityName);var i=typeof p.activityId;("boolean"===i&&!!p.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=p.activityId);var i=typeof p.isDebug;("boolean"===i&&!!p.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=p.isDebug);var i=typeof p.isCancelled;("boolean"===i&&!!p.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=p.isCancelled);var i=typeof p.pingLatency;("boolean"===i&&!!p.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=p.pingLatency);var i=typeof p.isAppInactive;("boolean"===i&&!!p.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=p.isAppInactive);var i=typeof p.isInCapacity;return("boolean"===i&&!!p.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=p.isInCapacity),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.SettingsGetTenantSettingsLoggers&&(v.loggers=e.telemetry.SettingsGetTenantSettingsLoggers),v},t.SettingsUpdateTenantSettings=function(t,i,a,n,o,r,s,c,l,d,u,g){void 0===i&&(i=!1),void 0===a&&(a=void 0),void 0===n&&(n=void 0),void 0===o&&(o=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===d&&(d=void 0),void 0===u&&(u=!1),void 0===g&&(g=!1);var p={parentId:t,isError:i,errorSource:a,errorCode:n,errorMessage:o,activityName:r,activityId:s,isDebug:c,isCancelled:l,pingLatency:d,isAppInactive:u,isInCapacity:g},v={name:"PBI.Settings.UpdateTenantSettings",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:p.parentId},i=typeof p.isError;("boolean"===i&&!!p.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=p.isError);var i=typeof p.errorSource;("boolean"===i&&!!p.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]);var i=typeof p.errorCode;("boolean"===i&&!!p.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=p.errorCode);var i=typeof p.errorMessage;("boolean"===i&&!!p.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=p.errorMessage);var i=typeof p.activityName;("boolean"===i&&!!p.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=p.activityName);var i=typeof p.activityId;("boolean"===i&&!!p.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=p.activityId);var i=typeof p.isDebug;("boolean"===i&&!!p.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=p.isDebug);var i=typeof p.isCancelled;("boolean"===i&&!!p.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=p.isCancelled);var i=typeof p.pingLatency;("boolean"===i&&!!p.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=p.pingLatency);var i=typeof p.isAppInactive;("boolean"===i&&!!p.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=p.isAppInactive);var i=typeof p.isInCapacity;return("boolean"===i&&!!p.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=p.isInCapacity),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.SettingsUpdateTenantSettingsLoggers&&(v.loggers=e.telemetry.SettingsUpdateTenantSettingsLoggers),v},t.SettingsUpdateTenantSetting=function(t,i,a,n,o,r,s,c,l,d,u,g,p,v,h,y,S){void 0===s&&(s=!1),void 0===c&&(c=void 0),void 0===l&&(l=void 0),void 0===d&&(d=void 0),void 0===u&&(u=void 0),void 0===g&&(g=void 0),void 0===p&&(p=!1),void 0===v&&(v=!1),void 0===h&&(h=void 0),void 0===y&&(y=!1),void 0===S&&(S=!1);var f={name:t,isEnabled:i,isGranular:a,hasAllowedSecurityGroups:n,hasDeniedSecurityGroups:o,parentId:r,isError:s,errorSource:c,errorCode:l,errorMessage:d,activityName:u,activityId:g,isDebug:p,isCancelled:v,pingLatency:h,isAppInactive:y,isInCapacity:S},w={name:"PBI.Settings.UpdateTenantSetting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={name:f.name,isEnabled:f.isEnabled,isGranular:f.isGranular,hasAllowedSecurityGroups:f.hasAllowedSecurityGroups,hasDeniedSecurityGroups:f.hasDeniedSecurityGroups,parentId:f.parentId},i=typeof f.isError;("boolean"===i&&!!f.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=f.isError);var i=typeof f.errorSource;("boolean"===i&&!!f.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[f.errorSource]);var i=typeof f.errorCode;("boolean"===i&&!!f.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=f.errorCode);var i=typeof f.errorMessage;("boolean"===i&&!!f.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=f.errorMessage);var i=typeof f.activityName;("boolean"===i&&!!f.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=f.activityName);var i=typeof f.activityId;("boolean"===i&&!!f.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=f.activityId);var i=typeof f.isDebug;("boolean"===i&&!!f.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=f.isDebug);var i=typeof f.isCancelled;("boolean"===i&&!!f.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=f.isCancelled);var i=typeof f.pingLatency;("boolean"===i&&!!f.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=f.pingLatency);var i=typeof f.isAppInactive;("boolean"===i&&!!f.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=f.isAppInactive);var i=typeof f.isInCapacity;return("boolean"===i&&!!f.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=f.isInCapacity),t},info:f,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.SettingsUpdateTenantSettingLoggers&&(w.loggers=e.telemetry.SettingsUpdateTenantSettingLoggers),w},t.SettingsUpdateDataClassifications=function(t,i,a,n,o,r,s,c,l,d,u,g,p){void 0===a&&(a=!1),void 0===n&&(n=void 0),void 0===o&&(o=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=void 0),void 0===l&&(l=!1),void 0===d&&(d=!1),void 0===u&&(u=void 0),void 0===g&&(g=!1),void 0===p&&(p=!1);var v={numberOfDataClassifications:t,parentId:i,isError:a,errorSource:n,errorCode:o,errorMessage:r,activityName:s,activityId:c,isDebug:l,isCancelled:d,pingLatency:u,isAppInactive:g,isInCapacity:p},h={name:"PBI.Settings.UpdateDataClassifications",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={numberOfDataClassifications:v.numberOfDataClassifications,parentId:v.parentId},i=typeof v.isError;("boolean"===i&&!!v.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=v.isError);var i=typeof v.errorSource;("boolean"===i&&!!v.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]);var i=typeof v.errorCode;("boolean"===i&&!!v.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=v.errorCode);var i=typeof v.errorMessage;("boolean"===i&&!!v.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=v.errorMessage);var i=typeof v.activityName;("boolean"===i&&!!v.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=v.activityName);var i=typeof v.activityId;("boolean"===i&&!!v.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=v.activityId);var i=typeof v.isDebug;("boolean"===i&&!!v.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=v.isDebug);var i=typeof v.isCancelled;("boolean"===i&&!!v.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=v.isCancelled);var i=typeof v.pingLatency;("boolean"===i&&!!v.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=v.pingLatency);var i=typeof v.isAppInactive;("boolean"===i&&!!v.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=v.isAppInactive);var i=typeof v.isInCapacity;return("boolean"===i&&!!v.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=v.isInCapacity),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.SettingsUpdateDataClassificationsLoggers&&(h.loggers=e.telemetry.SettingsUpdateDataClassificationsLoggers),h},t.SettingsAdminPortalTabSelected=function(t,i,a,n,o,r,s,c,l,d,u,g,p){void 0===a&&(a=!1),void 0===n&&(n=void 0),void 0===o&&(o=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=void 0),void 0===l&&(l=!1),void 0===d&&(d=!1),void 0===u&&(u=void 0),void 0===g&&(g=!1),void 0===p&&(p=!1);var v={adminPortalTab:t,parentId:i,isError:a,errorSource:n,errorCode:o,errorMessage:r,activityName:s,activityId:c,isDebug:l,isCancelled:d,pingLatency:u,isAppInactive:g,isInCapacity:p},h={name:"PBI.Settings.AdminPortalTabSelected",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={adminPortalTab:e.telemetry.AdminPortalTab[v.adminPortalTab],parentId:v.parentId},i=typeof v.isError;("boolean"===i&&!!v.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=v.isError);var i=typeof v.errorSource;("boolean"===i&&!!v.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]);var i=typeof v.errorCode;("boolean"===i&&!!v.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=v.errorCode);var i=typeof v.errorMessage;("boolean"===i&&!!v.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=v.errorMessage);var i=typeof v.activityName;("boolean"===i&&!!v.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=v.activityName);var i=typeof v.activityId;("boolean"===i&&!!v.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=v.activityId);var i=typeof v.isDebug;("boolean"===i&&!!v.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=v.isDebug);var i=typeof v.isCancelled;("boolean"===i&&!!v.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=v.isCancelled);var i=typeof v.pingLatency;("boolean"===i&&!!v.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=v.pingLatency);var i=typeof v.isAppInactive;("boolean"===i&&!!v.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=v.isAppInactive);var i=typeof v.isInCapacity;return("boolean"===i&&!!v.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=v.isInCapacity),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.SettingsAdminPortalTabSelectedLoggers&&(h.loggers=e.telemetry.SettingsAdminPortalTabSelectedLoggers),h}})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t){var i=[{name:"Gateways",blockType:1,consumerHostFlags:a.Web},{name:"Gateway",blockType:1,consumerHostFlags:a.Web},{name:"GatewaySettings",blockType:1,consumerHostFlags:a.Web},{name:"GatewayAdministrators",blockType:1,consumerHostFlags:a.Web},{name:"Datasource",blockType:1,consumerHostFlags:a.Web},{name:"DatasourceSettings",blockType:1,consumerHostFlags:a.Web},{name:"DatasourceUsers",blockType:1,consumerHostFlags:a.Web},{name:"SelectGateway",blockType:1,consumerHostFlags:a.Web},{name:"UpnMappingPane",blockType:2,consumerHostFlags:a.Web},{name:"AdminPortal",blockType:2,consumerHostFlags:a.Web},{name:"Auditing",blockType:2,consumerHostFlags:a.Web},{name:"DataClassifications",blockType:2,consumerHostFlags:a.Web},{name:"ManageUsers",blockType:2,consumerHostFlags:a.Web},{name:"TenantSettingsContainer",blockType:2,consumerHostFlags:a.Web},{name:"TenantSetting",blockType:2,consumerHostFlags:a.Web},{name:"UsageMetrics",blockType:2,consumerHostFlags:a.Web}];e.common.registerBuildingBlocksForHost(t,i,{directivesTarget:"powerbi.settings.directives",directivesMap:e.settings.directives,componentsTarget:"powerbi.settings.components",componentsMap:e.settings.components})}var a=e.common.HostEnv;angular.module("powerbi.settings",[]),angular.module("powerbi.settings.directives",[]),angular.module("powerbi.settings.components",[]),angular.module("powerbi.settings.controllers",[]),angular.module("powerbi.settings",["powerbi.common","powerbi.connectivity","powerbi.settings.directives","powerbi.settings.controllers"]).factory("selectGatewayService",["$rootScope","$compile","gatewaysMetadataService","modalDialogService","localizationService",function(t,i,a,n,o){return e.settings.createSelectGatewayService(t,i,a,n,o)}]).factory("gatewaysMetadataHttpService",[function(){return e.connectivity.createGatewaysMetadataHttpService()}]).factory("gatewaysMetadataService",["promiseFactory","gatewaysMetadataHttpService","telemetryService","featureSwitchService",function(t,i,a,n){return e.connectivity.createGatewaysMetadataService(t,i,a,n)}]).factory("gatewayDataService",["gatewaysMetadataService","promiseFactory","featureSwitchService","moduleLoader",function(t,i,a,n){return e.settings.createGatewayDataService(t,i,a,n)}]).factory("adminPortalHttp",[function(){return e.settings.createAdminPortalHttpService()}]).factory("adminPortal",["promiseFactory","adminPortalHttp","localizationService","telemetryService","$interval",function(t,i,a,n,o){return e.settings.createAdminPortalService(t,i,a,n,o)}]),t.registerBuildingBlocksForHost=i})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(){this.restrict="E",this.templateUrl="views/gatewaySettingsView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.GatewaySettingsController)}return i})();i.GatewaySettings=a})(i=t.directives||(t.directives={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.switchToUserTabEventName="gatewaySettingsSwitchToUserTab",e.dataSourceCreatedEventName="gatewaySettingsDataSourceCreated",e.onDirtyGatewaySelectionChanging="gatewayOnDirtyGatewaySelectionChanging",e.onGatewaySelectionChanged="gatewayOnGatewaySelectionChanged",e.discardAddingDataSourceEventName="gatewaySettingsDiscardAddingDataSource",e.addDataSourceEventName="gatewayAddDataSource",e.gatewaySelectionAppliedEventName="gatewaySettingsGatewaySelectionApplied",e.gatewaySelectionDiscardedEventName="gatewaySettingsGatewaySelectionDiscarded",e.selectGatewayStatusReadyEventName="gatewaySettingsSelectGatewayStatusReady",e.showGatewayUserMappingPaneEventName="showGatewayUserMappingPaneEvent",e.hideGatewayUserMappingPaneEventName="hideGatewayUserMappingPaneEvent",e.DataSourceTypePrefix="SettingsDataSourceType_",e.AuthenticationMethodPrefix="SettingsAuthenticationMethod_",e.LabelPrefix="SettingsLabel_",e.ServerError_ModelHasNoPowerBIDMMoniker="ModelHasNoPowerBIDMMoniker",e.TenantSettingFormName="tenantSettingForm",e.DataClassificationsFormName="dataClassificationsForm",e.AdminPortalNavigationStateName="landing.adminPortal",e.PublishContentPackTenantSwitchId=9,e.ExternalSharingTenantSwitchId=11,e.ExternalSharingV2TenantSwitchId=12,e.PublishToWebTenantSwitchId=13,e.ExportDataTenantSwitchId=14,e.RScriptVisualTenantSwitchId=15,e.CortanaTenantSwitchId=16,e.ExportPowerPointTenantSwitchId=17,e.OnPremAnalayzeInExcelTenantSwitchId=18,e.TemplatePublishTenantSwitchId=19,e.AuditingTenantSwitchId=21,e.EsriVisualTenantSwitchId=23,e.PrintingTenantSwitchId=24,e.UsageMetricsTenantSwitchId=29;var t;!(function(e){e[e.ExportAndSharing=1]="ExportAndSharing",e[e.ContentPack=2]="ContentPack",e[e.Integration=3]="Integration",e[e.RVisuals=4]="RVisuals",e[e.Audit=5]="Audit",e[e.Dashboard=6]="Dashboard",e[e.Others=7]="Others"})(t=e.TenantSettingsGroupName||(e.TenantSettingsGroupName={})),e.TenantSettingsGroups=[t.ExportAndSharing,t.ContentPack,t.Integration,t.RVisuals,t.Audit,t.Dashboard,t.Others],e.TenantSettingGroupMapping={11:t.ExportAndSharing,12:t.ExportAndSharing,13:t.ExportAndSharing,14:t.ExportAndSharing,17:t.ExportAndSharing,24:t.ExportAndSharing,9:t.ContentPack,19:t.ContentPack,16:t.Integration,18:t.Integration,23:t.Integration,15:t.RVisuals,21:t.Audit,29:t.Audit}})(t=e.constants||(e.constants={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e})();e.DataSourceSettingsModel=t})(t=e.models||(e.models={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.models.EmailsListModel,a=(function(){function e(){this.pendingUsers=new i,this.editableUsers=[],this.isAdding=!1,this.isReloadingList=!1}return e})();t.DataSourceUserModel=a})(i=t.models||(t.models={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=e.common.contracts.gateway.CredentialType,n=e.common.contracts.gateway.DataSourceType,o=e.connectivity.models.GatewayTabSelectionType,r=e.common.contracts.gateway.GatewayStatus,s=(function(){function i(){}return i.convertSettingsGateways=function(e){var t=this;return _.map(e,(function(e){return t.convertGateway(e)}))},i.convertGateway=function(e){var t=this.getGatewayAnnotation(e);return{displayName:e.gatewayName,id:e.gatewayId,isLoadingDataSources:!1,isLoadingStatus:!1,status:this.convertGatewayStatus(e.gatewayStatus),dataSources:[],isExpanded:!1,description:e.gatewayDescription,enableAutoUpdate:!1,joinImprovmentProgram:!1,administrators:null,tabSelectionType:o.Settings,publicKey:e.gatewayPublicKey,isWaitingForGatewayUpdate:!1,isDirty:!1,contactInformationString:null,connectionError:null,originalValues:null,traceDetails:null,contextMenuItem:null,gatewayAnnotation:t,staticCapabilities:null}},i.convertDataSources=function(e){var t=this;return _.map(e,(function(e){return t.convertDataSource(e)}))},i.convertDataSource=function(e){var t={id:e.dataSourceId,displayName:e.dataSourceName,onPremGatewayRequired:e.onPremGatewayRequired,dataSourceType:e.dataSourceType,connectionInfo:this.convertConnectionDetails(e.connectionDetails,e.credentialDetails),users:null,tabSelectionType:o.Settings,singleSignOnType:e.singleSignOnType};return t.dataSourceAnnotation=this.convertDataSourceAnnotation(e.dataSourceAnnotation),t},i.convertDataSourceAnnotation=function(t){var i={dataSourceAnnotationUPNMapping:{connectionStringPropertyName:e.common.contracts.gateway.ConnectionStringPropertyName.EffectiveUserName,mappingRules:[]}};if(!t)return i;try{return JSON.parse(t)}catch(e){return i}},i.convertUsers=function(e,t){var i=[{accessRight:t,principalList:e}];return i},i.convertToPrincipalAccessEntry=function(e,t){var i=[{accessRight:t,principalList:e}];return i},i.convertDiscoverDataSourceFeaturesToDataSourceTypeOptions=function(e){for(var i=this,o=[],r=0,s=e.dataSourceTypes;r<s.length;r++){var c=s[r];if(!_.isEmpty(n[c.dataSourceType])){var l=_.map(c.dataSourceCredentialTypes,(function(e){return{id:e,name:i.getLocalizedString(t.constants.AuthenticationMethodPrefix,a[e])}})),d=_.map(c.dataSourceLabels,(function(e){return{name:e.name,displayName:i.getLocalizedString(t.constants.LabelPrefix,e.name),type:i.getLabelType(e.name)}}));o[c.dataSourceType]={id:c.dataSourceType,name:this.getLocalizedString(t.constants.DataSourceTypePrefix,n[c.dataSourceType]),labels:d,authenticationMethodOptions:l}}}return o},i.convertAuthenticationParametersToCredentialData=function(e){return _.map(e,(function(e){return{name:e.name,value:e.value}}))},i.convertConnectionDetails=function(e,t){return{connetionDetails:e,credentialDetails:t}},i.getGatewayAnnotation=function(e){if(e.gatewayAnnotation)try{return JSON.parse(e.gatewayAnnotation)}catch(e){return null}return null},i.convertGatewayStatus=function(t){return t===r.Live?e.connectivity.models.GatewayStatus.Live:e.connectivity.models.GatewayStatus.NotReachable},i.getLocalizedString=function(t,i){var a=i.length>0?i.charAt(0).toUpperCase()+i.slice(1):"",n=e.common.localize.get("SettingsDataSource_"+t+a);return n||(n=a),n},i.getLabelType=function(e){switch(e.toLocaleLowerCase()){case"url":case"sharepointsiteurl":return"url";default:return"text"}},i})();i.GatewayModelConverter=s})(i=t.models||(t.models={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,i,a){this.modelId=e,this.selectedGatewayId=-1,this.title=null,this.showStatus=!0,this.showHeader=t,this.allowPersonalGateway=i,this.egwStatusLoaded=!1,this.isCloudScheduleRefresh=a,this.showNewPersonalGatewayAvailableMessage=!1,this.isDMTSPersonalGateway=!1}return e})();e.SelectGatewayModel=t})(t=e.models||(e.models={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.featureSwitches=[],this.tenantSettingsGroups=[],this.dataClassifications=[]}return e})();e.TenantSettings=t;var i=(function(){function e(e,t,i){this.name=e,this.displayName=t,this.tenantSettings=i}return e})();e.TenantSettingsGroup=i;var a=(function(){function e(e){this.contract=e,this.id=e.switchId,this.name=e.switchName,this.isEnabled=e.isEnabled,this.isGranular=e.isGranular}return e.prototype.equals=function(e){return!(!e||e.id!==this.id)&&this.isEnabled===e.isEnabled},e})();e.TenantSetting=a;var n=(function(){function e(e){this.contract=e}return e})();e.UsageMetricsDashboard=n})(t=e.models||(e.models={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a,n=e.common.contracts.ADUserMetaDataObjectType,o=e.common.models.EmailsListModel,r=e.common.contracts.GroupType,s=t.constants.TenantSettingGroupMapping,c=t.constants.TenantSettingsGroupName,l=t.constants.TenantSettingsGroups;!(function(e){function t(e,t){for(var i=[],a=0,n=e;a<n.length;a++){var o=n[a],r=u(o,t);r&&i.push(r)}return i}function a(e,t){for(var a=new i.TenantSettings,n=[],o=0,r=e.featureSwitches;o<r.length;o++){var s=r[o],c=u(s,t);c&&n.push(c)}return a.featureSwitches=n,a.tenantSettingsGroups=h(n,t),a.dataClassifications=e.dataClassifications,a}function d(e,t,i){var a=[{displayName:e.get("UsageMetrics"),type:1,requiredPermissionRole:1},{displayName:e.get("AdminPortal_ManageUsers"),type:2,requiredPermissionRole:1},{displayName:e.get("AdminPortal_TenantSettings"),type:4,requiredPermissionRole:1}];return t.featureSwitches.adminAuditingEnabled&&i&&"undefined"!=typeof window.o365AdminAuditingPageUrl&&a.splice(2,0,{displayName:e.get("AdminPortal_Auditing"),type:3,requiredPermissionRole:1}),t.featureSwitches.adminCapacityEnabled&&a.splice(4,0,{displayName:e.get("CapacityAdmin_ManageCapacity"),type:5,requiredPermissionRole:0}),a}
function u(e,t){var a=new i.TenantSetting(e);if(a.displayName=t.get("TenantSetting_"+a.name+"_Title"),a.description=t.getOptional("TenantSetting_"+a.name+"_Description"),a.privacy=g(a.name,t),a.group=s[a.id]||c.Others,a.allowedSecurityGroups=p(e.allowedSecurityGroups),a.deniedSecurityGroups=p(e.deniedSecurityGroups),a.enabledForSecurityGroupsInfoMessage=t.getOptional("TenantSetting_"+a.name+"_EnabledForSecurityGroupsInfoMessage"),a.disabledInfoMessage=t.getOptional("TenantSetting_"+a.name+"_DisabledInfoMessage"),a.displayName)return a}function g(e,t){var i,a="TenantSetting_"+e+"_Privacy";if(t.getOptional(a)){var n=t.getOptional("TenantSetting_"+e+"_PrivacyPolicyUrl"),o=t.getOptional("TenantSetting_"+e+"_PrivacyTermsUrl"),r=t.getOptional("TenantSetting_"+e+"_PrivacyLearnMoreUrl");return n&&o&&r&&(i={privacyPolicyUrl:n,termsOfUseUrl:o,learnMoreUrl:r}),{privacyKey:a,fragments:i}}}function p(e){var t=new o;return e&&(t.inputUserList=_.map(e,(function(e){return v(e)}))),t}function v(e){return{displayName:e.name,objectId:e.id,userPrincipalName:e.emailAddress,isSecurityGroup:!0,objectType:n.Group,groupType:e.emailAddress?r.EmailEnabledSecurityGroup:r.SecurityGroup}}function h(e,t){for(var a,n=[],o=0,r=l;o<r.length;o++){a=r[o];var s=y(e,a);if(0!==s.length||a===c.Dashboard){var d=t.get("TenantSettingsGroup_"+c[a]);n.push(new i.TenantSettingsGroup(a,d,s))}}return n}function y(e,t){return _.filter(e,(function(e){return e.group===t}))}e.convertTenantSettings=t,e.convertTenantSettingsV2=a,e.createAdminPortalOptions=d,e.convertTenantSetting=u})(a=i.AdminPortalModelFactory||(i.AdminPortalModelFactory={}))})(i=t.models||(t.models={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(e,i){this.scope=e,this.services=i;var a=i.gatewayDataService.selectedGatewayDatasource;a.dataSourceAnnotation&&a.dataSourceAnnotation.dataSourceAnnotationUPNMapping||(a.dataSourceAnnotation=t.models.GatewayModelConverter.convertDataSourceAnnotation("")),this.viewModel=_.cloneDeep(i.gatewayDataService.selectedGatewayDatasource.dataSourceAnnotation.dataSourceAnnotationUPNMapping),this.localizedOriginalName=i.localizationService.get("UpnMappingPane_OriginalName"),this.localizedNewName=i.localizationService.get("UpnMappingPane_NewName"),this.localizedResultOfApplyingMappingRule=i.localizationService.get("UpnMappingPane_AfterRuleAppliedPlaceHolder"),this.resetNewRule()}return i.createOptions=function(){return{additionalServices:["gatewayDataService","gatewaysMetadataService","localizationService","errorService","telemetryService","notificationToast"]}},i.prototype.addNewRule=function(){var e=this.newRule;this.viewModel.mappingRules.push({algorithm:e.algorithm,searchString:e.searchString,replacementString:e.replacementString}),this.resetNewRule()},i.prototype.deleteRule=function(){if(this.selectedRule){var e=this.viewModel.mappingRules.indexOf(this.selectedRule);this.viewModel.mappingRules.splice(e,1)}},i.prototype.testRule=function(){var e=this;this.testRuleOriginalName&&(this.isTestRuleRequestPending=!0,this.services.gatewaysMetadataService.getUPNMappingResult([this.testRuleOriginalName],this.viewModel).then((function(t){if(!_.isEmpty(t.upns)){var i=t.upns[0];e.testRuleNewName=i.result}}),(function(){e.services.errorService.error(e.services.localizationService.get("UpnMappingPane_FailToTestUPNRuleMessage"),"FailToTestUPNRuleMessage")})).finally((function(){e.isTestRuleRequestPending=!1})))},i.prototype.saveChangesAndExit=function(){var t=this;this.isUpdateDataSourceRequestPending=!0;var i=JSON.stringify({dataSourceAnnotationUPNMapping:{connectionStringPropertyName:this.viewModel.connectionStringPropertyName,mappingRules:this.viewModel.mappingRules}}),a=this.services.gatewayDataService.selectedGatewayDatasource,n=this.services.telemetryService.startEvent(e.telemetry.SettingsUpdateGatewayDatasourceUPNMapping);this.services.gatewaysMetadataService.updateDataSource(a.gateway.id,a.id,{dataSourceType:null,onPremGatewayRequired:null,connectionDetails:null,credentialDetails:null,dataSourceAnnotation:i,supportedAuthenticationTypes:null}).then((function(){a.dataSourceAnnotation.dataSourceAnnotationUPNMapping=_.cloneDeep(t.viewModel),t.closeUpnMappingPane(),t.services.notificationToast.notify({title:t.services.localizationService.get("UpnMappingPane_SuccessfulMessage"),notificationType:e.common.NotificationToastType.Info}),n.resolve()}),(function(){t.services.errorService.error(t.services.localizationService.get("UpnMappingPane_FailToUpdateMessage"),"FailToUpdateGatewayUPNMapping"),n.reject()})).finally((function(){t.isUpdateDataSourceRequestPending=!1}))},i.prototype.closeUpnMappingPane=function(){this.scope.$emit(t.constants.hideGatewayUserMappingPaneEventName)},i.prototype.selectPre=function(){var e=this.viewModel.mappingRules,t=e.indexOf(this.selectedRule);e.length>1&&t>0&&(this.selectedRule=e[t-1])},i.prototype.selectNext=function(){var e=this.viewModel.mappingRules,t=e.indexOf(this.selectedRule);e.length>1&&t<e.length-1&&(this.selectedRule=e[t+1])},i.prototype.resetNewRule=function(){this.newRule={algorithm:e.common.contracts.gateway.DataSourceAnnotationUPNMappingAlgorithm.SubstringReplacement,searchString:"",replacementString:""}},i})();i.UpnMappingPaneController=a})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.UpnMappingPane={templateUrl:"components/gateway/upnMappingPane/upnMappingPaneView.html",controller:e.common.createController(t.controllers.UpnMappingPaneController)}})(i=t.components||(t.components={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(i,a){var n=this;this.services=a,this.services.appMetadataService.getAppMetadata().then((function(e){var i=n.services.featureSwitchService;return n.adminCapacityEnabled=i.featureSwitches.adminCapacityEnabled,n.adminAuditingEnabled=i.featureSwitches.adminAuditingEnabled&&e.clusterFeatureSwitches.clusterAuditingEnabled,n.services.localizationService.ensureLocalization((function(){n.options=t.models.AdminPortalModelFactory.createAdminPortalOptions(n.services.localizationService,n.services.featureSwitchService,e.clusterFeatureSwitches.clusterAuditingEnabled)})),n.services.userInfo.userMetadataPromise})).then((function(t){n.options=_.filter(n.options,(function(e){return n.isOptionAllowed(e)})),n.services.telemetryService.logEvent(e.telemetry.SettingsAdminPortalTabSelected,n.getSelectedTabTelemetryName()),n.showOptionsList=!0}))}return i.createOptions=function(){return{additionalServices:["appMetadataService","featureSwitchService","localizationService","navigation","telemetryService","userInfo"]}},i.prototype.onActiveOptionChanged=function(e){this.services.navigation.navigateToAdminPortal(e)},i.prototype.getCurrentAdminPortalSettingsTab=function(){var e=this.services.navigation.currentAdminPortalSettingsTab;return!e&&_.any(this.options)?this.options[0].type:e},i.prototype.isOptionAllowed=function(e){return 1!==e.requiredPermissionRole||this.services.userInfo.userMetadata.isTenantAdmin},i.prototype.getSelectedTabTelemetryName=function(){var t=this.getCurrentAdminPortalSettingsTab();switch(t){case 3:return e.telemetry.AdminPortalTab.Auditing;case 1:return e.telemetry.AdminPortalTab.UsageMetrics;case 2:return e.telemetry.AdminPortalTab.ManageUsers;case 4:return e.telemetry.AdminPortalTab.TenantSettings;case 5:return e.telemetry.AdminPortalTab.CapacitySettings;default:return e.telemetry.AdminPortalTab.None}},i})();i.AdminPortalController=a})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.AdminPortal={controller:e.common.createController(t.controllers.AdminPortalController),templateUrl:"components/adminPortal/adminPortal/adminPortal.html"}})(i=t.components||(t.components={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){var a=this;this.scope=t,this.services=i;var n=this.services.$window;this.scope.auditingPageLanding=function(){n.open(window.o365AdminAuditingPageUrl,"_blank"),a.services.telemetryService.logEvent(e.telemetry.SettingsAdminAuditing)}}return t.createOptions=function(){return{additionalServices:["$window","telemetryService"]}},t})();t.AuditingController=i})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.Auditing={controller:e.common.createController(t.controllers.AuditingController),templateUrl:"components/adminPortal/auditing/auditing.html"}})(i=t.components||(t.components={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=e.errorDetailsHelper,n=(function(){function n(e,t){this.services=t}return n.createOptions=function(){return{additionalServices:["adminPortal","errorService","localizationService","notificationToast","telemetryService"]}},n.prototype.$onInit=function(){this.showDetails=!1,this.lastSavedViewModel=_.cloneDeep(this.viewModel),this.refreshDataClassificationsForm()},n.prototype.$postLink=function(){var e=this;this.dataClassificationsForm.validate=function(){return e.validateDataClassifications()}},n.prototype.getFormName=function(){return t.constants.DataClassificationsFormName},n.prototype.toggleDetailsView=function(){this.showDetails=!this.showDetails},n.prototype.applyChanges=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,n,o,r;return __generator(this,(function(s){switch(s.label){case 0:if(t=this.validateDataClassifications(),i=this.services.localizationService,!t)return[3,5];n=this.services.notificationToast.notify({title:i.get("AdminPortal_TenantSettings_Saving_Title"),message:i.get("AdminPortal_TenantSettings_Saving_Message"),notificationType:e.common.NotificationToastType.Loading}),o=this.services.telemetryService.startEvent(e.telemetry.SettingsUpdateDataClassifications,this.viewModel.length),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.services.adminPortal.updateDataClassifications(this.viewModel,o.event)];case 2:return s.sent(),this.lastSavedViewModel=_.cloneDeep(this.viewModel),this.services.notificationToast.hide(n),this.services.notificationToast.notify({title:i.get("AdminPortal_TenantSettings_DataClassification_Changed"),message:i.get("AdminPortal_TenantSettings_Success_Message"),notificationType:e.common.NotificationToastType.Success}),o.resolve(),[3,4];case 3:return r=s.sent(),this.services.notificationToast.hide(n),this.services.errorService.error(i.get("AdminPortal_TenantSettings_Failure_Message"),"FailedToApplyDataClassificationsChanges",{requestId:r.requestId,statusCode:r.status.toString()}),o.reject(a.getTelemetryErrorDetails(r.error,r.status)),[3,4];case 4:this.refreshDataClassificationsForm(),this.dataClassificationsForm.$setPristine(),s.label=5;case 5:return[2]}}))}))},n.prototype.cancelChanges=function(){this.viewModel=_.cloneDeep(this.lastSavedViewModel),this.refreshDataClassificationsForm(),this.dataClassificationsForm.$setPristine()},n.prototype.setDefaultDataClassification=function(e){for(var t=0,i=this.viewModel.length;t<i;t++)this.viewModel[t].default=t===e;this.dataClassificationsForm.$setDirty()},n.prototype.onDataClassificationToggled=function(){this.isEnabled?this.addDataClassification():this.viewModel=[]},n.prototype.addDataClassification=function(){var t=this.viewModel;t.push(new e.common.models.DataClassification),1===t.length&&(t[0].default=!0),this.dataClassificationsForm.$setDirty()},n.prototype.removeDataClassification=function(e){var t=this.viewModel,i=t[e].default;t.splice(e,1),i&&t.length>0&&(t[0].default=!0),0===t.length&&(this.isEnabled=!1),this.dataClassificationsForm.$setDirty()},n.prototype.validateDataClassifications=function(){if(this.isEnabled){for(var e={},t=0,i=0,a=this.viewModel.length;i<a;i++){var n=this.viewModel[i];if(!n.name)return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_MissingName"),!1;if(!n.shortHand||n.shortHand.length>4)return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_MissingShortHand"),!1;if(n.url&&0!==n.url.indexOf("http://")&&0!==n.url.indexOf("https://"))return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_WrongUrlFormat"),!1;n.default&&t++,e[n.shortHand]=e[n.shortHand]?e[n.shortHand]+1:1}if(this.viewModel.length>0&&1!==t)return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_NoDefault"),!1;for(var o in e)if(e[o]>1)return this.errorMessage=this.services.localizationService.get("AdminPortal_TenantSettings_DataClassificationTable_Error_ShortHandMustBeUnique"),!1}return this.errorMessage=void 0,!0},n.prototype.refreshDataClassificationsForm=function(){this.updateIsEnabled(),this.updateGranularityState(),this.updateStatusMessage(),this.errorMessage=void 0},n.prototype.updateIsEnabled=function(){this.isEnabled=!_.isEmpty(this.viewModel)},n.prototype.updateGranularityState=function(){this.granularityState=this.isEnabled?i.TenantSettingGranularityState.EnabledForEntireOrganization:i.TenantSettingGranularityState.Disabled},n.prototype.updateStatusMessage=function(){this.statusMessage=this.services.localizationService.get("TenantSettingStatus_"+i.TenantSettingGranularityState[this.granularityState])},n})();i.DataClassificationsController=n})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DataClassifications={bindings:{viewModel:"="},controller:e.common.createController(t.controllers.DataClassificationsController),templateUrl:"components/adminPortal/dataClassifications/dataClassifications.html"}})(i=t.components||(t.components={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=e.common.constants,n=e.errorDetailsHelper,o=t.constants.TenantSettingsGroupName,r=(function(){function i(i,a){var n=this;this.scope=i,this.services=a,this.scope.tenantSettings=new t.models.TenantSettings,this.scope.isLoading=!0,this.scope.hasChanges=!1,this.prepareUnsupportedSettings(),this.scope.dataClassificationToggle={enabled:!1},this.scope.isDataClassificationFeatureEnabled=this.services.featureSwitchService.featureSwitches.dataClassificationEnabled,this.scope.areGranularTenantControlsEnabled=this.services.featureSwitchService.featureSwitches.granularTenantControls;var o=this.services.telemetryService.startEvent(e.telemetry.SettingsGetTenantSettings);this.services.featureSwitchService.featureSwitches.dataClassificationEnabled?this.services.adminPortal.getTenantSettingsV2(o.event).then((function(e){n.scope.tenantSettings.featureSwitches=n.filterOutUnsupportedFeaturesSettings(e.featureSwitches),n.scope.tenantSettings.tenantSettingsGroups=e.tenantSettingsGroups,n.scope.tenantSettings.dataClassifications=e.dataClassifications,n.originalSettings=_.cloneDeep(n.scope.tenantSettings),n.scope.dataClassificationToggle.enabled=e.dataClassifications.length>0,n.scope.isLoading=!1})):this.services.adminPortal.getTenantSettings(o.event).then((function(e){n.scope.tenantSettings.featureSwitches=n.filterOutUnsupportedFeaturesSettings(e),n.originalSettings=_.cloneDeep(n.scope.tenantSettings),n.scope.isLoading=!1})),this.scope.updateFormState=function(){return n.updateFormState()},this.scope.applyChanges=function(){return n.applyChanges()},this.scope.cancelChanges=function(){return n.cancelChanges()},this.scope.addDataClassification=function(){return n.addDataClassification()},this.scope.removeDataClassification=function(e){return n.removeDataClassification(e)},this.scope.onDataClassificationToggled=function(){return n.onDataClassificationToggled()},this.scope.setDefaultDataClassification=function(e){return n.setDefaultDataClassification(e)},this.scope.isDashboardGroup=function(e){return n.isDashboardGroup(e)},this.registerRouteStateChangeEvent()}return i.createOptions=function(){return{additionalServices:["adminPortal","appMetadataService","errorService","featureSwitchService","localizationService","notificationToast","navigation","telemetryService"]}},i.prototype.$onDestroy=function(){this.routeStateChangeUnsubscribe()},i.prototype.registerRouteStateChangeEvent=function(){var e=this;this.routeStateChangeUnsubscribe=this.services.rootScope.$on(a.navigation.stateChangeStart,(function(i,a,n,o,r){e.scope.areGranularTenantControlsEnabled&&o&&o.name===t.constants.AdminPortalNavigationStateName&&e.isTenantSettingsFormDirty()&&(e.showSavePrompt(a,n),i.preventDefault())}))},i.prototype.showSavePrompt=function(e,t){var i=this,a=this.services.errorService.control(),n=this.services.localizationService;this.isTenantSettingsFormValid()?a.showPrompt(n.get("AdminPortal_TenantSettings_UnappliedChangesWarning_Title"),n.get("AdminPortal_TenantSettings_UnappliedChangesWarning_Message"),[new InJs.ModalDialogAction(n.get("ModalDialogButtonText_ApplyAll"),function(n,o){a.hideDialog(),i.routeStateChangeUnsubscribe(),i.applyChangesAndNavigateAwayIfSuccess(e,t)}),new InJs.ModalDialogAction(n.get("ModalDialogButtonText_DiscardAll"),function(n,o){a.hideDialog(),i.routeStateChangeUnsubscribe(),i.tenantSettingsForm.$setPristine(),i.navigateAway(e,t)}),new InJs.ModalDialogAction(n.get("ModalDialogButtonText_Cancel"),function(e,t){a.hideDialog()})]):a.showPrompt(n.get("AdminPortal_TenantSettings_UnappliedChangesWithErrors_Title"),n.get("AdminPortal_TenantSettings_UnappliedChangesWithErrors_Message"),[new InJs.ModalDialogAction(n.get("ModalDialogButtonText_FixErrors"),function(e,t){a.hideDialog()}),new InJs.ModalDialogAction(n.get("ModalDialogButtonText_DiscardChanges"),function(n,o){a.hideDialog(),i.routeStateChangeUnsubscribe(),i.tenantSettingsForm.$setPristine(),i.navigateAway(e,t)})])},i.prototype.isTenantSettingsFormDirty=function(){var e=this;return this.getDataClassificationsForm().$dirty||void 0!==_.find(this.scope.tenantSettings.featureSwitches,(function(t){return e.getTenantSettingForm(t.id).$dirty}))},i.prototype.isTenantSettingsFormValid=function(){var e=this;return this.getDataClassificationsForm().validate()&&void 0===_.find(this.scope.tenantSettings.featureSwitches,(function(t){return!e.getTenantSettingForm(t.id).validate()}))},i.prototype.getDataClassificationsForm=function(){return this.tenantSettingsForm["$ctrl."+t.constants.DataClassificationsFormName]},i.prototype.getTenantSettingForm=function(e){return this.tenantSettingsForm["$ctrl."+t.constants.TenantSettingFormName+e]},i.prototype.navigateAway=function(e,t){e&&e.name&&this.services.navigation.stateService.go(e.name,t)},i.prototype.isDashboardGroup=function(e){return e===o.Dashboard},i.prototype.setDefaultDataClassification=function(e){for(var t=0,i=this.scope.tenantSettings.dataClassifications.length;t<i;t++)this.scope.tenantSettings.dataClassifications[t].default=t===e;this.updateFormState()},i.prototype.onDataClassificationToggled=function(){this.scope.dataClassificationToggle.enabled?this.addDataClassification():this.scope.tenantSettings.dataClassifications=[],this.updateFormState()},i.prototype.addDataClassification=function(){var t=this.scope.tenantSettings.dataClassifications;t.push(new e.common.models.DataClassification),1===t.length&&(t[0].default=!0),this.updateFormState()},i.prototype.removeDataClassification=function(e){var t=this.scope.tenantSettings.dataClassifications,i=t[e].default;t.splice(e,1),i&&t.length>0&&(t[0].default=!0),0===t.length&&(this.scope.dataClassificationToggle.enabled=!1),this.updateFormState()},i.prototype.prepareUnsupportedSettings=function(){var e=this;this.unsupportedSettings=[];var i=!1;this.services.appMetadataService.getAppMetadata().then((function(a){i=a.clusterFeatureSwitches.clusterAuditingEnabled;var n=e.services.featureSwitchService.featureSwitches;n.scriptVisualEnabled||e.unsupportedSettings.push(t.constants.RScriptVisualTenantSwitchId),n.exportReportToPowerPointEnabled||e.unsupportedSettings.push(t.constants.ExportPowerPointTenantSwitchId),n.adminAuditingEnabled&&i||e.unsupportedSettings.push(t.constants.AuditingTenantSwitchId),n.clientUsageMetricsEnabled||e.unsupportedSettings.push(t.constants.UsageMetricsTenantSwitchId)}))},i.prototype.filterOutUnsupportedFeaturesSettings=function(e){for(var t=[],i=0,a=e;i<a.length;i++){var n=a[i];this.unsupportedSettings.indexOf(n.id)===-1&&t.push(n)}return t},i.prototype.updateFormState=function(){this.checkChanges()},i.prototype.applyChanges=function(){var t=this;if(this.scope.hasChanges){for(var i=this.services.notificationToast.notify({title:this.services.localizationService.get("AdminPortal_TenantSettings_Saving_Title"),message:this.services.localizationService.get("AdminPortal_TenantSettings_Saving_Message"),notificationType:e.common.NotificationToastType.Loading}),a=0,n=this.scope.tenantSettings.featureSwitches.length;a<n;a++)this.scope.tenantSettings.featureSwitches[a].contract.isEnabled=this.scope.tenantSettings.featureSwitches[a].isEnabled;var o=this.isDataClassificationSettingChanged();if(!_.isEmpty(this.scope.tenantSettings)){var r=this.services.telemetryService.startEvent(e.telemetry.SettingsUpdateTenantSettings);this.services.featureSwitchService.featureSwitches.dataClassificationEnabled?this.services.adminPortal.updateTenantSettingsConfigV2(this.scope.tenantSettings,r.event).then((function(){t.services.notificationToast.hide(i);for(var a=function(i,a){var n=t.scope.tenantSettings.featureSwitches[i],o=_.find(t.originalSettings.featureSwitches,(function(e){return e.id===n.id}));n.isEnabled!==o.isEnabled&&(o.isEnabled=n.isEnabled,t.services.telemetryService.logEvent(e.telemetry.SettingsUpdateTenantSetting,n.name,n.isEnabled,!1,!1,!1),t.services.notificationToast.notify({title:t.getSaveSuccessTitle(n),message:t.services.localizationService.get("AdminPortal_TenantSettings_Success_Message"),notificationType:e.common.NotificationToastType.Success}))},n=0,s=t.scope.tenantSettings.featureSwitches.length;n<s;n++)a(n,s);o&&(t.services.telemetryService.logEvent(e.telemetry.SettingsUpdateTenantSetting,"dataClassification",t.scope.tenantSettings.dataClassifications.length>0,!1,!1,!1),t.services.notificationToast.notify({title:t.services.localizationService.get("AdminPortal_TenantSettings_DataClassification_Changed"),message:t.services.localizationService.get("AdminPortal_TenantSettings_Success_Message"),notificationType:e.common.NotificationToastType.Success})),t.originalSettings.dataClassifications=_.cloneDeep(t.scope.tenantSettings.dataClassifications),r.resolve()}),(function(){t.services.notificationToast.hide(i),t.services.notificationToast.notify({title:t.services.localizationService.get("AdminPortal_TenantSettings_Failure_Title"),message:t.services.localizationService.get("AdminPortal_TenantSettings_Failure_Message"),notificationType:e.common.NotificationToastType.Error}),r.reject()})).finally((function(){t.checkChanges()})):this.services.adminPortal.updateTenantSettingsConfig(this.scope.tenantSettings.featureSwitches,r.event).then((function(){t.services.notificationToast.hide(i);for(var a=function(i,a){var n=t.scope.tenantSettings.featureSwitches[i],o=_.find(t.originalSettings.featureSwitches,(function(e){return e.id===n.id}));n.isEnabled!==o.isEnabled&&(o.isEnabled=n.isEnabled,t.services.telemetryService.logEvent(e.telemetry.SettingsUpdateTenantSetting,n.name,n.isEnabled,!1,!1,!1),t.services.notificationToast.notify({title:t.getSaveSuccessTitle(n),message:t.services.localizationService.get("AdminPortal_TenantSettings_Success_Message"),notificationType:e.common.NotificationToastType.Success}))},n=0,o=t.scope.tenantSettings.featureSwitches.length;n<o;n++)a(n,o);t.originalSettings.dataClassifications=_.cloneDeep(t.scope.tenantSettings.dataClassifications),r.resolve()}),(function(){t.services.notificationToast.hide(i),t.services.notificationToast.notify({title:t.services.localizationService.get("AdminPortal_TenantSettings_Failure_Title"),message:t.services.localizationService.get("AdminPortal_TenantSettings_Failure_Message"),notificationType:e.common.NotificationToastType.Error}),r.reject()})).finally((function(){t.checkChanges()}))}}},i.prototype.applyChangesAndNavigateAwayIfSuccess=function(t,i){return __awaiter(this,void 0,e.Promise,(function(){var a,o,r,s,c,l,d,u,g=this;return __generator(this,(function(p){switch(p.label){case 0:a=this.services.notificationToast.notify({title:this.services.localizationService.get("AdminPortal_TenantSettings_Saving_Title"),message:this.services.localizationService.get("AdminPortal_TenantSettings_Saving_Message"),notificationType:e.common.NotificationToastType.Loading}),o=this.services.telemetryService.startEvent(e.telemetry.SettingsUpdateTenantSettings),r=this.getDataClassificationsForm().$dirty?this.scope.tenantSettings.dataClassifications:void 0,s=_.filter(this.scope.tenantSettings.featureSwitches,(function(e){return g.getTenantSettingForm(e.id).$dirty})),p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.services.adminPortal.updateTenantSettingsAndDataClassifications(s,r,o.event)];case 2:for(p.sent(),this.services.notificationToast.hide(a),this.services.notificationToast.notify({title:this.services.localizationService.get("TenantSetting_SavingSucceededNotification_Title"),message:this.services.localizationService.get("TenantSetting_SavingNotification_Message"),notificationType:e.common.NotificationToastType.Success}),c=0,l=s;c<l.length;c++)d=l[c],this.services.telemetryService.logEvent(e.telemetry.SettingsUpdateTenantSetting,d.name,d.isEnabled,d.isGranular,d.allowedSecurityGroups&&!_.isEmpty(d.allowedSecurityGroups.inputUserList),d.deniedSecurityGroups&&!_.isEmpty(d.deniedSecurityGroups.inputUserList));return r&&this.services.telemetryService.logEvent(e.telemetry.SettingsUpdateDataClassifications,r.length),o.resolve(),this.tenantSettingsForm.$setPristine(),this.navigateAway(t,i),[3,4];case 3:return u=p.sent(),this.services.notificationToast.hide(a),this.services.errorService.error(this.services.localizationService.get("AdminPortal_TenantSettings_Failure_Message"),"FailedToApplyTenantSettingsChanges",{requestId:u.requestId,statusCode:u.status.toString()}),o.reject(n.getTelemetryErrorDetails(u.error,u.status)),[3,4];case 4:return[2]}}))}))},i.prototype.cancelChanges=function(){_.isEmpty(this.scope.tenantSettings)||(this.scope.tenantSettings=_.cloneDeep(this.originalSettings),this.scope.dataClassificationToggle.enabled=this.scope.tenantSettings.dataClassifications.length>0),this.scope.hasChanges=!1},i.prototype.checkChanges=function(){this.scope.hasChanges=!1;for(var e=function(e,i){var a=t.scope.tenantSettings.featureSwitches[e],n=_.find(t.originalSettings.featureSwitches,(function(e){return e.id===a.id}));if(a.isEnabled!==n.isEnabled)return t.scope.hasChanges=!0,{value:void 0}},t=this,i=0,a=this.scope.tenantSettings.featureSwitches.length;i<a;i++){var n=e(i,a);if("object"==typeof n)return n.value}if(this.isDataClassificationSettingChanged()){this.scope.hasChanges=!0;for(var o={},r=0,i=0,a=this.scope.tenantSettings.dataClassifications.length;i<a;i++){var s=this.scope.tenantSettings.dataClassifications[i];if(!s.name||!s.shortHand||s.shortHand.length>4)return void(this.scope.hasChanges=!1);if(s.url&&0!==s.url.indexOf("http://")&&s.url.indexOf("https://"))return void(this.scope.hasChanges=!1);s.default&&r++,o[s.shortHand]=o[s.shortHand]?o[s.shortHand]+1:1}if(this.scope.tenantSettings.dataClassifications.length>0&&1!==r)return void(this.scope.hasChanges=!1);for(var c in o)if(o[c]>1)return void(this.scope.hasChanges=!1)}},i.prototype.isDataClassificationSettingChanged=function(){if(this.scope.tenantSettings.dataClassifications.length!==this.originalSettings.dataClassifications.length)return!0;for(var e=function(e,i){var a=t.scope.tenantSettings.dataClassifications[e],n=_.find(t.originalSettings.dataClassifications,(function(e){return e.id===a.id}));for(var o in a)if("$$hashKey"!==o&&void 0!==n[o]&&a[o]!==n[o])return{value:!0}},t=this,i=0,a=this.scope.tenantSettings.dataClassifications.length;i<a;i++){var n=e(i,a);if("object"==typeof n)return n.value}return!1},i.prototype.getSaveSuccessTitle=function(e){if(e)return this.services.localizationService.format("AdminPortal_TenantSettings_Success_RadioButton_Title",[e.name,e.isEnabled?this.services.localizationService.get("AdminPortal_TenantSettings_ButtonText_Enabled"):this.services.localizationService.get("AdminPortal_TenantSettings_RadioButton_Disabled")])},i})();i.TenantSettingsContainerController=r})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.TenantSettingsContainer={controller:e.common.createController(t.controllers.TenantSettingsContainerController),templateUrl:"components/adminPortal/tenantSettingsContainer/tenantSettingsContainer.html"}})(i=t.components||(t.components={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a,n=t.models.AdminPortalModelFactory,o=e.errorDetailsHelper,r=e.common.models.EmailsListModel;!(function(e){e[e.Disabled=1]="Disabled",e[e.EnabledForEntireOrganization=2]="EnabledForEntireOrganization",e[e.EnabledForSpecificSecurityGroups=3]="EnabledForSpecificSecurityGroups"})(a=i.TenantSettingGranularityState||(i.TenantSettingGranularityState={}));var s=(function(){function i(e,t){this.services=t}return i.createOptions=function(){return{additionalServices:["adminPortal","errorService","localizationService","notificationToast","telemetryService"]}},i.prototype.$onInit=function(){this.showDetails=!1,this.refreshTenantSettingForm()},i.prototype.$postLink=function(){var e=this;this.tenantSettingForm=this[this.getFormName()],this.tenantSettingForm.validate=function(){return e.validateTenantSettingForm(e.services.localizationService)}},i.prototype.getFormName=function(){return t.constants.TenantSettingFormName+this.viewModel.id},i.prototype.toggleDetailsView=function(){this.showDetails=!this.showDetails},i.prototype.onEnabledToggleChange=function(){this.viewModel.isEnabled||(this.viewModel.allowedSecurityGroups=new r,this.viewModel.deniedSecurityGroups=new r),this.refreshTenantSettingForm()},i.prototype.onDeniedSecurityGroupsCheckboxChanged=function(){this.deniedSecurityGroupsEnabled||(this.viewModel.deniedSecurityGroups=new r)},i.prototype.onRadioGroupSelectionChanged=function(){this.granularityState===a.EnabledForEntireOrganization&&(this.viewModel.allowedSecurityGroups=new r)},i.prototype.applyChanges=function(){return __awaiter(this,void 0,e.Promise,(function(){var t,i,a,n,r,s;return __generator(this,(function(c){switch(c.label){case 0:if(t=this.services.localizationService,!this.validateTenantSettingForm(t))return[2];i=this.services.notificationToast.notify({title:t.get("TenantSetting_SavingNotification_Title"),message:t.get("TenantSetting_SavingNotification_Message"),notificationType:e.common.NotificationToastType.Loading}),a=this.viewModel,n=this.services.telemetryService.startEvent(e.telemetry.SettingsUpdateTenantSetting,a.name,a.isEnabled,a.isGranular,this.hasAllowedSecurityGroups(),this.hasDeniedSecurityGroups()),r=_.cloneDeep(this.viewModel.contract),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.services.adminPortal.updateTenantSetting(a,n.event)];case 2:return c.sent(),this.services.notificationToast.hide(i),this.services.notificationToast.notify({title:t.get("TenantSetting_SavingSucceededNotification_Title"),message:t.get("TenantSetting_SavingNotification_Message"),notificationType:e.common.NotificationToastType.Success}),n.resolve(),[3,4];case 3:return s=c.sent(),this.services.notificationToast.hide(i),
this.viewModel.contract=r,this.services.errorService.error(this.services.localizationService.get("TenantSetting_SavingFailedNotification_Message"),"FailedToApplyTenantSettingsChanges",{requestId:s.requestId,statusCode:s.status.toString()}),n.reject(o.getTelemetryErrorDetails(s.error,s.status)),[3,4];case 4:return this.refreshTenantSettingForm(),this.tenantSettingForm.$setPristine(),[2]}}))}))},i.prototype.cancelChanges=function(){this.viewModel=n.convertTenantSetting(this.viewModel.contract,this.services.localizationService),this.refreshTenantSettingForm(),this.tenantSettingForm.$setPristine()},i.prototype.showDisabledInfoMessage=function(){return this.viewModel.disabledInfoMessage&&this.tenantSettingForm.$dirty&&!this.viewModel.isEnabled},i.prototype.showEnabledForSecurityGroupsInfoMessage=function(){return this.viewModel.enabledForSecurityGroupsInfoMessage&&(this.granularityState===a.EnabledForSpecificSecurityGroups||this.deniedSecurityGroupsEnabled)},i.prototype.validateTenantSettingForm=function(e){var t=this.viewModel.allowedSecurityGroups,i=this.viewModel.deniedSecurityGroups;if(this.granularityState===a.EnabledForSpecificSecurityGroups&&t.validationTrigger&&!t.validationTrigger())return!1;if(this.deniedSecurityGroupsEnabled&&i.validationTrigger&&!i.validationTrigger())return!1;if(this.granularityState===a.EnabledForSpecificSecurityGroups&&this.deniedSecurityGroupsEnabled)for(var n=_.map(t.inputUserList,(function(e){return e.objectId})),o=_.map(i.inputUserList,(function(e){return e.objectId})),r=_.zipObject(o,o),s=0,c=n;s<c.length;s++){var l=c[s];if(r[l])return i.errorMessage=e.get("TenantSetting_DuplicateAllowedAndDeniedSecurityGroup"),i.hasValidationError=!0,!1}return!0},i.prototype.refreshTenantSettingForm=function(){this.updateGranularityState(),this.updateStatusMessage(),this.updateDeniedSecurityGroupsEnabled()},i.prototype.updateDeniedSecurityGroupsEnabled=function(){this.deniedSecurityGroupsEnabled=this.hasDeniedSecurityGroups()},i.prototype.updateGranularityState=function(){this.viewModel.isEnabled?this.hasAllowedSecurityGroups()?this.granularityState=a.EnabledForSpecificSecurityGroups:this.granularityState=a.EnabledForEntireOrganization:this.granularityState=a.Disabled},i.prototype.updateStatusMessage=function(){var e=this.services.localizationService;this.granularityState===a.EnabledForEntireOrganization&&this.hasDeniedSecurityGroups()?this.statusMessage=e.get("TenantSettingStatus_EnabledForSpecificSecurityGroups"):this.statusMessage=e.get("TenantSettingStatus_"+a[this.granularityState])},i.prototype.hasAllowedSecurityGroups=function(){return this.viewModel.allowedSecurityGroups&&!_.isEmpty(this.viewModel.allowedSecurityGroups.inputUserList)},i.prototype.hasDeniedSecurityGroups=function(){return this.viewModel.deniedSecurityGroups&&!_.isEmpty(this.viewModel.deniedSecurityGroups.inputUserList)},i})();i.TenantSettingController=s})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.TenantSetting={bindings:{viewModel:"<"},controller:e.common.createController(t.controllers.TenantSettingController),templateUrl:"components/adminPortal/tenantSetting/tenantSetting.html"}})(i=t.components||(t.components={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.services=t,this.scope.o365AdminUserPageUrl=window.o365AdminUserPageUrl}return e.createOptions=function(){return{additionalServices:["errorService","localizationService","adminPortal"]}},e})();e.ManageUsersController=t})(t=e.controllers||(e.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ManageUsers={controller:e.common.createController(t.controllers.ManageUsersController),templateUrl:"components/adminPortal/manageUsers/manageUsers.html"}})(i=t.components||(t.components={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.UsageMetrics={templateUrl:"components/adminPortal/usageMetrics/usageMetrics.html"}})(t=e.components||(e.components={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(e,i){var a=this;this.scope=e,this.services=i,this.scope.onTabSelected=function(e){return a.onTabSelected(e)},this.scope.$on(t.constants.switchToUserTabEventName,(function(e){return a.switchToUserTabListener(e)}))}return i.prototype.switchToUserTabListener=function(t){t.stopPropagation(),this.onTabSelected(e.connectivity.models.GatewayTabSelectionType.Users)},i.prototype.onTabSelected=function(e){this.scope.viewModel.tabSelectionType=e},i})();i.DataSourceController=a})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=e.common.contracts.gateway.CredentialType,n=e.common.contracts.gateway.DataSourceType,o=e.common.EncryptionContext,r=e.common.contracts.gateway.GatewayStaticCapabilities,s=e.common.contracts.gateway.PrivacyLevel,c=e.common.contracts.gateway.SingleSignOnType,l=(function(){function i(e,i){var a=this;this.scope=e,this.services=i,this.viewModel=this.scope.viewModel=new t.models.DataSourceSettingsModel,this.viewModel.isLoadingForm=!0,this.viewModel.advancedSettingsExpanded=!1,this.initEntropy(),this.initializePlaceholder(),this.initViewModelOptions().then((function(){a.loadViewModelData(),a.startWatchFormControl(),a.startWatchDataSourceModel()})),this.scope.tryDiscardChanges=function(){return a.tryDiscardChanges()},this.scope.tryAddDataSource=function(){return a.tryAddDataSource()},this.scope.tryApplyChanges=function(){return a.tryApplyChanges()},this.scope.switchToUserTab=function(){return a.switchToUserTab()},this.scope.onAuthenticationParameter1Change=function(){return a.onAuthenticationParameter1Change()},this.scope.onAuthenticationParameter1Focus=function(){return a.onAuthenticationParameter1Focus()},this.scope.onAuthenticationParameter1Blur=function(){return a.onAuthenticationParameter1Blur()},this.scope.onAuthenticationParameter2Change=function(){return a.onAuthenticationParameter2Change()},this.scope.onAuthenticationParameter2Focus=function(){return a.onAuthenticationParameter2Focus()},this.scope.onAuthenticationParameter2Blur=function(){return a.onAuthenticationParameter2Blur()},this.scope.onDataSourceTypeChange=function(){return a.onDataSourceTypeChange()},this.scope.onAuthenticationMethodChange=function(){return a.onAuthenticationMethodChange()},this.scope.enterpriseGatewayETLEnabled=this.services.featureSwitchService.featureSwitches.enterpriseGatewayETLEnabled,this.scope.allowSingleSignOn=function(){return a.allowSingleSignOn()},this.scope.onSingleSignOnSettingChange=function(){return a.onSingleSignOnSettingChange()}}return i.createOptions=function(){return{additionalServices:["errorService","featureSwitchService","localizationService","gatewaysMetadataService","promiseFactory","gatewayDataService"]}},i.prototype.initializePlaceholder=function(){i.Placeholder||("Google Inc."===navigator.vendor?i.Placeholder="":i.Placeholder="")},i.prototype.initEntropy=function(){var e=this;this.services.gatewaysMetadataService.getEntropy().then((function(t){if(e.entropy=[],t)for(var i=atob(t),a=i.length,n=0;n<a;n++)e.entropy.push(i.charCodeAt(n));else e.entropy=o.generateEntropy()}),(function(e){}))},i.prototype.initViewModelOptions=function(){var e=this,i=this.services.promiseFactory.defer();return this.services.gatewaysMetadataService.discoverDataSourceFeatures().then((function(i){e.viewModel.dataSourceTypeOptions=t.models.GatewayModelConverter.convertDiscoverDataSourceFeaturesToDataSourceTypeOptions(i)}),(function(e){})).finally((function(){i.resolve(null)})),i.promise},i.prototype.startWatchFormControl=function(){var e=this,t=this.scope.$watch("settingsForm",(function(i){i&&(e.scope.dataSourceModel.isDirty=function(){return i.$dirty},e.viewModel.isAddingDataSource&&e.scope.settingsForm.$setDirty(),t())}))},i.prototype.startWatchDataSourceModel=function(){var e=this;this.scope.$watch("dataSourceModel",(function(t,i){i!==t&&(e.loadViewModelData(),e.scope.dataSourceModel.isDirty=function(){return e.scope.settingsForm.$dirty})}))},i.prototype.loadViewModelData=function(){var e=this.scope.dataSourceModel,t=this.viewModel,a=t.isAddingDataSource=e.id<0,n=a?void 0:e.connectionInfo.credentialDetails.credentialType,o=a?void 0:JSON.parse(e.connectionInfo.connetionDetails);if(t.editableSettings={dataSourceName:e.displayName,dataSourceType:e.dataSourceType,authenticationMethod:n,authenticationParameters:a?this.initAuthenticationParameters(e.dataSourceType,n):this.initAuthenticationParameters(e.dataSourceType,n,[i.Placeholder,i.Placeholder]),authenticationParameter1Edited:!1,authenticationParameter2Edited:!1,privacyLevel:a?s.Organizational:e.connectionInfo.credentialDetails.privacyLevel,singleSignOnType:e.singleSignOnType},!a)for(var r=0,l=this.viewModel.dataSourceTypeOptions[e.dataSourceType].labels;r<l.length;r++){var d=l[r];t.editableSettings[d.name]=o[d.name]}t.waitingForDataSourceStatus=!1,t.hasTestConnectionFailure=!1,t.isLoadingForm=!1,t.messageState=0,e.compositeErrorMessage="",this.scope.settingsForm&&(a?this.scope.settingsForm.$setDirty():this.scope.settingsForm.$setPristine()),t.isSingleSignOnEnabled=null!=e.singleSignOnType&&e.singleSignOnType!==c.None,this.isSingleSignOnOptionChanged=!1},i.prototype.getUserNameLabel=function(t){return t===e.common.contracts.gateway.DataSourceType.File||t===e.common.contracts.gateway.DataSourceType.Folder?this.services.localizationService.get("SettingsDataSource_SettingsWindowsUsername"):this.services.localizationService.get("SettingsDataSource_SettingsUsername")},i.prototype.getPasswordLabel=function(t){return t===e.common.contracts.gateway.DataSourceType.File||t===e.common.contracts.gateway.DataSourceType.Folder?this.services.localizationService.get("SettingsDataSource_SettingsWindowsPassword"):this.services.localizationService.get("SettingsDataSource_SettingsPassword")},i.prototype.initAuthenticationParameters=function(e,t,i){var n=[];if(null!=t)switch(t){case a.NotSpecified:case a.Anonymous:break;case a.Basic:case a.Windows:i||(i=["",""]),n.push({name:"username",value:i[0],displayName:this.getUserNameLabel(e),shouldDisplay:!0}),n.push({name:"password",value:i[1],displayName:this.getPasswordLabel(e),shouldDisplay:!0})}return n},i.prototype.getDefaultAuthenticationMethod=function(){var e=this.viewModel.editableSettings,t=this.viewModel.dataSourceTypeOptions[e.dataSourceType].authenticationMethodOptions;if(1===t.length)return t[0].id},i.prototype.onDataSourceTypeChange=function(){for(var e=this.viewModel.editableSettings,t=this.getDefaultAuthenticationMethod(),i=0,a=this.viewModel.dataSourceTypeOptions[e.dataSourceType].labels;i<a.length;i++){var n=a[i];e[n.name]=""}e.authenticationMethod=t,e.authenticationParameters=this.initAuthenticationParameters(this.viewModel.dataSourceTypeOptions[e.dataSourceType].id,t),e.authenticationParameter1Edited=!1,e.authenticationParameter2Edited=!1},i.prototype.onAuthenticationMethodChange=function(){this.scope.viewModel.editableSettings.authenticationParameters=this.initAuthenticationParameters(this.scope.viewModel.dataSourceTypeOptions[this.scope.viewModel.editableSettings.dataSourceType].id,this.scope.viewModel.editableSettings.authenticationMethod,["",""]),this.scope.viewModel.editableSettings.authenticationParameter1Edited=!0,this.scope.viewModel.editableSettings.authenticationParameter2Edited=!0},i.prototype.tryDiscardChanges=function(){var e=this;this.showDiscardPopup().then((function(){e.viewModel.isAddingDataSource?e.scope.$emit(t.constants.discardAddingDataSourceEventName):e.loadViewModelData()}))},i.prototype.showDiscardPopup=function(){var e=this.services.promiseFactory.defer(),t=this.services.errorService,i=t.control(),a=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),o=[new InJs.ModalDialogAction(a,function(t,a){i.hideDialog(),e.resolve(null)}),new InJs.ModalDialogAction(n,function(t,a){i.hideDialog(),e.reject()})],r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),s=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_DataSourceMessage");return i.showCustomDialog(r,$("<div/>").text(s),o,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0),e.promise},i.prototype.onAuthenticationParameter1Change=function(){this.viewModel.editableSettings.authenticationParameters.length>1&&!this.viewModel.editableSettings.authenticationParameter2Edited&&(this.viewModel.editableSettings.authenticationParameters[1].value="",this.viewModel.editableSettings.authenticationParameter2Edited=!0),this.viewModel.editableSettings.authenticationParameter1Edited=!0},i.prototype.onAuthenticationParameter1Focus=function(){this.viewModel.isAddingDataSource||this.viewModel.editableSettings.authenticationParameter1Edited||(this.viewModel.editableSettings.authenticationParameters[0].value="")},i.prototype.onAuthenticationParameter1Blur=function(){this.viewModel.isAddingDataSource||this.viewModel.editableSettings.authenticationParameter1Edited||(this.viewModel.editableSettings.authenticationParameters[0].value=i.Placeholder)},i.prototype.onAuthenticationParameter2Change=function(){this.viewModel.editableSettings.authenticationParameter1Edited||(this.viewModel.editableSettings.authenticationParameters[0].value="",this.viewModel.editableSettings.authenticationParameter1Edited=!0),this.viewModel.editableSettings.authenticationParameter2Edited=!0},i.prototype.onAuthenticationParameter2Focus=function(){this.viewModel.isAddingDataSource||this.viewModel.editableSettings.authenticationParameter2Edited||(this.viewModel.editableSettings.authenticationParameters[1].value="")},i.prototype.onAuthenticationParameter2Blur=function(){this.viewModel.isAddingDataSource||this.viewModel.editableSettings.authenticationParameter2Edited||(this.viewModel.editableSettings.authenticationParameters[1].value=i.Placeholder)},i.prototype.isDataSourceNameUnique=function(e,t){return!_.find(this.scope.dataSourceModel.gateway.dataSources,(function(i){return i.displayName===e&&i!==t}))},i.prototype.tryAddDataSource=function(){var e=this;if(this.isFormValid()){var i=this.scope.dataSourceModel,a=this.viewModel.editableSettings,n=i.gateway,o=this.services.gatewayDataService.getDecodedPublicKey(i.gateway.publicKey),r={credentialData:t.models.GatewayModelConverter.convertAuthenticationParametersToCredentialData(this.viewModel.editableSettings.authenticationParameters)};this.services.gatewayDataService.encryptCredentials(r,o,a.authenticationMethod,this.entropy).then((function(i){e.viewModel.waitingForDataSourceStatus=!0,i.privacyLevel=a.privacyLevel;var o={dataSourceName:a.dataSourceName,dataSourceType:a.dataSourceType,onPremGatewayRequired:!0,connectionDetails:e.getConnectionDetailsString(),credentialDetails:i,supportedAuthenticationTypes:null,singleSignOnType:e.viewModel.singleSignOnType};e.services.gatewayDataService.createDataSourceWithRetry(n,o,a.authenticationParameters,e.entropy).then((function(i){e.viewModel.waitingForDataSourceStatus=!1,e.scope.dataSourceModel.id=i.dataSourceId,e.scope.dataSourceModel.displayName=i.dataSourceName,e.scope.dataSourceModel.dataSourceType=i.dataSourceType,e.scope.dataSourceModel.connectionInfo.connetionDetails=i.connectionDetails,e.scope.dataSourceModel.connectionInfo.credentialDetails=i.credentialDetails,e.scope.dataSourceModel.dataSourceAnnotation=t.models.GatewayModelConverter.convertDataSourceAnnotation(""),e.scope.dataSourceModel.singleSignOnType=i.singleSignOnType,e.loadViewModelData(),e.scope.dataSourceModel.connected=!0,e.scope.dataSourceModel.connectionError=null,e.viewModel.messageState=1,e.scope.$emit(t.constants.dataSourceCreatedEventName,[i.dataSourceId])}),(function(t){e.showDataSourceError(t),e.scope.dataSourceModel.connected=!1}))}))}},i.prototype.tryApplyChanges=function(){var e=this;if(this.isFormValid()){var i=this.scope.dataSourceModel,a=this.viewModel.editableSettings,n=i.gateway,o=i.id;if(this.isSingleSignOnOptionChanged&&this.allowSingleSignOn()&&this.services.gatewaysMetadataService.updateDataSource(n.id,o,{dataSourceType:null,onPremGatewayRequired:null,connectionDetails:null,credentialDetails:null,dataSourceAnnotation:null,supportedAuthenticationTypes:null,singleSignOnType:this.viewModel.singleSignOnType}).then((function(){e.scope.dataSourceModel.singleSignOnType=e.viewModel.singleSignOnType,e.isCredentialsEdited()?e.isSingleSignOnOptionChanged=!1:e.loadViewModelData()}),(function(t){e.showDataSourceError(t)})),this.isCredentialsEdited()){var r=this.services.gatewayDataService.getDecodedPublicKey(i.gateway.publicKey),s={credentialData:t.models.GatewayModelConverter.convertAuthenticationParametersToCredentialData(this.viewModel.editableSettings.authenticationParameters)};this.services.gatewayDataService.encryptCredentials(s,r,a.authenticationMethod,this.entropy).then((function(t){e.viewModel.waitingForDataSourceStatus=!0,t.privacyLevel=a.privacyLevel,e.services.gatewayDataService.updateCredentialsWithRetry(n,o,a.authenticationParameters,t,e.entropy).then((function(){e.viewModel.waitingForDataSourceStatus=!1,e.scope.dataSourceModel.connectionInfo.credentialDetails.credentialType=e.viewModel.editableSettings.authenticationMethod,e.scope.dataSourceModel.connectionInfo.credentialDetails.privacyLevel=e.viewModel.editableSettings.privacyLevel,e.loadViewModelData(),e.scope.dataSourceModel.connected=!0,e.scope.dataSourceModel.connectionError=null}),(function(t){e.showDataSourceError(t),e.viewModel.hasTestConnectionFailure=!0}))}))}}},i.prototype.isFormValid=function(){return!this.scope.settingsForm.$invalid&&(!(this.viewModel.isAddingDataSource&&!this.isDataSourceNameUnique(this.viewModel.editableSettings.dataSourceName,this.scope.dataSourceModel))||(this.scope.dataSourceModel.errorTitle="",this.scope.dataSourceModel.compositeErrorMessage=this.services.localizationService.get("SettingsDatasources_DuplicateDataSourceName"),this.viewModel.messageState=2,!1))},i.prototype.switchToUserTab=function(){this.scope.$emit(t.constants.switchToUserTabEventName)},i.prototype.getConnectionDetailsString=function(){for(var e={},t=this.viewModel.dataSourceTypeOptions[this.viewModel.editableSettings.dataSourceType].labels,i=0,a=t;i<a.length;i++){var n=a[i];e[n.name]=this.viewModel.editableSettings[n.name]}return JSON.stringify(e)},i.prototype.getDataSourceName=function(e){var t=this.viewModel.dataSourceTypeOptions[e.dataSourceType].labels;return t.length>0?e[t[0].name]:""},i.prototype.showDataSourceError=function(t){var i=this,a=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(t.error);a.always((function(a){var n=e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code,o=i.services.localizationService.get(n);"ServerError_DMTS_DuplicateDatasourceError"===n?(i.scope.dataSourceModel.errorTitle="",i.scope.dataSourceModel.compositeErrorMessage=o):(i.scope.dataSourceModel.errorTitle=i.services.localizationService.get("SettingsDataSource_SettingsConnectionErrorTitle"),i.scope.dataSourceModel.compositeErrorMessage=i.services.localizationService.format("SettingsDataSource_SettingsConnectionErrorMessage",[i.getDataSourceName(i.viewModel.editableSettings),o]));var r=[];if(a&&a.displayableErrorInfo)for(var s=0;s<a.displayableErrorInfo.length;s++){var c=a.displayableErrorInfo[s];r.push({key:c.errorInfoKey,value:c.errorInfoValue})}i.scope.dataSourceModel.traceDetails={requestId:t.requestId,activityId:t.activityId,clusterUri:clusterUri,errorCode:t.status.toString(),error:t.error.code,details:r,time:(new Date).toString(),version:e.build,linkText:i.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"},i.viewModel.waitingForDataSourceStatus=!1,i.viewModel.messageState=2}))},i.prototype.allowSingleSignOn=function(){return null!=this.scope.dataSourceModel.gateway&&null!=this.scope.dataSourceModel.gateway.staticCapabilities&&(this.scope.dataSourceModel.gateway.staticCapabilities&r.DirectQuerySingleSignOn_Kerberos)===r.DirectQuerySingleSignOn_Kerberos&&this.doDatasourcetypeSupportSingleSignOn(this.viewModel.editableSettings.dataSourceType)},i.prototype.doDatasourcetypeSupportSingleSignOn=function(e){switch(e){case n.SqlServer:case n.Oracle:case n.SAP:case n.Teradata:return!0;default:return!1}},i.prototype.onSingleSignOnSettingChange=function(){this.viewModel.singleSignOnType=this.viewModel.isSingleSignOnEnabled?c.Kerberos:c.None,this.isSingleSignOnOptionChanged=!this.isSingleSignOnOptionChanged},i.prototype.isCredentialsEdited=function(){return this.viewModel.editableSettings.authenticationParameter1Edited||this.viewModel.editableSettings.authenticationParameter2Edited},i})();i.DataSourceSettingsController=l})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=e.common.contracts.gateway.AccessRight,n=e.common.contracts.gateway.DataSourceType,o=(function(){function i(e,i){var a=this;this.scope=e,this.services=i,this.dataSourceModel=e.dataSourceModel,this.viewModel=this.scope.viewModel=new t.models.DataSourceUserModel,this.scope.tryAddUsers=function(){return a.tryAddUsers()},this.scope.tryRemoveSelectedUsers=function(){return a.tryRemoveSelectedUsers()},this.scope.shouldDisableRemoveButton=function(){return a.shouldDisableRemoveButton()},this.scope.mapUserNames=function(){return a.mapUserNames()},this.getDataSourceUsers(),this.setupUpnMappingButton(),this.startWatchDataSourceModel(),this.scope.dataSourceModel.isDirty=function(){return!1}}return i.createOptions=function(){return{additionalServices:["errorService","localizationService","gatewaysMetadataService","telemetryService"]}},i.prototype.startWatchDataSourceModel=function(){var e=this;this.scope.$watch("dataSourceModel",(function(t,i){i!==t&&(e.dataSourceModel=e.scope.dataSourceModel,e.getDataSourceUsers(),e.setupUpnMappingButton())}))},i.prototype.setupUpnMappingButton=function(){this.scope.upnMappingEnabled=this.dataSourceModel&&this.dataSourceModel.dataSourceType===n.AnalysisServices},i.prototype.tryAddUsers=function(){var i=this;this.viewModel.pendingUsers.validationTrigger()&&(this.viewModel.isAdding=!0,this.validateEmailAddresses(),this.viewModel.pendingUsers.validEmailsList.length>0?this.services.gatewaysMetadataService.addDataSourcePrincipals(this.dataSourceModel.gateway.id,this.dataSourceModel.id,t.models.GatewayModelConverter.convertUsers(this.viewModel.pendingUsers.validEmailsList,a.read)).then((function(){i.viewModel.isAdding=!1,i.viewModel.pendingUsers.inputUserList=[],i.getDataSourceUsers()}),(function(t){i.viewModel.isAdding=!1,i.services.errorService.error(i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"AddDataSourceUser_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})})):(this.viewModel.isAdding=!1,this.viewModel.pendingUsers.inputUserList=[]))},i.prototype.validateEmailAddresses=function(){this.viewModel.pendingUsers.validEmailsList=_.unique(this.arrayStringsToLowerCase(this.viewModel.pendingUsers.validEmailsList));var e=this.arrayStringsToLowerCase(_.map(this.viewModel.editableUsers,(function(e){return e.emailAddress})));this.viewModel.pendingUsers.validEmailsList=_.difference(this.viewModel.pendingUsers.validEmailsList,e)},i.prototype.arrayStringsToLowerCase=function(e){var t=_.map(e,(function(e){return e.toLowerCase()}));return t},i.prototype.tryRemoveSelectedUsers=function(){var i=this,n=_.filter(this.viewModel.editableUsers,(function(e){return e.shouldBeRemoved})),o=_.map(n,(function(e){return{objectId:e.objectId,principalType:e.principalType}}));this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.deleteDataSourcePrincipals(this.dataSourceModel.gateway.id,this.dataSourceModel.id,t.models.GatewayModelConverter.convertToPrincipalAccessEntry(o,a.none)).then((function(){i.getDataSourceUsers()}),(function(t){i.viewModel.isReloadingList=!1,i.services.errorService.error(i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"AddDataSourceUser_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},i.prototype.getDataSourceUsers=function(){var t=this;this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.getDataSourcePrincipals(this.dataSourceModel.gateway.id,this.dataSourceModel.id).then((function(e){var i=_.filter(e,(function(e){return e.accessRight===a.read||e.accessRight===a.write})),n=_.flatten(_.map(i,(function(e){return e.principalList})));t.viewModel.editableUsers=_.map(n,(function(e){var t=e.givenName?e.givenName:e.displayName,i=e.familyName?e.familyName:"";return{objectId:e.objectId,name:t+" "+i,emailAddress:e.emailAddress,principalType:e.principalType,shouldBeRemoved:!1}})),t.viewModel.isReloadingList=!1}),(function(i){t.services.errorService.error(t.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+i.error.code),"GetDataSourceUsers_Error",{requestId:i.requestId,ecsCorrelationId:i.activityId,statusCode:i.status.toString()}),t.viewModel.isReloadingList=!1}))},i.prototype.shouldDisableRemoveButton=function(){return _.all(this.viewModel.editableUsers,(function(e){return!e.shouldBeRemoved}))},i.prototype.mapUserNames=function(){this.services.telemetryService.logEvent(e.telemetry.SettingsOpenGatewayDatasourceUPNMappingPane),this.scope.$emit(t.constants.showGatewayUserMappingPaneEventName)},i})();i.DataSourceUsersController=o})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=e.common.contracts.gateway.AccessRight,n=(function(){function i(e,i){var a=this;this.scope=e,this.services=i,this.gatewayModel=e.gatewayModel,this.viewModel=this.scope.viewModel=new t.models.DataSourceUserModel,this.scope.tryAddAdministrators=function(){return a.tryAddAdministrators()},this.scope.tryRemoveSelectedAdminstrators=function(){return a.tryRemoveSelectedAdministrators()},this.scope.shouldDisableRemoveButton=function(){return a.shouldDisableRemoveButton()},this.getGatewayAdministrators(),this.startWatchGatewayModel()}return i.createOptions=function(){return{additionalServices:["errorService","localizationService","gatewaysMetadataService"]}},i.prototype.startWatchGatewayModel=function(){var e=this;this.scope.$watch("gatewayModel",(function(t,i){i!==t&&(e.gatewayModel=e.scope.gatewayModel,e.getGatewayAdministrators())}))},i.prototype.tryAddAdministrators=function(){var i=this;this.viewModel.pendingUsers.validationTrigger()&&(this.viewModel.isAdding=!0,this.validateEmailAddresses(),this.viewModel.pendingUsers.validEmailsList.length>0?this.services.gatewaysMetadataService.addGatewayPrincipals(this.gatewayModel.id,t.models.GatewayModelConverter.convertUsers(this.viewModel.pendingUsers.validEmailsList,a.read|a.write)).then((function(){i.viewModel.isAdding=!1,i.viewModel.pendingUsers.inputUserList=[],i.getGatewayAdministrators()}),(function(t){i.viewModel.isAdding=!1,i.services.errorService.error(i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"AddGatewayAdmin_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})})):(this.viewModel.isAdding=!1,this.viewModel.pendingUsers.inputUserList=[]))},i.prototype.validateEmailAddresses=function(){this.viewModel.pendingUsers.validEmailsList=_.unique(this.arrayStringsToLowerCase(this.viewModel.pendingUsers.validEmailsList));var e=this.arrayStringsToLowerCase(_.map(this.viewModel.editableUsers,(function(e){return e.emailAddress})));this.viewModel.pendingUsers.validEmailsList=_.difference(this.viewModel.pendingUsers.validEmailsList,e)},i.prototype.arrayStringsToLowerCase=function(e){var t=_.map(e,(function(e){return e.toLowerCase()}));return t},i.prototype.tryRemoveSelectedAdministrators=function(){var i=this,n=_.filter(this.viewModel.editableUsers,(function(e){return e.shouldBeRemoved})),o=_.map(n,(function(e){return{objectId:e.objectId,principalType:e.principalType}}));this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.deleteGatewayPrincipals(this.gatewayModel.id,t.models.GatewayModelConverter.convertToPrincipalAccessEntry(o,a.none)).then((function(){i.getGatewayAdministrators()}),(function(t){i.viewModel.isReloadingList=!1,i.services.errorService.error(i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"AddGatewayAdmin_Error",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},i.prototype.getGatewayAdministrators=function(){var t=this;this.viewModel.isReloadingList=!0,this.services.gatewaysMetadataService.getGatewayPrincipals(this.gatewayModel.id).then((function(e){var i=_.filter(e,(function(e){return e.accessRight&(a.read|a.write)})),n=_.flatten(_.map(i,(function(e){return e.principalList})));t.viewModel.editableUsers=_.map(n,(function(e){var t=e.givenName?e.givenName:e.displayName,i=e.familyName?e.familyName:"";return{objectId:e.objectId,name:t+" "+i,emailAddress:e.emailAddress,principalType:e.principalType,shouldBeRemoved:!1}})),t.viewModel.isReloadingList=!1}),(function(i){t.services.errorService.error(t.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+i.error.code),"GetGatewaysAdmins_Error",{requestId:i.requestId,ecsCorrelationId:i.activityId,statusCode:i.status.toString()}),t.viewModel.isReloadingList=!1}))},i.prototype.shouldDisableRemoveButton=function(){return _.all(this.viewModel.editableUsers,(function(e){return!e.shouldBeRemoved}))},i})();i.GatewayAdministratorsController=n})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.onTabSelected=function(e){return i.onTabSelected(e)}}return e.prototype.onTabSelected=function(e){this.scope.viewModel.tabSelectionType=e},e})();e.GatewayController=t})(t=e.controllers||(e.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=e.connectivity.models.DataSourceContextMenuItemModel,n=e.connectivity.models.GatewayContextMenuItemModel,o=e.connectivity.models.GatewayStatus,r=e.connectivity.models.GatewayTabSelectionType,s=(function(){function i(e,i){var a=this;this.scope=e,this.services=i,this.scope.onItemSelected=function(e,t){return a.onItemSelected(e,t)},this.scope.getSelectionType=function(){return a.getSelectionType()},this.scope.tryAddDataSource=function(){return a.tryAddDataSource(a.scope.viewModel.currentGateway)},this.scope.testConnections=function(){return a.testConnections()},this.scope.isLoading=!1,this.loadGateways(),this.scope.$on(t.constants.dataSourceCreatedEventName,(function(e,t){return a.updateCurrentDataSource(e,t[0])})),this.scope.$on(t.constants.discardAddingDataSourceEventName,(function(e){return a.discardAddingDataSource(e)})),this.scope.$on(t.constants.addDataSourceEventName,(function(e){return a.tryAddDataSource(a.scope.viewModel.currentGateway)}))}return i.createOptions=function(){return{additionalServices:["errorService","gatewayDataService","gatewaysMetadataService","localizationService","navigation","promiseFactory"]}},i.prototype.updateCurrentDataSource=function(e,t){e.stopPropagation(),this.scope.viewModel.currentDataSourceId=t,
this.loadDataSourceContextMenu(this.scope.viewModel.currentDataSource)},i.prototype.discardAddingDataSource=function(e){e.stopPropagation(),this.scope.viewModel.currentGateway.dataSources.pop(),this.openItem(this.scope.viewModel.currentGatewayId,null)},i.prototype.gatewayExists=function(e){var t=_.find(this.scope.viewModel.gateways,(function(t){return t.id===e}));return null!==t&&void 0!==t},i.prototype.dataSourceExists=function(e,t){var i=_.find(e.dataSources,(function(e){return e.id===t}));return null!==i&&void 0!==i},i.prototype.tryInitializeGatewaySelection=function(){if(this.scope.viewModel.gateways.length>0){var e=this.services.navigation,t=e?e.gatewayId:null,i=e?e.dataSourceId:null;null!==t&&this.gatewayExists(t)?i||this.onItemSelected(t,null):(t=this.scope.viewModel.gateways[0].id,this.onItemSelected(t,null))}},i.prototype.tryInitializeDataSourceSelection=function(e){var t=this.services.navigation,i=t?t.gatewayId:null,a=t?t.dataSourceId:null;e.id===i&&a&&(a===-1?(this.onItemSelected(i,null),this.tryAddDataSource(e)):this.dataSourceExists(e,a)?this.onItemSelected(i,a):this.onItemSelected(i,null))},i.prototype.loadGateways=function(){var e=this;this.scope.isLoading=!0,this.services.gatewaysMetadataService.getGateways().then((function(i){e.scope.viewModel={gateways:t.models.GatewayModelConverter.convertSettingsGateways(i),currentGatewayId:0,currentDataSourceId:0,currentGateway:null,currentDataSource:null},e.scope.isLoading=!1,e.tryInitializeGatewaySelection(),e.loadGatewaysState()}),(function(t){e.services.errorService.error(e.services.localizationService.get("SettingsGateways_Error_FailedToLoad"),"SettingsGateways_Error_FailedToLoad")}))},i.prototype.loadGatewaysState=function(){for(var e=0;e<this.scope.viewModel.gateways.length;e++){var t=this.scope.viewModel.gateways[e];this.loadGatewayContextMenu(t),this.loadGatewayStatus(t),this.loadDataSources(t)}},i.prototype.loadGatewayContextMenu=function(t){var i=this,a=new n(t);a.actions=[],a.actions.push({text:this.services.localizationService.get("AddDataSourceText"),action:function(){i.tryAddDataSource(t)}}),a.actions.push({text:this.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){i.tryDeleteGateway(t)}}),a.metadata=[],a.metadata.push({type:e.common.models.ContextMenuItemMetadataType.Status,status:e.common.models.ContextMenuItemMetadataStatus.Unknown,value:""}),t.contextMenuItem=a},i.prototype.tryDeleteGateway=function(e){var t=this,i=this.services.errorService,a=i.control(),n=this.services.localizationService.get("SettingsGateway_DeleteWarning_YesOption"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(n,function(i,n){a.hideDialog(),t.deleteGateway(e)}),new InJs.ModalDialogAction(o,function(e,t){a.hideDialog()})],s=this.services.localizationService.get("SettingsGateway_DeleteWarning_Title"),c=this.services.localizationService.get("SettingsGateway_DeleteWarning_Message");a.showCustomDialog(s,$("<div/>").text(c),r,(function(e){e.parent().find('input[value="'+o+'"]').focus()}),!0,!0)},i.prototype.deleteGateway=function(t){var i=this;t&&this.services.gatewaysMetadataService.deleteGateway(t.id).then((function(){var e=i.scope.viewModel.gateways.indexOf(t);e>-1&&(i.scope.viewModel.gateways.splice(e,1),i.scope.viewModel.gateways.length>0?i.onItemSelected(i.scope.viewModel.gateways[0].id,null):i.onItemSelected(null,null))}),(function(t){i.services.errorService.error(i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"Gateways_Error_FailedToDelete",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},i.prototype.getCurrentGateway=function(){return this.scope.viewModel.currentGateway},i.prototype.getCurrentDataSource=function(){return this.scope.viewModel.currentDataSource},i.prototype.loadGatewayStatus=function(t){var i=this;t.isLoadingStatus=!0,this.services.gatewaysMetadataService.getGatewayStatus(t.id).then((function(a){if(t.status=o.Live,t.staticCapabilities=a.gatewayStaticCapabilities,t.isLoadingStatus=!1,t.contextMenuItem){var n=t.contextMenuItem.metadata[0];n.status=e.common.models.ContextMenuItemMetadataStatus.Success,n.value=i.services.localizationService.get("SettingsGateway_OnlineMessage")}}),(function(a){t.isLoadingStatus=!1,t.status=o.NotReachable,e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(a.error).done((function(n){if(t.connectionError=i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+a.error.code),t.contextMenuItem){var o=t.contextMenuItem.metadata[0];o.status=e.common.models.ContextMenuItemMetadataStatus.Error,o.value=i.services.localizationService.get("SettingsGateway_NotConnectedMessage")}var r=[];if(n&&n.displayableErrorInfo)for(var s=0,c=n.displayableErrorInfo;s<c.length;s++){var l=c[s];r.push({key:l.errorInfoKey,value:l.errorInfoValue})}t.traceDetails={requestId:a.requestId,activityId:a.activityId,clusterUri:clusterUri,errorCode:a.status.toString(),error:a.error.code,details:r,time:(new Date).toString(),version:e.build,linkText:i.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))}))},i.prototype.loadDataSources=function(i){var a=this;i.isLoadingDataSources=!0,this.services.gatewaysMetadataService.getDataSources(i.id).then((function(e){i.dataSources=t.models.GatewayModelConverter.convertDataSources(e),i.isLoadingDataSources=!1,a.tryInitializeDataSourceSelection(i),a.loadDataSourcesState(i)}),(function(t){a.services.errorService.error(a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"SettingsDataSources_Error_FailedToLoad",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},i.prototype.loadDataSourcesState=function(e){for(var t=0;t<e.dataSources.length;t++){var i=e.dataSources[t];i.gateway=e,this.loadDataSourceContextMenu(i),this.loadDataSourceStatus(e,i)}},i.prototype.loadDataSourceContextMenu=function(t){var i=this,n=new a(t);n.actions=[],n.actions.push({text:this.services.localizationService.get("DashboardContextMenu_Delete"),action:function(){i.tryDeleteDataSource(t)}}),n.metadata=[],n.metadata.push({type:e.common.models.ContextMenuItemMetadataType.Status,status:e.common.models.ContextMenuItemMetadataStatus.Unknown,value:""}),t.contextMenuItem=n},i.prototype.tryDeleteDataSource=function(e){var t=this,i=this.services.errorService,a=i.control(),n=this.services.localizationService.get("SettingsDataSource_DeleteWarning_YesOption"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(n,function(i,n){a.hideDialog(),t.deleteDataSource(e)}),new InJs.ModalDialogAction(o,function(e,t){a.hideDialog()})],s=this.services.localizationService.get("SettingsDataSource_DeleteWarning_Title"),c=this.services.localizationService.get("SettingsDataSource_DeleteWarning_Message");a.showCustomDialog(s,$("<div/>").text(c),r,(function(e){e.parent().find('input[value="'+o+'"]').focus()}),!0,!0)},i.prototype.deleteDataSource=function(t){var i=this,a=t.gateway;if(a&&t)if(t.id<0){var n=a.dataSources.indexOf(t);n>-1&&(a.dataSources.splice(n,1),this.openItem(a.id,null))}else this.services.gatewaysMetadataService.deleteDataSource(a.id,t.id).then((function(){var e=a.dataSources.indexOf(t);e>-1&&(a.dataSources.splice(e,1),i.onItemSelected(a.id,null))}),(function(t){i.services.errorService.error(i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"DataSources_Error_FailedToDelete",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))},i.prototype.loadDataSourceStatus=function(t,i){var a=this;i.id!==-1&&this.services.gatewaysMetadataService.getDataSourceStatus(t.id,i.id).then((function(){if(i.connected=!0,i.connectionError=null,i.contextMenuItem){var t=i.contextMenuItem.metadata[0];t.status=e.common.models.ContextMenuItemMetadataStatus.Success,t.value=a.services.localizationService.get("SettingsGateway_OnlineMessage")}}),(function(t){i.connected=!1,i.gateway.isExpanded=!0,e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(t.error).done((function(n){if(i.connectionError=a.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),i.contextMenuItem){var o=i.contextMenuItem.metadata[0];o.status=e.common.models.ContextMenuItemMetadataStatus.Error,o.value=a.services.localizationService.get("SettingsGateway_NotConnectedMessage")}var r=[];if(n&&n.displayableErrorInfo)for(var s=0,c=n.displayableErrorInfo;s<c.length;s++){var l=c[s];r.push({key:l.errorInfoKey,value:l.errorInfoValue})}i.traceDetails={requestId:t.requestId,activityId:t.activityId,clusterUri:clusterUri,errorCode:t.status.toString(),error:t.error.code,details:r,time:(new Date).toString(),version:e.build,linkText:a.services.localizationService.get("SettingsGateways_TroubleshootMessage"),link:"https://go.microsoft.com/fwlink/?LinkId=627095"}}))}))},i.prototype.generateUniqueDataSourceName=function(){if(!this.scope.viewModel.currentGateway)return null;for(var e=this.services.localizationService.get("NewDataSourceName"),t=e,i=0;;){var a=_.find(this.scope.viewModel.currentGateway.dataSources,(function(e){return e.displayName===t}));if(!a)break;i++,t=e+" "+i}return t},i.prototype.tryAddDataSource=function(e){var i=this;this.scope.viewModel.currentDataSourceId<0||(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSource.isDirty&&this.scope.viewModel.currentDataSource.isDirty()?this.showDiscardPopup().then((function(){i.addDataSource(e)})):this.scope.viewModel.currentGateway&&this.scope.viewModel.currentGateway.isDirty?this.scope.$broadcast(t.constants.onDirtyGatewaySelectionChanging,"SettingsGateway_DiscardChangesWarning_GatewayMessage",(function(){i.addDataSource(e),i.scope.$apply()})):this.addDataSource(e))},i.prototype.addDataSource=function(e){var t={id:-1,displayName:this.generateUniqueDataSourceName(),dataSourceType:void 0,gateway:e,connectionInfo:{},users:null,tabSelectionType:r.Settings};e.dataSources.push(t),this.loadDataSourceContextMenu(t),this.openItem(e.id,t.id)},i.prototype.onItemSelected=function(e,i){var a=this;e===this.scope.viewModel.currentGatewayId&&i===this.scope.viewModel.currentDataSourceId||(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSource.isDirty&&this.scope.viewModel.currentDataSource.isDirty()?this.showDiscardPopup().then((function(){a.scope.viewModel.currentDataSourceId<0&&a.scope.viewModel.currentGateway.dataSources.pop(),a.openItem(e,i)})):this.scope.viewModel.currentGateway&&this.scope.viewModel.currentGateway.isDirty?this.scope.$broadcast(t.constants.onDirtyGatewaySelectionChanging,"SettingsGateway_DiscardChangesWarning_GatewayMessage",(function(){a.openItem(e,i),a.scope.$apply()})):(this.scope.viewModel.currentDataSource&&this.scope.viewModel.currentDataSourceId<0&&this.scope.viewModel.currentGateway.dataSources.pop(),this.openItem(e,i)))},i.prototype.openItem=function(e,i){var a=this,n=this.scope.viewModel;n.currentGatewayId=e,n.currentDataSourceId=i,n.currentGateway=this.getCurrentGatewayModel(),this.services.gatewayDataService.selectedGatewayDatasource=n.currentDataSource=this.getCurrentDataSourceModel(),i?this.scope.viewModel.currentGateway.isExpanded=!0:requestAnimationFrame((function(){return a.scope.$broadcast(t.constants.onGatewaySelectionChanged)})),this.services.navigation&&this.services.navigation.navigateToGatewayItem(e,i)},i.prototype.getSelectionType=function(){return this.scope.viewModel.currentGatewayId?this.scope.viewModel.currentDataSourceId?e.connectivity.models.GatewaysSelectionType.DataSource:e.connectivity.models.GatewaysSelectionType.Gateway:e.connectivity.models.GatewaysSelectionType.None},i.prototype.getCurrentGatewayModel=function(){var e=this;return _.find(this.scope.viewModel.gateways,(function(t){return t.id===e.scope.viewModel.currentGatewayId}))},i.prototype.getCurrentDataSourceModel=function(){var e=this.scope.viewModel.currentDataSourceId;if(e){var t=this.getCurrentGatewayModel();if(t)return _.find(t.dataSources,(function(t){return t.id===e}))}return null},i.prototype.showDiscardPopup=function(){var e=this.services.promiseFactory.defer(),t=this.services.errorService,i=t.control(),a=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),o=[new InJs.ModalDialogAction(a,function(t,a){i.hideDialog(),e.resolve(null)}),new InJs.ModalDialogAction(n,function(t,a){i.hideDialog(),e.reject()})],r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),s=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_DataSourceMessage");return i.showCustomDialog(r,$("<div/>").text(s),o,(function(e){e.parent().find('input[value="'+n+'"]').focus()}),!0,!0),e.promise},i.prototype.testConnections=function(){if(this.scope.viewModel.gateways)for(var e=0,t=this.scope.viewModel.gateways;e<t.length;e++){var i=t[e];if(this.loadGatewayStatus(i),i.dataSources)for(var a=0,n=i.dataSources;a<n.length;a++){var o=n[a];this.loadDataSourceStatus(i,o)}}},i})();i.GatewaysController=s})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(e,i){var a=this;this.scope=e,this.services=i,this.scope.updateDirtyFlag=function(){return a.updateDirtyFlag()},this.scope.applyChanges=function(){return a.applyChanges()},this.scope.discardChanges=function(){return a.discardChanges()},this.scope.addDataSource=function(){return a.addDataSource()};var n=this.scope.$on(t.constants.onDirtyGatewaySelectionChanging,(function(e,t,i){return a.discardOrCancel(t,i)})),o=this.scope.$on(t.constants.onGatewaySelectionChanged,(function(){return a.initializeGateway()}));this.initializeGateway(),this.scope.$on("$destroy",(function(){n(),o()}))}return i.createOptions=function(){return{additionalServices:["errorService","localizationService","gatewaysMetadataService","telemetryService"]}},i.prototype.initializeGateway=function(){var e=this.scope.viewModel;e.contactInformationString=this.getContactInformationString(e.gatewayAnnotation.gatewayContactInformation),this.initializeOriginalValues()},i.prototype.updateDirtyFlag=function(){var e=this.scope.viewModel;e.isDirty=e.displayName!==e.originalValues.name||e.description!==e.originalValues.description||e.gatewayAnnotation.gatewayDepartment!==e.originalValues.department||e.contactInformationString!==e.originalValues.contactInformationString},i.prototype.discardOrCancel=function(e,t){var i=this,a=this.services.errorService.control(),n=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_YesOption"),o=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),r=[new InJs.ModalDialogAction(n,function(e,n){i.restoreOriginalValues(),i.scope.$apply(),a.hideDialog(),t&&t()}),new InJs.ModalDialogAction(o,function(e,t){a.hideDialog()})],s=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_Title"),c=this.services.localizationService.get(e);a.showCustomDialog(s,$("<div/>").text(c),r,(function(e){e.parent().find('input[value="'+o+'"]').focus()}),!0,!0)},i.prototype.restoreOriginalValues=function(){var e=this.scope.viewModel;e.displayName=e.originalValues.name,e.description=e.originalValues.description,e.gatewayAnnotation.gatewayDepartment=e.originalValues.department,e.contactInformationString=e.originalValues.contactInformationString,e.isDirty=!1},i.prototype.initializeOriginalValues=function(){var e=this.scope.viewModel;e.originalValues={name:e.displayName,description:e.description,department:e.gatewayAnnotation.gatewayDepartment,contactInformationString:e.contactInformationString},e.isDirty=!1},i.prototype.getContactInformationString=function(e){var t="";return e&&(t=e.join(";")),t},i.prototype.parseContactInformation=function(e){return e.split(";")},i.prototype.applyChanges=function(){var t=this;this.scope.viewModel.gatewayAnnotation.gatewayContactInformation=this.parseContactInformation(this.scope.viewModel.contactInformationString);var i={gatewayName:this.scope.viewModel.displayName,gatewayDescription:this.scope.viewModel.description,gatewayAnnotation:JSON.stringify(this.scope.viewModel.gatewayAnnotation)};this.scope.viewModel.isWaitingForGatewayUpdate=!0,this.services.gatewaysMetadataService.updateGateway(this.scope.viewModel.id,i).then((function(){t.scope.viewModel.isWaitingForGatewayUpdate=!1,t.initializeOriginalValues()}),(function(i){t.scope.viewModel.isWaitingForGatewayUpdate=!1,t.services.errorService.error(t.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+i.error.code),"UpdateGateway_Error",{requestId:i.requestId,ecsCorrelationId:i.activityId,statusCode:i.status.toString()})}))},i.prototype.discardChanges=function(){this.discardOrCancel("SettingsGateway_DiscardChangesWarning_GatewaySettingsMessage",null)},i.prototype.addDataSource=function(){this.scope.$emit(t.constants.addDataSourceEventName)},i})();i.GatewaySettingsController=a})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=e.common.contracts.gateway.GatewayType,n=(function(){function i(e,i){var a=this;this.scope=e,this.services=i,this.scope.viewModel.title=this.services.localizationService.format("SettingsGateways_ConnectToServer",[this.scope.viewModel.serverName]),this.scope.viewModel.gatewayOnlineStatusLabel=this.services.localizationService.format("Gateways_Status_Bracketed",[this.services.localizationService.get("Gateways_Status_Online")]),this.scope.viewModel.gatewayOfflineStatusLabel=this.services.localizationService.format("Gateways_Status_Bracketed",[this.services.localizationService.get("Gateways_Status_Offline")]),this.scope.gatewayTypeSelected=function(){return a.gatewayTypeSelected()},this.scope.enterpriseGatewaySelected=function(e){return a.enterpriseGatewaySelected(e)},this.scope.navigateToManageGateways=function(){return a.navigateToManageGateways()},this.scope.deletePersonalGateway=function(){return a.deletePersonalGateway()},this.scope.$on(t.constants.gatewaySelectionAppliedEventName,(function(){return a.onGatewaySelectionApplied()})),this.scope.$on(t.constants.gatewaySelectionDiscardedEventName,(function(){return a.onGatewaySelectionDiscarded()})),this.scope.isSovereignCloud=this.services.featureSwitchService.featureSwitches.isSovereignCloud,this.populateGatewayTable()}return i.createOptions=function(){return{additionalServices:["telemetryService","errorService","localizationService","selectGatewayService","gatewaysMetadataService","featureSwitchService","navigation"]}},i.prototype.populateGatewayTable=function(){var e=this;this.services.gatewaysMetadataService.getModelDataSources(this.scope.viewModel.modelId).then((function(i){if(e.scope.cachedDiscoverDatasourceResponse=i,0===i.gateways.length&&0===i.datasources.length)return e.scope.viewModel.isCloudScheduleRefresh||e.loadPersonalGateway(),e.scope.viewModel.enterpriseGateways=[],e.scope.viewModel.egwStatusLoaded=!0,void(e.scope.viewModel.useEnterpriseGateway=!1);var n=e.services.selectGatewayService.getAvailableGateways(i);e.scope.viewModel.serverName=e.services.selectGatewayService.getServerName(i),e.scope.viewModel.enterpriseGateways=t.models.GatewayModelConverter.convertSettingsGateways(n.filter((function(e){return e.gatewayType===a.Resource}))),e.loadSelectedGateway(i),e.loadDataSourcesStatus(i.datasources),e.loadDmtsPlaceHolderPersonalGatewayId(i),e.loadPersonalGateway(),e.scope.viewModel.egwStatusLoaded=!0,e.checkIfOnPremMigrationIsAllowed()}),(function(i){i.error&&i.error.code===t.constants.ServerError_ModelHasNoPowerBIDMMoniker&&(e.scope.viewModel.isCloudScheduleRefresh||e.loadPersonalGateway(),e.scope.viewModel.enterpriseGateways=[],e.scope.viewModel.egwStatusLoaded=!0,e.scope.viewModel.useEnterpriseGateway=!1)}))},i.prototype.loadDmtsPlaceHolderPersonalGatewayId=function(e){var t=_.find(e.gateways,(function(e){return e.gatewayType===a.Personal}));t&&(this.scope.viewModel.dmtsPlaceHolderGatewayId=t.gatewayId)},i.prototype.loadPersonalGateway=function(){var e=this;this.services.gatewaysMetadataService.getPersonalGateway().then((function(i){e.scope.viewModel.pgw=i,e.scope.viewModel.isDMTSPersonalGateway=e.isDMTSPersonalGateway(),e.scope.viewModel.pgwAnnotation=t.models.GatewayModelConverter.getGatewayAnnotation(e.scope.viewModel.pgw),e.updateStatus()}),(function(e){}))},i.prototype.checkIfOnPremMigrationIsAllowed=function(){var e=this;this.services.gatewaysMetadataService.checkIfOnPremMigrationIsAllowed().then((function(t){e.scope.viewModel.showNewPersonalGatewayAvailableMessage=t.IsMigrationAllowed&&t.FirstTimeInstallDMTSPersonalGateway&&t.AllDataSourcesAreSupported}),(function(e){}))},i.prototype.loadDataSourcesStatus=function(e){if(this.scope.viewModel.showStatus)for(var t=0,i=this.scope.viewModel.enterpriseGateways;t<i.length;t++){var a=i[t];this.getDataSourcesStatus(a,e,this.services.gatewaysMetadataService)}},i.prototype.getDataSourcesStatus=function(t,i,a){var n,o,r=this,s=this.getDataSourceIds(t.id,i);if(n=s.length,0===n)return void(t.status=e.connectivity.models.GatewayStatus.NotReachable);o=!0,t.status=e.connectivity.models.GatewayStatus.Unknown;for(var c=0,l=s;c<l.length;c++){var d=l[c];a.getDataSourceStatus(t.id,d).then((function(){o&&(n--,0===n&&(t.status=e.connectivity.models.GatewayStatus.Live,r.updateStatus()))}),(function(i){o=!1,t.status=e.connectivity.models.GatewayStatus.NotReachable,r.updateStatus()}))}},i.prototype.getDataSourceIds=function(e,t){for(var i=[],a=0,n=t;a<n.length;a++){var o=n[a];o.gatewayId===e&&i.push(o.dataSourceId)}return i},i.prototype.loadSelectedGateway=function(e){var t=this.services.selectGatewayService.getSelectedGateway(e),i=this.services.selectGatewayService.getSelectedGatewayType(t);switch(i){case 0:this.scope.viewModel.selectedGatewayId=-1,this.scope.viewModel.useEnterpriseGateway=void 0,this.scope.viewModel.egwAccessLost=this.services.selectGatewayService.isEGWAccessLost(e);break;case 1:this.scope.viewModel.selectedGatewayId=t.gatewayId,this.scope.viewModel.useEnterpriseGateway=!1;break;case 2:this.scope.viewModel.selectedGatewayId=t.gatewayId,this.scope.viewModel.useEnterpriseGateway=!0}},i.prototype.gatewayTypeSelected=function(){this.scope.viewModel.selectedGatewayId=this.scope.viewModel.useEnterpriseGateway?this.scope.viewModel.enterpriseGateways[0].id:this.scope.viewModel.dmtsPlaceHolderGatewayId,this.scope.viewModel.isDirty=!0},i.prototype.enterpriseGatewaySelected=function(e){this.scope.viewModel.useEnterpriseGateway=!0,this.scope.viewModel.selectedGatewayId=e,this.scope.viewModel.isDirty=!0},i.prototype.onGatewaySelectionApplied=function(){var e=this;this.services.gatewaysMetadataService.getModelDataSources(this.scope.viewModel.modelId).then((function(i){e.scope.cachedDiscoverDatasourceResponse=i,e.scope.$emit(t.constants.selectGatewayStatusReadyEventName)}),(function(e){})),this.scope.viewModel.isDirty=!1},i.prototype.onGatewaySelectionDiscarded=function(){this.loadSelectedGateway(this.scope.cachedDiscoverDatasourceResponse),this.scope.viewModel.isDirty=!1},i.prototype.updateStatus=function(){if(this.scope.viewModel.pgw&&this.scope.viewModel.pgw.gatewayStatus!==e.common.contracts.gateway.GatewayStatus.NotInstalled){for(var i=0,a=this.scope.viewModel.enterpriseGateways;i<a.length;i++){var n=a[i];if(n.status===e.connectivity.models.GatewayStatus.Unknown)return}this.scope.$emit(t.constants.selectGatewayStatusReadyEventName)}},i.prototype.navigateToManageGateways=function(){this.services.navigation&&this.services.navigation.navigateToGateways()},i.prototype.isDMTSPersonalGateway=function(){if(this.scope.viewModel.pgw){var e=this.services.selectGatewayService.getAvailableGateways(this.scope.cachedDiscoverDatasourceResponse),t=e.filter((function(e){return e.gatewayType===a.Personal}));if(t&&1===t.length)return t[0].gatewayId===this.scope.viewModel.pgw.gatewayId}return!1},i.prototype.deletePersonalGateway=function(){this.tryDeleteGateway(this.scope.viewModel.pgw)},i.prototype.tryDeleteGateway=function(t){var i=this,a=this.services.errorService,n=a.control(),o=this.services.localizationService.get("SettingsGateway_DeleteWarning_YesOption"),r=this.services.localizationService.get("SettingsDataSource_DiscardChangesWarning_CancelOption"),s=[new InJs.ModalDialogAction(o,function(a,o){n.hideDialog(),i.services.gatewaysMetadataService.deleteGateway(t.gatewayId).then((function(){i.scope.viewModel.isDMTSPersonalGateway=!1,i.scope.viewModel.showNewPersonalGatewayAvailableMessage=!0,i.loadPersonalGateway()}),(function(t){i.services.errorService.error(i.services.localizationService.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+t.error.code),"Gateways_Error_FailedToDelete",{requestId:t.requestId,ecsCorrelationId:t.activityId,statusCode:t.status.toString()})}))}),new InJs.ModalDialogAction(r,function(e,t){n.hideDialog()})],c=this.services.localizationService.get("SettingsGateway_DeletePersonalGatewayWarning_Title"),l=this.services.localizationService.get("SettingsGateway_DeletePersonalGatewayWarning_Message");n.showCustomDialog(c,$("<div/>").text(l),s,(function(e){e.parent().find('input[value="'+r+'"]').focus()}),!0,!0)},i})();i.SelectGatewayController=n})(i=t.controllers||(t.controllers={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(){this.restrict="E",this.templateUrl="views/datasourceView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.DataSourceController)}return i})();i.Datasource=a})(i=t.directives||(t.directives={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(){this.restrict="E",this.templateUrl="views/datasourceSettingsView.html",this.replace=!0,this.scope={dataSourceModel:"=datasourceModel"},this.controller=e.common.createController(t.controllers.DataSourceSettingsController)}return i})();i.DatasourceSettings=a})(i=t.directives||(t.directives={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(){this.restrict="E",this.templateUrl="views/datasourceUsersView.html",this.replace=!0,this.scope={dataSourceModel:"=datasourceModel"},this.controller=e.common.createController(t.controllers.DataSourceUsersController)}return i})();i.DatasourceUsers=a})(i=t.directives||(t.directives={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(){this.restrict="E",this.templateUrl="views/gatewayView.html",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.GatewayController)}return i})();i.Gateway=a})(i=t.directives||(t.directives={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(){this.restrict="E",this.templateUrl="views/gatewayAdministratorsView.html",this.replace=!0,this.scope={gatewayModel:"= gatewayModel"},this.controller=e.common.createController(t.controllers.GatewayAdministratorsController)}return i})();i.GatewayAdministrators=a})(i=t.directives||(t.directives={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(){this.restrict="E",this.templateUrl="views/gatewaysView.html",this.replace=!0,this.controller=e.common.createController(t.controllers.GatewaysController)}return i})();i.Gateways=a})(i=t.directives||(t.directives={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var a=(function(){function i(){this.restrict="E",this.replace=!0,this.templateUrl="views/selectGatewayView.html",this.scope={viewModel:"="},this.controller=e.common.createController(t.controllers.SelectGatewayController)}return i})();i.SelectGateway=a})(i=t.directives||(t.directives={}))})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,a){return new r(e,t,i,a)}var a=e.common.contracts.gateway.EncryptedConnection,n=e.common.EncryptionContext,o=e.common.contracts.gateway.PrivacyLevel;t.createGatewayDataService=i;var r=(function(){function i(e,t,i,a){this.gatewaysMetadataService=e,this.promiseFactory=t,this.featureSwitchService=i,this.moduleLoader=a}return i.prototype.getDecodedPublicKey=function(e){return atob(e).split(/<\/Modulus>|<Modulus>/)[1]},i.prototype.encryptCredentials=function(e,t,i,r){var s=this,c=this.promiseFactory.defer();return n.create(JSON.stringify(e),t,r,(function(e){var t={credentials:e,credentialType:i,encryptedConnection:s.featureSwitchService.featureSwitches.enterpriseGatewayETLEnabled?a.NotEncrypted:a.Encrypted,privacyLevel:o.Public,encryptionAlgorithm:"RSA-OAEP"};c.resolve(t)}),this.moduleLoader).then((function(e){e.RSAEncrypt()})),c.promise},i.prototype.createDataSourceWithRetry=function(e,t,i,a){var n=this,o=this.promiseFactory.defer();return this.gatewaysMetadataService.createDataSource(e.id,t).then((function(e){o.resolve(e)}),(function(r){n.updateGatewayPublicKeyIfNeed(e,t.credentialDetails.credentialType,i,a,r).then((function(i){t.credentialDetails=i,n.gatewaysMetadataService.createDataSource(e.id,t).then((function(e){o.resolve(e)}),(function(e){o.reject(e)}))}),(function(){o.reject(r)}))})),o.promise},i.prototype.updateCredentialsWithRetry=function(e,t,i,a,n){var o=this,r=this.promiseFactory.defer();return this.gatewaysMetadataService.updateCredentials(e.id,t,a).then((function(){r.resolve(null)}),(function(s){o.updateGatewayPublicKeyIfNeed(e,a.credentialType,i,n,s).then((function(i){i.privacyLevel=a.privacyLevel,o.gatewaysMetadataService.updateCredentials(e.id,t,i).then((function(){r.resolve(null)}),(function(e){r.reject(e)}))}),(function(){r.reject(s)}))})),r.promise},i.prototype.updateGatewayPublicKeyIfNeed=function(i,a,n,o,r){var s=this,c=this.promiseFactory.defer(),l=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(r.error);return l.always((function(r){if(r&&r.displayableErrorInfo){var l=e.common.localize.get("ServerError_DM_ErrorDetailNameCode_UnderlyingErrorMessage");_.filter(r.displayableErrorInfo,(function(e){return e.errorInfoKey===l}))&&s.gatewaysMetadataService.getGateways().then((function(e){var r=_.filter(e,(function(e){return e.gatewayId===i.id&&i.publicKey!==e.gatewayPublicKey}));if(_.isEmpty(r))c.reject();else{i.publicKey=r[0].gatewayPublicKey;var l=s.getDecodedPublicKey(i.publicKey),d={credentialData:t.models.GatewayModelConverter.convertAuthenticationParametersToCredentialData(n)};s.encryptCredentials(d,l,a,o).then((function(e){c.resolve(e)}),(function(){c.reject()}))}}),(function(e){c.reject()}))}})),c.promise},i})();t.GatewayDataService=r})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e,t,a,n,o){return new i(e,t,a,n,o)}e.createSelectGatewayService=t;var i=(function(){function t(e,t,i,a,n){this.rootScope=e,this.compile=t,this.gatewaysMetadataService=i,this.modalDialogService=a,this.localizationService=n}return t.prototype.bindModelToGateway=function(e,t,i,a){var n=this;this.showDialog(e,(function(a){return n.bindModel(e,a,t,i)}),a)},t.prototype.bindModel=function(e,t,i,a){this.gatewaysMetadataService.bindModelToGateway(e,t).then((function(){i()}),(function(e){a()}))},t.prototype.getAvailableGateways=function(e){if(0===e.monikers.length)return[];
var t=_.filter(e.monikers,(function(e){return e.monikerGateways.length>0})),i=_.map(t,(function(e){return _.map(e.monikerGateways,(function(e){return e.gatewayId}))})),a=_.intersection.apply(_,i),n=_.filter(e.gateways,(function(e){return a.indexOf(e.gatewayId)!==-1&&e.gatewayPublicKey}));return n},t.prototype.getServerName=function(e){if(0===e.monikers.length)return null;if(0===e.monikers[0].monikerDataSources.length)return null;try{var t=JSON.parse(e.monikers[0].monikerDataSources[0].connectionDetails);return t.server}catch(e){return null}},t.prototype.getSelectedGateway=function(e){for(var t=[],i=_.some(e.monikers,(function(e){return 0===e.monikerDataSources.length})),a=0,n=e.monikers;a<n.length;a++){var o=n[a],r=_.map(o.monikerDataSources,(function(e){return e.dataSourceId}));if(!_.every(r))return i?_.find(e.gateways,(function(e){return _.isEmpty(e.gatewayName)})):void 0;t=t.concat(r)}var s=_.filter(e.datasources,(function(e){return t.indexOf(e.dataSourceId)>-1})),c=_.map(s,(function(e){return e.gatewayId})),l=_.uniq(c);if(1===l.length)return _.find(e.gateways,(function(e){return l[0]===e.gatewayId}))},t.prototype.isEGWAccessLost=function(e){for(var t=[],i=0,a=e.monikers;i<a.length;i++){var n=a[i],o=_.map(n.monikerDataSources,(function(e){return e.dataSourceId}));if(!_.every(o))return!1;t=t.concat(o)}if(t.length>0)for(var r=0,s=t;r<s.length;r++){var c=s[r];if(!_.find(e.datasources,(function(e){return e.dataSourceId===c})))return!0}return!1},t.prototype.getSelectedGatewayType=function(e){return e?_.isEmpty(e.gatewayName)?1:2:0},t.prototype.showDialog=function(i,a,n){var o=new e.models.SelectGatewayModel(i,(!0),(!1),(!1)),r=this.rootScope.$new();r.viewModel=o;var s,c={dialogName:null,isDismissable:!0,scope:r,template:t.htmlTemplate,focusOnFirstButton:!0,dialogCssClass:"gatewaysDialog",dialogActions:[new InJs.ModalDialogAction(this.localizationService.get("SettingsGateways_Connect"),function(e,t){a(o.selectedGatewayId),s.closeDialog()}),new InJs.ModalDialogAction(this.localizationService.get("SettingsGateways_Cancel"),function(e,t){n(),s.closeDialog()})]};s=this.modalDialogService.showLegacyWebModalDialog(c)},t})();i.htmlTemplate="<select-gateway view-model='viewModel'> </select-gateway>",e.SelectGatewayService=i})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={})),angular.module("powerbi.settings").run(["$templateCache",function(e){e.put("components/adminPortal/adminPortal/adminPortal.html",'<div class="sliderContentView adminPortal"><div class="header label-xl"><span localize="AdminPortal_Title"></span></div><div class="adminPortalSpinner" ng-if="$ctrl.adminCapacityEnabled && !$ctrl.showOptionsList"><spinner class="centered xlarge"></spinner><div class="spinnerInfo" localize="Loading_Text"></div></div><div class="content" ng-if="$ctrl.showOptionsList"><div class="adminPortalLeftColumn"><ul class="contentOption"><li class="option label-med" ng-repeat="option in $ctrl.options track by option.type" ng-mousedown="$ctrl.onActiveOptionChanged(option.type)" ng-class="{selected: $ctrl.getCurrentAdminPortalSettingsTab() === option.type}" ng-if="$ctrl.isOptionAllowed(option)"><span ng-bind="::option.displayName"></span></li></ul></div><div class="adminPortalRightColumn" ng-switch="$ctrl.getCurrentAdminPortalSettingsTab()"><usage-metrics class="contentPane" ng-switch-when="1"></usage-metrics><manage-users class="contentPane" ng-switch-when="2"></manage-users><auditing class="contentPane" ng-switch-when="3" ng-if="::$ctrl.adminAuditingEnabled"></auditing><tenant-settings-container class="contentPane" ng-switch-when="4"></tenant-settings-container><capacity-admin-container class="contentPane" ng-switch-when="5" ng-if="::$ctrl.adminCapacityEnabled"></capacity-admin-container></div></div></div>'),e.put("components/adminPortal/auditing/auditing.html",'<div class="auditing"><div class="title label-xl trimmedTextWithEllipsis" localize="AdminPortal_Auditing_Title" localize-tooltip="AdminPortal_Auditing_Title"></div><div class="subtitle label-med trimmedTextWithEllipsis"><span localize="AdminPortal_Auditing_SubtitleV2" localize-fragments><pbi-link fragment-index="0" guid="823102" label="LearnMore"></pbi-link></span></div><div class="goToButton"><a class="btn primary" localize="AdminPortal_Auditing_ButtonText" ng-click="auditingPageLanding()"></a></div></div>'),e.put("components/adminPortal/dataClassifications/dataClassifications.html",'<ng-form name="{{::(\'$ctrl.\' + $ctrl.getFormName())}}"><div class="titleContainer" ng-click="$ctrl.toggleDetailsView()"><i class="glyphicon detailsViewExpander" ng-class="$ctrl.showDetails ? \'pbi-glyph-caretdownright\': \'pbi-glyph-caretright\'"></i><div class="tenantSettingTitle"><header class="displayName" localize="AdminPortal_TenantSettings_DataClassification_Title"></header><header class="statusMessage" ng-bind="$ctrl.statusMessage" ng-if="!$ctrl.dataClassificationsForm.$dirty"></header><header class="statusMessage unappliedChanges" localize="TenantSettingStatus_UnappliedChanges" ng-if="$ctrl.dataClassificationsForm.$dirty"></header></div></div><div class="details" ng-if="$ctrl.showDetails"><header class="description" localize="AdminPortal_TenantSettings_DataClassification_Description"></header><pbi-toggle class="toggleAction" ng-model="$ctrl.isEnabled" ng-change="$ctrl.onDataClassificationToggled()" no-label on-state-text="Enabled" off-state-text="Disabled"></pbi-toggle><div class="dataClassificationContainer" ng-if="$ctrl.isEnabled"><table pbi-table pbi-table-config="$ctrl.tableConfig"><tr ng-repeat="item in $ctrl.viewModel"><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Default" class="default"><div class="pbi-input"> <input type="radio" name="dataClassification" ng-model="item.default" ng-value="true" ng-change="$ctrl.setDefaultDataClassification($index)"><label class="form-label label-med"></label></div></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Classification" class="name"> <input type="text" ng-model="item.name"/></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Shorthand" class="shorthand"> <input type="text" maxlength="4" ng-model="item.shortHand"/></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_ShowTag" class="showTag"><pbi-checkbox label="test" ng-model="item.showTag" localize-tooltip="AdminPortal_TenantSettings_DataClassification_ShowTagTooltip"></pbi-checkbox></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_URL"> <input type="text" ng-model="item.url"/></td><td class="remove"> <button ng-click="$ctrl.removeDataClassification($index)"><i class="glyphicon pbi-glyph-delete glyph-small"></i></button></td></tr></table> <button class="add" ng-click="$ctrl.addDataClassification()"><i class="glyphicon pbi-glyph-add glyph-small"></i><span localize="AdminPortal_TenantSettings_DataClassification_AddItem"></span></button></div><div class="nonGranularErrorMessageContainer" ng-if="$ctrl.errorMessage"><i class="glyphicon glyph-small pbi-glyph-error"></i><span class="errorMessage" ng-bind="$ctrl.errorMessage"></span></div><div class="applyButtonContainer"><pbi-button class="applyChangesButton" label="PBI_Button_Label_Apply" primary="true" ng-click="$ctrl.applyChanges()" ng-disabled="!$ctrl.dataClassificationsForm.$dirty"></pbi-button><pbi-button class="cancelChangesButton" label="PBI_Button_Label_Cancel" ng-click="$ctrl.cancelChanges()" ng-disabled="!$ctrl.dataClassificationsForm.$dirty"></pbi-button></div><div class="nonGranularInfoMessageContainer"><i class="glyphicon glyph-small pbi-glyph-info"></i><span class="infoMessage" localize="TenantSetting_NonGranularInfoMessage"></span></div></div></ng-form>'),e.put("components/adminPortal/manageUsers/manageUsers.html",'<div class="manageUsers"><div class="title label-xl trimmedTextWithEllipsis" localize="AdminPortal_ManageUsers_Title" localize-tooltip="AdminPortal_ManageUsers_Title"></div><div class="subtitle label-med trimmedTextWithEllipsis" localize="AdminPortal_ManageUsers_Subtitle" localize-tooltip="AdminPortal_ManageUsers_Subtitle"></div><div class="goToButton"><a class="btn primary" localize="AdminPortal_ManageUsers_ButtonText" ng-href="{{::o365AdminUserPageUrl}}" target="_blank"></a></div></div>'),e.put("components/adminPortal/tenantSetting/tenantSetting.html",'<ng-form name="{{::(\'$ctrl.\' + $ctrl.getFormName())}}"><div class="titleContainer" ng-click="$ctrl.toggleDetailsView()"><i class="glyphicon detailsViewExpander" ng-class="$ctrl.showDetails ? \'pbi-glyph-caretdownright\' : \'pbi-glyph-caretright\'"></i><div class="tenantSettingTitle"><header class="displayName" ng-bind="::$ctrl.viewModel.displayName"></header><header class="statusMessage" ng-bind="$ctrl.statusMessage" ng-if="!$ctrl.tenantSettingForm.$dirty"></header><header class="statusMessage unappliedChanges" localize="TenantSettingStatus_UnappliedChanges" ng-if="$ctrl.tenantSettingForm.$dirty"></header></div></div><div class="details" ng-if="$ctrl.showDetails"><header class="description" ng-bind="$ctrl.viewModel.description"></header><pbi-toggle class="toggleAction" ng-model="$ctrl.viewModel.isEnabled" ng-change="$ctrl.onEnabledToggleChange()" no-label on-state-text="Enabled" off-state-text="Disabled"></pbi-toggle><div class="infoMessageContainer guidanceInfoMessage" ng-if="$ctrl.showDisabledInfoMessage()"><i class="glyphicon glyph-small pbi-glyph-info"></i><div class="infoMessage" ng-bind="::$ctrl.viewModel.disabledInfoMessage"></div></div><div class="infoMessageContainer privacyInfoMessage" ng-if="::$ctrl.viewModel.privacy"><i class="glyphicon glyph-small pbi-glyph-securityalert"></i><div class="infoMessage"><span ng-if="$ctrl.viewModel.privacy.fragments" localize="{{::$ctrl.viewModel.privacy.privacyKey}}" localize-fragments><a fragment-index="0" localize="Terms" target="_blank" href="{{::$ctrl.viewModel.privacy.fragments.termsOfUseUrl}}"/><a fragment-index="1" localize="PrivacyPolicy" target="_blank" href="{{::$ctrl.viewModel.privacy.fragments.privacyPolicyUrl}}"/><a fragment-index="2" localize="LearnMore" target="_blank" href="{{::$ctrl.viewModel.privacy.fragments.learnMoreUrl}}"/></span><span ng-if="!$ctrl.viewModel.privacy.fragments" localize="{{::$ctrl.viewModel.privacy.privacyKey}}"/></div></div><div class="granularityControl" ng-if="$ctrl.viewModel.isEnabled && $ctrl.viewModel.isGranular"><div class="applyToRadioGroup"><pbi-radio-group ng-model="$ctrl.granularityState" label="TenantSetting_ApplyTo" ng-change="$ctrl.onRadioGroupSelectionChanged()"><pbi-radio label="TenantSetting_ApplyTo_EntireOrganization" ng-value="2"></pbi-radio><pbi-radio label="TenantSetting_ApplyTo_SpecificSecurityGroups" ng-value="3"></pbi-radio></pbi-radio-group></div><emails-list id="allowedSecurityGroupsBox" class="securityGroupsBox" view-model="$ctrl.viewModel.allowedSecurityGroups" ng-if="$ctrl.granularityState == 3" block-users allow-object-ids allow-security-groups></emails-list><pbi-checkbox class="deniedSecurityGroupsCheckbox" label="TenantSetting_ExceptSpecificSecurityGroups" ng-model="$ctrl.deniedSecurityGroupsEnabled" ng-change="$ctrl.onDeniedSecurityGroupsCheckboxChanged()"></pbi-checkbox><emails-list id="deniedSecurityGroupsBox" class="securityGroupsBox" ng-if="$ctrl.deniedSecurityGroupsEnabled" view-model="$ctrl.viewModel.deniedSecurityGroups" block-users allow-object-ids allow-security-groups></emails-list><div class="infoMessageContainer guidanceInfoMessage" ng-if="$ctrl.showEnabledForSecurityGroupsInfoMessage()"><i class="glyphicon glyph-small pbi-glyph-info"></i><div class="infoMessage" ng-bind="::$ctrl.viewModel.enabledForSecurityGroupsInfoMessage"></div></div></div><div class="applyButtonContainer"><pbi-button class="applyChangesButton" label="PBI_Button_Label_Apply" primary="true" ng-click="$ctrl.applyChanges()" ng-disabled="!$ctrl.tenantSettingForm.$valid || !$ctrl.tenantSettingForm.$dirty"></pbi-button><pbi-button class="cancelChangesButton" label="PBI_Button_Label_Cancel" ng-click="$ctrl.cancelChanges()" ng-disabled="!$ctrl.tenantSettingForm.$valid || !$ctrl.tenantSettingForm.$dirty"></pbi-button></div><div class="nonGranularInfoMessageContainer" ng-if="::!$ctrl.viewModel.isGranular"><i class="glyphicon glyph-small pbi-glyph-info"></i><span class="infoMessage" localize="TenantSetting_NonGranularInfoMessage"></span></div></div></ng-form>'),e.put("components/adminPortal/tenantSettingsContainer/tenantSettingsContainer.html",'<div class="tenantSettingsContainer"><spinner class="centered" ng-show="isLoading"></spinner><div class="title label-xl" ng-if="::!areGranularTenantControlsEnabled" localize="AdminPortal_TenantSettings_Title" localize-tooltip="AdminPortal_TenantSettings_Title"></div><div class="settingsContent {{::areGranularTenantControlsEnabled ? \'\' : \'nonGranularSettings\'}}" ng-if="!isLoading"><div class="nonGranularTenantSettingsContainer" ng-if="::!areGranularTenantControlsEnabled" ng-repeat="featureSwitch in tenantSettings.featureSwitches"><div class="radioButton"><div class="radioButtonTitle label-med" ng-bind="::featureSwitch.displayName"></div><div class="radioButtonContainer"><div class="pbi-input"> <input type="radio" ng-model="featureSwitch.isEnabled" ng-value="true" ng-change="updateFormState()"><label class="form-label label-med" localize="ToggleSwitchOn"></label></div><div class="pbi-input"> <input type="radio" ng-model="featureSwitch.isEnabled" ng-value="false" ng-change="updateFormState()"><label class="form-label label-med" localize="ToggleSwitchOff"></label></div></div><div class="radioButtonPrivacy label-med" ng-if="::featureSwitch.privacy" ng-bind="::featureSwitch.privacy"></div></div></div><ng-form name="$ctrl.tenantSettingsForm" class="granularTenantSettingsContainer" ng-if="::areGranularTenantControlsEnabled"><div class="tenantSettingsGroup" ng-class="::{lastDivider: $last}" ng-repeat="tenantSettingsGroup in ::tenantSettings.tenantSettingsGroups"><div class="groupTitle" ng-bind="::tenantSettingsGroup.displayName"></div><div class="tenantSettingContainer" ng-repeat="tenantSetting in tenantSettingsGroup.tenantSettings"><tenant-setting view-model="tenantSetting"></tenant-setting></div><x-data-classifications view-model="tenantSettings.dataClassifications" ng-if="isDataClassificationFeatureEnabled && isDashboardGroup(tenantSettingsGroup.name)"></x-data-classifications><hr ng-if="::!$last"/></div></ng-form><div class="nonGranularTenantSettingsContainer dataClassificationSwitchContainer" ng-if="isDataClassificationFeatureEnabled && !areGranularTenantControlsEnabled"><div class="radioButton"><div class="radioButtonTitle label-med"><span localize="AdminPortal_TenantSettings_DataClassification_Title"></span><i class="glyphicon pbi-glyph-info glyph-small" localize-tooltip="AdminPortal_TenantSettings_DataClassification_RadioButtonTooltip"></i></div><div class="radioButtonContainer"><div class="pbi-input"> <input type="radio" ng-model="dataClassificationToggle.enabled" ng-value="true" ng-change="onDataClassificationToggled()"><label class="form-label label-med" localize="ToggleSwitchOn"></label></div><div class="pbi-input"> <input type="radio" ng-model="dataClassificationToggle.enabled" ng-value="false" ng-change="onDataClassificationToggled()"><label class="form-label label-med" localize="ToggleSwitchOff"></label></div></div></div></div><div class="dataClassificationContainer nonGranularTenantSettingsContainer" ng-if="isDataClassificationFeatureEnabled && dataClassificationToggle.enabled && !areGranularTenantControlsEnabled"><table pbi-table pbi-table-config="$ctrl.tableConfig"><tr ng-repeat="item in tenantSettings.dataClassifications"><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Default" class="default"><div class="pbi-input"> <input type="radio" name="dataClassification" ng-model="item.default" ng-value="true" ng-change="setDefaultDataClassification($index)"> <label class="form-label label-med">&nbsp;</label></div></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Classification" class="name"> <input type="text" ng-model="item.name" ng-change="updateFormState()"/></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_Shorthand" class="shortHand"> <input type="text" maxlength="4" ng-model="item.shortHand" ng-change="updateFormState()"/></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_ShowTag" class="showTag"><pbi-checkbox label="test" ng-model="item.showTag" localize-tooltip="AdminPortal_TenantSettings_DataClassification_ShowTagTooltip" ng-change="updateFormState()"></pbi-checkbox></td><td localized-header="AdminPortal_TenantSettings_DataClassificationTable_Column_URL"> <input type="text" ng-model="item.url" ng-change="updateFormState()"/></td><td class="remove"> <button ng-click="removeDataClassification($index)"><i class="glyphicon pbi-glyph-delete glyph-small"></i></button></td></tr></table> <button class="add" ng-click="addDataClassification()"><i class="glyphicon pbi-glyph-add glyph-small"></i><span localize="AdminPortal_TenantSettings_DataClassification_AddItem"></span></button></div><div class="settingsButtonContainer" ng-if="::!areGranularTenantControlsEnabled"><pbi-button id="applyChanges" label="AdminPortal_TenantSettings_ButtonText_Apply" primary="true" ng-disabled="!hasChanges" ng-click="applyChanges()"></pbi-button><pbi-button id="cancelChanges" label="PBI_Button_Label_Cancel" ng-disabled="!hasChanges" ng-click="cancelChanges()"></pbi-button></div></div></div>'),e.put("components/adminPortal/usageMetrics/usageMetrics.html",'<div class="usageMetrics"><iframe ng-src="/adminPortalDashboard" frameborder="0" scrolling="no"></iframe></div>'),e.put("components/gateway/upnMappingPane/upnMappingPaneView.html",'<div class="upnMappingPane"><header><h3 class="primaryHeading" localize="UpnMappingPane_Title"></h3><h6 class="secondaryHeading" localize="UpnMappingPane_Subtitle" localize-fragments><a fragment-index="0" href="//go.microsoft.com/fwlink/?LinkID=786855" target="_blank" localize="LearnMore"></a></h6></header><section class="contentContainer"><section class="dataSource"><h6 localize="UpnMappingPane_SelectDataSource"></h6><div class="pbi-input inline"> <input type="radio" ng-model="$ctrl.viewModel.connectionStringPropertyName" ng-value="0"/><label class="form-label" localize="UpnMappingPane_EffectiveUserName"></label></div><div class="pbi-input inline"> <input type="radio" ng-model="$ctrl.viewModel.connectionStringPropertyName" ng-value="1"/><label class="form-label" localize="UpnMappingPane_CustomData"></label></div></section><section class="mappingTable"><div class="mappingTableContainer"><div class="caption"><div localize="UpnMappingPane_Replace"></div><div localize="UpnMappingPane_With"></div></div><div class="tableContainer"><table><tr ng-repeat="rule in $ctrl.viewModel.mappingRules track by $index" ng-click="$ctrl.selectedRule = rule" ng-class="{selected: rule === $ctrl.selectedRule}"><td ng-bind="$index + 1"></td><td ng-bind="rule.searchString"></td><td ng-bind="rule.replacementString"></td></tr><tr><td ng-bind="$ctrl.viewModel.mappingRules.length + 1"></td><td> <input name="newSearchString" ng-model="$ctrl.newRule.searchString" placeholder="{{::$ctrl.localizedOriginalName}}"/></td><td> <input name="newReplacementString" ng-model="$ctrl.newRule.replacementString" placeholder="{{::$ctrl.localizedNewName}}"/></td></tr></table></div></div><div class="tableSelectionControl"><i class="glyphicon pbi-glyph-chevronupmedium glyph-small" ng-class="{disabled: !$ctrl.selectedRule}" ng-click="$ctrl.selectPre()"></i><i class="glyphicon pbi-glyph-chevrondownmedium glyph-small" ng-class="{disabled: !$ctrl.selectedRule}" ng-click="$ctrl.selectNext()"></i></div><div> <button localize="UpnMappingPane_Add" ng-disabled="!$ctrl.newRule.searchString || !$ctrl.newRule.replacementString" ng-click="$ctrl.addNewRule()"></button> <button localize="UpnMappingPane_Delete" ng-disabled="!$ctrl.selectedRule" ng-click="$ctrl.deleteRule()"></button></div></section><section class="testRule"><div localize="UpnMappingPane_TestRuleTitle"></div><div class="originalValue"><div localize="UpnMappingPane_OriginalName"></div><div> <input ng-model="$ctrl.testRuleOriginalName" placeholder="{{::$ctrl.localizedOriginalName}}"/> <button localize="UpnMappingPane_TestRuleButtonText" ng-disabled="!$ctrl.testRuleOriginalName" ng-click="$ctrl.testRule()"></button></div></div><div class="replacementValue"><div localize="UpnMappingPane_AfterRuleApplied"></div><div> <input ng-model="$ctrl.testRuleNewName" placeholder="{{::$ctrl.localizedResultOfApplyingMappingRule}}" readonly/><spinner ng-show="$ctrl.isTestRuleRequestPending"></spinner></div></div></section></section><footer><div class="buttons"><spinner ng-show="$ctrl.isUpdateDataSourceRequestPending"></spinner> <button class="biButton primary" type="button" localize="OK_ButtonText" ng-disabled="false" ng-click="$ctrl.saveChangesAndExit()"/> <button class="biButton" type="button" localize="Cancel_ButtonText" ng-click="$ctrl.closeUpnMappingPane()"/></div></footer></div>'),e.put("views/datasourceSettingsView.html",'<div class="formContainer" ng-cloak><header ng-switch on="viewModel.waitingForDataSourceStatus || viewModel.isLoadingForm"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false"><div class="successContainer" ng-if="!viewModel.hasTestConnectionFailure && dataSourceModel.connected"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></span><span localize="SettingsDataSource_SettingsConnectionSuccessfulText"></span></div><div ng-if="dataSourceModel.connectionError"><inline-message use-error-icon trace-details="dataSourceModel.traceDetails"><span localize="SettingsDataSource_SettingsConnectionErrorTitle"></span><span ng-bind="dataSourceModel.connectionError"></span></inline-message></div><div class="messageContainer" ng-switch on="viewModel.messageState"><div ng-switch-when="1"><inline-message class="inlineInfo"><span class="glyphicon glyph-small pbi-glyph-info"></span><span localize="SettingsDataSource_SettingsAddUserText1" localize-fragments><a fragment-index="0" href=\'\' localize="SettingsDataSource_SettingsAddUserText2" ng-click="switchToUserTab()"></a></span></inline-message></div><div ng-switch-when="2"><inline-message use-error-icon trace-details="dataSourceModel.traceDetails"><span ng-bind="dataSourceModel.errorTitle"></span><span ng-bind="dataSourceModel.compositeErrorMessage"></span></inline-message></div></div></div></header><form name="settingsForm" autocomplete="off" ng-hide="viewModel.isLoadingForm"><section><label for="dataSourceName" class="input-field-label" localize="SettingsDataSource_SettingsName"></label> <input id="dataSourceName" select-pristine-on-focus type="text" ng-disabled="!viewModel.isAddingDataSource || viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.dataSourceName" required/></section><section><label for="dataSourceType" class="input-field-label" localize="SettingsDataSource_SettingsType"></label> <select id="dataSourceType" ng-disabled="!viewModel.isAddingDataSource || viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.dataSourceType" ng-change="onDataSourceTypeChange()" ng-options="option.id as option.name for option in viewModel.dataSourceTypeOptions | filter: {name: \'\'}" required><option value="" disabled localize="SettingsGateway_SelectDataSourceType">Select a data source type</option></select></section><div class="connectionSettings" ng-show="viewModel.editableSettings.dataSourceType !== undefined"><section ng-repeat="label in viewModel.dataSourceTypeOptions[viewModel.editableSettings.dataSourceType].labels"> <label for="{{label.name}}" class="input-field-label">{{label.displayName}}</label> <input id="{{label.name}}" type="{{label.type}}" ng-disabled="!viewModel.isAddingDataSource || viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings[label.name]" required/></section><section ng-show="viewModel.dataSourceTypeOptions[viewModel.editableSettings.dataSourceType].authenticationMethodOptions.length> 1"><label for="dataSourceAuthenticationMethod" class="input-field-label" localize="SettingsDataSource_SettingsAuthenticationMethod"></label> <select id="dataSourceAuthenticationMethod" ng-disabled="viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.authenticationMethod" ng-change="onAuthenticationMethodChange()" ng-options="option.id as option.name for option in viewModel.dataSourceTypeOptions[viewModel.editableSettings.dataSourceType].authenticationMethodOptions" required><option value="" disabled localize="SettingsGateway_SelectAnAuthenticationMethod">Select an authentication method</option></select></section><div ng-show="viewModel.editableSettings.authenticationMethod !== undefined && viewModel.editableSettings.authenticationMethod !== 0 && viewModel.editableSettings.authenticationMethod !== 2"><section><span localize="SettingsDataSource_SettingsCredentialEncryptionText"></span> &#32;<a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></section><section ng-show="viewModel.editableSettings.authenticationParameters[0].shouldDisplay"> <label for="authenticationParameter1" class="input-field-label">{{viewModel.editableSettings.authenticationParameters[0].displayName}}</label> <input id="authenticationParameter1" type="text" ng-disabled="viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.authenticationParameters[0].value" ng-change="onAuthenticationParameter1Change()" ng-focus="onAuthenticationParameter1Focus()" ng-blur="onAuthenticationParameter1Blur()" ng-required="viewModel.editableSettings.authenticationParameters[0].shouldDisplay"/></section><section ng-show="viewModel.editableSettings.authenticationParameters[1].shouldDisplay"> <label for="authenticationParameter2" class="input-field-label">{{viewModel.editableSettings.authenticationParameters[1].displayName}}</label> <input id="authenticationParameter2" type="password" ng-disabled="viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.authenticationParameters[1].value" ng-change="onAuthenticationParameter2Change()" ng-focus="onAuthenticationParameter2Focus()" ng-blur="onAuthenticationParameter2Blur()" ng-required="viewModel.editableSettings.authenticationParameters[1].shouldDisplay"/></section></div><section ng-if="enterpriseGatewayETLEnabled"><div class="advancedSettingsContainer" ng-class="{expanded: viewModel.advancedSettingsExpanded}"><i class="glyphicon pbi-glyph-chevronrightmedium expandIcon" ng-click="viewModel.advancedSettingsExpanded = !viewModel.advancedSettingsExpanded; $event.stopPropagation();"></i><span localize="SettingsDataSource_AdvancedSettings"></span><div ng-show="viewModel.advancedSettingsExpanded"><section ng-if="allowSingleSignOn()" id="singleSignOnOptionSection"><div class="singleSignOnSettingCheckBox"> <input id="singleSignOnForDQ" type="checkbox" ng-model="viewModel.isSingleSignOnEnabled" ng-change="onSingleSignOnSettingChange()"/><label class="singleSignOnSettingDescription" localize="SettingsDataSource_SettingsSingleSignOn_Text" for="singleSignOnForDQ"/></div><div class="singleSignOnSettingDescription"><span localize="SettingsDataSource_SettingsSingleSignOn_Info"></span><a target="_blank" href="https://go.microsoft.com/fwlink/?LinkId=627092" localize="LearnMore"></a></div></section><section><label for="dataSourcePrivacyLevel" class="input-field-label" localize="SettingsDataSource_SettingsPrivacyLevelLabel"></label> <select id="dataSourcePrivacyLevel" ng-disabled="viewModel.waitingForDataSourceStatus" ng-model="viewModel.editableSettings.privacyLevel"><option value="0" localize="SettingsDataSource_SettingsPrivacyLevel_None" ng-selected="viewModel.editableSettings.privacyLevel === 0"></option><option value="1" localize="SettingsDataSource_SettingsPrivacyLevel_Private" ng-selected="viewModel.editableSettings.privacyLevel === 1"></option><option value="2" localize="SettingsDataSource_SettingsPrivacyLevel_Organizational" ng-selected="viewModel.editableSettings.privacyLevel === 2"></option><option value="3" localize="SettingsDataSource_SettingsPrivacyLevel_Public" ng-selected="viewModel.editableSettings.privacyLevel === 3"></option></select></section></div></div></section></div><div class="buttonsContainer" ng-if="viewModel.editableSettings.dataSourceType !== undefined"><div ng-switch on="viewModel.isAddingDataSource"> <button class="primary" localize="SettingsDataSource_SettingsApply" ng-switch-when="false" ng-disabled="viewModel.waitingForDataSourceStatus || !settingsForm.$dirty" ng-click="tryApplyChanges()"></button> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-switch-when="true" ng-disabled="viewModel.waitingForDataSourceStatus" ng-click="tryAddDataSource()"></button> <button localize="SettingsDataSource_SettingsDiscard" ng-disabled="!settingsForm.$dirty || viewModel.waitingForDataSourceStatus" ng-click="tryDiscardChanges()" formnovalidate></button></div></div></form></div>'),e.put("views/datasourceUsersView.html",'<div class="formContainer verticalPaneContainer" ng-cloak><div class="leftVerticalPane"><section class="pendingUsersContainer"><label class="input-field-label" localize="SettingsDataSource_UsersAllowed"></label><emails-list view-model="viewModel.pendingUsers" allow-security-groups allow-unified-groups></emails-list></section><section class="editableUsersContainer"><div class="editableUsersTable"><div class="tableContentContainer" ng-switch on="viewModel.isReloadingList || viewModel.isAdding"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false" ng-repeat="editableUser in viewModel.editableUsers" class="pbi-input"> <input type="checkbox" ng-model="editableUser.shouldBeRemoved"> <label class="form-label">{{editableUser.name}}</label></div></div></div> <button localize="SettingsDataSource_SettingsRemove" ng-disabled="viewModel.isReloadingList || shouldDisableRemoveButton()" ng-click="tryRemoveSelectedUsers()"></button> <button class="rightSideButton" ng-if="upnMappingEnabled" localize="UpnMappingPane_Title" ng-disabled="!viewModel.editableUsers || viewModel.editableUsers.length === 0" ng-click="mapUserNames()"></button></section></div><div class="rightVerticalPane"> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-disabled="viewModel.isAdding || !viewModel.pendingUsers.inputUserList" ng-click="tryAddUsers()"></button></div></div>'),e.put("views/datasourceView.html",'<div class="settingsContainer" ng-cloak><div class="tabHeader"><ul><li ng-click="onTabSelected(1)" ng-class="{selected: viewModel.tabSelectionType === 1}" localize="SettingsDataSource_SettingsTitle"></li><li ng-click="onTabSelected(2)" ng-class="{selected: viewModel.tabSelectionType === 2}" ng-if="viewModel.id !== -1" localize="SettingsDataSource_UsersTitle"></li></ul></div><div ng-switch on="viewModel.tabSelectionType"><datasource-settings ng-switch-when="1" datasource-model="viewModel"></datasource-settings><datasource-users ng-switch-when="2" datasource-model="viewModel"></datasource-users></div></div>'),e.put("views/gatewayAdministratorsView.html",'<div class="formContainer verticalPaneContainer" ng-cloak><div class="leftVerticalPane"><section class="pendingUsersContainer"><label class="input-field-label" localize="SettingsDataSource_AdminsAllowed"></label><emails-list view-model="viewModel.pendingUsers" allow-security-groups allow-unified-groups></emails-list></section><section class="editableUsersContainer"><div class="editableUsersTable"><div class="tableContentContainer" ng-switch on="viewModel.isReloadingList || viewModel.isAdding"><div ng-switch-when="true"><spinner></spinner></div><div ng-switch-when="false" ng-repeat="editableUser in viewModel.editableUsers" class="pbi-input"> <input type="checkbox" ng-model="editableUser.shouldBeRemoved"> <label class="form-label">{{editableUser.name}}</label></div></div></div> <button class="rightSideButton" localize="SettingsDataSource_SettingsRemove" ng-disabled="viewModel.isReloadingList || shouldDisableRemoveButton()" ng-click="tryRemoveSelectedAdminstrators()"></button></section></div><div class="rightVerticalPane"> <button class="primary" localize="SettingsDataSource_SettingsAdd" ng-disabled="viewModel.isAdding || !viewModel.pendingUsers.inputUserList" ng-click="tryAddAdministrators()"></button></div></div>'),
e.put("views/gatewaySettingsView.html",'<div class="formContainer" ng-cloak><header ng-switch="viewModel.isLoadingStatus"><div ng-switch-when="false" ng-switch="viewModel.status"><div ng-switch-when="1"><inline-message use-error-icon trace-details="viewModel.traceDetails"><span ng-bind="viewModel.connectionError"></span></inline-message></div><div ng-switch-when="2"><span class="glyphicon glyph-small pbi-glyph-success glyph-success-color"></span><span localize="SettingsGateway_ConnectedText"></span></div></div><div ng-switch-when="true"><div class="statusContainer"><spinner class="settingsLoadingSpinner"></spinner><span localize="SettingsGateway_WaitingForConnectinonText"></span></div></div><div class="warning" ng-if="viewModel.status === 2 && viewModel.dataSources.length === 0"><inline-message class="inlineInfo"><span class="glyphicon glyph-small pbi-glyph-info"></span><a href=\'\' localize="AddDataSourceToGatewayText" ng-click="addDataSource()"></a></inline-message></div></header><form name="settingsForm" autocomplete="off"><section><label for="gatewayName" class="input-field-label" localize="SettingsGateway_Name"></label> <input id="gatewayName" type="text" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model=viewModel.displayName ng-change="updateDirtyFlag()"/></section><section><label for="gatewayDepartment" class="input-field-label" localize="SettingsGateways_Department"></label> <input id="gatewayDepartment" type="text" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model=viewModel.gatewayAnnotation.gatewayDepartment ng-change="updateDirtyFlag()"/></section><section><label for="gatewayDescription" class="input-field-label" localize="SettingsGateway_Description"></label><textarea id="gatewayDescription" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model="viewModel.description" ng-change="updateDirtyFlag()" ng-trim="false" maxlength="4000"/></section><section><label for="gatewayContactInfo" class="input-field-label" localize="SettingsGateway_ContactInformation"></label><textarea id="gatewayContactInfo" ng-disabled="viewModel.isWaitingForGatewayUpdate" ng-model="viewModel.contactInformationString" ng-change="updateDirtyFlag()" ng-trim="false" maxlength="4000"/></section><div class="buttonsContainer"> <button class="biButton primary" localize="SettingsDataset_ApplyButtonText" ng-disabled="!viewModel.isDirty" ng-click="applyChanges()"></button> <button class="biButton" localize="SettingsDataSource_SettingsDiscard" ng-disabled="!viewModel.isDirty" ng-click="discardChanges()"></button></div></form></div>'),e.put("views/gatewaysView.html",'<div class="gatewaysSliderContentView" ng-switch="isLoading"><div class="gatewaysLayoutTop"><div class="sliderContentHeader"><div localize="EnterpriseGateway_Title" feature-switch-not="breadcrumbNavigationEnabled"></div><spinner class="large settingsLoadingSpinner" ng-switch-when="true"></spinner></div></div><div class="gatewaysLayoutBody" ng-switch-when="false" ng-switch="viewModel.gateways.length> 0" feature-switch-class="breadcrumbNavigationEnabled"><div ng-switch-when="true"><div class="settingsAddDataSource" ng-click="tryAddDataSource()"><span class="glyphicon glyph-mini pbi-glyph-add" feature-switch-not="breadcrumbNavigationEnabled"></span><span class="settingsAddDataSourceLabel" localize="AddDataSourceText"></span></div><div class="settingsGateways"><div class="settingsGatewaysLeftColumn"><div class="gatewayTree"><ul><li class="navTreeItem" ng-repeat="gateway in viewModel.gateways" ng-class="{expanded: gateway.isExpanded}"><div ng-click="onItemSelected(gateway.id, null)" ng-class="{selected: gateway.isExpanded ? viewModel.currentGatewayId === gateway.id && viewModel.currentDataSourceId === null : viewModel.currentGatewayId === gateway.id}"><div class="gatewayTreeItem"> <span class="expanderContainer"><i ng-show="gateway.dataSources.length>0" class="glyphicon refreshSectionExpander pbi-glyph-chevronrightmedium expandIcon" ng-click="gateway.isExpanded = !gateway.isExpanded; $event.stopPropagation();"></i></span><span class="gatewayLabel trimmedTextWithEllipsis" ng-bind="gateway.displayName"></span><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon" ng-if="gateway.status != 2"></span> <button class="contextMenuButton" context-menu localize-tooltip="NavigationPane_OpenMenu" context="gateway.contextMenuItem" ng-click="$event.stopPropagation()"><i class="glyphicon pbi-glyph-more gatewayMoreIcon"></i></button></div></div><div class="expandableInnerContainer" ng-show="gateway.isExpanded"><ul><li ng-repeat="dataSource in gateway.dataSources" ng-click="onItemSelected(gateway.id, dataSource.id)" class="gatewayTreeItem" ng-class="{selected: viewModel.currentGatewayId === gateway.id && viewModel.currentDataSourceId === dataSource.id}"><span class="gatewayLabel trimmedTextWithEllipsis" ng-bind="dataSource.displayName"></span><span class="glyphicon pbi-glyph-warning glyph-small glyph-warning-color warningIcon" ng-if="dataSource.connectionError || dataSource.compositeErrorMessage"></span> <button class="contextMenuButton" context-menu localize-tooltip="NavigationPane_OpenMenu" context="dataSource.contextMenuItem" ng-click="$event.stopPropagation()"><i class="glyphicon pbi-glyph-more gatewayMoreIcon"></i></button></li></ul></div></li></ul></div><div class="testConnectionContainer"> <button localize="SettingsGateway_TestConnections" ng-click="testConnections()"></button></div></div><div class="settingsGatewaysRightColumn"><div ng-switch on="getSelectionType()"><gateway ng-switch-when="1" view-model="viewModel.currentGateway"></gateway><datasource ng-switch-when="2" view-model="viewModel.currentDataSource"></datasource></div></div></div></div><div class="gatewaysEmpty unselectable" ng-switch-when="false"><i class="glyphicon pbi-glyph-warning glyph-med warningIcon"></i><h2 localize="Gateways_NoGatewaysWarningTitle"></h2><p localize="Gateways_NoGatewaysWarningText"></p><a href="https://go.microsoft.com/fwlink/?LinkId=627094" target="_blank" localize="LearnMore"></a></div></div></div>'),e.put("views/gatewayView.html",'<div class="settingsContainer" ng-cloak><div class="tabHeader"><ul><li ng-click="onTabSelected(1)" ng-class="{selected: viewModel.tabSelectionType === 1}"><span localize="SettingsGateway_SettingsTitle"></span></li><li ng-click="onTabSelected(2)" ng-class="{selected: viewModel.tabSelectionType === 2}"><span localize="GatewayDataSource_SettingsAdministrators"></span></li></ul></div><div ng-switch on="viewModel.tabSelectionType"><gateway-settings ng-switch-when="1" view-model="viewModel"></gateway-settings><gateway-administrators ng-switch-when="2" gateway-model="viewModel"></gateway-administrators></div></div>'),e.put("views/selectGatewayView.html",'<div class="selectGateway" ng-class="{\'noEGW\': viewModel.enterpriseGateways.length===0, \'singleEGW\': viewModel.enterpriseGateways.length===1, \'multipleEGW\': viewModel.enterpriseGateways.length> 1}"><div localize="SettingsDataset_Gateway_StaticInfo" localize-fragments><a fragment-index="0" localize="SettingsDataset_Gateway_StaticInfo_ManageGateways" href="" ng-click="navigateToManageGateways()"></a><a fragment-index="1" localize="LearnMore" target="_blank" href="//go.microsoft.com/fwlink/?LinkID=799429&clcid=0x409"></a></div><div ng-show="::viewModel.showHeader"><div class="title"><span ng-bind="viewModel.title"></span></div></div><div class="gatewayTypeSelectionContainer" ng-show="viewModel.allowPersonalGateway"><div class="gwOption" ng-switch on="viewModel.isCloudScheduleRefresh"><span ng-show="viewModel.showNewPersonalGatewayAvailableMessage"><label localize="SettingsDataset_New_OnPrem_Gateway_Available" class="newPersonalGatewayAvailableMessage"></label><a localize="LearnMore" target="_blank" href="//go.microsoft.com/fwlink/?LinkId=843378" class="pgwLink"></a></span> <span class="pbi-input"><input ng-switch-when="false" type="radio" name="pgwRadioOption" ng-model="viewModel.useEnterpriseGateway" ng-value="false" ng-change="gatewayTypeSelected()" ng-disabled="viewModel.pgw.gatewayStatus === 1"><label ng-switch-when="false" class="form-label" localize="SettingsDataset_GatewaySelectLabel_PGW"></label> <input ng-switch-when="true" type="radio" name="pgwRadioOption" ng-model="viewModel.useEnterpriseGateway" ng-value="false" ng-change="gatewayTypeSelected()" ng-disabled="isSovereignCloud"><label ng-switch-when="true" class="form-label" localize="SettingsDataset_GatewaySelectLabel_Cloud"></label></span><span class="additionalInfo" ng-switch-when="false"><span ng-show="viewModel.pgw.gatewayStatus === 0" localize="Gateways_StatusWithMachineName" localize-fragments><span fragment-index="0" class="gatewayStatusLabelOnline" localize="Gateways_Status_Online"></span><span fragment-index="1" ng-bind="viewModel.pgwAnnotation.gatewayMachine"></span></span><span ng-show="viewModel.pgw.gatewayStatus === 1"><a localize="SettingsDataset_OnPrem_Gateway_InstallNow" target="_blank" href="//go.microsoft.com/fwlink/?LinkID=534231" class="pgwLink"></a><a localize="LearnMore" target="_blank" href="//go.microsoft.com/fwlink/?LinkId=627094" class="pgwLink"></a></span><span ng-show="viewModel.pgw.gatewayStatus === 2 || viewModel.pgw.gatewayStatus === 3" localize="Gateways_StatusWithMachineName" localize-fragments><span fragment-index="0" class="gatewayStatusLabelOffline" localize="Gateways_Status_Offline"></span><span fragment-index="1" ng-bind="viewModel.pgwAnnotation.gatewayMachine"></span></span><span ng-show="viewModel.isDMTSPersonalGateway"><a localize="SettingsGateway_DeletePersonalGateway" target="_blank" class="pgwLink" ng-click="deletePersonalGateway()"></a></span></span></div><div class="gwOption"> <span class="pbi-input"><input type="radio" name="egwRadioOption" ng-model="viewModel.useEnterpriseGateway" ng-value="true" ng-change="gatewayTypeSelected()" ng-disabled="!viewModel.egwStatusLoaded || viewModel.enterpriseGateways.length === 0"><label class="form-label" localize="SettingsDataset_GatewaySelectLabel_EGW"></label></span><spinner ng-show="!viewModel.egwStatusLoaded"></spinner></div></div><div ng-show="viewModel.egwStatusLoaded"><div class="gatewaysIntroText hideIfNoEGW hideIfSingleEGW" localize="Gateways_MultipleEnterpriseGatewaysText"></div><div class="gatewaysIntroText hideIfNoEGW hideIfMultipleEGW" localize="Gateways_SingleEnterpriseGatewaysText" ng-show="!viewModel.allowPersonalGateway"></div><div class="gatewaysIntroText hideIfSingleEGW hideIfMultipleEGW" localize="Gateways_NoEnterpriseGatewaysText" ng-show="!viewModel.allowPersonalGateway"></div></div><div class="gatewaysTableOuterContainer hideIfNoEGW" ng-switch on="viewModel.egwStatusLoaded"><spinner ng-switch-when="false"></spinner><div class="gatewaysTableInnerContainer" ng-switch-when="true"><table class="gatewaysTable"><thead class="gatewaysTableHeader"><tr><th class="gatewaysTableSelection hideIfNoEGW hideIfSingleEGW"></th><th class="gatewaysTableStatus" ng-show="viewModel.showStatus"><div class="gatewaysTableHeaderContent" localize="SettingsGateways_Status"></div></th><th class="gatewaysTableDepartmentName"><div class="gatewaysTableHeaderContent" localize="SettingsGateways_Department"></div></th><th class="gatewaysTableGatewayName"><div class="gatewaysTableHeaderContent" localize="SettingsGateways_Gateway"></div></th><th class="gatewaysTableCreatedBy"><div class="gatewaysTableHeaderContent" localize="SettingsGateways_ContactInformation"></div></th><th class="gatewaysTableGatewayDescription"><div class="gatewaysTableHeaderContent" localize="SettingsGateway_Description"></div></th></tr></thead><tbody class="gatewaysTableBody"><tr ng-repeat="gateway in viewModel.enterpriseGateways" ng-click="enterpriseGatewaySelected(gateway.id)"><td class="egwRadioButton hideIfNoEGW hideIfSingleEGW"><div class="pbi-input"> <input type="radio" name="gwRadioOption" ng-model="viewModel.selectedGatewayId" ng-value="gateway.id" ng-click="enterpriseGatewaySelected(gateway.id)"><label class="dummyRadioButtonLabel"></label></div></td><td ng-show="viewModel.showStatus"><span ng-show="gateway.status === 1" class="gatewayStatusLabelOffline" localize="Gateways_Status_Offline"></span><span ng-show="gateway.status === 2" class="gatewayStatusLabelOnline" localize="Gateways_Status_Online"></span><spinner ng-show="gateway.status === 3" class="gatewayStatusSpinner glyph-mini"></spinner></td><td class="trimmedTextWithEllipsis"><span ng-bind="gateway.gatewayAnnotation.gatewayDepartment" title="{{gateway.gatewayAnnotation.gatewayDepartment}}"></span></td><td class="trimmedTextWithEllipsis"><span ng-if="gateway.displayName" ng-bind="gateway.displayName" title="{{gateway.displayName}}"></span><span ng-if="!gateway.displayName" localize="SettingsGateways_ConnectToCloudDatasource"></span></td><td class="trimmedTextWithEllipsis"><span ng-bind="gateway.gatewayAnnotation.gatewayContactInformation.join(\';\')" title="{{gateway.gatewayAnnotation.gatewayContactInformation.join(\';\')}}"></span></td><td><span ng-bind="gateway.description" title="{{gateway.description}}"></span></td></tr></tbody></table></div></div></div>')}]);var powerbi;!(function(e){var t;!(function(t){function i(e,t,i,a,o){return new n(e,t,i,a,o)}var a=e.common.contracts.GroupType;t.createAdminPortalService=i;var n=(function(){function i(e,t,i,a,n){this.promiseFactory=e,this.adminPortalHttpService=t,this.localizationService=i,this.telemetryService=a}return i.prototype.getTenantSettings=function(e){var i=this,a=this.promiseFactory.defer();return this.adminPortalHttpService.getTenantSettings(e).then((function(e){a.resolve(t.models.AdminPortalModelFactory.convertTenantSettings(e.data,i.localizationService))}),(function(e){a.reject(e)})),a.promise},i.prototype.updateTenantSettingsConfig=function(e,t){var i=this.promiseFactory.defer();return this.adminPortalHttpService.updateTenantSettingsConfig(e.map((function(e){return e.contract})),t).then((function(e){i.resolve(e)}),(function(e){i.reject(e)})),i.promise},i.prototype.getTenantSettingsV2=function(e){var i=this,a=this.promiseFactory.defer();return this.adminPortalHttpService.getTenantSettingsV2(e).then((function(e){a.resolve(t.models.AdminPortalModelFactory.convertTenantSettingsV2(e.data,i.localizationService))}),(function(e){a.reject(e)})),a.promise},i.prototype.updateTenantSettingsConfigV2=function(e,t){var i={featureSwitches:e.featureSwitches.map((function(e){return e.contract})),dataClassifications:e.dataClassifications};return this.adminPortalHttpService.updateTenantSettingsConfigV2(i,t)},i.prototype.updateTenantSetting=function(e,t){var i=this,a={featureSwitches:_.map([e],(function(e){return i.updateAndGetTenantSettingContract(e)})),dataClassifications:void 0};return this.adminPortalHttpService.updateTenantSettingsConfigV2(a,t)},i.prototype.updateDataClassifications=function(e,t){var i={featureSwitches:[],dataClassifications:e};return this.adminPortalHttpService.updateTenantSettingsConfigV2(i,t)},i.prototype.updateTenantSettingsAndDataClassifications=function(e,t,i){var a=this,n={featureSwitches:_.map(e,(function(e){return a.updateAndGetTenantSettingContract(e)})),dataClassifications:t};return this.adminPortalHttpService.updateTenantSettingsConfigV2(n,i)},i.prototype.refreshAndGetAdminUserMetadata=function(){if(!this._userMetadataPromise){var t=this.promiseFactory.defer(),i=this.telemetryService.startEvent(e.telemetry.DashboardRefreshAndGetUserMetadata);this.adminPortalHttpService.refreshAndGetAdminUserMetadata(i.event).then((function(e){t.resolve(e.data),i.resolve()}),(function(){t.reject(),i.reject()})),this._userMetadataPromise=t.promise}return this._userMetadataPromise},i.prototype.updateAndGetTenantSettingContract=function(e){return e.contract.isEnabled=e.isEnabled,e.contract.allowedSecurityGroups=this.createSecurityGroupsContracts(e.allowedSecurityGroups),e.contract.deniedSecurityGroups=this.createSecurityGroupsContracts(e.deniedSecurityGroups),e.contract},i.prototype.createSecurityGroupsContracts=function(e){var t=this;return _.map(e.inputUserList,(function(e){return t.createSecurityGroupContract(e)}))},i.prototype.createSecurityGroupContract=function(e){return{id:e.objectId,name:e.displayName,emailAddress:e.userPrincipalName,isEmailEnabled:e.groupType===a.EmailEnabledSecurityGroup}},i})()})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(){return new a}t.createAdminPortalHttpService=i;var a=(function(){function t(){}return t.prototype.getAdminUsageGroupMetadata=function(t,i){var a=e.common.httpService.powerbiRequestOptions(i,"GetAdminGroupContainer",{isAdminRequest:!0,groupObjectIdOverride:t});return e.common.httpService.get("powerbi/metadata/admingroupmetadata/",a)},t.prototype.getAdminUsageDashboardMetadata=function(t,i,a){var n=e.common.httpService.powerbiRequestOptions(a,"GetAdminUsageDashboardMetadata",{isAdminRequest:!0,groupObjectIdOverride:i});return e.common.httpService.get("powerbi/metadata/dashboards/"+t,n)},t.prototype.batchGetAdminUsageTiles=function(t,i,a,n){var o=e.common.httpService.powerbiRequestOptions(n,"BatchGetAdminUsageTiles",{isAdminRequest:!0,groupObjectIdOverride:a});return o.enableTelemetry=!0,e.common.httpService.post("powerbi/metadata/dashboard/"+t+"/tiles",JSON.stringify(i),o)},t.prototype.createAdminUsageDashboard=function(t,i){var a=e.common.httpService.powerbiRequestOptions(i,"createAdminUsageDashboard",{isAdminRequest:!0,groupObjectIdOverride:t});return e.common.httpService.get("powerbi/content/providers/adminportal/usage/",a)},t.prototype.getTenantSettings=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"GetTenantSettings",{isAdminRequest:!0});return i.enableTelemetry=!0,e.common.httpService.get("/powerbi/flight/tenantswitches",i)},t.prototype.updateTenantSettingsConfig=function(t,i){var a=e.common.httpService.powerbiRequestOptions(i,"UpdateTenantSettings",{isAdminRequest:!0});return a.enableTelemetry=!0,e.common.httpService.post("/powerbi/flight/tenantswitches",{switches:t},a)},t.prototype.getTenantSettingsV2=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"GetTenantSettings",{isAdminRequest:!0});return i.enableTelemetry=!0,e.common.httpService.get("/metadata/tenantsettings",i)},t.prototype.updateTenantSettingsConfigV2=function(t,i){var a=e.common.httpService.powerbiRequestOptions(i,"UpdateTenantSettings",{isAdminRequest:!0});return a.enableTelemetry=!0,e.common.httpService.put("/metadata/tenantsettings",t,a)},t.prototype.refreshAndGetAdminUserMetadata=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"RefreshAndGetAdminUserMetadata",{isAdminRequest:!0,dismissGroupObjectId:!0});return e.common.httpService.put("powerbi/metadata/refreshusermetadata",null,i)},t})()})(t=e.settings||(e.settings={}))})(powerbi||(powerbi={}));;var __awaiter=this&&this.__awaiter||function(t,i,e,a){return new(e||(e=Promise))(function(n,o){function r(t){try{s(a.next(t))}catch(t){o(t)}}function c(t){try{s(a.throw(t))}catch(t){o(t)}}function s(t){t.done?n(t.value):new e(function(i){i(t.value)}).then(r,c)}s((a=a.apply(t,i)).next())})},__generator=this&&this.__generator||function(t,i){function e(t){return function(i){return a([t,i])}}function a(e){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(r=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[0,r.value]),e[0]){case 0:case 1:r=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,o=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(r=c.trys,!(r=r.length>0&&r[r.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){c.label=e[1];break}if(6===e[0]&&c.label<r[1]){c.label=r[1],r=e;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(e);break}r[2]&&c.ops.pop(),c.trys.pop();continue}e=i.call(t,c)}catch(t){e=[6,t],o=0}finally{n=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return{next:e(0),throw:e(1),return:e(2)}},powerbi;!(function(t){var i;!(function(i){i.CapacityAdminProvisioningCapacity=function(i,e,a,n,o,r,c,s,p,l,d,y,u,g,m){void 0===o&&(o=!1),void 0===r&&(r=void 0),void 0===c&&(c=void 0),void 0===s&&(s=void 0),void 0===p&&(p=void 0),void 0===l&&(l=void 0),void 0===d&&(d=!1),void 0===y&&(y=!1),void 0===u&&(u=void 0),void 0===g&&(g=!1),void 0===m&&(m=!1);var v={capacityId:i,adminsCount:e,capacityPlan:a,parentId:n,isError:o,errorSource:r,errorCode:c,errorMessage:s,activityName:p,activityId:l,isDebug:d,isCancelled:y,pingLatency:u,isAppInactive:g,isInCapacity:m},h={name:"PBI.CapacityAdmin.ProvisioningCapacity",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={capacityId:v.capacityId,adminsCount:v.adminsCount,capacityPlan:v.capacityPlan,parentId:v.parentId},e=typeof v.isError;("boolean"===e&&!!v.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isError=v.isError);var e=typeof v.errorSource;("boolean"===e&&!!v.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorSource=t.telemetry.ErrorSource[v.errorSource]);var e=typeof v.errorCode;("boolean"===e&&!!v.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorCode=v.errorCode);var e=typeof v.errorMessage;("boolean"===e&&!!v.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorMessage=v.errorMessage);var e=typeof v.activityName;("boolean"===e&&!!v.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityName=v.activityName);var e=typeof v.activityId;("boolean"===e&&!!v.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityId=v.activityId);var e=typeof v.isDebug;("boolean"===e&&!!v.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isDebug=v.isDebug);var e=typeof v.isCancelled;("boolean"===e&&!!v.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isCancelled=v.isCancelled);var e=typeof v.pingLatency;("boolean"===e&&!!v.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(i.pingLatency=v.pingLatency);var e=typeof v.isAppInactive;("boolean"===e&&!!v.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isAppInactive=v.isAppInactive);var e=typeof v.isInCapacity;return("boolean"===e&&!!v.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isInCapacity=v.isInCapacity),i},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof t.telemetry.CapacityAdminProvisioningCapacityLoggers&&(h.loggers=t.telemetry.CapacityAdminProvisioningCapacityLoggers),h},i.CapacityAdminModifyingAdmins=function(i,e,a,n,o,r,c,s,p,l,d,y,u,g,m,v,h,f){void 0===s&&(s=!1),void 0===p&&(p=void 0),void 0===l&&(l=void 0),void 0===d&&(d=void 0),void 0===y&&(y=void 0),void 0===u&&(u=void 0),void 0===g&&(g=!1),void 0===m&&(m=!1),void 0===v&&(v=void 0),void 0===h&&(h=!1),void 0===f&&(f=!1);var C={capacityId:i,adminsCount:e,usersCount:a,workspacesCount:n,capacityPlan:o,isTenantCapacity:r,parentId:c,isError:s,errorSource:p,errorCode:l,errorMessage:d,activityName:y,activityId:u,isDebug:g,isCancelled:m,pingLatency:v,isAppInactive:h,isInCapacity:f},b={name:"PBI.CapacityAdmin.ModifyingAdmins",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={capacityId:C.capacityId,adminsCount:C.adminsCount,usersCount:C.usersCount,workspacesCount:C.workspacesCount,capacityPlan:C.capacityPlan,isTenantCapacity:C.isTenantCapacity,parentId:C.parentId},e=typeof C.isError;("boolean"===e&&!!C.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isError=C.isError);var e=typeof C.errorSource;("boolean"===e&&!!C.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorSource=t.telemetry.ErrorSource[C.errorSource]);var e=typeof C.errorCode;("boolean"===e&&!!C.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorCode=C.errorCode);var e=typeof C.errorMessage;("boolean"===e&&!!C.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorMessage=C.errorMessage);var e=typeof C.activityName;("boolean"===e&&!!C.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityName=C.activityName);var e=typeof C.activityId;("boolean"===e&&!!C.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityId=C.activityId);var e=typeof C.isDebug;("boolean"===e&&!!C.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isDebug=C.isDebug);var e=typeof C.isCancelled;("boolean"===e&&!!C.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isCancelled=C.isCancelled);var e=typeof C.pingLatency;("boolean"===e&&!!C.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(i.pingLatency=C.pingLatency);var e=typeof C.isAppInactive;("boolean"===e&&!!C.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isAppInactive=C.isAppInactive);var e=typeof C.isInCapacity;return("boolean"===e&&!!C.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isInCapacity=C.isInCapacity),i},info:C,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof t.telemetry.CapacityAdminModifyingAdminsLoggers&&(b.loggers=t.telemetry.CapacityAdminModifyingAdminsLoggers),b},i.CapacityAdminModifyingAccess=function(i,e,a,n,o,r,c,s,p,l,d,y,u,g,m,v,h,f,C,b,S,A,w){void 0===u&&(u=!1),void 0===g&&(g=void 0),void 0===m&&(m=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0),void 0===f&&(f=void 0),void 0===C&&(C=!1),void 0===b&&(b=!1),void 0===S&&(S=void 0),void 0===A&&(A=!1),void 0===w&&(w=!1);var M={capacityId:i,adminsCount:e,usersCount:a,workspacesCount:n,capacityPlan:o,isTenantCapacity:r,usersAddedCount:c,usersRemovedCount:s,groupsAddedCount:p,groupsRemovedCount:l,isEntireTenant:d,parentId:y,isError:u,errorSource:g,errorCode:m,errorMessage:v,activityName:h,activityId:f,isDebug:C,isCancelled:b,pingLatency:S,isAppInactive:A,isInCapacity:w},k={name:"PBI.CapacityAdmin.ModifyingAccess",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={capacityId:M.capacityId,adminsCount:M.adminsCount,usersCount:M.usersCount,workspacesCount:M.workspacesCount,capacityPlan:M.capacityPlan,isTenantCapacity:M.isTenantCapacity,usersAddedCount:M.usersAddedCount,usersRemovedCount:M.usersRemovedCount,groupsAddedCount:M.groupsAddedCount,groupsRemovedCount:M.groupsRemovedCount,isEntireTenant:M.isEntireTenant,parentId:M.parentId},e=typeof M.isError;("boolean"===e&&!!M.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isError=M.isError);var e=typeof M.errorSource;("boolean"===e&&!!M.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorSource=t.telemetry.ErrorSource[M.errorSource]);var e=typeof M.errorCode;("boolean"===e&&!!M.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorCode=M.errorCode);var e=typeof M.errorMessage;("boolean"===e&&!!M.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorMessage=M.errorMessage);var e=typeof M.activityName;("boolean"===e&&!!M.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityName=M.activityName);var e=typeof M.activityId;("boolean"===e&&!!M.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityId=M.activityId);var e=typeof M.isDebug;("boolean"===e&&!!M.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isDebug=M.isDebug);var e=typeof M.isCancelled;("boolean"===e&&!!M.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isCancelled=M.isCancelled);var e=typeof M.pingLatency;("boolean"===e&&!!M.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(i.pingLatency=M.pingLatency);var e=typeof M.isAppInactive;("boolean"===e&&!!M.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isAppInactive=M.isAppInactive);var e=typeof M.isInCapacity;return("boolean"===e&&!!M.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isInCapacity=M.isInCapacity),i},info:M,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof t.telemetry.CapacityAdminModifyingAccessLoggers&&(k.loggers=t.telemetry.CapacityAdminModifyingAccessLoggers),k},i.CapacityAdminMigratingWorkspaces=function(i,e,a,n,o,r,c,s,p,l,d,y,u,g,m,v,h,f,C,b){void 0===l&&(l=!1),void 0===d&&(d=void 0),void 0===y&&(y=void 0),void 0===u&&(u=void 0),void 0===g&&(g=void 0),void 0===m&&(m=void 0),void 0===v&&(v=!1),void 0===h&&(h=!1),void 0===f&&(f=void 0),void 0===C&&(C=!1),void 0===b&&(b=!1);var S={targetCapacityId:i,sourceCapacityId:e,adminsCount:a,workspacesCount:n,usersCount:o,capacityPlan:r,isEntireTenantMigration:c,isTenantCapacity:s,parentId:p,isError:l,errorSource:d,errorCode:y,errorMessage:u,activityName:g,activityId:m,isDebug:v,isCancelled:h,pingLatency:f,isAppInactive:C,isInCapacity:b},A={name:"PBI.CapacityAdmin.MigratingWorkspaces",category:t.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={targetCapacityId:S.targetCapacityId,sourceCapacityId:S.sourceCapacityId,adminsCount:S.adminsCount,workspacesCount:S.workspacesCount,usersCount:S.usersCount,capacityPlan:S.capacityPlan,isEntireTenantMigration:S.isEntireTenantMigration,isTenantCapacity:S.isTenantCapacity,parentId:S.parentId},e=typeof S.isError;("boolean"===e&&!!S.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isError=S.isError);var e=typeof S.errorSource;("boolean"===e&&!!S.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorSource=t.telemetry.ErrorSource[S.errorSource]);var e=typeof S.errorCode;("boolean"===e&&!!S.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorCode=S.errorCode);var e=typeof S.errorMessage;("boolean"===e&&!!S.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorMessage=S.errorMessage);var e=typeof S.activityName;("boolean"===e&&!!S.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityName=S.activityName);var e=typeof S.activityId;("boolean"===e&&!!S.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityId=S.activityId);var e=typeof S.isDebug;("boolean"===e&&!!S.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isDebug=S.isDebug);var e=typeof S.isCancelled;("boolean"===e&&!!S.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isCancelled=S.isCancelled);var e=typeof S.pingLatency;("boolean"===e&&!!S.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(i.pingLatency=S.pingLatency);var e=typeof S.isAppInactive;("boolean"===e&&!!S.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isAppInactive=S.isAppInactive);var e=typeof S.isInCapacity;return("boolean"===e&&!!S.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isInCapacity=S.isInCapacity),i},info:S,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof t.telemetry.CapacityAdminMigratingWorkspacesLoggers&&(A.loggers=t.telemetry.CapacityAdminMigratingWorkspacesLoggers),A},i.CapacityAdminBuyNowClicked=function(i,e,a,n,o,r,c,s,p,l,d,y,u,g){void 0===n&&(n=!1),void 0===o&&(o=void 0),void 0===r&&(r=void 0),void 0===c&&(c=void 0),void 0===s&&(s=void 0),void 0===p&&(p=void 0),void 0===l&&(l=!1),void 0===d&&(d=!1),void 0===y&&(y=void 0),void 0===u&&(u=!1),void 0===g&&(g=!1);var m={capacitiesCount:i,isTenantAdmin:e,parentId:a,isError:n,errorSource:o,errorCode:r,errorMessage:c,activityName:s,activityId:p,isDebug:l,isCancelled:d,pingLatency:y,isAppInactive:u,isInCapacity:g},v={name:"PBI.CapacityAdmin.BuyNowClicked",category:t.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var i={capacitiesCount:m.capacitiesCount,isTenantAdmin:m.isTenantAdmin,parentId:m.parentId},e=typeof m.isError;("boolean"===e&&!!m.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isError=m.isError);var e=typeof m.errorSource;("boolean"===e&&!!m.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorSource=t.telemetry.ErrorSource[m.errorSource]);var e=typeof m.errorCode;("boolean"===e&&!!m.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorCode=m.errorCode);var e=typeof m.errorMessage;("boolean"===e&&!!m.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(i.errorMessage=m.errorMessage);var e=typeof m.activityName;("boolean"===e&&!!m.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityName=m.activityName);var e=typeof m.activityId;("boolean"===e&&!!m.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(i.activityId=m.activityId);var e=typeof m.isDebug;("boolean"===e&&!!m.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isDebug=m.isDebug);var e=typeof m.isCancelled;("boolean"===e&&!!m.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isCancelled=m.isCancelled);var e=typeof m.pingLatency;("boolean"===e&&!!m.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(i.pingLatency=m.pingLatency);var e=typeof m.isAppInactive;("boolean"===e&&!!m.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isAppInactive=m.isAppInactive);var e=typeof m.isInCapacity;return("boolean"===e&&!!m.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(i.isInCapacity=m.isInCapacity),i},info:m,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof t.telemetry.CapacityAdminBuyNowClickedLoggers&&(v.loggers=t.telemetry.CapacityAdminBuyNowClickedLoggers),v}})(i=t.telemetry||(t.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){function e(i){var e=[{name:"CapacityAdminContainer",blockType:2,consumerHostFlags:a.Web},{name:"CapacityMigrateWorkspaces",blockType:2,consumerHostFlags:a.Web},{name:"CapacityHeader",blockType:2,consumerHostFlags:a.Web},{name:"CapacityIndex",blockType:2,consumerHostFlags:a.Web},{name:"CapacityProvisioning",blockType:2,consumerHostFlags:a.Web},{name:"CapacityMain",blockType:2,consumerHostFlags:a.Web},{name:"CapacityMainAssignAdmins",blockType:2,consumerHostFlags:a.Web},{name:"CapacityMainAssignUsers",blockType:2,consumerHostFlags:a.Web},{name:"CapacityMainExpander",blockType:2,consumerHostFlags:a.Web},{name:"CapacitySettingsEditor",blockType:2,consumerHostFlags:a.Web},{name:"CapacitySortedUsersList",blockType:2,consumerHostFlags:a.Web},{name:"CapacityStatus",blockType:2,consumerHostFlags:a.Web},{name:"CapacityWorkspaces",blockType:2,consumerHostFlags:a.Web},{name:"CapacityMainMetrics",blockType:2,consumerHostFlags:a.Web},{name:"CapacityNotification",blockType:2,consumerHostFlags:a.Web},{name:"CapacityWorkspaceStatus",blockType:2,consumerHostFlags:a.Web},{name:"CapacityActions",blockType:2,consumerHostFlags:a.Web}];t.common.registerBuildingBlocksForHost(i,e,{componentsTarget:"powerbi.capacityAdmin.components",componentsMap:t.capacityAdmin.components})}var a=t.common.HostEnv;angular.module("powerbi.capacityAdmin",[]).factory("capacityAdminHttpProxy",["userInfo",function(i){return t.capacityAdmin.proxies.createCapacityAdminHttpProxy(i)}]).factory("selectedCapacityService",["$rootScope","navigation","capacityAdminHttpProxy","promiseFactory",function(i,e,a,n){return t.capacityAdmin.services.createSelectedCapacityService(i,e,a,n)}]).factory("capacityProvisioningService",["capacityAdminHttpProxy","navigation","localizationService","$timeout","selectedCapacityService","notificationToast","promiseFactory",function(i,e,a,n,o,r,c){return t.capacityAdmin.services.createCapacityProvisioningService(i,e,a,n,o,r,c)}]).factory("capacityAccessUpdateService",["capacityAdminHttpProxy",function(i){return t.capacityAdmin.services.createCapacityAccessUpdateService(i)}]).factory("capacityAdminTelemetryService",["telemetryService","selectedCapacityService",function(i,e){return t.capacityAdmin.services.createCapacityAdminTelemetryService(i,e)}]),angular.module("powerbi.capacityAdmin.components",[]),i.registerBuildingBlocksForHost=e})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={})),angular.module("powerbi.capacityAdmin").run(["$templateCache",function(t){t.put("components/capacityActions/capacityActions.html",'<div ng-switch="$ctrl.capacityState"><a class="newCapacity" ng-switch-when="0" localize="CapacityAdmin_Action_NotActivated"></a><a class="invalidCapacity" ng-switch-when="8" localize="AdminPortal_ManageUsers_ButtonText" ng-href="{{::$ctrl.o365AdminUserPageUrl}}" target="_blank"></a></div>'),t.put("components/capacityAdminContainer/capacityAdminContainer.html",'<capacity-header></capacity-header><capacity-index ng-if="!$ctrl.isCapacitySelected()"></capacity-index><capacity-main ng-if="$ctrl.isCapacitySelected()"></capacity-main>'),t.put("components/capacityHeader/capacityHeader.html",'<a class="settings-title" ng-class="{\'navigation-disabled\': !$ctrl.isCapacitySelected()}" localize="CapacityAdmin_ManageCapacity" ng-click="$ctrl.navigateToCapacitySettings()"></a><span ng-if="!$ctrl.isCapacityNameEmpty()"><i class="glyphicon pbi-glyph-chevronrightmedium glyph-small"></i><label ng-bind="$ctrl.selectedCapacityDisplayName()"></label></span><div class="editSettings" ng-if="$ctrl.canEditSettings()" ng-click="$ctrl.showCapacitySettingsEditor()"><i class="glyphicon glyph-small pbi-glyph-settings"></i><span localize="SettingsViewer_Title"></span></div>'),t.put("components/capacityIndex/capacityIndex.html",'<div class="indexContainer" ng-if="!$ctrl.isRefreshing()"><div class="purchaseCapacity"><p class="purchaseCapacityDescription"><span ng-bind="$ctrl.getPurchaseCapacityDescription()"></span><a class="learnMore" ng-href="{{::$ctrl.getLearnMoreLink()}}" ng-bind="$ctrl.getPurchaseCapacityLearnMoreText()" target="_blank"></a></p><a class="buyCapacityBtn btn primary trimmedTextWithEllipsis slideFadeIn" ng-if="$ctrl.shouldDisplayPurchaseCapacity()" ng-href="{{::$ctrl.getBuyCapacityLink()}}" ng-click="$ctrl.onBuyCapacityLinkClicked()" target="_blank"><span class="text trimmedTextWithEllipsis" ng-bind="$ctrl.getPurchaseCapacityBtnText()"></span></a></div><hr><div class="tableContainer" ng-if="$ctrl.hasCapacities() || $ctrl.failedToLoadCapacities()"><span class="premiumCapacitiesTitle" localize="Capacity_PremiumCapacities"></span><div class="errorSection" ng-if="$ctrl.failedToLoadCapacities()"><i class="glyphicon glyph-small pbi-glyph-error"></i><span class="message" localize="Capacity_CantLoad_Description"></span></div><table class="capacityAdminTable"><thead><tr><th class="capacityName" localize="CapacityAdmin_CapacityName"></th><th class="status" localize="CapacityAdmin_Status"></th><th class="adminsList" localize="Capacity_Admins"></th><th class="actions" localize="StreamingDatasetModel_Actions"></th></tr></thead><tbody><tr ng-if="!$ctrl.failedToLoadCapacities()" ng-repeat="capacityMetadata in $ctrl.getDisplayedCapacityMetadata()" ng-click="$ctrl.onCapacitySelected(capacityMetadata)" ng-class="{disabled: !$ctrl.canSelectCapacity(capacityMetadata)}"><td class="capacityName"><div class="trimmedTextWithEllipsis" ng-bind="capacityMetadata.configuration.displayName" tooltip tooltip-config="$ctrl.getCapacityNameTooltipConfig(capacityMetadata.configuration.displayName)"></div></td><td class="status"><capacity-status capacity-metadata="capacityMetadata"/></td><td class="adminsList"><capacity-sorted-users-list max-number-of-characters="::$ctrl.adminsMaxNumberOfCharacters" search-text="$ctrl.searchText" user-list-separator="::$ctrl.adminsListSeparator" users="$ctrl.getCapacityAdmins(capacityMetadata)"></capacity-sorted-users-list></td><td class="actions"><capacity-actions capacity-state="capacityMetadata.state"></capacity-actions></td></tr></tbody></table><div class="failedToLoad" ng-if="$ctrl.failedToLoadCapacities()" localize="Capacity_CantLoad"></div></div></div><div class="adminPortalSpinner" ng-if="$ctrl.isRefreshing()"><spinner class="centered xlarge"></spinner><div class="spinnerInfo" localize="Loading_Text"></div></div>'),t.put("components/capacityMain/capacityMain.html",'<div ng-if="!$ctrl.shouldReloadCapacity()"><div class="mainSpinner" ng-if="!$ctrl.isCapacityLoaded()"><spinner class="centered xlarge"></spinner><div class="spinnerInfo" localize="Loading_Text"></div></div><div ng-if="$ctrl.isCapacityLoaded()"><div class="capacityMainContent" ng-if="$ctrl.isCapacityProvisioned()"><hr class="top" ng-if="$ctrl.hasWorkspaces()"/><div class="noWorkspaces" ng-if="!$ctrl.hasWorkspaces()"><div class="noWorkspacesImg"></div><div class="noWorkspacesTitle" localize="Capacity_No_WS_Title"></div><div class="noWorkspacesMessage" localize="Capacity_No_WS_Message"></div><pbi-button label="Capacity_Admins_Migrate_Workspaces" primary="true" ng-click="$ctrl.showMigrateWorkspaces()"></pbi-button></div><capacity-main-metrics ng-if="$ctrl.hasWorkspaces()"></capacity-main-metrics><hr/><span class="userPermissions" localize="Capacity_User_Permissions"></span><capacity-main-assign-admins capacity-object-id="$ctrl.getCapacityObjectId()" admins="$ctrl.getCapacityAdmins()"></capacity-main-assign-admins><capacity-main-assign-users capacity-object-id="$ctrl.getCapacityObjectId()" capacity-access="$ctrl.getCapacityAccess()"></capacity-main-assign-users><hr/><capacity-workspaces workspaces="$ctrl.getCapacityWorkspaces()"></capacity-workspaces></div><capacity-provisioning ng-if="!$ctrl.isCapacityProvisioned()"></capacity-provisioning></div></div><div class="reloadCapacityContainer" ng-if="$ctrl.shouldReloadCapacity()"><i class="glyphicon pbi-glyph-error glyph-large"></i><div class="label-xl reloadErrorTitle" localize="Capacity_Load_Error_Title"></div><div class="label-small reloadErrorSubtitle" localize="Capacity_Load_Error_Subtitle"></div><a class="technicalDetailsLink" localize="ErrorShowTechnicalDetails" href="" ng-click="$ctrl.showTechnicalDetails()"></a><pbi-button label="Capacity_Reload" primary="true" ng-click="$ctrl.reloadCapacity()"></pbi-button></div>'),t.put("components/capacityMainAssignAdmins/capacityMainAssignAdmins.html",'<ng-form name="$ctrl.settingForm"><capacity-main-expander display-title="$ctrl.getTitle()" status="$ctrl.getStatus()" has-changes="$ctrl.hasChanges()" show-apply-buttons="true" cancel-changes-action="$ctrl.cancelChanges()" apply-changes-action="$ctrl.applyChanges()" apply-changes-enabled="$ctrl.isApplyChangesEnabled()" cancel-changes-enabled="$ctrl.hasChanges()"><div class="required" localize="Capacity_RequiredField"></div><div class="applyTo" localize="TenantSetting_ApplyTo"></div><emails-list ng-class="{\'hasMails\': $ctrl.hasMails(), \'applyFailed\': $ctrl.applyChangesFailed}" view-model="$ctrl.emailListModel" allow-object-ids></emails-list><capacity-notification ng-if="!$ctrl.hasMails()" details="$ctrl.getNoAdminNotificationDetails()"></capacity-notification><capacity-notification ng-if="$ctrl.applyChangesFailed" details="$ctrl.getApplyErrorNotificationDetails()"></capacity-notification></capacity-main-expander></ng-form>'),t.put("components/capacityMainAssignUsers/capacityMainAssignUsers.html",'<ng-form name="$ctrl.settingForm"><capacity-main-expander display-title="$ctrl.getTitle()" status="$ctrl.getStatus()" has-changes="$ctrl.isAllowedForChanges()" show-apply-buttons="true" cancel-changes-action="$ctrl.cancelChanges()" apply-changes-action="$ctrl.applyChanges()" apply-changes-enabled="$ctrl.isAllowedForChanges()" cancel-changes-enabled="$ctrl.isAllowedForChanges()"><pbi-radio-group ng-model="$ctrl.granularityState" label="TenantSetting_ApplyTo"><pbi-radio label="TenantSetting_ApplyTo_EntireOrganization" ng-value="0"></pbi-radio><pbi-radio label="TenantSetting_ApplyTo_SpecificUsers" ng-value="1"></pbi-radio></pbi-radio-group><div class="emailListContainer" ng-if="$ctrl.isEnabledForSpecificUsers()"><span class="clearAll" localize="Clear_All" ng-click="$ctrl.clearAllMails()"></span><emails-list ng-class="{\'infoMessageNotDisplayed\': !($ctrl.shouldShowEntireOrganizationMessage() || $ctrl.shouldShowSpecificUsersMessage())}" view-model="$ctrl.emailListModel" allow-security-groups allow-object-ids allow-unified-groups></emails-list></div><capacity-notification ng-if="$ctrl.shouldShowEntireOrganizationMessage()" details="$ctrl.getEntireOrganizationNotificationDetails()"></capacity-notification><capacity-notification ng-if="$ctrl.shouldShowSpecificUsersMessage()" details="$ctrl.getSpecificUsersNotificationDetails()"></capacity-notification><capacity-notification ng-if="$ctrl.applyChangesFailed" details="$ctrl.getApplyErrorNotificationDetails()"></capacity-notification></capacity-main-expander></ng-form>'),t.put("components/capacityMainExpander/capacityMainExpander.html",'<header class="titlesContainer" ng-click="$ctrl.toggleDetailsView()"><i class="glyphicon detailsViewExpander" ng-class="{\'pbi-glyph-caretdownright\':$ctrl.shouldShowDetails, \'pbi-glyph-caretright\': !$ctrl.shouldShowDetails}"></i><div class="displayName" ng-bind="$ctrl.displayTitle"></div><div class="statusMessage" ng-class="{unappliedChanges: $ctrl.hasChanges}" ng-bind="$ctrl.status"></div></header><div class="details" ng-hide="!$ctrl.shouldShowDetails" ng-transclude></div><pbi-button class="applyChangesButton" label="PBI_Button_Label_Apply" primary="true" ng-click="$ctrl.onApply()" ng-disabled="!$ctrl.applyChangesEnabled" ng-if="$ctrl.showApplyButtons && $ctrl.shouldShowDetails"></pbi-button><pbi-button class="cancelChangesButton" label="PBI_Button_Label_Cancel" ng-click="$ctrl.onCancel()" ng-disabled="!$ctrl.cancelChangesEnabled" ng-if="$ctrl.showApplyButtons && $ctrl.shouldShowDetails"></pbi-button>'),t.put("components/capacityMainMetrics/capacityMainMetrics.html",'<span class="metricsDateRange" ng-bind="$ctrl.getMetricsDateRange()"></span><capacity-notification ng-if="!$ctrl.isMetricsDataLoaded()" details="$ctrl.getMetricErrorNotificationDetails()"></capacity-notification><div class="metricsContainer"><div class="metric" ng-repeat="metricViewModel in $ctrl.metricViewModels"><div class="checkmarkCircle"><i class="glyphicon pbi-glyph-checkmark glyph-normal"></i></div><span class="metricTitle" ng-bind="$ctrl.getTitle(metricViewModel)"></span><span class="metricSubTitle" ng-bind="$ctrl.getSubTitle(metricViewModel)"></span></div></div>'),t.put("components/capacityMigrateWorkspaces/capacityMigrateWorkspaces.html",'<div class="assignWorkspaces paneLayout"><header><h1 class="primaryHeading" localize="Capacity_Admins_Migrate_Workspaces"></h1></header><section class="contentContainer"><pbi-radio-group ng-model="$ctrl.granularityState" label="TenantSetting_ApplyTo" ng-change="$ctrl.onRadioGroupSelectionChanged()"><pbi-radio class="tenantRadioOption" ng-disabled="!$ctrl.isTenantAdmin()" label="CapacityAdmin_MigrateWorkspaces_EntireOrganization" ng-value="0"></pbi-radio><i class="glyphicon glyph-small pbi-glyph-info tenantRadioOptionInfoIcon" ng-if="!$ctrl.isTenantAdmin()" tooltip tooltip-config="::$ctrl.getTenantOptionTooltipConfig()"></i><pbi-radio label="CapacityAdmin_MigrateWorkspaces_SpecificUsers" ng-value="1"></pbi-radio></pbi-radio-group><emails-list view-model="$ctrl.emailListModel" ng-if="$ctrl.isEnabledForSpecificUsers()" allow-security-groups allow-object-ids allow-unified-groups on-tag-added="$ctrl.updateMigrationRequestPreviewForSpecificUsers()" on-tag-removed="$ctrl.updateMigrationRequestPreviewForSpecificUsers()"></emails-list><hr><div class="grantAccess infoMessageContainer"><i class="glyphicon glyph-small pbi-glyph-info infoMessageIcon"></i><div class="infoMessage" ng-switch="$ctrl.isEnabledForSpecificUsers()"><span ng-switch-when="true" localize="CapacityAdmin_MigrateWorkspaces_MigrateUsersWorkspaces"></span><span ng-switch-when="false" localize="CapacityAdmin_MigrateWorkspaces_MigrateOrganization"></span><a class="learnMore" ng-href="{{::$ctrl.getLearnMoreLink()}}" Localize="LearnMore" target="_blank"></a></div></div></section><footer><div class="migrationPreview infoMessageContainer" ng-show="$ctrl.isLoading()"><spinner class="loadingSpinner infoMessageIcon"></spinner><span class="infoMessage" localize="CapacityAdmin_MigrateWorkspaces_AssigningWorkspaces"></span></div><div class="migrationPreview infoMessageContainer" ng-if="!$ctrl.isLoading() && $ctrl.hasMigrationRequestPreview()"><i class="glyphicon glyph-small pbi-glyph-info infoMessageIcon"></i><span class="infoMessage" localize="CapacityAdmin_MigrateWorkspaces_MigrateAmount" localize-fragments><span fragment-index="0" ng-bind="$ctrl.getPreviewNumberOfUsers()"></span><span fragment-index="1" ng-bind="$ctrl.getPreviewNumberOfWorkspaces()"></span></span></div><div class="errorSection infoMessageContainer" ng-if="!$ctrl.isLoading() && $ctrl.isError()"><i class="glyphicon glyph-small pbi-glyph-error infoMessageIcon"></i><span class="infoMessage" localize="CapacityAdmin_MigrateWorkspaces_MigrationFailed"></span></div><div class="buttons"><pbi-button class="applyChangesButton" ng-disabled="!$ctrl.canApplyChanges()" label="PBI_Button_Label_Apply" primary="true" ng-click="$ctrl.applyChanges()"></pbi-button><pbi-button class="cancelChangesButton" label="PBI_Button_Label_Cancel" ng-click="$ctrl.cancelChanges()"></pbi-button></div></footer></div>'),t.put("components/capacityNotification/capacityNotification.html",'<div class="messageContainer" ng-class="::$ctrl.getMessageContainerClass()"><i class="glyphicon glyph-small" ng-class="::$ctrl.getIcon()" ng-if="$ctrl.hasIcon()"></i><div class="errorMessage"><span ng-bind="::$ctrl.getTitle()"></span><a ng-if="::$ctrl.showTechnicalDetailsLink()" localize="ErrorShowTechnicalDetails" ng-click="$ctrl.showTechnicalDetails()" href=""/><a ng-if="$ctrl.showLearnMore()" localize="LearnMore" target="_blank" href="{{::$ctrl.getLearnMoreLink()}}"/></div></div>'),t.put("components/capacityProvisioning/capacityProvisioning.html",'<div ng-if="!$ctrl.isProvisioning()"><div class="subtitle label-med trimmedTextWithEllipsis" localize="CapacityProvisioning_Start_Hint"></div><capacity-notification ng-if="$ctrl.hasProvisioningError()" details="$ctrl.getProvisioningErrorNotificationDetails()"></capacity-notification><div class="section"><h5 class="requiredFieldsHint header" localize="Capacity_RequiredField"></h5></div><div class="section"><label class="inputLabel" localize="CapacityAdmin_CapacityName" for="inputCapacityFriendlyName"></label> <input id="inputCapacityFriendlyName" type="text" class="capacityFriendlyNameInput" ng-model="$ctrl.capacityFriendlyName" ng-attr-placeholder="{{::$ctrl.friendlyNamePlaceholder}}"/></div><div class="section"><div class="inputLabel"><label class="requiredFields" localize="Capacity_Admins" for="emailsList"></label><i class="infoIcon pbi-glyph-info glyphicon glyph-small" tooltip tooltip-config="$ctrl.capacityAdminsTooltipConfig"></i><div><emails-list class="emailsList" view-model="$ctrl.capacityAdminsEmailsList" allow-object-ids on-tag-added="$ctrl.onCapacityAdminAdded()" on-tag-removed="$ctrl.onCapacityAdminRemoved()"></emails-list></div><capacity-notification ng-if="$ctrl.hasCapacityAdminListError()" details="$ctrl.getEmptyAdminListErrorNotificationDetails()"></capacity-notification><div class="capacityButtonContainer"><pbi-button id="applyChangesButton" label="CapacityProvisioning_SetupCapacity" primary="true" ng-disabled="$ctrl.isApplyChangesDisabled()" ng-click="$ctrl.instantiate()"></pbi-button><pbi-button id="cancelChangesButton" label="Cancel_ButtonText" ng-click="$ctrl.onCancel()"></pbi-button></div></div></div></div><div class="adminPortalSpinner" ng-if="$ctrl.isProvisioning()"><spinner class="centered xlarge"></spinner><div class="spinnerInfo" localize="CapacityProvisioning_SpinnerText"></div></div>'),
t.put("components/capacitySettingsEditor/capacitySettingsEditor.html",'<ng-form name="editCapacityForm"><div class="capacitySettingsEditor paneLayout"><header><h1 class="primaryHeading" localize="SettingsBlade_SettingsFor" localize-fragments><span fragment-index="0" ng-bind="::$ctrl.capacityMetadata.configuration.displayName"></span></h1></header><section class="contentContainer"><section class="displayBlock"><h4 class="capacityNameTitle" localize="CapacityAdmin_CapacityName"></h4> <input name="capacityName" required ng-model="$ctrl.capacityMetadata.configuration.displayName" type="text" spellcheck="false" autocomplete="off" maxlength="64" autofocus/></section><hr><section class="displayBlock"><h4 class="title" localize="CapacityAdmin_Settings_Sku"></h4><div class="textBody" ng-bind="::$ctrl.capacityMetadata.license.capacityPlan"></div></section><section class="displayBlock"><h4 class="title" localize="CapacityAdmin_Settings_Region"></h4><div class="textBody" ng-bind="::$ctrl.capacityMetadata.license.region"></div></section></section><footer><div class="loading" ng-show="$ctrl.isLoading()"><spinner class="loadingSpinner"></spinner><span class="message" localize="CapacityAdmin_Settings_Updating"></span></div><div class="errorSection" ng-if="$ctrl.isError()"><i class="glyphicon glyph-small pbi-glyph-error"></i><span class="message" localize="CapacityAdmin_Settings_UpdateFailed"></span></div><div class="buttons"><pbi-button class="applyChangesButton" ng-disabled="!editCapacityForm.$dirty || editCapacityForm.$invalid" label="PBI_Button_Label_Apply" primary="true" ng-click="$ctrl.applyChanges()"></pbi-button><pbi-button class="cancelChangesButton" label="PBI_Button_Label_Cancel" ng-click="$ctrl.closePane()"></pbi-button></div></footer></div></ng-form>'),t.put("components/capacitySortedUsersList/capacitySortedUsersList.html",'<span class="displayedUsers" ng-bind="$ctrl.getDisplayedUsers()"></span><span class="moreUsers" ng-if="$ctrl.haveMoreUsers()" localize="CapacityAdmin_MoreUsers" localize-fragments><span fragment-index="0" ng-bind="$ctrl.getHiddenUsersCount()"></span></span>'),t.put("components/capacityStatus/capacityStatus.html",'<div class="statusIcon" ng-switch="$ctrl.getIconType()"><spinner class="loadingSpinner" ng-switch-when="0"></spinner><i class="warningIcon pbi-glyph-warning glyphicon glyph-small" ng-switch-when="1"></i></div><span ng-bind="$ctrl.getDisplayUIStatus()" tooltip tooltip-config="$ctrl.getStatusTooltipConfig()"></span>'),t.put("components/capacityWorkspaces/capacityWorkspaces.html",'<div class="workspacesHeader"><h3 ng-bind="$ctrl.getTitle()"></h3><a class="assignWorkspacesContainer" ng-click="$ctrl.showMigrateWorkspaces()"><i class="assignButtonIcon glyphicon pbi-glyph-add"></i><span class="assignWorkspaces" localize="Capacity_Admins_Migrate_Workspaces"></span></a></div><div class="infoSection" ng-if="$ctrl.hasPendingMigrations()"><spinner class="loadingSpinner messageIcon"></spinner><span class="message" localize="CapacityAdmin_MigrateWorkspaces_AssigningWorkspaces"></span></div><div class="errorSection" ng-if="$ctrl.failedToLoadCapacityWorkspace()"><i class="glyphicon glyph-small pbi-glyph-error"></i><span class="message" localize="CapacityWorkspaces_LoadingFailed_Description"></span></div><div class="errorSection" ng-if="$ctrl.failedToMigrateCapacityWorkspace()"><i class="glyphicon glyph-small pbi-glyph-error"></i><span class="message" localize="CapacityWorkspaces_MigrationFailed" localize-fragments><span fragment-index="0" ng-bind="$ctrl.getFailedWorkspaceMigrationsCount()"></span></span></div><search-box class="capacityAdminSearchBox" on-change="$ctrl.onSearchTextChange()" filter="$ctrl.searchText" placeholder="SearchContent"></search-box><table class="capacityAdminTable headerRow"><colgroup><col class="workspaceName"><col class="status"><col class="adminsList"><col class="actions"></colgroup><thead><tr><th class="workspaceName" localize="CapacityWorkspaces_WorkspaceName"></th><th class="status" localize="CapacityAdmin_Status"></th><th class="adminsList" localize="CapacityWorkspaces_WorkspaceAdmins"></th><th class="actions" localize="StreamingDatasetModel_Actions"></th></tr></thead></table><div class="tableContent" ng-switch="$ctrl.getTableContentSwitch()"><div class="notification loadingWorkspaces" ng-switch-when="1" localize="CapacityWorkspaces_Loading"></div><div class="notification loadingWorkspacesFailed" ng-switch-when="2" localize="CapacityWorkspaces_LoadingFailed"></div><div class="notification emptySearchResult" ng-switch-when="3" localize="CapacityWorkspaces_EmptySearchResult"></div><a class="notification workspacesEmptyState" ng-switch-when="4" ng-click="$ctrl.showMigrateWorkspaces()" localize="Capacity_Admins_Migrate_Workspaces"></a><div class="adminTableRepeaterContainer" ng-switch-when="0"><table class="capacityAdminTable"><colgroup><col class="workspaceName"><col class="status"><col class="adminsList"><col class="actions"></colgroup><tbody vs-repeat vs-scroll-parent=".adminTableRepeaterContainer"><tr ng-repeat="workspace in $ctrl.getDisplayedWorkspaces()" ng-show="$ctrl.hasWorkspaces() && !$ctrl.failedToLoadCapacityWorkspace()" ng-class="{disabled: $ctrl.isWorkspaceDisabled(workspace)}"><td class="workspaceName"><i class="glyphicon pbi-glyph-group glyph-small groupIcon backgroundCircle"></i><span class="trimmedTextWithEllipsis" ng-bind="$ctrl.getWorkspaceDisplayName(workspace)"></span></td><td class="status"><capacity-workspace-status workspace-status="workspace.status"></capacity-workspace-status></td><td class="adminsList"><capacity-sorted-users-list max-number-of-characters="::$ctrl.adminsMaxNumberOfCharacters" search-text="$ctrl.searchText" user-list-separator="::$ctrl.adminsListSeparator" users="workspace.admins"></capacity-sorted-users-list></td><td class="actions"><div ng-if="!$ctrl.canMoveWorkspaceToSharedCapacity(workspace)" class="removeWorkspace close-btn glyphicon pbi-glyph-close glyph-small" tooltip tooltip-config="$ctrl.getRemoveWorkspaceTooltipConfig()" ng-click="$ctrl.removeWorkspace(workspace)"></div></td></tr></tbody></table></div></div>'),t.put("components/capacityWorkspaceStatus/capacityWorkspaceStatus.html",'<div class="statusIcon" ng-switch="$ctrl.getIconType()"><spinner class="loadingSpinner" ng-switch-when="1"></spinner><i class="errorIcon pbi-glyph-error glyphicon glyph-small" ng-switch-when="2"></i></div><span class="statusName" ng-bind="$ctrl.getDisplayUIStatus()"></span>')}]);var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){function e(t,i){return i=i.toLocaleLowerCase(),_.contains(t.toLocaleLowerCase(),i)}function a(t,i,e,a,o,r){var s=a.control(),p=n(t,i,o,r,e),l=[new c(o.get("PBI_Button_Label_Close"),function(t,i){s.hideDialog()})],d=o.get("CapacityAdmin_TechnicalDetails_Title");s.showCustomDialog(d,p,l,null,!0)}function n(t,i,e,a,n){var c={requestId:i},p=o.getErrorInfo(a,c),l=n.flushLogEntries(),d={errorInfoKey:e.get("AdditionalErrorInfo_CorrelationIdText"),errorInfoValue:l};p.splice(1,0,d);var y=e.get("AdditionalErrorInfo_ActivityIdText");s.isNullOrUndefinedOrWhiteSpaceString(t)||(p[y]=t);var u=$("<div/>"),g=e.get("CapacityAdmin_TechnicalDetails_Subtitle");u.append(g).append("<p/>");for(var m=0;m<p.length;m++)u.append(r.constructErrorField(p[m].errorInfoKey,p[m].errorInfoValue));var v=$('<a class="modalErrorHelpLink" target="_blank"/>').text("Contact support").attr("href",jsCommon.PowerBIDefaultHelpPage);return u.append(v),u}var o=t.common.ErrorOptionsHelper,r=InJs.InfoNavUtility,c=InJs.ModalDialogAction,s=jsCommon.StringExtensions;i.containsSubstring=e,i.showTechnicalDetailsDialog=a})(e=i.utils||(i.utils={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){t.NewCapacityId="new"})(i=t.constants||(t.constants={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){var i;!(function(t){t[t.Good=0]="Good",t[t.Warning=1]="Warning",t[t.Poor=2]="Poor"})(i=t.UtilizationStatus||(t.UtilizationStatus={}))})(i=t.components||(t.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(i){var e;!(function(t){t[t.Failure=0]="Failure",t[t.Information=1]="Information",t[t.Warning=2]="Warning"})(e=i.NotificationType||(i.NotificationType={}));var a;!(function(t){t[t.Short=0]="Short",t[t.Long=1]="Long"})(a=i.NotificationLength||(i.NotificationLength={}));var n;!(function(t){t[t.Small=0]="Small",t[t.Big=1]="Big"})(n=i.NotificationSize||(i.NotificationSize={}));var o=(function(){function i(t,i){this.services=i}return i.createOptions=function(){return{additionalServices:["customTraceLoggerService","errorService","localizationService","telemetryService"]}},i.prototype.$onInit=function(){},i.prototype.getIcon=function(){switch(this.details.type){case e.Warning:return"pbi-glyph-securityalert";case e.Information:return"pbi-glyph-info";case e.Failure:return"pbi-glyph-error"}},i.prototype.getTitle=function(){return this.details.title},i.prototype.getMessageContainerClass=function(){var t=e[this.details.type].toLowerCase()+" ";return this.details.length&&(t+=a[this.details.length].toLowerCase()+" "),this.details.textSize&&(t+=a[this.details.textSize].toLowerCase()+" "),t},i.prototype.showTechnicalDetailsLink=function(){return this.details.shouldShowTechnicalDetailsLink},i.prototype.showLearnMore=function(){return this.details.learnMoreLink&&0!==this.details.learnMoreLink.length},i.prototype.hasIcon=function(){return!!this.details.shouldShowIcon||this.details.shouldShowIcon},i.prototype.getLearnMoreLink=function(){return this.details.learnMoreLink},i.prototype.showTechnicalDetails=function(){t.utils.showTechnicalDetailsDialog(this.details.activityId,this.details.requestId,this.services.customTraceLoggerService,this.services.errorService,this.services.localizationService,this.services.telemetryService)},i})();i.CapacityNotificationController=o})(i=t.controllers||(t.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityNotification={templateUrl:"components/capacityNotification/capacityNotification.html",bindings:{details:"<"},controller:t.common.createController(i.controllers.CapacityNotificationController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){var e=jsCommon.StringExtensions,a=t.capacityAdmin.components.UtilizationStatus,n=7,o=(function(){function o(t,i){this.services=i}return o.createOptions=function(){return{additionalServices:["localizationService"]}},o.prototype.$onInit=function(){this.metricViewModels=t.capacityAdmin.mocks.getMockMetricsViewModels(),this.metricErrorNotificationDetails={type:i.NotificationType.Failure,length:i.NotificationLength.Long,title:this.services.localizationService.get("Capacity_Metrics_Error"),shouldShowTechnicalDetailsLink:!0}},o.prototype.getTitle=function(t){var i=this.services.localizationService.get("Capacity_Metrics_Title");return e.format(i,t.name,a[t.status])},o.prototype.getSubTitle=function(t){var i=this.services.localizationService.get("Capacity_Metrics_Utilization");return e.format(i,t.threshold.toString(),t.exceededThresholdCount.toString())},o.prototype.getMetricsDateRange=function(){var t=new Date,i=new Date;i.setDate(i.getDate()-n);var e=this.services.localizationService.get("Capacity_Metrics_Date_Range");return jsCommon.StringExtensions.format(e,n.toString(),i.toLocaleDateString()+"-"+t.toLocaleDateString())},o.prototype.getMetricErrorNotificationDetails=function(){return this.metricErrorNotificationDetails},o.prototype.isMetricsDataLoaded=function(){return!0},o})();i.CapacityMainMetricsController=o})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityMainMetrics={templateUrl:"components/capacityMainMetrics/capacityMainMetrics.html",bindings:{metricViewModels:"<"},controller:t.common.createController(i.controllers.CapacityMainMetricsController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){var i=(function(){function t(){}return t.prototype.toggleDetailsView=function(){this.shouldShowDetails=!this.shouldShowDetails},t.prototype.onApply=function(){this.applyChangesAction&&this.applyChangesAction()},t.prototype.onCancel=function(){this.cancelChangesAction&&this.cancelChangesAction()},t})();t.CapacityMainExpanderController=i})(i=t.controllers||(t.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityMainExpander={templateUrl:"components/capacityMainExpander/capacityMainExpander.html",transclude:!0,bindings:{displayTitle:"<",status:"<",hasChanges:"<",showApplyButtons:"<",applyChangesAction:"&",cancelChangesAction:"&",applyChangesEnabled:"<",cancelChangesEnabled:"<"},controller:t.common.createController(i.controllers.CapacityMainExpanderController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){this.services=i}return t.createOptions=function(){return{additionalServices:["selectedCapacityService"]}},t.prototype.isCapacitySelected=function(){return this.services.selectedCapacityService.hasSelectedCapacity()},t})();t.CapacityAdminContainerController=i})(i=t.controllers||(t.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityAdminContainer={templateUrl:"components/capacityAdminContainer/capacityAdminContainer.html",controller:t.common.createController(i.controllers.CapacityAdminContainerController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){var e=t.capacityAdmin.utils,a=(function(){function t(t,i){this.services=i}return t.createOptions=function(){return{additionalServices:["userInfo"]}},t.prototype.$onInit=function(){this.updateDisplayedUserList()},t.prototype.$onChanges=function(t){this.updateDisplayedUserList()},t.prototype.updateDisplayedUserList=function(){var t=this;this.displayedUsers=[],this.displayedUsersCharactersCount=0,this.users=this.users||[];var i=this.users.slice();if(this.searchText){var a=_.remove(i,(function(i){return e.containsSubstring(i.displayName,t.searchText)}));if(this.addUsersToDisplayList(a),this.displayedUsers.length<a.length)return}this.addUsersToDisplayList(i)},t.prototype.addUsersToDisplayList=function(t){t=_.sortBy(t,(function(t){return t.displayName}));for(var i=0,e=t;i<e.length;i++){var a=e[i],n=a.displayName,o=this.userListSeparator.length+n.length+this.displayedUsersCharactersCount;if(o>this.maxNumberOfCharacters)break;this.displayedUsers.push(n),this.displayedUsersCharactersCount=o}},t.prototype.getDisplayedUsers=function(){return this.displayedUsers.join(this.userListSeparator)},t.prototype.haveMoreUsers=function(){return this.getHiddenUsersCount()>0},t.prototype.getHiddenUsersCount=function(){return this.users.length-this.displayedUsers.length},t})();i.CapacitySortedUsersListController=a})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacitySortedUsersList={templateUrl:"components/capacitySortedUsersList/capacitySortedUsersList.html",bindings:{maxNumberOfCharacters:"<",searchText:"<",userListSeparator:"<",users:"<"},controller:t.common.createController(i.controllers.CapacitySortedUsersListController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){var a=t.common.ArrowPosition,n=t.capacityAdmin.constants,o=jsCommon.StringExtensions,r=t.common.models.TooltipTheme,c="https://go.microsoft.com/fwlink/?linkid=841521",s="https://go.microsoft.com/fwlink/?linkid=845625",p=(function(){function e(t,i){this.services=i,this.adminsMaxNumberOfCharacters=63,this.adminsListSeparator=", ",this.capacitiesMetadata=[]}return e.createOptions=function(){return{additionalServices:["capacityAdminHttpProxy","capacityAdminTelemetryService","capacityProvisioningService","localizationService","navigation","selectedCapacityService","userInfo"]}},e.prototype.getCapacityAdmins=function(t){return t.admins},e.prototype.hasCapacities=function(){return!_.isEmpty(this.capacitiesMetadata)},e.prototype.getBuyCapacityLink=function(){return c},e.prototype.getLearnMoreLink=function(){return s},e.prototype.shouldDisplayPurchaseCapacity=function(){return this.services.userInfo.userMetadata.isTenantAdmin},e.prototype.getPurchaseCapacityDescription=function(){return this.services.userInfo.userMetadata.isTenantAdmin&&this.hasCapacities()?this.services.localizationService.get("Capacity_PurchaseAdditionalDescription"):this.services.localizationService.get("Capacity_PurchaseDescription")},e.prototype.getPurchaseCapacityLearnMoreText=function(){return this.services.userInfo.userMetadata.isTenantAdmin&&this.hasCapacities()?this.services.localizationService.get("Capacity_PremiumCapacities"):this.services.localizationService.get("LearnMore")},e.prototype.getPurchaseCapacityBtnText=function(){return this.hasCapacities()?this.services.localizationService.get("Capacity_PurchaseMore"):this.services.localizationService.get("Capacity_Purchase")},e.prototype.getDisplayedCapacityMetadata=function(){var t=this.capacitiesMetadata.slice(),e=_.remove(t,(function(t){return t.state===i.contracts.CapacityState.NotActivated}));return e=this.sortCapacitiesByDisplayName(e),t=this.sortCapacitiesByDisplayName(t),e.concat(t)},e.prototype.getCapacityNameTooltipConfig=function(t){return{tooltipTitle:t,tooltipArrowPosition:a.arrowTopMiddle,tooltipTheme:r.Dark}},e.prototype.failedToLoadCapacities=function(){return this.failedToLoad},e.prototype.$onInit=function(){var t=this;this.initializeDataAsync(),this.provisioningStartedCallback=function(i){return t.onProvisioningStarted(i)},this.services.capacityProvisioningService.registerProvisioningStartedCallback(this.provisioningStartedCallback)},e.prototype.$onDestroy=function(){this.services.capacityProvisioningService.unregisterProvisioningStartedCallback(this.provisioningStartedCallback)},e.prototype.isRefreshing=function(){return this.isRefreshingData},e.prototype.canSelectCapacity=function(t){return t.state===i.contracts.CapacityState.Active||t.state===i.contracts.CapacityState.PreSuspended||t.state===i.contracts.CapacityState.NotActivated},e.prototype.onCapacitySelected=function(t){if(this.canSelectCapacity(t)){var i=t.capacityObjectId?t.capacityObjectId:n.NewCapacityId;this.services.selectedCapacityService.startLoad(t),this.services.navigation.navigateToAdminPortalCapacity(i)}},e.prototype.onBuyCapacityLinkClicked=function(){var t=this.services.userInfo.userMetadata.isTenantAdmin,i=this.capacitiesMetadata.length;this.services.capacityAdminTelemetryService.logBuyNowClicked(t,i)},e.prototype.onProvisioningStarted=function(t){var i=_.find(this.capacitiesMetadata,(function(i){return i.capacityObjectId===t.provisioningCapacityMetadata.capacityObjectId}));i.configuration.displayName=t.provisioningCapacityMetadata.configuration.displayName},e.prototype.initializeDataAsync=function(){return __awaiter(this,void 0,t.Promise,(function(){var t,i,e=this;return __generator(this,(function(a){switch(a.label){case 0:return this.isRefreshingData=!0,this.failedToLoad=!1,[4,this.services.capacityAdminHttpProxy.getAllCapacitiesMetadata(null).catch((function(){e.failedToLoad=!0}))];case 1:return t=a.sent(),this.isRefreshingData=!1,i=t.data,this.capacitiesMetadata=_.filter(i,(function(t){return!e.isCapacityDeleted(t)})),this.createDefaultCapacityNameIfNeeded(this.capacitiesMetadata),[2]}}))}))},e.prototype.isCapacityDeleted=function(t){return t.state===i.contracts.CapacityState.Deleted||t.state===i.contracts.CapacityState.Deleting},e.prototype.sortCapacitiesByDisplayName=function(t){return _.sortBy(t,(function(t){return t.configuration.displayName?t.configuration.displayName.toUpperCase():""}))},e.prototype.createDefaultCapacityNameIfNeeded=function(t){for(var e=1,a=0,n=t;a<n.length;a++){var r=n[a];if(r.state===i.contracts.CapacityState.NotActivated&&o.isNullOrUndefinedOrWhiteSpaceString(r.configuration.displayName)){var c=this.services.localizationService.get("Capacity_NewCapacityName");r.configuration.displayName=o.format(c,(e++).toString())}else if(r.state===i.contracts.CapacityState.Provisioning&&o.isNullOrUndefinedOrWhiteSpaceString(r.configuration.displayName)){var s=this.services.capacityProvisioningService.getSavedProvisionData(r.capacityObjectId);s&&(r.configuration.displayName=s.provisioningCapacityMetadata.configuration.displayName)}}return t},e})();e.CapacityIndexController=p})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityIndex={templateUrl:"components/capacityIndex/capacityIndex.html",controller:t.common.createController(i.controllers.CapacityIndexController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){var a,n=t.common.ArrowPosition,o=jsCommon.StringExtensions,r=jsCommon.EnumExtensions,c=t.common.models.TooltipTheme;!(function(t){t[t.Loading=0]="Loading",t[t.Warning=1]="Warning",t[t.None=2]="None"})(a=e.CapacityStateType||(e.CapacityStateType={}));var s=(function(){function t(t,i){this.services=i}return t.createOptions=function(){return{additionalServices:["localizationService"]}},t.prototype.getDisplayUIStatus=function(){return this.services.localizationService.get(o.format("CapacityAdmin_Status_{0}",r.toString(i.contracts.CapacityState,this.capacityMetadata.state)))},t.prototype.getIconType=function(){switch(this.capacityMetadata.state){case i.contracts.CapacityState.Provisioning:return a.Loading;case i.contracts.CapacityState.ProvisionFailed:case i.contracts.CapacityState.Suspended:case i.contracts.CapacityState.Invalid:case i.contracts.CapacityState.PreSuspended:return a.Warning}return a.None},t.prototype.getStatusTooltipConfig=function(){return{tooltipTitle:this.getStatusLocalizedDescription(),tooltipArrowPosition:n.arrowTopMiddle,tooltipTheme:c.Dark}},t.prototype.getStatusLocalizedDescription=function(){return this.services.localizationService.get(o.format("CapacityAdmin_Status_{0}_Description",r.toString(i.contracts.CapacityState,this.capacityMetadata.state)))},t})();e.CapacityStatusController=s})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityStatus={templateUrl:"components/capacityStatus/capacityStatus.html",bindings:{capacityMetadata:"<"},controller:t.common.createController(i.controllers.CapacityStatusController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){var a,n=t.common.ArrowPosition,o=t.common.models.CollapsiblePaneExpandedWidth,r=t.common.constants.TaskPaneCollapsiblePaneMode,c=t.common.models.TooltipTheme,s=t.capacityAdmin.utils;!(function(t){t[t.WorkspaceList=0]="WorkspaceList",t[t.Loading=1]="Loading",t[t.LoadingFailed=2]="LoadingFailed",t[t.NoSearchResult=3]="NoSearchResult",t[t.NoWorkspaces=4]="NoWorkspaces"})(a=e.TableContentSwitch||(e.TableContentSwitch={}));var p=(function(){function t(t,i){this.services=i,this.adminsMaxNumberOfCharacters=63,this.adminsListSeparator=", "}return t.createOptions=function(){return{additionalServices:["capacityAdminHttpProxy","capacityAdminTelemetryService","localizationService","selectedCapacityService","taskPaneSliderService"]}},t.prototype.getTableContentSwitch=function(){return this.isLoading()?a.Loading:this.failedToLoadCapacityWorkspace()?a.LoadingFailed:this.hasWorkspaces()?this.hasSearchResult()?a.WorkspaceList:a.NoSearchResult:a.NoWorkspaces},t.prototype.getDisplayedWorkspaces=function(){return this.workspacesFiltered},t.prototype.$onInit=function(){this.services.selectedCapacityService.refreshWorkspaces(),this.workspacesFiltered=this.workspaces||[]},t.prototype.$onChanges=function(t){this.filterWorkspaces()},t.prototype.hasPendingMigrations=function(){return this.services.selectedCapacityService.selectedCapacity.pendingMigrationsCount>0},t.prototype.showMigrateWorkspaces=function(){this.services.taskPaneSliderService.expandPane(r.CapacityWorkspacesEditor,o.Large)},t.prototype.removeWorkspace=function(t){var i=this,e={tenantObjectId:window.tenantId,workspaceObjectIds:[t.metadata.workspaceObjectId],userObjectIds:null,groupObjectIds:null,migrateEntireTenant:!1,targetCapacityObjectId:null,sourceCapacityObjectId:t.metadata.capacityObjectId};this.services.capacityAdminTelemetryService.logMigratingWorkspaces(e),this.services.capacityAdminHttpProxy.migrateToCapacity(e,null).then((function(e){i.workspaces=_.remove(i.workspaces,(function(i){return t.metadata.workspaceObjectId!==i.metadata.workspaceObjectId})),i.filterWorkspaces()}),(function(t){i.services.selectedCapacityService.refresh(),i.services.selectedCapacityService.refreshWorkspaces()}))},t.prototype.onSearchTextChange=function(){this.filterWorkspaces()},t.prototype.getTitle=function(){var t=this.services.localizationService.get("Capacity_Workspaces"),i=this.services.selectedCapacityService.selectedCapacity.assignedWorkspacesCount||0;return jsCommon.StringExtensions.format(t,i.toString())},t.prototype.getWorkspaceDisplayName=function(t){return t.metadata.workspaceDisplayName||this.services.localizationService.get("NavigationPane_Groups_MyWorkspace")},t.prototype.canMoveWorkspaceToSharedCapacity=function(t){return this.isWorkspaceMigrationFailed(t)},t.prototype.isWorkspaceDisabled=function(t){return!1},t.prototype.getRemoveWorkspaceTooltipConfig=function(t){return{tooltipTitle:this.services.localizationService.get("CapacityWorkspaces_RemoveWorkspace"),tooltipArrowPosition:n.arrowTopMiddle,tooltipTheme:c.Dark}},t.prototype.failedToLoadCapacityWorkspace=function(){return!this.isLoading()&&!this.services.selectedCapacityService.wasSelectedCapacityWorkspacesLastRefreshSuccesful()},t.prototype.failedToMigrateCapacityWorkspace=function(){var t=this;return!this.isLoading()&&!this.failedToLoadCapacityWorkspace()&&_.some(this.workspaces,(function(i){return t.isWorkspaceMigrationFailed(i)}))},t.prototype.getFailedWorkspaceMigrationsCount=function(){var t=this,i=_.filter(this.workspaces,(function(i){return t.isWorkspaceMigrationFailed(i)}));return i.length},t.prototype.isWorkspaceMigrationFailed=function(t){return t.status===i.contracts.CapacityWorkspaceStatus.MigrationFailed},t.prototype.isLoading=function(){return this.services.selectedCapacityService.isSelectedCapacityWorkspacesRefreshing()},t.prototype.hasWorkspaces=function(){return!_.isEmpty(this.workspaces)},t.prototype.hasSearchResult=function(){return!_.isEmpty(this.workspacesFiltered)},t.prototype.containsSearchText=function(t){var i=this;return!!s.containsSubstring(this.getWorkspaceDisplayName(t),this.searchText)||_.some(t.admins,(function(t){return s.containsSubstring(t.displayName,i.searchText)}))},t.prototype.filterWorkspaces=function(){var t=this,i=this.workspaces||[];this.searchText&&(i=_.filter(i,(function(i){return t.containsSearchText(i)}))),this.workspacesFiltered=_.sortBy(i,(function(i){return t.getWorkspaceDisplayName(i).toUpperCase()}))},t})();e.CapacityWorkspacesController=p})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityWorkspaces={templateUrl:"components/capacityWorkspaces/capacityWorkspaces.html",bindings:{workspaces:"<"},controller:t.common.createController(i.controllers.CapacityWorkspacesController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){var i;!(function(t){t[t.Azure=0]="Azure",t[t.Office365=1]="Office365"})(i=t.CapacityLicenseSource||(t.CapacityLicenseSource={}));var e;!(function(t){t[t.NotActivated=0]="NotActivated",t[t.Active=1]="Active",t[t.Provisioning=2]="Provisioning",t[t.ProvisionFailed=3]="ProvisionFailed",t[t.PreSuspended=4]="PreSuspended",t[t.Suspended=5]="Suspended",t[t.Deleting=6]="Deleting",t[t.Deleted=7]="Deleted",t[t.Invalid=8]="Invalid"})(e=t.CapacityState||(t.CapacityState={}));var a;!(function(t){t[t.Migrated=0]="Migrated",t[t.MigrationPending=1]="MigrationPending",t[t.MigrationFailed=2]="MigrationFailed"})(a=t.CapacityWorkspaceStatus||(t.CapacityWorkspaceStatus={}))})(i=t.contracts||(t.contracts={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){function e(t){return new a(t)}i.createCapacityAdminHttpProxy=e;var a=(function(){function i(t){this.userInfo=t}return i.prototype.getAllCapacitiesMetadata=function(i){var e=t.common.httpService.powerbiRequestOptions(i,"getAllCapacitiesMetadata",{isAdminRequest:this.isAdminRequest()});e.enableTelemetry=!1;var a="/capacities/list";return t.common.httpService.get(a,e)},i.prototype.provisionCapacity=function(i,e){var a=t.common.httpService.powerbiRequestOptions(e,"instantiateCapacity",{isAdminRequest:this.isAdminRequest()});a.enableTelemetry=!0;var n="/capacities/new";return t.common.httpService.post(n,JSON.stringify(i),a)},i.prototype.getCapacity=function(i,e){var a=t.common.httpService.powerbiRequestOptions(e,"getCapacity",{isAdminRequest:this.isAdminRequest()});a.enableTelemetry=!0;var n="/capacities/"+i;return t.common.httpService.get(n,a)},i.prototype.updateCapacity=function(i,e,a){var n=t.common.httpService.powerbiRequestOptions(a,"updateCapacity",{isAdminRequest:this.isAdminRequest()});n.enableTelemetry=!0;var o="/capacities/"+i;return t.common.httpService.put(o,JSON.stringify(e),n)},i.prototype.updateCapacityAccess=function(i,e,a){var n=t.common.httpService.powerbiRequestOptions(a,"updateCapacityAccess",{isAdminRequest:this.isAdminRequest()});n.enableTelemetry=!0;var o="/capacities/"+i+"/access";return t.common.httpService.put(o,JSON.stringify(e),n)},i.prototype.updateCapacityAdmins=function(i,e,a){var n=t.common.httpService.powerbiRequestOptions(a,"updateCapacityAdmins",{isAdminRequest:this.isAdminRequest()});n.enableTelemetry=!0;var o="/capacities/"+i+"/admins";return t.common.httpService.put(o,JSON.stringify(e),n)},i.prototype.removeCapacityAccess=function(i,e,a){var n=t.common.httpService.powerbiRequestOptions(a,"removeCapacityAccess",{isAdminRequest:this.isAdminRequest()});n.enableTelemetry=!0;var o="/capacities/"+i+"/access/";return t.common.httpService.delete(o,n)},i.prototype.getCapacityWorkspaces=function(i,e){var a=t.common.httpService.powerbiRequestOptions(e,"getCapacityWorkspaces",{isAdminRequest:this.isAdminRequest()});a.enableTelemetry=!0;var n="/capacities/"+i+"/workspaces";return t.common.httpService.get(n,a)},i.prototype.removeWorkspaceFromCapacity=function(i,e,a){var n=t.common.httpService.powerbiRequestOptions(a,"removeWorkspaceFromCapacity",{isAdminRequest:this.isAdminRequest()});n.enableTelemetry=!0;var o="/capacities/"+i+"/workspaces/"+e;return t.common.httpService.delete(o,n)},i.prototype.getUserWorkspaces=function(i,e){var a=t.common.httpService.powerbiRequestOptions(e,"getUserWorkspaces",{isAdminRequest:this.isAdminRequest()});a.enableTelemetry=!0;var n="/capacities/users/"+i+"/workspaces";
return t.common.httpService.get(n,a)},i.prototype.migrateToCapacity=function(i,e){var a=t.common.httpService.powerbiRequestOptions(e,"migrateToCapacity",{isAdminRequest:this.isAdminRequest()});a.enableTelemetry=!0;var n="/capacities/migrationrequest";return t.common.httpService.post(n,JSON.stringify(i),a)},i.prototype.isAdminRequest=function(){return this.userInfo.userMetadata.isTenantAdmin},i})()})(e=i.proxies||(i.proxies={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){function e(t,i){return new c(t,i)}function a(){return[{name:"QPU",threshold:0,status:r.Good,exceededThresholdCount:0},{name:"Memory thrashing",threshold:0,status:r.Good,exceededThresholdCount:0},{name:"Direct Query",threshold:0,status:r.Good,exceededThresholdCount:0}]}var n=t.capacityAdmin.contracts.CapacityLicenseSource,o=t.capacityAdmin.contracts.CapacityState,r=t.capacityAdmin.components.UtilizationStatus;i.createCapacityAdminHttpProxyMock=e;var c=(function(){function i(t,i){this.promiseFactory=t,this.$timeout=i,this.requestTimeoutInMs=0,this.provisioningTimeoutInMs=0,this.instantiatedCapacityId="e1f0aca7976342f48e677514627be53e"}return i.prototype.getAllCapacitiesMetadata=function(){var t=this,i=this.promiseFactory.defer();return this.$timeout((function(){i.resolve(t.createCapacityMetadataMockResponse())}),this.requestTimeoutInMs,!1),i.promise},i.prototype.provisionCapacity=function(t,i){var e=this,a=this.promiseFactory.defer();return this.$timeout((function(){a.resolve(e.createProvisoningResponse())}),this.provisioningTimeoutInMs,!1),a.promise},i.prototype.getCapacity=function(t,i){var e=this,a=this.promiseFactory.defer();return this.$timeout((function(){a.resolve(e.createCapacityMockHttpResult(t))}),this.requestTimeoutInMs,!1),a.promise},i.prototype.updateCapacity=function(t,i,e){return this.createMockHttpResponse()},i.prototype.updateCapacityAccess=function(t,i,e){return this.createMockHttpResponse()},i.prototype.updateCapacityAdmins=function(t,i,e){return this.createMockHttpResponse()},i.prototype.removeCapacityAccess=function(t,i,e){return this.createMockHttpResponse()},i.prototype.getCapacityWorkspaces=function(t,i){return this.createCapacityWorkspacesMockResponse()},i.prototype.removeWorkspaceFromCapacity=function(t,i,e){return this.createMockHttpResponse()},i.prototype.getUserWorkspaces=function(t,i){return this.createMockHttpResponse()},i.prototype.migrateToCapacity=function(t,i){return this.createMockHttpResponse()},i.prototype.getCapacityMigrationRequestPreview=function(t,i){return this.createCapacityMigrationRequestPreviewMockHttpResult(t)},i.prototype.createCapacityMigrationRequestPreviewMockHttpResult=function(i){var e=this.promiseFactory.defer(),a=i.migrateEntireTenant?1e3:0,n=i.migrateEntireTenant?1e5:0;i.migrateEntireTenant||(_.isEmpty(i.userObjectIds)||(a=i.userObjectIds.length,n=3*i.userObjectIds.length),_.isEmpty(i.groupObjectIds)||(a+=5*i.groupObjectIds.length,n+=15*i.groupObjectIds.length));var o={data:{numberOfUsers:a,numberOfWorkspaces:n},status:t.HttpStatusCode.OK,headers:null,activityId:"",requestId:""};return e.resolve(o),e.promise},i.prototype.createCapacityMockHttpResult=function(i){var e={data:{metadata:{capacityObjectId:i,state:o.Active,license:this.createCapacityLicenseMock(n.Azure),configuration:this.createConfigurationMock("Capacity A"),admins:this.createADUserMetaDataListMock(["1","2"])},access:this.createAccessMock("user1","group1"),assignedWorkspaces:[],admins:this.createADUserMetaDataListMock(["1","2"]),assignedWorkspacesCount:4,pendingMigrationsCount:4},status:t.HttpStatusCode.OK,headers:null,activityId:"",requestId:""};return e},i.prototype.createProvisoningResponse=function(){var i={data:this.createCapacityMetadataMock(this.instantiatedCapacityId,"CapacityA",o.Active),status:t.HttpStatusCode.OK,headers:null,activityId:"",requestId:""};return i},i.prototype.createCapacityWorkspacesMockResponse=function(){for(var i=this.promiseFactory.defer(),e=[],a=0;a<1e5;a++)e.push(this.createCapacityWorkspacesMock("Workspace"+a.toString(),a.toString(),"1",["shir shimoni"],a%3));var n={data:e,status:t.HttpStatusCode.OK,headers:null,activityId:"",requestId:""};return i.resolve(n),i.promise},i.prototype.createMockHttpResponse=function(i,e){var a=this.promiseFactory.defer(),n={data:i,status:void 0===e?t.HttpStatusCode.OK:e,headers:null,activityId:"",requestId:""};return a.resolve(n),a.promise},i.prototype.createCapacityMetadataMockResponse=function(){var i={data:[this.createCapacityMetadataMock(void 0,"",o.NotActivated,[]),this.createCapacityMetadataMock(void 0,"",o.NotActivated,[]),this.createCapacityMetadataMock("1","Capacity Active",o.Active,["shirshim","ashem"]),this.createCapacityMetadataMock("2","Capacity provisioning",o.Provisioning,["galiab"]),this.createCapacityMetadataMock("3","Capacity provisioninf failed",o.ProvisionFailed,["Tim Levin","Ben Wallace","Benjamin Bruetbard Kelmer","Shir Shimoni","Maya Brondvain Abramov","Pazit Benjamin"]),this.createCapacityMetadataMock("4","Capacity F name is realy long long long long long long long name",o.Active,["tim"]),this.createCapacityMetadataMock("5","Capacity pre suspended",o.PreSuspended,["tim"]),this.createCapacityMetadataMock("6","Capacity suspended",o.Suspended,["tim"]),this.createCapacityMetadataMock("7","Capacity invalid",o.Invalid,["shirshim"]),this.createCapacityMetadataMock("8","Capacity deleted",o.Deleted,["shirshim"]),this.createCapacityMetadataMock("9","Capacity deleting",o.Deleting,["shirshim"]),this.createCapacityMetadataMock("10","Capacity deleting",o.Deleting,["shirshim"])],status:t.HttpStatusCode.OK,headers:null,activityId:"",requestId:""};return i},i.prototype.createCapacityMetadataMock=function(t,i,e,a){var o={capacityObjectId:t,state:e,license:{source:n.Azure,capacityPlan:"",o365AddonId:"",region:"Europe"},configuration:{displayName:i},admins:this.createADUserMetaDataListMock(a)};return o},i.prototype.createCapacityWorkspacesMock=function(t,i,e,a,n){var o={metadata:{capacityObjectId:e,workspaceDisplayName:t,workspaceObjectId:i},admins:this.createADUserMetaDataListMock(a),status:n};return o},i.prototype.createAccessMock=function(t,i){var e={users:[this.createADUserMetaDataMock(t)],groups:[this.createADUserMetaDataMock(i)],isAllowedForEntireTenant:!1};return e},i.prototype.createCapacityLicenseMock=function(t){var i={source:t,capacityPlan:"S1",o365AddonId:"",region:"Europe"};return i},i.prototype.createConfigurationMock=function(t){var i={displayName:t};return i},i.prototype.createADUserMetaDataListMock=function(t){var i=this;return t=t||[],t.map((function(t){return i.createADUserMetaDataMock(t)}))},i.prototype.createADUserMetaDataMock=function(t){return{displayName:t,isSecurityGroup:!1,objectId:"object_id_"+t,objectType:1,userPrincipalName:"upn_"+t}},i})();i.getMockMetricsViewModels=a})(e=i.mocks||(i.mocks={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){function a(t,i,e,a){return new c(t,i,e,a)}var n=t.capacityAdmin.contracts.CapacityState,o=t.common.constants,r=i.constants;e.createSelectedCapacityService=a;var c=(function(){function i(t,i,e,a){this.$rootScope=t,this.navigation=i,this.capacityAdminHttpProxy=e,this.promiseFactory=a,this.capacitiesInRefresh=[],this.capacitiesWorkspacesInRefresh=[],this.lastCapacitiesFailedToRefreshErrorData=[],this.lastCapacityWorkspacesFailedToRefreshErrorData=[],this.clear(),this.registerRouteStateChangeEvent();var n=this.navigation.currentCapacityId;this.initializeCapacity(n)}return Object.defineProperty(i.prototype,"selectedCapacity",{get:function(){return this.capacity},enumerable:!0,configurable:!0}),i.prototype.hasSelectedCapacity=function(){return!!this.capacity.metadata.capacityObjectId&&!!this.navigation.currentCapacityId},i.prototype.startLoad=function(i){return __awaiter(this,void 0,t.Promise,(function(){var t,e;return __generator(this,(function(a){switch(a.label){case 0:if(t=i.capacityObjectId===r.NewCapacityId)return[2,this.promiseFactory.reject()];this.isCapacityLoaded=!1,this.capacity=this.createCapacity(i),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.refresh()];case 2:return a.sent(),this.capacity.metadata.capacityObjectId===i.capacityObjectId&&(this.isCapacityLoaded=!0),[3,4];case 3:return e=a.sent(),[3,4];case 4:return[2]}}))}))},i.prototype.refresh=function(){return __awaiter(this,void 0,t.Promise,(function(){var t,i,e,a,n=this;return __generator(this,(function(o){switch(o.label){case 0:return t=this.capacity.metadata.capacityObjectId,i=t===r.NewCapacityId,!t||i?[3,2]:(this.capacitiesInRefresh.push(t),[4,this.capacityAdminHttpProxy.getCapacity(t,null).catch((function(i){var e=i,a={capacityId:t,activityId:e.activityId,requestId:e.requestId};n.lastCapacitiesFailedToRefreshErrorData.push(a),_.remove(n.capacitiesInRefresh,(function(i){return i===t}))}))]);case 1:e=o.sent(),a=e.data,t===a.metadata.capacityObjectId&&(a.assignedWorkspaces=this.capacity.assignedWorkspaces,this.capacity=a,_.remove(this.capacitiesInRefresh,(function(i){return i===t})),_.remove(this.lastCapacitiesFailedToRefreshErrorData,(function(i){return i.capacityId===t}))),o.label=2;case 2:return[2]}}))}))},i.prototype.refreshWorkspaces=function(){var t=this,i=this.capacity.metadata.capacityObjectId;i&&i!==r.NewCapacityId&&(_.include(this.capacitiesWorkspacesInRefresh,i)||this.capacitiesWorkspacesInRefresh.push(i),this.capacityAdminHttpProxy.getCapacityWorkspaces(i,null).then((function(e){i===t.capacity.metadata.capacityObjectId&&(t.capacity.assignedWorkspaces=e.data,t.capacity.assignedWorkspacesCount=e.data.length,_.remove(t.capacitiesWorkspacesInRefresh,(function(t){return t===i})),_.remove(t.lastCapacityWorkspacesFailedToRefreshErrorData,(function(t){return t.capacityId===i})))}),(function(e){var a={capacityId:i,activityId:e.activityId,requestId:e.requestId};_.remove(t.capacitiesWorkspacesInRefresh,(function(t){return t===i})),t.lastCapacityWorkspacesFailedToRefreshErrorData.push(a)})))},i.prototype.isSelectedCapacityRefreshing=function(){return _.include(this.capacitiesInRefresh,this.selectedCapacity.metadata.capacityObjectId)},i.prototype.isSelectedCapacityWorkspacesRefreshing=function(){return _.include(this.capacitiesWorkspacesInRefresh,this.selectedCapacity.metadata.capacityObjectId)},i.prototype.isSelectedCapacityProvisioned=function(){var t=this.selectedCapacity.metadata;return t.capacityObjectId!==r.NewCapacityId&&t.state!==n.ProvisionFailed&&t.state!==n.Provisioning},i.prototype.wasSelectedCapacityLastRefreshSuccesful=function(){var t=this;return!_.some(this.lastCapacitiesFailedToRefreshErrorData,(function(i){return i.capacityId===t.selectedCapacity.metadata.capacityObjectId}))},i.prototype.wasSelectedCapacityWorkspacesLastRefreshSuccesful=function(){var t=this;return!_.some(this.lastCapacityWorkspacesFailedToRefreshErrorData,(function(i){return i.capacityId===t.selectedCapacity.metadata.capacityObjectId}))},i.prototype.getSelectedCapacityRefreshErrorData=function(){var t=this;return _.find(this.lastCapacitiesFailedToRefreshErrorData,(function(i){return i.capacityId===t.selectedCapacity.metadata.capacityObjectId}))},i.prototype.isSelectedCapacityLoaded=function(){var t=this.selectedCapacity.metadata.capacityObjectId===r.NewCapacityId;return!!t||this.isCapacityLoaded},i.prototype.clear=function(){this.isCapacityLoaded=!1;var t=this.createCapacityMetadata(null);this.capacity=this.createCapacity(t)},i.prototype.registerRouteStateChangeEvent=function(){var t=this;this.$rootScope.$on(o.navigation.stateChangeStart,(function(i,e,a,n,r){var c=a.capacityId,s=e.name===o.navigation.states.adminPortalCapacity,p=e.name===o.navigation.states.adminPortalCapacities;return p?void t.clear():void(s&&t.initializeCapacity(c))}))},i.prototype.initializeCapacity=function(t){if(t)if(this.capacity.metadata.capacityObjectId===t)this.refresh();else if(t===r.NewCapacityId)this.selectedCapacity.metadata.capacityObjectId=t;else{var i=this.createCapacityMetadata(t);this.startLoad(i)}},i.prototype.createCapacityMetadata=function(t){var i={capacityObjectId:t,name:void 0,state:void 0,admins:void 0,configuration:void 0,license:void 0,status:void 0};return i},i.prototype.createCapacity=function(t){var i={metadata:t,access:void 0,assignedWorkspaces:[],assignedWorkspacesCount:0,pendingMigrationsCount:0};return i},i})()})(e=i.services||(i.services={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){function a(t,i,e,a,n,o,c){return new r(t,i,e,a,n,o,c)}var n=t.capacityAdmin.contracts.CapacityState,o=i.constants;e.createCapacityProvisioningService=a;var r=(function(){function i(t,i,e,a,n,o,r){this.capacityAdminHttpProxy=t,this.navigation=i,this.localizationService=e,this.$timeout=a,this.selectedCapacityService=n,this.notificationToast=o,this.promiseFactory=r,this.maxPollingAttempts=36,this.retryTimeoutInMs=5e3,this.capacityProvisioningMap={},this.registeredCallbacks=[]}return i.prototype.hasProvisionError=function(t){if(t===o.NewCapacityId)return!1;var i=this.capacityProvisioningMap[t];return!!i&&!i.isProvisionSuccessful},i.prototype.isProvisioning=function(t){var i=this.capacityProvisioningMap[t];return!!i&&i.isProvisioningCapacity},i.prototype.getSavedProvisionData=function(t){return this.capacityProvisioningMap[t]},i.prototype.registerProvisioningStartedCallback=function(t){this.registeredCallbacks.push(t)},i.prototype.unregisterProvisioningStartedCallback=function(t){_.pull(this.registeredCallbacks,t)},i.prototype.provision=function(i,e){return __awaiter(this,void 0,t.Promise,(function(){var t,a,n,o=this;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.capacityAdminHttpProxy.provisionCapacity(i,null).catch((function(t){var i=t,e=o.createCapacityProvisionData(void 0);return e.errorActivityId=i.activityId,e.errorRequestId=i.requestId,o.promiseFactory.reject(e)}))];case 1:return t=r.sent(),a=t.data,n=this.createCapacityProvisionData(a),this.capacityProvisioningMap[a.capacityObjectId]=n,this.onCapacityProvisioningStarted(n),this.$timeout((function(){o.checkCapacityInstantiationState(a,i,e,o.maxPollingAttempts)}),this.retryTimeoutInMs),[2,n]}}))}))},i.prototype.onCapacityProvisioningStarted=function(t){for(var i=0,e=this.registeredCallbacks;i<e.length;i++){var a=e[i];a(t)}},i.prototype.checkCapacityInstantiationState=function(i,e,a,o){return __awaiter(this,void 0,t.Promise,(function(){var t,r,c,s=this;return __generator(this,(function(p){switch(p.label){case 0:return t=i.capacityObjectId,[4,this.capacityAdminHttpProxy.getCapacity(t,null).catch((function(n){var o=n,r=s.getSavedProvisionData(i.capacityObjectId);r.errorActivityId=o.activityId,r.errorRequestId=o.requestId,s.onProvisioningFailure(t,e,a,c.metadata)}))];case 1:return r=p.sent(),(c=r.data)?(c.metadata.state===n.Active?this.onProvisioningSuccess(t,e,a,c.metadata):c.metadata.state===n.Provisioning&&o>0?this.$timeout((function(){s.checkCapacityInstantiationState(i,e,a,o--)}),this.retryTimeoutInMs):this.onProvisioningFailure(t,e,a,c.metadata),[2]):(this.onProvisioningFailure(t,e,a,c.metadata),[2])}}))}))},i.prototype.onProvisioningFailure=function(i,e,a,n){this.capacityProvisioningMap[i].isProvisionSuccessful=!1,this.capacityProvisioningMap[i].isProvisioningCapacity=!1;var r=t.common.localize.format("CapacityProvisioning_FailureTitle",[e.displayName]),c=t.common.localize.get("CapacityProvisioning_FailureBody");i!==o.NewCapacityId&&this.notifyInstantiationStatus(r,c,i,t.common.NotificationToastType.Error)},i.prototype.onProvisioningSuccess=function(i,e,a,n){var r=t.common.localize.format("CapacityProvisioning_SuccessTitle",[e.displayName]),c=t.common.localize.get("CapacityProvisioning_SuccessBody"),s=this.selectedCapacityService.selectedCapacity.metadata.capacityObjectId;!this.selectedCapacityService.hasSelectedCapacity()||s!==i&&s!==o.NewCapacityId?this.notifyInstantiationStatus(r,c,i,t.common.NotificationToastType.Success,n):(this.selectedCapacityService.startLoad(n),this.navigation.navigateToAdminPortalCapacity(i)),this.capacityProvisioningMap[i].isProvisionSuccessful=!0,this.capacityProvisioningMap[i].isProvisioningCapacity=!1},i.prototype.notifyInstantiationStatus=function(t,i,e,a,n){var o=this,r={displayText:this.localizationService.get("Capacity_GoToCapacity_Text"),action:function(){n&&o.selectedCapacityService.startLoad(n),o.navigation.navigateToAdminPortalCapacity(e)}};this.notificationToast.notify({title:t,message:i,notificationType:a,actionButtons:[r]})},i.prototype.createCapacityProvisionData=function(t){var i={provisioningCapacityMetadata:t,isProvisioningCapacity:!0,isProvisionSuccessful:!1,errorActivityId:void 0,errorRequestId:void 0};return i},i})()})(e=i.services||(i.services={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){function e(t){return new n(t)}var a=t.common.contracts.ADUserMetaDataObjectType;i.createCapacityAccessUpdateService=e;var n=(function(){function t(t){this.capacityAdminHttpProxy=t}return t.prototype.allowAccessToEntireTenant=function(t){var i=this.createEntireOrganizationCapacityAccessRequest();return this.capacityAdminHttpProxy.updateCapacityAccess(t,i,null)},t.prototype.allowAccessToSpecificUsers=function(t,i){var e=this.createUsersCapacityAccessRequest(i);return this.capacityAdminHttpProxy.updateCapacityAccess(t,e,null)},t.prototype.createUsersCapacityAccessRequest=function(t){var i={userObjectIds:[],groupObjectIds:[],allowForEntireTenant:!1},e=_.filter(t,(function(t){return t.objectType===a.User})),n=_.filter(t,(function(t){return t.objectType===a.Group}));return i.userObjectIds=_.map(e,(function(t){return t.objectId})),i.groupObjectIds=_.map(n,(function(t){return t.objectId})),i},t.prototype.createEntireOrganizationCapacityAccessRequest=function(){return{userObjectIds:[],groupObjectIds:[],allowForEntireTenant:!0}},t})()})(e=i.services||(i.services={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){function e(t,i){return new a(t,i)}i.createCapacityAdminTelemetryService=e;var a=(function(){function i(t,i){this.telemetryService=t,this.selectedCapacityService=i}return i.prototype.logCapacityProvisioning=function(i){var e=this.getCapacityTelemetryData();this.telemetryService.logEvent(t.telemetry.CapacityAdminProvisioningCapacity,e.capacityId,i.adminsUpns?i.adminsUpns.length:0,e.capacityPlan)},i.prototype.logCapacityModifyingAdmins=function(i){var e=this.getCapacityTelemetryData();this.telemetryService.logEvent(t.telemetry.CapacityAdminModifyingAdmins,e.capacityId,i?i.length:0,e.usersCount,e.workspaceCount,e.capacityPlan,e.isTenantCapacity)},i.prototype.logCapacityModifyingAccess=function(i,e,a){var n=this.getCapacityTelemetryData(),o=this.getModifiedAccessCountInfo(i,e),r=i?i.length:0,c=e?e.length:0,s=r+c;this.telemetryService.logEvent(t.telemetry.CapacityAdminModifyingAccess,n.capacityId,n.adminCount,s,n.workspaceCount,n.capacityPlan,n.isTenantCapacity,o.usersAddedCount,o.usersRemovedCount,o.groupsAddedCount,o.groupsRemovedCount,a)},i.prototype.logMigratingWorkspaces=function(i){var e=this.getCapacityTelemetryData();this.telemetryService.logEvent(t.telemetry.CapacityAdminMigratingWorkspaces,i.targetCapacityObjectId,i.sourceCapacityObjectId,e.adminCount,i.workspaceObjectIds?i.workspaceObjectIds.length:0,i.userObjectIds?i.userObjectIds.length:0,e.capacityPlan,i.migrateEntireTenant,e.isTenantCapacity)},i.prototype.logBuyNowClicked=function(i,e){this.telemetryService.logEvent(t.telemetry.CapacityAdminBuyNowClicked,e,i)},i.prototype.getCapacityTelemetryData=function(){var t=this.selectedCapacityService.selectedCapacity;return{capacityId:t.metadata.capacityObjectId,adminCount:t.metadata.admins?t.metadata.admins.length:0,usersCount:t.access&&t.access.users?t.access.users.length:0,workspaceCount:t.assignedWorkspacesCount,capacityPlan:t.metadata.license?t.metadata.license.capacityPlan:void 0,isTenantCapacity:t.access?t.access.isAllowedForEntireTenant:void 0}},i.prototype.getModifiedAccessCountInfo=function(t,i){var e=[],a=[];this.selectedCapacityService.selectedCapacity.access&&(e=_.map(this.selectedCapacityService.selectedCapacity.access.groups,(function(t){return t.objectId})),a=_.map(this.selectedCapacityService.selectedCapacity.access.users,(function(t){return t.objectId})));var n=_.map(i,(function(t){return t.objectId})),o=_.map(t,(function(t){return t.objectId})),r=_.difference(n,e),c=_.difference(e,n),s=_.difference(o,a),p=_.difference(a,o);return{usersAddedCount:s.length,usersRemovedCount:p.length,groupsAddedCount:r.length,groupsRemovedCount:c.length}},i})()})(e=i.services||(i.services={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){var e=t.common.ArrowPosition,a=t.common.contracts.ADUserMetaDataObjectType,n=t.common.models.EmailsListModel,o=t.common.models.TooltipTheme,r=(function(){function r(t,i){this.services=i}return r.createOptions=function(){return{additionalServices:["telemetryService","localizationService","capacityAdminHttpProxy","capacityAdminTelemetryService","userInfo","navigation","selectedCapacityService","capacityProvisioningService","$timeout"]}},r.prototype.$onInit=function(){var t=this.services.selectedCapacityService.selectedCapacity.metadata;return t?(this.capacityAdminsTooltipConfig=this.createCapacityAdminsTooltipConfig(),this.resetUserInput(),this.restoreProvisionDataIfExists(),this.capacityMetadata=t,this.friendlyNamePlaceholder=t.configuration.displayName,this.provisioningErrorNotificationDetails={type:i.NotificationType.Failure,title:this.services.localizationService.get("CapacityProvisioning_ProvisioningError"),shouldShowTechnicalDetailsLink:!0},void(this.emptyAdminListErrorNotificationDetails={type:i.NotificationType.Failure,title:this.services.localizationService.get("CapacityProvisioning_EmptyAdminsListError"),shouldShowTechnicalDetailsLink:!1})):void this.services.navigation.navigateToAdminPortal(5)},r.prototype.instantiate=function(){return __awaiter(this,void 0,t.Promise,(function(){var t,i,e=this;return __generator(this,(function(a){switch(a.label){case 0:return this.isProvisioningRequestPending=!0,this.hasInstantiationError=!1,t=this.createProvisionCapacityRequest(),this.services.capacityAdminTelemetryService.logCapacityProvisioning(t),[4,this.services.capacityProvisioningService.provision(t,this.capacityAdminsEmailsList.inputUserList).catch((function(t){return e.hasInstantiationError=!0,t}))];case 1:return i=a.sent(),i&&i.provisioningCapacityMetadata?this.currentProvisioningCapacityId=i.provisioningCapacityMetadata.capacityObjectId:(this.provisioningErrorNotificationDetails.activityId=i.errorActivityId,this.provisioningErrorNotificationDetails.requestId=i.errorRequestId),this.isProvisioningRequestPending=!1,[2]}}))}))},r.prototype.hasProvisioningError=function(){var t=this.getProvisioningCapacityId(),i=t&&this.services.capacityProvisioningService.hasProvisionError(t);return(i||this.hasInstantiationError)&&!this.isProvisioning()},r.prototype.isProvisioning=function(){var t=this.getProvisioningCapacityId(),i=this.services.capacityProvisioningService.isProvisioning(t);return(i||this.isProvisioningRequestPending)&&!this.hasProvisioningError()},r.prototype.hasCapacityAdminListError=function(){return this.isAdminListEmpty},r.prototype.isApplyChangesDisabled=function(){return _.isEmpty(this.capacityAdminsEmailsList.inputUserList)||this.capacityAdminsEmailsList.hasValidationError},r.prototype.isResetInputDisabled=function(){return 1===this.capacityAdminsEmailsList.inputUserList.length&&_.isEmpty(this.capacityFriendlyName)&&!this.capacityAdminsEmailsList.isDirty},r.prototype.resetUserInput=function(){this.capacityFriendlyName="",this.capacityAdminsEmailsList=new n,this.addCurrentUserAsCapacityAdmin(),this.onCapacityAdminAdded()},r.prototype.onCancel=function(){this.services.navigation.navigateToAdminPortal(5)},r.prototype.onCapacityAdminRemoved=function(){var t=_.isEmpty(this.capacityAdminsEmailsList.inputUserList);t&&(this.isAdminListEmpty=!0)},r.prototype.onCapacityAdminAdded=function(){var t=_.isEmpty(this.capacityAdminsEmailsList.inputUserList);!t&&this.hasCapacityAdminListError()&&(this.isAdminListEmpty=!1)},r.prototype.getProvisioningErrorNotificationDetails=function(){return this.provisioningErrorNotificationDetails},r.prototype.getEmptyAdminListErrorNotificationDetails=function(){return this.emptyAdminListErrorNotificationDetails},r.prototype.getProvisioningCapacityId=function(){var t=this.services.selectedCapacityService.selectedCapacity.metadata.capacityObjectId;return this.currentProvisioningCapacityId?this.currentProvisioningCapacityId:t},r.prototype.createProvisionCapacityRequest=function(){var t=this.capacityAdminsEmailsList.inputUserList,i=_.map(t,(function(t){return t.userPrincipalName}));_.isEmpty(this.capacityFriendlyName)||(this.capacityMetadata.configuration.displayName=this.capacityFriendlyName);var e={o365AddonId:this.capacityMetadata.license.o365AddonId,displayName:this.capacityMetadata.configuration.displayName,adminsUpns:i};return e},r.prototype.addCurrentUserAsCapacityAdmin=function(){var t=this.services.userInfo,i={displayName:this.services.localizationService.format("Capacity_User_DisplayName",[t.givenName,t.surname]),objectId:t.uoid,userPrincipalName:t.name,isSecurityGroup:!1,objectType:a.User,groupType:null};this.capacityAdminsEmailsList.inputUserList.push(i)},r.prototype.restoreProvisionDataIfExists=function(){var t=this.services.selectedCapacityService.selectedCapacity.metadata.capacityObjectId,i=this.services.capacityProvisioningService.getSavedProvisionData(t);i&&(this.capacityFriendlyName=i.provisioningCapacityMetadata.configuration.displayName,this.capacityAdminsEmailsList.inputUserList.concat(i.provisioningCapacityMetadata.admins))},r.prototype.createCapacityAdminsTooltipConfig=function(){var t={tooltipLocalizeDescription:"Capacity_AdminListTooltip",tooltipArrowPosition:e.arrowTopLeft,tooltipTheme:o.Dark};return t},r})();i.CapacityProvisioningController=r})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityProvisioning={templateUrl:"components/capacityProvisioning/capacityProvisioning.html",bindings:{capacityMetadata:"<"},controller:t.common.createController(i.controllers.CapacityProvisioningController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){var a=t.common.models.CollapsiblePaneExpandedWidth,n=t.capacityAdmin.constants,o=t.common.constants.TaskPaneCollapsiblePaneMode,r=(function(){function t(t,i){this.services=i}return t.createOptions=function(){return{additionalServices:["capacityAdminHttpProxy","customTraceLoggerService","errorService","localizationService","selectedCapacityService","taskPaneSliderService","telemetryService","navigation"]}},t.prototype.$onInit=function(){var t=this.services.selectedCapacityService.selectedCapacity.metadata;void 0===t.license&&t.capacityObjectId===n.NewCapacityId&&this.services.navigation.navigateToAdminPortal(5)},t.prototype.getCapacityObjectId=function(){return this.services.selectedCapacityService.selectedCapacity.metadata.capacityObjectId},t.prototype.getCapacityWorkspaces=function(){return this.services.selectedCapacityService.selectedCapacity.assignedWorkspaces},t.prototype.getCapacityAdmins=function(){return this.services.selectedCapacityService.selectedCapacity.metadata.admins},t.prototype.getCapacityAccess=function(){return this.services.selectedCapacityService.selectedCapacity.access},t.prototype.showMigrateWorkspaces=function(){this.services.taskPaneSliderService.expandPane(o.CapacityWorkspacesEditor,a.Large)},t.prototype.isCapacityProvisioned=function(){return this.services.selectedCapacityService.isSelectedCapacityProvisioned()},t.prototype.isCapacityLoaded=function(){return this.services.selectedCapacityService.isSelectedCapacityLoaded()},t.prototype.hasWorkspaces=function(){return!!this.services.selectedCapacityService.selectedCapacity.assignedWorkspacesCount},t.prototype.reloadCapacity=function(){this.services.selectedCapacityService.refresh()},t.prototype.shouldReloadCapacity=function(){var t=this.services.selectedCapacityService.wasSelectedCapacityLastRefreshSuccesful(),i=this.services.selectedCapacityService.isSelectedCapacityRefreshing();return!t&&!i},t.prototype.showTechnicalDetails=function(){var t=this.services.selectedCapacityService.getSelectedCapacityRefreshErrorData();i.utils.showTechnicalDetailsDialog(t.activityId,t.requestId,this.services.customTraceLoggerService,this.services.errorService,this.services.localizationService,this.services.telemetryService)},t})();e.CapacityMainController=r})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityMain={templateUrl:"components/capacityMain/capacityMain.html",controller:t.common.createController(i.controllers.CapacityMainController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){var e=t.common.models.EmailsListModel,a=(function(){function t(t,i){this.$scope=t,this.services=i}return t.createOptions=function(){return{additionalServices:["localizationService","capacityAdminHttpProxy","capacityAdminTelemetryService","errorService","navigation","userInfo","promiseFactory","$timeout"]}},t.prototype.$onInit=function(){this.noAdminNotificationDetails={type:i.NotificationType.Failure,length:i.NotificationLength.Short,title:this.services.localizationService.get("CapacityProvisioning_EmptyAdminsListError"),shouldShowTechnicalDetailsLink:!1},this.applyErrorNotificationDetails={type:i.NotificationType.Failure,length:i.NotificationLength.Short,title:this.services.localizationService.get("Capacity_Apply_Error"),shouldShowTechnicalDetailsLink:!0}},t.prototype.$onChanges=function(t){this.resetEmailList()},t.prototype.getStatus=function(){return this.settingForm.$dirty?this.services.localizationService.get("TenantSettingStatus_UnappliedChanges"):""},t.prototype.getTitle=function(){return this.services.localizationService.get("Capacity_Admins")},t.prototype.hasChanges=function(){return this.settingForm.$dirty},t.prototype.isApplyChangesEnabled=function(){return this.hasChanges()&&this.hasMails()},t.prototype.cancelChanges=function(){this.settingForm.$setPristine(),this.resetEmailList()},t.prototype.applyChanges=function(){var t=_.map(this.emailListModel.inputUserList,(function(t){return t.objectId})),i=!this.services.userInfo.userMetadata.isTenantAdmin&&!_.include(t,this.services.userInfo.uoid);return i?void this.showAdminRemoveDialog():(this.services.capacityAdminTelemetryService.logCapacityModifyingAdmins(this.admins),void this.apply())},t.prototype.hasMails=function(){return!_.isEmpty(this.emailListModel.inputUserList)},t.prototype.getNoAdminNotificationDetails=function(){return this.noAdminNotificationDetails},t.prototype.getApplyErrorNotificationDetails=function(){return this.applyErrorNotificationDetails},t.prototype.apply=function(){var t=this;this.settingForm.$setPristine();var i=_.map(this.emailListModel.inputUserList,(function(t){return t.userPrincipalName}));this.applyChangesFailed=!1,this.services.capacityAdminHttpProxy.updateCapacityAdmins(this.capacityObjectId,i,null).then((function(){t.admins=t.emailListModel.inputUserList.slice()}),(function(i){t.resetEmailList(),t.applyChangesFailed=!0,t.applyErrorNotificationDetails.activityId=i.activityId,t.applyErrorNotificationDetails.requestId=i.requestId}))},t.prototype.resetEmailList=function(){this.emailListModel=new e,(t=this.emailListModel.inputUserList).push.apply(t,this.admins),this.applyChangesFailed=!1;var t},t.prototype.showAdminRemoveDialog=function(){
var t=this,i=this.services.errorService.control(),e=this.services.localizationService.get("ModalDialogButtonText_Remove"),a=this.services.localizationService.get("ModalDialogButtonText_Cancel"),n=[new InJs.ModalDialogAction(e,function(e,a){i.hideDialog(),t.apply(),t.services.navigation.navigateToAdminPortal(5)}),new InJs.ModalDialogAction(a,function(e,a){i.hideDialog(),t.services.$timeout((function(){i.hideDialog(),t.resetEmailList()}))})],o=this.services.localizationService.get("CapacityAdmin_Remove_Prompt_Title"),r=this.services.localizationService.get("CapacityAdmin_Remove_Prompt_Description");i.showCustomDialog(o,$("<div/>").text(r),n,(function(t){t.parent().find('input[value="'+a+'"]').focus()}),!0)},t})();i.CapacityMainAssignAdminsController=a})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityMainAssignAdmins={templateUrl:"components/capacityMainAssignAdmins/capacityMainAssignAdmins.html",bindings:{capacityObjectId:"<",admins:"<"},controller:t.common.createController(i.controllers.CapacityMainAssignAdminsController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){var e,a=t.common.contracts.ADUserMetaDataObjectType,n=t.common.models.EmailsListModel,o="https://go.microsoft.com/fwlink/?linkid=845629",r="https://go.microsoft.com/fwlink/?linkid=845630";!(function(t){t[t.EnabledForEntireOrganization=0]="EnabledForEntireOrganization",t[t.EnabledForSpecificUsers=1]="EnabledForSpecificUsers"})(e=i.SettingGranularityState||(i.SettingGranularityState={}));var c=(function(){function t(t,i){this.services=i}return t.createOptions=function(){return{additionalServices:["localizationService","capacityAdminTelemetryService","capacityAccessUpdateService","selectedCapacityService"]}},t.prototype.$onInit=function(){this.applyErrorNotificationDetails={type:i.NotificationType.Failure,title:this.services.localizationService.get("Capacity_Apply_Error"),shouldShowTechnicalDetailsLink:!0},this.entireOrganizationNotificationDetails={type:i.NotificationType.Information,title:this.services.localizationService.get("Capacity_Assignment_Entire_Organization"),shouldShowTechnicalDetailsLink:!1,learnMoreLink:o},this.specificUsersNotificationDetails={type:i.NotificationType.Warning,title:this.services.localizationService.get("Capacity_Users_Assignment_Information"),shouldShowTechnicalDetailsLink:!1,learnMoreLink:r}},t.prototype.$onChanges=function(t){this.resetForm()},t.prototype.isEnabledForSpecificUsers=function(){return this.granularityState===e.EnabledForSpecificUsers},t.prototype.getStatus=function(){return this.settingForm.$dirty?this.services.localizationService.get("TenantSettingStatus_UnappliedChanges"):this.isEnabledForEntireOrganization()?this.services.localizationService.get("TenantSettingStatus_EnabledForEntireOrganization"):_.isEmpty(this.emailListModel.inputUserList)?this.services.localizationService.get("TenantSettingStatus_Disabled"):this.services.localizationService.get("TenantSettingStatus_EnabledForSpecificSecurityGroups")},t.prototype.getTitle=function(){return this.services.localizationService.get("Capacity_Users_Assignment")},t.prototype.isAllowedForChanges=function(){return this.settingForm.$dirty},t.prototype.cancelChanges=function(){this.settingForm.$setPristine(),this.resetForm()},t.prototype.applyChanges=function(){var t=this;this.settingForm.$setPristine(),this.logCapacityAccessModifiedEvent();var i=this.isEnabledForEntireOrganization()?this.services.capacityAccessUpdateService.allowAccessToEntireTenant(this.capacityObjectId):this.services.capacityAccessUpdateService.allowAccessToSpecificUsers(this.capacityObjectId,this.emailListModel.inputUserList);this.applyChangesFailed=!1,i.then((function(){t.updateCurrentState()}),(function(i){t.resetForm(),t.applyChangesFailed=!0,t.applyErrorNotificationDetails.activityId=i.activityId,t.applyErrorNotificationDetails.requestId=i.requestId}))},t.prototype.shouldShowEntireOrganizationMessage=function(){return this.settingForm.$dirty&&this.isEnabledForEntireOrganization()&&this.getCurrentGranularityState()===e.EnabledForSpecificUsers},t.prototype.shouldShowSpecificUsersMessage=function(){return this.settingForm.$dirty&&!this.isEnabledForEntireOrganization()&&this.getCurrentGranularityState()===e.EnabledForEntireOrganization},t.prototype.clearAllMails=function(){_.isEmpty(this.emailListModel.inputUserList)||(this.settingForm.$setDirty(),this.emailListModel=new n)},t.prototype.getCurrentGranularityState=function(){return this.capacityAccess.isAllowedForEntireTenant?e.EnabledForEntireOrganization:e.EnabledForSpecificUsers},t.prototype.getApplyErrorNotificationDetails=function(){return this.applyErrorNotificationDetails},t.prototype.getEntireOrganizationNotificationDetails=function(){return this.entireOrganizationNotificationDetails},t.prototype.getSpecificUsersNotificationDetails=function(){return this.specificUsersNotificationDetails},t.prototype.updateCurrentState=function(){return this.isEnabledForEntireOrganization()?(this.capacityAccess={users:[],groups:[],isAllowedForEntireTenant:!0},void(this.emailListModel=new n)):void(this.capacityAccess={users:_.filter(this.emailListModel.inputUserList,(function(t){return t.objectType===a.User})),groups:_.filter(this.emailListModel.inputUserList,(function(t){return t.objectType===a.Group})),isAllowedForEntireTenant:!1})},t.prototype.resetForm=function(){if(this.capacityAccess||(this.capacityAccess={users:[],groups:[],isAllowedForEntireTenant:!1}),this.emailListModel=new n,this.granularityState=this.capacityAccess.isAllowedForEntireTenant?e.EnabledForEntireOrganization:e.EnabledForSpecificUsers,this.applyChangesFailed=!1,!this.isEnabledForEntireOrganization()){(t=this.emailListModel.inputUserList).push.apply(t,this.capacityAccess.users),(i=this.emailListModel.inputUserList).push.apply(i,this.capacityAccess.groups);var t,i}},t.prototype.isEnabledForEntireOrganization=function(){return this.granularityState===e.EnabledForEntireOrganization},t.prototype.logCapacityAccessModifiedEvent=function(){this.services.capacityAdminTelemetryService.logCapacityModifyingAccess(this.capacityAccess.users,this.capacityAccess.groups,this.isEnabledForEntireOrganization())},t})();i.CapacityMainAssignUsersController=c})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityMainAssignUsers={templateUrl:"components/capacityMainAssignUsers/capacityMainAssignUsers.html",bindings:{capacityObjectId:"<",capacityAccess:"<"},controller:t.common.createController(i.controllers.CapacityMainAssignUsersController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){var e=t.common.models.CollapsiblePaneExpandedWidth,a=t.common.constants.TaskPaneCollapsiblePaneMode,n=(function(){function t(t,i){this.services=i}return t.createOptions=function(){return{additionalServices:["capacityProvisioningService","selectedCapacityService","navigation","taskPaneSliderService"]}},t.prototype.navigateToCapacitySettings=function(){this.isCapacitySelected()&&this.services.navigation.navigateToAdminPortal(5)},t.prototype.selectedCapacityDisplayName=function(){if(this.isCapacitySelected()){var t=this.services.selectedCapacityService.selectedCapacity.metadata.configuration,i=t?t.displayName:void 0;return i?i:this.tryToRetrieveNameFromProvisioningData()}},t.prototype.isCapacitySelected=function(){return this.services.selectedCapacityService.hasSelectedCapacity()},t.prototype.canEditSettings=function(){return this.isCapacitySelected()&&this.services.selectedCapacityService.isSelectedCapacityProvisioned()&&this.services.selectedCapacityService.isSelectedCapacityLoaded()},t.prototype.showCapacitySettingsEditor=function(){this.services.taskPaneSliderService.expandPane(a.CapacitySettingsEditor,e.Large)},t.prototype.isCapacityNameEmpty=function(){return!this.selectedCapacityDisplayName()},t.prototype.tryToRetrieveNameFromProvisioningData=function(){var t=this.services.selectedCapacityService.selectedCapacity.metadata.capacityObjectId,i=this.services.capacityProvisioningService.getSavedProvisionData(t);if(i)return i.provisioningCapacityMetadata.configuration.displayName},t})();i.CapacityHeaderController=n})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityHeader={templateUrl:"components/capacityHeader/capacityHeader.html",controller:t.common.createController(i.controllers.CapacityHeaderController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(i){var e=t.common.contracts.ADUserMetaDataObjectType,a=t.common.ArrowPosition,n=t.common.models.EmailsListModel,o=t.common.models.TooltipTheme,r="https://go.microsoft.com/fwlink/?linkid=845626",c="https://go.microsoft.com/fwlink/?linkid=845628",s=(function(){function t(t,i){this.services=i}return t.createOptions=function(){return{additionalServices:["capacityAdminHttpProxy","capacityAccessUpdateService","capacityAdminTelemetryService","localizationService","taskPaneSliderService","promiseFactory","userInfo","selectedCapacityService"]}},t.prototype.$onInit=function(){this.emailListModel=new n,this.errorOccurred=!1,this.granularityState=this.isTenantAdmin()?i.SettingGranularityState.EnabledForEntireOrganization:i.SettingGranularityState.EnabledForSpecificUsers,this.onRadioGroupSelectionChanged()},t.prototype.onRadioGroupSelectionChanged=function(){this.loading=!1,this.isEnabledForEntireOrganization()?this.onEnabledForEntireOrganization():this.onEnabledForSpecificUsers()},t.prototype.updateMigrationRequestPreviewForSpecificUsers=function(){this.resultPromise&&this.resultPromise.reject(),_.isEmpty(this.emailListModel.inputUserList)?this.resetMigrationRequestPreview(this.migrationRequestPreviewForSpecificUser):this.activeMigrationRequest=this.createMigrationRequestForSpesificUsers()},t.prototype.isEnabledForSpecificUsers=function(){return this.granularityState===i.SettingGranularityState.EnabledForSpecificUsers},t.prototype.isTenantAdmin=function(){return this.services.userInfo.userMetadata.isTenantAdmin},t.prototype.getPreviewNumberOfUsers=function(){return this.getCurrentMigrationRequestPreview().numberOfUsers},t.prototype.getPreviewNumberOfWorkspaces=function(){return this.getCurrentMigrationRequestPreview().numberOfWorkspaces},t.prototype.hasMigrationRequestPreview=function(){return this.isMigrationRequestPreviewInitialized(this.getCurrentMigrationRequestPreview())},t.prototype.getTenantOptionTooltipConfig=function(){return{tooltipTitle:this.services.localizationService.get("CapacityAdmin_MigrateWorkspaces_TenantAdminOption"),tooltipArrowPosition:a.arrowTopMiddle,tooltipTheme:o.Dark}},t.prototype.canApplyChanges=function(){return this.isEnabledForEntireOrganization()||!_.isEmpty(this.emailListModel.inputUserList)},t.prototype.applyChanges=function(){this.errorOccurred=!1,this.loading=!0,this.activeMigrationRequest.migrateEntireTenant?this.migrateEntireOrganizationWorkspaces():this.migrateSpecificUsersWorkspaces()},t.prototype.cancelChanges=function(){this.closePane()},t.prototype.getLearnMoreLink=function(){return this.isEnabledForEntireOrganization()?r:c},t.prototype.isLoading=function(){return this.loading},t.prototype.isError=function(){return this.errorOccurred},t.prototype.getCapacityAccess=function(){return this.services.selectedCapacityService.selectedCapacity.access},t.prototype.getCapacityObjectId=function(){return this.services.selectedCapacityService.selectedCapacity.metadata.capacityObjectId},t.prototype.migrateEntireOrganizationWorkspaces=function(){var t=this;this.services.capacityAccessUpdateService.allowAccessToEntireTenant(this.getCapacityObjectId()).then((function(i){t.migrateWorkspacesToCapacity()}),(function(i){t.errorOccurred=!0,t.loading=!1}))},t.prototype.migrateSpecificUsersWorkspaces=function(){var t=this;!this.getCapacityAccess()||this.getCapacityAccess().isAllowedForEntireTenant?this.migrateWorkspacesToCapacity():this.services.capacityAccessUpdateService.allowAccessToSpecificUsers(this.getCapacityObjectId(),this.getMergedInputListWithAccessList()).then((function(i){t.migrateWorkspacesToCapacity()}),(function(i){t.errorOccurred=!0,t.loading=!1}))},t.prototype.migrateWorkspacesToCapacity=function(){var t=this;this.services.capacityAdminTelemetryService.logMigratingWorkspaces(this.activeMigrationRequest),this.services.capacityAdminHttpProxy.migrateToCapacity(this.activeMigrationRequest,null).then((function(i){t.services.selectedCapacityService.refresh(),t.services.selectedCapacityService.refreshWorkspaces(),t.closePane()}),(function(i){t.errorOccurred=!0,t.services.selectedCapacityService.refresh()})).finally((function(){t.loading=!1}))},t.prototype.getMergedInputListWithAccessList=function(){var t=_.cloneDeep(this.emailListModel.inputUserList),i=this.getCapacityAccess();return t.push.apply(t,i.users),t.push.apply(t,i.groups),_.uniq(t,(function(t){return t.objectId}))},t.prototype.isEnabledForEntireOrganization=function(){return this.granularityState===i.SettingGranularityState.EnabledForEntireOrganization},t.prototype.onEnabledForEntireOrganization=function(){this.hasMigrationRequestPreview()||(this.activeMigrationRequest=this.createMigrationRequestForEntireOrganization())},t.prototype.onEnabledForSpecificUsers=function(){this.hasMigrationRequestPreview()||this.updateMigrationRequestPreviewForSpecificUsers()},t.prototype.getCurrentMigrationRequestPreview=function(){return this.isEnabledForEntireOrganization()?this.migrationRequestPreviewForEntireOrgznization:this.migrationRequestPreviewForSpecificUser},t.prototype.isMigrationRequestPreviewInitialized=function(t){return t&&(t.numberOfUsers>0||t.numberOfWorkspaces>0)},t.prototype.resetMigrationRequestPreview=function(t){t&&(t.numberOfUsers=0,t.numberOfWorkspaces=0)},t.prototype.createMigrationRequestForSpesificUsers=function(){var t=_.filter(this.emailListModel.inputUserList,(function(t){return t.objectType===e.User})),i=_.filter(this.emailListModel.inputUserList,(function(t){return t.objectType===e.Group})),a=_.map(t,(function(t){return t.objectId})),n=_.map(i,(function(t){return t.objectId}));return this.createCapacityMigrationRequest(!1,a,n)},t.prototype.createMigrationRequestForEntireOrganization=function(){return this.createCapacityMigrationRequest(!0)},t.prototype.createCapacityMigrationRequest=function(t,i,e){return{tenantObjectId:window.tenantId,workspaceObjectIds:null,userObjectIds:i,groupObjectIds:e,migrateEntireTenant:t,targetCapacityObjectId:this.getCapacityObjectId(),sourceCapacityObjectId:null}},t.prototype.closePane=function(){this.services.taskPaneSliderService.collapsePane()},t})();i.CapacityMigrateWorkspacesController=s})(e=i.controllers||(i.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityMigrateWorkspaces={templateUrl:"components/capacityMigrateWorkspaces/capacityMigrateWorkspaces.html",controller:t.common.createController(i.controllers.CapacityMigrateWorkspacesController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){var i=(function(){function t(t,i){this.services=i}return t.createOptions=function(){return{additionalServices:["capacityAdminHttpProxy","navigation","selectedCapacityService","taskPaneSliderService"]}},t.prototype.$onInit=function(){this.originalCapacityMetadata=this.services.selectedCapacityService.selectedCapacity.metadata,this.capacityMetadata=_.cloneDeep(this.originalCapacityMetadata),this.errorOccurred=!1,this.loading=!1},t.prototype.applyChanges=function(){var t=this;this.errorOccurred=!1,this.loading=!0,this.services.capacityAdminHttpProxy.updateCapacity(this.capacityMetadata.capacityObjectId,this.capacityMetadata.configuration,null).then((function(i){t.originalCapacityMetadata.configuration=t.capacityMetadata.configuration,t.closePane()}),(function(i){t.errorOccurred=!0})).finally((function(){t.loading=!1}))},t.prototype.getPowerBIAdmins=function(){return[]},t.prototype.closePane=function(){this.services.taskPaneSliderService.collapsePane()},t.prototype.isLoading=function(){return this.loading},t.prototype.isError=function(){return this.errorOccurred},t})();t.CapacitySettingsEditorController=i})(i=t.controllers||(t.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacitySettingsEditor={templateUrl:"components/capacitySettingsEditor/capacitySettingsEditor.html",controller:t.common.createController(i.controllers.CapacitySettingsEditorController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(i){var e,a=jsCommon.StringExtensions,n=jsCommon.EnumExtensions;!(function(t){t[t.None=0]="None",t[t.Loading=1]="Loading",t[t.Error=2]="Error"})(e=i.CapacityWorkspaceStatusType||(i.CapacityWorkspaceStatusType={}));var o=(function(){function i(t,i){this.services=i}return i.createOptions=function(){return{additionalServices:["localizationService"]}},i.prototype.getDisplayUIStatus=function(){return this.services.localizationService.get(a.format("CapacityAdmin_WorkspaceStatus_{0}",n.toString(t.contracts.CapacityWorkspaceStatus,this.getUiStatus())))},i.prototype.getIconType=function(){switch(this.getUiStatus()){case t.contracts.CapacityWorkspaceStatus.MigrationFailed:return e.Error;case t.contracts.CapacityWorkspaceStatus.MigrationPending:return e.Loading}return e.None},i.prototype.getUiStatus=function(){return this.workspaceStatus===t.contracts.CapacityWorkspaceStatus.MigrationFailed?t.contracts.CapacityWorkspaceStatus.MigrationFailed:t.contracts.CapacityWorkspaceStatus.Migrated},i})();i.CapacityWorkspaceStatusController=o})(i=t.controllers||(t.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityWorkspaceStatus={templateUrl:"components/capacityWorkspaceStatus/capacityWorkspaceStatus.html",bindings:{workspaceStatus:"<"},controller:t.common.createController(i.controllers.CapacityWorkspaceStatusController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(t){var i;!(function(t){var i=(function(){function t(t){this.o365AdminUserPageUrl=window.o365AdminUserPageUrl}return t})();t.CapacityActionsController=i})(i=t.controllers||(t.controllers={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));var powerbi;!(function(t){var i;!(function(i){var e;!(function(e){e.CapacityActions={templateUrl:"components/capacityActions/capacityActions.html",bindings:{capacityState:"<"},controller:t.common.createController(i.controllers.CapacityActionsController)}})(e=i.components||(i.components={}))})(i=t.capacityAdmin||(t.capacityAdmin={}))})(powerbi||(powerbi={}));;var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},powerbi;!(function(e){var t;!(function(t){t.PermissionsPlaceholderAction=function(t,i,r,s,o,a,n,c,l,p,m,d){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),void 0===n&&(n=void 0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===p&&(p=void 0),void 0===m&&(m=!1),void 0===d&&(d=!1);var v={parentId:t,isError:i,errorSource:r,errorCode:s,errorMessage:o,activityName:a,activityId:n,isDebug:c,isCancelled:l,pingLatency:p,isAppInactive:m,isInCapacity:d},h={name:"PBI.Permissions.PlaceholderAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:v.parentId},i=typeof v.isError;("boolean"===i&&!!v.isError!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isError=v.isError);var i=typeof v.errorSource;("boolean"===i&&!!v.errorSource!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]);var i=typeof v.errorCode;("boolean"===i&&!!v.errorCode!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorCode=v.errorCode);var i=typeof v.errorMessage;("boolean"===i&&!!v.errorMessage!=!1||"undefined"!==i&&"boolean"!==i)&&(t.errorMessage=v.errorMessage);var i=typeof v.activityName;("boolean"===i&&!!v.activityName!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityName=v.activityName);var i=typeof v.activityId;("boolean"===i&&!!v.activityId!=!1||"undefined"!==i&&"boolean"!==i)&&(t.activityId=v.activityId);var i=typeof v.isDebug;("boolean"===i&&!!v.isDebug!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isDebug=v.isDebug);var i=typeof v.isCancelled;("boolean"===i&&!!v.isCancelled!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isCancelled=v.isCancelled);var i=typeof v.pingLatency;("boolean"===i&&!!v.pingLatency!=!1||"undefined"!==i&&"boolean"!==i)&&(t.pingLatency=v.pingLatency);var i=typeof v.isAppInactive;("boolean"===i&&!!v.isAppInactive!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isAppInactive=v.isAppInactive);var i=typeof v.isInCapacity;return("boolean"===i&&!!v.isInCapacity!=!1||"undefined"!==i&&"boolean"!==i)&&(t.isInCapacity=v.isInCapacity),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.PermissionsPlaceholderActionLoggers&&(h.loggers=e.telemetry.PermissionsPlaceholderActionLoggers),h}})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(){return new r}t.createPermissionHttpService=i;var r=(function(){function t(){}return t.prototype.getAccess=function(t){var i=e.common.httpService.powerbiRequestOptions(t,"GetAccess");return e.common.httpService.get("metadata/access",i)},t.prototype.putAccess=function(t,i){var r=e.common.httpService.powerbiRequestOptions(i,"PutAccess");return e.common.httpService.put("metadata/access",t,r)},t.prototype.getDashboardAccess=function(t,i){var r=e.common.httpService.powerbiRequestOptions(i,"GetDashboardAccess");return e.common.httpService.get("metadata/access/dashboards/"+t,r)},t.prototype.getReportAccess=function(t,i){var r=e.common.httpService.powerbiRequestOptions(i,"GetReportAccess");return e.common.httpService.get("metadata/access/reports/"+t,r)},t.prototype.getDatasetAccess=function(t,i){var r=e.common.httpService.powerbiRequestOptions(i,"GetDatasetAccess");return e.common.httpService.get("metadata/access/models/"+t,r)},t.prototype.getWorkbookAccess=function(t,i){var r=e.common.httpService.powerbiRequestOptions(i,"GetWorkbookAccess");return e.common.httpService.get("metadata/access/workbooks/"+t,r)},t})();t.PermisionHttpService=r})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i=e.common.constants,r=e.common.constants.navigation.states,s=(function(){function e(){}return e.prototype.convertLocationOption=function(e){var t;switch(e){case 1:t=!1;break;case 0:t=!0;break;case 2:t="replace";break;default:t=!0}return t},e})();t.NavigationBase=s;var o=(function(t){function s(e,i,r,s,o){var a=t.call(this)||this;return a.$location=e,a.$window=i,a.$rootScope=r,a.$state=s,a.featureSwitchService=o,a}return __extends(s,t),Object.defineProperty(s.prototype,"stateService",{get:function(){return this.$state},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"permissionArtifact",{get:function(){return this.stateService.includes(r.dashboardPermission)?1:this.stateService.includes(r.reportPermission)?2:this.stateService.includes(r.datasetPermission)?3:this.stateService.includes(r.workbookPermission)?4:this.stateService.includes(r.permissionCenter)?5:null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"permissionArtifactGUID",{get:function(){return this.stateService.params.GUID},enumerable:!0,configurable:!0}),s.prototype.navigateToManagePermissions=function(e,t){var i=this.getManagePermissionsStateFromPermissionArtifactType(e),r=s.getManagePermissionsParam(e,t),o=this.convertLocationOption(this.stateService.includes(i)?2:0);this.stateService.go(i,r,{location:o,inherit:!0,reload:!0})},s.prototype.inManagePermissionsView=function(){return this.stateService.includes(e.common.constants.navigation.states.permissionCenter)||this.stateService.includes(e.common.constants.navigation.states.dashboardPermission)||this.stateService.includes(e.common.constants.navigation.states.reportPermission)||this.stateService.includes(e.common.constants.navigation.states.datasetPermission)},s.prototype.getManagePermissionsStateFromPermissionArtifactType=function(t){switch(t){case 5:return e.common.constants.navigation.states.permissionCenter;case 1:return e.common.constants.navigation.states.dashboardPermission;case 2:return i.navigation.states.reportPermission;case 3:return i.navigation.states.datasetPermission;case 4:return i.navigation.states.workbookPermission;default:return null}},s.getManagePermissionsParam=function(e,t){return 5===e?{}:{GUID:t,type:e}},s})(s);t.PermissionNavigationService=o})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e,t,r,s,o,a,n){return new i(e,t,r,s,o,a,n)}e.createPermissionDataService=t;var i=(function(){function t(e,t,i,r,s,o,a){this.dashboardDataService=e,this.reportService=t,this.modelService=i,this.workbookService=r,this.promiseFactory=s,this.permissionHttpService=o,this.telemetryService=a,this.dashboardDataService=e,this.reportService=t,this.modelService=i,this.workbookService=r,this.promiseFactory=s,this.permissionHttpService=o,this.telemetryService=a,this.permissionArtifacts=[],this.permissionsDeferred=this.promiseFactory.defer()}return t.prototype.setActivePermissionArtifact=function(e,t,i){var r=this;if(this.activePermissionArtifact=null,i||(i=this.permissionArtifacts),!e||!t)return this.promiseFactory.resolve(null);var s=t.toLowerCase();switch(e){case 1:return this.dashboardDataService.getDashboards().then((function(t){if(_.isEmpty(t))return null;var i=_.findLast(t,(function(e){return e.contract.objectId.toLowerCase()===s}));return i?r.setActiveArtifact(e,i.contract.id):null}));case 3:return this.modelService.modelsPromise.then((function(t){if(_.isEmpty(t))return null;var i=_.findLast(t,(function(e){return e.dbName.toLowerCase()===s}));return i?r.setActiveArtifact(e,i.contract.id):null}));case 2:return this.reportService.getReports().then((function(t){if(_.isEmpty(t))return null;var i=_.findLast(t,(function(e){return e.contract.objectId.toLowerCase()===s}));return i?r.setActiveArtifact(e,i.contract.id):null}));case 4:return this.workbookService.getWorkbooks().then((function(t){if(_.isEmpty(t))return null;var i=_.findLast(t,(function(e){return e.contract.id.toString().toLowerCase()===s}));return i?r.setActiveArtifact(e,i.contract.id):null}))}},t.prototype.assembleRelatedForRelatedDataset=function(e){var t=this;return this.assembleArtifact(e.id,e.type).then((function(e){return t.assembleRelatedArtifactWithDataset(e)})).then((function(i){return e.related=i,t.promiseFactory.resolve(e)}))},t.prototype.getPermissionArtifacts=function(){return this.permissionsDeferred.promise.then((function(e){return e.permissionArtifacts}))},t.prototype.updateAccesses=function(t,i){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];if(!t)return this.promiseFactory.resolve(null);var o=(a=e.models.PermissionViewModelFactory).createAccessContainerRequest.apply(a,[this.activePermissionArtifact,!1].concat(r));return this.permissionHttpService.putAccess(o,this.telemetryService.root);var a},t.prototype.removeMembers=function(t){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];if(!t)return this.promiseFactory.resolve(null);var s=(o=e.models.PermissionViewModelFactory).createAccessContainerRequest.apply(o,[this.activePermissionArtifact,!0].concat(i));return this.permissionHttpService.putAccess(s,this.telemetryService.root);var o},t.prototype.removeAllMembers=function(t){if(!t)return this.promiseFactory.resolve(null);var i=e.models.PermissionViewModelFactory.createAccessRequestForRemoveAllMember(t);return this.permissionHttpService.putAccess(i,this.telemetryService.root)},t.prototype.loadPermissionArtifacts=function(){var e=this,t=[],i=this.promiseFactory.defer(),r=[];return this.permissionHttpService.getAccess(this.telemetryService.root).then((function(s){if(s&&s.data){if(s.data.dashboards)for(var o=0,a=s.data.dashboards;o<a.length;o++){var n=a[o];e.processArtifact(n,1,t,r)}if(s.data.reports)for(var c=0,l=s.data.reports;c<l.length;c++){var p=l[c];e.processArtifact(p,2,t,r)}if(s.data.workbooks)for(var m=0,d=s.data.workbooks;m<d.length;m++){var v=d[m];e.processArtifact(v,4,t,r)}if(s.data.models)for(var h=0,u=s.data.models;h<u.length;h++){var f=u[h];e.processArtifact(f,3,t,r)}e.permissionsDeferred.resolve(e),e.promiseFactory.all(r).then((function(){i.resolve(t),e.permissionArtifacts=t}))}}),(function(){e.permissionsDeferred.reject(),i.reject()})),i.promise},t.prototype.processArtifact=function(t,i,r,s){t.type=i,s.push(this.retrieveRelatedItem(t).then((function(i){i&&r.push(e.models.PermissionViewModelFactory.assemblePermissionArtifact(t,i))})))},t.prototype.setActiveArtifact=function(e,t){var i=this;return this.assembleArtifact(t,e).then((function(e){return i.activePermissionArtifact=e,i.promiseFactory.resolve(i.activePermissionArtifact)}))},t.prototype.assembleArtifact=function(t,i){var r=this,s=this.getAccess(t,i),o=s.then((function(e){return r.retrieveRelatedItem(e)}));return this.promiseFactory.all([s,o]).then((function(t){var i=t[0],s=t[1],o=e.models.PermissionViewModelFactory.assemblePermissionArtifact(i,s);return r.promiseFactory.resolve(o)}))},t.prototype.getAccess=function(e,t){var i=this,r=this.promiseFactory.defer();switch(t){case 1:this.permissionHttpService.getDashboardAccess(e,this.telemetryService.root).then((function(e){e&&e.data&&(e.data.type=1,r.resolve(e.data))}),(function(){i.permissionsDeferred.reject(),r.reject()}));break;case 3:this.permissionHttpService.getDatasetAccess(e,this.telemetryService.root).then((function(e){e&&e.data&&(e.data.type=3,r.resolve(e.data))}),(function(){i.permissionsDeferred.reject(),r.reject()}));break;case 2:this.permissionHttpService.getReportAccess(e,this.telemetryService.root).then((function(e){e&&e.data&&(e.data.type=2,r.resolve(e.data))}),(function(){i.permissionsDeferred.reject(),r.reject()}));break;case 4:this.permissionHttpService.getWorkbookAccess(e,this.telemetryService.root).then((function(e){e&&e.data&&(e.data.type=4,r.resolve(e.data))}),(function(){i.permissionsDeferred.reject(),r.reject()}))}return r.promise},t.prototype.assembleRelatedArtifactWithDataset=function(e){for(var t=[],i=this.promiseFactory.defer(),r=[],s=0,o=e.related;s<o.length;s++){var a=o[s];3===a.type?t.push(this.assembleArtifact(a.id,a.type).then((function(e){r.push(e)}))):r.push(a)}return this.promiseFactory.all(t).then((function(){i.resolve(r)})),i.promise},t.prototype.retrieveRelatedItem=function(e){var t=this,i=[],r=this.promiseFactory.defer(),s=[];if(e||r.resolve(null),e.relatedDashboardIds)for(var o=0,a=e.relatedDashboardIds;o<a.length;o++){var n=a[o];s.push(this.permissionHttpService.getDashboardAccess(n,this.telemetryService.root).then((function(e){e&&e.data&&(e.data.type=1,i.push(e.data))}),(function(){t.permissionsDeferred.reject()})))}if(e.relatedModelIds)for(var c=0,l=e.relatedModelIds;c<l.length;c++){var n=l[c];s.push(this.permissionHttpService.getDatasetAccess(n,this.telemetryService.root).then((function(e){e&&e.data&&(e.data.type=3,i.push(e.data))}),(function(){t.permissionsDeferred.reject()})))}if(e.relatedReportIds)for(var p=0,m=e.relatedReportIds;p<m.length;p++){var n=m[p];s.push(this.permissionHttpService.getReportAccess(n,this.telemetryService.root).then((function(e){e&&e.data&&(e.data.type=2,i.push(e.data))}),(function(){t.permissionsDeferred.reject()})))}if(e.relatedWorkbookIds)for(var d=0,v=e.relatedWorkbookIds;d<v.length;d++){var n=v[d];s.push(this.permissionHttpService.getWorkbookAccess(n,this.telemetryService.root).then((function(e){e&&e.data&&(e.data.type=4,i.push(e.data))}),(function(){t.permissionsDeferred.reject()})))}return this.promiseFactory.all(s).then((function(){r.resolve(i)}),(function(){r.reject()})),r.promise},t})();e.PermissionDataService=i})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){function t(e){return new i(e)}e.createPermissionLocalizationService=t;var i=(function(){function e(e){this.localizationService=e,this.localizationService=e}return e.prototype.getModalDialogContextInfo=function(e){var t="";return e?t=e.related.length>0?this.localizationService.format("PermissionCenter_RelatedContent_RemoveDialogText",[e.displayName]):this.localizationService.get("PermissionCenter_NoRelatedContent_RemoveDialogText"):t},e.prototype.getRelatedArtifactDisplayName=function(e){if(!e||_.isEmpty(e.related))return"";for(var t="",i=0,r=e.related;i<r.length;i++){var s=r[i],o=this.getArtifactDisplayName(s);t=""===t?o:this.localizationService.format("PermissionCenter_RelatedArtifactList_PlaceHolder",[t,o])}return this.localizationService.format("PermissionCenter_RelatedContent_ModalText",[t])},e.prototype.getArtifactDisplayName=function(e){if(!e)return"";var t=null;switch(e.type){case 1:t=this.localizationService.get("ArtifactKind_Dashboard");break;case 3:t=this.localizationService.get("ArtifactKind_Dataset");break;case 2:t=this.localizationService.get("ArtifactKind_Report");break;case 4:t=this.localizationService.get("ArtifactKind_Workbook")}return this.localizationService.format("PermissionCenter_DisplayName_PlaceHolder",[e.displayName,t])},e.prototype.getArtifactDisplayNameWithSpace=function(e){if(!e)return"";switch(e.type){case 1:return this.localizationService.format("PermissionCenter_Dashboard_DisplayTitle",[e.displayName]);case 3:return this.localizationService.format("PermissionCenter_Dataset_DisplayTitle",[e.displayName]);case 2:return this.localizationService.format("PermissionCenter_Report_DisplayTitle",[e.displayName]);case 4:return this.localizationService.format("PermissionCenter_Workbook_DisplayTitle",[e.displayName]);default:return e.displayName}},e})();e.PermissionLocalizationService=i})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t){var i=[{name:"PermissionCenterHome",blockType:2,consumerHostFlags:r.Web},{name:"PermissionDeleteModalDialog",blockType:2,consumerHostFlags:r.Web},{name:"PermissionDetails",blockType:2,consumerHostFlags:r.Web}];e.common.registerBuildingBlocksForHost(t,i,{componentsTarget:"powerbi.permissions.components",componentsMap:e.permissions.components})}var r=e.common.HostEnv;angular.module("powerbi.permissions.components",[]),angular.module("powerbi.permissions.directives",[]),angular.module("powerbi.permissions",["powerbi.permissions.components","powerbi.permissions.directives","powerbi.dataServices"]).factory("permissionDataService",["dashboardDataService","reportService","modelService","workbookService","promiseFactory","permissionHttpService","telemetryService",function(e,i,r,s,o,a,n){return t.createPermissionDataService(e,i,r,s,o,a,n)}]).factory("permissionLocalizationService",["localizationService",function(e){return t.createPermissionLocalizationService(e)}]).factory("permissionHttpService",[function(){return t.createPermissionHttpService()}]).service("permissionNavigationService",["$location","$window","$rootScope","$state","featureSwitchService",t.PermissionNavigationService]),t.registerBuildingBlocksForHost=i})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.related=[],this.members=[]}return Object.defineProperty(e.prototype,"typeToString",{get:function(){switch(this.type){case 1:return"Dashboard";case 3:return"Dataset";case 5:return"Home";case 2:return"Report";case 4:return"Workbook"}},enumerable:!0,configurable:!0}),e})();e.PermissionArtifact=t})(t=e.models||(e.models={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var i;!(function(i){function r(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var s=[],o=[],a=[],n=[],c=this.createAccessRequests.apply(this,[e,t].concat(i));if(_.isEmpty(c))return this.createAccessRequestForRemoveAllMember(e);switch(e.type){case 1:s=c;break;case 3:n=c;break;case 2:o=c;break;case 4:a=c}return{dashboards:s,models:n,workbooks:a,reports:o}}function s(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];for(var s=[],o=0,a=e.members;o<a.length;o++){for(var n=a[o],c=!1,l=null,p=0,m=i;p<m.length;p++){var d=m[p];if(d.id===n.id&&d.userId===n.userId){l=d,c=!0;break}}l||(l=n),t&&c||s.push({id:l.id,userId:l.userId,groupId:l.groupId,tenantId:l.tenantId,permissions:l.permission})}return s}function o(e){var t=[],i=[],r=[],s=[],o={id:e.id};switch(e.type){case 1:t.push(o);break;case 3:s.push(o);break;case 2:i.push(o);break;case 4:r.push(o)}return{dashboards:t,models:s,workbooks:r,reports:i}}function a(e,i){var r=new t.PermissionArtifact;if(r.id=e.id,r.displayName=e.displayName,r.objectId=e.objectId,r.type=e.type,r.sharedWithCount=e.sharedWithCount,r.members=[],r.related=[],e.detail)for(var s=0,o=e.detail;s<o.length;s++){var a=o[s],n={userId:a.userId,displayName:[a.givenName,a.familyName].join(" ").trim(),email:a.emailAddress,id:a.id,permission:a.permissions,groupId:a.groupId,tenantId:a.tenantId};r.members.push(n)}if(i)for(var c=0,l=i;c<l.length;c++){var p=l[c];r.related.push(this.assemblePermissionArtifact(p,null))}return r}function n(t){if(!t)return null;var i=new e.PermissionArtifact;return i.id=t.id,i.displayName=t.displayName,i.objectId=t.objectId,i.type=t.type,i.members=t.members,i.related=t.related,i.createdDate=t.createdDate,i}i.createAccessContainerRequest=r,i.createAccessRequests=s,i.createAccessRequestForRemoveAllMember=o,i.assemblePermissionArtifact=a,i.convertPermissionArtifact=n})(i=e.PermissionViewModelFactory||(e.PermissionViewModelFactory={}))})(t=e.models||(e.models={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e,i){var r=this;this.services=i,this.selectType=function(e){r.typeFilter^=e},this.scope=e,this.searchInputPlaceholder=this.services.localizationService.get("PermissionCenter_SearchInputPlaceholder"),this.typeFilter=t.allTypes,this.initializeArtifacts(),this.tableConfig={data:null,hasHeader:!0,shouldHideData:function(e){return r.shouldHide(e)}}}return t.createOptions=function(){return{additionalServices:["permissionDataService","permissionLocalizationService","permissionNavigationService","localizationService","modalDialogService","promiseFactory"]}},t.prototype.initializeArtifacts=function(){var e=this;return this.artifactsLoadedDefer=this.services.promiseFactory.defer(),this.artifactsPromise=this.services.permissionDataService.loadPermissionArtifacts(),this.artifactsPromise.then((function(t){return e.assignArtifacts(t)}))},t.prototype.assignArtifacts=function(e){this.tableConfig.data=e,this.tableConfig.filteredData=e},t.prototype.openPermissionDetails=function(e){var t=this,i=e.type,r=e.objectId;return this.services.permissionDataService.setActivePermissionArtifact(i,r).then((function(e){return t.services.permissionNavigationService.navigateToManagePermissions(i,r)}))},t.prototype.toggleArtifact=function(e){if(e.id===this.activePermissionArtifact.id&&e.type===this.activePermissionArtifact.type)this.activePermissionArtifact.selected=!this.activePermissionArtifact.selected;else for(var t=0,i=this.activePermissionArtifact.related;t<i.length;t++){var r=i[t];r.id===e.id&&r.type===e.type&&(r.selected=!r.selected)}},t.prototype.getModalDialogContextInfo=function(e){return this.services.permissionLocalizationService.getModalDialogContextInfo(e)},t.prototype.getRelatedArtifactDisplayName=function(e){return this.services.permissionLocalizationService.getRelatedArtifactDisplayName(e)},t.prototype.getArtifactDisplayName=function(e){return this.services.permissionLocalizationService.getArtifactDisplayName(e)},t.prototype.shouldShowWarningForRelatedContent=function(e){return 3===e.type&&!_.isEmpty(e.related)},t.prototype.isArtifactSlected=function(e){return e.selected},t.prototype.resetSelectedArtifacts=function(e){e.selected=!0;for(var t=0,i=e.related;t<i.length;t++){var r=i[t];r.selected=!0}},t.prototype.shouldHide=function(t){switch(t.type){case 1:return this.shouldHideType(e.common.contracts.PermissionArtifactType.Dashboard);case 3:return this.shouldHideType(e.common.contracts.PermissionArtifactType.Dataset);case 2:return this.shouldHideType(e.common.contracts.PermissionArtifactType.Report);case 4:return this.shouldHideType(e.common.contracts.PermissionArtifactType.Workbook)}},t.prototype.shouldHideType=function(e){return 0===(this.typeFilter&e)},t.prototype.displayRemoveMemberErrorDialog=function(){var e=this.services.localizationService.get("PermissionCenter_ErrorTitle"),t=this.services.localizationService.get("PermissionCenter_ErrorMessage_RemoveMember");this.displayErrorMessageDialog(e,t)},t.prototype.displayErrorMessageDialog=function(e,t){var i=this.services.rootScope.$new(),r=[new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_GotIt"),function(e,t){i.closeDialog()})];i.message=t;var s={dialogName:e,isDismissable:!0,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogActions:r};this.services.modalDialogService.showLegacyWebModalDialog(s)},t.prototype.removeAllMembers=function(e){var t=this;return this.services.permissionDataService.assembleRelatedForRelatedDataset(e).then((function(i){t.resetSelectedArtifacts(e),t.activePermissionArtifact=i;var r=t.scope.$new(),s="<permission-delete-modal-dialog></permission-delete-modal-dialog>",o={dialogName:t.services.localizationService.get("PermissionCenter_RemoveAccess"),isDismissable:!0,scope:r,template:s,focusOnFirstButton:!0,dialogActions:[new InJs.ModalDialogAction(t.services.localizationService.get("PermissionCenter_RemoveAccess"),function(e,i){t.activePermissionArtifact.selected&&t.services.permissionDataService.removeAllMembers(t.activePermissionArtifact).then((function(e){t.activePermissionArtifact.sharedWithCount=1}),(function(){t.displayRemoveMemberErrorDialog()}));for(var s=0,o=t.activePermissionArtifact.related;s<o.length;s++){var a=o[s],n=function(e){e.selected&&t.services.permissionDataService.removeAllMembers(e).then((function(i){var r=_.findLast(t.tableConfig.data,(function(t){return e.id===t.id&&e.type===t.type}));r.sharedWithCount=1}),(function(){t.displayRemoveMemberErrorDialog()}))};n(a)}r.closeDialog()}),new InJs.ModalDialogAction(t.services.localizationService.get("ModalDialog_Cancel"),function(e,t){r.closeDialog()})]};t.services.modalDialogService.showLegacyWebModalDialog(o)}))},t})();i.allTypes=e.common.contracts.PermissionArtifactType.Dashboard|e.common.contracts.PermissionArtifactType.Dataset|e.common.contracts.PermissionArtifactType.Report|e.common.contracts.PermissionArtifactType.Workbook,t.PermissionCenterHomeController=i})(i=t.controllers||(t.controllers={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PermissionCenterHome={templateUrl:"components/permissionCenterHome/permissionCenterHomeView.html",controller:e.common.createController(t.controllers.PermissionCenterHomeController)}})(i=t.components||(t.components={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.PermissionDeleteModalDialog={templateUrl:"components/PermissionDeleteModalDialog/PermissionDeleteModalDialog.html"}})(t=e.components||(e.components={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r;!(function(e){e[e.BatchUpdateReadOnly=0]="BatchUpdateReadOnly",e[e.BatchUpdateReadAndReshare=1]="BatchUpdateReadAndReshare"})(r=i.MoreDropdownAction||(i.MoreDropdownAction={}));var s=(function(){function i(e,t){this.services=t,this.scope=e,this.searchInputPlaceholder=this.services.localizationService.get("PermissionCenter_SearchInputPlaceholder"),this.tableConfig={data:this.services.permissionDataService&&this.services.permissionDataService.activePermissionArtifact?this.services.permissionDataService.activePermissionArtifact.members:null,hasHeader:!0},this.tableConfig.data||this.displayUnknownErrorDialog(),this.activeArtifactDisplayName=this.assembleActiveArtifactDisplayname(),this.createMemberAccessDropdown(),this.createMoreDropdown(),this.resetSlectedMembers()}return Object.defineProperty(i.prototype,"activePermissionArtifact",{get:function(){if(this.services.permissionDataService)return this.services.permissionDataService.activePermissionArtifact},set:function(e){this.services.permissionDataService&&(this.services.permissionDataService.activePermissionArtifact=e)},enumerable:!0,configurable:!0}),i.createOptions=function(){return{additionalServices:["dashboardDataService","permissionDataService","permissionLocalizationService","permissionNavigationService","localizationService","modalDialogService"]}},i.prototype.isOwner=function(e){return e.permission===t.contracts.Permissions.All},i.prototype.isLoaded=function(){return null!=this.tableConfig.data},i.prototype.navigateToPermissionCenterHome=function(){this.services.permissionNavigationService.navigateToManagePermissions(5,null)},i.prototype.shouldShowWarningForRelatedContent=function(e){return 3===e.type&&!_.isEmpty(e.related)},i.prototype.isArtifactSlected=function(e){return e.selected},i.prototype.toggleArtifact=function(e){if(e.id===this.activePermissionArtifact.id&&e.type===this.activePermissionArtifact.type)this.activePermissionArtifact.selected=!this.activePermissionArtifact.selected;else for(var t=0,i=this.activePermissionArtifact.related;t<i.length;t++){var r=i[t];r.id===e.id&&r.type===e.type&&(r.selected=!r.selected)}},i.prototype.toggleSelectAll=function(){var e=this;this.services.timeout((function(){for(var i=0,r=e.tableConfig.data;i<r.length;i++){var s=r[i];s.permission!==t.contracts.Permissions.All&&(s.selected=e.allSelected)}}))},i.prototype.openRelatedArtifactDetails=function(e){var t=this,i=e.type,r=e.objectId;return this.services.permissionDataService.setActivePermissionArtifact(e.type,e.objectId,this.activePermissionArtifact?this.activePermissionArtifact.related:null).then((function(){t.services.permissionNavigationService.navigateToManagePermissions(i,r)}))},i.prototype.isSelected=function(){return!!this.activePermissionArtifact&&_.some(this.tableConfig.data,(function(e){return e.selected}))},i.prototype.onMemberAccessMenuItemSelected=function(e,t,i){var r=this,s=this.convertMenuActionToPermission(e);this.services.permissionDataService.updateAccesses(i,s,t).then((function(){for(var e=0,r=i;e<r.length;e++){var o=r[e];o.id===t.id&&o.userId===t.userId&&(o.permission=s)}}),(function(){r.displayUpdateAccessErrorDialog()}))},i.prototype.onMoreDropdownSelected=function(e,t){var i=this,r=_.filter(this.tableConfig.data,(function(e){return e.selected})),s=this.convertMoreDropdownItemToPermission(e);return(o=this.services.permissionDataService).updateAccesses.apply(o,[t,s].concat(r)).then((function(){for(var e=0,i=t;e<i.length;e++)for(var o=i[e],a=0,n=r;a<n.length;a++){var c=n[a];o.id===c.id&&o.userId===c.userId&&(o.permission=s)}}),(function(){i.displayUpdateAccessErrorDialog()}));var o},i.prototype.assembleActiveArtifactDisplayname=function(){return this.services.permissionLocalizationService.getArtifactDisplayNameWithSpace(this.activePermissionArtifact)},i.prototype.convertMenuActionToPermission=function(e){switch(e.action){case 0:return t.contracts.Permissions.Read;case 1:return t.contracts.Permissions.ReadReshare}},i.prototype.convertMoreDropdownItemToPermission=function(e){switch(e.action){case r.BatchUpdateReadOnly:return t.contracts.Permissions.Read;case r.BatchUpdateReadAndReshare:return t.contracts.Permissions.ReadReshare}},i.prototype.resetSelectedArtifacts=function(){this.activePermissionArtifact.selected=!0;for(var e=0,t=this.activePermissionArtifact.related;e<t.length;e++){var i=t[e];i.selected=!0}},i.prototype.resetSlectedMembers=function(){this.activePermissionArtifact&&this.activePermissionArtifact.members&&this.activePermissionArtifact.members.forEach((function(e){e.selected=!1}))},i.prototype.createMemberAccessDropdown=function(){var e=[];e.push({text:this.services.localizationService.get("PermissionCenter_ReadOnly"),action:0,type:DropDownMenuItemType.Item}),e.push({text:this.services.localizationService.get("PermissionCenter_ReadAndReshare"),action:1,type:DropDownMenuItemType.Item}),this.memberAccessMenuItem=e},i.prototype.getModalDialogContextInfo=function(e){return this.services.permissionLocalizationService.getModalDialogContextInfo(e)},i.prototype.getRelatedArtifactDisplayName=function(e){return this.services.permissionLocalizationService.getRelatedArtifactDisplayName(e)},i.prototype.getArtifactDisplayName=function(e){return this.services.permissionLocalizationService.getArtifactDisplayName(e)},i.prototype.createMoreDropdown=function(){var e=[];e.push({text:this.services.localizationService.get("PermissionCenter_ReadOnly"),action:r.BatchUpdateReadOnly,type:DropDownMenuItemType.Item}),e.push({text:this.services.localizationService.get("PermissionCenter_ReadAndReshare"),action:r.BatchUpdateReadAndReshare,type:DropDownMenuItemType.Item}),this.moreDropdownItem=e},i.prototype.displayUnknownErrorDialog=function(){var e=this.services.localizationService.get("PermissionCenter_ErrorTitle"),t=this.services.localizationService.get("PermissionCenter_ErrorMessage_Generic");this.displayErrorMessageDialog(e,t)},i.prototype.displayUpdateAccessErrorDialog=function(){var e=this.services.localizationService.get("PermissionCenter_ErrorTitle"),t=this.services.localizationService.get("PermissionCenter_ErrorMessage_UpdateAccess");this.displayErrorMessageDialog(e,t)},i.prototype.displayRemoveMemberErrorDialog=function(){var e=this.services.localizationService.get("PermissionCenter_ErrorTitle"),t=this.services.localizationService.get("PermissionCenter_ErrorMessage_RemoveMember");this.displayErrorMessageDialog(e,t)},i.prototype.displayErrorMessageDialog=function(e,t){var i=this.services.rootScope.$new(),r=[new InJs.ModalDialogAction(this.services.localizationService.get("ModalDialogButtonText_GotIt"),function(e,t){i.closeDialog()})];i.message=t;var s={dialogName:e,isDismissable:!0,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogActions:r};this.services.modalDialogService.showLegacyWebModalDialog(s)},i.prototype.batchRemoveMember=function(){var e=this;return this.services.permissionDataService.assembleRelatedForRelatedDataset(this.activePermissionArtifact).then((function(t){e.resetSelectedArtifacts(),e.activePermissionArtifact=t;
var i=e.scope.$new(),r="<permission-delete-modal></permission-delete-modal>",s={dialogName:e.services.localizationService.get("PermissionCenter_RemoveAccess"),isDismissable:!0,scope:i,template:r,focusOnFirstButton:!0,dialogActions:[new InJs.ModalDialogAction(e.services.localizationService.get("PermissionCenter_RemoveAccess"),function(t,r){var s=e.tableConfig.data.slice(0);_.remove(s,(function(e){return!e.selected})),e.activePermissionArtifact.selected&&(l=e.services.permissionDataService).removeMembers.apply(l,[e.tableConfig.data].concat(s)).then((function(){_.remove(e.tableConfig.data,(function(e){return _.indexOf(s,e)!==-1}))}),(function(){e.displayRemoveMemberErrorDialog()}));for(var o=0,a=e.activePermissionArtifact.related;o<a.length;o++){var n=a[o],c=function(t){t.selected&&(i=e.services.permissionDataService).removeMembers.apply(i,[t.members].concat(s)).then((function(){_.remove(t.members,(function(e){return _.indexOf(s,e)!==-1}))}),(function(){e.displayRemoveMemberErrorDialog()}));var i};c(n)}i.closeDialog();var l}),new InJs.ModalDialogAction(e.services.localizationService.get("ModalDialog_Cancel"),function(e,t){i.closeDialog()})]};e.services.modalDialogService.showLegacyWebModalDialog(s)}))},i.prototype.removeMember=function(e){var t=this;return this.services.permissionDataService.assembleRelatedForRelatedDataset(this.activePermissionArtifact).then((function(i){t.resetSelectedArtifacts();var r=t.scope.$new(),s="<permission-delete-modal></permission-delete-modal>",o={dialogName:t.services.localizationService.get("PermissionCenter_RemoveAccess"),isDismissable:!0,scope:r,template:s,focusOnFirstButton:!0,dialogActions:[new InJs.ModalDialogAction(t.services.localizationService.get("PermissionCenter_RemoveAccess"),function(i,s){t.activePermissionArtifact.selected&&t.services.permissionDataService.removeMembers(t.tableConfig.data,e).then((function(){_.pull(t.tableConfig.data,e)}),(function(){t.displayRemoveMemberErrorDialog()}));for(var o=0,a=t.activePermissionArtifact.related;o<a.length;o++){var n=a[o],c=function(i){i.selected&&t.services.permissionDataService.removeMembers(i.members,e).then((function(){_.pull(i.members,e)}),(function(){t.displayRemoveMemberErrorDialog()}))};c(n)}r.closeDialog()}),new InJs.ModalDialogAction(t.services.localizationService.get("ModalDialog_Cancel"),function(e,t){r.closeDialog()})]};t.services.modalDialogService.showLegacyWebModalDialog(o)}))},i.prototype.shareDashboard=function(){var t=this.services.dashboardDataService.findDashboard(this.activePermissionArtifact.id);t&&(this.services.dashboardDataService.sharingDashboard=t,this.scope.$emit(e.common.constants.TaskPaneSlider.ShowShareDashboardPaneEventName))},i})();i.PermissionDetailsController=s})(i=t.controllers||(t.controllers={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PermissionDetails={templateUrl:"components/permissionDetails/permissionDetailsView.html",controller:e.common.createController(t.controllers.PermissionDetailsController)}})(i=t.components||(t.components={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e[e.None=0]="None",e[e.Read=1]="Read",e[e.Write=2]="Write",e[e.ReShare=4]="ReShare",e[e.Explore=8]="Explore",e[e.CopyOnWrite=16]="CopyOnWrite",e[e.WriteCheckRelaxForReadOnlyGroup=32]="WriteCheckRelaxForReadOnlyGroup",e[e.ReadWrite=3]="ReadWrite",e[e.ReadWriteCheckRelaxForReadOnlyGroup=35]="ReadWriteCheckRelaxForReadOnlyGroup",e[e.ReadReshare=5]="ReadReshare",e[e.All=7]="All"})(t=e.Permissions||(e.Permissions={}))})(t=e.contracts||(e.contracts={}))})(t=e.permissions||(e.permissions={}))})(powerbi||(powerbi={})),angular.module("powerbi.permissions").run(["$templateCache",function(e){e.put("components/permissionCenterHome/permissionCenterHomeView.html",'<div class="permissionCenter permissionCenterHome flexbox"><section class="permissionCenterHeader item-auto"><div localize="PermissionCenter_HomeHeader"></div></section><section class="permissionCenterBody item-fill"><section class="permissionTableAction"><div class="searchInput" localize-tooltip="SearchBox_Text"><i class="glyphicon pbi-glyph-search glyph-small searchIconLocation"></i> <input type="text" placeholder="{{::$ctrl.searchInputPlaceholder}}" ng-model="$ctrl.searchTerm"/></div><div class="right paddingTop"><div class="showingItemCount" localize="PermissionCenter_ShowingItemCount" localize-fragments><span fragment-index="0" ng-bind="filtered.length"></span></div><select-artifact-filter selected-type="$ctrl.typeFilter" on-select-type="$ctrl.selectType" class="textCapitalize"></select-artifact-filter></div></section><section class="permissionTable"><table pbi-table pbi-table-config="$ctrl.tableConfig"><tr ng-repeat="artifact in $ctrl.tableConfig.filteredData | filter: { displayName: $ctrl.searchTerm } as filtered" ng-hide="$ctrl.shouldHide(artifact)"><td localized-header="PermissionCenter_Table_Header_Name" sort-by="displayName" class="permissionArtifactAction nameColumn" ng-click="$ctrl.openPermissionDetails(artifact)"><span class="contentDisplayName trimmedTextWithEllipsis"><span ng-switch="artifact.type"><i ng-switch-when="1" class="glyphicon pbi-glyph-gauge glyph-small"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-barchart glyph-small"></i><i ng-switch-when="3" class="glyphicon pbi-glyph-database glyph-small"></i><i ng-switch-when="4" class="glyphicon pbi-glyph-excel glyph-small"></i></span><span ng-bind="artifact.displayName"></span></span></td><td localized-header="PermissionCenter_Table_Header_Type" ng-bind="artifact.typeToString" sort-by="typeToString"></td><td localized-header="PermissionCenter_Table_Header_RelatedContent" sort-by="related.length"><div localize="PermissionCenter_Table_RelatedCount" localize-fragments><span fragment-index="0" ng-bind="artifact.related.length"></span></div></td><td localized-header="PermissionCenter_Table_Header_Members" sort-by="sharedWithCount"><div localize="PermissionCenter_Table_MemberCount" localize-fragments><span fragment-index="0" ng-bind="artifact.sharedWithCount"></span></div></td><td localized-header="PermissionCenter_Table_Header_Access" class="permissionArtifactAction"><div localize="PermissionCenter_Table_RemoveAll" ng-click="$ctrl.removeAllMembers(artifact)"></div></td></tr></table><div ng-show="$ctrl.tableConfig.data.length === 0" class="showNoContentText"><span localize="PermissionCenter_NoContent"></span></div></section></section></div>'),e.put("components/permissionDeleteModalDialog/permissionDeleteModalDialog.html",'<div class="removeAccessModal"><div class="removeDialogContentFrame"><div class="textContent"><span ng-bind="$ctrl.getModalDialogContextInfo($ctrl.activePermissionArtifact)"></span></div><div class="pbi-input" ng-click="$ctrl.toggleArtifact($ctrl.activePermissionArtifact)"> <input type="checkbox" ng-checked="$ctrl.isArtifactSlected($ctrl.activePermissionArtifact)"/><label class="relatedItemName trimmedTextWithEllipsis" ng-bind="$ctrl.getArtifactDisplayName($ctrl.activePermissionArtifact)"></label></div><div ng-repeat="related in $ctrl.activePermissionArtifact.related" class="floatLeft fullWidth"><div class="pbi-input" ng-click="$ctrl.toggleArtifact(related)"> <input type="checkbox" ng-checked="$ctrl.isArtifactSlected(related)"/><label class="relatedItemName trimmedTextWithEllipsis" ng-bind="$ctrl.getArtifactDisplayName(related)"></label><pbi-icon name="warning" size="small" class="ng-isolate-scope modalWarningIcon" ng-show="$ctrl.shouldShowWarningForRelatedContent(related)"><i class="glyphicon pbi-glyph-warning glyph-small floatLeft"></i></pbi-icon></div><div ng-show="$ctrl.shouldShowWarningForRelatedContent(related) && related.selected" class="warningContent floatLeft"><div class="label-xsmall fontBold"><i ng-show="$ctrl.shouldShowWarningForRelatedContent(related)" class="glyphicon pbi-glyph-warning glyph-small floatLeft"></i><span class="floatLeft warningTextLayout" ng-bind="$ctrl.getRelatedArtifactDisplayName(related)"></span></div></div></div></div></div>'),e.put("components/permissionDetails/permissionDetailsView.html",'<div class="permissionCenter permissionDetails flexbox"><span class="centeredSpinner" ng-show="!$ctrl.isLoaded()"><spinner modern></spinner></span><section class="permissionCenterHeader item-auto"><div class="dashboardAppBar appBar"><div class="appBarSection left"><ul><li class="label breadcrumbLabel"><div localize="PermissionCenter_HomeHeader" class="permissionHomeIndex" ng-click="$ctrl.navigateToPermissionCenterHome()"></div></li><li class="label breadcrumbLabel"><span localize="BreadCrumb_Separator"></span></li><li class="label textCapitalize fontWeightBold" ng-bind="$ctrl.activeArtifactDisplayName"></li><li ng-if="::$ctrl.activePermissionArtifact.type === 1" class="sharingSection" ng-click="$ctrl.shareDashboard()"><pbi-icon name="share" size="small"></pbi-icon><span localize="PermissionCenter_ShareButtonText"></span></li></ul></div></div></section><section class="permissionCenterBody item-fill" ng-show="$ctrl.isLoaded()"><section class="permissionSidePane"><div class="permissionSidePaneTitle label-xl"><span ng-switch="$ctrl.activePermissionArtifact.type" class="permissionSidePaneTitleIcon"><i ng-switch-when="1" class="glyphicon pbi-glyph-gauge glyph-regular"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-barchart glyph-regular"></i><i ng-switch-when="3" class="glyphicon pbi-glyph-database glyph-regular"></i><i ng-switch-when="4" class="glyphicon pbi-glyph-excel glyph-regular"></i></span><div ng-bind="$ctrl.activePermissionArtifact.displayName" ng-bind-attr="{title: $ctrl.activePermissionArtifact.displayName}" class="permissionSidePaneTitleText label-xxl trimmedTextWithEllipsis" localize-tooltip></div></div><div class="permissionSidePaneContent" ng-show="$ctrl.activePermissionArtifact.related.length> 0"><div localize="PermissionCenter_RelatedContent" class="subContentTitle"></div><div class="permissionSidePaneRelatedList"><div ng-repeat="related in $ctrl.activePermissionArtifact.related" class="permissionSidePaneRelatedItem"><span ng-switch="related.type" class="relatedNameIcon"><i ng-switch-when="1" class="glyphicon pbi-glyph-gauge glyph-small"></i><i ng-switch-when="2" class="glyphicon pbi-glyph-barchart glyph-small"></i><i ng-switch-when="3" class="glyphicon pbi-glyph-database glyph-small"></i><i ng-switch-when="4" class="glyphicon pbi-glyph-excel glyph-small"></i></span><div class="relatedItemName trimmedTextWithEllipsis" ng-bind="related.displayName" ng-bind-attr="{title: related.displayName}" ng-click="$ctrl.openRelatedArtifactDetails(related)"></div></div></div></div></section><section class="permissionContent"><section class="permissionTableAction"><div class="searchInput" localize-tooltip="SearchBox_Text"><i class="glyphicon pbi-glyph-search glyph-small"></i> <input type="text" placeholder="{{::$ctrl.searchInputPlaceholder}}" ng-model="$ctrl.searchTerm"/></div></section><section class="permissionTableAction"><div class="selectAllCheckbox"><pbi-checkbox label="member" ng-model="$ctrl.allSelected" ng-change="$ctrl.toggleSelectAll()"></pbi-checkbox></div> <button class="removeAllButton noBackground" ng-click="$ctrl.batchRemoveMember()" ng-disabled="!$ctrl.isSelected()"><i class="glyphicon pbi-glyph-delete glyph-small"></i><span localize="PermissionCenter_Remove" class="label-med"></span></button> <button class="moreDropdown noBackground" dropdown-menu dropdown-class="moreDropdownButton" dropdown-dark-theme="false" dropdown-items="$ctrl.moreDropdownItem" dropdown-orientation="vertical" dropdown-on-item-selected="$ctrl.onMoreDropdownSelected(selected, $ctrl.tableConfig.filteredData)" ng-disabled="!$ctrl.isSelected()"><span localize="PermissionCenter_More" class="label-med"></span><i class="paddingLeft glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></button><div class="right showItemPostion"><div class="showingItemCount" localize="PermissionCenter_Table_MemberCount" localize-fragments><span fragment-index="0" ng-bind="filtered.length"></span></div></div></section><section class="permissionTable"><table pbi-table pbi-table-config="$ctrl.tableConfig"><tr ng-repeat="member in $ctrl.tableConfig.filteredData | filter: { displayName: $ctrl.searchTerm } as filtered"><td localized-header="PermissionCenter_Table_Header_Name" sort-by="displayName" class="memberName nameColumn"><pbi-checkbox ng-model="member.selected" class="memberSelector" label="member" ng-disabled="$ctrl.isOwner(member)"></pbi-checkbox><span ng-bind="member.displayName" class="memberDisplayName trimmedTextWithEllipsis"></span><i class="glyphicon pbi-glyph-delete glyph-small mouseOverShow" ng-hide="$ctrl.isOwner(member)" ng-click="$ctrl.removeMember(member)"></i></td><td localized-header="PermissionCenter_Table_Header_EmailAddress" sort-by="email" ng-bind="member.email"></td><td localized-header="PermissionCenter_Table_Header_MemberAccess" class="memberAccessColumn"><span ng-switch="member.permission"><span ng-switch-when="1" localize="PermissionCenter_ReadOnly"></span><span ng-switch-when="5" localize="PermissionCenter_ReadAndReshare"></span><span ng-switch-when="7" localize="PermissionCenter_ReadEditAndReshare"></span></span> <button class="options" ng-hide="$ctrl.isOwner(member)" dropdown-menu dropdown-class="optionDropdownButton" dropdown-dark-theme="false" dropdown-items="$ctrl.memberAccessMenuItem" dropdown-orientation="vertical" dropdown-on-item-selected="$ctrl.onMemberAccessMenuItemSelected(selected, member, $ctrl.tableConfig.filteredData)"><i class="glyphicon moreIcon pbi-glyph-more glyph-small"></i></button></td></tr></table><div ng-show="$ctrl.activePermissionArtifact.members.length === 0" class="showNoMemberText"> <span>No member yet.</span></div></section></section></section></div>')}]);;var powerbi;!(function(i){var t;!(function(i){var t;!(function(i){i.userNotificationsInfoService="userNotificationsInfoService"})(t=i.constants||(i.constants={}))})(t=i.userNotifications||(i.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(i){var t;!(function(t){angular.module("powerbi.userNotifications",[]).factory("userNotificationHttp",[function(){return i.userNotifications.createUserNotificationHttpService()}]).factory("userNotificationInfo",["userNotificationHttp","promiseFactory","telemetryService","$window","$interval","asyncFeatureSwitchService","syncService","userInfo","$timeout",function(t,e,o,n,a,r,s,c,f){return i.userNotifications.createUserNotificationInfoService({userNotificationHttpService:t,promiseFactory:e,telemetryService:o,intervalService:a,asyncFeatureSwitchService:r,syncService:s,userInfo:c,timeout:f},!0)}]).factory("userNotificationTileFilterService",["userNotificationInfo",function(t){return i.userNotifications.createUserNotificationTileFilterService(t)}])})(t=i.userNotifications||(i.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(i){var t;!(function(i){var t;!(function(i){var t;!(function(i){i[i.NewFeatureProductMessage=0]="NewFeatureProductMessage",i[i.DashboardSharing=2]="DashboardSharing",i[i.DashboardAddedToGroup=3]="DashboardAddedToGroup",i[i.Trial=5]="Trial",i[i.DataDrivenAlert=6]="DataDrivenAlert",i[i.DynamicMessage=999]="DynamicMessage"})(t=i.NotificationCategory||(i.NotificationCategory={}));var e;!(function(i){i[i.DashboardContentPackNewVersion=0]="DashboardContentPackNewVersion",i[i.UsersNotifications_SharedDashboard=1]="UsersNotifications_SharedDashboard",i[i.ExtendTrial_TrialExpired=2]="ExtendTrial_TrialExpired",i[i.UsersNotifications_TrialRunsOutInLessThanADay=3]="UsersNotifications_TrialRunsOutInLessThanADay",i[i.UsersNotifications_TrialRunningOut=4]="UsersNotifications_TrialRunningOut",i[i.UsersNotifications_TitleTrialExpired=5]="UsersNotifications_TitleTrialExpired",i[i.UsersNotifications_UserName=6]="UsersNotifications_UserName",i[i.UsersNotifications_GoToApp=7]="UsersNotifications_GoToApp",i[i.UsersNotifications_GoToDashboard=8]="UsersNotifications_GoToDashboard",i[i.UsersNotifications_TrialRunsOutInOneDay=9]="UsersNotifications_TrialRunsOutInOneDay",i[i.UsersNotifications_TitleTrialRunsOutInOneDay=10]="UsersNotifications_TitleTrialRunsOutInOneDay",i[i.UsersNotifications_TitleTrialRunsOutInLessThanADay=11]="UsersNotifications_TitleTrialRunsOutInLessThanADay",i[i.UsersNotifications_TitleTrialRunningOut=12]="UsersNotifications_TitleTrialRunningOut",i[i.UsersNotifications_RequestExtensionLinkText=13]="UsersNotifications_RequestExtensionLinkText",i[i.UsersNotifications_DataDrivenAlert=14]="UsersNotifications_DataDrivenAlert",i[i.UsersNotifications_GroupName=15]="UsersNotifications_GroupName",i[i.UsersNotifications_NewDashboard=16]="UsersNotifications_NewDashboard",i[i.UsersNotifications_TileName=17]="UsersNotifications_TileName",i[i.UsersNotifications_DataDrivenDown=18]="UsersNotifications_DataDrivenDown",i[i.UsersNotifications_DataDrivenUp=19]="UsersNotifications_DataDrivenUp",i[i.UsersNotifications_GoToTile=20]="UsersNotifications_GoToTile",i[i.UsersNotifications_DatasetSettingChangeTitle=21]="UsersNotifications_DatasetSettingChangeTitle",i[i.UsersNotifications_DatasetInGroupWorkspaceSettingChangeMessage=22]="UsersNotifications_DatasetInGroupWorkspaceSettingChangeMessage",i[i.UsersNotifications_DatasetInMyWorkspaceSettingChangeMessage=23]="UsersNotifications_DatasetInMyWorkspaceSettingChangeMessage",i[i.UsersNotifications_LearnMore=24]="UsersNotifications_LearnMore",i[i.UsersNotifications_AlertTitle=1e3]="UsersNotifications_AlertTitle",i[i.UsersNotifications_AlertExceeded=1001]="UsersNotifications_AlertExceeded",i[i.UsersNotifications_AlertWentBelow=1002]="UsersNotifications_AlertWentBelow",i[i.UsersNotifications_AlertAction=1003]="UsersNotifications_AlertAction",i[i.UsersNotifications_AlertExceededNoTileName=1004]="UsersNotifications_AlertExceededNoTileName",i[i.UsersNotifications_AlertWentBelowNoTileName=1005]="UsersNotifications_AlertWentBelowNoTileName"})(e=i.NotificationResource||(i.NotificationResource={}));var o;!(function(i){i[i.DismissAll=0]="DismissAll",i[i.Dismiss=1]="Dismiss",i[i.SeenAll=2]="SeenAll",i[i.Seen=3]="Seen"})(o=i.UserNotificationsStatus||(i.UserNotificationsStatus={}))})(t=i.contracts||(i.contracts={}))})(t=i.userNotifications||(i.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(i){var t;!(function(t){var e;!(function(t){var e=jsCommon.DateExtensions,o=i.common.utils.DateFormatter,n=(function(){function t(i,t){this.contract=i,this.localizationService=t,i.message&&(i.message.title&&(this.title=i.message.title.text||this.getLocalizedValue(i.message.title)),i.message.message&&(this.description=i.message.message.text||this.getLocalizedValue(i.message.message)),this.image=i.message.image);var n=i.createdTime;this.formattedDate=n?o.getPrettyRelativeDate(e.parseUtcDate(n),this.localizationService):"",this.seen=i.seen,i.action&&(this.actionText=i.action.resource.text?i.action.resource.text:this.getLocalizedValue(i.action.resource),this.actionPath=i.action.path,this.actionType=i.action.actionType)}return t.prototype.getLocalizedValue=function(t){var o=i.userNotifications.contracts.NotificationResource[t.displayTextResource];if(o&&t.values&&t.values.length>0){for(var n=[],a=0,r=t.values;a<r.length;a++){var s=r[a];switch(s.NotificationValueType){case 2:n.push(this.localizationService.formatValue(e.parseUtcDate(s.value)));break;case 1:var c=parseFloat(s.value);if(s.Format){var f=i.formattingService.formatValue(c,s.Format);n.push(this.localizationService.formatValue(f))}else n.push(this.localizationService.formatValue(s.value));break;default:n.push(this.localizationService.formatValue(s.value))}}return this.localizationService.format(o,n)}return this.localizationService.get(o)},t})();t.UserNotificationModel=n})(e=t.models||(t.models={}))})(t=i.userNotifications||(i.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(i){var t;!(function(t){function e(){return new o}t.createUserNotificationHttpService=e;var o=(function(){function t(){}return t.prototype.getActiveNotification=function(t,e,o){var n=i.common.httpService.powerbiRequestOptions(t,"LoadMoreNotifications"),a="metadata/notifications?take="+e;return o&&(a=a+"&skip="+o),i.common.httpService.get(a,n)},t.prototype.getActiveNotificationSummary=function(t,e){var o=i.common.httpService.powerbiRequestOptions(t,"GetUserNotificationsSummary");return i.common.httpService.get("metadata/notifications/summary?take="+e,o)},t.prototype.updateNotificationStatus=function(t,e,o){var n;return n=o?i.common.httpService.powerbiRequestOptions(o,"UpdateUserNotificationsStatus"):i.common.httpService.powerbiRequestOptions(),i.common.httpService.put("metadata/notifications/"+t+"/action/"+e,null,n)},t.prototype.markNotificationsSeen=function(t,e){var o;o=e?i.common.httpService.powerbiRequestOptions(e,"UpdateUserNotificationsStatus"):i.common.httpService.powerbiRequestOptions();var n={ids:t};return i.common.httpService.put("metadata/notifications/action/"+i.userNotifications.contracts.UserNotificationsStatus.Seen+"/collections",n,o)},t})()})(t=i.userNotifications||(i.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(i){var t;!(function(t){function e(i,t,e){return o||(o=new s(i,t,e)),o}var o;t.createUserNotificationInfoService=e;var n=100,a=6e5,r=6e3,s=(function(){function e(i,t,e){var o=this;this.notificationsUpdatedListeners=[],this.clientNotificationId=0,this.services=i,t&&!e&&(this.userNotifications={totalCount:0,unseenCount:0,notifications:[]},i.timeout((function(){o.initialize()}),r))}return e.prototype.getNextPageData=function(t){var e=this;t||(t=n);var o=this.services.telemetryService.startEvent(i.telemetry.UserNotificationsLoadMoreNotifications),a=this.userNotifications.notifications[this.userNotifications.notifications.length-1].id;this.services.userNotificationHttpService.getActiveNotification(o.event,t,a).then((function(i){e.userNotifications.notifications=e.userNotifications.notifications.concat(e.filterNotSupportedNotifications(i.data)),e.notifyNotificationsUpdated(),o.resolve()}),(function(i){o.reject()}))},e.prototype.registerNotificationsUpdatedListener=function(i){this.notificationsUpdatedListeners.push(i)},e.prototype.updateLastSeenDate=function(){if(this.userNotifications){this.userNotifications.unseenCount=0;var i=this.getLatestNotificationForServer(),e=i&&!i.seen;this.userNotifications.notifications.forEach((function(i){i.seen=!0})),this.notifyNotificationsUpdated(),e&&this.services.userNotificationHttpService.updateNotificationStatus(i.id,t.contracts.UserNotificationsStatus.SeenAll).then((function(i){}),(function(i){}))}},e.prototype.updateSeenNotifications=function(i){this.userNotifications&&(this.userNotifications.unseenCount-=i.length,this.userNotifications.notifications.forEach((function(t){_.contains(i,t.id)&&(t.seen=!0)})),this.notifyNotificationsUpdated(),this.services.userNotificationHttpService.markNotificationsSeen(i))},e.prototype.dismissNotification=function(e,o){if(this.userNotifications.totalCount=this.userNotifications.totalCount-1,this.userNotifications.notifications=_.filter(this.userNotifications.notifications,(function(i){return i.id!==e.id})),e.seen||(this.userNotifications.unseenCount=this.userNotifications.unseenCount-1),this.notifyNotificationsUpdated(),!o&&e.id>0){var n=this.services.telemetryService.startEvent(i.telemetry.UserNotificationsDismissNotification);this.services.userNotificationHttpService.updateNotificationStatus(e.id,t.contracts.UserNotificationsStatus.Dismiss,n.event).then((function(i){n.resolve()}),(function(i){n.reject()}))}},e.prototype.dismissAll=function(){if(this.userNotifications&&this.userNotifications.notifications.length>0){var e=this.getLatestNotificationForServer();if(this.userNotifications.totalCount=0,this.userNotifications.unseenCount=0,this.userNotifications.notifications=[],this.notifyNotificationsUpdated(),e){var o=this.services.telemetryService.startEvent(i.telemetry.UserNotificationsDismissAllNotifications);this.services.userNotificationHttpService.updateNotificationStatus(e.id,t.contracts.UserNotificationsStatus.DismissAll,o.event).then((function(i){o.resolve()}),(function(i){o.reject()}))}}},e.prototype.onNotificationAdded=function(){this.getActiveNotification(n)},e.prototype.onNotificationDismiss=function(i){var t=_.find(this.userNotifications.notifications,(function(t){return t.id===i}));t&&this.dismissNotification(t,!0)},e.prototype.onNotificationSeen=function(i){var t=this,e=!1;this.userNotifications.notifications.forEach((function(o){o.id<=i&&o.id>0&&!o.seen&&(o.seen=!0,t.userNotifications.unseenCount=t.userNotifications.unseenCount-1,e=!0)})),e&&this.notifyNotificationsUpdated()},e.prototype.onNotificationDismissAll=function(){this.userNotifications.totalCount>0&&this.getActiveNotification(n)},e.prototype.loadIcon=function(i){if(!i.iconUrl&&i.message.image&&i.message.image.imagePath)switch(i.message.image.imageType){case 0:this.services.userInfo.findOrGetUserPhoto(i.message.image.imagePath).then((function(t){i.iconUrl=t}));break;case 1:this.services.userInfo.findOrGetGroupPhoto(i.message.image.imagePath).then((function(t){i.iconUrl=t}))}},e.prototype.addClientNotification=function(i){i&&(i.id=this.clientNotificationId--,i.seen=!1,this.userNotifications&&(this.userNotifications.totalCount++,this.userNotifications.unseenCount++,this.userNotifications.notifications=[i].concat(this.userNotifications.notifications),this.notifyNotificationsUpdated()))},e.prototype.getHighestNotificationLevel=function(i){return!this.userNotifications||_.isEmpty(this.userNotifications.notifications)?1:_.max(i,(function(i){return i.notificationLevel})).notificationLevel},e.prototype.initialize=function(){var i=this;this.getActiveNotification(n),this.services.syncService.addNotificationsRefreshListener(this),this.services.intervalService((function(){i.getActiveNotification(n)}),a)},e.prototype.getLatestNotificationForServer=function(){var i=_.find(this.userNotifications.notifications,(function(i){return i.id>0&&!i.seen}));return i},e.prototype.mergeNotifications=function(i){if(i){this.userNotifications.totalCount=i.totalCount,this.userNotifications.unseenCount=i.unseenCount;var t=_.filter(this.userNotifications.notifications,(function(i){return i.id<=0}));if(t&&t.length>0){this.userNotifications.totalCount=i.totalCount+t.length;var e=_.filter(t,(function(i){return!i.seen}));e&&e.length>0&&(this.userNotifications.unseenCount=i.unseenCount+e.length)}var o=[],n=_.map(this.userNotifications.notifications,(function(i){return i.id}));o=_.filter(i.notifications,(function(i){return n.indexOf(i.id)<0})),o.length>0&&(t&&t.length>0?this.userNotifications.notifications=t.concat(o).concat(_.filter(this.userNotifications.notifications,(function(i){return i.id>0}))):this.userNotifications.notifications=o.concat(this.userNotifications.notifications))}},e.prototype.notifyNotificationsUpdated=function(){this.notificationsUpdatedListeners.forEach((function(i){i()}))},e.prototype.getActiveNotification=function(t){var e=this;void 0===t&&(t=n);var o=this.services.telemetryService.startEvent(i.telemetry.UserNotificationsGetNotificationsSummary);this.services.userNotificationHttpService.getActiveNotificationSummary(o.event,t).then((function(i){var t=e.filterNotSupportedUserNotifications(i.data);e.userNotifications&&e.userNotifications.notifications?e.mergeNotifications(t):e.userNotifications=t,e.notifyNotificationsUpdated(),o.resolve()}),(function(i){o.reject()}))},e.prototype.filterNotSupportedUserNotifications=function(i){if(i&&i.totalCount>0){i.notifications=this.filterNotSupportedNotifications(i.notifications);var t=_.filter(i.notifications,(function(i){return!i.seen}));i.unseenCount=t?t.length:0}return i},e.prototype.filterNotSupportedNotifications=function(i){return _.filter(i,(function(i){return t.contracts.NotificationCategory[i.notificationCategory]}))},e})()})(t=i.userNotifications||(i.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(i){var t;!(function(i){function t(i){return new e(i)}i.createUserNotificationTileFilterService=t;var e=(function(){function i(i){this.userNotificationInfoService=i}return i.prototype.filterNotifications=function(i,t){if(_.isEmpty(i))return[];var e=t?t:this.tileId;return e?_.filter(i,(function(i){var t=i.message.filterProperties?i.message.filterProperties.TileId:null;if(!t)return!1;var o=parseInt(t,10);return(2===i.action.actionType||3===i.action.actionType)&&o===e})):i},i})()})(t=i.userNotifications||(i.userNotifications={}))})(powerbi||(powerbi={}));var powerbi;!(function(i){var t;!(function(t){t.UserNotificationsGetNotificationsSummary=function(t,e,o,n,a,r,s,c,f,u,d,l){void 0===e&&(e=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===f&&(f=!1),void 0===u&&(u=void 0),void 0===d&&(d=!1),void 0===l&&(l=!1);var v={parentId:t,isError:e,errorSource:o,errorCode:n,errorMessage:a,activityName:r,activityId:s,isDebug:c,isCancelled:f,pingLatency:u,isAppInactive:d,isInCapacity:l},p={name:"PBI.UserNotifications.GetNotificationsSummary",category:i.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:v.parentId},e=typeof v.isError;("boolean"===e&&!!v.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isError=v.isError);var e=typeof v.errorSource;("boolean"===e&&!!v.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorSource=i.telemetry.ErrorSource[v.errorSource]);var e=typeof v.errorCode;("boolean"===e&&!!v.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorCode=v.errorCode);var e=typeof v.errorMessage;("boolean"===e&&!!v.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorMessage=v.errorMessage);var e=typeof v.activityName;("boolean"===e&&!!v.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(t.activityName=v.activityName);var e=typeof v.activityId;("boolean"===e&&!!v.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(t.activityId=v.activityId);var e=typeof v.isDebug;("boolean"===e&&!!v.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isDebug=v.isDebug);var e=typeof v.isCancelled;("boolean"===e&&!!v.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isCancelled=v.isCancelled);var e=typeof v.pingLatency;("boolean"===e&&!!v.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(t.pingLatency=v.pingLatency);var e=typeof v.isAppInactive;("boolean"===e&&!!v.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isAppInactive=v.isAppInactive);var e=typeof v.isInCapacity;return("boolean"===e&&!!v.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isInCapacity=v.isInCapacity),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof i.telemetry.UserNotificationsGetNotificationsSummaryLoggers&&(p.loggers=i.telemetry.UserNotificationsGetNotificationsSummaryLoggers),p},t.UserNotificationsLoadMoreNotifications=function(t,e,o,n,a,r,s,c,f,u,d,l){void 0===e&&(e=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===f&&(f=!1),void 0===u&&(u=void 0),void 0===d&&(d=!1),void 0===l&&(l=!1);var v={parentId:t,isError:e,errorSource:o,errorCode:n,errorMessage:a,activityName:r,activityId:s,isDebug:c,isCancelled:f,pingLatency:u,isAppInactive:d,isInCapacity:l},p={name:"PBI.UserNotifications.LoadMoreNotifications",category:i.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:v.parentId},e=typeof v.isError;("boolean"===e&&!!v.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isError=v.isError);var e=typeof v.errorSource;("boolean"===e&&!!v.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorSource=i.telemetry.ErrorSource[v.errorSource]);var e=typeof v.errorCode;("boolean"===e&&!!v.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorCode=v.errorCode);var e=typeof v.errorMessage;("boolean"===e&&!!v.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorMessage=v.errorMessage);var e=typeof v.activityName;("boolean"===e&&!!v.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(t.activityName=v.activityName);var e=typeof v.activityId;("boolean"===e&&!!v.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(t.activityId=v.activityId);var e=typeof v.isDebug;("boolean"===e&&!!v.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isDebug=v.isDebug);var e=typeof v.isCancelled;("boolean"===e&&!!v.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isCancelled=v.isCancelled);var e=typeof v.pingLatency;("boolean"===e&&!!v.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(t.pingLatency=v.pingLatency);var e=typeof v.isAppInactive;("boolean"===e&&!!v.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isAppInactive=v.isAppInactive);var e=typeof v.isInCapacity;return("boolean"===e&&!!v.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isInCapacity=v.isInCapacity),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof i.telemetry.UserNotificationsLoadMoreNotificationsLoggers&&(p.loggers=i.telemetry.UserNotificationsLoadMoreNotificationsLoggers),p},t.UserNotificationsDismissNotification=function(t,e,o,n,a,r,s,c,f,u,d,l){void 0===e&&(e=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===f&&(f=!1),void 0===u&&(u=void 0),void 0===d&&(d=!1),void 0===l&&(l=!1);var v={parentId:t,isError:e,errorSource:o,errorCode:n,errorMessage:a,activityName:r,activityId:s,isDebug:c,isCancelled:f,pingLatency:u,isAppInactive:d,isInCapacity:l},p={name:"PBI.UserNotifications.DismissNotification",category:i.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:v.parentId},e=typeof v.isError;("boolean"===e&&!!v.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isError=v.isError);var e=typeof v.errorSource;("boolean"===e&&!!v.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorSource=i.telemetry.ErrorSource[v.errorSource]);var e=typeof v.errorCode;("boolean"===e&&!!v.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorCode=v.errorCode);var e=typeof v.errorMessage;("boolean"===e&&!!v.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorMessage=v.errorMessage);var e=typeof v.activityName;("boolean"===e&&!!v.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(t.activityName=v.activityName);var e=typeof v.activityId;("boolean"===e&&!!v.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(t.activityId=v.activityId);var e=typeof v.isDebug;("boolean"===e&&!!v.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isDebug=v.isDebug);var e=typeof v.isCancelled;("boolean"===e&&!!v.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isCancelled=v.isCancelled);var e=typeof v.pingLatency;("boolean"===e&&!!v.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(t.pingLatency=v.pingLatency);var e=typeof v.isAppInactive;("boolean"===e&&!!v.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isAppInactive=v.isAppInactive);var e=typeof v.isInCapacity;return("boolean"===e&&!!v.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isInCapacity=v.isInCapacity),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof i.telemetry.UserNotificationsDismissNotificationLoggers&&(p.loggers=i.telemetry.UserNotificationsDismissNotificationLoggers),p},t.UserNotificationsDismissAllNotifications=function(t,e,o,n,a,r,s,c,f,u,d,l){void 0===e&&(e=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===r&&(r=void 0),void 0===s&&(s=void 0),void 0===c&&(c=!1),void 0===f&&(f=!1),void 0===u&&(u=void 0),void 0===d&&(d=!1),void 0===l&&(l=!1);var v={parentId:t,isError:e,errorSource:o,errorCode:n,errorMessage:a,activityName:r,activityId:s,isDebug:c,isCancelled:f,pingLatency:u,isAppInactive:d,isInCapacity:l},p={name:"PBI.UserNotifications.DismissAllNotifications",category:i.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:v.parentId},e=typeof v.isError;("boolean"===e&&!!v.isError!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isError=v.isError);var e=typeof v.errorSource;("boolean"===e&&!!v.errorSource!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorSource=i.telemetry.ErrorSource[v.errorSource]);var e=typeof v.errorCode;("boolean"===e&&!!v.errorCode!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorCode=v.errorCode);var e=typeof v.errorMessage;("boolean"===e&&!!v.errorMessage!=!1||"undefined"!==e&&"boolean"!==e)&&(t.errorMessage=v.errorMessage);var e=typeof v.activityName;("boolean"===e&&!!v.activityName!=!1||"undefined"!==e&&"boolean"!==e)&&(t.activityName=v.activityName);var e=typeof v.activityId;("boolean"===e&&!!v.activityId!=!1||"undefined"!==e&&"boolean"!==e)&&(t.activityId=v.activityId);var e=typeof v.isDebug;("boolean"===e&&!!v.isDebug!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isDebug=v.isDebug);var e=typeof v.isCancelled;("boolean"===e&&!!v.isCancelled!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isCancelled=v.isCancelled);var e=typeof v.pingLatency;("boolean"===e&&!!v.pingLatency!=!1||"undefined"!==e&&"boolean"!==e)&&(t.pingLatency=v.pingLatency);var e=typeof v.isAppInactive;("boolean"===e&&!!v.isAppInactive!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isAppInactive=v.isAppInactive);var e=typeof v.isInCapacity;return("boolean"===e&&!!v.isInCapacity!=!1||"undefined"!==e&&"boolean"!==e)&&(t.isInCapacity=v.isInCapacity),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof i.telemetry.UserNotificationsDismissAllNotificationsLoggers&&(p.loggers=i.telemetry.UserNotificationsDismissAllNotificationsLoggers),p}})(t=i.telemetry||(i.telemetry={}))})(powerbi||(powerbi={}));

window.parseTimeMarkers['powerbiportal.addons.bundle.min.js'].end = Date.now();
