
window.parseTimeMarkers = window.parseTimeMarkers || {};
window.parseTimeMarkers['powerbiportal.explore.bundle.min.js'] = {
    nominalStart: Date.now(),
    start: Date.now()
};
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=t.get("Embed_Updated"),i=r+" "+e.lastRefreshTime,n={snapshotId:e.objectId,reportId:e.reportId,name:e.snapshotName,date:i,resourceUri:e.resourceAbsoluteUri,culture:e.snapshotCulture,size:{height:e.snapshotHeight,width:e.snapshotWidth},type:e.type,metadata:e.metadata,hostUri:e.hostUri,embedType:e.embedType,disabled:e.disabled,createDate:e.createDate};return n}function r(e){return{snapshotEmbedResource:e.snapshotEmbedResource,options:{name:e.options.name,culture:e.options.culture,version:e.options.version,type:e.options.type,size:e.options.size,reportId:e.options.reportId,metadata:e.options.metadata,embedType:e.options.embedType}}}e.convertEmbed=t,e.serializeEmbedCreationRequest=r})(t=e.EmbedSerializer||(e.EmbedSerializer={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){!(function(e){e[e.Create=0]="Create",e[e.Update=1]="Update",e[e.Delete=2]="Delete",e[e.Other=3]="Other"})(t.EditorAction||(t.EditorAction={}));t.EditorAction;!(function(e){e[e.Visual=0]="Visual",e[e.Dialog=1]="Dialog",e[e.FieldList=2]="FieldList",e[e.FieldWell=3]="FieldWell",e[e.Other=4]="Other"})(t.EditorType||(t.EditorType={}));t.EditorType;!(function(e){e[e.DAX=0]="DAX",e[e.DQLimit=1]="DQLimit",e[e.ModelAuthoring=2]="ModelAuthoring",e[e.Other=3]="Other"})(t.GroupErrorType||(t.GroupErrorType={}));t.GroupErrorType;!(function(e){e[e.List=0]="List",e[e.Bin=1]="Bin"})(t.GroupType||(t.GroupType={}));t.GroupType;!(function(e){e[e.Number=0]="Number",e[e.Year=1]="Year",e[e.Month=2]="Month",e[e.Day=3]="Day",e[e.Hour=4]="Hour",e[e.Minute=5]="Minute",e[e.Second=6]="Second"})(t.BinUnit||(t.BinUnit={}));t.BinUnit;t.EXToggleSeeData=function(t,r,i,n,a,o,s,l,u,c,p){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=void 0),void 0===p&&(p=void 0);var d={visualType:t,isEnabled:r,parentId:i,isError:n,errorSource:a,errorCode:o,errorMessage:s,activityName:l,activityId:u,isDebug:c,isCancelled:p},f={name:"PBI.EX.ToggleSeeData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={visualType:d.visualType,isEnabled:d.isEnabled,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXToggleSeeDataLoggers&&(f.loggers=e.telemetry.EXToggleSeeDataLoggers),f},t.EXGetExploration=function(t,r,i,n,a,o,s,l,u,c){void 0===i&&(i=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=void 0);var p={fromCache:t,parentId:r,isError:i,errorSource:n,errorCode:a,errorMessage:o,activityName:s,activityId:l,isDebug:u,isCancelled:c},d={name:"PBI.EX.GetExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={fromCache:p.fromCache,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXGetExplorationLoggers&&(d.loggers=e.telemetry.EXGetExplorationLoggers),d},t.EXVisualQueryGeneratorWarning=function(t,r,i,n,a,o,s,l,u,c){void 0===i&&(i=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===o&&(o=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=void 0);var p={code:t,parentId:r,isError:i,errorSource:n,errorCode:a,errorMessage:o,activityName:s,activityId:l,isDebug:u,isCancelled:c},d={name:"PBI.EX.VisualQueryGeneratorWarning",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={code:p.code,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXVisualQueryGeneratorWarningLoggers&&(d.loggers=e.telemetry.EXVisualQueryGeneratorWarningLoggers),d},t.EXGroupsGroupsAction=function(t,r,i,n,a,o,s,l,u,c,p,d,f,v,h,g,m,y,b,C){void 0===f&&(f=!1),void 0===v&&(v=void 0),void 0===h&&(h=void 0),void 0===g&&(g=void 0),void 0===m&&(m=void 0),void 0===y&&(y=void 0),void 0===b&&(b=void 0),void 0===C&&(C=void 0);var S={action:t,editor:r,dataType:i,groupCount:n,totalGroupCount:a,groupedValues:o,groupedValuesMin:s,groupedValuesMax:l,ungroupedValues:u,isOtherEnabled:c,hasGroupOnKeys:p,parentId:d,isError:f,errorSource:v,errorCode:h,errorMessage:g,activityName:m,activityId:y,isDebug:b,isCancelled:C},x={name:"PBI.EX.Groups.GroupsAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={action:e.telemetry.EditorAction[S.action],editor:e.telemetry.EditorType[S.editor],dataType:S.dataType,groupCount:S.groupCount,totalGroupCount:S.totalGroupCount,groupedValues:S.groupedValues,groupedValuesMin:S.groupedValuesMin,groupedValuesMax:S.groupedValuesMax,ungroupedValues:S.ungroupedValues,isOtherEnabled:S.isOtherEnabled,hasGroupOnKeys:S.hasGroupOnKeys,parentId:S.parentId,isError:S.isError};return"undefined"!=typeof S.errorSource&&(t.errorSource=e.telemetry.ErrorSource[S.errorSource]),"undefined"!=typeof S.errorCode&&(t.errorCode=S.errorCode),"undefined"!=typeof S.errorMessage&&(t.errorMessage=S.errorMessage),"undefined"!=typeof S.activityName&&(t.activityName=S.activityName),"undefined"!=typeof S.activityId&&(t.activityId=S.activityId),"undefined"!=typeof S.isDebug&&(t.isDebug=S.isDebug),"undefined"!=typeof S.isCancelled&&(t.isCancelled=S.isCancelled),t},info:S,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXGroupsGroupsActionLoggers&&(x.loggers=e.telemetry.EXGroupsGroupsActionLoggers),x},t.EXGroupsBinsAction=function(t,r,i,n,a,o,s,l,u,c,p,d,f,v){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===f&&(f=void 0),void 0===v&&(v=void 0);var h={action:t,editor:r,sourceDataType:i,binSize:n,binUnit:a,parentId:o,isError:s,errorSource:l,errorCode:u,errorMessage:c,activityName:p,activityId:d,isDebug:f,isCancelled:v},g={name:"PBI.EX.Groups.BinsAction",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={action:e.telemetry.EditorAction[h.action],editor:e.telemetry.EditorType[h.editor],sourceDataType:h.sourceDataType,binSize:h.binSize,binUnit:e.telemetry.BinUnit[h.binUnit],parentId:h.parentId,isError:h.isError};return"undefined"!=typeof h.errorSource&&(t.errorSource=e.telemetry.ErrorSource[h.errorSource]),"undefined"!=typeof h.errorCode&&(t.errorCode=h.errorCode),"undefined"!=typeof h.errorMessage&&(t.errorMessage=h.errorMessage),"undefined"!=typeof h.activityName&&(t.activityName=h.activityName),"undefined"!=typeof h.activityId&&(t.activityId=h.activityId),"undefined"!=typeof h.isDebug&&(t.isDebug=h.isDebug),"undefined"!=typeof h.isCancelled&&(t.isCancelled=h.isCancelled),t},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXGroupsBinsActionLoggers&&(g.loggers=e.telemetry.EXGroupsBinsActionLoggers),g},t.EXGroupsUsage=function(t,r,i,n,a,o,s,l,u,c,p,d,f,v){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===u&&(u=void 0),void 0===c&&(c=void 0),void 0===p&&(p=void 0),void 0===d&&(d=void 0),void 0===f&&(f=void 0),void 0===v&&(v=void 0);var h={visualType:t,role:r,sourceRole:i,action:n,groupType:a,parentId:o,isError:s,errorSource:l,errorCode:u,errorMessage:c,activityName:p,activityId:d,isDebug:f,isCancelled:v},g={name:"PBI.EX.Groups.Usage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={visualType:h.visualType,role:h.role,sourceRole:h.sourceRole,action:e.telemetry.EditorAction[h.action],groupType:e.telemetry.GroupType[h.groupType],parentId:h.parentId,isError:h.isError};return"undefined"!=typeof h.errorSource&&(t.errorSource=e.telemetry.ErrorSource[h.errorSource]),"undefined"!=typeof h.errorCode&&(t.errorCode=h.errorCode),"undefined"!=typeof h.errorMessage&&(t.errorMessage=h.errorMessage),"undefined"!=typeof h.activityName&&(t.activityName=h.activityName),"undefined"!=typeof h.activityId&&(t.activityId=h.activityId),"undefined"!=typeof h.isDebug&&(t.isDebug=h.isDebug),"undefined"!=typeof h.isCancelled&&(t.isCancelled=h.isCancelled),t},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXGroupsUsageLoggers&&(g.loggers=e.telemetry.EXGroupsUsageLoggers),g},t.EXGroupsError=function(t,r,i,n){var a={errorType:t,action:r,groupType:i,message:n},o={name:"PBI.EX.Groups.Error",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={errorType:e.telemetry.GroupErrorType[a.errorType],action:e.telemetry.EditorAction[a.action],groupType:e.telemetry.GroupType[a.groupType],message:a.message};return t},info:a,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXGroupsErrorLoggers&&(o.loggers=e.telemetry.EXGroupsErrorLoggers),o}})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return void 0===e&&(e=[]),i.extendWithName(i.extendWithId(e))}var i=jsCommon.ArrayExtensions,n=e.data.DataReaderUtils;t.createDataSourceArray=r;var a;!(function(e){function t(e,t){if(!_.isEmpty(e)){for(var r,i=n.findSchemas(t),a=[],o=0,s=e;o<s.length;o++){var l=s[o];if(!i||_.contains(i,l.name)){var u=n.readerType(l);if(r&&r!==u)return;r=u,a.push(l[r])}}return a}}e.referenced=t})(a=t.DataSource||(t.DataSource={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){!(function(e){e[e.Categorical=0]="Categorical",e[e.Range=1]="Range",e[e.Advanced=2]="Advanced",e[e.Passthrough=3]="Passthrough",e[e.Visual=4]="Visual",e[e.TopN=5]="TopN",e[e.Include=6]="Include",e[e.Exclude=7]="Exclude"})(e.FilterType||(e.FilterType={}));e.FilterType})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.createDisplayNameGetter;!(function(e){function t(e){return _.filter(e,(function(e){return!e.transient}))}e.objectDescriptors={background:{displayName:i("PagePropertyPane_PageBackground"),properties:{color:{displayName:i("PagePropertyPane_PageBackgroundColor"),type:{fill:{solid:{color:!0}}}},image:{type:{image:{}}},transparency:{displayName:i("Visual_Background_Transparency"),type:{numeric:!0}}}}},e.filterTransient=t})(r=t.Section||(t.Section={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.SnapshotReportType="Report",(function(e){e[e.Static=0]="Static",e[e.Interactive=1]="Interactive"})(e.EmbedType||(e.EmbedType={}));e.EmbedType})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.DataViewObjectDefinitions;!(function(e){function t(e){return!!e&&e.show===!1}e.isHidden=t})(r=t.VisualTitle||(t.VisualTitle={}));var n;!(function(t){function r(e,r){var i=_.clone(t.CommonObjectDescriptors);if(!r)return i;var n=r.getStylePresets(e);if(!n||!n.presets)return i;var a=r.getEnumFromStylePresets(n);return i.stylePresetName={displayName:n.sectionTitle,properties:{name:{displayName:n.sliceTitle,type:{enumeration:a}}}},i}function i(e,t){if(e){var r=t.serializeVisualContainer(e);return t.deserializeVisualContainer(r,!0)}}t.CommonObjectDescriptors={title:{displayName:e.data.createDisplayNameGetter("Visual_Title"),description:e.data.createDisplayNameGetter("Visual_TitleDescription"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},text:{displayName:e.data.createDisplayNameGetter("Visual_Title_Text"),description:e.data.createDisplayNameGetter("Visual_Title_TextDescription"),type:{text:!0},suppressFormatPainterCopy:!0},fontColor:{displayName:e.data.createDisplayNameGetter("Visual_Title_FontColor"),description:e.data.createDisplayNameGetter("Visual_Title_FontColorDescription"),type:{fill:{solid:{color:!0}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Title_BackgroundColor"),description:e.data.createDisplayNameGetter("Visual_Title_BackgroundColorDescription"),type:{fill:{solid:{color:{nullable:!0}}}}},alignment:{displayName:e.data.createDisplayNameGetter("Visual_Title_Alignment"),description:e.data.createDisplayNameGetter("Visual_Title_AlignmentDescription"),type:{formatting:{alignment:!0}}},fontSize:{displayName:e.data.createDisplayNameGetter("Visual_TextSize"),description:e.data.createDisplayNameGetter("Visual_TextSizeDescription"),type:{formatting:{fontSize:!0}}}}},background:{displayName:e.data.createDisplayNameGetter("Visual_Background"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Background_Color"),description:e.data.createDisplayNameGetter("Visual_Background_ColorDescription"),type:{fill:{solid:{color:!0}}}},transparency:{displayName:e.data.createDisplayNameGetter("Visual_Background_Transparency"),description:e.data.createDisplayNameGetter("Visual_Background_TransparencyDescription"),type:{numeric:!0}}}},lockAspect:{displayName:e.data.createDisplayNameGetter("Visual_BasicShape_LockAspect"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}}}},general:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties"),properties:{x:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_X_Coordinate"),type:{numeric:!0}},y:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_Y_Coordinate"),type:{numeric:!0}},width:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_Width"),type:{numeric:!0}},height:{displayName:e.data.createDisplayNameGetter("Visual_General_Properties_Height"),type:{numeric:!0}}}},border:{displayName:e.data.createDisplayNameGetter("Visual_Border"),properties:{show:{displayName:e.data.createDisplayNameGetter("Visual_Show"),type:{bool:!0}},color:{displayName:e.data.createDisplayNameGetter("Visual_Border_Color"),type:{fill:{solid:{color:!0}}}}}}},t.getObjectDescriptors=r,t.clone=i})(n=t.VisualContainer||(t.VisualContainer={}));var a;!(function(e){function t(e){if(e){var t={visualType:e.visualType};e.stylePresetName&&(t.stylePresetName=_.cloneDeep(e.stylePresetName)),e.aspectRatio&&(t.aspectRatio=_.cloneDeep(e.aspectRatio)),e.background&&(t.background=_.cloneDeep(e.background)),e.title&&(t.title=_.cloneDeep(e.title)),e.border&&(t.border=_.cloneDeep(e.border)),e.query&&(t.query=e.query.clone()),e.objects&&(t.objects=i.clone(e.objects));var r=e.conversionSourceContext;if(r){var n={};n.visualType=r.visualType,r.query&&(n.query=r.query.clone()),t.conversionSourceContext=n}return t}}function r(e,t){if(!e||!e.getCurrentVisual)return t.resolve();var r=e.getCurrentVisual();return r?r.enumerateObjectRepetitionAsync?r.enumerateObjectRepetitionAsync():r.enumerateObjectRepetition?t.resolve(r.enumerateObjectRepetition()):t.resolve():t.resolve()}e.clone=t,e.enumerateObjectRepetition=r})(a=t.SingleVisualConfig||(t.SingleVisualConfig={}))})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){switch(e){case 0:return"Default";case 1:return"DataFilter";case 2:return"HighlightFilter";case 3:return"NoFilter"}}e.toString=t})(t=e.VisualRelationshipFilterActionUtil||(e.VisualRelationshipFilterActionUtil={}))})(t=e.contracts||(e.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=jsCommon.ArrayExtensions,i=e.data.ProjectionUtils,n=e.data.QueryProjectionCollection,a=e.data.QueryProjectionsByRole,o=e.data.transforms.plugins.KMeansClustering,s=e.data.transforms.plugins.SpatialClustering,l=e.data.SQExpr,u=e.data.SQExprBuilder,c=(function(){function e(e,t){this.defn=e,this.projections=t;for(var r in t)_.isEmpty(t[r].activeProjectionRefs)||this.ensureActiveItems(r)}return e.prototype.add=function(e,t,r){var i=r&&r.exprName,a=r&&r.index,o=this.defn.selectNameOf(e);o||(o=this.addSelect(e,i));var s=this.getRoleProjections(t);s||(s=[],this.projections[t]=new n(s));var l={queryRef:o};return null==a||a>s.length?(s.push(l),s.length-1):(s.splice(a,0,l),this.addNewQueryRefToActiveProjectionRefsIfNeeded(t,o,a),a)},e.prototype.removeExpr=function(t,r){if(r){for(var i=this.defn.select(),n=!0,a=i.length-1;a>=0;--a){var o=i[a].expr;e.areEqualIgnoringAggregate(o,t)&&(n=n&&this.removeAllProjectionsForExpr(o))}return n}return this.removeAllProjectionsForExpr(t)},e.prototype.removeProjection=function(e,t){var r=this.getRoleProjections(e);if(!r)return!1;if(t>=r.length)return!1;var i=r[t].queryRef,n=this.defn.select().withName(i).expr;r.splice(t,1);var a=this.projections[e].activeProjectionRefs;return _.pull(a,i),_.isEmpty(r)?delete this.projections[e]:a&&0===a.length&&a.push(r[0].queryRef),this.isUsed(i)||this.removeExpr(n,!1),!0},e.prototype.moveProjection=function(e,t,r,i){if(t===r)return!1;var n=this.getRoleProjections(e);if(!n||r+i>n.length)return!1;if(t<0||r<0)return!1;for(var a=n.splice(t,i),o=0;o<a.length;o++)n.splice(r+o,0,a[o]);var s=this.projections[e].activeProjectionRefs;if(s&&r<s.length){var l=_.take(n,r+1);this.projections[e].activeProjectionRefs=_.map(l,(function(e){return e.queryRef}))}return!0},e.prototype.setAggregate=function(e,t,r,i){return this.updateExpression(e,t,(function(e){return u.setAggregate(e,r)}),i)},e.prototype.removeAggregate=function(e,t,r){return this.updateExpression(e,t,(function(e){return u.removeAggregate(e)}),r)},e.prototype.setPercentOfGrandTotal=function(e,t,r){var i=this.updateExpression(e,t,(function(e){return u.setPercentOfGrandTotal(e)}),r);return i},e.prototype.removePercentOfGrandTotal=function(e,t,r){var i=this.updateExpression(e,t,(function(e){return u.removePercentOfGrandTotal(e)}),r);return i},e.prototype.orderBy=function(e){this.defn=this.defn.orderBy(e)},e.prototype.removeOrderBy=function(e){this.defn=this.defn.removeOrderBy(e)},e.prototype.removeUnusedOrderBy=function(){for(var e=this.defn,t=e.orderBy(),r=0,i=t;r<i.length;r++){var n=i[r],a=n.expr,o=e.selectNameOf(a);o||(this.defn=e.removeOrderBy(a))}},e.prototype.addTransform=function(e,t,r){for(var i={},n=this.defn.transforms(),a=0,l=n;a<l.length;a++){var c=l[a];i[c.name]=!0}var p=jsCommon.StringExtensions.findUniqueName(i,e.name),d={algorithm:e.name,name:p,input:{parameters:t},output:void 0};this.defn=this.defn.transforms(n.concat([d]));for(var f=(e.name===o.name||e.name===s.name)&&r.grouping&&r.grouping.cluster,v=0,h=e.outputRoles;v<h.length;v++){var g=h[v],m=g.name;f&&(m=r.grouping.cluster.clusteringRole),this.add(u.transformOutputRoleRef(g.algorithmRole),m,{exprName:g.columnName?g.columnName:g.algorithmRole})}return p},e.prototype.removeTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(e){return e.name===t}));if(r){for(var i=0,n=e.outputRoles;i<n.length;i++){var a=n[i];this.removeExpr(u.transformOutputRoleRef(a.algorithmRole),!1)}this.defn=this.defn.removeTransform(r)}},e.prototype.updateTransform=function(e,t){var r=_.find(this.defn.transforms(),(function(t){return t.name===e}));r&&(r.input.parameters=t)},e.prototype.clone=function(){return new e(this.defn,a.clone(this.projections))},e.prototype.ensureDrillableRoles=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.ensureActiveItems(i)}},e.prototype.ensureActiveItems=function(e){var t=this.projections[e];if(t){var r=t.all();return _.isEmpty(r)||t.activeProjectionRefs?void 0:void(t.activeProjectionRefs=[r[0].queryRef])}},e.prototype.toggleShowAll=function(e){var t=this.projections[e];t&&(t.showAll=!t.showAll)},e.prototype.roleContainsExpr=function(e,t){var r=this.projections[e],i=r&&r.all();if(_.isEmpty(i))return!1;for(var n=this.defn.select(),a=0,o=n;a<o.length;a++)for(var s=o[a],u=0,c=i;u<c.length;u++){var p=c[u];if(p.queryRef===s.name&&l.equals(t,s.expr))return!0}return!1},e.prototype.getRoleNameForExpr=function(e){var t=this.projections;for(var r in t){var i=this.tryGetExprs(r);if(i&&i.length>0)for(var n=0,a=i;n<a.length;n++){var o=a[n];if(l.equals(e,o))return r}}},e.prototype.tryGetExpr=function(e,t){var r=this.getRoleProjections(e);if(r){var n=r[t];return i.tryGetExprByProjection(this.defn,n)}},e.prototype.tryGetExprs=function(e){return i.tryGetExprs(this.defn,this.projections,e)},e.prototype.getUniqueQueryRefs=function(){var e=_.values(this.projections);return _.chain(e).map((function(e){return e.all()})).flatten(!0).map((function(e){return e.queryRef})).uniq().value()},e.prototype.currentDrillMode=function(e){var t=this.getRoleProjections(e),r=this.projections[e].activeProjectionRefs;if(!_.isEmpty(r)){if(r.length>1)return 2;if(r[0]!==t[0].queryRef)return 3}},e.prototype.addSelect=function(e,t){var r=this.defn;this.defn=r=r.addSelect(e,t);var i=r.select(),n=i.length-1;return i[n].name},e.prototype.removeAllProjectionsForExpr=function(e){var t=this.defn,r=t.selectNameOf(e);if(!r)return!1;var i=this.projections;for(var n in i){for(var a=i[n].all(),o=a.length-1;o>=0;o--){var s=a[o];if(s.queryRef===r){a.splice(o,1);var l=i[n].activeProjectionRefs;_.pull(l,r)}}0===a.length&&delete i[n]}return this.defn=t.removeSelect(e).removeOrderBy(e),!0},e.prototype.updateExpression=function(e,t,i,n){var a=this.getRoleProjections(e);if(!a||t>=a.length)return!1;var o=a[t],s=this.defn,l=o.queryRef,u=s.select(),c=r.indexWithName(u,l),p=u[c].expr,d=i(p),f=s.selectNameOf(d);return f?(o.queryRef=f,this.isUsed(l)||(this.defn=s.removeSelect(p)),!0):(this.getUsageCount(l)>1?o.queryRef=this.addSelect(d):this.defn=s.setSelectAt(c,d),!0)},e.prototype.isUsed=function(e){return this.getUsageCount(e)>0},e.prototype.getUsageCount=function(e){var t=0,r=this.projections;for(var i in r){var n=r[i].all();t+=_.filter(n,(function(t){return t.queryRef===e})).length}return t},e.prototype.getRoleProjections=function(e){var t=a.getRole(this.projections,e);if(t)return t.all()},e.prototype.addNewQueryRefToActiveProjectionRefsIfNeeded=function(e,t,r){var i=this.getRoleProjections(e),n=this.projections[e].activeProjectionRefs;n&&(n.length>1&&r<n.length?n.splice(r,0,t):1===n.length&&0===r&&i.length>1&&i[1].queryRef===n[0]&&n.splice(0,1,t))},e.areEqualIgnoringAggregate=function(e,t){return l.equals(u.removeAggregate(e),u.removeAggregate(t))},e})();t.VisualQuery=c})(r=t.contracts||(t.contracts={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.explore.contracts;!(function(e){function t(e,t,i,a){var o=r(e,i),s=n(e,i);return{added:{visualContainers:o.added,relationships:s.added},updated:{visualContainers:o.updated,relationships:s.updated},removed:{visualContainers:o.removed,relationships:s.removed},page:{page:i,ordinal:a},originalPage:{page:e,ordinal:t}}}function r(e,t){for(var r=[],i=[],n=e.visualContainers.slice(),a=0,o=t.visualContainers;a<o.length;a++){var s=o[a];if(void 0===s.id)r.push(s);else{var l=jsCommon.ArrayExtensions.findWithId(n,s.id);if(l){var u=n.indexOf(l);n.splice(u,1),jsCommon.JsonComparer.equals(l,s)||i.push(s)}else r.push(s)}}return{added:r,updated:i,removed:n}}function n(e,t){for(var r=e.relationships?e.relationships.slice():[],i=t.relationships||[],n=[],a=[],o=0;o<i.length;o++){var s=t.relationships[o];if(void 0===s.source.id||void 0===s.target.id)n.push(s);else{var l=s.source.id,u=s.target.id,c=_.find(r,(function(e){return e.source.id===l&&e.target.id===u}));if(c){var p=r.indexOf(c);r.splice(p,1),c.type!==s.type&&a.push(s)}else n.push(s)}}return{added:n,updated:a,removed:r}}function a(e,r){for(var i=[],n=[],a=e.slice(),o=0,s=r.length;o<s;o++){var l=r[o];if(void 0===l.id)i.push({page:l,ordinal:o});else{var u=jsCommon.ArrayExtensions.findWithId(a,l.id);if(u){var c=a.indexOf(u);a.splice(c,1);var p=e.indexOf(u),d=t(u,p,l,o);n.push(d)}else i.push({page:l,ordinal:o})}}return{added:i,updated:n,removed:a}}function o(e,t){for(var r=[],i=[],n=t||[],a=e?e.slice():[],o=0,s=n;o<s.length;o++){var l=s[o];if(void 0===l.id)r.push(l);else{var u=l.id,c=_.findIndex(a,(function(e){return e.id===u}));c>=0?(i.push({updatedPod:l,originalPod:a[c]}),a.splice(c,1)):r.push(l)}}return{added:r,removed:a,updated:i}}function s(e,t){var r=i.Section.filterTransient(t.sections),n=a(e.sections,r),s=o(e.pods,t.pods);return{pages:n,pods:s}}e.diff=s})(r=t.ExplorationDiffer||(t.ExplorationDiffer={}))})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n){return new l(e,t,r,i,n)}var n=jsCommon.JsonExtensions;r.createExplorationProxy=i;var a="_",o="[0-9]+",s=18e5,l=(function(){function i(e,t,r,i,n){this.promiseFactory=e,this.httpService=t,this.serializer=r,this.telemetryService=i,this.featureSwitchService=n,this.cache={}}return i.prototype.get=function(t){var r=this,n=this.telemetryService,a=n.startEvent(e.telemetry.EXGetExploration,!1),o=t.sectionId,s=t.id,l=t.model,u=i.getKey(s,o);if(t.allowCache){var c=this.getExplorationCache(s,o,l);if(c)return a.event.info.fromCache=!0,a.resolve(),c}var p=this.promiseFactory.defer(),d="explore/reports/"+s+"/exploration";return _.isNumber(o)&&(d+="/sections/"+o),this.cache[u]={promise:p.promise},this.httpService.get(d,this.httpService.powerbiRequestOptions(a.event,"GetExploration")).then((function(e){a.resolve(),r.onSuccess(e.data,p,l,u)}),(function(t){a.reject(e.errorDetailsHelper.getTelemetryErrorDetails(t.error,t.status)),r.onError(t,s,p,u)})),p.promise},i.prototype.save=function(e,t,n){var a=this,o=this.promiseFactory.defer(),s=i.getKey(n),l=this.serializer.serializeExploration(t,{withData:!0});if(null==t.id){var u="explore/explorations/?reportid="+n;this.httpService.put(u,l,this.httpService.powerbiRequestOptions(null,"SaveExploration")).then((function(e){return a.onSuccess(e.data,o,null,s)}),(function(e){return a.onError(e,n,o,s)}))}else{var c=r.ExplorationDiffer.diff(e,t);this.featureSwitchService.featureSwitches.allUpSaveReport?this.explorationUpdateDiff(c,t.id,t).then((function(){o.resolve(t),a.updateExplorationCache(s,l)}),(function(){o.reject()})):this.updateExploration(c,t.id,t).then((function(e){o.resolve(t),a.updateExplorationCache(s,l)}),(function(){return o.reject()}))}return o.promise},i.prototype.doUpdatePage=function(e,t,r){var i=this;return e.then((function(){return i.updatePage(t,r)}))},i.prototype.doAddPage=function(e,t,r){var i=this;return e.then((function(){return i.addPage(r,t)}))},i.prototype.doDeletePage=function(e,t,r){var i=this;return e.then((function(){return i.deletePage(t,r)}))},i.prototype.updateExploration=function(e,t,r){var i=this.promiseFactory.resolve();return i=this.doUpdateTopLevelProperties(i,r),i=this.doUpdateExplorationPods(i,e.pods,t),i=this.doUpdateExplorationPages(i,e.pages,t)},i.prototype.updateTopLevelProperties=function(e){var t=this.promiseFactory.defer(),r=this.serializer.serializeExplorationShallowWithResourcePackages(e),i="explore/explorations/"+e.id;return this.httpService.post(i,r,this.httpService.powerbiRequestOptions(null,"UpdateExplorationProperty")).then((function(e){t.resolve(null)}),(function(e){return t.reject(null)})),t.promise},i.prototype.doUpdateTopLevelProperties=function(e,t){var r=this;return e.then((function(){return r.updateTopLevelProperties(t)}))},i.prototype.getModelsAndExploration=function(e){var t=this,r=this.promiseFactory.defer(),i="explore/reports/"+e+"/modelsAndExploration";return this.httpService.get(i,this.httpService.powerbiRequestOptions(null,"GetModelsAndExploration")).then((function(e){var i=e.data.models,n=t.serializer.deserializeExploration(e.data.exploration,[],!0,i);r.resolve({exploration:n,models:i})}),(function(e){r.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),r.promise},i.prototype.explorationUpdateDiff=function(e,t,r){var i=this,n=this.promiseFactory.defer(),a={};a.exploration=this.serializer.serializeExplorationShallowWithResourcePackages(r);var o=-1;a.addedPods=e.pods.added.reduce((function(e,t){if(null!=t){t.id=o--;var r=i.serializer.serializePod(t);null!=r&&e.push(r)}return e}),[]),a.deletedPods=e.pods.removed.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),a.updatedPods=e.pods.updated.reduce((function(e,t){if(null!=t){var r=i.serializer.serializePod(t.originalPod),n=i.serializer.serializePod(t.updatedPod);jsCommon.JsonComparer.equals(r,n)||e.push(n)}return e}),[]);var s=-1,l=-1;a.addedPages=e.pages.added.map((function(e){if(e.page.id=s--,e.page.visualContainers)for(var t=0,r=e.page.visualContainers;t<r.length;t++){var n=r[t];n.id=l--}return i.serializer.serializePage(e.page,e.ordinal)})),a.deletedPages=e.pages.removed.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),a.updatedPages=e.pages.updated.reduce((function(e,t){if(null!=t){for(var r=0,n=t.added.visualContainers;r<n.length;r++){var a=n[r];a.id=l--}var o=i.getUpdatedPageProperty(t);null!=o&&e.push(o)}return e}),[]);var u="explore/explorations/savereport/"+t;return this.httpService.post(u,a,this.httpService.powerbiRequestOptions()).then((function(e){var t=!1,i=!1,a=!1;if(e&&e.data&&e.data.addedPodIds&&e.data.addedPodIds.length>0&&(t=!0),e&&e.data&&e.data.addedSectionIds&&e.data.addedSectionIds.length>0&&(i=!0),e&&e.data&&e.data.addedVisualContainerIds&&e.data.addedVisualContainerIds.length>0&&(a=!0),r.pods&&t)for(var o=0,s=r.pods;o<s.length;o++){var l=s[o];l.id<0&&(l.id=_.find(e.data.addedPodIds,{oldId:l.id}).id)}if(r.sections)for(var u=0,c=r.sections;u<c.length;u++){var p=c[u];if(p.id<0&&i&&(p.id=_.find(e.data.addedSectionIds,{oldId:p.id}).id),p.visualContainers&&a)for(var d=0,f=p.visualContainers;d<f.length;d++){var v=f[d];v.id<0&&(v.id=_.find(e.data.addedVisualContainerIds,{oldId:v.id}).id)}}n.resolve(r)}),(function(e){return n.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{})})),n.promise},i.prototype.doAddPod=function(e,t,r){var i=this;return e.then((function(){return i.addPod(r,t)}))},i.prototype.doUpdatePod=function(e,t,r){
var i=this;return e.then((function(){return i.updatePod(t,r)}))},i.prototype.doDeletePod=function(e,t,r){var i=this;return e.then((function(){return i.deletePod(t,r)}))},i.prototype.updateExplorationPods=function(e,t){for(var r=this.promiseFactory.resolve(),i=0,n=e.added;i<n.length;i++){var a=n[i];r=this.doAddPod(r,t,a)}for(var o=0,s=e.updated;o<s.length;o++){var l=s[o];r=this.doUpdatePod(r,t,l)}for(var u=0,c=e.removed;u<c.length;u++){var p=c[u];r=this.doDeletePod(r,t,p.id)}return r},i.prototype.doUpdateExplorationPods=function(e,t,r){var i=this;return e.then((function(){return i.updateExplorationPods(t,r)}))},i.prototype.updateExplorationPages=function(e,t){for(var r=this.promiseFactory.resolve(),i=0,n=e.added;i<n.length;i++){var a=n[i];r=this.doAddPage(r,t,a)}for(var o=0,s=e.updated;o<s.length;o++){var l=s[o];r=this.doUpdatePage(r,t,l)}for(var u=0,c=e.removed;u<c.length;u++){var p=c[u];r=this.doDeletePage(r,t,p.id)}return r},i.prototype.doUpdateExplorationPages=function(e,t,r){var i=this;return e.then((function(){return i.updateExplorationPages(t,r)}))},i.prototype.addPod=function(e,t){var r=this;e.id=void 0;var i=this.serializer.serializePod(e),n="explore/explorations/"+t+"/pods";return this.httpService.post(n,i,this.httpService.powerbiRequestOptions(null,"AddPod")).then((function(t){var i=r.serializer.deserializePod(t.data);e.id=i.id}),_.noop)},i.prototype.updatePod=function(e,t){var r=this,i=this.promiseFactory.resolve(),n=this.serializer.serializePod(t.originalPod),a=this.serializer.serializePod(t.updatedPod);return jsCommon.JsonComparer.equals(n,a)||(i=i.then((function(){var i="explore/explorations/"+e+"/pods/"+t.updatedPod.id;return r.httpService.post(i,a,r.httpService.powerbiRequestOptions(null,"UpdatePod"))}))),i},i.prototype.deletePod=function(e,t){var r="explore/explorations/"+e+"/pods/"+t;return this.httpService.delete(r,this.httpService.powerbiRequestOptions(null,"DeletePod"))},i.prototype.addPage=function(e,t){var r=this,i=this.promiseFactory.defer(),n=this.serializer.serializePage(e.page,e.ordinal),a="explore/explorations/"+t+"/pages";return this.httpService.post(a,n,this.httpService.powerbiRequestOptions(null,"AddPage")).then((function(t){var n=r.serializer.deserializePage(t.data);e.page.id=n.id;var a=e.page.visualContainers,o=n.visualContainers;if(o)for(var s=0;s<o.length;s++)a[s].id=o[s].id;i.resolve(null)}),(function(e){return i.reject(null)})),i.promise},i.prototype.doUpdateVisualContainer=function(e,t,r,i,n){var a=this;return e.then((function(){return a.updateVisualContainer(t,r,i,n)}))},i.prototype.doDeleteVisualContainer=function(e,t,r,i){var n=this;return e.then((function(){return n.deleteVisualContainer(t,r,i)}))},i.prototype.doAddVisualContainer=function(e,t,r,i,n){var a=this;return e.then((function(){return a.addVisualContainer(t,r,i,n)}))},i.prototype.updatePage=function(e,r){var i,n=this.promiseFactory.resolve(),a=r.page.page.id,o=!(_.isEmpty(r.added.relationships)&&_.isEmpty(r.updated.relationships)&&_.isEmpty(r.removed.relationships)&&_.isEmpty(r.updated.visualContainers));o&&(i=t.util.VisualContainerUtils.generateNameMapForVisualContainers(r.page.page));for(var s=0,l=r.added.visualContainers;s<l.length;s++){var u=l[s],c=o?_.find(i,(function(e){return e.visualContainer===u})).name:void 0;n=this.doAddVisualContainer(n,e,a,u,c)}for(var p=0,d=r.updated.visualContainers;p<d.length;p++){var f=d[p],c=o?_.find(i,(function(e){return e.visualContainer===f})).name:void 0;n=this.doUpdateVisualContainer(n,e,a,f,c)}for(var v=0,h=r.removed.visualContainers;v<h.length;v++){var g=h[v];n=this.doDeleteVisualContainer(n,e,a,g.id)}return n=o?this.updatePageDeep(n,e,r):this.updatePageShallow(n,e,r)},i.prototype.updatePageShallow=function(e,t,r){var i=this,n=this.serializer.serializePageShallow(r.originalPage.page,r.originalPage.ordinal),a=this.serializer.serializePageShallow(r.page.page,r.page.ordinal);return jsCommon.JsonComparer.equals(n,a)||(e=e.then((function(){var e=i.promiseFactory.defer(),n="explore/explorations/"+t+"/pages/"+r.page.page.id;return i.httpService.post(n,a,i.httpService.powerbiRequestOptions(null,"UpdatePageShallow")).then((function(t){return e.resolve(null)}),(function(t){return e.reject(null)})),e.promise}))),e},i.prototype.updatePageDeep=function(e,t,r){var i=this,n=this.serializer.serializePage(r.page.page,r.page.ordinal);return e=e.then((function(){var e=i.promiseFactory.defer(),a="explore/explorations/"+t+"/pages/"+r.page.page.id;return i.httpService.post(a,n,i.httpService.powerbiRequestOptions(null,"UpdatePageDeep")).then((function(t){return e.resolve(null)}),(function(t){return e.reject(null)})),e.promise}))},i.prototype.deletePage=function(e,t){var r=this.promiseFactory.defer(),i="explore/explorations/"+e+"/pages/"+t;return this.httpService.delete(i,this.httpService.powerbiRequestOptions(null,"DeletePage")).then((function(e){return r.resolve(void 0)}),(function(e){return r.reject()})),r.promise},i.prototype.addVisualContainer=function(e,t,r,i){var n=this,a=this.promiseFactory.defer();r.id=void 0;var o=this.serializer.serializeVisualContainer(r,{withData:!0},i),s="explore/explorations/"+e+"/pages/"+t+"/visualcontainers";return this.httpService.post(s,o,this.httpService.powerbiRequestOptions(null,"AddVisualContainer")).then((function(e){var t=n.serializer.deserializeVisualContainer(e.data);r.id=t.id,a.resolve(null)}),(function(e){return a.reject(null)})),a.promise},i.prototype.updateVisualContainer=function(e,t,r,i){var n=this.promiseFactory.defer(),a="explore/explorations/"+e+"/pages/"+t+"/visualcontainers/"+r.id,o=this.serializer.serializeVisualContainer(r,{withData:!0},i);return this.httpService.post(a,o,this.httpService.powerbiRequestOptions(null,"UpdateVisualContainer")).then((function(e){return n.resolve(null)}),(function(e){return n.reject(null)})),n.promise},i.prototype.deleteVisualContainer=function(e,t,r){var i=this.promiseFactory.defer(),n="explore/explorations/"+e+"/pages/"+t+"/visualcontainers/"+r;return this.httpService.delete(n,this.httpService.powerbiRequestOptions(null,"DeleteVisualContainer")).then((function(e){return i.resolve(void 0)}),(function(e){return i.reject()})),i.promise},i.prototype.saveAs=function(e,t,r,i){var n=this,a=this.promiseFactory.defer(),o=this.serializer.serializeExploration(e,{withData:!0});o.reportId=void 0;var s={modelIds:[r],exploration:o,packageId:i};t=encodeURIComponent(t);var l="explore/explorations/?name="+t;return this.httpService.put(l,s,this.httpService.powerbiRequestOptions(null,"SaveExplorationAs")).then((function(e){return n.onSuccess(e.data,a)}),(function(e){return n.onError(e,r,a)})),a.promise},i.prototype.saveVisualContainerQueries=function(e,t){var r="explore/explorations/"+e+"/cache";return this.httpService.post(r,t,this.httpService.powerbiRequestOptions(null,"SaveVisualContainerQueries"))},i.prototype.getUpdatedPageProperty=function(e){var r,i=this,n=!(_.isEmpty(e.added.relationships)&&_.isEmpty(e.updated.relationships)&&_.isEmpty(e.removed.relationships)&&_.isEmpty(e.updated.visualContainers)),a={pageId:e.page.page.id};if(n&&(r=t.util.VisualContainerUtils.generateNameMapForVisualContainers(e.page.page)),a.addedVisualContainers=e.added.visualContainers.reduce((function(e,t){if(null!=t){var a=n?_.find(r,(function(e){return e.visualContainer===t})).name:void 0;e.push(i.serializer.serializeVisualContainer(t,{withData:!0},a))}return e}),[]),a.updatedVisualContainers=e.updated.visualContainers.reduce((function(e,t){if(null!=t){var a=n?_.find(r,(function(e){return e.visualContainer===t})).name:void 0;e.push(i.serializer.serializeVisualContainer(t,{withData:!0},a))}return e}),[]),a.deletedVisualContainers=e.removed.visualContainers.reduce((function(e,t){return null!=t&&e.push(t.id),e}),[]),n){var o=this.serializer.serializePage(e.page.page,e.page.ordinal);a.pageProperty=o}else{var s=this.serializer.serializePageShallow(e.originalPage.page,e.originalPage.ordinal),l=this.serializer.serializePageShallow(e.page.page,e.page.ordinal);jsCommon.JsonComparer.equals(s,l)||(a.pageProperty=l)}return a},i.prototype.getExplorationCache=function(e,t,r){var n=i.getKey(e,t),a=this.cache[n];if(a||(n=i.getKey(e),a=this.cache[n]),a){if(a.promise)return a.promise;if(a.data){if(null!=t&&!_.any(a.data.sections,(function(e){return e.id===t})))return;var o=this.promiseFactory.defer(),s=[];return o.resolve(this.serializer.deserializeExploration(a.data,s,!0,r)),o.promise}}},i.prototype.updateExplorationCache=function(e,t){var r=this;if(e){if(!t)return void delete this.cache[e];var n=this.cache[e];n?(n.promise&&delete n.promise,n.data=t):this.cache[e]={data:t,promise:null},i.isAllSectionsKey(e)&&_.forOwn(this.cache,(function(t,i){i!==e&&null!=i.match(new RegExp("^"+e+"$"))&&delete r.cache[i]})),this.cacheExpirationTimerId&&clearTimeout(this.cacheExpirationTimerId),this.cacheExpirationTimerId=setTimeout((function(){r.clearCache()}),s)}},i.prototype.clearCache=function(){this.cache={}},i.prototype.logDeserializationErrorsTelemetryEvents=function(r,i){if(_.find(i,(function(e){return 0===e.errorType}))){var a=n.tryParseJSON(r.config);this.telemetryService.logEvent(e.telemetry.NewerExplorationVersion,a.version.toString(),t.services.upgrade.CurrentExplorationVersion.toString())}},i.prototype.onSuccess=function(e,t,r,i){var n=[],a=this.serializer.deserializeExploration(e,n,!0,r);t.resolve(a),this.logDeserializationErrorsTelemetryEvents(e,n),this.updateExplorationCache(i,e)},i.prototype.onError=function(e,t,r,i){r.reject(e?{error:e.error,requestId:e.requestId,httpStatusCode:e.status}:{}),this.updateExplorationCache(i,null)},i.getKey=function(e,t){return null!=t?e+a+t:e+a+o},i.isAllSectionsKey=function(e){if(!e)return!1;var t=e.split(a);return!(!t||2!==t.length)&&t[1]===o},i})()})(r=t.proxies||(t.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new a(e,t)}var r,i=jsCommon.StringExtensions;!(function(e){!(function(e){e[e.User=0]="User",e[e.Generated=1]="Generated",e[e.Deleted=2]="Deleted"})(e.LinguisticItemSource||(e.LinguisticItemSource={}));e.LinguisticItemSource})(r=e.wireContracts||(e.wireContracts={})),e.createLinguisticSchemaProxy=t;var n=0,a=(function(){function e(e,t){this.promiseFactory=e,this.httpService=t,this.schemas={},this.originalSchemas={}}return e.prototype.init=function(e,t){var r=this,i=this.promiseFactory.defer();if(e=e||n,this.schemas[e]={content:{Entities:[]}},this.originalSchemas[e]={content:{Entities:[]}},e&&t){var a="explore/reports/"+e+"/linguisticschema";this.httpService.get(a,this.httpService.powerbiRequestOptions()).then((function(t){r.schemas[e]=t.data,r.originalSchemas[e]=_.cloneDeep(t.data),i.resolve(null)}),(function(t){r.schemas[e]=null;var n=t?{error:t.error,requestId:t.requestId}:{};i.reject(n)}))}return i.promise},e.prototype.save=function(e){var t=this,r=this.promiseFactory.defer(),i=this.schemas[e],a=this.originalSchemas[e];if(i||(i=this.schemas[n],i&&(this.schemas[n]=null,this.schemas[e]=i,a=this.originalSchemas[n],this.originalSchemas[n]=null,this.originalSchemas[e]=a)),!_.isEqual(i,a)){if(i){var o="explore/reports/"+e+"/linguisticschema";i.content&&!_.isEmpty(i.content.Entities)?(i.id=void 0,this.httpService.post(o,i,this.httpService.powerbiRequestOptions()).then((function(i){t.originalSchemas[e]=_.cloneDeep(i.data),r.resolve(null)}),(function(e){var t=e?{error:e.error,requestId:e.requestId}:{};r.reject(t)}))):a?this.httpService.delete(o,this.httpService.powerbiRequestOptions()).then((function(i){delete t.originalSchemas[e],r.resolve(null)}),(function(e){var t=e?{error:e.error,requestId:e.requestId}:{};r.reject(t)})):(this.originalSchemas[e]=i,r.resolve(null))}return r.promise}},e.prototype.get=function(e,t){e=e||n;var r,i=this.schemas[e];return i&&(r=this.getWordsForPodEntity(i,t)),this.promiseFactory.resolve({podName:t,words:r||[]})},e.prototype.set=function(e,t,r){e=e||n;var i=this.schemas[e];i&&this.setWordsForPodEntity(i,t,r)},e.prototype.getSchema=function(e){return _.cloneDeep(this.schemas[e||n])},e.prototype.setSchema=function(e,t){this.schemas[e||n]=t},e.prototype.getWordsForPodEntity=function(e,t){var i=this.findPodEntity(e,t);if(i&&i.Source!==r.LinguisticItemSource.Deleted)return _.map(_.filter(i.Words,(function(e){return null==e.Source||e.Source===r.LinguisticItemSource.User})),(function(e){return e.Value}))},e.prototype.setWordsForPodEntity=function(e,t,n){var a=this.findPodEntity(e,t);if(_.isEmpty(n)){if(a){var o=e.content.Entities.indexOf(a);e.content.Entities.splice(o,1)}}else{a?a.Source===r.LinguisticItemSource.Deleted&&(a.Source=r.LinguisticItemSource.Generated):(a={Name:null,ConceptualEntity:t,Source:r.LinguisticItemSource.Generated},e.content.Entities.push(a));var s=n[0],l=i.deriveClsCompliantName(s,"pod");a.Name=this.makeUniquePodEntityName(l,e.content.Entities,a),a.Words=_.map(n,(function(e){return{Value:e,Source:r.LinguisticItemSource.User}}))}},e.prototype.findPodEntity=function(e,t){if(e.content&&e.content.Entities)return _.find(e.content.Entities,(function(e){return e.ConceptualEntity===t}))},e.prototype.makeUniquePodEntityName=function(e,t,r){for(var n={},a=0,o=t;a<o.length;a++){var s=o[a];s!==r&&(n[s.Name]=!0)}return i.findUniqueName(n,e)},e})();e.LinguisticSchemaProxy=a})(t=e.proxies||(e.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function r(e,t,r){return new i(e,t,r)}t.createEmbedProxy=r;var i=(function(){function t(e,t,r){this.httpService=e,this.promiseFactory=t,this.localizationService=r}return t.prototype.createEmbed=function(t){var r=this,i="snapshots/embed/",n=this.promiseFactory.defer(),a=e.services.EmbedSerializer.serializeEmbedCreationRequest(t);return this.httpService.post(i,a,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(e.services.EmbedSerializer.convertEmbed(t.data,r.localizationService))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getSnapshotEmbedsForReport=function(t){var r=this,i="snapshots/embed/reports/"+t.toString(),n=this.promiseFactory.defer();return this.httpService.get(i,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,r.localizationService)})))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getLiveEmbeds=function(){var t=this,r="snapshots/embed/reports/interactive/",i=this.promiseFactory.defer();return this.httpService.get(r,this.httpService.powerbiRequestOptions()).then((function(r){return i.resolve(_.map(r.data,(function(r){return e.services.EmbedSerializer.convertEmbed(r,t.localizationService)})))}),(function(e){return i.reject(e)})),i.promise},t.prototype.getLiveEmbedsForReport=function(t){var r=this,i="snapshots/embed/reports/interactive/"+t.toString(),n=this.promiseFactory.defer();return this.httpService.get(i,this.httpService.powerbiRequestOptions()).then((function(t){return n.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,r.localizationService)})))}),(function(e){return n.reject(e)})),n.promise},t.prototype.getLiveEmbedsByEmbedKeyAsSysAdmin=function(t,r){var i=this,n=r+"/snapshots/embed/admin/reports/interactive/"+t,a=this.promiseFactory.defer();return this.httpService.get(n,this.httpService.sysAdminRequestOptions()).then((function(t){return a.resolve(_.map(t.data,(function(t){return e.services.EmbedSerializer.convertEmbed(t,i.localizationService)})))}),(function(e){return a.reject(e)})),a.promise},t.prototype.saveSnapshotEmbed=function(e,t){var r="snapshots/embed/"+e,i=this.promiseFactory.defer();return this.httpService.put(r,t,this.httpService.powerbiRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.deleteSnapshotEmbed=function(e){var t="snapshots/embed/"+e,r=this.promiseFactory.defer();return this.httpService.delete(t,this.httpService.powerbiRequestOptions()).then((function(e){return r.resolve(null)}),(function(e){return r.reject(e)})),r.promise},t.prototype.deleteLiveEmbed=function(e){var t="snapshots/embed/interactive/"+e,r=this.promiseFactory.defer();return this.httpService.delete(t,this.httpService.powerbiRequestOptions()).then((function(e){return r.resolve(null)}),(function(e){return r.reject(e)})),r.promise},t.prototype.deleteLiveEmbedAsSysAdmin=function(e,t){var r=t+"/snapshots/embed/admin/interactive/"+e,i=this.promiseFactory.defer();return this.httpService.delete(r,this.httpService.sysAdminRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.updateLiveEmbed=function(e,t){var r="/snapshots/embed/interactive/"+e,i=this.promiseFactory.defer();return this.httpService.put(r,t,this.httpService.powerbiRequestOptions()).then((function(e){return i.resolve(null)}),(function(e){return i.reject(e)})),i.promise},t.prototype.updateLiveEmbedAsSysAdmin=function(e,t,r){var i=r+"/snapshots/embed/admin/interactive/"+e,n=this.promiseFactory.defer();return this.httpService.put(i,t,this.httpService.sysAdminRequestOptions()).then((function(e){return n.resolve(null)}),(function(e){return n.reject(e)})),n.promise},t})()})(t=e.proxies||(e.proxies={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,i,n){if(!(t&&t.clientError&&t.clientError.ignorable)){var a;if(t&&t.serviceError)a=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessageFromServiceError(t.serviceError);else if(t&&t.clientError)a=e.helpers.PowerBIServiceExceptionErrorHelper.GetErrorDetailsFromClientError(t.clientError);else{var o=$.Deferred();o.resolve(null),a=o.promise()}a.then((function(e){r.error(e&&e.message?e.message:i,n,{requestId:t?t.requestId:void 0,displayableErrorInfo:e?e.displayableErrorInfo:void 0})}))}}t.handleConceptualSchemaError=r})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=e.drilldown;return null!=t?t.roles:[]}function r(e,t,r,i){var n,a=!1;if(null!=t)if(c(e.projections,t)){a=!0;var o=e.projections[r].all()[i-1];o&&(n=e.defn.select().withName(o.queryRef).expr)}else n=e.defn.select().withName(t).expr;return{expr:n,isActiveProjection:a,roleName:r,index:i}}function i(e,t,r){if(t)switch(r){case 1:return o(e,t);case 0:var i=t;if(i.expr){var s=void 0;s=_.isArray(i.expr)?i.expr:[i.expr];for(var l=[],u=0,c=s;u<c.length;u++){var p=c[u];l.push(a(e,p))}return l}return n(e,t)}}function n(e,t){for(var i=e.clone(),n=[],a=t.count||1,o=t.role,s=i.projections[o],l=s.all(),u=a-1;u>-1;u--){var c=t.index+u,p=r(i,l[c].queryRef,o,c);if(p.isActiveProjection){var d=l[p.index-1];d&&s.addActiveQueryReference(d.queryRef)}n.push(p)}return n}function a(e,t){var i,n,a=e.defn.selectNameOf(t),o=u(e.projections,a);return o&&(i=o.index,n=o.roleName),r(e,a,n,i)}function o(e,t){var r=e.projections[t.sourceRole];if(!r.activeProjectionRefs)return[];var i=r.activeProjectionRefs,n=r.all(),a=_.last(i),o=_.findIndex(n,(function(e){return e.queryRef===a}));if(o<0)return[];var u=l(t,o);return null==u?[]:s(u,e,t)}function s(e,t,r){if(1===e)return[];if(3===e||0===e){var i={role:r.sourceRole,index:r.sourceIndex,count:r.replacementExpressions&&r.replacementExpressions.length};return n(t,i)}if(2===e){for(var a=[],o=r.sourceIndex,s=r.targetIndex;s<o;){var i={role:r.sourceRole,index:s},l=n(t,i);a.push(_.first(l)),s++}return a}}function l(e,t){var r=e.sourceIndex,i=e.targetIndex;return e.sourceRole!==e.targetRole?3:r===t&&i<t?2:r<i&&i>=t?0:r>i&&i<=t?1:void 0}function u(e,t){for(var r in e)if(e[r].activeProjectionRefs){var i=e[r].all(),n=_.findIndex(i,(function(e){return e.queryRef===t}));if(n>=0)return{roleName:r,index:n}}}function c(e,t){for(var r in e){var i=e[r];if(_.last(i.activeProjectionRefs)===t)return!0}return!1}e.getDrillableRoles=t,e.getDrillFilterRemovalInfoList=i,e.getMoveType=l})(t=e.DrillUtils||(e.DrillUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){t.visitExploration(e),n(e.filters,t);var a=e.sections;if(!_.isEmpty(a))for(var o=0,s=a.length;o<s;o++)r(a[o],t,i)}function r(e,t,r){t.visitSection(e),n(e.filters,t);var a=e.visualContainers;if(!_.isEmpty(a))for(var o=0,s=a.length;o<s;o++)i(a[o],t,r)}function i(t,r,i){var o;if(r.visitVisualContainer(t),t.config&&(o=t.config.singleVisual)){r.visitSingleVisualConfig(o);var s=o.query;s&&r.visitQuery(s);var l=o.objects;if(l){var u=void 0,c=e.VisualContainerUtils.getVisualCapabilities(t,i);c&&(u=c.objects),u&&r.visitDataViewObjects(l,u),a(l,r)}}n(t.filters,r)}function n(e,t){if(!_.isEmpty(e))for(var r=0,i=e.length;r<i;r++){var n=e[r];t.visitFilter(n)}}function a(e,t){for(var r in e){var i=e[r];if(!_.isEmpty(i))for(var n=0,a=i;n<a.length;n++){var o=a[n],s=o.selector;s&&t.visitSelector(s)}}}e.traverseExploration=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=n(e),i=n(t);return r.major>i.major||r.major===i.major&&r.minor>i.minor}function r(e,t){var r=n(e),i=n(t);return r.major<i.major||r.major===i.major&&r.minor<i.minor}function i(e,t){var r=n(e),i=n(t);return r.major===i.major&&r.minor===i.minor}function n(e){var t=e.split("."),r={major:Number(t[0]),minor:Number(t[1])};return r}e.gt=t,e.lt=r,e.eq=i})(t=e.ExplorationVersionUtils||(e.ExplorationVersionUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.visitExploration=function(e){},e.prototype.visitSection=function(e){},e.prototype.visitVisualContainer=function(e){},e.prototype.visitSingleVisualConfig=function(e){},e.prototype.visitQuery=function(e){},e.prototype.visitDataViewObjects=function(e,t){},e.prototype.visitFilter=function(e){},e.prototype.visitSelector=function(e){},e})();e.DefaultExplorationVisitor=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){var r=e.getMetadata(t);if(r){var i=r.format;return D.create({format:i,allowFormatBeautification:!0})}}function n(e,r,i){void 0===i&&(i=null);var n=e.getMetadata(r);if(n){var a=n.type,o=a&&(a.text||a.bool||a.dateTime),s=n.idOnEntityKey&&i&&E.equals(e,i);return!o||P.isMeasure(e)||s?t.contracts.FilterType.Advanced:t.contracts.FilterType.Categorical}}function a(e,t,r,i,n){if(!e||!t)return!1;var a=w.asFieldPattern(e),s=x.toFieldExprEntityItemPattern(a),l=t.schema(s.schema);if(!l)return!1;var u,c=l.findProperty(s.entity,x.getPropertyName(a));if(!c&&a.hierarchyLevel){var p=l.findHierarchy(s.entity,a.hierarchyLevel.name);p&&(u=p.levels.withName(a.hierarchyLevel.level))}if(!c&&!u||!r||!r.container)return!1;if(0!==r.scopeType&&c&&1===c.kind)return!1;if(0===r.scopeType){var d=r.container;return d&&o(d,i,n)}return!0}function o(e,r,i){var n=t.util.VisualContainerUtils.getVisualType(e);return!i.supportsFilterOutput(e)&&t.util.VisualContainerUtils.isQueryVisual(n,r)}function s(e,t){e.filters||(e.filters=[]),e.filters.push(t)}function l(i,n,a,o,s){if(!a)return!1;var l=i.expression;if(!l)return!1;var u=e.data.SQExprUtils.isMeasure(l),c=!_.isEmpty(r.validate(i,n,o)),p=t.util.VisualContainerUtils.hasGrouping(a,n);return!(!u||p||c)||(!!t.util.VisualContainerUtils.hasFilterMappingWithNonAggregatableColumns(a,n,s)||!(!t.util.VisualContainerUtils.hasGroupByItemsInQuery(a)||!u))}function u(e,t){var r=e.getMetadata(t);if(r)return r.type}function c(t,r){var i=e.data.SQExprUtils.getDefaultValues(t,r);if(!_.isEmpty(i)){var n=e.data.createDataViewScopeIdentity(e.data.SQExprUtils.getDataViewScopeIdentityComparisonExpr(t,i));return{isNot:!1,scopeIds:[n]}}}function p(t,i,n,a,o){if(!_.isEmpty(n))if(i){if(!e.data.SemanticFilter.isAnyFilter(i))return e.data.SemanticFilter.isDefaultFilter(i)?r.getDefaultRetainedValue(n,a):o}else if(t){var s=r.getDefaultRetainedValue(n,a);if(s)return s}}function d(e,r,i){var n=e.expression,a=e.filter,o=t.util.ModelAuthoringUtility.validate(n,r,i);if(a&&(o=a.validate(r,i,o)),!_.isEmpty(o))return o}function f(e){if(_.isEmpty(e))return R;for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return V.findUniqueName(t,R)}function v(e,t,r){var i=1,n=r.format(t,[i.toFixed()]);if(_.isEmpty(e))return n;for(var a={},o=0,s=e;o<s.length;o++){var l=s[o];l.restatement&&(a[l.restatement]=!0)}for(;a[n];)n=r.format(t,[(++i).toFixed()]);return n}function h(e){return e===t.contracts.FilterType.Categorical||e===t.contracts.FilterType.Visual}function g(e,t,r){var i=e.filters,n=[];if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s&&s.filter;if(l&&_.isEmpty(l.validate(t,r))&&2===s.howCreated&&m(l.where())){var u=S(e,s.expression);u&&n.push(u)}}return n}function m(e){return!_.isEmpty(e)&&_.all(e,(function(e){return y(e)}))}function y(e){if(null==e)return!1;var t=e.condition;return E.isIn(t)?t.values&&1===t.values.length:E.isCompareRef(t)?0===t.comparison:void 0}function b(e,t){if(!_.isEmpty(e)){if(!t)return e;for(var r=[],i=0,n=e;i<n.length;i++){var a=n[i],o=a.condition;if(E.isIn(o)){var s=o.args;_.any(s,(function(e){return E.equals(e,t)}))&&r.push(a)}else if(E.isCompareRef(o)){var l=E.isConstant(o.left)?o.right:o.left;E.equals(l,t)&&r.push(a)}}return r}}function C(e,t){if(e){var r=e.condition;if(E.isIn(r)){if(!t)return r.values;if(_.isEmpty(r.values))return[[]];var i=r.args,n=_.findIndex(i,(function(e){return E.equals(e,t)})),a=n!==-1?_.map(r.values,(function(e){return[e[n]]})):[[]];return a}if(E.isCompareRef(r)){var o=E.isConstant(r.left),s=o?r.right:r.left,l=E.isConstant(r.left)?r.left:r.right;return!t||E.equals(s,t)?[[l]]:[[]]}}}function S(e,r){var i=t.util.VisualContainerUtils.getVisualQuery(e);if(i)return i.defn.selectNameOf(r)}var x=e.data.FieldExprPattern,E=e.data.SQExpr,w=e.data.SQExprConverter,P=e.data.SQExprUtils,V=jsCommon.StringExtensions,D=e.visuals.valueFormatter,R="Filter";r.getFormatter=i,r.getDefaultFilterType=n,r.canAdd=a,r.shouldCreateVisualFilters=o,r.add=s,r.shouldDisableFilter=l,r.getValueType=u,r.getDefaultRetainedValue=c,r.applyDefaultValue=p,r.validate=d,r.getNextFilterName=f,r.getNextAutoGenRestatement=v,r.isCategoricalFilter=h,r.getQueryRefsForSingleItemDrillFilters=g,r.areSingleValueFilters=m,r.isSingleValueFilter=y,r.getFiltersForColumn=b,r.getFilterValues=C})(r=t.FilterUtils||(t.FilterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.SQExprConverter,o=e.data.SQExprGroupUtils,s=e.data.SQHierarchyExprUtils;!(function(t){function r(e,t,r,n){if(r&&t&&i.isHierarchyLevel(n)){for(var a=n,l=a.arg,u=s.expandExpr(e,l),c=[],p=0,d=t.dataRoles;p<d.length;p++){var f=d[p],v=r.tryGetExprs(f.name);if(v)for(var h=_(o.groupExprs(e,v)).filter((function(e){return i.equals(e.expr,l)})).reverse().value(),g=0,m=h;g<m.length;g++){var y=m[g],b=s.getInsertionIndex(u,y.children,a);c.push({expr:a,schema:e,targetRole:f.name,targetIndex:y.selectQueryIndex+b})}}return c}}function l(t,r){if(t&&t.kind===e.VisualDataRoleKind.Measure){var i=s.getHierarchySourceAsVariationSource(r);if(i)return n.columnRef(i.arg,i.property)}}function u(e,t,r,n,a,o){var s=e.singleVisual.query.tryGetExprs(t)||[],u=s.slice(r,r+n);if(!_.isEmpty(s)&&!_.isEmpty(u)){var c;if(c=_.isEmpty(o)?u[0]:o[0],i.isHierarchyLevel(c)){var p=l(a,c);if(p)return[p]}return _.isEmpty(o)?u:o}}function c(e,t){return i.isHierarchyLevel(e)&&i.isHierarchyLevel(t)&&i.equals(e.arg,t.arg)}function p(e,t){var r=a.asFieldPattern(t),i=r.hierarchyLevel;if(i){var n=e.findHierarchy(i.entity,i.name);return n?_.findIndex(n.levels,(function(e){return e.name===i.level})):void 0}}function d(e){_.isEmpty(e)||e.sort(f)}function f(e,t){return e.displayName.localeCompare(t.displayName,void 0,{sensitivity:"base"})}t.getOptionsToAddHierarchyLevelToExistingHierarchies=r,t.getHierarchyReplacementExpressions=u,t.hierarchyLevelComparer=c,t.findHierarchyLevelIndex=p,t.sortHierarchies=d})(r=t.HierarchyUtils||(t.HierarchyUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.visuals.matrixRoleNames;!(function(e){function t(e,t,o,s,l){if(e.matrix){for(var u=[],c=[],p=[],d=[],f=e.matrix,v=0,h=t;v<h.length;v++){var g=h[v],m=_.clone(g);m.roles={},u.push(m)}var y=function(e){if(l&&l.featureSwitches.showGeneratedColumnsInDetailView)return!0;var r=t[e.index];return!r||!_.isEmpty(r.roles)},b=r(f.rows,u,c,i.rows)&&r(f.columns,u,p,i.columns,(function(e){return!e.isMeasure}))&&n(f.valueSources,u,d,i.values,y);if(b){a(o,s,c,p,d);var C={};c.length>0&&(C[i.rows]=c),p.length>0&&(C[i.columns]=p),d.length>0&&(C[i.values]=d);var S={selects:u,roles:{ordering:C}};return S}}}function r(e,t,r,i,a){if(!e||_.isEmpty(e.levels))return!0;for(var o=0,s=e.levels;o<s.length;o++){var l=s[o];if(!n(l.sources,t,r,i,a))return!1}return!0}function n(e,t,r,i,n){if(_.isEmpty(e))return!0;for(var a=0,o=e;a<o.length;a++){var s=o[a];if(!n||n(s)){if(r.push(s.index),!t[s.index])return!1;t[s.index].roles[i]=!0}}return!0}function a(e,t,r,i,n){if(!_.isEmpty(e)&&t){var a=r.length>=2,l=i.length>=2,u=n.length>=2;if(a||l||u){var c=o(e,t);c&&(a&&s(r,c),l&&s(i,c),u&&s(n,c))}}}function o(e,t){var r=_.chain(e).map((function(e){return t[e]})).flatten().filter((function(e){return _.isNumber(e)})).value(),i=_.reduce(r,(function(e,t,r){return void 0===e[t]&&(e[t]=r),e}),{});return Object.keys(i).length>=2?i:void 0}function s(e,t){e.sort((function(e,r){return l(e,t)-l(r,t)}))}function l(e,t,r){return void 0===r&&(r=Number.MAX_VALUE),_.isNumber(t[e])?t[e]:r}e.generate=t})(r=t.MatrixVisualDataViewConverter||(t.MatrixVisualDataViewConverter={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.SchemaChangeType.ObjectTypeEnum,a=e.data.SQExpr,o=e.data.SQExprBuilder,s=e.data.SQExprConverter;!(function(t){function r(e,t,r){if(e){var n=s.asFieldPattern(e),a=i.toFieldExprEntityItemPattern(n),o=""===a.entity?null:a.entity,l={itemShowHide:{schema:a.schema,entity:o,property:C(n),objectType:b(n),makeHidden:t}};y(l,r)}}function l(e,t){if(e){var r,n=s.asFieldPattern(e);if(n.hierarchyLevel){var a=n.hierarchyLevel;r={hierarchyLevelDelete:{schema:a.schema,entity:a.entity,hierarchy:a.name,hierarchyLevel:a.level}}}else{var o=i.toFieldExprEntityItemPattern(n);r={itemDelete:{schema:o.schema,entity:o.entity,property:C(n),objectType:b(n)}}}y(r,t)}}function u(e,t,r){if(e){var i=s.asFieldPattern(e),n=i.hierarchyLevel;if(n){var a={hierarchyLevelMove:{schema:n.schema,entity:n.entity,hierarchy:n.name,level:n.level,index:t}};y(a,r)}}}function c(e,t){var r=i.toFieldExprEntityItemPattern(e),n={entityRefresh:{schema:r.schema,entity:r.entity}};y(n,t)}function p(e,t,r){if(e){var n,a=s.asFieldPattern(e),o=i.toFieldExprEntityItemPattern(a);if(a.hierarchyLevel){var l=a.hierarchyLevel;n={hierarchyLevelRename:{schema:l.schema,entity:l.entity,hierarchy:l.name,before:l.level,after:t}}}else i.hasFieldExprName(a)?n={propertyRename:{schema:o.schema,entity:o.entity,objectType:b(a),before:C(a),after:t}}:a.hierarchy?n={propertyRename:{schema:o.schema,entity:o.entity,objectType:b(a),before:i.getHierarchyName(a),after:t}}:o.entity&&(n={entityRename:{schema:o.schema,before:o.entity,after:t}});y(n,r)}}function d(e,t){var r={newMeasure:{schema:e.schema,entity:e.entity}};y(r,t)}function f(e,t){if(!_.isEmpty(e)){for(var r,i=[],n=0,o=e;n<o.length;n++){var l=o[n],u=s.asFieldPattern(l),c=u.column||u.groupingColumn;if(!c)return;if(r){if(!a.equals(l.source,r))return}else r=l.source;i.push(c.name)}var p={hierarchyCreate:{schema:r.schema,entity:r.entity,name:null,properties:i}};y(p,t)}}function v(e,t,r,i){if(e){var n=s.asFieldPattern(e),a=n.column||n.groupingColumn;if(a){var o={hierarchyLevelCreate:{schema:a.schema,entity:a.entity,hierarchy:t,property:a.name,
index:r}};y(o,i)}}}function h(e,t){var r={newCalculatedColumn:{schema:e.schema,entity:e.entity}};y(r,t)}function g(e){if(null!=e&&!_.isEmpty(e.changes)){var t=_.filter(e.changes,(function(e){return e.newMeasureCreated||e.newCalculatedColumnCreated||e.measureMove||e.newCalculatedTableCreated||e.newBins||e.newGroups}));if(0!==t.length){var r,i,n,a,s=t[t.length-1];return s.newMeasureCreated?(r=s.newMeasureCreated.schema,i=s.newMeasureCreated.entity,a=s.newMeasureCreated.name,o.measureRef(o.entity(r,i),a)):s.newCalculatedColumnCreated?(r=s.newCalculatedColumnCreated.schema,i=s.newCalculatedColumnCreated.entity,n=s.newCalculatedColumnCreated.name,o.columnRef(o.entity(r,i),n||a)):s.newCalculatedTableCreated?(r=s.newCalculatedTableCreated.schema,i=s.newCalculatedTableCreated.entity,o.entity(r,i)):s.measureMove?(r=s.measureMove.schema,i=s.measureMove.destination,a=s.measureMove.property,o.measureRef(o.entity(r,i),a)):s.newBins?(r=s.newBins.schema,i=s.newBins.entity,n=s.newBins.name,o.columnRef(o.entity(r,i),n)):s.newGroups?(r=s.newGroups.schema,i=s.newGroups.entity,n=s.newGroups.name,o.columnRef(o.entity(r,i),n)):void 0}}}function m(e,t,r){var i=[];if(e&&(i=e.validate(t,r,i)),!_.isEmpty(i))return i}function y(e,t){t.apply({changes:[e]})}function b(t){return C(t)?t.column||t.groupingColumn?n.Column:t.measure?n.Measure:t.hierarchy?n.Hierarchy:"":e.data.SchemaChangeType.ObjectTypeEnum.Table}function C(e){return i.getPropertyName(e)||i.getHierarchyName(e)}t.hide=r,t.deleteItem=l,t.move=u,t.refreshEntity=c,t.rename=p,t.createMeasure=d,t.createHierarchy=f,t.createHierarchyLevel=v,t.createCalculatedColumn=h,t.getLastNewCalculationSchemaChangeAsFieldExpr=g,t.validate=m,t.GetObjectTypeForSchemaChange=b})(r=t.ModelAuthoringUtility||(t.ModelAuthoringUtility={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new o(e,t,r,i)}var i=e.data.QueryProjectionCollection,n=e.data.QueryProjectionsByRole,a=(function(){function e(e,t,r){this.plugin=e,this.initialize(t,r)}return e.getProjection=function(e,t){var r=n.getRole(e,t);return r||(e[t]=r=new i([])),r.all()},e.addCategoryRole=function(t,r){e.getProjection(t,e.CategoryRole).push(r.projection)},e.addValuesRole=function(t,r){e.getProjection(t,e.ValuesRole).push(r.projection)},e.addSeriesRole=function(t,r){e.getProjection(t,e.SeriesRole).push(r.projection)},e.addGroupRole=function(t,r){e.getProjection(t,e.GroupRole).push(r.projection)},e.addDetailsRole=function(t,r){e.getProjection(t,e.DetailsRole).push(r.projection)},e.addYRole=function(t,r){e.getProjection(t,e.YRole).push(r.projection)},e.addTargetValueRole=function(t,r){e.getProjection(t,e.TargetValueRole).push(r.projection)},e.addMinValueRole=function(t,r){e.getProjection(t,e.MinValueRole).push(r.projection)},e.addMaxValueRole=function(t,r){e.getProjection(t,e.MaxValueRole).push(r.projection)},e.addXRole=function(t,r){e.getProjection(t,e.XRole).push(r.projection)},e.addSizeRole=function(t,r){e.getProjection(t,e.SizeRole).push(r.projection)},e.addGradientRole=function(t,r){e.getProjection(t,e.GradientRole).push(r.projection)},e.addTooltipRole=function(t,r){e.getProjection(t,e.TooltipRole).push(r.projection)},e.addRowsRole=function(t,r){e.getProjection(t,e.RowsRole).push(r.projection)},e.addColumnsRole=function(t,r){e.getProjection(t,e.ColumnsRole).push(r.projection)},e.prototype.initialize=function(e,t){var r=e.select();this.projectionsInfo=[];for(var i=0,n=r.length;i<n;i++){var a=r[i];this.projectionsInfo.push({projection:{queryRef:a.name},metadata:a.expr.getMetadata(t)})}},e.ValuesRole="Values",e.SeriesRole="Series",e.CategoryRole="Category",e.GroupRole="Group",e.DetailsRole="Details",e.YRole="Y",e.XRole="X",e.SizeRole="Size",e.GradientRole="Gradient",e.PlayRole="Play",e.RowsRole="Rows",e.ColumnsRole="Columns",e.MinValueRole="MinValue",e.MaxValueRole="MaxValue",e.TargetValueRole="TargetValue",e.TooltipRole="Tooltips",e})();t.QueryProjectionBuilder=a;var o=(function(e){function t(t,r,i,n){e.call(this,t,i,n),this.dataRoles=r}return __extends(t,e),t.prototype.validatePlugin=function(){return!0},t.prototype.build=function(e){for(var t={},r=0,i=this.dataRoles.length;r<i;r++){var n=this.dataRoles[r],o=this.projectionsInfo[n.Projection];if(o&&(a.getProjection(t,n.Name).push(o.projection),n.isActive)){var s=t[n.Name];s.addActiveQueryReference(o.projection.queryRef)}}return t},t})(a);t.DataRolesQueryProjectionBuilder=o,t.createProjectionBuilderFromDataRoles=r})(r=t.QueryProjectionBuilderCoreUtils||(t.QueryProjectionBuilderCoreUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,r=jsCommon.ArrayExtensions;!(function(e){function t(e){var t=e.resourcePackages;return t||(t=r.createWithName(),e.resourcePackages=t),t}e.ensureResourcePackages=t})(t=e.ResourcePackageUtils||(e.ResourcePackageUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t,r,i){var n=e.createJQueryPromiseFactory().defer(),a=f(t,r);return a===-1?n.resolve(void 0):i.get(t.reportId,t.pods[a].name).then((function(e){var t=e&&e.words.slice();if(_.isEmpty(t))n.resolve(void 0);else{t.shift();var r={altNames:t};n.resolve(r)}})),n.promise}function i(e,t,r){var i=f(e,t);i>-1&&(r.set(e.reportId,e.pods[i].name,[]),e.pods.splice(i,1))}function n(e,t,r){return a(e,t.name,t.displayName,r)}function a(e,t,r,i){var n=f(e,t);n===-1&&(n=h(e,t));var a=e.pods[n];return i.get(e.reportId,a.name).then((function(t){var n=t&&t.words;_.isEmpty(n)?n=[r]:n[0]=r,i.set(e.reportId,a.name,n)}))}function o(e,t,r,i){var n=f(e,t.name);n===-1&&(n=h(e,t.name)),r.unshift(t.displayName),i.set(e.reportId,e.pods[n].name,r)}function s(e,t,r){var i=f(e,t);i===-1&&(i=h(e,t));var n=e.pods[i];n.parameters||(n.parameters=[]),n.parameters.push({name:"Param_"+r,boundFilter:r})}function l(e,t,r,i){var n=f(e,t);if(n>-1){var a=e.pods[n],o=v(a,r);o>-1&&(a.parameters.splice(o,1),g(e,n,i))}}function u(e,t,r){var i=f(e,t);if(i===-1)return!1;var n=v(e.pods[i],r);return n!==-1}function c(e,t,r,i){var n=f(e,t);(n!==-1||r)&&(n===-1&&(n=h(e,t)),e.pods[n].cortanaEnabled=r,g(e,n,i))}function p(e,t){if(e&&e.pods){var r=e.pods,i=_.findIndex(r,(function(e){return e.name===t}));return i!==-1?i:void 0}}function d(t,r,i,n){var a=f(t,t.sections[i].name);if(a===-1)return e.createJQueryPromiseFactory().resolve();var o=h(t,r.name),s=t.pods[o],l=t.pods[a];return s.cortanaEnabled=l.cortanaEnabled,s.parameters=_.cloneDeep(l.parameters),y(t.reportId,r,s,l,n)}function f(e,t){return e&&e.pods?_.findIndex(e.pods,(function(e){return e.boundSection===t})):-1}function v(e,t){return e&&e.parameters?_.findIndex(e.parameters,(function(e){return e.boundFilter===t})):-1}function h(e,t){return e.pods||(e.pods=[]),e.pods.push({name:m(e.pods),boundSection:t,parameters:[]}),e.pods.length-1}function g(e,t,r){var i=e.pods[t];!i.cortanaEnabled&&_.isEmpty(i.parameters)&&r.get(e.reportId,i.name).then((function(r){r&&!_.isEmpty(r.words)||(e.pods.splice(t,1),0===e.pods.length&&(e.pods=void 0))}))}function m(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=!0}return b.findUniqueName(t,C)}function y(e,t,r,i,n){return n.get(e,i.name).then((function(i){var a=i&&i.words.slice();_.isEmpty(a)||(a.shift(),a.unshift(t.displayName),n.set(e,r.name,a))}))}var b=jsCommon.StringExtensions,C="Pod";t.getLinguisticMetadata=r,t.deletePod=i,t.ensurePod=n,t.updateLinguisticPrimaryName=a,t.updateLinguisticAltNames=o,t.addParameter=s,t.deleteParameter=l,t.hasParameter=u,t.setCortanaEnabled=c,t.findPodIndexForPodName=p,t.duplicatePod=d})(r=t.PodUtils||(t.PodUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t,r){void 0===r&&(r=!0),this.containerSelector=e,this.itemsSelector=t,this.includeDescendants=r}return Object.defineProperty(e.prototype,"position",{get:function(){},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.scrollItemIntoView=function(e,t,r){var i=this.getContainer(),n=this.getRange(i),a=this.getItems(),o=a[e];if(o){var s=0===e,l=e===a.length-1,u=this.getRange($(o),!0);if(s?t=0:l?t=r||0:null!==t&&void 0!==t||(t=this.getDefaultOverscroll()),n&&u){var c=this.calculatePositionDelta(n,u,t);this.position=this.position+c}}},e.prototype.getPageDownItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n<r.length-1;n++){var a=this.getRange(r.eq(n));if(i+=a.size,i>t.size)return n}return r.length-1}return-1},e.prototype.getPageUpItemIndex=function(e){var t=this.getRange(this.getContainer());if(t){var r=this.getItems();if(0===r.length)return-1;for(var i=0,n=e;n>0;n--){var a=this.getRange(r.eq(n));if(i+=a.size,i>t.size)return n}return 0}return-1},e.prototype.retainPosition=function(e){var t=this.position;try{e()}finally{this.position=t}},e.prototype.handleKeyDown=function(e,t,r){var i=!0,n=e,a=this.getItems(),o=a.length-1;switch(t.keyCode){case $.ui.keyCode.PAGE_UP:var s=this.getPageUpItemIndex(e);n=Math.max(s,0);break;case $.ui.keyCode.PAGE_DOWN:var l=this.getPageDownItemIndex(e);n=Math.min(l,o);break;case $.ui.keyCode.END:n=o;break;case $.ui.keyCode.HOME:n=0;break;default:n=this.getNewIndexOnKeyDown(e,o,t),i=void 0!==n}return void 0!==n&&n!==e&&(r(n),this.scrollItemIntoView(n)),i},e.prototype.onScroll=function(e){var t=this,r=this.getContainer();r.scroll((function(r){var i=t.position/t.max;e(i)}))},e.prototype.getNewIndexOnKeyDown=function(e,t,r){},e.prototype.getRange=function(e,t){void 0===t&&(t=!1)},e.prototype.getDefaultOverscroll=function(){},e.prototype.getContainer=function(){return $(this.containerSelector)},e.prototype.getItems=function(){return this.retrieveItems()},e.prototype.retrieveItems=function(){return this.includeDescendants?this.getContainer().find(this.itemsSelector):this.getContainer().children(this.itemsSelector)},e.prototype.calculatePositionDelta=function(e,t,r){return t.min<e.min?-(e.min-t.min+r):t.max>e.max?t.max-e.max+r:0},e})();e.BaseScrollHelper=t;var r=(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){var e=this.getContainer();return e.scrollTop()},set:function(e){var t=this.getContainer();t.scrollTop()!==e&&t.scrollTop(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollHeight:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){switch(r.keyCode){case $.ui.keyCode.UP:return r.scrollHandled=!0,Math.min(Math.max(e-1,0),t);case $.ui.keyCode.DOWN:return Math.min(e+1,t)}},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerHeight():e.innerHeight();return{min:r.top,max:r.top+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 0},t})(t);e.VerticalScrollHelper=r;var i=(function(e){function t(t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=!0),e.call(this,t,r,n),this.isRtl=i}return __extends(t,e),Object.defineProperty(t.prototype,"position",{get:function(){var e=this.getContainer();return e.scrollLeft()},set:function(e){var t=this.getContainer();t.scrollLeft()!==e&&t.scrollLeft(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"max",{get:function(){var e=this.getContainer()[0];return e?e.scrollWidth:void 0},enumerable:!0,configurable:!0}),t.prototype.getNewIndexOnKeyDown=function(e,t,r){var i=0;switch(r.keyCode){case $.ui.keyCode.LEFT:i=-1;break;case $.ui.keyCode.RIGHT:i=1}if(this.isRtl&&(i=-i),0!==i)return e+=i,e<0&&(e=0),e>t&&(e=t),e},t.prototype.getRange=function(e,t){void 0===t&&(t=!1);var r=e.offset();if(r){var i=t?e.outerWidth():e.innerWidth();return{min:r.left,max:r.left+i,size:i}}return null},t.prototype.getDefaultOverscroll=function(){return 16},t.prototype.calculatePositionDelta=function(t,r,i){var n=e.prototype.calculatePositionDelta.call(this,t,r,i);return this.isRtl?-n:n},t})(t);e.HorizontalScrollHelper=i;var n=(function(){function e(e,t,r){this.lastScrollLeft=0,this.lastScrollTop=0,this.scrollPanel=e,this.syncedPanel=t,this.syncOptions=r,this.onScroll=this.onScroll.bind(this),this.scrollPanel.addEventListener("scroll",this.onScroll)}return e.prototype.dispose=function(){this.scrollPanel.removeEventListener("scroll",this.onScroll)},e.prototype.onScroll=function(e){var t=this;this.syncOptions.syncDelay?(clearTimeout(this.timeoutId),this.timeoutId=setTimeout((function(){t.syncScrollPositions()}),this.syncOptions.syncDelay)):this.syncScrollPositions()},e.prototype.syncScrollPositions=function(){if(this.syncOptions.syncX){var e=this.scrollPanel.scrollLeft;e!==this.lastScrollLeft&&(this.syncedPanel.scrollLeft=e,this.lastScrollLeft=e)}if(this.syncOptions.syncY){var t=this.scrollPanel.scrollTop;t!==this.lastScrollTop&&(this.syncedPanel.scrollTop=t,this.lastScrollTop=t)}},e})();e.ScrollSyncHelper=n})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(t){for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i];a.measureMove&&r.push(new c(e.data.createMoveMeasureRewriter(a.measureMove))),a.entityRename&&r.push(new c(e.data.createEntityRenameRewriter(a.entityRename))),a.propertyRename&&r.push(new c(e.data.createPropertyRenameRewriter(a.propertyRename))),a.hierarchyLevelRename&&r.push(new c(e.data.createHierarchyLevelRenameRewriter(a.hierarchyLevelRename))),a.removeVariation&&r.push(new p(new u(a.removeVariation),a.removeVariation))}return r}function i(e,t){var r=s.asFieldPattern(e);return r.columnHierarchyLevelVariation&&r.columnHierarchyLevelVariation.source.entity===t.entity&&r.columnHierarchyLevelVariation.source.schema===t.schema&&r.columnHierarchyLevelVariation.source.name===t.property&&r.columnHierarchyLevelVariation.variationName===t.name}var n=e.data.SQColumnRefExpr,a=e.data.SQEntityExpr,o=e.data.SQExpr,s=e.data.SQExprConverter,l=e.data.SQExprRewriter;t.createSchemaChangeRewriters=r;var u=(function(e){function t(t){e.call(this),this.change=t}return __extends(t,e),t.prototype.visitHierarchyLevel=function(e){return i(e,this.change)?new n(new a(this.change.schema,this.change.entity),this.change.property):e},t})(l),c=(function(){function e(e){this.rewriter=e}return e.prototype.rewriteQuery=function(e){var t=e.defn;return t=t.rewrite(this.rewriter),e.defn=t,e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.rewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.rewriter)},e})(),p=(function(){function e(e,t){this.rewriter=e,this.change=t}return e.prototype.rewriteQuery=function(e){this.removeDuplicateSQHierarchyLevelExpr(e);var t=e.defn;return t=t.rewrite(this.rewriter),e.defn=t,e},e.prototype.rewriteFilter=function(e){return e.rewrite(this.rewriter)},e.prototype.rewriteExpr=function(e){return e.accept(this.rewriter)},e.prototype.removeDuplicateSQHierarchyLevelExpr=function(e){for(var t=e.defn.select(),r=0;r<t.length;){var n=t[r];if(r++,o.isHierarchyLevel(n.expr)&&i(n.expr,this.change))for(;r<t.length&&o.isHierarchyLevel(t[r].expr)&&o.equals(n.expr.arg,t[r].expr.arg);)e.removeExpr(t[r].expr,!1),r++}},e})()})(r=t.schemaRewriterUtils||(t.schemaRewriterUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var r=[];if(!e||!e.visualContainers)return r;for(var i=0,n=e.visualContainers;i<n.length;i++){var a=n[i];t.addScriptVisualId(a,r)}return r}function r(e,r){var i={totalVisualsCount:0,scriptVisualsUniqueIds:[]};if(!e||!e.sections)return i;for(var n=0,a=e.sections;n<a.length;n++){var o=a[n];if(o.visualContainers){var s=t(o,r);i.scriptVisualsUniqueIds=i.scriptVisualsUniqueIds.concat(s),i.totalVisualsCount+=o.visualContainers.length}}return i}function i(e,r,i,n,a){var o=[];switch(e){case 0:if(!n)return o;a.addScriptVisualId(n,o);break;case 1:o=t(i,a);break;case 2:if(!r)return o;for(var s=0,l=r.sections;s<l.length;s++){var u=l[s],c=t(u,a);o=o.concat(c)}break;default:return o}return o}function n(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n&&n.config&&n.config.singleVisual){var a=n.config.singleVisual.visualType;if(a&&t.isScriptVisual(a))return!0}}return!1}function a(e,t,r,i,n,a){var o=e.control(),s=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_OkButton"),l=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_CancelButton"),u=[new InJs.ModalDialogAction(s,function(e,t){o.hideDialog(),n()}),new InJs.ModalDialogAction(l,function(e,t){o.hideDialog(),a()})],c=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_Title"),p=t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_WarningMessage"),d="<div><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart1")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821887" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink1")+"</a><span> "+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart2")+"</span><br/><span>"+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessagePart3")+' </span><a href= "https://go.microsoft.com/fwlink/?LinkId=821886" target= "_blank">'+t.get("SettingsDataset_RDataSource_RefreshConfirmationDialog_ActionMessageLink2")+"</a></div>";i.message=p;var f={dialogName:c,isDismissable:!1,scope:i,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"customModalDialog",dialogActions:u,notificationType:jsCommon.ModalDialogNotificationType.SecurityWarning,notificationText:p,htmlMessageText:d,focusOnFirstButton:!1,noActiveButtons:!0,flipContentAndNotificationOrder:!0};r.showLegacyWebModalDialog(f)}e.defaultScript="##############################",e.getScriptVisualIdsInSection=t,e.getVisualStasInExploration=r,e.getScriptVisualIds=i,e.visualContainerHasScriptVisuals=n,e.confirmRefreshForRDataSource=a})(t=e.ScriptVisualsUtil||(e.ScriptVisualsUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function t(t,r,i){this.selection=e.createTreeSelectionManager(t),this.scrollHelper=new e.VerticalScrollHelper(r,i),this.getVisibleNodes=t}return t.prototype.onNodeClick=function(e,t){if(t.ctrlKey)this.selection.toggle(e);else if(t.shiftKey&&this.selection.lastSelected){var r=this.selection.lastSelected;this.selection.clear(),this.selection.selectRange(this.getNodesRange(r,e))}else{var i=500;this.lastNodeClickTime&&t.timeStamp-this.lastNodeClickTime>i&&_.isEqual(this.selection.getSelectedItems(),[e])?this.selection.toggle(e):(this.selection.clear(),this.selection.select(e)),this.lastNodeClickTime=t.timeStamp}t.stopPropagation()},t.prototype.onBackgroundClick=function(e){this.selection.clear(),e.stopPropagation()},t.prototype.onKeyDown=function(e){var t=this,r=this.getVisibleNodes(),i=!1,n=this.selection.lastSelected,a=65;e.ctrlKey&&e.keyCode===a&&(this.selection.selectAll(),i=!0),e.keyCode===$.ui.keyCode.ESCAPE&&(this.selection.clear(),i=!0),e.keyCode===$.ui.keyCode.LEFT&&n&&(n.isExpanded?n.isExpanded=!1:n.parent&&this.selectAndScrollTo([n.parent]),i=!0),e.keyCode===$.ui.keyCode.RIGHT&&n?(n.children&&(n.isExpanded?n.children.length>0&&this.selectAndScrollTo([n.children[0]]):n.isExpanded=!0),i=!0):i=this.scrollHelper.handleKeyDown(r.indexOf(this.selection.lastSelected),e,(function(i){e.ctrlKey||e.shiftKey||t.selection.clear(),t.selection.select(r[i])})),i&&(e.stopPropagation(),e.preventDefault())},t.prototype.toggleExpandCollapse=function(e,t){e.isExpanded=!e.isExpanded,t&&t.stopPropagation()},t.prototype.selectAndScrollTo=function(e){var t=this;this.selection.clear(),this.selection.selectRange(e),requestAnimationFrame((function(){var r=t.getVisibleNodes(),i=r.indexOf(e[0]),n=30;t.scrollHelper.scrollItemIntoView(i,n)}))},t.prototype.getNodesRange=function(e,t){var r,i=this.getVisibleNodes(),n=i.indexOf(e),a=i.indexOf(t),o=Math.min(n,a),s=Math.max(n,a);if(o>-1){r=[];for(var l=o;l<=s;l++)r.push(i[l])}return r},t})();e.TreeHelper=t})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createTreeSelectionManager=t;var r=(function(){function e(e){this.selectedItems=[],this.getItems=e}return Object.defineProperty(e.prototype,"lastSelected",{get:function(){return _.last(this.selectedItems)},enumerable:!0,configurable:!0}),e.prototype.getSelectedItems=function(){return _.clone(this.selectedItems)},e.prototype.select=function(e){e.isSelected||(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.selectRange=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.select(i)}},e.prototype.selectAll=function(){this.selectRange(this.getItems())},e.prototype.toggle=function(e){e.isSelected?(e.isSelected=!1,this.selectedItems.splice(this.selectedItems.indexOf(e),1)):(e.isSelected=!0,this.selectedItems.push(e))},e.prototype.clear=function(){for(var e=0,t=this.selectedItems;e<t.length;e++){var r=t[e];r.isSelected=!1}this.selectedItems.splice(0)},e})()})(t=e.utils||(e.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=jsCommon.CssConstants,a=e.data.DataViewObjectDescriptors,o=e.data.services.DataViewObjectSerializer,s=jsCommon.PixelConverter,l=e.data.SQExpr,u=e.data.SQExprUtils,c=jsCommon.StringExtensions,p={dataViewMappings:[]};!(function(r){function i(e){if(e&&e.config&&e.config.singleVisual)return e.config.singleVisual.visualType}function d(e){return e.config&&e.config.singleVisual?e.config.singleVisual.query:null}function f(e){var t=e.config;if(t){var r=t.singleVisual;if(r&&r.query){var i=r.query;return i.defn.select()}}}function v(e,t){var i=r.getVisualType(e);if(i&&t){var n=t.getPlugin(i);if(n)return n.capabilities}}function h(e,t){var r=v(e,t);if(r&&!_.isEmpty(r.dataRoles))return r.dataRoles}function g(e){if(e){var t=e.capabilities;if(t&&!_.isEmpty(t.dataRoles))return t.dataRoles}}function m(e,r,i,n){var a=v(e,r);if(a){var o=d(e);if(o){var s=t.services.createVisualCapabilitiesHelper(a,i,n);return s.getNumberRangesForRoles(o)}}}function y(e,t){var i=r.getVisualType(e);if(!i)return!1;var n=t.getPlugin(i);return!!n}function b(e,t){if(!e)return!1;var i=r.getVisualType(e);return!!i&&(r.isQueryVisual(i,t)&&!r.hasGroupByItemsInQuery(e))}function C(e){return!!e&&!r.hasGroupByItemsInQuery(e)}function S(e,t){var i=r.getVisualType(e);return i&&r.isQueryVisual(i,t)}function x(t,r){var i=r.capabilities(t)||p;return!e.visualHost.utils.shouldDisableVisual(t,e.common.localize.shouldDisableMap())&&(i&&e.ScriptResultUtil.findScriptResultMapping(i.dataViewMappings)?r.isScriptVisualQueryable():i&&null!=i.dataViewMappings)}function E(e,t){var i=r.getVisualType(e);return t&&t.isScriptVisual(i)}function w(e,t){var r=t.capabilities(e);return r&&r.dataViewMappings&&!r.disableFocusMode}function P(e){if(e.config&&e.config.singleVisual)return e.config.singleVisual.objects}function V(t,r,i,n,a){if(i){var o=i.defn.select(),s=i.projections,c=[],p=[],d=X(i,r),f=e.DataViewAnalysis.chooseDataViewMappings(i.projections,n,d),v=f.supportedMappings;if(v){for(var h=0,g=v;h<g.length;h++){var m=g[h],y=v.length>1?R(m):null,b=[];for(var C in s)if(null==y||_.contains(y,C))for(var S=s[C],x=0,E=S.all();x<E.length;x++){var w=E[x],P=Z.indexWithName(o,w.queryRef),V=o[P];if(!l.isTransformOutputRoleRef(V.expr)){var D=V.expr.getMetadata(r),T={Restatement:t.getDisplayName(V.expr,r),Name:w.queryRef,Type:F(D.type)},I=u.getKpiMetadata(V.expr,r);I&&(T.kpi=I);var N=w.format||D.format;N&&(T.Format=N);var O=j(D.type);O&&(T.DataCategory=O),c[P]=T,b.push({Name:C,Projection:P,isActive:_.contains(S.activeProjectionRefs,w.queryRef)})}}p.push({DataRoles:b})}return{queryMetadata:{Select:c,Filters:a},visualElements:p}}}}function D(e,t){var r=e;if(r.role)return void t.push(r.role);var i=e;if(i.bind)return void(i.bind.to&&t.push(i.bind.to));var n=e;if(n.for)return void(n.for.in&&t.push(n.for.in));var a=e;if(a.group){if(a.group.by&&t.push(a.group.by),a.group.select)for(var o=0,s=a.group.select;o<s.length;o++){var l=s[o];D(l,t)}}else{var u=e;if(u.composite)for(var c=0,p=u.composite;c<p.length;c++){var d=p[c];D(d,t)}else{var f=e;if(f.select)for(var v=0,h=f.select;v<h.length;v++){var l=h[v];D(l,t)}}}}function R(e){var t=[];return e&&(e.categorical&&(e.categorical.categories&&D(e.categorical.categories,t),e.categorical.values&&D(e.categorical.values,t)),e.table&&e.table.rows&&D(e.table.rows,t),e.single&&D(e.single,t),e.tree&&(e.tree.nodes&&D(e.tree.nodes,t),e.tree.values&&D(e.tree.values,t)),e.matrix&&(e.matrix.columns&&D(e.matrix.columns,t),e.matrix.rows&&D(e.matrix.rows,t),e.matrix.values&&D(e.matrix.values,t))),t=_.unique(t)}function F(e){switch(e.extendedType){case 66048:return 67;case 131584:return 35}switch(e.primitiveType){case 1:return 2048;case 2:case 3:return 1;case 4:return 3;case 5:return 4096;case 6:return 20;case 7:return 4;case 9:return 8}}function j(e){return ee[e.categoryString]}function T(e,t){if(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.defn){var r=e.config.singleVisual.query.projections,i=e.config.singleVisual.query.defn.select();if(r&&i.length>0)for(var n in r)for(var a=r[n],o=0,s=a.all();o<s.length;o++){var l=s[o],u=jsCommon.ArrayExtensions.findItemWithName(i,l.queryRef);if(u){var c=u.expr,p=c.getMetadata(t);if(p&&0===p.kind&&null==p.aggregate)return!0}}return!1}}function I(e){return function(t){return e===t}}function N(e,t,r,i){return function(n){if(e===n)return!0;var a=r&&r.getVisualRelationshipFilterAction(t,e,n,i);return 3!==a}}function O(t,r){t.publishToChannel(e.explore.services.events.dataSelectionChanged,{affectContainer:function(e){return e===r}})}function M(t,i,n,a,s,l,u,c){if(l){var p,d=t.capabilities(l.visualType);if(d){var f=r.describeForPinning(i,s,l.query,d.dataViewMappings,u);if(f){var v=o.serializeObjects(l.objects,d.objects);p=a.transforms&&d&&d.objects?e.data.services.DataViewTransformActionsSerializer.serializeDataViewTransformActions(a.transforms,d.objects):{objects:v},p.objects=p.objects||v,p.visualElements=f.visualElements,p.queryMetadata=f.queryMetadata}}return{queryObject:a.options.query.command,dataObject:n,transformsObject:p,dataUpdatedTime:c}}}function A(e){for(var t=jsCommon.ArrayExtensions.createWithName(),r={},i=0,n=e.visualContainers;i<n.length;i++){var a=n[i],o=c.findUniqueName(r,"VisualContainer");r[o]=!0,t.push({name:o,visualContainer:a})}return t}function q(t,r){t.publishToChannel(e.explore.services.events.visualContainerChanged,{affectContainer:function(e){return e!==r}})}function U(t){return _.some(t,(function(t){return t.dsr&&t.dsr.vsName===e.common.constants.onPremiseVSName}))}function L(e){return e&&null!=e.fontSize?s.fromPoint(e.fontSize):s.toString(r.DefaultTitleFontSizeInPixel)}function z(t){var r=L(t),i={fontFamily:te,fontSize:r};return e.TextMeasurementService.estimateSvgTextHeight(i)}function G(e,t,r,i){var a={},o=null!=t;return a[n.transformProperty]=o?"scale("+t+")":"",a[n.widthProperty]=o?e.width:"",a[n.heightProperty]=o?e.height:"",a[n.borderProperty]=i||"",a[n.backgroundColorProperty]=r||"",a}function B(t){if(t&&t.show){var r=e.visuals.visualBackgroundHelper.getDefaultValues();return(t.transparency||0===t.transparency)&&(r.transparency=t.transparency),t.color&&(r.color=t.color),e.common.utils.ColorUtility.hexToRGBString(r.color,(100-r.transparency)/100)}}function Q(e){return null!=e&&null!=e.metadata&&null!=e.metadata.segment}function k(e){if(e&&e.defn){var t=e.defn.groupBy();return!_.isEmpty(t)}return!1}function H(e){var t=r.getVisualQuery(e);return k(t)}function W(e,t){var i=t.capabilities(e);return!(!i||!r.isQueryVisual(e,t))&&!!a.findSelfFilter(i.objects)}function K(e,t,i){var n=r.getDataRolesForVisual(e,t),a=d(e);if(a&&!_.isEmpty(n)){var o=n[0].name,s=a.tryGetExprs(o);return!_.isEmpty(s)&&_.any(s,(function(e){var t=e.getMetadata(i);if(t)return t.type.text}))}}function J(e,t,r){var i=Y(e,r);if(_.isEmpty(i))return!1;for(var n=0,a=i;n<a.length;n++){var o=a[n],s=1===u.getAggregateBehavior(o,t);if(s)return!0}return!1}function X(t,r){for(var i={},n=t.defn.select(),a=0,o=n;a<o.length;a++){var s=o[a],l=s.name,u=s.expr.getMetadata(r);if(u){var c=u.kind,p=void 0;0===c?p=e.VisualDataRoleKind.Grouping:1===c&&(p=e.VisualDataRoleKind.Measure),i[l]=p}}return i}function $(e){for(var t=0,r=e.sections;t<r.length;t++)for(var i=r[t],n=0,a=i.visualContainers;n<a.length;n++){var o=a[n];delete o.cachedData}}function Y(t,r){var i=d(t);if(i){var n=v(t,r);if(n&&n.filterMappings&&n.filterMappings.measureFilter&&n.filterMappings.measureFilter.targetRoles){for(var a=n.filterMappings.measureFilter.targetRoles,o=_.chain(n.dataRoles).filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping})).map((function(e){return e.name})).difference(a).value(),s=[],l=0,u=o;l<u.length;l++){var c=u[l];i.projections[c]&&s.push.apply(s,i.projections[c].all())}var p=f(t);return _.isEmpty(s)?void 0:_.chain(p).filter((function(e){return _.some(s,(function(t){return t.queryRef===e.name}))})).map((function(e){return e.expr})).value()}}}var Z=jsCommon.ArrayExtensions,ee=e.data.ConceptualDataCategory;r.DefaultTitleFontSizeInPixel=12;var te="wf_segoe-ui_normal";r.getVisualType=i,r.getVisualQuery=d,r.getSelectExprs=f,r.getVisualCapabilities=v,r.getDataRolesForVisual=h,r.getDataRolesForVisualPlugin=g,r.getNumberRangesForRoles=m,r.isSupportedVisual=y,r.canConvertVisual=b,r.canFormatVisual=C,r.isQueryVisualContainer=S,r.isQueryVisual=x,r.isScriptVisual=E,r.supportsFocusMode=w,r.getObjectDefinitions=P,r.describeForPinning=V,r.discoverRolesForMapping=D,r.getRolesForDataViewMapping=R,r.toSemanticType=F,r.toConceptualDataCategory=j,r.hasGrouping=T,r.contractEqualityComparator=I,r.filterAffects=N,r.clearDataSelection=O,r.createCacheEntry=M,r.generateNameMapForVisualContainers=A,r.notifyVisualContainersExceptSource=q,r.hasOnPremDataSource=U,r.getTitleFontSize=L,r.getTitleHeight=z,r.getVisualStyleAttributes=G,r.getVisualBackgroundRGBColor=B,r.isSegment=Q,r.hasGroupByItems=k,r.hasGroupByItemsInQuery=H,r.supportVisualSearch=W,r.containSearchableField=K,r.hasFilterMappingWithNonAggregatableColumns=J,r.createRoleKindByQueryRef=X,r.clearVisualContainerQueryCaches=$})(i=r.VisualContainerUtils||(r.VisualContainerUtils={}))})(r=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i,n=e.data.SQExpr,a=e.data.SQExprConverter,o=jsCommon.StringExtensions,s=e.explore.util.VisualContainerUtils;!(function(r){function i(r,i,n){if(!i||!i.column||!i.column.groupingMetadata)return t.services.GroupMode.None;if(i.column.groupingMetadata.binningMetadata)return t.services.GroupMode.Binning;if(n){var a=n.getGroupingDesignState(r,i.name);if(e.contract.checkValue(a,"groupingDesignState"),a.partitionTable)return t.services.GroupMode.Clustering}return t.services.GroupMode.Basic}function l(e,r,n){var a=i(e,r,n);return a===t.services.GroupMode.Basic||a===t.services.GroupMode.Binning}function u(e,r,n){var a=i(e,r,n);return a===t.services.GroupMode.Clustering}function c(e){return!(!e||!e.column||!e.column.groupingMetadata||e.column.groupingMetadata.binningMetadata)}function p(e,t){if(t&&d(e,t)&&(n.isColumn(t)||n.isGroupRef(t))){var r=t.getConceptualProperty(e);return f(r)}return!1}function d(e,t){return x(e,t).canEdit}function f(e){return e&&!!(e.type.dateTime||e.type.integer||e.type.numeric||e.type.text)}function v(e,t){return o.constructNameFromList(e,t.get("GroupDefinition_And"),F)}function h(e){if(e&&e.column&&e.column.keys){var t=e.column.keys;return 1===t.length&&t[0].name!==e.name||t.length>1}return!1}function g(e,t){var r=t&&t.defn.select();
if(r&&r.length>0&&e)for(var i=0,n=e;i<n.length;i++){var a=n[i];if(!a||!a.dataMap)return;var o=Object.keys(a.dataMap),s=_.size(o);if(2===s){var l=r.withName(o[0]),u=r.withName(o[1]);if(l&&u)return D(l.expr,u.expr)}}}function m(e,t){_.any(e,(function(e){return e.blankDefaultPlaceholder}))||e.splice(0,0,{name:t.get("NullValue"),blankDefaultPlaceholder:!0})}function y(e){return _.filter(e,(function(e){return!e.blankDefaultPlaceholder}))}function b(t,r,i,n){var a=[],o=s.getVisualCapabilities(t,r);if(o&&o.grouping)for(var l=s.getVisualQuery(t),u=l.projections,c=s.createRoleKindByQueryRef(l,n),p=_.filter(o.grouping.groupingRules,(function(e){return e.kind===i})),d=0,f=p;d<f.length;d++){var v=f[d],h=e.DataViewAnalysis.checkForConditionErrors(u,v.condition,c,!1);_.isEmpty(h)&&a.push(v)}return a}function C(t,r){var i=a.asFieldPattern(t);if(i.groupingColumn)return _.map(i.groupingColumn.groupedColumns,(function(t){return e.data.SQExprBuilder.fieldExpr(t)}));if(i.column){var n=r.schema(i.column.schema),o=n.findProperty(i.column.entity,i.column.name);if(c(o)){var s=t.getTargetEntity();return S(o.column.groupingMetadata,s)}}}function S(t,r){return _.map(t.groupedColumns,(function(t){if(P(t))return e.data.SQExprBuilder.columnRef(r,t.name)}))}function x(t,r){var i=e.data.FieldExprPattern.getSchema(a.asFieldPattern(r));return t.schema(i)}function E(e,t){var r=t&&t.defn.select();if(r&&r.length>0&&e&&e.length>0){for(var i=0,a=e;i<a.length;i++){var o=a[i];if(!o.dataMap)return!1;var s=Object.keys(o.dataMap),l=_.size(o.dataMap);if(l>2)return!1;if(2===l){var u=r.withName(s[0]).expr,c=r.withName(s[1]).expr;if(!V(u,c))return!1}else if(1===l){var p=r.withName(s[0]).expr;if(!n.isColumn(p)&&!n.isGroupRef(p))return!1}}return!0}return!1}function w(e){return e.dateTime?t.services.GroupDataType.DateTime:e.numeric?t.services.GroupDataType.Number:t.services.GroupDataType.Category}function P(e){return 0===e.kind}function V(e,t){return!!D(e,t)}function D(e,t){if(n.isGroupRef(e)&&n.isColumn(t)&&R(e,t))return e;if(n.isGroupRef(t)&&n.isColumn(e)&&R(t,e))return t;if(n.isGroupRef(e)&&n.isGroupRef(t)){if(R(e,t))return e;if(R(t,e))return t}}function R(t,r){return e.data.SQExprUtils.sequenceEqual(t.groupedExprs,[r])}var F=50;r.getGroupMode=i,r.isGroupOrBinColumn=l,r.isClusteringColumn=u,r.isGroupOrClusteringColumn=c,r.canExprBeGrouped=p,r.canEditSchema=d,r.canPropertyBeGrouped=f,r.generateGroupDisplayName=v,r.hasGroupOnKeys=h,r.findGroupingColumn=g,r.ensureBlankDefaultPlaceholder=m,r.filterOutBlankDefaultPlaceholder=y,r.getValidGroupingRules=b,r.getGroupedColumns=C,r.getGroupedColumnsFromMetadata=S,r.getConceptualSchema=x,r.canGroup=E,r.getGroupDataType=w})(i=r.GroupUtils||(r.GroupUtils={}))})(r=t.utils||(t.utils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createDataSourcesService=t;var r=(function(){function e(){}return e.prototype.set=function(e){this.dataSources=e},e.prototype.get=function(){return this.dataSources},e})();e.DataSourcesService=r})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t){return new d(e,t)}function n(e,t,r,i){if(!r||!r.includeDefaultAggregate)return i.defaultAggregate(e,t,!1)===e.func}function a(e,t,r,i){var n=o(t,r),a=i.aggregateDisplayNames[n];return l.format(a,[e])}function o(t,r){var i=e.data.aggregateFunctionName(t);return(3===t||4===t)&&r&&r.type&&(r.type.dateTime?i="Date"+i:r.type.text&&(i="String"+i)),i}var s=e.data.FieldExprPattern,l=e.formattingService,u=e.data.SQExpr,c=e.data.SQExprBuilder,p=jsCommon.StringExtensions;r.createDisplayNameService=i;var d=(function(){function r(e,t){this.locOptions=e,this.aggrOps=t}return r.prototype.getDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t))return s.visit(t,new f(r,this.locOptions,this.aggrOps,i,n))},r.prototype.getQualifiedDisplayName=function(t,r,i,n){if(e.data.SQExprConverter.asFieldPattern(t))return v.run(t,r,this.locOptions,this.aggrOps,i,n)},r.prototype.getVisualTitle=function(r,i,n,a){var o=r.title;if(o){if(t.contracts.VisualTitle.isHidden(o))return o;if(null==o.show&&(o.show=!(!n||n.suppressDefaultTitle)),void 0!==o.text)return o}var s=[],l=[],u=[];if(r&&r.query){var c=r.query,d=c.projections;if(d&&n&&!n.suppressDefaultTitle&&n.dataRoles)for(var f=c.defn.select(),v=0,h=n.dataRoles;v<h.length;v++){var g=h[v],m=this.getDisplayNamesByDataRole(d[g.name],f,i);if(m)switch(g.kind){case e.VisualDataRoleKind.Grouping:l=l.concat(m);break;case e.VisualDataRoleKind.Measure:s=s.concat(m);break;case e.VisualDataRoleKind.GroupingOrMeasure:u=u.concat(m)}}}var y=e.Prototype.inherit(o||{show:!n.suppressDefaultTitle});y.titleComponents={};var b;return s.length>0?(y.titleComponents.title=this.concatStringsWithAnd(s,a),l.length>0&&(b=this.concatStringsWithAnd(l,a),y.titleComponents.subtitle=p.format(a.get("VisualTitle_By_Template"),"",b).trim())):u.length>0?y.titleComponents.title=this.concatStringsWithAnd(s,a):l.length>0&&(y.titleComponents.title=this.concatStringsWithAnd(l,a)),b?y.text=p.format(a.get("VisualTitle_By_Template"),y.titleComponents.title,b):y.text=y.titleComponents.title,y},r.prototype.getDisplayNamesByDataRole=function(e,t,r){var i=[];if(e)if(_.isEmpty(e.activeProjectionRefs))for(var n=0,a=e.all();n<a.length;n++){var o=a[n],s=t.withName(o.queryRef),l=this.getDisplayName(s.expr,r);i.push(l)}else for(var u=0,c=e.activeProjectionRefs;u<c.length;u++){var p=c[u],s=t.withName(p);s&&s.expr&&i.push(this.getDisplayName(s.expr,r))}return i},r.prototype.concatStringsWithAnd=function(e,t){if(!_.isEmpty(e)){if(1===e.length)return e[0];var r=e.pop();return p.format(t.get("VisualTitle_And_Template"),e.length>1?e.join(t.get("ListJoin_Separator")):e[0],r)}return null},r})(),f=(function(){function e(e,t,r,i,n){this.schema=e,this.locOptions=t,this.aggrOps=r,this.displayOptions=i,this.stringResourceProvider=n}return e.prototype.visitColumn=function(t){return e.getDisplayNameForProperty(t,this.schema)},e.prototype.visitColumnAggr=function(t){return e.getDisplayNameForSQAggregate(t,c.fromColumnAggr(t),this.schema,this.locOptions,this.aggrOps,this.displayOptions)},e.prototype.visitGroupingColumn=function(t){return e.getDisplayNameForProperty(t,this.schema)},e.prototype.visitGroupingColumnAggr=function(t){return e.getDisplayNameForSQAggregate(t,c.fromGroupingColumnAggr(t),this.schema,this.locOptions,this.aggrOps,this.displayOptions)},e.prototype.visitColumnHierarchyLevelVariation=function(t){return e.getVariationLevelName(t,this.schema,this.displayOptions,this.stringResourceProvider)},e.prototype.visitEntity=function(t){return e.getDisplayNameForEntity(t,this.schema)},e.prototype.visitEntityAggr=function(t){return e.getDisplayNameForSQAggregate(t,c.fromEntityAggr(t),this.schema,this.locOptions,this.aggrOps,this.displayOptions)},e.prototype.visitHierarchy=function(t){return e.getDisplayNameForHierarchy(t,this.schema)},e.prototype.visitHierarchyLevel=function(t){return e.getDisplayNameForHierarchyLevel(t,this.schema,this.displayOptions,this.stringResourceProvider)},e.prototype.visitHierarchyLevelAggr=function(t){return e.getDisplayNameForSQAggregate(t,c.fromHierarchyLevelAggr(t),this.schema,this.locOptions,this.aggrOps,this.displayOptions)},e.prototype.visitMeasure=function(t){return e.getDisplayNameForProperty(t,this.schema)},e.prototype.visitSelectRef=function(e){},e.prototype.visitPercentile=function(e){var t=this.locOptions.quickCalcDisplayNames;return l.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[s.visit(e.arg,this),e.k])},e.prototype.visitPercentOfGrandTotal=function(e){return l.format(this.locOptions.quickCalcDisplayNames.PercentOfGrandTotal,[s.visit(e.baseExpr,this)])},e.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},e.getDisplayNameForEntity=function(e,t){var r=t.schema(e.schema).entities.withName(e.entity);if(r)return r.displayName},e.getDisplayNameForProperty=function(e,t){var r=t.schema(e.schema),i=r.findProperty(e.entity,e.name);if(i)return i.displayName},e.getDisplayNameForHierarchyLevel=function(e,t,r,i){var n=t.schema(e.schema),a=n.findHierarchy(e.entity,e.name);if(a){var o=a.levels.withName(e.level);if(o)return o.displayName||o.column.displayName}},e.getDisplayNameForHierarchy=function(e,t){var r=t.schema(e.schema),i=r.findHierarchy(e.entity,e.name);if(i)return i.displayName},e.getVariationLevelName=function(e,t,r,i){var n=t.schema(e.source.schema).findProperty(e.source.entity,e.source.name);if(n)for(var a=n.column.variations,o=0,s=a;o<s.length;o++){var l=s[o];if(l.name===e.variationName)for(var u=0,c=l.defaultHierarchy.levels;u<c.length;u++){var d=c[u];if(d.name===e.level.level){var f=d.column.displayName;return r&&r.includeVariationSource&&i?p.format(i.get("IncludeVariationSourceDisplayName"),n.displayName,f):f}}}},e.getDisplayNameForSQAggregate=function(t,r,i,o,l,u){var c=i.schema(t.schema).entities.withName(t.entity);if(c){var p=s.visit(r.arg,new e(i,o,l,u));return p?n(r,i,u,l)?p:a(p,r.func,r.arg.getMetadata(i),o):a(c.displayName,r.func,r.arg.getMetadata(i),o)}},e})(),v=(function(){function e(e,t,r,i,n){this.schema=e,this.locOptions=t,this.aggrOps=r,this.displayOptions=i,this.stringResourceProvider=n}return e.run=function(t,r,i,n,a,o){var s=new e(r,i,n,a,o);return s.accept(t)},e.prototype.accept=function(e){var t=e;if(u.isAggregation(t)){var r=s.visit(t.arg,this);return n(t,this.schema,this.displayOptions,this.aggrOps)?r:a(r,t.func,t.arg.getMetadata(this.schema),this.locOptions)}return s.visit(e,this)},e.prototype.visitEntity=function(e){var t=f.getDisplayNameForEntity(e,this.schema);return this.formatWithEntity(t,e)},e.prototype.visitColumn=function(e){var t=f.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},e.prototype.visitColumnAggr=function(e){},e.prototype.visitGroupingColumn=function(e){var t=f.getDisplayNameForProperty(e,this.schema);return this.formatWithEntity(t,e)},e.prototype.visitGroupingColumnAggr=function(e){},e.prototype.visitColumnHierarchyLevelVariation=function(e){var t=f.getVariationLevelName(e,this.schema,this.displayOptions,this.stringResourceProvider);return this.formatWithEntity(t,e.source)},e.prototype.visitEntityAggr=function(e){var t=f.getDisplayNameForSQAggregate(e,c.fromEntityAggr(e),this.schema,this.locOptions,this.aggrOps,this.displayOptions);return this.formatWithEntity(t,e)},e.prototype.visitHierarchy=function(e){var t=f.getDisplayNameForHierarchy(e,this.schema);return this.formatWithEntity(t,e)},e.prototype.visitHierarchyLevel=function(e){var t=f.getDisplayNameForHierarchyLevel(e,this.schema,this.displayOptions,this.stringResourceProvider);return this.formatWithEntity(t,e)},e.prototype.visitHierarchyLevelAggr=function(e){},e.prototype.visitMeasure=function(e){var t=this.locOptions.qualifiedDisplayNameTemplate,r=f.getDisplayNameForProperty(e,this.schema),i=f.getDisplayNameForEntity(e,this.schema);return i?p.format(t,i,r):r},e.prototype.visitSelectRef=function(e){},e.prototype.visitPercentile=function(e){var t=this.locOptions.quickCalcDisplayNames;return l.format(e.exclusive?t.PercentileExclusive:t.PercentileInclusive,[this.accept(c.fieldExpr(e.arg)),e.k])},e.prototype.visitPercentOfGrandTotal=function(e){return l.format(this.locOptions.quickCalcDisplayNames.PercentOfGrandTotal,[this.accept(c.fieldExpr(e.baseExpr))])},e.prototype.visitTransformOutputRoleRef=function(e){return e.expressionName},e.prototype.formatWithEntity=function(e,t){var r=this.locOptions.qualifiedDisplayNameTemplate,i=f.getDisplayNameForEntity(t,this.schema);return i?p.format(r,i,e):e},e})();r.getAggregateKey=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.common.EventChannelType;!(function(e){e[e.Unknown=0]="Unknown",e[e.Swipe=1]="Swipe"})(t.SectionNavigationAction||(t.SectionNavigationAction={}));var i;t.SectionNavigationAction;!(function(e){e.explorationLoaded={type:r.Section,name:"explorationLoaded"},e.explorationUnloaded={type:r.Section,name:"explorationUnloaded"},e.filterContainerChanged={type:r.Visual,name:"filterContainerChanged"},e.formFactorChanged={type:r.Section,name:"formFactorChanged"},e.modelChanged={type:r.Data,name:"modelChanged"},e.enableEditing={type:r.Section,name:"enableEditing"},e.visualRelationshipsModeChanged={type:r.Visual,name:"visualRelationshipsModeChanged"},e.schemaItemActivationChanged={type:r.Data,name:"schemaItemActivationChanged"},e.selectionChanged={type:r.Visual,name:"selectionChanged"},e.dataPointsSelected={type:r.Visual,name:"dataPointsSelected"},e.hyperLinkClicked={type:r.Visual,name:"hyperLinkClicked"},e.undoRedoStackUpdated={type:r.Section,name:"undoRedoStackUpdated"},e.undoRedoStackCleared={type:r.Section,name:"undoRedoStackCleared"},e.clipboardDataUpdated={type:r.Section,name:"clipboardDataUpdated"},e.dataSelectionChanged={type:r.Visual,name:"dataSelectionChanged"},e.drillModeChanged={type:r.Visual,name:"drillModeChanged"},e.refreshExploration={type:r.Visual,name:"refreshExploration"},e.clearAnnotations={type:r.Visual,name:"clearAnnotations"},e.canvasChanged={type:r.Section,name:"canvasChanged"},e.visualContainerChanged={type:r.Visual,name:"visualContainerChanged"},e.visualContainerDataRendered={type:r.Visual,name:"visualContainerDataRendered"},e.visualContainerPositionChanged={type:r.Visual,name:"visualContainerPositionChanged"},e.visualConversion={type:r.Visual,name:"visualConversion"},e.canvasSizeChangedEvent={type:r.Visual,name:"canvasSizeChanged"},e.visualPluginsChanged={type:r.Visual,name:"visualPluginsChanged"},e.addCustomVisual={type:r.Visual,name:"addCustomVisual"},e.deleteCustomVisual={type:r.Visual,name:"deleteCustomVisual"},e.modelingContextChanged={type:r.Data,name:"modelingContextChanged"},e.changeViewMode={type:r.Visual,name:"changeViewMode"},e.saveKeyPressedEvent={type:r.Section,name:"saveEventViaCtrlS"},e.canvasDisplayChanged={type:r.Section,name:"canvasDisplayChanged"},e.canvasDimensionChanged={type:r.Section,name:"canvasDimensionChanged"},e.canvasBackgroundChanged={type:r.Section,name:"canvasBackgroundChanged"},e.popOutModeChanged={type:r.Visual,name:"popOutModeChanged"},e.align={type:r.Section,name:"align"},e.deleteSectionInitiated={type:r.Section,name:"deleteSectionInitiated"},e.sectionNameChanged={type:r.Section,name:"sectionNameChanged"},e.renameSection={type:r.Section,name:"renameSection"},e.sectionChanged={type:r.Section,name:"sectionChanged"},e.podParameterChanged={type:r.Section,name:"podParameterChanged"},e.missingTableRelationship={type:r.Visual,name:"missingTableRelationship"},e.addVisualContainer={type:r.Section,name:"addVisualContainer"},e.changeFormFactor={name:"changeFormFactor",type:r.Section},e.arrangeVisualsOrder={type:r.Section,name:"arrangeVisualsOrder"},e.createImage={type:r.Section,name:"createImage"},e.createBasicShape={type:r.Section,name:"createBasicShape"},e.createTextbox={type:r.Section,name:"createTextbox"},e.importVisual={type:r.Section,name:"importVisual"},e.visualContainerQueryBlocked={type:r.Visual,name:"visualContainerQueryBlocked"},e.newQueryCacheResultAvailable={type:r.Visual,name:"newQueryCacheResultAvailable"},e.exportVisualData={type:r.Visual,name:"exportVisualData"},e.reportSlidesChanged={type:r.Section,name:"reportSlidesChanged"},e.createSection={type:r.Section,name:"createSection"},e.deleteSection={type:r.Section,name:"deleteSection"},e.duplicateSection={type:r.Section,name:"duplicateSection"},e.copyTable={type:r.Section,name:"copyDataTable"},e.deleteVisualContainer={name:"deleteVisualContainer"},e.removeVisualContainerFromLayout={name:"removeVisualContainerFromLayout"},e.toggleSortVisualContainer={name:"toggleSortVisualContainer"},e.filterValueChanged={name:"filterValueChanged"},e.reorderSection={name:"reorderSection"},e.saveAsExploration={name:"saveAsExploration"},e.generateReportQR={name:"generateReportQR"},e.saveExploration={name:"saveExploration"},e.switchSection={name:"switchSection"},e.pauseQueriesChanged={name:"pauseQueriesChanged"},e.redo={name:"redo"},e.undo={name:"undo"},e.showErrorNotification={name:"showErrorNotification"},e.deleteVisual={name:"deleteVisual"},e.deleteCustomVisuals={name:"deleteCustomVisuals"},e.exportToPowerPoint={name:"exportToPowerPoint"},e.exportAsImage={name:"exportAsImage"},e.getClusters={name:"getClusters"}})(i=t.events||(t.events={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,r,i,n,a,o,s,l,u,c,p){var d=t.services.createVisualAuthoringCore(e,o,a,s.featureSwitches);return new v(d,e,r,i,n,l,u,c,p)}var n=e.data.CsvWriter,a=e.data.DataShapeBindingDataReduction,o=t.contracts.DataSource,s=e.data.DataViewTransform,l=e.data.dsr,u=e.data.services.SemanticQuerySerializer,c=jsCommon.StringExtensions;r.createExportVisualDataService=i;var p=1e6,d=3e4,f="data",v=(function(){function r(e,t,r,i,n,a,o,s,l){this.visualPluginService=t,this.visualAuthoring=e,this.visualQueryGenerator=r,this.dataProxy=i,this.conceptualSchemaProxy=n,this.promiseFactory=a,this.displayNameService=o,this.userInfo=s,this.localizationService=l}return r.prototype.exportToCsv=function(e,t,r,i,n,a){var o=this,s=this.promiseFactory.defer();if(null!=r&&null!=n){var l=this.exportDataViewSourceToCSV(t,n,!1,e);if(null!=l)return s.resolve(l),s.promise}return this.conceptualSchemaProxy.get(r).then((function(t){var n=o.getGeneratedQuery(t,i,r,a);if(!n||n.error)return void s.resolve({blob:null,error:0});o.overrideDataQueryLimit(n.options.query.command);var l=n.transforms,u=function(t){return o.exportDataViewSourceToCSV(t,l,!0,e)};o.queryData(n.options,u).then((function(e){s.resolve(e)}),(function(e){s.reject(e)}))}),(function(){s.reject({blob:null,error:3})})),s.promise},r.prototype.exportToExcel=function(t,i,n,a,s){var u=this,c=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(p){var d=u.getGeneratedQuery(p,n,i,a);if(d&&!d.error){var f=d.options.query.command,v=u.generateExportDataCommand(p,f.Commands[0].SemanticQueryDataShapeCommand.Query,s);f.Commands.push(v),u.overrideDataQueryLimit(f),u.clearDataQuerySubtotal(f);var h=e.common.httpService.powerbiRequestOptions();h.responseType="blob";var g=l.generateSemanticQueryRequest([f],o.referenced(i,n.query&&n.query.defn));e.common.httpService.post("/export/xlsx",g,h).then((function(e){if(0===e.data.size)return void c.reject({blob:null,error:1});var i={blob:e.data,isPartialResult:!1,format:1,fileName:r.getFileName(t,1)};c.resolve(i)}),(function(e){c.reject({blob:null,error:2})}))}else c.reject({blob:null,error:0})}),(function(){c.reject({blob:null,error:3})})),c.promise},r.prototype.getGeneratedQuery=function(r,i,n,a){var o=t.contracts.SingleVisualConfig.clone(i),s=this.visualPluginService.getPlugin(e.visuals.plugins.table.name);if(i.visualType!==s.name){var l=this.visualAuthoring.convert({schema:r,source:o,target:s.name});if(!l)return}var u=this.visualPluginService.capabilities(e.visuals.plugins.table.name),c=_.cloneDeep(u.dataViewMappings);return c[0].table.rows.dataReductionAlgorithm={top:{count:this.getDataTopLimitCount()}},this.visualQueryGenerator.execute({dataSources:n,config:o,schema:r,additionalFilters:a,dataViewMappingsOverride:c})},r.prototype.getDataTopLimitCount=function(){try{return this.userInfo&&this.userInfo.isPremiumUser?p:d}catch(e){return d}},r.prototype.queryData=function(e,t){var r=this.promiseFactory.defer();return this.dataProxy.execute(e).then((function(e){var i=t(e.dataViewSource);null!=i?r.resolve(i):r.reject({blob:null,error:1})}),(function(){r.reject({blob:null,error:2})})),r.promise},r.prototype.exportDataViewSourceToCSV=function(t,i,a,o){var l=r.readDataViewSource(t);if(l){var u=l.dataView,c=u&&u.table;if(c&&c.columns.length===i.selects.length){var p=r.isPartialResult(l);if(!p||a){var d=this.visualPluginService.capabilities(e.visuals.plugins.table.name),f=s.apply({transforms:i,dataRoles:d.dataRoles,objectDescriptors:d.objects,prototype:u,colorAllocatorFactory:e.visuals.createColorAllocatorFactory(),dataViewMappings:d.dataViewMappings});if(!_.isEmpty(f))return{isPartialResult:p,blob:n.fromDataView(f[0]),format:0,fileName:r.getFileName(o,0)}}}}},r.readDataViewSource=function(e){var t;try{t=l.read(31,e.data,"csv")}catch(e){return}return t},r.isPartialResult=function(t){if(!t)return!1;var r=_.some(t.warnings,(function(t){return t instanceof e.data.dsr.DsrLimitsWarning}));return!!t.restartToken||r},r.getFileName=function(e,t){var r=f;if(!_.isEmpty(e)){var i=c.normalizeFileName(e);_.isEmpty(i)||(r=i)}switch(t){case 0:return r+".csv";case 1:return r+".xlsx"}},r.prototype.generateExportDataCommand=function(e,t,r){var i=this,n=u.deserializeQuery(t),a={includeVariationSource:!0},o=_.map(n.select(),(function(t){return{queryName:t.name,displayName:i.displayNameService.getDisplayName(t.expr,e,a,i.localizationService),qualifiedDisplayName:i.displayNameService.getQualifiedDisplayName(t.expr,e,a,i.localizationService)}}));this.ensureUniqueName(o,r);var s={ExportDataCommand:{Columns:_.map(o,(function(e){return{QueryName:e.queryName,Name:e.useQualified?e.qualifiedDisplayName:e.displayName}})),FiltersDescription:this.generateFiltersDescriptionString(r)}};return s},r.prototype.ensureUniqueName=function(e,t){for(var r={},i={},n=t.filtersNamesAndRestatements||[],a=e.concat(n),o=0,s=a;o<s.length;o++){var l=s[o],u=l.displayName.toLowerCase(),c=l.qualifiedDisplayName.toLowerCase();u in r&&r[u]!==c&&(i[u]=!0),r[u]=c}for(var p=0,d=e;p<d.length;p++){var f=d[p];f.useQualified=i[f.displayName.toLowerCase()]}for(var v=0,h=n;v<h.length;v++){var g=h[v];g.useQualified=i[g.displayName.toLowerCase()]}},r.prototype.generateFiltersDescriptionString=function(e){if(null==e.filtersNamesAndRestatements)return"";if(0===e.filtersNamesAndRestatements.length)return this.localizationService.get("ExportData_NoAppliedFiltersText");for(var t="",r=0,i=e.filtersNamesAndRestatements;r<i.length;r++){var n=i[r];t=t.concat(this.localizationService.format("ExportData_SingleFilterText",["\n",n.useQualified?n.qualifiedDisplayName:n.displayName,n.restatement]))}return this.localizationService.format("ExportData_AppliedFiltersText",[t])},r.prototype.overrideDataQueryLimit=function(e){e.Commands[0].SemanticQueryDataShapeCommand.Binding.DataReduction={Primary:a.createFrom({top:{count:this.getDataTopLimitCount()}})}},r.prototype.clearDataQuerySubtotal=function(e){for(var t=0,r=e.Commands[0].SemanticQueryDataShapeCommand.Binding.Primary.Groupings;t<r.length;t++){var i=r[t];null!=i.Subtotal&&(i.Subtotal=0)}},r})();r.ExportVisualDataService=v})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,n,a,o){return new m(e,t,r,i,n,a,o)}function n(e){return function(t){return t!==e&&a(t)}}function a(t){if(!t.filter)return!1;var r=t.expression;return(!r||!f.isMeasure(r))&&!e.data.TopNFilterPattern.extractParametersFromFilter(t.filter)}var o=e.data.DataViewObjectDefinitions,s=e.data.DataViewObjectDescriptors,l=e.data.FilterKindDetector,u=e.visuals.plugins,c=e.explore.util.ScriptVisualsUtil,p=e.data.SemanticFilter,d=e.data.services.SemanticQuerySerializer,f=e.data.SQExprUtils,v=e.data.SubqueryRewriter,h=e.data.TopNFilterPruner,g=e.explore.util.VisualContainerUtils;r.createFilterGenerator=i;var m=(function(){function i(e,t,r,i,n,a,o){this.eventBridge=e,this.visualPlugins=t,this.aggrOps=r,this.relationshipService=i,this.hostFilters=n,this.telemetryService=a,this.scriptVisuals=o}return i.prototype.addVisualContainerFilters=function(e,t,r,i,n){this.addFilters(e,i.filters,n,!0,i),r&&this.addFilters(e,r.filters,n,!0),this.addSelfFilter(e,i),t&&this.addFilters(e,t.filters,n,!0);var a=this.hostFilters.getSelectedHostFilters();a&&this.addFilters(e,a.filters,n,!0),r&&(this.addCrossFilter(e,r,i,n),this.addHighlightFilter(e,r,i,n))},i.prototype.calculateVisualContainerFilter=function(e,r,i,n){var a=new y(i);return this.addVisualContainerFilters(a,e,r,i,n),{dataFilter:a.getMergedDataFilter(),highlightFilter:a.getHighlightFilter(),filterMetadata:a.getMetadata(),queryRefsForSingleItemDrillFilters:t.FilterUtils.getQueryRefsForSingleItemDrillFilters(i,n,this.aggrOps)}},i.prototype.calculateDetailVisualFilter=function(e,r,i,n,a){var o=new y(i);return this.addVisualContainerFilters(o,e,r,i,n),0===a&&(a=1),o.mergeFiltersBasedOnRelationship(a),{dataFilter:o.getMergedDataFilter(),highlightFilter:o.getHighlightFilter(),filterMetadata:o.getMetadata(),queryRefsForSingleItemDrillFilters:t.FilterUtils.getQueryRefsForSingleItemDrillFilters(i,n,this.aggrOps)}},i.prototype.clearCrossHighlight=function(e){e.crossHighlight&&this.setCrossHighlight(null,e)},i.prototype.calculateFilterContainerInputFilter=function(e,t,r,i,a){if(r&&t&&a){var o;0===a.scopeType&&(o=a.container);var s=new y(o,n(r));return e&&this.addFilters(s,e.filters,i),2!==a.scopeType&&this.addFilters(s,t.filters,i),o&&(this.addFilters(s,o.filters,i),this.addCrossFilter(s,t,o,i)),s.getMergedDataFilter()}},i.prototype.mergeFiltersBasedOnRelationship=function(e,t,r,i){var n=new y(null);return e&&n.addDataFilter(e),t&&n.addCrossFilter(t),r&&n.setHighlight(r),n.mergeFiltersBasedOnRelationship(i),{dataFilter:n.getMergedDataFilter(),highlightFilter:n.getHighlightFilter()}},i.prototype.getVisualContainerCrossFilters=function(e,t,r){var i=new y(t);return this.addCrossFilter(i,e,t,r),this.addHighlightFilter(i,e,t,r),{dataFilters:i.getCrossFilters(),highlightFilter:i.getHighlightFilter()}},i.prototype.logRFilterTelemetry=function(e,t,r){var i=c.getScriptVisualIdsInSection(t,this.scriptVisuals);_.isEmpty(i)||this.telemetryService.logEvent(e,r,JSON.stringify(i))},i.prototype.setCrossHighlight=function(t,r,i){var n=r.crossHighlight;_.isEmpty(t)?r.crossHighlight=void 0:(r.crossHighlight={sourceVisualContainer:i,selection:t,filter:this.createCrossHighlightFilter(t,i)},this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,r,e.telemetry.CrossFilterType.Highlight)),n!==r.crossHighlight&&(null!=n&&n.sourceVisualContainer!==i&&(g.clearDataSelection(this.eventBridge,n.sourceVisualContainer),i=null),g.notifyVisualContainersExceptSource(this.eventBridge,i))},i.prototype.createCrossHighlightFilter=function(t,r){var i=new y(r),n=e.data.Selector.filterFromSelector(t);if(n&&i.setSelectorFilter(n),r&&r.filters)for(var a=0,o=r.filters;a<o.length;a++){var s=o[a],u=s.filter;if(u){var c=_.any(u.conditions(),(function(e){return 1===l.run(e)}));c||i.addDataFilter(u)}}return i.getMergedDataFilter()},i.prototype.addFilters=function(e,r,i,n,a){if(r)for(var o=0,s=r;o<s.length;o++){var l=s[o],u=t.FilterUtils.shouldDisableFilter(l,i,a,this.aggrOps,this.visualPlugins);if(!u){var c=null!=a,p=l.filter;p&&(c||_.isEmpty(p.validate(i,this.aggrOps)))&&e.tryAddFilter(l,n)}}},i.prototype.addSelfFilter=function(e,t){var r=g.getVisualCapabilities(t,this.visualPlugins),i=this.tryGetSelfFilterProperty(r);if(i){var n=t.config.singleVisual.objects;if(n){var a=o.getValue(n,i,null);a&&e.addDataFilter(a)}}},i.prototype.addCrossFilter=function(t,r,i,n){for(var a=0,o=r.visualContainers;a<o.length;a++){var s=o[a];if(s!==i){var l=g.getVisualCapabilities(s,this.visualPlugins),u=this.tryGetFilterPropertyIdentifier(l);if(u){var c=g.getObjectDefinitions(s);if(c){var p=e.data.DataViewObjectDefinitions.getValue(c,u,null);if(p&&_.isEmpty(p.validate(n,this.aggrOps))){var d=this.relationshipService.getVisualRelationshipFilterAction(r,s,i,n);3!==d&&t.addCrossFilter(p)}}}}}},i.prototype.addHighlightFilter=function(e,t,r,i){if(t.crossHighlight&&t.crossHighlight.sourceVisualContainer!==r&&g.getVisualType(r)!==u.slicer.name){e.setHighlight(t.crossHighlight.filter);var n=this.relationshipService.getVisualRelationshipFilterAction(t,t.crossHighlight.sourceVisualContainer,r,i),a=g.getVisualCapabilities(r,this.visualPlugins);e.mergeFiltersBasedOnRelationship(n,!a.supportsHighlight)}},i.prototype.generateFilterMetadata=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a={Restatement:n.restatement,type:n.type};n.expression&&(a.expression=d.serializeExpr(n.expression)),t.push(a)}return t}},i.prototype.setFilterOnSelectData=function(t,r,i){this.supportsFilterOutput(i)?(this.clearCrossHighlight(r),g.notifyVisualContainersExceptSource(this.eventBridge,i),this.logRFilterTelemetry(e.telemetry.EXCrossFilterScriptVisual,r,e.telemetry.CrossFilterType.Data)):this.setCrossHighlight(t,r,i)},i.prototype.supportsFilterOutput=function(e){return null!=this.tryGetFilterPropertyIdentifier(g.getVisualCapabilities(e,this.visualPlugins))},i.prototype.tryGetFilterPropertyIdentifier=function(e){if(e)return s.findFilterOutput(e.objects)},i.prototype.tryGetSelfFilterEnabledProperty=function(e){if(e)return s.findSelfFilterEnabled(e.objects)},i.prototype.tryGetSelfFilterProperty=function(e){if(e)return s.findSelfFilter(e.objects)},i.prototype.resolveFilterTargets=function(e,t,i,n,a){var o={dataRoles:i,mappings:n,queryProjections:t.projections,select:t.defn.select(),schema:e},s=new r.VisualFilterMappingResolver(o),l=t.defn;return a&&(l=l.addSemanticFilter(a)),s.resolveSemanticQuery(l)},i.prototype.applyFilterOutput=function(e){this.supportsFilterOutput(e)&&g.notifyVisualContainersExceptSource(this.eventBridge,e)},i})(),y=(function(){function e(e,t){if(e){var r=g.getVisualQuery(e);r&&(this.visualSemanticQuery=r.defn)}this.shouldApply=t,this.needToEnsurePrecedence=!1,this.shouldPruneUnnecessaryFilters=!1}return e.prototype.setSelectorFilter=function(e){return this.selectorFilter=e,this},e.prototype.addDrillFilter=function(e){return this.drillFilters=this.drillFilters||[],this.drillFilters.push(e),this.shouldPruneUnnecessaryFilters=!0,this},e.prototype.addDataFilter=function(e){return this.visualSemanticQuery&&(e=v.rewriteSubqueriesForContainingQuery(e,this.visualSemanticQuery)),this.dataFilters=this.dataFilters||[],this.dataFilters.push(e),this.needToEnsurePrecedence=!0,this.shouldPruneUnnecessaryFilters=!0,this},e.prototype.addCrossFilter=function(e){return this.crossFilters=this.crossFilters||[],this.crossFilters.push(e),this.needToEnsurePrecedence=!0,this},e.prototype.setHighlight=function(e){return this.highlightFilter=e,this},e.prototype.tryAddFilter=function(e,t){var r=this.shouldApply;if(r&&!r(e))return this;var i=e.filter;if(!i)return this;if(0===e.precedence?this.addDrillFilter(i):this.addDataFilter(i),t){var n=e.expression&&d.serializeExpr(e.expression);this.metadata=this.metadata||[],this.metadata.push({Restatement:e.restatement,expression:n,type:e.type})}return this},e.prototype.mergeFiltersBasedOnRelationship=function(e,t){switch(e){case 0:case 2:if(!t)break;case 1:this.highlightFilter&&(this.addCrossFilter(this.highlightFilter),this.highlightFilter=void 0);break;case 3:this.highlightFilter=void 0}},e.prototype.getMergedDataFilter=function(){if(this.pruneUnnecessaryFilters(),this.ensurePrecedence(),this.selectorFilter||this.drillFilters||this.dataFilters||this.crossFilters){var e=this.selectorFilter?[this.selectorFilter]:[],t=this.drillFilters||[],r=this.dataFilters||[],i=this.crossFilters||[];return p.merge(e.concat(t).concat(r).concat(i))}},e.prototype.getCrossFilters=function(){return this.crossFilters},e.prototype.getHighlightFilter=function(){return this.highlightFilter},e.prototype.getMetadata=function(){return this.metadata},e.prototype.ensurePrecedence=function(){if(this.needToEnsurePrecedence){if(this.dataFilters){var e=p.merge(this.dataFilters);if(e=v.makeSubqueriesLowerPrecedenceThanColumnFilters(e),this.crossFilters)for(var t=0,r=this.crossFilters;t<r.length;t++){var i=r[t];i&&(e=v.makeSubqueriesLowerPrecedenceThanSpecificFilters(e,i))}this.dataFilters=[e]}this.needToEnsurePrecedence=!1}},e.prototype.pruneUnnecessaryFilters=function(){if(this.shouldPruneUnnecessaryFilters){if(this.dataFilters&&this.selectorFilter){var e=p.merge(this.dataFilters);e=h.removeUnnecessaryTopNFilters(e,this.selectorFilter),this.dataFilters=[e]}this.shouldPruneUnnecessaryFilters=!1;
}},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i,n){return new r(e,t,i,n)}e.createClipboardService=t;var r=(function(){function t(e,t,r,i){this.undoRedoService=e,this.eventBridge=t,this.visualStylePresetService=r,this.rootScope=i}return t.prototype.setData=function(t){this.data=t,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.getData=function(){return this.data},t.prototype.clearData=function(){this.data=void 0,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.copy=function(){this.setData({visuals:this.handler.serializeSelection()})},t.prototype.cut=function(){var e=this;this.rootScope.$evalAsync((function(){e.undoRedoService.register("Cut",(function(){e.setData({visuals:e.handler.serializeSelection()}),e.handler.deleteSelection()}))}))},t.prototype.paste=function(){var e=this;this.rootScope.$evalAsync((function(){e.undoRedoService.register("Paste",(function(){e.handler.deserializeAndDuplicateData(e.getData())}))}))},t.prototype.canPaste=function(){return Boolean(this.data&&this.data.visuals)},t.prototype.setHandler=function(e){this.handler=e},t.prototype.getFormatData=function(){return this.formatData},t.prototype.setFormatData=function(t){this.formatData=t,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.clearFormatData=function(){this.formatData=void 0,this.eventBridge.publishToChannel(e.events.clipboardDataUpdated)},t.prototype.copyFormat=function(){var e=this.handler.serializeSelection();if(1===e.length){var t=e[0],r={visuals:[t]};this.setFormatData(r)}},t.prototype.tryPasteFormat=function(){var e=this;this.canPasteFormat()&&this.rootScope.$evalAsync((function(){e.undoRedoService.register("PasteFormat",(function(){var t=e.getFormatData(),r=e.handler.deserializeVisualContainer(t.visuals[0]).config.singleVisual;e.handler.pasteVisualFormat(t,r,e.visualStylePresetService),e.clearFormatData()}))}))},t.prototype.canPasteFormat=function(){return!(!this.formatData||!this.formatData.visuals)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.DataViewObjectDefinition,n=e.data.DataViewObjectDefinitions,a=e.explore.contracts.VisualContainer;!(function(r){function o(e,r){var i=t.selectionUtils.getSelectedVisual(e);if(i){var n=i.config.singleVisual.visualType,a=r.isCustomVisual(n);if(!a)return i.config.singleVisual}}function s(e,r,i,n){var o=t.selectionUtils.getSelectedVisual(e);if(o&&n){var s=o.config.singleVisual,c=s.visualType,p=r.isCustomVisual(c);if(!p){s.objects||(s.objects={});var d=r.capabilities(c),f=r.capabilities(n.visualType);if(d&&f){for(var v in n.objects){var h=d.objects[v],g=f.objects[v];l(h,g,n,s,v)}var m=a.getObjectDescriptors(c,i);u(m,n,s)}return o}}}function l(t,r,i,a,o){if(t&&r&&o&&!t.suppressFormatPainterCopy&&!r.suppressFormatPainterCopy){var s=i.objects[o];for(var l in t.properties)for(var u=t.properties[l],p=r.properties[l],d=0,f=s;d<f.length;d++){var v=f[d];if(u&&p&&!u.suppressFormatPainterCopy&&!p.suppressFormatPainterCopy&&e.ValueType.fromDescriptor(u.type).equals(e.ValueType.fromDescriptor(p.type))){var h=n.ensure(i.objects,o,v.selector),g=n.ensure(a.objects,o,v.selector);c(l,h,g)}}}}function u(e,t,r){if(e)for(var i in e){var n=e[i];if(n&&t[i])for(var a in n.properties){var o=t[i],s=n.properties;o&&o[a]&&s&&s[a]&&!s[a].suppressFormatPainterCopy&&(r[i]||(r[i]={}),r[i][a]=o[a])}}}function c(e,t,r){var n=t.properties[e],a=r.properties[e];n?r.properties[e]=n:a&&i.deleteSingleProperty(r,e)}r.copyFormatVisualConfig=o,r.pasteFormatVisualConfig=s})(r=t.FormatPainter||(t.FormatPainter={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createServicePauser=t;var r=(function(){function e(){this.isPaused=!1}return e.prototype.register=function(e){var t=jQuery.extend(!0,{},e);return this.updateService(t),t},e.prototype.pause=function(){this.isPaused=!0},e.prototype.resume=function(){this.isPaused=!1},e.prototype.updateService=function(e){var t=function(t){if(_.isFunction(e[t])){var i=e[t],n=r;e[t]=function(){if(!n.isPaused)return i.apply(e,arguments)}}},r=this;for(var i in e)t(i)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new a(e,t,r)}var n=t.util.VisualContainerUtils;r.createPopOutService=i;var a=(function(){function t(e,t,i){var n=this;this.telemetryService=e,this.eventBridge=t,this.selectionService=i,this.eventBridge=t,this.selectionService=i,t.createChannelSubscriptionManager().subscribe(r.events.selectionChanged,(function(){return n.updatePopOutMode()}))}return t.prototype.popOutVisualContainer=function(e,t){this.popOutVisualContainerInternal(e,t,!0)},t.prototype.getPoppedOutVisualContainer=function(){if(this.poppedOutElement)return this.poppedOutElement.visualContainer},t.prototype.clearPopOut=function(){this.clearPopOutInternal(!0,!0)},t.prototype.popOutVisualContainerInternal=function(e,t,i){if(0===t)return void this.clearPopOutInternal(!0,i);r.selectionUtils.selectVisualContainer(e,this.selectionService);var n=new o(e,t);o.equals(n,this.poppedOutElement)||(this.clearPopOutInternal(!1,!1),this.setPopOutMode(n,t,i),this.poppedOutElement=n,this.raiseEvent())},t.prototype.clearPopOutInternal=function(e,t){this.poppedOutElement&&(this.setPopOutMode(this.poppedOutElement,0,t),this.poppedOutElement=void 0,e&&this.raiseEvent())},t.prototype.updatePopOutMode=function(){var e=r.selectionUtils.getDefaultSelectedVisualInSingleOrMultiCase(this.selectionService);e&&null!=e.popOutMode&&0!==e.popOutMode?this.popOutVisualContainerInternal(e,e.popOutMode,!1):this.clearPopOutInternal(!0,!1)},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(r.events.popOutModeChanged)},t.prototype.setPopOutMode=function(t,r,i){var a=t.visualContainer;!i||2!==a.popOutMode&&2!==r||this.telemetryService.logEvent(e.telemetry.EXToggleSeeData,n.getVisualType(a),2===r),a.popOutMode=r},t})(),o=(function(){function e(e,t){this.visual=e,this.mode=t}return Object.defineProperty(e.prototype,"id",{get:function(){if(this.visual)return this.visual.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualContainer",{get:function(){return this.visual},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"popOutMode",{get:function(){return this.mode},enumerable:!0,configurable:!0}),e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.id===t.id&&e.visualContainer===t.visualContainer&&e.popOutMode===t.popOutMode)},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){return new l(e,t)}var i=e.explore.util.ResourcePackageUtils,n=e.data.SQExprBuilder,a=jsCommon.UrlUtils;t.createResourceRegistrationService=r;var o="RegisteredResources",s=1,l=(function(){function e(e,t){this.explorationNavigationService=e,this.resourcePublishingService=t}return e.prototype.add=function(e,t,r){var i=this.ensureResourcePackageExists(),l=a.getBase64ContentFromDataUri(r),u=this.getName(e,i);this.resourcePublishingService.publish(o,u,l);var c={type:t,path:u,name:u,content:r};return i.items.push(c),n.resourcePackageItem(i.name,s,c.name)},e.prototype.getName=function(e,t){var r=e.replace(/ /g,"_");if(r=r.replace(/#/g,"_"),!_.find(t.items,(function(e){return e.name.toUpperCase()===r.toUpperCase()})))return r;var i,n,a=r.lastIndexOf(".");a===-1?(i=r,n=""):(i=r.substring(0,a),n=r.substring(a));for(var o,s=2;;){if(o=i+s.toString()+n,!_.find(t.items,(function(e){return e.name.toUpperCase()===o.toUpperCase()})))break;s++}return o},e.prototype.ensureResourcePackageExists=function(){var e=this.explorationNavigationService.getCurrentExploration(),t=i.ensureResourcePackages(e),r=_.find(t,(function(e){return e.type===s&&e.name===o}));return r||(r={id:void 0,name:o,type:s,items:[]},t.push(r)),r},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createResourcePublishingService=t;var r=(function(){function e(){}return e.prototype.publish=function(e,t,r){},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new v(e)}var n=jsCommon.ArrayExtensions,a=e.explore.contracts,o=e.data.services.DataViewObjectSerializer,s=e.data.DefaultSQExprVisitor,l=jsCommon.JsonExtensions,u=e.data.QueryProjectionCollection,c=e.data.services.SemanticQuerySerializer,p=a.VisualQuery,d=(e.explore.proxies.wireContracts,"Gradient"),f="Size";r.createExplorationSerializer=i;var v=(function(){function i(e){this.visualPlugins=e,this.explorationUpgrader=r.upgrade.createExplorationUpgrader()}return i.prototype.deepCopyExploration=function(e,t){return this.deserializeExploration(this.serializeExploration(e,t),[],!0)},i.prototype.deserializeExploration=function(t,r,i,n){var o,s=this;if(t){var u=this.explorationUpgrader.upgrade(t,r,i);if(!u)return;if(o={id:u.id,width:void 0,height:void 0,sections:void 0,dataSources:void 0,reportId:u.reportId,theme:u.theme},u.sections){var c=_.sortBy(u.sections,(function(e){return void 0!==e.ordinal?e.ordinal:0}));if(o.sections=_.map(c,(function(e){return s.deserializePage(e)})),o.filters=this.deserializeFilterContainers(u.filters),o.dataSources=a.createDataSourceArray(),u.resourcePackages&&(o.resourcePackages=this.deserializeResourcePackages(u.resourcePackages)),u.pods&&(o.pods=_.map(u.pods,(function(e){return s.deserializePod(e)}))),u.config){var p=l.tryParseJSON(u.config);p&&_.isNumber(p.activeSectionIndex)&&p.activeSectionIndex<u.sections.length&&(o.activeSectionIndex=p.activeSectionIndex)}if(n&&n.lastTimeAModelChangeWasDetectedInTheCluster&&!_.isEmpty(n.onPremModelConnectionString))for(var d=jsCommon.DateExtensions.deserializeDate(n.lastTimeAModelChangeWasDetectedInTheCluster),f=0,v=o.sections;f<v.length;f++)for(var h=v[f],g=0,m=h.visualContainers;g<m.length;g++){var y=m[g];if(y.cachedData&&y.cachedData.dataUpdatedTime&&y.cachedData.data){var b=+y.cachedData.dataUpdatedTime-+d;y.useInitialCachedQuery=b>=0}else y.useInitialCachedQuery=!1}}u.report&&(o.report=e.Prototype.inherit(u.report),u.report.linguisticSchemaId&&(o.reportHasLinguisticSchema=!0))}return o},i.prototype.deserializeResourcePackages=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var a=i[r];this.upgradeResourcePackage(a.resourcePackage),t.push(a.resourcePackage)}return n.extendWithName(t)},i.prototype.deserializePage=function(e){if(e){var r={id:e.id,name:e.name,displayName:e.displayName,visualContainers:void 0,size:{displayOption:void 0!==e.displayOption?e.displayOption:0,height:void 0!==e.height?e.height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight,width:void 0!==e.width?e.width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth},filters:this.deserializeFilterContainers(e.filters)};e.transient&&(r.transient=e.transient);var i;if(e.config&&(i=l.tryParseJSON(e.config)),i&&i.objects&&(r.objects=o.deserializeObjects(i.objects,a.Section.objectDescriptors)),e.visualContainers){r.visualContainers=[];for(var n=jsCommon.ArrayExtensions.createWithName(),s=0,u=e.visualContainers;s<u.length;s++){var c=u[s],p=this.deserializeVisualContainer(c);r.visualContainers.push(p);var d=l.tryParseJSON(c.config);d&&!_.isEmpty(d.name)&&n.push({name:d.name,visualContainer:p})}if(i&&i.relationships){r.relationships=[];for(var f=0,v=i.relationships;f<v.length;f++){var h=v[f],g=this.deserializeRelationship(h,n);g&&r.relationships.push(g)}}}return r}},i.prototype.deserializePod=function(e){if(e)return{id:e.id,name:e.name,boundSection:e.boundSection,parameters:this.deserializePodParameters(e.parameters),cortanaEnabled:e.cortanaEnabled}},i.prototype.deserializeFilterCollection=function(e,t,r){if(e){var i=this.explorationUpgrader.upgradeFilterCollection(e,t,r);if(i)return this.deserializeFilterContainers(i.filters)}},i.prototype.deserializeFilterContainer=function(e){return{name:e.name,type:a.FilterType[e.type],expression:e.expression?c.deserializeExpr(e.expression):void 0,filter:e.filter&&e.filter.Where?c.deserializeFilter(e.filter):void 0,restatement:e.restatement,cachedValueItems:this.deserializeFilterLabelIdPairs(e.cachedDisplayNames),howCreated:e.howCreated}},i.prototype.deserializeFilterLabelIdPairs=function(e){if(e&&!(e.length<1)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];if(n.id){var a=o.deserializeScopeIdentity(n.id);a&&t.push({identity:a,displayName:n.displayName})}}return t}},i.prototype.deserializeVisualContainer=function(e,t){void 0===t&&(t=!1);var r={id:t?void 0:e.id,layouts:n.createWithId()};null!=e.popOutMode&&(r.popOutMode=e.popOutMode),null!=e.detailVisualLayout&&(r.detailVisualLayout=e.detailVisualLayout),void 0===e.dataBinaryBase64Encoded&&void 0===e.query&&void 0===e.dataTransforms||(r.cachedData={data:e.dataBinaryBase64Encoded,query:e.query,transforms:e.dataTransforms,dataUpdatedTime:e.dataUpdatedTime?jsCommon.DateExtensions.parseUtcDate(e.dataUpdatedTime):void 0}),r.filters=this.deserializeFilterContainers(e.filters);var i=l.tryParseJSON(e.config);return i&&(i.singleVisual&&(r.config={singleVisual:this.deserializeSingleVisual(i.singleVisual,e.prototypeQuery)}),(a=r.layouts).push.apply(a,i.layouts)),r;var a},i.prototype.deserializeRelationship=function(e,t){var r=t.withName(e.source),i=t.withName(e.target);if(0!==e.type&&r&&i)return{source:r.visualContainer,target:i.visualContainer,type:e.type}},i.prototype.deserializeFilterContainers=function(e){var t=this,r=[];if(!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)){var i=l.tryParseJSON(e);i&&(r=i.map((function(e){return t.deserializeFilterContainer(e)})))}return r},i.prototype.deserializePodParameters=function(e){var t=this,r=[];if(!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)){var i=l.tryParseJSON(e);i&&(r=i.map((function(e){return t.deserializePodParameter(e)})))}return r},i.prototype.deserializePodParameter=function(e){return{name:e.name,boundFilter:e.boundFilter}},i.prototype.deserializeVisualQuery=function(e,t,r,i){var n=new p(t,this.convertProjections(r,t.select(),i));this.upgradeVisualQuery(n,e.visualType),e.query=n},i.prototype.deserializeSingleVisual=function(e,t){var r={visualType:e.visualType||e.visualConfig.visualType},i=e.visualConfig?e.visualConfig.projections:void 0,n=e.projections||{};if(i)for(var a=0,s=i;a<s.length;a++){var u=s[a],p=n[u.role];p||(p=[],n[u.role]=p),p.push(u)}else if(n&&n.length>0){i=n,n={};for(var d=0,f=i;d<f.length;d++){var u=f[d],p=n[u.role];p||(p=[],n[u.role]=p),p.push(u)}}var v=e.prototypeQuery?e.prototypeQuery:t?l.tryParseJSON(t):null;if(v){var h=c.deserializeQuery(v);this.deserializeVisualQuery(r,h,n,e.showAllRoles)}var g=this.deserializeVisualTitle(e.title);g&&(r.title=g);var m=e.background;m&&(r.background=m);var y=e.aspectRatio;y&&(r.aspectRatio=y);var b=e.border;b&&(r.border=b);var C=e.stylePresetName;C&&(r.stylePresetName=C);var S=this.visualPlugins.capabilities(r.visualType);if(S&&e.objects)r.objects=o.deserializeObjects(e.objects,S.objects);else{var x=e.objects;x&&(r.objects=o.deserializeObjects(x,null))}return r},i.prototype.deserializeVisualTitle=function(e){if(e)return e.hidden?{show:!1}:e},i.prototype.convertProjections=function(e,t,r){var i={};for(var n in e){var a=_.contains(r,n);i[n]=this.convertProjectionArray(e[n],t,a)}return i},i.prototype.convertProjectionArray=function(e,t,r){for(var i,n=[],a=0,o=e;a<o.length;a++){var s=o[a],l=this.convertProjection(s,t);s.active&&(i=i||[],i.push(l.queryRef)),n.push(l)}return new u(n,i,r)},i.prototype.convertProjection=function(e,t){var r=e.queryRef;$.isNumeric(e.queryRef)&&(r=t[e.queryRef].name);var i={queryRef:r};return e.format&&(i.format=e.format),i},i.prototype.serializeExploration=function(e,t){var r=this,i=this.serializeExplorationShallowWithResourcePackages(e,t),n=e.sections;return t&&t.withTransientPages||(n=a.Section.filterTransient(n)),i.sections=_.map(n,(function(e,i){return r.serializePage(e,i,t)})),_.isEmpty(e.pods)||(i.pods=_.map(e.pods,(function(e){return r.serializePod(e)}))),i},i.prototype.serializeExplorationShallowWithResourcePackages=function(e,t){var r=e.activeSectionIndex,i=this.createVersionedElementConfig();return _.isNumber(r)&&(i.activeSectionIndex=r),{id:e.id,reportId:e.reportId,theme:e.theme,filters:this.serializeFilterContainers(e.filters),resourcePackages:this.serializeResourcePackages(e.resourcePackages),sections:void 0,config:JSON.stringify(i),layoutOptimization:this.getLayoutOptimizations(e)}},i.prototype.getLayoutOptimizations=function(e){var t=this.getDistinctLayouts(e);return this.getLayoutOptimizationFromLayouts(t)},i.prototype.getDistinctLayouts=function(e){for(var t=e.sections,r=n.createWithId(),i=0,a=t;i<a.length;i++)for(var o=a[i],s=0,l=o.visualContainers;s<l.length;s++)for(var u=l[s],c=0,p=u.layouts;c<p.length;c++){var d=p[c];r.withId(d.id)||r.push(d)}return r},i.prototype.getLayoutOptimizationFromLayouts=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var n=i[r];switch(n.id){case 1:t|=1}}return t},i.prototype.serializeResourcePackages=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a=_.find(n.items,(function(e){return 5===e.type}));if(a&&void 0!==a.content){var o=_.isString(a.content)?jsCommon.JsonExtensions.tryParseJSON(a.content):a.content;o&&(o.content=void 0,a.content=JSON.stringify(o))}t.push({resourcePackage:{id:n.id,name:n.name,type:n.type,items:n.items}})}return t}},i.prototype.serializePage=function(e,r,i){var n=this.serializePageShallow(e,r,i);n.visualContainers=[];for(var a,o=t.util.VisualContainerUtils.generateNameMapForVisualContainers(e),s=0,l=e.visualContainers;s<l.length;s++){var u=l[s];a=_.find(o,(function(e){return e.visualContainer===u})).name,n.visualContainers.push(this.serializeVisualContainer(u,i,a))}return n},i.prototype.serializePageShallow=function(e,r,i){var n={id:e.id,name:e.name,displayName:e.displayName,filters:this.serializeFilterContainers(e.filters),ordinal:r,visualContainers:void 0,transient:e.transient};e.size&&(n.displayOption=e.size.displayOption,n.width=e.size.width,n.height=e.size.height);var s={},l=t.util.VisualContainerUtils.generateNameMapForVisualContainers(e);if(!_.isEmpty(e.relationships)){s.relationships=[];for(var u=0,c=e.relationships;u<c.length;u++){var p=c[u],d=this.serializeRelationship(p,l);d&&s.relationships.push(d)}i&&i.featureUsage&&(i.featureUsage.hasVisualRelationships=!0)}var f=o.serializeObjects(e.objects,a.Section.objectDescriptors);return f&&(s.objects=f),n.config=JSON.stringify(s),n},i.prototype.serializeVisualContainer=function(t,r,i){var n=this.serializeVisualContainerConfig(t,i,r),a=t.layouts.withId(0),o={id:t.id,x:a.position.x,y:a.position.y,z:a.position.z,width:a.position.width,height:a.position.height,config:JSON.stringify(n),filters:this.serializeFilterContainers(t.filters)};return r&&r.withPopOut&&(null!=t.popOutMode&&(o.popOutMode=t.popOutMode),null!=t.detailVisualLayout&&(o.detailVisualLayout=t.detailVisualLayout)),r&&t.cachedData&&((r.withQuery||r.withData)&&(o.query=t.cachedData.queryObject?JSON.stringify(t.cachedData.queryObject):t.cachedData.query,o.dataTransforms=t.cachedData.transformsObject?e.data.services.DataViewTransformActionsSerializer.serializeTransformActions(t.cachedData.transformsObject):t.cachedData.transforms,o.dataUpdatedTime=t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime.toISOString():void 0),r.withData&&(o.dataBinaryBase64Encoded=t.cachedData.dataObject?jsCommon.GzipUtility.compress(JSON.stringify(t.cachedData.dataObject)):t.cachedData.data)),o},i.prototype.serializeRelationship=function(e,t){var r=e.source,i=e.target,n=_.find(t,(function(e){return e.visualContainer===r})),a=_.find(t,(function(e){return e.visualContainer===i}));return{source:n.name,target:a.name,type:e.type}},i.prototype.serializeVisualContainerConfig=function(e,t,r){var i={layouts:e.layouts},n=e.config;if(n&&n.singleVisual){var a=n.singleVisual,s=a.query;i.singleVisual={title:a.title,background:a.background,aspectRatio:a.aspectRatio,border:a.border,stylePresetName:a.stylePresetName,visualType:a.visualType,projections:this.serializeQueryProjections(s?s.projections:void 0),prototypeQuery:s?c.serializeQuery(s.defn):void 0},i.name=t;var l=this.serializeShowAllRoles(s?s.projections:void 0);_.isEmpty(l)||(i.singleVisual.showAllRoles=l,r&&r.featureUsage&&(r.featureUsage.hasShowAllEnabled=!0));var u=this.visualPlugins.capabilities(a.visualType);if(u){var p=o.serializeObjects(a.objects,u.objects);p&&(i.singleVisual.objects=p)}else{var d=a.objects;d&&(i.singleVisual.objects=o.serializeObjects(d,null))}}return i},i.prototype.serializeShowAllRoles=function(e){if(e){var t=_.pick(e,(function(e){return e.showAll===!0}));return _.keys(t)}},i.prototype.serializeQueryProjections=function(e){if(e){var t={};for(var r in e){var i=e[r].all(),n=e[r].activeProjectionRefs;if(i.length>0){t[r]=[];for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s.queryRef,u={queryRef:l};s.format&&(u.format=s.format),_.contains(n,l)&&(u.active=!0),t[r].push(u)}}}return t}},i.prototype.serializePod=function(e){var t=this.serializePodParameters(e.parameters);return{id:e.id,name:e.name,boundSection:e.boundSection,parameters:_.isEmpty(t)?void 0:JSON.stringify(t),cortanaEnabled:e.cortanaEnabled?e.cortanaEnabled:void 0}},i.prototype.serializePodParameters=function(e){if(!_.isEmpty(e)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];t.push({name:n.name,boundFilter:n.boundFilter})}return t}},i.prototype.serializeFilterCollection=function(e){if(!_.isEmpty(e)){var t=this.createVersionedElementConfig();return{filters:this.serializeFilterContainers(e),config:JSON.stringify(t)}}},i.prototype.serializeFilterContainers=function(e){if(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];(0!==n.howCreated||n.filter)&&t.push({name:n.name,expression:n.expression?c.serializeExpr(n.expression):void 0,filter:n.filter?c.serializeFilter(n.filter):void 0,type:a.FilterType[n.type],restatement:n.restatement,cachedDisplayNames:this.serializeFilterLabelIdPairs(n.cachedValueItems),howCreated:n.howCreated})}return t.length>0?JSON.stringify(t):void 0}},i.prototype.serializeFilterLabelIdPairs=function(e){if(e&&!(e.length<1)){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];if(n.identity&&n.identity.expr){var a=o.serializeScopeIdentity(n.identity);a&&t.push({id:a,displayName:n.displayName})}}return t}},i.prototype.createVersionedElementConfig=function(){return{version:r.upgrade.CurrentExplorationVersion}},i.prototype.upgradeVisualQuery=function(t,r){if(r===e.visuals.plugins.filledMap.name&&t.projections[d]){var i=t.projections[d],n=t.projections[f];if(n&&n.all.length>0)for(var a=n.all().length,o=a-1;o>=0;o--)t.removeProjection(f,o);t.projections[f]=i,t.projections[d]=void 0}},i.prototype.upgradeResourcePackage=function(e){void 0===e.type&&(e.type=0)},i})();(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.visitColumnRef=function(e){var t=e.source.accept(this);if(t)return t.column=e.ref,t},t.prototype.visitMeasureRef=function(e){var t=e.source.accept(this);if(t)return t.measure=e.ref,t},t.prototype.visitAggr=function(e){var t=e.arg.accept(this);if(t)return t.aggregate=e.func,t},t.prototype.visitEntity=function(e){var t={schema:e.schema,entity:e.entity};return e.variable&&(t.entityVar=e.variable),t},t.instance=new t,t})(s)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return new o}var i=e.explore.util.ExplorationVersionUtils,n=jsCommon.JsonExtensions,a="0.0";t.createExplorationUpgrader=r;var o=(function(){function e(){this.versionUpgraders=[t.v1_0.createVersionUpgrader(),t.v2_0.createVersionUpgrader(),t.v2_2.createVersionUpgrader(),t.v2_3.createVersionUpgrader()]}return e.prototype.upgrade=function(e,t,r){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgrade(t)})))return e},e.prototype.upgradeFilterCollection=function(e,t,r){if(this.upgradeElement(e,t,r,(function(e,t){return e.upgradeFilterCollection(t)})))return e},e.prototype.getVersionUpgraders=function(){return this.versionUpgraders},e.prototype.upgradeElement=function(e,r,n,o){var s=this.getVersionedElementConfig(e),l=s.version&&_.isString(s.version)?s.version:a;if(i.gt(l,t.CurrentExplorationVersion)){if(r.push({errorType:0}),!n)return}else{for(var u=0,c=this.versionUpgraders;u<c.length;u++){var p=c[u],d=p.getVersion();(i.lt(d,"2.2")||i.gt(d,l))&&o(p,e)}s.version=t.CurrentExplorationVersion,e.config=JSON.stringify(s)}return e},e.prototype.getVersionedElementConfig=function(e){var t;return e.config&&(t=n.tryParseJSON(e.config)),t||(t={version:a}),t},e})()})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.CurrentExplorationVersion="2.4"})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return new p}var i=e.data.services.DataViewObjectSerializer,n=e.visuals.GradientUtils,a=jsCommon.JsonExtensions,o=e.visuals.labelStyle,s=e.visuals.plugins,l=e.data.services.SemanticQuerySerializer,u=e.data.SQExprBuilder,c="1.0";t.createVersionUpgrader=r;var p=(function(){function t(){}return t.prototype.upgrade=function(e){if(e&&(e.filters=this.upgradeFilterContainers(e.filters),e.sections))for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.filters=this.upgradeFilterContainers(i.filters),i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var s=o[n];if(s.filters=this.upgradeFilterContainers(s.filters),s.config){var l=a.tryParseJSON(s.config);if(l&&l.singleVisual){var u=l.singleVisual,c=u.visualType||u.visualConfig.visualType;u.objects=this.upgradeVisualObjects(u.objects,c)}s.config=JSON.stringify(l)}}}},t.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},t.prototype.getVersion=function(){return c},t.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=a.tryParseJSON(e);if(t)for(var r=0,i=t;r<i.length;r++){var n=i[r];this.upgradeFilterContainer(n)}return JSON.stringify(t)}},t.prototype.upgradeFilterContainer=function(e){if(!e.expression&&e.field){var t=d.fieldDef(e.field);t&&(e.expression=l.serializeExpr(t))}void 0===e.howCreated&&(e.howCreated=e.autoGenerated?0:1)},t.prototype.upgradeVisualObjects=function(e,t){switch(this.dropMalformedSelectors(e),t){case s.filledMap.name:return this.upgradeObjectsFilledMap(e);case s.card.name:return this.upgradeObjectsCard(e);case s.donutChart.name:case s.pieChart.name:return this.upgradeObjectsDonutChart(e)}return e},t.prototype.dropMalformedSelectors=function(e){if(e)for(var t in e){var r=e[t];if(r)for(var i=r.length-1;i>=0;i--){var n=r[i],a=n.selector;a&&(a.metadata||delete a.metadata,_.isEmpty(Object.keys(a))&&r.splice(i,1))}}},t.prototype.upgradeObjectsFilledMap=function(t){var r="dataPoint",a="fillRule";t||(t={});var o=t[r];o||(t[r]=o=[]);for(var s,l=0,u=o;l<u.length;l++){var c=u[l];if(!c.selector){s=c;break}}return s||(s={selector:null,properties:{}},o.push(s)),null==s.properties[a]&&(s.properties[a]=i.serializeObjectProperty(n.getDefaultFillRuleDefinition(),e.visuals.filledMapCapabilities.objects[r].properties[a])),t},t.prototype.upgradeObjectsCard=function(e){var t="cardTitle",r="categoryLabels";if(e){var i=e[t];i&&(e[r]=i,delete e[t])}return e},t.prototype.upgradeObjectsDonutChart=function(t){var r="categoryLabels",n="labels",a="labelStyle",s="show";if(t){var c,p=this.getMetadataOnceObjectDefn(t,n),d=this.getPropertyExpr(p,s),f=!!d&&l.deserializeExpr(d).value,v=this.getMetadataOnceObjectDefn(t,r);if(v){var h=this.getPropertyExpr(v,s),g=!!h&&l.deserializeExpr(h).value;f&&g?c=o.both:f&&!g?c=o.data:!f&&g&&(c=o.category),delete t[r]}else{var m=p&&p.properties[a];m||(c=f?o.both:o.category)}if(null!=c){var y=e.visuals.donutChartCapabilities.objects[n].properties;if(!p){var b=t[n];b||(t[n]=b=[]),p=_.find(b,(function(e){return!e.selector})),p||(p={properties:{}},b.push(p))}p.properties[s]=i.serializeObjectProperty(u.boolean(!0),y[s]),p.properties[a]=i.serializeObjectProperty(u.text(c),y[a])}return t}},t.prototype.getMetadataOnceObjectDefn=function(e,t){if(e){var r=e[t];if(!_.isEmpty(r))return _.find(r,(function(e){return!e.selector}))}},t.prototype.getPropertyExpr=function(e,t){if(e){var r=e.properties[t];if(r)return r.expr}},t})();t.VersionUpgrader=p;var d;!(function(e){function t(e){return r(e)||i(e)||n(e)||a(e)}function r(e){var t=e.aggregate;if(void 0!==t){var r=i(e)||a(e);if(r)return u.aggregate(r,t)}}function i(e){var t=e.column;if(t){var r=a(e);if(r)return u.columnRef(r,t)}}function n(e){var t=e.measure;if(t){var r=a(e);if(r)return u.measureRef(r,t)}}function a(e){return u.entity(e.schema,e.entity,e.entityVar)}e.fieldDef=t})(d||(d={}))})(r=t.v1_0||(t.v1_0={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new n}var r=jsCommon.JsonExtensions,i="2.0";e.createVersionUpgrader=t;var n=(function(){function e(){}return e.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,i=e.sections;t<i.length;t++){var n=i[t];if(n.visualContainers)for(var a=0,o=n.visualContainers;a<o.length;a++){var s=o[a],l=void 0;if(s.config&&(l=r.tryParseJSON(s.config)),l=l||{},!l.layouts){var u={x:s.x,y:s.y,z:s.z,width:s.width,height:s.height};l.layouts=[{id:0,position:u}],s.config=JSON.stringify(l)}}}},e.prototype.upgradeFilterCollection=function(e){},e.prototype.getVersion=function(){return i},e})()})(t=e.v2_0||(e.v2_0={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new n}var r=jsCommon.JsonExtensions,i="2.2";e.createVersionUpgrader=t;var n=(function(){function e(){}return e.prototype.upgrade=function(e){},e.prototype.upgradeFilterCollection=function(e){e&&e.filters&&(e.filters=this.upgradeFilterContainers(e.filters))},e.prototype.upgradeFilterContainers=function(e){if(!_.isEmpty(e)){var t=r.tryParseJSON(e);if(t)for(var i=0,n=t;i<n.length;i++){var a=n[i];this.upgradeFilterContainer(a)}return JSON.stringify(t)}},e.prototype.upgradeFilterContainer=function(e){2!==e.howCreated||e.precedence||(e.precedence=0)},e.prototype.getVersion=function(){return i},e})()})(t=e.v2_2||(e.v2_2={}))})(t=e.upgrade||(e.upgrade={}))})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r;!(function(t){var r;!(function(t){function r(){return new c}var i=e.data.DataViewObjectDefinitions,n=e.data.services.DataViewObjectSerializer,a=jsCommon.JsonExtensions,o=e.visuals.plugins,s=e.visuals.slicerMode,l=e.data.SQExprBuilder,u="2.3";t.createVersionUpgrader=r;var c=(function(){function t(){}return t.prototype.upgrade=function(e){if(e&&e.sections)for(var t=0,r=e.sections;t<r.length;t++){var i=r[t];if(i.visualContainers)for(var n=0,o=i.visualContainers;n<o.length;n++){var s=o[n];if(s.config){var l=a.tryParseJSON(s.config);if(l&&l.singleVisual){var u=l.singleVisual,c=u.visualType||u.visualConfig.visualType;u.objects=this.upgradeVisualObjects(u.objects,c)}s.config=JSON.stringify(l)}}}},t.prototype.upgradeFilterCollection=function(e){},
t.prototype.getVersion=function(){return u},t.prototype.upgradeVisualObjects=function(e,t){return t===o.slicer.name?this.upgradeSlicerObjects(e):e},t.prototype.upgradeSlicerObjects=function(t){var r="data",a="mode";t||(t={});var o=i.ensure(t,r,null),u=e.visuals.slicerCapabilities.objects[r].properties;return null==o.properties[a]&&(o.properties[a]=n.serializeObjectProperty(l.text(s.basic),u[a])),t},t})();t.VersionUpgrader=c})(r=t.v2_3||(t.v2_3={}))})(r=t.upgrade||(t.upgrade={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new r(e)}e.createSchemaItemActivationService=t;var r=(function(){function t(e){this.eventBridge=e}return t.prototype.setActiveItem=function(e){_.isEqual(this.activeItems,e)||(this.activeItems=e,this.raiseEvent())},t.prototype.clearActiveItem=function(){this.activeItems&&(this.activeItems=null,this.raiseEvent())},t.prototype.getActiveItem=function(){return this.activeItems},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.schemaItemActivationChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r,i=e.data.FieldExprPattern,n=e.data.SQExprConverter;!(function(e){function t(e,t){var r=n.asFieldPattern(t),o=i.toFieldExprEntityItemPattern(r),s=o.schema,l=o.entity,u=a.createActiveSchemaItem(s,l,r);e.setActiveItem(u)}e.setActiveSchemaItem=t})(r=t.schemaItemActivationUtils||(t.schemaItemActivationUtils={}));var a;!(function(e){function t(e,t,r){var n=i.getPropertyName(r),a=i.getHierarchyName(r)||r.hierarchyLevel&&r.hierarchyLevel.name,s=r.hierarchyLevel&&r.hierarchyLevel.level;return new o(e,t,n,a,s)}e.createActiveSchemaItem=t})(a=t.ActiveSchemaItemFactory||(t.ActiveSchemaItemFactory={}));var o=(function(){function e(e,t,r,i,n){this._schema=e,this._entity=t,this._property=r,this._hierarchy=i,this._hierarchyLevel=n}return Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hierarchy",{get:function(){return this._hierarchy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hierarchyLevel",{get:function(){return this._hierarchyLevel},enumerable:!0,configurable:!0}),e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new a(e)}var n=e.explore.schemaRewriterUtils;r.createSchemaChangeHandler=i;var a=(function(){function e(e){this.visualPluginService=e}return e.prototype.apply=function(e,r){var i=n.createSchemaChangeRewriters(r),a=new o(i);t.util.traverseExploration(e,a,this.visualPluginService)},e})(),o=(function(t){function r(e){t.call(this),this.rewriters=e}return __extends(r,t),r.prototype.visitQuery=function(e){var t=e.defn;if(t)for(var r=this.rewriters,i=0,n=r;i<n.length;i++){var a=n[i];e=a.rewriteQuery(e)}},r.prototype.visitSingleVisualConfig=function(e){e.conversionSourceContext=void 0},r.prototype.visitDataViewObjects=function(t,r){var i=e.data.DataViewObjectDescriptors.findFilterOutput(r);if(i){var n=e.data.DataViewObjectDefinitions.getPropertyContainer(t,i,null);if(n){var a=i.propertyName,o=n[a];if(o){for(var s=this.rewriters,l=0,u=s;l<u.length;l++){var c=u[l];o=c.rewriteFilter(o)}n[a]=o}}}},r.prototype.visitFilter=function(e){var t=this.rewriters,r=e.filter,i=e.expression;if(i&&(e.expression=this.rewriteExpr(e.expression)),r){for(var n=0,a=t;n<a.length;n++){var o=a[n];r=o.rewriteFilter(r)}e.filter=r}},r.prototype.visitSelector=function(e){var t=e.data;if(!_.isEmpty(t)){for(var r=[],i=0,n=t;i<n.length;i++){var a=n[i];a.expr?r.push(this.rewriteDataViewScopeIdentity(a)):_.isEmpty(a.exprs)?_.isEmpty(a.roles)||r.push(a):r.push(this.rewriteDataViewScopeWildcard(a))}e.data=r}},r.prototype.rewriteDataViewScopeIdentity=function(t){return e.data.createDataViewScopeIdentity(this.rewriteExpr(t.expr))},r.prototype.rewriteDataViewScopeWildcard=function(t){for(var r=[],i=0,n=t.exprs;i<n.length;i++){var a=n[i];r.push(this.rewriteExpr(a))}return e.data.DataViewScopeWildcard.fromExprs(r)},r.prototype.rewriteExpr=function(e){for(var t=this.rewriters,r=0,i=t;r<i.length;r++){var n=i[r];e=n.rewriteExpr(e)}return e},r})(t.util.DefaultExplorationVisitor)})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return new i(e,t)}var r={updateUrl:!0,action:e.SectionNavigationAction.Unknown};e.createExplorationNavigationService=t;var i=(function(){function t(e,t){this.eventBridge=t,this.explorationProxy=e}return t.prototype.goto=function(t,i){if(i=i?_.merge(r,i):r,this.currentSection=t,this.raiseEvent(),i.updateUrl){var n={name:t.name,displayName:t.displayName,action:i.action};this.eventBridge.publishToChannel(e.events.sectionChanged,n)}},t.prototype.loadExploration=function(e){this.exploration=e,this.raiseExplorationLoadedEvent(e)},t.prototype.getCurrentSection=function(){return this.currentSection},t.prototype.getAllSections=function(){return this.exploration.sections},t.prototype.getCurrentExploration=function(){return this.exploration},t.prototype.getCurrentExplorationAsync=function(){var e=this,t={id:this.exploration.reportId};return this.explorationProxy.get(t).then((function(t){return e.exploration.report=t.report,t}))},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.canvasChanged)},t.prototype.raiseExplorationLoadedEvent=function(t){this.eventBridge.publishToChannel(e.events.explorationLoaded,t)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r){return new n(e,t,r)}e.createReportTileService=t;var r=10,i=2,n=(function(){function e(e,t,r){this.promiseFactory=e,this.explorationProxy=t,this.timeout=r,this.explorationJobsQueue=[],this.inProgressJobsQueue=[]}return e.prototype.getExploration=function(e,t){var r=this.promiseFactory.defer();return this.explorationJobsQueue.push({reportId:e,sectionId:t,deferred:r}),this.scheduleLoadExploration(),r.promise},e.prototype.scheduleLoadExploration=function(){var e=this;this.delayTimeout&&this.timeout.cancel(this.delayTimeout),this.delayTimeout=this.timeout((function(){e.loadExplorations()}),r)},e.prototype.loadExplorations=function(){var e=this,t=this.explorationJobsQueue;if(!_.isEmpty(t)){var r=t.shift();this.inProgressJobsQueue.push(r);var i=this.shouldRequestForAllSection(r.reportId,r.sectionId),n=r.reportId,a=i?null:r.sectionId;i&&(this.inProgressJobsQueue=this.inProgressJobsQueue.concat(_.remove(t,(function(e){return e.reportId===n}))));var o={id:n,sectionId:a,allowCache:!0};this.explorationProxy.get(o).then((function(t){e.processResult(o.id,o.sectionId,t)}),(function(){e.processResult(o.id,o.sectionId,null)})),this.loadExplorations()}},e.prototype.processResult=function(e,t,r){for(var i=[],n=0,a=this.inProgressJobsQueue;n<a.length;n++){var o=a[n];o.reportId!==e||_.isNumber(t)&&t!==o.sectionId?i.push(o):r?o.deferred.resolve(r):o.deferred.reject(r)}this.inProgressJobsQueue=i},e.prototype.shouldRequestForAllSection=function(e,t){if(null==t)return!0;var r=this.explorationJobsQueue;if(_.isEmpty(r))return!1;for(var n=0,a=0,o=r;a<o.length;a++){var s=o[a];if(s.reportId===e){if(null==s.sectionId)return!0;if(s.sectionId!==t&&n++,n>=i)return!0}}return!1},e})();e.ReportTileService=n})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,i){var n=r.createSelectableVisualContainer(e);t.selectElement(n,i)}function i(e,t){var r=o(t);_.contains(r,e)&&n(_.without(r,e),t)}function n(e,t){var i=_.map(e,(function(e){return r.createSelectableVisualContainer(e)}));t.selectElements(i)}function a(e,t){var r=o(t);return _.contains(r,e)}function o(e){return _.chain(e.getSelectedElements()).map((function(e){return e.visualContainer})).compact().value()}function s(e){return o(e).length>1}function l(e){var t=o(e);if(1===t.length)return t[0]}function u(e){var t=o(e);if(t.length>1)for(var r=t[0].config.singleVisual.visualType,i=1,n=t.length;i<n;i++)if(t[i].config.singleVisual.visualType!==r)return null;return t[0]}e.selectVisualContainer=t,e.unselectVisualContainer=i,e.selectVisualContainers=n,e.isVisualContainerSelected=a,e.getSelectedVisuals=o,e.hasMultipleVisualContainerSelection=s,e.getSelectedVisual=l,e.getDefaultSelectedVisualInSingleOrMultiCase=u})(t=e.selectionUtils||(e.selectionUtils={}));var r;!(function(e){function t(e){return n.createFromVisualContainer(e)}e.createSelectableVisualContainer=t})(r=e.SelectableItemFactory||(e.SelectableItemFactory={}));var i;!(function(e){function t(e,t){if(e.length!==t.length)return!1;for(var r=0,i=e.length;r<i;r++)if(!n.equals(e[r],t[r]))return!1;return!0}e.equals=t})(i=e.SelectableUtils||(e.SelectableUtils={}));var n=(function(){function e(){}return Object.defineProperty(e.prototype,"id",{get:function(){if(this._visualContainer)return this._visualContainer.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visualContainer",{get:function(){return this._visualContainer},enumerable:!0,configurable:!0}),e.createFromVisualContainer=function(t){var r=new e;return r._visualContainer=t,r},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.id===t.id&&e.visualContainer===t.visualContainer)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i,n){return new o(e,t,r,i,n)}var i=e.common.contracts.TenantType,n=e.explore.util.VisualContainerUtils,a=e.common.constants.HostType;t.createScriptVisualsService=r;var o=(function(){function e(e,t,r,i,n){this.services={visualPlugin:e,featureSwitchService:t,localizationService:r,userInfo:i,embedModeService:n}}return e.prototype.addScriptVisualId=function(e,t){var r=n.getVisualType(e);this.services.visualPlugin.isScriptVisual(r)&&e.id&&t.push(e.id)},e.prototype.showEnableScriptVisualDialogIfRequired=function(e,t){return!1},e.prototype.getScriptVisualErrorDetails=function(){var e,t=this,r=this.services.localizationService,i=this.services.featureSwitchService.featureSwitches;return r.ensureLocalization((function(){if(i.scriptVisualEnabled){var n=t.services.embedModeService.isAnonymousLiveEmbed();if(n)return void(i.scriptVisualAnonymousEmbeddingEnabled||(e=t.buildErrorDetails(r.get("RError_RVisualsNotSupportedInEmbedReports"))));var a=t.getUserInfoForErrorDetails();a&&a.isViralTenant?e=t.buildErrorDetails(r.get("RError_RVisualsNotSupportedForViralTenant")):i.rScriptVisualEnabled===!1?e=t.buildErrorDetails(r.get("RError_RVisualsDisabledByAdmin")):a&&!a.isPremiumUser&&(e=t.buildErrorDetails(r.get("RError_RVisualsIsProFeature")))}else e=t.buildErrorDetails(r.get("RError_RVisualsNotSupported"))})),e},e.prototype.overrideEmbeddedErrorDetails=function(e){var t=this.services.embedModeService.isAppTokenEmbed()||this.services.embedModeService.isSaasEmbed(),r=this.services&&this.services.localizationService;if(t&&e){var i=e,n=[{errorInfoKey:r.get("RError_RVisualsEmbeddedText"),errorInfoValue:r.get("RError_RVisualsErrorInEmbedReports")}];return i.message=r.get("RError_RVisualsEmbeddedText"),i.displayableErrorInfo=n,i.helpLink="",i}},e.prototype.shouldBlockScriptVisual=function(){var e=this.services.featureSwitchService.featureSwitches,t=this.getUserInfoForErrorDetails(),r=this.services.embedModeService.isAnonymousLiveEmbed();return r?!e.scriptVisualAnonymousEmbeddingEnabled||!e.scriptVisualEnabled:!e.scriptVisualEnabled||t&&t.isViralTenant||!e.rScriptVisualEnabled||t&&!t.isPremiumUser},e.prototype.canLaunchExternalIDE=function(){return!1},e.prototype.launchExternalIDE=function(e){return null},e.prototype.openOptionsDialog=function(){return null},e.prototype.buildErrorDetails=function(e){return{message:e,displayableErrorInfo:[],errorType:1}},e.prototype.getUserInfoForErrorDetails=function(){var e=this.services.userInfo;if(e&&!Array.isArray(e)&&(!this.isMobile||void 0!==e.isPremiumUser)){var t=e.userMetadata&&e.userMetadata.tenantMetadata&&e.userMetadata.tenantMetadata.tenantType===i.ViralTenant;return{isViralTenant:t,isPremiumUser:e.isPremiumUser}}},Object.defineProperty(e.prototype,"isMobile",{get:function(){if(void 0===this._isMobile){var e=jsCommon.QueryStringUtil.parseQueryString(),t=e[a.hostTypeQueryParamKey]||a.none,r=[a.android,a.ios,a.ioswk,a.windowsstore];this._isMobile=r.indexOf(t)>=0}return this._isMobile},enumerable:!0,configurable:!0}),e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return new i(e)}var r=jsCommon.ArrayExtensions;e.createSelectionService=t;var i=(function(){function t(e){this.eventBridge=e,this.selectedElements=r.createWithId()}return t.prototype.selectElement=function(e,t){this.selectElements([e],t)},t.prototype.selectElements=function(t,r){if(!e.SelectableUtils.equals(t,this.selectedElements)){if(r||this.clearSelectionCore(!1),this.selectedElements.length){for(var i=this.selectedElements.length,n=0;n<i;n++)if(this.selectedElements[n]===t[0]){this.selectedElements.splice(n,1);break}i===this.selectedElements.length&&this.addISelectable(t)}else this.addISelectable(t);this.raiseEvent()}},t.prototype.clearSelection=function(){this.clearSelectionCore(!0)},t.prototype.addISelectable=function(e){this.selectedElements=r.extendWithId(this.selectedElements.concat(e))},t.prototype.clearSelectionCore=function(e){this.selectedElements=r.createWithId(),e&&this.raiseEvent()},t.prototype.getSelectedElements=function(){return this.selectedElements},t.prototype.raiseEvent=function(){this.eventBridge.publishToChannel(e.events.selectionChanged)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i,a,o,s,l,u,c){return new n(e,t,r,i,a,o,s,l,u,c)}r.createEmbedService=i;var n=(function(){function r(e,t,r,i,n,a,o,s,l,u){this.locationService=e,this.promiseFactory=t,this.explorationSerializer=r,this.conceptualSchemaProxy=i,this.visualQueryGenerator=n,this.dataProxy=a,this.visualPlugin=o,this.displayNameService=s,this.filterGenerator=l,this.activeGroupId=u}return r.prototype.createEmbedUri=function(e){switch(e.embedType){case t.contracts.EmbedType.Interactive:return this.createInteractiveEmbedUri(e);default:return this.createStaticEmbedUri(e)}},r.prototype.createSharepointEmbedUri=function(t){var i=this.locationService.host(),n=r.protocol.concat(i),a=this.activeGroupId.activeGroupObjectId,o=r.sharePointEmbedHostPathEncodedReport+t;a&&a!==e.common.constants.myWorkspaceGroupId&&(o=o+r.sharePointEmbedHostPathGroupId+a);var s=jsCommon.Utility.urlCombine(n,o);return s},r.prototype.createInteractiveEmbedUri=function(t){var i=t.snapshotId,n=this.locationService.host(),a=r.protocol.concat(n),o=e.common.ClusterLocationHelper.getClusterIndexForClusterUri(),s="";o&&(s="&c="+o);var l=void 0,u=void 0,c=window.tenantId;if(c&&i){var p={k:i,t:c,c:o};l=btoa(JSON.stringify(p)),u=jsCommon.Utility.urlCombine(a,r.interactiveEmbedHostPathEncodedReport+encodeURIComponent(l))}else u=jsCommon.Utility.urlCombine(a,r.interactiveEmbedHostPath+encodeURIComponent(i)+s);return u},r.prototype.createStaticEmbedUri=function(e){var t={storageHost:e.resourceUri,cultureInfo:e.culture},i=btoa(JSON.stringify(t));if(!e.hostUri){var n=this.locationService.host().split(".");n&&n.length>0&&(e.hostUri=r.protocol.concat(n[0].concat(r.blobHostSuffix)))}var a=jsCommon.Utility.urlCombine(e.hostUri,r.embedHostPath+i);return a},r.prototype.createEmbedCode=function(e){var t=this.createEmbedUri(e);return'<iframe width="'+e.size.width+'" height="'+e.size.height+'" src="'+t+'" frameborder="0" allowFullScreen="true"></iframe>'},r.prototype.createEmbedReportResource=function(t,r,i){var n=this,a=this.promiseFactory.defer();return this.conceptualSchemaProxy.getWithWireContract(t.dataSources).then((function(o){var s=[],l=_.filter(t.sections,(function(e){return _.contains(r,e.id)}));if(l.length!==r.length)return void a.reject(null);for(var u=0,c=l;u<c.length;u++)for(var p=c[u],d=0,f=p.visualContainers;d<f.length;d++){var v=f[d];(!v.cachedData||i&&i.ignoreExistingCache)&&s.push(n.prepareVisualContainer(o.contract,t,p,v))}n.waitForAll(s).then((function(){var s=n.explorationSerializer.serializeExploration(t,{withData:!0});s.sections=_.filter(s.sections,(function(e){return _.contains(r,e.id)}));var l={conceptualSchemaResponse:o.data,exploration:s,clientVersion:e.build,reportSections:r,enableShareLink:i&&i.enableShareLink,dependencyVersions:{jquery:$.fn.jquery,"jquery-ui":$.ui.version,globalize:"0.1.1"}};a.resolve(l)}))})),a.promise},r.prototype.prepareVisualContainer=function(e,r,i,n){var a=this,o={config:n.config.singleVisual,dataSources:r.dataSources,schema:e,additionalFilters:this.filterGenerator.calculateVisualContainerFilter(r,i,n,e)},s=this.visualQueryGenerator.execute(o);return s?this.dataProxy.execute(s.options).then((function(r){var i=r&&r.dataViewSource?r.dataViewSource.data:void 0;n.cachedData=t.util.VisualContainerUtils.createCacheEntry(a.visualPlugin,a.displayNameService,i,s,e,n.config.singleVisual,a.filterGenerator.generateFilterMetadata(n.filters))})):this.promiseFactory.resolve(null)},r.prototype.waitForAll=function(e){var t=null;t=e.length>0?this.waitForBoth(this.promiseFactory.resolve(null),e[0]):this.promiseFactory.resolve(null);for(var r=1;r<e.length;r++)t=this.waitForBoth(t,e[r]);return t},r.prototype.waitForBoth=function(e,t){var r=this.promiseFactory.defer();return e.then((function(){return t.then((function(){return r.resolve(null)}))})),r.promise},r.embedHostPath="embed/snapshotEmbedHost.html?embedId=",r.interactiveEmbedHostPath="view?key=",r.interactiveEmbedHostPathEncodedReport="view?r=",r.sharePointEmbedHostPathEncodedReport="reportEmbed?reportId=",r.sharePointEmbedHostPathGroupId="&groupId=",r.blobHostSuffix=".blob.core.windows.net/",r.protocol="https://",r})();r.EmbedService=n})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new n(e,r,t,new a(e,i))}var i=e.visualHost.visualPluginServiceHelpers.VisualPluginStorage;t.createExplorationVisualPluginService=r;var n=(function(){function t(t,r,n,o){o=o||new a(t),this.featureSwitches=t,this.resourceLoader=r,this.promiseFactory=n,this.customConvertibleVisualTypes=[],this.globalConvertibleVisualTypes=this.getConvertibleCoreVisualTypeNames(t),this.storage=new i;for(var s in e.visuals.plugins)this.storage.loadPlugin(s,o.getPlugin(s))}return t.prototype.getConvertibleCoreVisualTypeNames=function(t){var r=[e.visuals.plugins.barChart.name,e.visuals.plugins.columnChart.name,e.visuals.plugins.clusteredBarChart.name,e.visuals.plugins.clusteredColumnChart.name,e.visuals.plugins.hundredPercentStackedBarChart.name,e.visuals.plugins.hundredPercentStackedColumnChart.name,e.visuals.plugins.lineChart.name,e.visuals.plugins.areaChart.name,e.visuals.plugins.stackedAreaChart.name,e.visuals.plugins.lineStackedColumnComboChart.name,e.visuals.plugins.lineClusteredColumnComboChart.name,e.visuals.plugins.waterfallChart.name,e.visuals.plugins.scatterChart.name,e.visuals.plugins.pieChart.name,e.visuals.plugins.treemap.name,e.visuals.plugins.map.name,e.visuals.plugins.table.name,e.visuals.plugins.matrix.name,e.visuals.plugins.filledMap.name,e.visuals.plugins.funnel.name,e.visuals.plugins.gauge.name,e.visuals.plugins.multiRowCard.name,e.visuals.plugins.card.name,e.visuals.plugins.kpi.name,e.visuals.plugins.slicer.name,e.visuals.plugins.donutChart.name];t&&(t.scriptVisualEnabled&&t.scriptVisualAuthoringEnabled&&r.push(e.visuals.plugins.scriptVisual.name),t.dataDotChartEnabled&&(r.push(e.visuals.plugins.dataDotClusteredColumnComboChart.name),r.push(e.visuals.plugins.dataDotStackedColumnComboChart.name)),t.sunburstVisualEnabled&&r.push(e.visuals.plugins.sunburst.name),t.shapeMapVisualEnabled&&r.push(e.visuals.plugins.shapeMap.name),t.esriEnabled&&r.push(e.visualHost.EsriVisual),t.pivotTableVisualEnabled&&r.push(e.visuals.plugins.pivotTable.name));var i=e.localStorageService.getData("DEVELOPER_MODE_ENABLED");return i&&r.push(e.visuals.plugins.debugVisual.name),r},t.prototype.getVisuals=function(){return this.storage.getLoadedPlugins()},t.prototype.getConvertibleVisuals=function(){var e=this,t=[];return this.globalConvertibleVisualTypes.forEach((function(r){e.storage.hasPlugin(r)&&t.push(r)})),this.customConvertibleVisualTypes.forEach((function(r){e.storage.hasPlugin(r)&&t.push(r)})),t.map((function(t){return e.storage.getLoadedPlugin(t)}))},t.prototype.ensureThirdPartyPlugins=function(){return i.ensureThirdPartyPlugins(this.storage,this.promiseFactory,this.resourceLoader)},t.prototype.ensurePlugins=function(e,t){var r=this,i=[];if(e&&e.length)for(var n=function(e){if(0===e.type){var n=a.ensurePlugin(e,t).then((function(){return r.addCustomConvertibleVisualType(e.name)}));i.push(n)}},a=this,o=0,s=e;o<s.length;o++){var l=s[o];n(l)}return this.promiseFactory.allSettled(i)},t.prototype.ensurePlugin=function(e,t){return i.ensurePlugin(this.storage,this.promiseFactory,this.resourceLoader,e,t)},t.prototype.addCustomConvertibleVisualType=function(e){this.customConvertibleVisualTypes.indexOf(e)<0&&this.customConvertibleVisualTypes.push(e)},t.prototype.capabilities=function(e){var t=this.getPlugin(e);return t?t.capabilities:void 0},t.prototype.removeAllCustomVisuals=function(){for(var e=0,t=this.customConvertibleVisualTypes;e<t.length;e++){var r=t[e];this.storage.unloadPlugin(r)}this.customConvertibleVisualTypes=[]},t.prototype.removePlugin=function(e){var t=this.getPlugin(e);t&&(this.storage.unloadPlugin(e),_.remove(this.customConvertibleVisualTypes,(function(t){return t===e})))},t.prototype.getTelemetryHostInformation=function(){return{name:"Exploration"}},t.prototype.isCustomVisual=function(t){return e.visualHost.utils.isCustomVisual(this.getPlugin(t),t)},t.prototype.isScriptVisual=function(t){return e.visualHost.utils.isScriptVisual(this.getPlugin(t))},t.prototype.isScriptVisualQueryable=function(){return e.visualHost.utils.isScriptVisualQueryable(this.featureSwitches)},t.prototype.isLightWeightRenderingVisual=function(t){return e.visualHost.utils.isLightWeightRenderingVisual(this.getPlugin(t))},t.prototype.getInteractivityOptions=function(){return{overflow:"hidden"}},t.prototype.loadPluginByNameIfAny=function(t){if(!this.getPlugin(t))return this.storage.hasPlugin(t)?void this.storage.loadPlugin(t):void(e.visuals.plugins[t]&&this.storage.loadPlugin(t,e.visuals.plugins[t]))},t.prototype.getPlugin=function(e){return this.storage.getLoadedPlugin(e)},t.prototype.getStorage=function(){return this.storage},t})();t.ExplorationVisualPluginService=n;var a=(function(){function t(e,t){this.featureSwitches=e,this.mapControlFactory=t}return t.prototype.getPlugin=function(t){var r=this,i=this.featureSwitches,n=i&&i.forecastEnabled,a=i&&i.columnLabelImprovements,o=!!i&&i.dateSlicerVisualEnabled,s=!!i&&i.dropDownSlicerEnabled,l=i&&i.improvedMapLegend;e.visuals.Slicer.DateSlicerEnabled=o,e.visuals.Slicer.DropDownSlicerEnabled=s;var u=i&&i.hierarchicalAxisEnabled,c=i&&i.axisControlImprovements;switch(t){case e.visuals.plugins.barChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.barChart,(function(){return new e.visuals.CartesianChart({chartType:6,isScrollable:!0,animator:new e.visuals.WebColumnChartAnimator,tooltipsEnabled:!0,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,columnLabelImprovements:a,axisControlImprovements:c})}));case e.visuals.plugins.card.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.card,(function(){return new e.visuals.Card({isScrollable:!0,animator:new e.visuals.BaseAnimator})}));case e.visuals.plugins.clusteredBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.clusteredBarChart,(function(){return new e.visuals.CartesianChart({chartType:5,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:c,columnLabelImprovements:a})}));case e.visuals.plugins.clusteredColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.clusteredColumnChart,(function(){return new e.visuals.CartesianChart({chartType:3,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,columnLabelImprovements:a,hierarchicalAxisEnabled:u,axisControlImprovements:c})}),(function(t){return e.visualHost.visualPluginServiceHelpers.applyFeatureSwitches(t,i)}));case e.visuals.plugins.columnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.columnChart,(function(){return new e.visuals.CartesianChart({chartType:4,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,columnLabelImprovements:a,hierarchicalAxisEnabled:u,axisControlImprovements:c})}),(function(t){return e.visualHost.visualPluginServiceHelpers.applyFeatureSwitches(t,i)}));case e.visuals.plugins.dataDotClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.dataDotClusteredColumnComboChart,(function(){return new e.visuals.CartesianChart({chartType:15,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior,new e.visuals.DataDotChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled})}));case e.visuals.plugins.dataDotStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.dataDotStackedColumnComboChart,(function(){return new e.visuals.CartesianChart({chartType:16,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior,new e.visuals.DataDotChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled})}));case e.visuals.plugins.donutChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.donutChart,(function(){return new e.visuals.DonutChart({animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,behavior:new e.visuals.DonutChartWebBehavior})}));case e.visuals.plugins.funnel.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.funnel,(function(){return new e.visuals.FunnelChart({animator:new e.visuals.WebFunnelAnimator,behavior:new e.visuals.FunnelWebBehavior,tooltipsEnabled:!0,axisControlImprovements:c})}));case e.visuals.plugins.gauge.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.gauge,(function(){return new e.visuals.Gauge({animator:new e.visuals.BaseAnimator,tooltipsEnabled:!0})}));case e.visuals.plugins.hundredPercentStackedBarChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.hundredPercentStackedBarChart,(function(){return new e.visuals.CartesianChart({chartType:7,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,columnLabelImprovements:a,axisControlImprovements:c})}));case e.visuals.plugins.hundredPercentStackedColumnChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.hundredPercentStackedColumnChart,(function(){return new e.visuals.CartesianChart({chartType:8,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,columnLabelImprovements:a,hierarchicalAxisEnabled:u,axisControlImprovements:c})}),(function(t){return e.visualHost.visualPluginServiceHelpers.applyFeatureSwitches(t,i)}));case e.visuals.plugins.lineChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.lineChart,(function(){return new e.visuals.CartesianChart({chartType:0,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.LineChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,forecastEnabled:n,hierarchicalAxisEnabled:u,axisControlImprovements:c})}),(function(t){return e.visualHost.visualPluginServiceHelpers.applyFeatureSwitches(t,i)}));case e.visuals.plugins.areaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.areaChart,(function(){return new e.visuals.CartesianChart({chartType:1,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.LineChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,hierarchicalAxisEnabled:u,axisControlImprovements:c})}),(function(t){return e.visualHost.visualPluginServiceHelpers.applyFeatureSwitches(t,i)}));case e.visuals.plugins.stackedAreaChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.stackedAreaChart,(function(){return new e.visuals.CartesianChart({chartType:2,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.LineChartWebBehavior]),hierarchicalAxisEnabled:u,axisControlImprovements:c})}),(function(t){return e.visualHost.visualPluginServiceHelpers.applyFeatureSwitches(t,i)}));case e.visuals.plugins.lineClusteredColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.lineClusteredColumnComboChart,(function(){return new e.visuals.CartesianChart({chartType:13,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior,new e.visuals.LineChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:c})}));case e.visuals.plugins.lineStackedColumnComboChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.lineStackedColumnComboChart,(function(){return new e.visuals.CartesianChart({chartType:14,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.WebColumnChartAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ColumnChartWebBehavior,new e.visuals.LineChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,axisControlImprovements:c})}));case e.visuals.plugins.pieChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.pieChart,(function(){return new e.visuals.DonutChart({sliceWidthRatio:0,animator:new e.visuals.WebDonutChartAnimator,isScrollable:!0,tooltipsEnabled:!0,behavior:new e.visuals.DonutChartWebBehavior})}));case e.visuals.plugins.scatterChart.name:
return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.scatterChart,(function(){return new e.visuals.CartesianChart({chartType:9,isScrollable:!0,tooltipsEnabled:!0,animator:new e.visuals.BaseAnimator,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.ScatterChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,lassoSelectEnabled:i&&i.lassoSelectEnabled,axisControlImprovements:c})}));case e.visuals.plugins.treemap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.treemap,(function(){return new e.visuals.Treemap({animator:new e.visuals.WebTreemapAnimator,isScrollable:!0,behavior:new e.visuals.TreemapWebBehavior,tooltipsEnabled:!0})}));case e.visuals.plugins.sunburst.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.sunburst,(function(){return new e.visuals.Sunburst({isScrollable:!0,behavior:new e.visuals.SunburstBehavior})}));case e.visuals.plugins.waterfallChart.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.waterfallChart,(function(){return new e.visuals.CartesianChart({chartType:12,isScrollable:!0,tooltipsEnabled:!0,behavior:new e.visuals.CartesianChartBehavior([new e.visuals.WaterfallChartWebBehavior]),isLabelInteractivityEnabled:i&&i.isLabelInteractivityEnabled,columnLabelImprovements:a,axisControlImprovements:c})}));case e.visuals.plugins.map.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.applyImprovedMapLegendMappings(e.visuals.plugins.map,l,!1),(function(){return new e.visuals.Map({behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,isLegendScrollable:!0,mapControlFactory:r.mapControlFactory})}));case e.visuals.plugins.filledMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.applyImprovedMapLegendMappings(e.visuals.plugins.filledMap,l,!0),(function(){return new e.visuals.Map({filledMap:!0,behavior:new e.visuals.MapBehavior,tooltipsEnabled:!0,filledMapDataLabelsEnabled:i&&i.filledMapDataLabelsEnabled,isLegendScrollable:!0,mapControlFactory:r.mapControlFactory})}));case e.visuals.plugins.shapeMap.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.shapeMap,(function(){return new e.visuals.ShapeMap({behavior:new e.visuals.ShapeMapBehavior,tooltipsEnabled:!0})}));case e.visuals.plugins.slicer.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.slicer,(function(){return new e.visuals.Slicer({behavior:new e.visuals.SlicerWebBehavior})}));case e.visuals.plugins.matrix.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.matrix,(function(){return new e.visuals.Matrix({matrixConditionalFormattingEnabled:i&&i.matrixConditionalFormattingEnabled,tablixColumnFormattingEnabled:i&&i.tablixColumnFormattingEnabled})}));case e.visuals.plugins.table.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.table,(function(){return new e.visuals.Table({tablixColumnFormattingEnabled:i&&i.tablixColumnFormattingEnabled,tablixWordWrappingEnabled:i&&i.tablixWordWrap})}));case e.visuals.plugins.scriptVisual.name:return e.visualHost.visualPluginServiceHelpers.getPluginCopy(e.visuals.plugins.scriptVisual,(function(){return new e.visuals.ScriptVisual}));case e.visualHost.EsriVisual:return e.visuals.plugins[e.visualHost.EsriVisual]?e.Prototype.inherit(e.visuals.plugins[t]):null;default:return e.Prototype.inherit(e.visuals.plugins[t])}},t})();t.ExplorationVisualPluginProvider=a})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createModelAuthoringService=t;var r=(function(){function e(){}return e.prototype.apply=function(e){return null},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createGroupingDesignStateService=t;var r=(function(){function e(){}return e.prototype.getGroupingDesignState=function(e,t){return null},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new a(e)}!(function(e){e[e.None=0]="None",e[e.Basic=1]="Basic",e[e.Binning=2]="Binning",e[e.Clustering=3]="Clustering"})(r.GroupMode||(r.GroupMode={}));var n=r.GroupMode;!(function(e){e[e.Category=0]="Category",e[e.Number=1]="Number",e[e.DateTime=2]="DateTime"})(r.GroupDataType||(r.GroupDataType={}));r.GroupDataType;r.createDisabledGroupAuthoringService=i;var a=(function(){function e(e){this.visual=new o,this.dialog=new s,this.telemetry=new l(e)}return e})(),o=(function(){function e(){}return e.prototype.canGroup=function(e,t,r){return!1},e.prototype.group=function(e,t,r,i,n){return null},e})(),s=(function(){function e(){}return e.prototype.showDialog=function(e){return null},e})(),l=(function(){function r(e){this.telemetryService=e}return r.prototype.logGroupActionTelemetry=function(e,t,r,i,n){},r.prototype.logBinsActionTelemetry=function(e,t,r,i,n){},r.prototype.logGroupsErrorTelemetry=function(e,t,r,i){},r.prototype.logGroupsDeleteTelemetry=function(e,t){},r.prototype.logGroupsUsageTelemetry=function(r,i,a,o,s,l){var u=this;r.then((function(r){var c=i.getConceptualProperty(r);if(c){var p=i.getTargetEntity().entity,d=t.utils.GroupUtils.getGroupMode(p,c,null);if(d!==n.None){var f=d===n.Binning?e.telemetry.GroupType.Bin:e.telemetry.GroupType.List;u.telemetryService.logEvent(e.telemetry.EXGroupsUsage,a,o,s,l,f)}}}))},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new r}e.createClusteringStateService=t;var r=(function(){function e(){}return e.prototype.getMetadata=function(e){return null},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.canRedo=function(){return!1},e.prototype.canUndo=function(){return!1},e.prototype.undo=function(){},e.prototype.redo=function(){},e.prototype.clear=function(){},e.prototype.getTopUndoFrame=function(){},e.prototype.register=function(e,t,r){return t()},e.prototype.setHandler=function(e){},e})();e.NoOpUndoRedoService=t})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r){return new n(e,t,r)}t.createUndoRedoService=r;var i=(function(){function e(e){this.frames=e||[]}return e.prototype.addUndoFrame=function(e){this.frames.push(e)},e.prototype.rollbackFrame=function(){var t=_.map(this.frames,(function(e){return e.rollbackFrame()}));return new e(t)},e.prototype.getFrame=function(){return this.frames[0]},e})(),n=(function(){function r(e,t,r){this.currentTransaction=void 0,this.loggerService=r,this.rootScope=e,this.eventBridge=t,this.undoStack=[],this.redoStack=[]}return r.prototype.setHandler=function(e){this.handler=e,this.clear()},r.prototype.undo=function(){this.canUndo()&&this.rollbackTop(this.undoStack,this.redoStack)},r.prototype.redo=function(){this.canRedo()&&this.rollbackTop(this.redoStack,this.undoStack)},r.prototype.clear=function(){this.undoStack=[],this.redoStack=[],this.eventBridge.publishToChannel(t.events.undoRedoStackUpdated)},r.prototype.canRedo=function(){return this.redoStack.length>0},r.prototype.canUndo=function(){return this.undoStack.length>0},r.prototype.getTopUndoFrame=function(){return _.isEmpty(this.undoStack)?void 0:_.last(this.undoStack).getFrame()},r.prototype.canMergeWithTopFrame=function(e){if(!e)return!1;if(this.canUndo()){var t=this.getTopUndoFrame();if(t&&void 0!==t.recurringActionInfo&&t.recurringActionInfo.equals(e))return!0}return!1},r.prototype.undoRedoPostProcessing=function(r){this.rootScope.$emit(e.common.constants.onReportChangedEventName,!0),this.eventBridge.publishToChannel(t.events.undoRedoStackUpdated),this.loggerService.addUserAction({message:r,type:"UndoRedo"}),this.rootScope.$evalAsync(_.noop)},r.prototype.register=function(e,t,r){var i=this,n=this.captureUndoFrame(this.handler);n.recurringActionInfo=r;var a=this.canMergeWithTopFrame(r),o=this.startTransaction(n),s=t(),l=s;return this.isIPromise(l)?l.then((function(){return i.endTransaction(o,a)}),(function(){return i.cancelTransaction(o)})):_.isBoolean(s)&&!s?this.cancelTransaction(o):this.endTransaction(o,a),this.undoRedoPostProcessing(e),s},r.prototype.rollbackTop=function(r,i){var n=this;this.rootScope.$evalAsync((function(){var a=r.pop(),o=a.rollbackFrame();n.validTransactionCheck(o),i.push(o),n.rootScope.$emit(e.common.constants.onReportChangedEventName,!0),n.eventBridge.publishToChannel(t.events.undoRedoStackUpdated)}))},r.prototype.isIPromise=function(e){return e&&e.finally},r.prototype.startTransaction=function(e){var t=new i;return this.currentTransaction||(this.currentTransaction=t,this.currentTransaction.addUndoFrame(e)),this.currentTransaction},r.prototype.endTransaction=function(e,t){t||(this.redoStack=[],this.validTransactionCheck(this.currentTransaction),this.undoStack.push(this.currentTransaction)),this.currentTransaction=void 0},r.prototype.cancelTransaction=function(e){this.currentTransaction=void 0},r.prototype.captureUndoFrame=function(e){return new a(e)},r.prototype.validTransactionCheck=function(t){e.contract.checkValue(t,"null or undefined transaction values cannot be put on undo or redo stack.")},r})(),a=(function(){function e(e,t){this.handler=e,this.snapshot=this.handler.takeSnapshot(t)}return e.prototype.rollbackFrame=function(){var t=new e(this.handler,this.snapshot);return this.handler.rollback(this.snapshot),t},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r,i){return new x(e,t,r,i)}var n=e.data.DataViewObjectDefinitions,a=e.data.DataViewObjectDescriptors,o=e.explore.util.DrillUtils,s=e.data.FieldExprPattern,l=e.visuals.GradientUtils,u=t.util.HierarchyUtils,c=jsCommon.JsonComparer,p=e.data.QueryProjectionCollection,d=e.data.QueryProjectionsByRole,f=e.data.ScopeIdentityExtractor,v=e.data.SemanticQuery,h=t.contracts.SingleVisualConfig,g=e.data.SQExpr,m=e.data.SQExprBuilder,y=e.data.SQExprConverter,b=e.data.SQExprUtils,C=e.data.SQHierarchyExprUtils,S=t.contracts.VisualQuery;r.createVisualAuthoringCore=i;var x=(function(){function i(e,t,r,i){this.visualPluginService=e,this.geoTaggingService=t,this.aggrOps=r,this.featureSwitches=i}return i.prototype.create=function(e){var t=this.visualPluginService.capabilities(e.visualType),i=r.createVisualCapabilitiesHelper(t,this.geoTaggingService,this.featureSwitches.datetimeMinMaxSupported);if(i){var n=e.query||new S(v.create(),{}),a={visualType:e.visualType,query:n};for(var o in a.query.projections)this.ensureDependentObjectDefn(i.objectDescs,o,a);if(_.isEmpty(e.expr)||this.tryAdd(i,a,e))return{singleVisual:a}}},i.prototype.add=function(e,t){var n=t.singleVisual;if(!n)return!1;var a=this.visualPluginService.capabilities(n.visualType),o=r.createVisualCapabilitiesHelper(a,this.geoTaggingService,this.featureSwitches.datetimeMinMaxSupported);return!!o&&(n.query||(n.query=new S(v.create(),{})),!!this.tryAdd(o,n,e)&&(i.clearConversionSourceContext(n),!0))},i.prototype.remove=function(e,t){var r=t.singleVisual;return!!r&&(!!this.tryRemove(r.query,e)&&(i.clearConversionSourceContext(r),!0))},i.prototype.replace=function(e,t){var r=t.singleVisual;if(!r)return!1;if(e.sourceRole===e.targetRole&&!e.replacementExpressions)return!!r.query.moveProjection(e.targetRole,e.sourceIndex,e.targetIndex,e.sourceCount)&&(i.clearConversionSourceContext(r),!0);for(var n=[],a=0;a<e.sourceCount;a++)if(n[a]=r.query.tryGetExpr(e.sourceRole,e.sourceIndex+a),!n[a])return!1;return this.replaceProjectionCore(t,n,e.sourceRole,e.targetRole,e.sourceIndex,e.targetIndex,e.replacementExpressions,e.schema,e.allowPartialReplace)},i.prototype.convert=function(e){var t=e.source;if(!t||t.visualType===e.target)return!1;var i=t.conversionSourceContext;i||(i=t.conversionSourceContext=this.createConversionSourceContext(t.query,t.visualType));var n=this.visualPluginService.capabilities(i.visualType),a=this.visualPluginService.capabilities(e.target);if(!n||!a||_.isEmpty(a.dataRoles))return!1;if(c.equals(n,a))return t.query=i.query,t.visualType=e.target,!0;var s=e.schema,l=this.convertDrillableRoles(i.query,n,a,s),u=l.query,p=o.getDrillableRoles(a),f=i.query.getUniqueQueryRefs();f=_.difference(f,l.drillableRoleProjectionQueryRefs);var v=i.query.defn.select(),h=_.map(f,(function(e){return v.withName(e).expr})),g=r.createVisualCapabilitiesHelper(a,this.geoTaggingService,this.featureSwitches.datetimeMinMaxSupported),m=r.createVisualCapabilitiesHelper(n,this.geoTaggingService,this.featureSwitches.datetimeMinMaxSupported);g.orderByRolePreferences(s,h);var y=d.clone(u.projections),b=this.getExpressionRoleMappings(t.query,h),C=this.getConversionExprRoleList(b,m,g,s,y,p);if(_.isEmpty(C)&&_.isEmpty(u.projections))return!1;for(var S=0,x=C;S<x.length;S++){var E=x[S];u.add(E.expr,E.roleName),this.ensureDependentObjectDefn(g.objectDescs,E.roleName,t)}var w,P,V=o.getDrillableRoles(this.visualPluginService.capabilities(t.visualType));_.isEmpty(V)?(w=o.getDrillableRoles(n),P=i.query):(w=V,P=t.query);for(var D=0,R=p;D<R.length;D++){var F=R[D];if(u.projections[F]){u.ensureActiveItems(F);for(var j=0,T=w;j<T.length;j++){var I=T[j];P.projections[I]&&(u.projections[F].activeProjectionRefs=P.projections[I].activeProjectionRefs)}}}return this.updateTargetShowAllInfo(i,u,g),u.removeUnusedOrderBy(),t.query=u,t.visualType=e.target,!0},i.prototype.setAggregate=function(e,t){var r=t.singleVisual.query.setAggregate(e.role,e.index,e.newAggregate,e.schema);return!!r&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removeAggregate=function(e,t){var r=t.singleVisual.query.removeAggregate(e.role,e.index,e.schema);return!!r&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.setPercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.setPercentOfGrandTotal(e.role,e.index,e.schema)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.removePercentOfGrandTotal=function(e,t){return!!t.singleVisual.query.removePercentOfGrandTotal(e.role,e.index,e.schema)&&(i.clearConversionSourceContext(t.singleVisual),!0)},i.prototype.toggleShowAll=function(e,t){t.singleVisual.query.toggleShowAll(e),i.clearConversionSourceContext(t.singleVisual)},i.prototype.changeActiveProjection=function(e,t,r){var n=t.query.projections[e];if(n){var a=n.all(),o=_.findIndex(a,(function(e){return!_.isEmpty(n.activeProjectionRefs)&&e.queryRef===n.activeProjectionRefs[n.activeProjectionRefs.length-1]}));if(!(o<0)){i.clearConversionSourceContext(t);var s=1!==r?o+1:o-1,l=n.all()[s],u=l&&l.queryRef,c=2===r||1===r&&n.activeProjectionRefs.length>1;if(u){if(c)return n.activeProjectionRefs=_.map(n.all(),(function(e){return e.queryRef})),n.activeProjectionRefs.splice(s+1,n.activeProjectionRefs.length-(s+1)),n.activeProjectionRefs;if(!_.any(n.activeProjectionRefs,(function(e){return u===e})))return n.activeProjectionRefs=[u],n.activeProjectionRefs}}}},i.prototype.addDrillFilter=function(e,t,r,i,n){this.addFilters(e,t,r,i,n,2,!0)},i.prototype.addDrillToDetailsFilter=function(e,t,r,i,n){this.addFilters(e,t,r,i,n,0,!1)},i.prototype.addFilters=function(r,i,n,a,o,s,l){if(i&&n&&!_.isEmpty(a)&&o)for(var u=function(a){for(var u=n.defn.select().withName(a).expr,c=o.expr,p=f.getInExpr(c),d=[],v=[],h=_.first(p.values),y=u.getKeyColumns(r),C=0;C<p.args.length;C++){var S=p.args[C];S&&h&&b.indexOfExpr(y,S)!==-1&&(d.push(S),v.push(h[C]))}if(!_.isEmpty(d)&&!_.isEmpty(v)){var x=e.DataViewScopeIdentity.filterFromIdentity([{expr:m.inValues(d,[v]),key:o.key}]),E=_.filter(i,(function(e){return g.equals(u,e.expression)})),w=void 0;if(l&&(w=_.find(E,(function(e){return e.howCreated===s}))),w=w||_.find(E,(function(e){return!e.filter&&2!==e.howCreated})))w.filter=x,w.howCreated=s,w.precedence=0;else{var P={name:null,expression:u,filter:x,type:t.contracts.FilterType.Categorical,howCreated:s,precedence:0};i.push(P)}}},c=0,p=a;c<p.length;c++){var d=p[c];u(d)}},i.prototype.removeDrillFilter=function(e,t,r){if(e){for(var i,n=0,a=e.length;n<a;n++){var o=e[n];if(g.equals(t,o.expression)){if(2===o.howCreated){i=n;break}r&&void 0===i&&(i=n)}}void 0!==i&&e.splice(i,1)}},i.prototype.replaceProjectionCore=function(e,t,o,s,l,u,c,p,d){var f=e.singleVisual;if(!f||!f.query)return!1;for(var v=h.clone(f),g=v.query.defn.orderBy(),m=0;m<t.length;m++)if(!this.tryRemove(v.query,{role:o,index:l}))return!1;g.length>0&&v.query.orderBy(g);var y=this.visualPluginService.capabilities(f.visualType),b=r.createVisualCapabilitiesHelper(y,this.geoTaggingService,this.featureSwitches.datetimeMinMaxSupported);if(!b)return!1;var C=b.roles.withName(s);if(!C)return!1;for(var S=c||t,m=0;m<S.length;m++){S[m]=this.aggregateIfNecessary(S[m],C,p);var x={expr:S[m],schema:p,targetRole:s,targetIndex:u+m};if(!this.tryAdd(b,v,x)){if(m>0&&d)break;return!1}if(f.query.projections[o].showAll){var E=S[m].getMetadata(p);this.isShowAllRole(C.kind)&&E&&1!==E.kind&&(v.query.projections[s].showAll=!0)}}if(e.singleVisual=v,i.clearConversionSourceContext(e.singleVisual),e.singleVisual.objects){var w=a.findFilterOutput(b.objectDescs);w&&n.deleteProperty(e.singleVisual.objects,w.objectName,null,w.propertyName)}return!0},i.prototype.aggregateIfNecessary=function(t,r,i){var n=s.getAggregate(t);return null!=n||r.kind!==e.VisualDataRoleKind.Measure||b.discourageAggregation(t,i)?r.kind===e.VisualDataRoleKind.Grouping?m.removeAggregate(t):t:this.aggrOps.createExprWithAggregate(t,i,!0,r.requiredTypes)},i.clearConversionSourceContext=function(e){e.conversionSourceContext=null},i.prototype.getConversionExprRoleList=function(e,t,r,i,n,a){var o=this,s=this.getCompatRolesForExprs(e,t,r,i,!1,n,a);if(_.isEmpty(s)){var l=_.map(e,(function(e){var t=e.expr;return{expr:b.isMeasure(t)?t:o.aggrOps.createExprWithAggregate(t,i,!0,null)}}));s=this.getCompatRolesForExprs(l,t,r,i,!0,n,a)}if(_.isEmpty(s)){var u=_.map(e,(function(e){var t=e.expr;return{expr:b.isMeasure(t)?m.removeAggregate(t):t}}));s=this.getCompatRolesForExprs(u,t,r,i,!0,n,a)}return s},i.prototype.getCompatRolesForExprs=function(e,t,r,i,n,a,o){for(var s=[],l=a?a:{},c=new E(u.hierarchyLevelComparer),p=0,d=e;p<d.length;p++){var f=d[p],v=this.getTargetRoleForConversion(f,t,r),h=r.findCompatibleRole({queryProjections:l,schema:i,expr:f.expr,targetRole:v,preferDrillableRoles:!1,roleToExprMap:c,useStrict:!0});if(h){this.updateProjections(l,h.name,o);var g=r.getNumberRangesForRoles(l),m=g[h.name];if(this.shouldUseVariation(f.expr,i,h.name,o,m)){var y=C.getSourceVariationExpr(f.expr);return s.push({expr:y,roleName:h.name}),s}if(s.push({expr:f.expr,roleName:h.name}),n)return s}}return s},i.prototype.shouldUseVariation=function(e,t,r,i,n){if(!_.contains(i,r)&&n&&1===n.max){var a=y.asFieldPattern(e,t);if(a&&a.columnHierarchyLevelVariation)return!0}return!1},i.prototype.getExpressionRoleMappings=function(e,t){return _.map(t,(function(t){return{expr:t,roleName:e.getRoleNameForExpr(t)}}))},i.prototype.getTargetRoleForConversion=function(e,t,r){var i=t.roles.withName(e.roleName),n=r.roles.withName(e.roleName);if(i&&n){var a=this.getDataViewMappingConditions(t.capabilities),o=this.getDataViewMappingConditions(r.capabilities),s=e.roleName,l=a&&o&&_.isEqual(a[s],o[s])||!a&&!o;return!r.hasPreferredTypes()&&l&&_.isEqual(i.kind,n.kind)?s:void 0}},i.prototype.getDataViewMappingConditions=function(e){var t=e.dataViewMappings&&e.dataViewMappings[0];return t&&t.conditions},i.prototype.updateProjections=function(e,t,r){var i={queryRef:t},n=d.getRole(e,t);n||(e[t]=n=new p([]));var a=n.all();a.push(i),_.contains(r,t)&&n.addActiveQueryReference(a[0].queryRef)},i.prototype.createConversionSourceContext=function(e,t){return{query:e,visualType:t}},i.prototype.convertDrillableRoles=function(e,t,r,i){var n=new S(e.defn.select([]),{}),a=o.getDrillableRoles(t);if(_.isEmpty(a))return{query:n,drillableRoleProjectionQueryRefs:[]};var s=this.populateQueryForDrillableProjections(r,e,i,a,n);return{query:n,drillableRoleProjectionQueryRefs:s}},i.prototype.populateQueryForDrillableProjections=function(e,t,r,i,n){for(var a=o.getDrillableRoles(e),s=t.projections,l=t.defn.select(),u=[],c=0,p=i;c<p.length;c++){var d=p[c],f=s[d];if(f){var v=_.map(f.all(),(function(e){return e.queryRef})),h=_.map(v,(function(e){return l.withName(e)}));if(this.convertDrillableExprs(h,r,e,n),u=_.union(u,v),_.isEmpty(a))break}}return n.ensureDrillableRoles(a),u},i.prototype.convertDrillableExprs=function(e,t,i,n){for(var a=r.createVisualCapabilitiesHelper(i,this.geoTaggingService,this.featureSwitches.datetimeMinMaxSupported),s=a.getNumberRangesForRoles(n),l=o.getDrillableRoles(i),c=_.isEmpty(l),p=new E(u.hierarchyLevelComparer),d=0,f=e;d<f.length;d++){var v=f[d],h=v.expr,g=v.name,m=a.findCompatibleRole({queryProjections:n.projections,schema:t,expr:h,preferDrillableRoles:!0,roleToExprMap:p,useStrict:!0});if(m){var y=m.name,b=s[y];if(this.shouldUseVariation(v.expr,t,m.name,l,b)){var S=C.getSourceVariationExpr(v.expr);return void n.add(S,y,{exprName:g})}if(n.add(h,y,{exprName:g}),c){var x=n.projections[y].all().length;if(b&&b.max&&b.max<=x)return}}}},i.prototype.tryRemove=function(e,t){var r=t;if(r&&r.expr){if(_.isArray(r.expr)){for(var i=!0,n=0,a=r.expr;n<a.length;n++){var o=a[n];i=e.removeExpr(o,!!r.ignoreAggregates)&&i}return i}return e.removeExpr(r.expr,!!r.ignoreAggregates)}var s=t;return!!(s&&s.role&&$.isNumeric(s.index))&&e.removeProjection(s.role,s.index)},i.prototype.tryAdd=function(e,t,r){var i=r.expr,n=new E(u.hierarchyLevelComparer),a=!1,s=r.targetIndex;if(_.isArray(i))for(var l=0,c=i;l<c.length;l++){var p=c[l];a=null!=this.tryAddQuery(e,t,r,p,s,n)||a,null!=s&&s++}else if(null==this.tryAddQuery(e,t,r,i,s,n))return!1;var d=o.getDrillableRoles(e.capabilities);return t.query.ensureDrillableRoles(d),!_.isArray(i)||a},i.prototype.tryAddQuery=function(e,t,r,i,n,a){var o=e.findCompatibleRole({queryProjections:t.query.projections,schema:r.schema,expr:i,preferDrillableRoles:!1,roleToExprMap:a,targetRole:r.targetRole});if(o){var s=o.name,l=t.query.add(i,s,{index:n});return this.ensureDependentObjectDefn(e.objectDescs,s,t),a.add(i,o),l}},i.prototype.ensureDependentObjectDefn=function(e,t,r){if(e)for(var i in e){var a=e[i];for(var o in a.properties){var s=a.properties[o];if(s.rule&&s.rule.inputRole===t){var l=r.objects;l||(l=r.objects={});var u=n.ensure(l,i,null);u.properties[o]||(u.properties[o]=this.createDefaultDefinition(s.type))}}}},i.prototype.createDefaultDefinition=function(e){if(e.fillRule){var t=l.getDefaultFillRuleDefinition();return t}},i.prototype.getSourceShowAllInfo=function(e){for(var t={},r=0,i=_.values(e);r<i.length;r++)for(var n=i[r],a=n.showAll,o=0,s=n.all();o<s.length;o++){var l=s[o];t[l.queryRef]=a}return t},i.prototype.updateTargetShowAllInfo=function(e,t,r){for(var i=this.getSourceShowAllInfo(e.query.projections),n=0,a=_.keys(t.projections);n<a.length;n++){var o=a[n],s=r.roles.withName(o).kind;if(this.isShowAllRole(s))for(var l=0,u=t.projections[o].all();l<u.length;l++){var c=u[l],p=i[c.queryRef];p&&(t.projections[o].showAll=p)}}},i.prototype.isShowAllRole=function(t){return t===e.VisualDataRoleKind.Grouping||t===e.VisualDataRoleKind.GroupingOrMeasure},i})(),E=(function(){function e(e){this.key=[],this.value=[],this.comparer=e}return e.prototype.add=function(e,t){this.key.push(e),this.value.push(t)},e.prototype.get=function(e){if(g.isHierarchyLevel(e))for(var t=0;t<this.key.length;t++)if(this.comparer(this.key[t],e))return this.value[t]},e})();r.SQExprToRoleDictionary=E})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){return new s(e,t,r)}var n=e.data.QueryProjectionsByRole,a=e.data.SQExpr,o=t.contracts.VisualQuery;r.createSortService=i;var s=(function(){function r(e,t,r){this.displayNameService=e,this.featureSwitches=t,this.visualPluginService=r}return r.prototype.getSortableFields=function(t){var r=t.visualType,i=t.query,n=i.projections,a=t.schema,o=this.visualPluginService.capabilities(r);if(o&&this.isVisualSortable(o)){if(o.sorting){var s=this.visualPluginService.getPlugin(r);if(s&&s.getSortableRoles){var l={mappings:o.dataViewMappings,queryDefn:i.defn,queryProjections:n,schema:a,objectDescriptors:o.objects,objectDefinitions:t.objectDefns,roles:o.dataRoles},u=e.data.compileDataView(l),c={dataViewMappings:u};return this.getSortableFieldsFromAllowedRoles(n,i,a,o.dataRoles,s.getSortableRoles(c))}return this.getDefaultSortableFields(n,i,a,o.dataRoles)}return this.getDefaultSortableFields(n,i,a,o.dataRoles)}return[]},r.prototype.addSort=function(e,t){e&&e.defn&&t&&(e.defn=e.defn.orderBy(t))},r.prototype.removeSort=function(e,t){if(e&&e.defn&&t)for(var r=0,i=t;r<i.length;r++){var n=i[r];e.defn=e.defn.removeOrderBy(n.expr)}},r.prototype.resetSort=function(e){if(e&&e.defn){var t=e.defn.orderBy();this.removeSort(e,t)}},r.prototype.applyImplicitSort=function(e,t){if(!t)return e;var r=e.defn;if(!r)return e;for(var i=t.clauses,a=r.select(),s=[],l=0,u=i;l<u.length;l++){var c=u[l],p=n.getRole(e.projections,c.role);if(p){var d=c.direction;Array.prototype.push.apply(s,_.map(p.all(),(function(e){return{expr:a.withName(e.queryRef).expr,direction:d}})))}}return new o(r.orderBy(s),e.projections)},r.prototype.ensureValidSorting=function(e){var t=_.chain(this.getSortableFields(e)).map((function(e){return e.exprs})).flatten().map((function(e){return e.name})).value(),r=e.query,i=r.defn;if(!i)return r;for(var n=i.orderBy(),a=!1,s=n.length-1;s>=0;s--){var l=i.selectNameOf(n[s].expr);_.contains(t,l)||(n.splice(s,1),a=!0)}return a?new o(i.orderBy(n),r.projections):r},r.prototype.isVisualSortable=function(t){return _.some(t.dataRoles,(function(t){return t.kind!==e.VisualDataRoleKind.Measure}))},r.prototype.getDefaultSortableFields=function(e,t,r,i){var n=this.getSortableFieldsFromProjections(e,t,r,i);return n},r.prototype.getSortableFieldsFromAllowedRoles=function(e,t,r,i,n){if(!n||0===n.length)return[];var a=this.getSortableFieldsFromProjections(e,t,r,i,n);return a},r.prototype.findSortExpressionIndex=function(e,r){if(e&&r)for(var i=0,n=r.length;i<n;i++)if(a.equals(e,r[i].expr))return i;return t.constants.invalidSortExprIndex},r.prototype.getSortableFieldsFromProjections=function(e,r,i,a,o){var s=[],l=r.defn.select(),u=r.defn.orderBy();if(a)for(var c=0,p=a;c<p.length;c++){var d=p[c];if(!(o&&_.indexOf(o,d.name)<0)){var f=n.getRole(e,d.name);if(f){var v=f.activeProjectionRefs;if(_.isEmpty(v))for(var h=0,g=f.all();h<g.length;h++){var m=g[h],y=l.withName(m.queryRef),b=y&&y.expr;if(b){var C=this.displayNameService.getDisplayName(b,i),S=this.findSortExpressionIndex(b,u),x=S!==t.constants.invalidSortExprIndex;s.push({displayName:C,exprs:[{name:m.queryRef,expr:b}],active:x,sortDirection:x?u[S].direction:void 0})}}else s.push(this.getSortableFieldFromActiveProjections(i,l,v,u))}}}return s},r.prototype.getSortableFieldFromActiveProjections=function(e,r,i,n){for(var a,o=!1,s=[],l=0,u=i;l<u.length;l++){var c=u[l],p=r.withName(c),d=p&&p.expr;if(d){s.push({name:c,expr:d});var f=this.findSortExpressionIndex(d,n);o=o||f!==t.constants.invalidSortExprIndex,o&&!a&&(a=n[f].direction)}}var v=this.concatDisplayNamesForActiveItems(e,r,i);return{displayName:v,exprs:s,active:o,sortDirection:o?a:void 0}},r.prototype.concatDisplayNamesForActiveItems=function(e,t,r){var i=this,n=_.map(r,(function(r){return i.getDisplayNameFromQueryRef(e,t,r)}));return n.join(" ")},r.prototype.getDisplayNameFromQueryRef=function(e,t,r){var i=t.withName(r),n=i&&i.expr;return n?this.displayNameService.getDisplayName(n,e):""},r})();r.SortService=s})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e,t,r){if(e&&!_.isEmpty(e.dataRoles)){for(var i=e.dataViewMappings,n=new v(e.dataRoles),a=[],o=0,l=i;o<l.length;o++){var u=l[o],c=u.conditions;if(_.isEmpty(c))a.push(new f(n,t,s.getDrillableRoles(e),r));else for(var p=0,h=c;p<h.length;p++){var g=h[p];a.push(new f(n,t,s.getDrillableRoles(e),r,g))}}return new d(e,n,e.objects,a)}}function n(e){return new v(e)}function a(e){return e&&e.geography&&(e.geography.latitude||e.geography.longitude)}var o=jsCommon.ArrayExtensions,s=e.explore.util.DrillUtils,l=jsCommon.MathExtensions,u=e.data.SQExpr,c=e.data.SQExprConverter,p=t.contracts.VisualQuery;r.createVisualCapabilitiesHelper=i,r.createDataRoleWrapper=n,r.isValueTypeDescriptorLatLong=a;var d=(function(){function t(e,t,r,i){this.capabilities=e,this.roles=t,this.objectDescs=r,this.roleMappings=i,this.drillableRoles=s.getDrillableRoles(e)}return t.prototype.findCompatibleRole=function(e){var t=e.expr,r=e.roleToExprMap,i=e.targetRole,n=e.preferDrillableRoles;if(u.isHierarchyLevel(t)){n=!0;var a=this.getExistingTargetRoleForHierarchyLevelIfAny(t,r);if(a){if(i&&i!==a.name)return;i=a.name}}var o,s=c.asFieldPattern(t),l=s.column||s.columnAggr||s.groupingColumn||s.groupingColumnAggr||s.measure,p={projections:e.queryProjections,metadata:t.getMetadata(e.schema),columnName:l?l.name:void 0,preferDrillableRoles:!1,targetRole:i,useStrict:e.useStrict};return n||(o=this.findRole(p)),o||(p.preferDrillableRoles=!0,o=this.findRole(p)),o&&r&&r.add(t,o),o},t.prototype.findRole=function(e){var t=this.roleMappings;if(!_.isEmpty(t))for(var r=t[0].getValueType(e.metadata?e.metadata.type:void 0,e.columnName),i=this.roles.allRolesWithPreference(r?r.extendedType:void 0,e.useStrict),n=e.targetRole?[e.targetRole]:i,a=0,o=n;a<o.length;a++)for(var s=o[a],l=0,u=t;l<u.length;l++){var c=u[l],p=c.checkRoleCompatibility(e,s,i);if(p)return p}},t.prototype.getExistingTargetRoleForHierarchyLevelIfAny=function(e,t){var r=t.get(e);return r},t.prototype.orderByRolePreferences=function(t,r){for(var i=this.roles.defns,n=0,a=r.length,o=0,s=i.length;o<s;o++){var l=i[o].preferredTypes;if(!_.isEmpty(l))for(var u=n;u<a;u++){var c=r[u],p=c.getMetadata(t);if(p){var d=p.type;if(d)for(var f=0,v=l.length;f<v;f++)if(d.extendedType===e.ValueType.fromDescriptor(l[f]).extendedType){r.splice(u,1),r.splice(n,0,c),n++;break}}}}},t.prototype.getNumberRangesForRoles=function(e){var t,r=_.map(this.roles.defns,(function(e){return e.name}));t=e instanceof p?e.projections:e;for(var i={},n=0,a=r;n<a.length;n++){var o=a[n];i[o]={min:1/0,max:0}}for(var s=_.filter(this.roleMappings,(function(e){return e.projectionsAreCompatible({projections:t,roleNames:r,preferDrillableRoles:!0,ignoreMin:!0})})),u=0,c=s;u<c.length;u++)for(var d=c[u],f=d.getCondition(),v=0,h=r;v<h.length;v++){var o=h[v],g=f&&f[o],m=void 0;m=g?{min:l.max(g.min,0),max:l.min(g.max,1/0)}:{min:0,max:1/0};var y=i[o];y.min=Math.min(m.min,y.min),y.max=Math.max(m.max,y.max)}for(var b=0,C=_.values(i);b<C.length;b++){var y=C[b];y.min=Math.min(y.min,y.max)}return i},t.prototype.getNonLatLongCategoricalRoles=function(){for(var t=this.capabilities,r=t.dataViewMappings,i=[],n=0,a=r;n<a.length;n++){var o=a[n];o.categorical&&e.DataViewMapping.visitCategoricalCategories(o.categorical.categories,{visitRole:function(e){i.push(e)}})}var s=this.getLatLongRoleNames(),l=_.filter(i,(function(e){return!_.contains(s,e)}));return l},t.prototype.getLatLongRoleNames=function(){var e=this.capabilities;return _.chain(e.dataRoles).filter((function(e){if(!_.isEmpty(e.preferredTypes))return _.some(e.preferredTypes,(function(e){return a(e)}))})).map((function(e){return e.name})).value()},t.prototype.hasPreferredTypes=function(){return _.any(this.capabilities.dataRoles,(function(e){return!_.isEmpty(e.preferredTypes)}))},t})(),f=(function(){function t(e,t,r,i,n){this.roles=e,this.geoTaggingService=t,this.condition=n,this.drillableRoles=r,this.datetimeMinMaxSupported=i}return t.prototype.getCondition=function(){return this.condition;
},t.prototype.checkRoleCompatibility=function(t,r,i){if(t.metadata){var n=this.roles.withName(r);if(n&&this.exprIsCompatible(n,t.metadata,e.DataViewAnalysis.getPropertyCount(r,t.projections)+1,t.preferDrillableRoles)){if(!this.projectionsAreCompatible({projections:t.projections,roleNames:_.without(i,r),preferDrillableRoles:t.preferDrillableRoles,ignoreMin:!1}))return;return n}}},t.prototype.getValueType=function(t,r){if(t&&null==t.categoryString){var i=r&&this.geoTaggingService.getFieldType(r);null!=i&&(t=e.ValueType.fromPrimitiveTypeAndCategory(t.primitiveType,i))}return t},t.prototype.projectionsAreCompatible=function(t){for(var r=0,i=t.roleNames;r<i.length;r++){var n=i[r],a=this.roles.withName(n);if(!a)return!1;var o=e.DataViewAnalysis.getPropertyCount(n,t.projections);if(!this.isCardinalityValid({count:o,roleName:a.name,preferDrillableRoles:t.preferDrillableRoles,ignoreMin:t.ignoreMin}))return!1}return!0},t.prototype.exprIsCompatible=function(t,r,i,n){if(!this.isCardinalityValid({count:i,roleName:t.name,preferDrillableRoles:n,ignoreMin:!1}))return!1;var a=t.kind;if(1===r.kind){if(a===e.VisualDataRoleKind.Grouping)return!1}else if(a===e.VisualDataRoleKind.Measure)return!1;if(this.datetimeMinMaxSupported){var o=t.requiredTypes;if(o&&!e.ValueType.isCompatibleTo(r.type,o))return!1}return!0},t.prototype.isRoleDrillable=function(e){return _.contains(this.drillableRoles,e)&&(!this.condition[e]||void 0===this.condition[e].max||1===this.condition[e].max)},t.prototype.isCardinalityValid=function(t){if(this.condition&&(!t.preferDrillableRoles||!this.isRoleDrillable(t.roleName))){var r=this.condition[t.roleName];return!r||null==e.DataViewAnalysis.validateRange(t.count,r,t.ignoreMin)}return!0},t})(),v=(function(){function t(e){this.defns=e}return t.prototype.withName=function(e){return o.findItemWithName(this.defns,e)},t.prototype.getWeightForRole=function(r,i){for(var n=t.penalize,a=0,o=i.length;a<o;a++){var s=e.ValueType.fromDescriptor(i[a]).extendedType;if(r===s){n=t.promote;break}}return n},t.prototype.allRolesWithPreference=function(e,r){for(var i=_.map(this.defns,(function(e){return e.name})),n=_.clone(i),a=0,o=i.length;a<o;a++){var s=this.withName(i[a]),l=s.preferredTypes;if(null!=l){var u=this.getWeightForRole(e,l),c=n.splice(n.indexOf(i[a]),1)[0];u!==t.penalize||r?u===t.promote&&n.splice(0,0,c):n.push(c)}}return n},t.penalize=-1,t.promote=1,t})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(e){return new N(e.dataReaders,e.displayNameService,e.plugin,e.sortService,e.filterGenerator,e.aggrOps,e.featureSwitchService,e.transformPluginService,e.telemetryService)}function n(e,t){if(_.isEmpty(t))return{queryForTransformActions:e,internalToPublicSelectNameMappingsByRole:{}};for(var r=e.clone(),i=0,n=t;i<n.length;i++){var a=n[i];if(a.selectExprAdded){var o=r.defn.select(),s=a.selectExprAdded;o[s.selectIndex]=s.namedSQExpr,r.defn=r.defn.select(o)}else if(a.projectionQueryRefChanged){var s=a.projectionQueryRefChanged,l=r.projections[s.role];l.replaceQueryRef(s.oldQueryRef,s.newInternalQueryRef)}else a.aggregatesAdded}var u=_.reduce(t,(function(e,t){var r=t.projectionQueryRefChanged;if(r){var i=e[r.role];i||(i={},e[r.role]=i),i[r.newInternalQueryRef]=r.oldQueryRef}return e}),{});return{queryForTransformActions:r,internalToPublicSelectNameMappingsByRole:u}}function a(e,t,r,i,a,c,p,d,v,h,g,m){var y={};c&&(y.objects=c),p&&(y.splits=p);var b={options:e,transforms:y,warnings:v},C=n(r,d),S=C.queryForTransformActions,x=C.internalToPublicSelectNameMappingsByRole,E=S.defn.select(),w=S.defn.orderBy(),P=S.projections;if(m){var V=m.where();if(_.any(V,(function(e){return e.condition&&!_.isEmpty(e.condition.validate(t,a))})))return b.error=new M("Broken_Filters"),b}if(P){var D=[],R={},F=void 0;for(var T in P){var I=R[T]=[],N=P[T];_.isEmpty(N.activeProjectionRefs)||(F||(F={}),F[T]=_.map(N.activeProjectionRefs,(function(e){return{queryRef:e}})));for(var O=0,A=N.all();O<A.length;O++){var q=A[O],U=f.indexWithName(E,q.queryRef);D.push({queryRef:q.queryRef,format:q.format,queryIndex:U,roleName:T}),I.push(U)}}y.selects=[];for(var L=[],z=S.defn.transforms(),G=!_.isEmpty(z),B=0,Q=E.length;B<Q;B++){var k=s(D,B),H=E[B],W=void 0,K=g&&g[H.name];if(!G||K){if(K&&(H=K),!_.isEmpty(H.expr.validate(t,a))){L.push(H.expr);continue}var J=H.expr.getMetadata(t);W={type:J.type,expr:H.expr};var X=j.getKpiMetadata(H.expr,t);X&&(W.kpi=X),W.displayName=i.getDisplayName(H.expr,t);var $=k[0];if($){var Y=$.format||J.format;Y&&(W.format=Y)}}else W={expr:H.expr,displayName:H.name};W.roles||(W.roles={});for(var Z=0,ee=k;Z<ee.length;Z++){var te=ee[Z];te&&te.roleName&&(W.roles[te.roleName]=!0)}var re=H.name;W.queryName=_.chain(Object.keys(W.roles)).map((function(e){return x[e]&&x[e][re]})).filter(_.isString).value()[0]||re;var ie=l(w,H.expr);if(ie!==-1){var ne=w[ie];W.sort=ne.direction,W.sortOrder=ie}var ae=j.getDefaultValue(H.expr,t);if(ae){W.defaultValue={value:ae};var oe=H.expr.getKeyColumns(t);W.defaultValue.identityFieldsValues=j.getDefaultValues(oe,t)}var se=j.getAggregateBehavior(H.expr,t);1===se&&(W.discourageAggregationAcrossGroups=!0),y.selects.push(W)}if(d)for(var le=0,ue=d;le<ue.length;le++){var ce=ue[le];ce.aggregatesAdded&&u(y.selects,ce.aggregatesAdded)}y.roles={ordering:R},F&&(y.roles.activeItems=F,o(y,h)),b.error=M.create(L)}return b}function o(e,t){var r=e&&e.roles,i=r&&r.activeItems;if(i)for(var n in i)for(var a=i[n],o=0,s=a;o<s.length;o++){var l=s[o];l.suppressConcat=_.contains(t,l.queryRef)}}function s(e,t){return _.chain(e).compact().filter((function(e){return e.queryIndex===t})).value()}function l(e,t){return _.findIndex(e,(function(e){return D.equals(e.expr,t)}))}function u(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(n.queryName===t.originalQueryRef){var a={},o=t.aggregates;o.min&&(a.min=c(o.min)),o.max&&(a.max=c(o.max)),n.aggregateSources=a;break}}var s=t.aggregates;p(e,s.min),p(e,s.max)}function c(e){return{index:e.index}}function p(e,t){if(t){var r=t.index;e[r]||(e[r]={displayName:"",queryName:t.queryName,expr:t.expr})}}function d(t,r){var i;switch(t.name){case e.visuals.plugins.map.name:var n=_.filter(r,(function(e){return"Category"===e.roleName&&e.code===b.conditionRangeTooLarge})),a=_.filter(r,(function(e){return"X"===e.roleName&&e.code===b.conditionKindExpectedGrouping})),o=_.filter(r,(function(e){return"Y"===e.roleName&&e.code===b.conditionKindExpectedGrouping}));_.isEmpty(n)?_.isEmpty(a)&&_.isEmpty(o)||(i="DataViewMappingError_LatLongAggregateWithNoLocation"):i="DataViewMappingError_LocationAndLatLongGroup"}if(i){var s=e.common.localize.get(i);return{code:i,getDetails:function(){return{displayableErrorInfo:[],message:s}}}}}var f=jsCommon.ArrayExtensions,v=e.ClientErrorStrings,h=e.data.CompiledDataViewMapping,g=e.data.DataBoundObjectQueryExtender,m=e.data.DataReaderUtils,y=e.explore.contracts.DataSource,b=e.DataViewAnalysis.DataViewMappingMatchErrorCode,C=e.data.DataViewObjectDefinitions,S=e.data.DataViewObjectDescriptors,x=e.data.services.DataViewObjectSerializer,E=e.data.DataViewRoleWildcard,w=e.data.FieldExprPattern,P=e.data.ScalarKeyUtils,V=e.data.SemanticQuery,D=e.data.SQExpr,R=e.data.SQExprBuilder,F=e.data.SQExprConverter,j=e.data.SQExprUtils,T=jsCommon.StringExtensions,I=t.util.VisualContainerUtils;r.createVisualQueryGenerator=i;var N=(function(){function r(e,t,r,i,n,a,o,s,l){this.dataReaders=e,this.displayNames=t,this.visualPluginService=r,this.sortService=i,this.filterGenerator=n,this.aggrOps=a,this.featureSwitchService=o,this.transformPluginService=s,this.telemetryService=l}return r.prototype.shouldExecute=function(e,t){if(!e||_.isEmpty(t))return!1;var r=e.visualType,i=this.visualPluginService.capabilities(r);if(!i)return!1;var n=m.findType(t,e&&e.query&&e.query.defn);if(!n)return!1;var a=this.dataReaders.queryGenerator(n);return!!a&&(null==e.query?!!g.extend(V.create(),i.objects,e.objects,{},{},{}):I.isQueryVisual(r,this.visualPluginService))},r.prototype.execute=function(e){var t=e.config,i=e.dataSources;if(!_.isEmpty(i)){var n=m.findType(i,t.query&&t.query.defn);if(n){var o=this.dataReaders.queryGenerator(n),s=this.getCompileMappingsResult(t,t&&t.visualType,e.schema,o,e.additionalFilters,e.dataViewMappingsOverride);if(s){if(s.error)return{options:null,error:s.error};var l=s.compiled;if(l){var u;if(l.query&&l.query.defn&&!_.isEmpty(l.query.defn.select())&&!_.isEmpty(l.query.defn.transforms())){u={};for(var c=0,p=l.query.defn.select();c<p.length;c++){var d=p[c];D.isTransformOutputRoleRef(d.expr)||(u[d.name]=d)}}var f=this.getVisualCapabilities(e.config.visualType),v=r.compileFilters(e.additionalFilters,f),h=this.generateQuery(o,e.schema,l,f.dataRoles,f.filterMappings,v.dataFilter,v.highlightFilter,e.restartToken,e.dataWindow),g=h.result,b=h.query,C=e.additionalFilters?e.additionalFilters.queryRefsForSingleItemDrillFilters:void 0,S={type:n,query:{dataSources:y.referenced(e.dataSources,b.defn),command:g.command,cacheResponseOnServer:e.cacheResponseOnServer,allowCache:e.allowCache,allowClientSideFilters:this.getAllowClientSideFiltersOrDefault(e,f),ignoreViewportForCache:e.ignoreViewportForCache},perfId:e.config.visualType};return a(S,e.schema,b,this.displayNames,this.aggrOps,l.objectDefinitions,g.splits,g.queryRewrites,s.warnings,C,u,v.dataFilter)}}}}},r.prototype.executeForFlattenedQuery=function(e,t){var i=e.config,n=this.getQueryGenerator(e.dataSources,i);if(n){var a=this.getCompileMappingsResult(i,i&&i.visualType,e.schema,n,e.additionalFilters,e.dataViewMappingsOverride);if(a&&!a.error){var o=a.compiled;if(o){var s=this.getVisualCapabilities(e.config.visualType),l=r.compileFilters(e.additionalFilters,s);return this.generateFlattenedQuery(n,e.schema,o,s.dataRoles,s.filterMappings,l.dataFilter,l.highlightFilter,e.restartToken,e.dataWindow,t)}}}},r.prototype.getQueryGenerator=function(e,t){if(!_.isEmpty(e)){var r=t.query,i=m.findType(e,r&&r.defn);if(i)return this.dataReaders.queryGenerator(i)}},r.prototype.getVisualCapabilities=function(e){if(e){var t=this.visualPluginService.getPlugin(e);return t&&t.capabilities}},r.prototype.getCompileMappingsResult=function(t,r,i,n,a,o){if(t&&r&&i){var s=this.visualPluginService.getPlugin(r);if(s){var l,u=this.getVisualCapabilities(r),c=o||u.dataViewMappings,p=t.query,f=u.sorting?u.sorting.implicit:null,v=p?I.createRoleKindByQueryRef(p,i):{};if(c&&p){var h=e.DataViewAnalysis.chooseDataViewMappings(p.projections,c,v,u.objects,t.objects);if(!h.supportedMappings){var g=d(s,h.mappingErrors);if(g)return{error:g,compiled:null}}l=this.compileMappingsWithProperties(r,i,p,h.supportedMappings,v,u.dataRoles,u,t.objects,s.customizeQuery,f,n,a)}else l=this.compileNoMappingsWithProperties(i,p,v,c,u.dataRoles,u.objects,t.objects);var m=[];if(l){m.push.apply(m,O.validateAndAdjustRolesIfNecessary(l.mappings,l.query,i,this.displayNames)||[]),m.push.apply(m,A.validateAndAdjustHighlightIfNecessary(a)||[]);for(var y=0,b=m;y<b.length;y++){var C=b[y];this.telemetryService.logEvent(e.telemetry.EXVisualQueryGeneratorWarning,C.code)}}return{compiled:l,warnings:m}}}},r.compileFilters=function(e,t){var r,i;return e&&(i=e.dataFilter,r=e.highlightFilter),{dataFilter:i,highlightFilter:r}},r.prototype.getAllowClientSideFiltersOrDefault=function(e,t){if(_.isBoolean(e.allowClientSideFilters))return e.allowClientSideFilters;var r=!!S.findSelfFilter(t.objects);return r},r.prototype.compileMappingsWithProperties=function(r,i,n,a,o,s,l,u,c,p,d,f){_.isEmpty(n.defn.transforms())&&(n=t.TransformGeneratorUtils.addTransforms(u,a,n,this.transformPluginService,l));var v=e.data.compileDataView({mappings:a,queryDefn:n.defn,queryProjections:n.projections,schema:i,objectDescriptors:l.objects,objectDefinitions:u,roles:s});if(c){var h=this.getSorts(v);c({dataViewMappings:v,preferHigherDataVolume:this.featureSwitchService.featureSwitches.preferHigherDataVolume});var m=this.getSorts(v);n=this.updateSorts(n,h,m)}n=t.TransformGeneratorUtils.removeUnsupportedTransforms(this.transformPluginService,n,v),n=this.sortService.applyImplicitSort(n,p),n=this.sortService.ensureValidSorting({query:n,schema:i,visualType:r,objectDefns:u});var y=u;y=this.setScalarKeyProperties(i,v,n,y,l.objects),y=this.setFilteredToUniqueValueProperties(f,d,i,v,n,y,l.objects);var b,C,S=this.getQueryRefsByRole(n,s),x=g.extend(n.defn,l.objects,y,S,n.projections,o);return x&&(b=new t.contracts.VisualQuery(x.queryDefn,n.projections),C=x.additionalProjections),{query:b||n,mappings:v,additionalProjections:C,objectDefinitions:y}},r.prototype.getSorts=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],a=_.chain(n.metadata.columns).filter((function(e){return void 0!==e.sort})).map((function(e){return{queryName:e.queryName,sort:e.sort,sortOrder:e.sortOrder}})).value();t.push(a)}return t},r.prototype.updateSorts=function(e,r,i){if(_.isEqual(r,i))return e;for(var n=[],a=e.defn.select(),o=0,s=i;o<s.length;o++)for(var l=s[o],u=_.sortBy(l,(function(e){return e.sortOrder})),c=0,p=u;c<p.length;c++){var d=p[c],f=a.withName(d.queryName);n.push({direction:d.sort,expr:f.expr})}return new t.contracts.VisualQuery(e.defn.orderBy(n),e.projections)},r.prototype.getQueryRefsByRole=function(e,t){var r={};if(_.isEmpty(t))return r;for(var i=0,n=t;i<n.length;i++){var a=n[i],o=e.tryGetExprs(a.name);r[a.name]=_.map(o,(function(t){return e.defn.selectNameOf(t)}))}return r},r.prototype.setFilteredToUniqueValueProperties=function(e,t,r,i,n,a,o){var s=this;if(!e||!e.dataFilter)return a;for(var l,u=n.defn.select(),c=e.dataFilter.where(),p=e.queryRefsForSingleItemDrillFilters,d=0,f=i;d<f.length;d++){var v=f[d];v&&v.categorical&&v.categorical.categories&&h.visitCategoricalCategories(v.categorical.categories,{visitRole:function(e,i){if(!_.isEmpty(e.items))for(var n=0,o=e.items;n<o.length;n++){var d=o[n],f=d.queryName;if(d.filteredToUniqueValueProperty&&_.contains(p,f)){var v=u.withName(f),h=s.isFilteredToUniqueValues(v.expr,c,r,t);h&&(l||(l=a?C.clone(a):{}),s.setFilteredToUniqueValueProperty(h,d,l))}}}})}return l||a},r.prototype.isFilteredToUniqueValues=function(e,r,i,n){if(!n||!n.hasAmbiguousEqualitySemantics)return!0;for(var a=e.getKeyColumns(i),o=!1,s=0,l=a;s<l.length;s++){var u=l[s],c=t.FilterUtils.getFiltersForColumn(r,u);if(!_.isEmpty(c)){o=!0;for(var p=0,d=c;p<d.length;p++){var f=d[p],v=_.flatten(t.FilterUtils.getFilterValues(f,u));if(_.any(v,(function(e){return!D.isConstant(e)||n.hasAmbiguousEqualitySemantics(e)})))return!1}}}return o},r.prototype.setFilteredToUniqueValueProperty=function(e,t,r){var i=t.filteredToUniqueValueProperty,n=R.boolean(e),a={metadata:t.queryName};C.setValue(r,i,a,n)},r.prototype.setScalarKeyProperties=function(e,t,r,i,n){for(var a,o=this,s=0,l=t;s<l.length;s++){var u=l[s];h.visitMapping(u,{visitRole:function(t,s){if(t.items)for(var l=0,u=t.items;l<u.length;l++){var c=u[l];if(c.scalarKeyMinProperty){if(!a)if(i){var p=x.serializeObjects(i,n);a=x.deserializeObjects(p,n)}else a={};o.setScalarKeyProperty(e,r,t,c,a)}}}})}return a||i},r.prototype.setScalarKeyProperty=function(t,r,i,n,a){var o=n.scalarKeyMinProperty;e.contract.check(n.hasScalarKey,"Scalar key requested when not available");var s=r.defn.select().withName(n.queryName).expr,l=R.aggregate(P.getScalarKeyExpr(s,t),3),u={data:[E.fromRoles([i.role])]};C.setValue(a,o,u,l)},r.prototype.compileNoMappingsWithProperties=function(r,i,n,a,o,s,l){if(!i&&_.isEmpty(a)){i=new t.contracts.VisualQuery(V.create(),{});var u=this.getQueryRefsByRole(i,o),c=g.extend(i.defn,s,l,u,i.projections,n);if(c){var p=new t.contracts.VisualQuery(c.queryDefn,i.projections),d=c.additionalProjections,f=e.data.compileDataView({mappings:[{table:{rows:{for:{in:"*"}}}}],queryDefn:i.defn,queryProjections:i.projections,schema:r,objectDescriptors:s,objectDefinitions:l,roles:o});return{query:p||i,mappings:f,additionalProjections:d,objectDefinitions:l}}}},r.prototype.generateQuery=function(e,t,r,i,n,a,o,s,l,u){var c=this.getQueryGeneratorOptions(t,r,i,n,a,o,s,l,u),p=e.execute(c);return{result:p,query:r.query}},r.prototype.generateFlattenedQuery=function(e,t,r,i,n,a,o,s,l,u){var c=this.getQueryGeneratorOptions(t,r,i,n,a,o,s,l,u);return e.executeForQueryOnly?e.executeForQueryOnly(c):c.query},r.prototype.getQueryGeneratorOptions=function(e,r,i,n,a,o,s,l,u){var c=r.query,p=t.TransformGeneratorUtils.rewriteTransform(this.transformPluginService,c,i,this.getQueryRefsByRole(r.query,i),r.additionalProjections,r.mappings),d=this.filterGenerator.resolveFilterTargets(e,p,i,n,a),f=u?u(d):d;return{query:f,mappings:r.mappings,additionalProjections:r.additionalProjections,highlightFilter:o,restartToken:s,dataWindow:l}},r})();r.getDataViewMappingErrorFromFailures=d;var O,M=(function(){function t(t,r){this.messageId="VisualContainer_FailedToLoadVisual",this.displayableErrorInfo=[{errorInfoKey:"",errorInfoValue:""}],this.errorCode=t,"Missing_References"===t?(this.displayableErrorInfo[0].errorInfoKey="Missing_References_Details_Title",this.displayableErrorInfo[0].errorInfoValue=r,this.detailsMessageFormat="Missing_References_Details_Message",this.messageId="Missing_References_Message"):"Broken_Filters"===t&&(this.displayableErrorInfo[0].errorInfoKey="ServiceError_CannotLoadVisual",this.displayableErrorInfo[0].errorInfoValue=e.common.localize.get("Broken_Filters_Details_Message"),this.messageId="Broken_Filters_Message")}return t.create=function(e){if(!_.isEmpty(e)){for(var r=[],i=0,n=e;i<n.length;i++){var a=n[i],o=F.asFieldPattern(a),s=w.toFieldExprEntityItemPattern(o),l=w.getPropertyName(o);o.hierarchy&&(l=o.hierarchy.name),o.hierarchyLevel&&(l=o.hierarchyLevel.name+"."+o.hierarchyLevel.level);var u="("+s.entity+") "+l;r.push(u)}return new t("Missing_References",r.join(", "))}},Object.defineProperty(t.prototype,"code",{get:function(){return this.errorCode},enumerable:!0,configurable:!0}),t.prototype.getDetails=function(e){var t=e.get(this.displayableErrorInfo[0].errorInfoKey),r=this.displayableErrorInfo[0].errorInfoValue;this.detailsMessageFormat&&(r=T.format(e.get(this.detailsMessageFormat),r));var i={message:e.get(this.messageId),displayableErrorInfo:[{errorInfoKey:t,errorInfoValue:r}],debugErrorInfo:[{errorInfoKey:v.ClientErrorCode,errorInfoValue:this.code}]};return i},t})();!(function(e){function t(e,t,i,n){for(var a=new r(t.defn,i,n),o=0,s=e;o<s.length;o++){var l=s[o];h.visitMapping(l,a)}return a.warnings}e.validateAndAdjustRolesIfNecessary=t;var r=(function(){function e(e,t,r){this.displayNameService=r,this.incompatibleExprInfo=[];for(var i=0,n=e.select();i<n.length;i++){var a=n[i],o=F.asFieldPattern(a.expr);o&&o.percentOfGrandTotal&&this.incompatibleExprInfo.push({basePropertyName:w.getPropertyName(o),fieldDisplayName:this.displayNameService.getQualifiedDisplayName(a.expr,t)})}this.warnings=[]}return e.prototype.visitRole=function(e){e.showAll&&this.incompatibleExprInfo.length>0&&(e.showAll=!1,this.warnings.push(new i(e.role,this.incompatibleExprInfo)))},e})(),i=(function(){function e(e,t){this.roleName=e,this.errorInfos=t}return Object.defineProperty(e.prototype,"code",{get:function(){return"ShowAllDiabledWarning"},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t=e.get("ShowAllDisabledWarning_Value"),r=_.map(this.errorInfos,(function(e){return e.fieldDisplayName})).join(", "),i={message:e.get("ShowAllDisabledWarning_Message"),displayableErrorInfo:[{errorInfoKey:e.get("ShowAllDiabledWarning_ErrorInfoKey"),errorInfoValue:T.format(t,r)}]};return i},e})()})(O||(O={}));var A;!(function(t){function r(t){if(t&&t.highlightFilter){var r=_.find(t.highlightFilter.where(),(function(t){return 3===e.data.FilterKindDetector.run(t.condition)}));if(r)return t.highlightFilter=void 0,[new i]}}t.validateAndAdjustHighlightIfNecessary=r;var i=(function(){function e(){}return Object.defineProperty(e.prototype,"code",{get:function(){return"HighlightWithTOPNDisabledWarning"},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(e){var t={message:e.get("HighlightWithTOPNDisabledWarning_Message"),displayableErrorInfo:[{errorInfoKey:e.get("HighlightWithTOPNDisabledWarning_ErrorInfoKey"),errorInfoValue:e.get("HighlightWithTOPNDisabledWarning_Value")}]};return t},e})()})(A||(A={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e){return new i(e)}t.createVisualRelationshipService=r;var i=(function(){function r(e){this.visualPluginService=e}return r.prototype.getVisualRelationship=function(e,t,r){var i=_.filter(e.relationships,(function(e){return e.source===t&&e.target===r}));if(i)return i[0]},r.prototype.getVisualRelationshipFilterAction=function(r,i,n,a){var o=this.getVisualRelationship(r,i,n);if(o&&t.VisualRelationshipUtils.supportsFilterActionTarget(i,n,o.type,this.visualPluginService))return o.type;if(n&&n.config&&n.config.singleVisual){var s=n.config.singleVisual,l=s.visualType,u=this.visualPluginService.capabilities(l),c=s.query;if(u&&c){var p=this.visualPluginService.getPlugin(l);if(p&&p.isCrossFilteredByDefault){var d=s.objects,f={mappings:u.dataViewMappings,queryDefn:c.defn,queryProjections:c.projections,schema:a,objectDescriptors:u.objects,objectDefinitions:d,roles:u.dataRoles},v=e.data.compileDataView(f),h={dataViewMappings:v};if(p.isCrossFilteredByDefault(h))return 3}}}return 0},r})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){var i;!(function(r){function i(r,i,n,a){var o=t.util.VisualContainerUtils.getVisualType(i),s=t.util.VisualContainerUtils.getVisualType(r);if(!_.isEmpty(s)&&!_.isEmpty(o)){var l=a.capabilities(o),u=t.util.VisualContainerUtils.isQueryVisual(o,a),c=!l||l.supportsHighlight;switch(n){case 1:return u;case 2:return c&&s!==e.visuals.plugins.slicer.name;case 3:return u||c}}return!1}function n(e,r){var i=t.util.VisualContainerUtils.getVisualType(e);if(_.isEmpty(i)||!t.util.VisualContainerUtils.isQueryVisual(i,r))return!1;var n=r.capabilities(i);return!n||n.supportsSelection!==!1}function a(e,t,r){return i(e,t,2,r)?2:i(e,t,1,r)?1:void 0}r.supportsFilterActionTarget=i,r.supportsAnyFilterAction=n,r.getDefaultFilterAction=a})(i=r.VisualRelationshipUtils||(r.VisualRelationshipUtils={}))})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t,r,i){return new s(e,t,r,i)}var i=e.data.SemanticFilter,n=e.data.SemanticQuery,a=e.data.services.SemanticQuerySerializer,o=e.data.SQExprBuilder;t.createHostFiltersService=r;var s=(function(){function e(e,t,r,i){this.conceptualSchemaProxy=e,this.dataProxyFactory=t,this.promiseFactory=r,this.eventBridge=i,this.filtersDictionary={}}return e.prototype.getHostAvailableCategories=function(e,t){var r=this;if(e&&1===e.length){var i=e[0];return this.conceptualSchemaProxy.get(e).then((function(e){var n=i.name,a=e.schema(n).entities,o=_.map(a,(function(e){return e.properties})),s=_.flatten(o),l=_.filter(t,(function(e){return 1===r.typeWithinSchemaCount(s,e)}));if(l.length>0){var u={categories:l};return u}return{categories:[]}}))}return this.promiseFactory.reject()},e.prototype.typeWithinSchemaCount=function(e,t){var r=_.filter(e,(function(e){return e.type.extendedType===t.extendedType}));return r.length},e.prototype.addOrUpdateHostFilters=function(e,t,r){var i=this;return t&&1===t.length?this.conceptualSchemaProxy.get(t).then((function(n){return i.promiseFactory.all(_.map(e,(function(e){return i.addOrUpdateHostFilter(t[0],n,e,r)})))})):this.promiseFactory.reject()},e.prototype.removeHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];void 0!==this.filtersDictionary[i]&&delete this.filtersDictionary[i]}},e.prototype.selectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.filtersDictionary[i];n&&(n.selected=!0)}},e.prototype.deselectHostFilters=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this.filtersDictionary[i];n&&(this.filtersDictionary[i].selected=!1)}},e.prototype.applySelectedHostFilters=function(){this.eventBridge.publishToChannel(t.events.visualContainerChanged,{affectContainer:function(){return!0},allowCache:!0})},e.prototype.getSelectedHostFilters=function(){var e=[];for(var t in this.filtersDictionary){var r=this.filtersDictionary[t];r.selected&&e.push(r.filterContainer)}return{filters:e}},e.prototype.addOrUpdateHostFilter=function(e,t,r,a){if(r.type&&r.value){var s=r.value.toString(),l={hostFilterValue:{value:s,type:r.type},filterValue:s,filterKey:r.type.categoryString,filterCanExecute:!1,filterReturnNonEmptyResults:!1},u=e.name,c=t.schema(u).entities,p=_.reduce(c,(function(e,t){var i=_.filter(t.properties,(function(e){return e.type.extendedType===r.type.extendedType}));return e.push.apply(e,_.map(i,(function(e){return{entity:t,property:e}}))),e}),[]);if(1===p.length){var d=p[0].entity,f=p[0].property,v=o.entity(u,d.name),h=o.columnRef(v,f.name),g=r.alternativeValues?r.alternativeValues.concat(r.value):[r.value],m=o.inValues([h],_.map(g,(function(e){return[o.typedConstant(e,r.type)]}))),y=i.fromSQExpr(m),b={name:l.filterKey,expression:v,filter:y};if(l.filterCanExecute=!0,this.filtersDictionary[l.filterKey]={filterContainer:b,selected:!1},a){var C=n.create().addSelect(h).addSemanticFilter(y);if(C)return this.testHostFilterForNonEmptyResults(e,l,C)}}return this.promiseFactory.resolve(l)}},e.prototype.testHostFilterForNonEmptyResults=function(e,t,r){if(t.filterCanExecute&&r&&e){var i={type:e.type,query:{dataSources:[e.dsr],command:{Commands:[{SemanticQueryDataShapeCommand:{Query:a.serializeQuery(r)}}]},allowCache:!0,cacheResponseOnServer:!0}},n=this.dataProxyFactory.create();return n.execute(i).then((function(e){return e.dataReaderResult.dataView.table.rows.length>0&&(t.filterReturnNonEmptyResults=!0),t}),(function(){return t}))}this.promiseFactory.reject()},e})()})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){function r(e,t){var r=new o(e,t);return r}var i=e.data.SemanticFilter,n=e.data.SQExprConverter,a=e.data.SQExprUtils;t.createAnalyzedFilter=r;var o=(function(){function t(e,t){this.filter=e.filter,this.isNotFilter=!1,this.analyze(e,t)}return t.prototype.analyze=function(t,r){if(!i.isAnyFilter(this.filter)){var o=t.fieldSQExprs,s=i.isDefaultFilter(this.filter);if(this.filter&&!s){var l=n.asScopeIdsContainer(this.filter,o);l&&(this.isNotFilter=l.isNot,this.selectedIdentities=l.scopeIds)}if(this.defaultValue=this.getDataViewDefaultValue(t.dataView,t.defaultValuePropertyId),this.defaultValue&&!r&&(this.filter||(this.filter=i.getDefaultValueFilter(o),s=!0),s)){var u=e.data.createDataViewScopeIdentity(a.getDataViewScopeIdentityComparisonExpr(o,this.defaultValue.identityFieldsValues));this.isNotFilter=!1,this.selectedIdentities=[u]}}},t.prototype.getDataViewDefaultValue=function(t,r){if(t&&t.metadata&&!_.isEmpty(t.metadata.columns))return e.DataViewObjects.getValue(t.metadata.columns[0].objects,r)},t})();t.FilterAnalyzer=o})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(t){var r=e.data.FilterKindDetector,i=e.data.SemanticFilter,n=(function(){function t(e){this.options=e}return t.prototype.resolveSemanticFilter=function(e){if(!e)return null;var t=this.resolveFilters(e.where());return t?new i(e.from(),t):e},t.prototype.resolveSemanticQuery=function(e){return e?e.where(this.resolveFilters(e.where()),e.from()):null},t.prototype.resolveFilters=function(e){var t=this;return e?_.map(e,(function(e){return t.resolveFilter(e)})):null},t.prototype.resolveFilter=function(e){if(!e)return null;if(e.target)return e;if(e.condition){var t=r.run(e.condition);switch(t){case 0:return this.resolveColumnFilter(e);case 2:return this.resolveExistsFilter(e);case 1:return this.resolveMeasureFilter(e);case 3:return this.resolveTopNFilter(e);default:return}}},t.prototype.resolveColumnFilter=function(e){return{condition:e.condition}},t.prototype.resolveMeasureFilter=function(e){var t=null;this.options.mappings&&this.options.mappings.measureFilter&&(t=this.options.mappings.measureFilter.targetRoles),t||(t=this.getDefaultMeasureFilterTargetRoles());var r,i;if(t)for(var n=0,a=t;n<a.length;n++){var o=a[n],s=this.options.queryProjections[o];if(s)for(var l=0,u=s.all();l<u.length;l++){var c=u[l],p=this.options.select.filter((function(e){return e.name===c.queryRef})),d=p[0].expr,f=p[0].name,v=d.getMetadata(this.options.schema),h=r&&r[f];v&&1!==v.kind&&!h&&(i||(i=[],r={}),i.push(d),r[f]=!0)}}return{target:i,condition:e.condition}},t.prototype.resolveExistsFilter=function(e){return e},t.prototype.resolveTopNFilter=function(e){return{condition:e.condition}},t.prototype.getDefaultMeasureFilterTargetRoles=function(){var t=this.options.dataRoles?this.options.dataRoles.filter((function(t){return t.kind===e.VisualDataRoleKind.Grouping||t.kind===e.VisualDataRoleKind.GroupingOrMeasure})):[];return t.map((function(e){return e.name}))},t})();t.VisualFilterMappingResolver=n})(r=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function r(t,r){var i=r.capabilities(t);return!!(i&&i.dataViewMappings&&e.VisualContainerUtils.isQueryVisual(t,r))&&(!i.disableVisualDetails&&_.any(i.dataViewMappings,(function(e){return e.categorical||e.matrix||e.table||e.tree})))}function i(e,r){var i,n,a=r||1;return 1===a?(i=e.width-2*t.DetailVisualBorder,n=e.height-t.DetailVisualBorder):(i=e.width-t.DetailVisualBorder,n=e.height-2*t.DetailVisualBorder),{width:Math.max(i,0),height:Math.max(n,0)}}t.DetailVisualBorder=10,t.supportsVisualDetails=r,t.getDetailVisualViewport=i})(t=e.DetailVisualUtils||(e.DetailVisualUtils={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var r;!(function(r){function i(t,r,i,n,o){if(!t)return i;var s=[],l=o.objects,u=function(e){var r=l[e],n=function(n){if(r.properties[n].type.queryTransform){var o=_.filter(t[e],(function(e){return a(e,i)}));s.push.apply(s,_.map(o,(function(t){return{objectName:e,propertyName:n,object:t}})))}};for(var o in r.properties)n(o)};for(var c in l)u(c);if(_.isEmpty(s))return i;for(var p=i.clone(),d=0,h=s;d<h.length;d++){var g=h[d],m=f.getValue(t,{objectName:g.objectName,propertyName:g.propertyName},g.object.selector);if(!m)return i;if(m.algorithm!==v.name||_.any(r,e.DataViewMapping.isForecastDefined)){var y=n.getTransformPlugin(m.algorithm);p.addTransform(y,m.parameters,o)}}return p}function n(t,r,i){var n=r.defn.transforms();if(_.isEmpty(n))return r;for(var a=r.clone(),o=0,s=n;o<s.length;o++){var l=s[o];if(l.algorithm===e.data.transforms.plugins.Forecast.name&&!_.any(i,e.DataViewMapping.isForecastDefined)){var u=t.getTransformPlugin(l.algorithm);a.removeTransform(u,l.name)}}return a}function a(e,t){if(!e.selector||!_.isString(e.selector.metadata))return!0;var r=t.projections;if(!r)return!1;for(var i in r){var n=r[i];if(n){var a=n.all();if(a)for(var o=0,s=a;o<s.length;o++){var l=s[o];if(l.queryRef===e.selector.metadata)return!0}}}return!1}function o(e,t,r,i,n,a){var o=t.defn.transforms();if(_.isEmpty(o))return t;var c=t.defn.select();if(_.isEmpty(c))return t;for(var p=u(t,r,i,n),d=p.transformSelects,f=p.topLevelSelects,v=[],m=0;m<o.length;m++){var y=o[m],C=e.getTransformPlugin(y.algorithm),S="input"+m,x="output"+m,E={algorithm:y.algorithm,name:y.name,input:{parameters:y.input.parameters,table:{name:S,columns:s(d,i,r,C,a)}},output:{table:{name:x,columns:l(d,S,t.projections)}}};d=_.map(E.output.table.columns,(function(e){var t=g.columnRef(g.transformTableRef(x),e.expression.name);return{name:e.expression.name,expr:t}})),v.push(E)}var w,P=_.last(v),V=t.defn.orderBy();P&&!_.isEmpty(V)&&(w=_.map(V,(function(e){var t=_.find(c,(function(t){return h.equals(t.expr,e.expr)})),r=g.columnRef(g.transformTableRef(P.output.table.name),t.name);return{direction:e.direction,expr:r}})));var D=t.defn.transforms(v);if(!_.isEmpty(f))for(var R=function(e){var t=_.findIndex(c,(function(t){
return t.name===e.name}));d.splice(t,0,e)},F=0,j=f;F<j.length;F++){var T=j[F];R(T)}return D=D.select(d),w&&(D=D.orderBy(w)),new b(D,t.projections)}function s(e,t,r,i,n){var a=_.filter(e,(function(e){return!h.isTransformOutputRoleRef(e.expr)})),o=c(n),s=Object.keys(t);return _.map(a,(function(e){var n=_.find(s,(function(r){return _.contains(t[r],e.name)}));if(!n)return{role:"X",expression:e};var a=_.find(r,(function(e){return e.name===n}));return{role:o&&0===a.cartesianKind?void 0:p(e.expr,i,a),expression:e}}))}function l(e,t,r){for(var i={},n=0,a=e;n<a.length;n++){var o=a[n];h.isTransformOutputRoleRef(o.expr)||(i[o.name]=!0)}return _.map(e,(function(e){var n,a,o;if(h.isTransformOutputRoleRef(e.expr)){var s=void 0;for(var l in r){var u=r[l].all();_.any(u,(function(t){return t.queryRef===e.name}))&&(s=l)}n=s,a=e.expr,o=y.findUniqueName(i,e.name)}else a=g.columnRef(g.transformTableRef(t),e.name),o=e.name;return{role:n,expression:{name:o,expr:a}}}))}function u(e,t,r,i){for(var n=[],a=[],o=e.defn.select(),s=0;s<o.length;s++)if(h.isTransformOutputRoleRef(o[s].expr))n.push(o[s]);else{var l=Object.keys(r),u=_.filter(l,(function(e){return _.contains(r[e],o[s].name)}));if(_.isEmpty(u)){if(!_.isEmpty(i)){var c=_.find(i,(function(e){return e.queryName===o[s].name}));c&&c.selector&&c.selector.data?n.push(o[s]):a.push(o[s])}}else{for(var p=!1,d=0,f=u;d<f.length;d++){var v=f[d];if(!e.projections[v].activeProjectionRefs||_.contains(e.projections[v].activeProjectionRefs,o[s].name)){n.push(o[s]),p=!0;break}}p||a.push(o[s])}}return{transformSelects:n,topLevelSelects:a}}function c(e){for(var t=!1,r=0,i=e;r<i.length;r++){var n=i[r],a=n.categorical;if(a){var o=n.categorical.categories;_.isEmpty(o)||d.visitCategoricalCategories(o,{visitRole:function(e){_.any(e.items,(function(e){return e.scalarKeyMinProperty}))&&(t=!0)}})}if(t)break}return t}function p(e,t,r){var i=_.find(t.inputRoles,(function(t){var i=t.visualDataRoleMatching;return!i||(void 0===i.cartesianKind||i.cartesianKind===r.cartesianKind)&&((void 0===i.isGrouping||i.isGrouping!==m.isMeasure(e))&&(void 0===i.isMeasure||i.isMeasure===m.isMeasure(e)))}));if(i)return i.name}var d=e.data.CompiledDataViewMapping,f=e.data.DataViewObjectDefinitions,v=e.data.transforms.plugins.Forecast,h=e.data.SQExpr,g=e.data.SQExprBuilder,m=e.data.SQExprUtils,y=jsCommon.StringExtensions,b=t.contracts.VisualQuery;r.addTransforms=i,r.removeUnsupportedTransforms=n,r.rewriteTransform=o})(r=t.TransformGeneratorUtils||(t.TransformGeneratorUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.invalidSortExprIndex=-1;var t;!(function(e){function t(){return{color:e.DefaultCanvasBackgroundColor,transparency:e.DefaultCanvasBackgroundTransparency}}e.DefaultCanvasWidth=960,e.DefaultCanvasHeight=720,e.DefaultCanvasBackgroundColor="#FFFFFF",e.DefaultCanvasBackgroundTransparency=0,e.DefaultWidescreenWidth=1280,e.DefaultWidescreenHeight=720,e.DefaultCortanaWidth=296,e.DefaultCortanaHeight=592,e.DefaultLetterWidth=816,e.DefaultLetterHeight=1056,e.getDefaultCanvasBackground=t})(t=e.ExploreCanvasConstants||(e.ExploreCanvasConstants={}))})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));;var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},powerbi;!(function(e){var t;!(function(t){!(function(e){e[e.Dashboard=0]="Dashboard",e[e.Report=1]="Report"})(t.ExportVisualSource||(t.ExportVisualSource={}));t.ExportVisualSource;!(function(e){e[e.Entity=0]="Entity",e[e.ColumnRef=1]="ColumnRef",e[e.MeasureRef=2]="MeasureRef",e[e.Aggregation=3]="Aggregation",e[e.PropertyVariationSource=4]="PropertyVariationSource",e[e.Hierarchy=5]="Hierarchy",e[e.HierarchyLevel=6]="HierarchyLevel",e[e.Other=7]="Other"})(t.FieldKind||(t.FieldKind={}));t.FieldKind;!(function(e){e[e.Visual=0]="Visual",e[e.Section=1]="Section",e[e.Exploration=2]="Exploration"})(t.FilterScopeType||(t.FilterScopeType={}));t.FilterScopeType;!(function(e){e[e.Categorical=0]="Categorical",e[e.Range=1]="Range",e[e.Advanced=2]="Advanced",e[e.Passthrough=3]="Passthrough",e[e.Visual=4]="Visual",e[e.TopN=5]="TopN",e[e.Include=6]="Include",e[e.Exclude=7]="Exclude"})(t.FilterType||(t.FilterType={}));t.FilterType;!(function(e){e[e.CheckboxTickedInFieldList=0]="CheckboxTickedInFieldList",e[e.DraggedToCanvas=1]="DraggedToCanvas",e[e.VisualTypeIconClicked=2]="VisualTypeIconClicked",e[e.DraggedToFieldWell=3]="DraggedToFieldWell",e[e.InsertVisualButton=4]="InsertVisualButton"})(t.HowVisualWasCreated||(t.HowVisualWasCreated={}));t.HowVisualWasCreated;!(function(e){e[e.CheckboxTickedInFieldList=0]="CheckboxTickedInFieldList",e[e.DraggedToVisual=1]="DraggedToVisual",e[e.DraggedToFieldWell=2]="DraggedToFieldWell"})(t.HowFieldWasAddedToVisual||(t.HowFieldWasAddedToVisual={}));t.HowFieldWasAddedToVisual;!(function(e){e[e.NoCache=0]="NoCache",e[e.Cache=1]="Cache",e[e.StaleCache=2]="StaleCache"})(t.VisualInitialLoadType||(t.VisualInitialLoadType={}));t.VisualInitialLoadType;!(function(e){e[e.None=0]="None",e[e.CacheMissing=1]="CacheMissing",e[e.JsonParseFailed=2]="JsonParseFailed",e[e.DsrReadFailed=3]="DsrReadFailed",e[e.DataObjectNull=4]="DataObjectNull",e[e.DsrHasOdataError=5]="DsrHasOdataError",e[e.DataTransformsMissing=6]="DataTransformsMissing"})(t.VisualInitialLoadTypeWarning||(t.VisualInitialLoadTypeWarning={}));t.VisualInitialLoadTypeWarning;!(function(e){e[e.LaunchIDEFail=0]="LaunchIDEFail",e[e.GenerateQueryFail=1]="GenerateQueryFail"})(t.LaunchExternalIDEFailureType||(t.LaunchExternalIDEFailureType={}));t.LaunchExternalIDEFailureType;!(function(e){e[e.View=0]="View",e[e.Edit=1]="Edit"})(t.ViewMode||(t.ViewMode={}));t.ViewMode;t.EXOpenExploration=function(t,i,r,o,n,a,s,l,c,u,d,p,v,h,g){void 0===l&&(l=!1),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0),void 0===g&&(g=void 0);var f={reportGuid:t,originalReportGuid:i,appGuid:r,isDirectQuery:o,isCancelled1:n,isOnPrem:a,parentId:s,isError:l,errorSource:c,errorCode:u,errorMessage:d,activityName:p,activityId:v,isDebug:h,isCancelled:g},m={name:"PBI.EX.OpenExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={reportGuid:f.reportGuid,originalReportGuid:f.originalReportGuid,appGuid:f.appGuid,isDirectQuery:f.isDirectQuery,isCancelled1:f.isCancelled1,isOnPrem:f.isOnPrem,parentId:f.parentId,isError:f.isError};return"undefined"!=typeof f.errorSource&&(t.errorSource=e.telemetry.ErrorSource[f.errorSource]),"undefined"!=typeof f.errorCode&&(t.errorCode=f.errorCode),"undefined"!=typeof f.errorMessage&&(t.errorMessage=f.errorMessage),"undefined"!=typeof f.activityName&&(t.activityName=f.activityName),"undefined"!=typeof f.activityId&&(t.activityId=f.activityId),"undefined"!=typeof f.isDebug&&(t.isDebug=f.isDebug),"undefined"!=typeof f.isCancelled&&(t.isCancelled=f.isCancelled),t},info:f,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXOpenExplorationLoggers&&(m.loggers=e.telemetry.EXOpenExplorationLoggers),m},t.EXRefreshReport=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={reportGuid:t,sectionIndex:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.RefreshReport",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={reportGuid:p.reportGuid,sectionIndex:p.sectionIndex,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXRefreshReportLoggers&&(v.loggers=e.telemetry.EXRefreshReportLoggers),v},t.EXSaveExploration=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={isSaveAs:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.SaveExploration",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={isSaveAs:d.isSaveAs,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSaveExplorationLoggers&&(p.loggers=e.telemetry.EXSaveExplorationLoggers),p},t.EXInteractionVisualConversion=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={sourceVisualType:t,targetVisualType:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.InteractionVisualConversion",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={sourceVisualType:p.sourceVisualType,targetVisualType:p.targetVisualType,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXInteractionVisualConversionLoggers&&(v.loggers=e.telemetry.EXInteractionVisualConversionLoggers),v},t.EXInteractionExpand=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={sourceVisualType:t,isInlineHierarchyEnabled:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.InteractionExpand",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={sourceVisualType:p.sourceVisualType,isInlineHierarchyEnabled:p.isInlineHierarchyEnabled,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXInteractionExpandLoggers&&(v.loggers=e.telemetry.EXInteractionExpandLoggers),v},t.EXInteractionDrill=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={sourceVisualType:t,isDrillDown:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.InteractionDrill",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={sourceVisualType:p.sourceVisualType,isDrillDown:p.isDrillDown,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXInteractionDrillLoggers&&(v.loggers=e.telemetry.EXInteractionDrillLoggers),v},t.EXDrillToDetails=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={sourceVisualType:t,targetExprKind:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.DrillToDetails",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={sourceVisualType:p.sourceVisualType,targetExprKind:e.telemetry.FieldKind[p.targetExprKind],parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXDrillToDetailsLoggers&&(v.loggers=e.telemetry.EXDrillToDetailsLoggers),v},t.EXAddFilter=function(t,i,r,o,n,a,s,l,c,u,d,p,v){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0);var h={filterType:t,filterScopeType:i,fieldKind:r,drillToDetailsMode:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:d,isDebug:p,isCancelled:v},g={name:"PBI.EX.AddFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={filterType:e.telemetry.FilterType[h.filterType],filterScopeType:e.telemetry.FilterScopeType[h.filterScopeType],fieldKind:e.telemetry.FieldKind[h.fieldKind],drillToDetailsMode:h.drillToDetailsMode,parentId:h.parentId,isError:h.isError};return"undefined"!=typeof h.errorSource&&(t.errorSource=e.telemetry.ErrorSource[h.errorSource]),"undefined"!=typeof h.errorCode&&(t.errorCode=h.errorCode),"undefined"!=typeof h.errorMessage&&(t.errorMessage=h.errorMessage),"undefined"!=typeof h.activityName&&(t.activityName=h.activityName),"undefined"!=typeof h.activityId&&(t.activityId=h.activityId),"undefined"!=typeof h.isDebug&&(t.isDebug=h.isDebug),"undefined"!=typeof h.isCancelled&&(t.isCancelled=h.isCancelled),t},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXAddFilterLoggers&&(g.loggers=e.telemetry.EXAddFilterLoggers),g},t.EXFilterPaneAdvancedFilterApplied=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={isVisualFilter:t,filterType:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.FilterPaneAdvancedFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={isVisualFilter:p.isVisualFilter,filterType:p.filterType,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXFilterPaneAdvancedFilterAppliedLoggers&&(v.loggers=e.telemetry.EXFilterPaneAdvancedFilterAppliedLoggers),v},t.EXFilterPaneClearAdvancedFilter=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.FilterPaneClearAdvancedFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXFilterPaneClearAdvancedFilterLoggers&&(d.loggers=e.telemetry.EXFilterPaneClearAdvancedFilterLoggers),d},t.EXFilterPaneTopNFilterApplied=function(t,i,r,o,n,a,s,l,c,u,d,p,v){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0);var h={isTop:t,itemCount:i,atGrain:r,onVisualMeasure:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:d,isDebug:p,isCancelled:v},g={name:"PBI.EX.FilterPaneTopNFilterApplied",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={isTop:h.isTop,itemCount:h.itemCount,atGrain:h.atGrain,onVisualMeasure:h.onVisualMeasure,parentId:h.parentId,isError:h.isError};return"undefined"!=typeof h.errorSource&&(t.errorSource=e.telemetry.ErrorSource[h.errorSource]),"undefined"!=typeof h.errorCode&&(t.errorCode=h.errorCode),"undefined"!=typeof h.errorMessage&&(t.errorMessage=h.errorMessage),"undefined"!=typeof h.activityName&&(t.activityName=h.activityName),"undefined"!=typeof h.activityId&&(t.activityId=h.activityId),"undefined"!=typeof h.isDebug&&(t.isDebug=h.isDebug),"undefined"!=typeof h.isCancelled&&(t.isCancelled=h.isCancelled),t},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXFilterPaneTopNFilterAppliedLoggers&&(g.loggers=e.telemetry.EXFilterPaneTopNFilterAppliedLoggers),g},t.EXFilterPaneExpandCollapseFilter=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={isExpanded:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.FilterPaneExpandCollapseFilter",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={isExpanded:d.isExpanded,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXFilterPaneExpandCollapseFilterLoggers&&(p.loggers=e.telemetry.EXFilterPaneExpandCollapseFilterLoggers),p},t.EXLoadFilterError=function(t){var i={message:t},r={name:"PBI.EX.LoadFilterError",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var e={message:i.message};return e},info:i,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXLoadFilterErrorLoggers&&(r.loggers=e.telemetry.EXLoadFilterErrorLoggers),r},t.EXCreateVisual=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={source:t,visualType:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.CreateVisual",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={source:e.telemetry.HowVisualWasCreated[p.source],visualType:p.visualType,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCreateVisualLoggers&&(v.loggers=e.telemetry.EXCreateVisualLoggers),v},t.EXAddField=function(t,i,r,o,n,a,s,l,c,u,d,p,v,h){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0);var g={source:t,targetVisualType:i,fieldKind:r,drillToDetailsMode:o,success:n,parentId:a,isError:s,errorSource:l,errorCode:c,errorMessage:u,activityName:d,activityId:p,isDebug:v,isCancelled:h},f={name:"PBI.EX.AddField",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={source:e.telemetry.HowFieldWasAddedToVisual[g.source],targetVisualType:g.targetVisualType,fieldKind:e.telemetry.FieldKind[g.fieldKind],drillToDetailsMode:g.drillToDetailsMode,success:g.success,parentId:g.parentId,isError:g.isError};return"undefined"!=typeof g.errorSource&&(t.errorSource=e.telemetry.ErrorSource[g.errorSource]),"undefined"!=typeof g.errorCode&&(t.errorCode=g.errorCode),"undefined"!=typeof g.errorMessage&&(t.errorMessage=g.errorMessage),"undefined"!=typeof g.activityName&&(t.activityName=g.activityName),"undefined"!=typeof g.activityId&&(t.activityId=g.activityId),"undefined"!=typeof g.isDebug&&(t.isDebug=g.isDebug),"undefined"!=typeof g.isCancelled&&(t.isCancelled=g.isCancelled),t},info:g,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXAddFieldLoggers&&(f.loggers=e.telemetry.EXAddFieldLoggers),f},t.EXChangeFieldWell=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={sourceBucketRole:t,targetBucketRole:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.ChangeFieldWell",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={sourceBucketRole:p.sourceBucketRole,targetBucketRole:p.targetBucketRole,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXChangeFieldWellLoggers&&(v.loggers=e.telemetry.EXChangeFieldWellLoggers),v},t.EXVisualFirstLoad=function(t,i,r,o,n,a,s,l,c,u,d,p,v){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0);var h={loadType:t,onPrem:i,loadTypeWarnings:r,whereVisualIsLoaded:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:d,isDebug:p,isCancelled:v},g={name:"PBI.EX.VisualFirstLoad",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={loadType:e.telemetry.VisualInitialLoadType[h.loadType],onPrem:h.onPrem,loadTypeWarnings:e.telemetry.VisualInitialLoadTypeWarning[h.loadTypeWarnings],whereVisualIsLoaded:h.whereVisualIsLoaded,parentId:h.parentId,isError:h.isError};return"undefined"!=typeof h.errorSource&&(t.errorSource=e.telemetry.ErrorSource[h.errorSource]),"undefined"!=typeof h.errorCode&&(t.errorCode=h.errorCode),"undefined"!=typeof h.errorMessage&&(t.errorMessage=h.errorMessage),"undefined"!=typeof h.activityName&&(t.activityName=h.activityName),"undefined"!=typeof h.activityId&&(t.activityId=h.activityId),"undefined"!=typeof h.isDebug&&(t.isDebug=h.isDebug),"undefined"!=typeof h.isCancelled&&(t.isCancelled=h.isCancelled),t},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXVisualFirstLoadLoggers&&(g.loggers=e.telemetry.EXVisualFirstLoadLoggers),g},t.EXChangeAggregation=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={original:t,target:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.ChangeAggregation",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={original:p.original,target:p.target,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXChangeAggregationLoggers&&(v.loggers=e.telemetry.EXChangeAggregationLoggers),v},t.EXChangeQuickCalc=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={original:t,target:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.ChangeQuickCalc",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={original:p.original,target:p.target,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXChangeQuickCalcLoggers&&(v.loggers=e.telemetry.EXChangeQuickCalcLoggers),v},t.EXSetConditionalFormatting=function(t,i,r,o,n,a,s,l,c,u,d,p){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0);var v={visualType:t,diverging:i,userValueSpecified:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:d,isCancelled:p},h={name:"PBI.EX.SetConditionalFormatting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={visualType:v.visualType,diverging:v.diverging,userValueSpecified:v.userValueSpecified,parentId:v.parentId,isError:v.isError};return"undefined"!=typeof v.errorSource&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]),"undefined"!=typeof v.errorCode&&(t.errorCode=v.errorCode),"undefined"!=typeof v.errorMessage&&(t.errorMessage=v.errorMessage),"undefined"!=typeof v.activityName&&(t.activityName=v.activityName),"undefined"!=typeof v.activityId&&(t.activityId=v.activityId),"undefined"!=typeof v.isDebug&&(t.isDebug=v.isDebug),"undefined"!=typeof v.isCancelled&&(t.isCancelled=v.isCancelled),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSetConditionalFormattingLoggers&&(h.loggers=e.telemetry.EXSetConditionalFormattingLoggers),h},t.EXRemoveConditionalFormatting=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={visualType:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.RemoveConditionalFormatting",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={visualType:d.visualType,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXRemoveConditionalFormattingLoggers&&(p.loggers=e.telemetry.EXRemoveConditionalFormattingLoggers),p},t.EXExplorationRefresh=function(t,i,r,o,n,a,s,l,c,u,d,p,v){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0);var h={totalVisuals:t,numberOfScriptVisuals:i,visualIds:r,userLicense:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:d,isDebug:p,isCancelled:v},g={name:"PBI.EX.ExplorationRefresh",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={totalVisuals:h.totalVisuals,numberOfScriptVisuals:h.numberOfScriptVisuals,visualIds:h.visualIds,userLicense:h.userLicense,parentId:h.parentId,isError:h.isError};return"undefined"!=typeof h.errorSource&&(t.errorSource=e.telemetry.ErrorSource[h.errorSource]),"undefined"!=typeof h.errorCode&&(t.errorCode=h.errorCode),"undefined"!=typeof h.errorMessage&&(t.errorMessage=h.errorMessage),"undefined"!=typeof h.activityName&&(t.activityName=h.activityName),"undefined"!=typeof h.activityId&&(t.activityId=h.activityId),"undefined"!=typeof h.isDebug&&(t.isDebug=h.isDebug),"undefined"!=typeof h.isCancelled&&(t.isCancelled=h.isCancelled),t},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXExplorationRefreshLoggers&&(g.loggers=e.telemetry.EXExplorationRefreshLoggers),g},t.EXSnapshotEmbedCreate=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.SnapshotEmbedCreate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSnapshotEmbedCreateLoggers&&(d.loggers=e.telemetry.EXSnapshotEmbedCreateLoggers),
d},t.EXPublicEmbedCreate=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.PublicEmbedCreate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXPublicEmbedCreateLoggers&&(d.loggers=e.telemetry.EXPublicEmbedCreateLoggers),d},t.EXSnapshotEmbedRefresh=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.SnapshotEmbedRefresh",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSnapshotEmbedRefreshLoggers&&(d.loggers=e.telemetry.EXSnapshotEmbedRefreshLoggers),d},t.EXSnapshotEmbedDelete=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.SnapshotEmbedDelete",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSnapshotEmbedDeleteLoggers&&(d.loggers=e.telemetry.EXSnapshotEmbedDeleteLoggers),d},t.EXSnapshotEmbedUpdate=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.SnapshotEmbedUpdate",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSnapshotEmbedUpdateLoggers&&(d.loggers=e.telemetry.EXSnapshotEmbedUpdateLoggers),d},t.EXImportCustomViz=function(t,i,r,o,n,a,s,l,c,u,d,p){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0);var v={fileName:t,resourcePackageId:i,resourcePackageName:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:d,isCancelled:p},h={name:"PBI.EX.ImportCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={fileName:v.fileName,resourcePackageId:v.resourcePackageId,resourcePackageName:v.resourcePackageName,parentId:v.parentId,isError:v.isError};return"undefined"!=typeof v.errorSource&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]),"undefined"!=typeof v.errorCode&&(t.errorCode=v.errorCode),"undefined"!=typeof v.errorMessage&&(t.errorMessage=v.errorMessage),"undefined"!=typeof v.activityName&&(t.activityName=v.activityName),"undefined"!=typeof v.activityId&&(t.activityId=v.activityId),"undefined"!=typeof v.isDebug&&(t.isDebug=v.isDebug),"undefined"!=typeof v.isCancelled&&(t.isCancelled=v.isCancelled),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXImportCustomVizLoggers&&(h.loggers=e.telemetry.EXImportCustomVizLoggers),h},t.EXDeleteCustomViz=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={customVisualName:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.DeleteCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={customVisualName:d.customVisualName,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXDeleteCustomVizLoggers&&(p.loggers=e.telemetry.EXDeleteCustomVizLoggers),p},t.EXLoadReportWithCustomViz=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={whereReportIsLoaded:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.LoadReportWithCustomViz",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={whereReportIsLoaded:d.whereReportIsLoaded,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXLoadReportWithCustomVizLoggers&&(p.loggers=e.telemetry.EXLoadReportWithCustomVizLoggers),p},t.EXEnableCustomViz=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={whereVisualIsLoaded:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.EnableCustomViz",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={whereVisualIsLoaded:d.whereVisualIsLoaded,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXEnableCustomVizLoggers&&(p.loggers=e.telemetry.EXEnableCustomVizLoggers),p},t.EXVisualRelationshipOverride=function(t,i,r,o,n,a,s,l,c,u,d,p){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0);var v={sourceVisualType:t,targetVisualType:i,filterAction:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:d,isCancelled:p},h={name:"PBI.EX.VisualRelationshipOverride",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={sourceVisualType:v.sourceVisualType,targetVisualType:v.targetVisualType,filterAction:v.filterAction,parentId:v.parentId,isError:v.isError};return"undefined"!=typeof v.errorSource&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]),"undefined"!=typeof v.errorCode&&(t.errorCode=v.errorCode),"undefined"!=typeof v.errorMessage&&(t.errorMessage=v.errorMessage),"undefined"!=typeof v.activityName&&(t.activityName=v.activityName),"undefined"!=typeof v.activityId&&(t.activityId=v.activityId),"undefined"!=typeof v.isDebug&&(t.isDebug=v.isDebug),"undefined"!=typeof v.isCancelled&&(t.isCancelled=v.isCancelled),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXVisualRelationshipOverrideLoggers&&(h.loggers=e.telemetry.EXVisualRelationshipOverrideLoggers),h},t.EXSavedExplorationWithVisualRelationships=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.SavedExplorationWithVisualRelationships",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSavedExplorationWithVisualRelationshipsLoggers&&(d.loggers=e.telemetry.EXSavedExplorationWithVisualRelationshipsLoggers),d},t.EXFieldWellEnableDisableShowAll=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={isEnabled:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.FieldWellEnableDisableShowAll",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={isEnabled:d.isEnabled,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXFieldWellEnableDisableShowAllLoggers&&(p.loggers=e.telemetry.EXFieldWellEnableDisableShowAllLoggers),p},t.EXSavedExplorationWithShowAllEnabled=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.SavedExplorationWithShowAllEnabled",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSavedExplorationWithShowAllEnabledLoggers&&(d.loggers=e.telemetry.EXSavedExplorationWithShowAllEnabledLoggers),d},t.EXCodePaneUserRunScript=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.CodePaneUserRunScript",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCodePaneUserRunScriptLoggers&&(d.loggers=e.telemetry.EXCodePaneUserRunScriptLoggers),d},t.EXCodePaneUserEditScriptWithExternalIDE=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.CodePaneUserEditScriptWithExternalIDE",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCodePaneUserEditScriptWithExternalIDELoggers&&(d.loggers=e.telemetry.EXCodePaneUserEditScriptWithExternalIDELoggers),d},t.EXCodePaneUserOpenOptionsDialog=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.CodePaneUserOpenOptionsDialog",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCodePaneUserOpenOptionsDialogLoggers&&(d.loggers=e.telemetry.EXCodePaneUserOpenOptionsDialogLoggers),d},t.EXCodePaneLaunchExternalIDEFailed=function(t,i){var r={launchExternalIDEFailureType:t,message:i},o={name:"PBI.EX.CodePaneLaunchExternalIDEFailed",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={launchExternalIDEFailureType:e.telemetry.LaunchExternalIDEFailureType[r.launchExternalIDEFailureType],message:r.message};return t},info:r,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCodePaneLaunchExternalIDEFailedLoggers&&(o.loggers=e.telemetry.EXCodePaneLaunchExternalIDEFailedLoggers),o},t.EXCodePaneLaunchExternalIDESucceeded=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.CodePaneLaunchExternalIDESucceeded",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCodePaneLaunchExternalIDESucceededLoggers&&(d.loggers=e.telemetry.EXCodePaneLaunchExternalIDESucceededLoggers),d},t.EXCodePaneResize=function(t,i,r,o,n,a,s,l,c,u,d,p){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0);var v={newSize:t,wasMinimized:i,isMinimized:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:d,isCancelled:p},h={name:"PBI.EX.CodePaneResize",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={newSize:v.newSize,wasMinimized:v.wasMinimized,isMinimized:v.isMinimized,parentId:v.parentId,isError:v.isError};return"undefined"!=typeof v.errorSource&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]),"undefined"!=typeof v.errorCode&&(t.errorCode=v.errorCode),"undefined"!=typeof v.errorMessage&&(t.errorMessage=v.errorMessage),"undefined"!=typeof v.activityName&&(t.activityName=v.activityName),"undefined"!=typeof v.activityId&&(t.activityId=v.activityId),"undefined"!=typeof v.isDebug&&(t.isDebug=v.isDebug),"undefined"!=typeof v.isCancelled&&(t.isCancelled=v.isCancelled),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCodePaneResizeLoggers&&(h.loggers=e.telemetry.EXCodePaneResizeLoggers),h},t.EXCodePaneShowWarning=function(t,i){var r={warningKey:t,message:i},o={name:"PBI.EX.CodePaneShowWarning",category:e.TelemetryCategory.CriticalError,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var e={warningKey:r.warningKey,message:r.message};return e},info:r,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCodePaneShowWarningLoggers&&(o.loggers=e.telemetry.EXCodePaneShowWarningLoggers),o},t.EXCodePaneUserCloseWarning=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.CodePaneUserCloseWarning",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXCodePaneUserCloseWarningLoggers&&(d.loggers=e.telemetry.EXCodePaneUserCloseWarningLoggers),d},t.EXExportVisualData=function(t,i,r,o,n,a,s,l,c,u,d,p,v,h,g,f){void 0===c&&(c=!1),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0),void 0===g&&(g=void 0),void 0===f&&(f=void 0);var m={visualType:t,source:i,isPartialResult:r,dest:o,isPremiumUser:n,isDrillToDetailsMode:a,dataType:s,parentId:l,isError:c,errorSource:u,errorCode:d,errorMessage:p,activityName:v,activityId:h,isDebug:g,isCancelled:f},y={name:"PBI.EX.ExportVisualData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={visualType:m.visualType,source:e.telemetry.ExportVisualSource[m.source],isPartialResult:m.isPartialResult,dest:m.dest,isPremiumUser:m.isPremiumUser,isDrillToDetailsMode:m.isDrillToDetailsMode,dataType:m.dataType,parentId:m.parentId,isError:m.isError};return"undefined"!=typeof m.errorSource&&(t.errorSource=e.telemetry.ErrorSource[m.errorSource]),"undefined"!=typeof m.errorCode&&(t.errorCode=m.errorCode),"undefined"!=typeof m.errorMessage&&(t.errorMessage=m.errorMessage),"undefined"!=typeof m.activityName&&(t.activityName=m.activityName),"undefined"!=typeof m.activityId&&(t.activityId=m.activityId),"undefined"!=typeof m.isDebug&&(t.isDebug=m.isDebug),"undefined"!=typeof m.isCancelled&&(t.isCancelled=m.isCancelled),t},info:m,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXExportVisualDataLoggers&&(y.loggers=e.telemetry.EXExportVisualDataLoggers),y},t.EXExportVisualDataDialogShown=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.ExportVisualDataDialogShown",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXExportVisualDataDialogShownLoggers&&(d.loggers=e.telemetry.EXExportVisualDataDialogShownLoggers),d},t.EXExportVisualDataDialogFromVisualIsShown=function(t,i,r,o,n,a,s,l,c){void 0===i&&(i=!1),void 0===r&&(r=void 0),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0);var u={parentId:t,isError:i,errorSource:r,errorCode:o,errorMessage:n,activityName:a,activityId:s,isDebug:l,isCancelled:c},d={name:"PBI.EX.ExportVisualDataDialogFromVisualIsShown",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={parentId:u.parentId,isError:u.isError};return"undefined"!=typeof u.errorSource&&(t.errorSource=e.telemetry.ErrorSource[u.errorSource]),"undefined"!=typeof u.errorCode&&(t.errorCode=u.errorCode),"undefined"!=typeof u.errorMessage&&(t.errorMessage=u.errorMessage),"undefined"!=typeof u.activityName&&(t.activityName=u.activityName),"undefined"!=typeof u.activityId&&(t.activityId=u.activityId),"undefined"!=typeof u.isDebug&&(t.isDebug=u.isDebug),"undefined"!=typeof u.isCancelled&&(t.isCancelled=u.isCancelled),t},info:u,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXExportVisualDataDialogFromVisualIsShownLoggers&&(d.loggers=e.telemetry.EXExportVisualDataDialogFromVisualIsShownLoggers),d},t.EXSeeDataNoMatrixData=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={visualType:t,reason:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.SeeDataNoMatrixData",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={visualType:p.visualType,reason:p.reason,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXSeeDataNoMatrixDataLoggers&&(v.loggers=e.telemetry.EXSeeDataNoMatrixDataLoggers),v},t.EXLoadReportWithScriptVis=function(t,i,r,o,n,a,s,l,c,u,d,p,v){void 0===a&&(a=!1),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0);var h={countTotalVisuals:t,countScriptVisuals:i,visualIds:r,userLicense:o,parentId:n,isError:a,errorSource:s,errorCode:l,errorMessage:c,activityName:u,activityId:d,isDebug:p,isCancelled:v},g={name:"PBI.EX.LoadReportWithScriptVis",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={countTotalVisuals:h.countTotalVisuals,countScriptVisuals:h.countScriptVisuals,visualIds:h.visualIds,userLicense:h.userLicense,parentId:h.parentId,isError:h.isError};return"undefined"!=typeof h.errorSource&&(t.errorSource=e.telemetry.ErrorSource[h.errorSource]),"undefined"!=typeof h.errorCode&&(t.errorCode=h.errorCode),"undefined"!=typeof h.errorMessage&&(t.errorMessage=h.errorMessage),"undefined"!=typeof h.activityName&&(t.activityName=h.activityName),"undefined"!=typeof h.activityId&&(t.activityId=h.activityId),"undefined"!=typeof h.isDebug&&(t.isDebug=h.isDebug),"undefined"!=typeof h.isCancelled&&(t.isCancelled=h.isCancelled),t},info:h,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXLoadReportWithScriptVisLoggers&&(g.loggers=e.telemetry.EXLoadReportWithScriptVisLoggers),g},t.ExploreHostChangeReportPage=function(t,i,r,o,n,a,s,l,c,u,d,p){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0);var v={reportId:t,reportGuid:i,sectionIndex:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:d,isCancelled:p},h={name:"PBI.ExploreHost.ChangeReportPage",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={reportId:v.reportId,reportGuid:v.reportGuid,sectionIndex:v.sectionIndex,parentId:v.parentId,isError:v.isError};return"undefined"!=typeof v.errorSource&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]),"undefined"!=typeof v.errorCode&&(t.errorCode=v.errorCode),"undefined"!=typeof v.errorMessage&&(t.errorMessage=v.errorMessage),"undefined"!=typeof v.activityName&&(t.activityName=v.activityName),"undefined"!=typeof v.activityId&&(t.activityId=v.activityId),"undefined"!=typeof v.isDebug&&(t.isDebug=v.isDebug),"undefined"!=typeof v.isCancelled&&(t.isCancelled=v.isCancelled),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.ExploreHostChangeReportPageLoggers&&(h.loggers=e.telemetry.ExploreHostChangeReportPageLoggers),h},t.EXAnalyticsPaneOpen=function(t,i,r,o,n,a,s,l,c,u,d){void 0===o&&(o=!1),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),
void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0);var p={hasContent:t,visualType:i,parentId:r,isError:o,errorSource:n,errorCode:a,errorMessage:s,activityName:l,activityId:c,isDebug:u,isCancelled:d},v={name:"PBI.EX.AnalyticsPane.Open",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={hasContent:p.hasContent,visualType:p.visualType,parentId:p.parentId,isError:p.isError};return"undefined"!=typeof p.errorSource&&(t.errorSource=e.telemetry.ErrorSource[p.errorSource]),"undefined"!=typeof p.errorCode&&(t.errorCode=p.errorCode),"undefined"!=typeof p.errorMessage&&(t.errorMessage=p.errorMessage),"undefined"!=typeof p.activityName&&(t.activityName=p.activityName),"undefined"!=typeof p.activityId&&(t.activityId=p.activityId),"undefined"!=typeof p.isDebug&&(t.isDebug=p.isDebug),"undefined"!=typeof p.isCancelled&&(t.isCancelled=p.isCancelled),t},info:p,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXAnalyticsPaneOpenLoggers&&(v.loggers=e.telemetry.EXAnalyticsPaneOpenLoggers),v},t.EXLoadReportContainer=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={reportGuid:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.LoadReportContainer",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={reportGuid:d.reportGuid,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXLoadReportContainerLoggers&&(p.loggers=e.telemetry.EXLoadReportContainerLoggers),p},t.EXInitExploration=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={reportGuid:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.InitExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={reportGuid:d.reportGuid,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXInitExplorationLoggers&&(p.loggers=e.telemetry.EXInitExplorationLoggers),p},t.EXFetchExploration=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={reportGuid:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.FetchExploration",category:e.TelemetryCategory.Verbose,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={reportGuid:d.reportGuid,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXFetchExplorationLoggers&&(p.loggers=e.telemetry.EXFetchExplorationLoggers),p},t.EXAnalyticsPaneAddInstance=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={objectName:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.AnalyticsPane.AddInstance",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={objectName:d.objectName,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXAnalyticsPaneAddInstanceLoggers&&(p.loggers=e.telemetry.EXAnalyticsPaneAddInstanceLoggers),p},t.EXAnalyticsPaneRemoveInstance=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={objectName:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.AnalyticsPane.RemoveInstance",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={objectName:d.objectName,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXAnalyticsPaneRemoveInstanceLoggers&&(p.loggers=e.telemetry.EXAnalyticsPaneRemoveInstanceLoggers),p},t.EXAnalyticsPaneForecastParameterUpdated=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={seasonality:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.AnalyticsPane.ForecastParameterUpdated",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={seasonality:d.seasonality,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXAnalyticsPaneForecastParameterUpdatedLoggers&&(p.loggers=e.telemetry.EXAnalyticsPaneForecastParameterUpdatedLoggers),p},t.EXChangeCanvasLayout=function(t,i,r,o,n,a,s,l,c,u,d,p){void 0===n&&(n=!1),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0);var v={sourceLayout:t,targetLayout:i,viewMode:r,parentId:o,isError:n,errorSource:a,errorCode:s,errorMessage:l,activityName:c,activityId:u,isDebug:d,isCancelled:p},h={name:"PBI.EX.ChangeCanvasLayout",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={sourceLayout:e.telemetry.CanvasLayout[v.sourceLayout],targetLayout:e.telemetry.CanvasLayout[v.targetLayout],viewMode:e.telemetry.ViewMode[v.viewMode],parentId:v.parentId,isError:v.isError};return"undefined"!=typeof v.errorSource&&(t.errorSource=e.telemetry.ErrorSource[v.errorSource]),"undefined"!=typeof v.errorCode&&(t.errorCode=v.errorCode),"undefined"!=typeof v.errorMessage&&(t.errorMessage=v.errorMessage),"undefined"!=typeof v.activityName&&(t.activityName=v.activityName),"undefined"!=typeof v.activityId&&(t.activityId=v.activityId),"undefined"!=typeof v.isDebug&&(t.isDebug=v.isDebug),"undefined"!=typeof v.isCancelled&&(t.isCancelled=v.isCancelled),t},info:v,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXChangeCanvasLayoutLoggers&&(h.loggers=e.telemetry.EXChangeCanvasLayoutLoggers),h},t.EXClusteringAddClustering=function(t,i,r,o,n,a,s,l,c,u,d,p,v,h){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0);var g={numberOfClusters:t,visualType:i,numberOfMeasures:r,numberOfDimensions:o,numberOfFilters:n,parentId:a,isError:s,errorSource:l,errorCode:c,errorMessage:u,activityName:d,activityId:p,isDebug:v,isCancelled:h},f={name:"PBI.EX.Clustering.AddClustering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={numberOfClusters:g.numberOfClusters,visualType:g.visualType,numberOfMeasures:g.numberOfMeasures,numberOfDimensions:g.numberOfDimensions,numberOfFilters:g.numberOfFilters,parentId:g.parentId,isError:g.isError};return"undefined"!=typeof g.errorSource&&(t.errorSource=e.telemetry.ErrorSource[g.errorSource]),"undefined"!=typeof g.errorCode&&(t.errorCode=g.errorCode),"undefined"!=typeof g.errorMessage&&(t.errorMessage=g.errorMessage),"undefined"!=typeof g.activityName&&(t.activityName=g.activityName),"undefined"!=typeof g.activityId&&(t.activityId=g.activityId),"undefined"!=typeof g.isDebug&&(t.isDebug=g.isDebug),"undefined"!=typeof g.isCancelled&&(t.isCancelled=g.isCancelled),t},info:g,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXClusteringAddClusteringLoggers&&(f.loggers=e.telemetry.EXClusteringAddClusteringLoggers),f},t.EXClusteringWarning=function(t,i,r,o,n,a,s,l,c,u){void 0===r&&(r=!1),void 0===o&&(o=void 0),void 0===n&&(n=void 0),void 0===a&&(a=void 0),void 0===s&&(s=void 0),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0);var d={code:t,parentId:i,isError:r,errorSource:o,errorCode:n,errorMessage:a,activityName:s,activityId:l,isDebug:c,isCancelled:u},p={name:"PBI.EX.Clustering.Warning",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={code:d.code,parentId:d.parentId,isError:d.isError};return"undefined"!=typeof d.errorSource&&(t.errorSource=e.telemetry.ErrorSource[d.errorSource]),"undefined"!=typeof d.errorCode&&(t.errorCode=d.errorCode),"undefined"!=typeof d.errorMessage&&(t.errorMessage=d.errorMessage),"undefined"!=typeof d.activityName&&(t.activityName=d.activityName),"undefined"!=typeof d.activityId&&(t.activityId=d.activityId),"undefined"!=typeof d.isDebug&&(t.isDebug=d.isDebug),"undefined"!=typeof d.isCancelled&&(t.isCancelled=d.isCancelled),t},info:d,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXClusteringWarningLoggers&&(p.loggers=e.telemetry.EXClusteringWarningLoggers),p},t.EXClusteringEditClustering=function(t,i,r,o,n,a,s,l,c,u,d,p,v,h){void 0===s&&(s=!1),void 0===l&&(l=void 0),void 0===c&&(c=void 0),void 0===u&&(u=void 0),void 0===d&&(d=void 0),void 0===p&&(p=void 0),void 0===v&&(v=void 0),void 0===h&&(h=void 0);var g={updatedName:t,updatedDescription:i,updatedClusterNames:r,updatedNumberOfClusters:o,newNumberOfClusters:n,parentId:a,isError:s,errorSource:l,errorCode:c,errorMessage:u,activityName:d,activityId:p,isDebug:v,isCancelled:h},f={name:"PBI.EX.Clustering.EditClustering",category:e.TelemetryCategory.CustomerAction,time:Date.now(),id:jsCommon.Utility.generateGuid(),getFormattedInfoObject:function(){var t={updatedName:g.updatedName,updatedDescription:g.updatedDescription,updatedClusterNames:g.updatedClusterNames,updatedNumberOfClusters:g.updatedNumberOfClusters,newNumberOfClusters:g.newNumberOfClusters,parentId:g.parentId,isError:g.isError};return"undefined"!=typeof g.errorSource&&(t.errorSource=e.telemetry.ErrorSource[g.errorSource]),"undefined"!=typeof g.errorCode&&(t.errorCode=g.errorCode),"undefined"!=typeof g.errorMessage&&(t.errorMessage=g.errorMessage),"undefined"!=typeof g.activityName&&(t.activityName=g.activityName),"undefined"!=typeof g.activityId&&(t.activityId=g.activityId),"undefined"!=typeof g.isDebug&&(t.isDebug=g.isDebug),"undefined"!=typeof g.isCancelled&&(t.isCancelled=g.isCancelled),t},info:g,privateFields:[],orgInfoFields:[]};return"undefined"!=typeof e.telemetry.EXClusteringEditClusteringLoggers&&(f.loggers=e.telemetry.EXClusteringEditClusteringLoggers),f}})(t=e.telemetry||(e.telemetry={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=jsCommon.DateExtensions,r=(function(){function e(e,t,i){this.op=e,this.onOperatorChanged(),this.isCalendarShown=!1,this.value=new o(t,i)}return Object.defineProperty(e.prototype,"operator",{get:function(){return this.op},set:function(e){this.op!==e&&(this.op=e,this.onOperatorChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueRequired",{get:function(){return this.valRequired},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){return e.visit(this)},e.empty=function(){return new e(0)},e.equals=function(e,t){return e=e||null,t=t||null,e===t||!e==!t&&(e.operator===t.operator&&o.equals(e.value,t.value))},e.prototype.onOperatorChanged=function(){this.valRequired=t.OperatorHelper.getValueRequired(this.operator),this.valRequired||(this.value=void 0)},e})();t.Condition=r;var o=(function(){function e(e,t){null!=e&&(e instanceof Date&&(this.dateValue=e),this.value=e,this.formatter=t,this.stringValue=this.formatter?this.formatter.format(this.value):this.value.toString()),this.initialTime=this.dateValue,this.dateValue||(this.initialTime=new Date,this.initialTime.setHours(0,0,0,0))}return Object.defineProperty(e.prototype,"isDate",{get:function(){return null!=this.dateValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasValue",{get:function(){return null!=this.dateValue||!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(this.stringValue)},enumerable:!0,configurable:!0}),e.prototype.isValidDate=function(){return this.isDate&&(!_.isString(this.value)||null!==i.parseIsoDate(this.value))},Object.defineProperty(e.prototype,"timePickerValue",{get:function(){return this.dateValue||this.initialTime},set:function(e){this.dateValue=e},enumerable:!0,configurable:!0}),e.equals=function(t,i){return t=t||null,i=i||null,t===i||!t==!i&&(e.compareDateTimeValue(t,i)&&t.stringValue===i.stringValue)},e.compareDateTimeValue=function(e,t){var i=e.dateValue?e.dateValue.valueOf():0,r=t.dateValue?t.dateValue.valueOf():0;return i===r},e})();t.ConditionValue=o;var n=(function(){function i(e){this.field=e,this.conditions=[],this.operators=[],this.logicalOperator=2,this.logicalAndOperator=0,this.logicalOrOperator=1}return i.prototype.toSQExpr=function(e){var i=this.field,r=i.getMetadata(e);if(r){var o=r.type;return t.FilterCardConverter.toSQExpr(i,o,this.conditions,this.logicalOperator)}},i.prototype.getRestatement=function(e){return t.RestatementHelper.fromCondition(this.conditions,this.logicalOperator,e)},i.prototype.areConditionsValid=function(e){var i=this.conditions;if(_.isEmpty(i))return!1;for(var r=0,o=i.length;r<o;r++){var n=i[r];if(null!=n.operator&&0!==n.operator){if(n.value&&n.value.hasValue){if(t.OperatorHelper.getValueRequired(n.operator)&&n.value&&!n.value.hasValue)return!1;if(e&&!this.isConditionValid(e,n))return!1}}else if(r<o-1)return!1}return!0},i.prototype.loadOperators=function(e,i){var r=this.field;if(_.isEmpty(r.validate(e,i))){var o=r.getMetadata(e);this.operators=t.OperatorHelper.getFilterOperators(o.type)}},i.prototype.ensureConditions=function(){var e=this.operators;this.conditions||(this.conditions=[]);var t=this.conditions;for(_.isEmpty(this.conditions)&&!_.isEmpty(e)&&t.push(new r(e[0].value));t.length<2;)this.logicalOperator=0,t.push(r.empty())},i.prototype.isConditionValid=function(i,r){if(!i)return!1;var o=r.value;if(o&&o.isDate&&!o.isValidDate())return!1;var n=this.field,a=e.FilterUtils.getValueType(n,i);return!!a&&t.FilterCardConverter.isConditionValid(n,a,r)},i})();t.AdvFilterCard=n})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=jsCommon.Lazy,o=e.data.SQAndExpr,n=e.data.SQCompareExpr,a=e.data.SQConstantExpr,s=e.data.SQContainsExpr,l=e.data.SQDateSpanExpr,c=e.data.SQExpr,u=e.data.SQExprBuilder,d=e.data.SQNotExpr,p=e.data.SQOrExpr,v=e.data.SQStartsWithExpr,h=jsCommon.StringExtensions,g=/[0-9]*\.?[0-9]+%/;!(function(e){function t(e,t,i){return e.accept(new y(t,i))}function i(e,t,i,r){void 0===r&&(r=0);for(var o,n=new w(e,t,r),a=0,s=i;a<s.length;a++){var l=s[a];null!=l.operator&&0!==l.operator&&(o=l.accept(n))}return o}function r(e,t,i){var r=new w(e,t,(void 0)),o=i.accept(r);return null!=o}e.createAdvFilter=t,e.toSQExpr=i,e.isConditionValid=r})(i=t.FilterCardConverter||(t.FilterCardConverter={}));var f;!(function(i){function r(e,t,i){for(var r,o=new C(t,i),n=0,a=e;n<a.length;n++){var s=a[n];null!=s.operator&&0!==s.operator&&(r=s.accept(o))}return r}function o(t,i,r){var o,n=t.length;if(n>0){for(var a=[],s=0,c=t;s<c.length;s++){var u=c[s];a.push(l(u))}o=e.visuals.valueFormatter.formatListOr(a),o=i?h.format(e.common.localize.get("FilterRestatement_NotEqual"),o):h.format(e.common.localize.get("FilterRestatement_Equal"),o)}return o}function n(e,i,r){for(var n=[],a=0,s=e;a<s.length;a++){var l=s[a];n.push(t.RestatementHelper.getLabelFromScopeId(l,r))}return o(n,i)}function a(t,i){var r=e.data.SQExprConverter.getFirstComparandValue(t);return i?i.format(r):r}function s(t){if(null!=t)return h.format(e.common.localize.get("FilterRestatement_IsDefault"),l(t))}function l(e){return null===e?null:_.isString(e)?e:e.displayName?e.displayName:void 0}i.fromCondition=r,i.fromLabels=o,i.fromDataViewScopeIdentities=n,i.getLabelFromScopeId=a,i.fromDefault=s})(f=t.RestatementHelper||(t.RestatementHelper={}));var m;!(function(t){function i(e){return 11!==e&&12!==e&&0!==e}function o(e){return e.text?a.getValue():e.integer||e.numeric?s.getValue():e.dateTime?n.getValue():void 0}var n=new r(function(){var t=[];return t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan_DT")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual_DT")}),t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan_DT")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual_DT")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),a=new r(function(){var t=[];return t.push({value:5,label:e.common.localize.get("FilterOperator_Contains")}),t.push({value:6,label:e.common.localize.get("FilterOperator_DoesNotContain")}),t.push({value:7,label:e.common.localize.get("FilterOperator_StartsWith")}),t.push({value:8,label:e.common.localize.get("FilterOperator_DoesNotStartWith")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t}),s=new r(function(){var t=[];return t.push({value:1,label:e.common.localize.get("FilterOperator_LessThan")}),t.push({value:2,label:e.common.localize.get("FilterOperator_LessThanOrEqual")}),t.push({value:3,label:e.common.localize.get("FilterOperator_GreaterThan")}),t.push({value:4,label:e.common.localize.get("FilterOperator_GreaterThanOrEqual")}),t.push({value:9,label:e.common.localize.get("FilterOperator_Is")}),t.push({value:10,label:e.common.localize.get("FilterOperator_IsNot")}),t.push({value:11,label:e.common.localize.get("FilterOperator_IsBlank")}),t.push({value:12,label:e.common.localize.get("FilterOperator_IsNotBlank")}),t});t.getValueRequired=i,t.getFilterOperators=o})(m=t.OperatorHelper||(t.OperatorHelper={}));var y=(function(e){function i(t,i){e.call(this),this.context={isNegative:!1,allowNot:!0,logicalOperator:2},this.formatter=t,this.field=i}return __extends(i,e),i.prototype.visitColumnRef=function(e){if(null==this.field||c.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitGroupRef=function(e){if(null==this.field||c.equals(this.field,e))return this.createFilterCard(e)},i.prototype.visitMeasureRef=function(e){return this.createFilterCard(e)},i.prototype.visitAggr=function(e){return this.createFilterCard(e)},i.prototype.visitArithmetic=function(e){return this.createFilterCard(e)},i.prototype.visitHierarchyLevel=function(e){return this.createFilterCard(e)},i.prototype.visitEntity=function(e){return this.createFilterCard(e)},i.prototype.visitAnd=function(e){var t=this.context,i=t.isNegative?1:0;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitOr=function(e){var t=this.context,i=t.isNegative?0:1;if(2===t.logicalOperator)t.logicalOperator=i;else if(t.logicalOperator!==i)return;if(e.left.accept(this)&&e.right.accept(this))return this.filter},i.prototype.visitCompare=function(e){var i=this.context,r=this.getFilterOperator(e,i.isNegative);if(void 0!==r&&0!==r){i.condition=new t.Condition(this.getFilterOperator(e,i.isNegative));var o=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)&&(e.right instanceof a||e.right instanceof l)){var n=this.filter;return n.conditions.push(this.context.condition),n.conditions.length>1&&2===n.logicalOperator&&(n.logicalOperator=0),i.allowNot=o,i.condition=null,n}}},i.prototype.visitNot=function(e){var t=this.context,i=e.arg;if((i instanceof n||t.allowNot&&(i instanceof o||i instanceof p||i instanceof s||i instanceof v||i instanceof d))&&(t.isNegative=!t.isNegative,e.arg.accept(this)))return t.isNegative=!t.isNegative,this.filter},i.prototype.visitConstant=function(e){if(this.context.condition){var i=this.context.condition;return 0!==e.type.primitiveType&&(i.value=new t.ConditionValue(e.value,this.formatter)),this.filter}},i.prototype.visitDateSpan=function(e){if(5===e.unit){var t=this.context,i=t.allowNot;t.allowNot=!1;var r=e.arg.accept(this);return t.allowNot=i,r}},i.prototype.visitContains=function(e){var i=this.context;i.condition=new t.Condition(i.isNegative?6:5);var r=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),i.allowNot=r,o}},i.prototype.visitStartsWith=function(e){var i=this.context;i.condition=new t.Condition(i.isNegative?8:7);var r=i.allowNot;if(i.allowNot=!1,e.left.accept(this)&&e.right.accept(this)){var o=this.filter;return o.conditions.push(this.context.condition),i.allowNot=r,o}},i.prototype.getFilterOperator=function(e,t){switch(e.comparison){case 3:return t?3:1;case 4:return t?4:2;case 1:return t?1:3;case 2:return t?2:4;case 0:return e.right instanceof a&&0===e.right.type.primitiveType?t?12:11:t?10:9}},i.prototype.createFilterCard=function(e){return this.filter||(this.filter=new t.AdvFilterCard(e),this.filter.logicalOperator=this.context.logicalOperator),this.filter},i})(e.data.DefaultSQExprVisitor),w=(function(){function t(e,t,i){this.propertyExpr=e,this.dataType=t,this.logicalOperator=i}return t.prototype.visit=function(e){var t=this.expandExpr(e);return t&&(this.result?0===this.logicalOperator?this.result=u.and(this.result,t):1===this.logicalOperator&&(this.result=u.or(this.result,t)):this.result=t),this.result},t.prototype.expandExpr=function(e){var t,i=11!==e.operator&&12!==e.operator;if(i&&(t=this.getValueExpr(e)),t||!i)switch(e.operator){case 9:return u.compare(0,this.propertyExpr,t);case 10:return u.not(u.compare(0,this.propertyExpr,t));case 11:return u.compare(0,this.propertyExpr,u.nullConstant());case 12:return u.not(u.compare(0,this.propertyExpr,u.nullConstant()));case 5:return u.contains(this.propertyExpr,t);case 6:return u.not(u.contains(this.propertyExpr,t));case 7:return u.startsWith(this.propertyExpr,t);case 8:return u.not(u.startsWith(this.propertyExpr,t));case 3:return u.compare(1,this.propertyExpr,t);case 4:return u.compare(2,this.propertyExpr,t);case 1:return u.compare(3,this.propertyExpr,t);case 2:return u.compare(4,this.propertyExpr,t)}},t.prototype.getValueExpr=function(t){var i=this.dataType;if(t.value){var r=t.value.stringValue;if(i.integer||i.numeric){var o=e.formattingService.parseFloat(r);if(isNaN(o))return;return r.match(g)&&(o/=100),2===i.primitiveType?u.decimal(o):u.double(o)}if(i.text&&r)return u.text(r);if(i.dateTime){var n=t.value.dateValue;if(n)return u.dateSpan(5,u.dateTime(n))}}},t})(),C=(function(){function t(t,i){0===t?this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundAnd"):1===t&&(this.logicalOperatorResourceId=e.common.localize.get("FilterRestatement_CompoundOr")),this.formatter=i}return t.prototype.visit=function(e){var t=this.conditionToString(e);if(t)return _.isEmpty(this.result)?this.result=t:this.result=h.format(this.logicalOperatorResourceId,this.result,t),this.result},t.prototype.conditionToString=function(t){var i=t.value;if(!m.getValueRequired(t.operator)||i&&i.hasValue){var r;switch(i&&(r=this.formatter?this.formatter.format(i.value||i.stringValue):i.stringValue),t.operator){case 9:return h.format(e.common.localize.get("FilterRestatement_Equal"),r);case 10:return h.format(e.common.localize.get("FilterRestatement_NotEqual"),r);case 3:return i.isDate?h.format(e.common.localize.get("FilterRestatement_GreaterThan_DT"),r):h.format(e.common.localize.get("FilterRestatement_GreaterThan"),r);case 4:return i.isDate?h.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual_DT"),r):h.format(e.common.localize.get("FilterRestatement_GreaterThanOrEqual"),r);case 1:return i.isDate?h.format(e.common.localize.get("FilterRestatement_LessThan_DT"),r):h.format(e.common.localize.get("FilterRestatement_LessThan"),r);case 2:return i.isDate?h.format(e.common.localize.get("FilterRestatement_LessThanOrEqual_DT"),r):h.format(e.common.localize.get("FilterRestatement_LessThanOrEqual"),r);case 5:return h.format(e.common.localize.get("FilterRestatement_Contains"),r);case 6:return h.format(e.common.localize.get("FilterRestatement_DoesNotContain"),r);case 7:return h.format(e.common.localize.get("FilterRestatement_StartWith"),r);case 8:return h.format(e.common.localize.get("FilterRestatement_DoesNotStartWith"),r);case 11:return e.common.localize.get("FilterOperator_IsBlank");case 12:return e.common.localize.get("FilterOperator_IsNotBlank");default:return""}}},t})()})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.explore.contracts,o=jsCommon.CssConstants.createClassAndSelector,n=jsCommon.CssConstants,a=e.data.DataViewObjectDefinitions,s=e.data.DataViewObjectEvaluator,l=e.explore.constants.ExploreCanvasConstants,c=e.visualHost.ResourcePackageReferenceResolver;!(function(t){function i(e,i,r,o){var a=(e.outerViewport.width-e.canvasOptions.scrollbarOffset)/e.viewModel.width;i.scrollTop(0).scrollLeft(0);var s=i.find(t.DisplayAreaNameSelector.selector),c=e.viewModel.width*a,u=a<l.DisplayAreaHeightAdditionMinimumScale?a+l.DisplayAreaHeightScaleAddtion:a,d=e.viewModel.height*u+o,p="",v="";if(e.canvasViewStyle=0,d>=e.outerViewport.height?(e.canvasViewStyle|=1,i.css(n.overflowXProperty,n.hiddenValue).css(n.overflowYProperty,n.autoValue)):(e.canvasViewStyle|=2,p=-(c/2)+"px",v=-(d/2)+"px",i.css(n.overflowXProperty,n.hiddenValue).css(n.overflowYProperty,n.hiddenValue)),e.adjustScaleForLayout){var g=e.adjustScaleForLayout({x:a,y:a});if(g.x!==a||g.y!==a){var f=Math.min(g.x,g.y),m=f/a;c*=m,d=(d-o)*m+o,a=f}}r.setCanvasScaleFactor(a),h(e,c,d),s.attr("class",t.DisplayAreaNameSelector.class+" "+y(e)),s.css({marginLeft:p,marginTop:v,width:c+"px",height:d+"px"})}function u(e,i,r,o,a){var s=i.find(t.DisplayAreaNameSelector.selector),l=(e.outerViewport.width-e.canvasOptions.scrollbarOffset)/e.viewModel.width,c=o.getConfig(),u=c.displayOptions.hideTileMenu?e.outerViewport.height:e.outerViewport.height-a,d=u/e.viewModel.height,p=Math.min(l,d);if(e.adjustScaleForLayout){var v=e.adjustScaleForLayout({x:p,y:p});v.x===p&&v.y===p||(p=Math.min(v.x,v.y))}i.scrollTop(0).scrollLeft(0);var g=e.viewModel.width*p,f=e.viewModel.height*p+a;e.canvasViewStyle=0,e.canvasViewStyle|=4,i.css(n.overflowXProperty,n.hiddenValue).css(n.overflowYProperty,n.hiddenValue),r.setCanvasScaleFactor(p),h(e,g,f),s.attr("class",t.DisplayAreaNameSelector.class+" "+y(e)),s.css({marginLeft:-(g/2)+"px",marginTop:-(f/2)+"px",width:g+"px",height:f+"px"})}function d(e,i,r,o){var a=i.find(t.DisplayAreaNameSelector.selector);a.removeAttr(n.styleAttribute),e.canvasViewStyle=8,r.setCanvasScaleFactor(1),h(e,e.outerViewport.width,e.outerViewport.height),i.css(n.overflowXProperty,n.hiddenValue).css(n.overflowYProperty,n.hiddenValue),a.attr("class",t.DisplayAreaNameSelector.class+" "+y(e))}function p(e,i,r,o){var a=i.find(t.DisplayAreaNameSelector.selector),s=i.find(M.selector),c=s&&s.length>0;e.canvasViewStyle=0;var u="",d="",p=e.viewModel.width,v=e.viewModel.height+o,g=c?l.PhoneAuthoringViewportWidth:p,f=c?l.PhoneAuthoringViewportHeight:v;g>e.outerViewport.width?(e.canvasViewStyle|=512,i.css(n.overflowXProperty,n.autoValue)):(e.canvasViewStyle|=256,u=-1*(g/2)+"px",i.css(n.overflowXProperty,n.hiddenValue)),f>e.outerViewport.height?(e.canvasViewStyle|=128,i.css(n.overflowYProperty,n.autoValue)):(e.canvasViewStyle|=64,d=-1*(f/2)+"px",i.css(n.overflowYProperty,n.hiddenValue)),u.length>0&&d.length>0?e.canvasViewStyle|=32:e.canvasViewStyle|=16,a.css({width:g+"px",height:f+"px",top:"",left:"",marginTop:d,marginLeft:u}),r.setCanvasScaleFactor(1),h(e,p,v);var m=y(e);a.attr("class",t.DisplayAreaNameSelector.class+" "+m),c&&s.attr("class",M.class+" "+m)}function v(e,i,r,o){var a=i.find(t.DisplayAreaNameSelector.selector);e.canvasViewStyle=0,e.canvasViewStyle|=512,
e.canvasViewStyle|=128,e.canvasViewStyle|=16,e.viewModel.width>=e.outerViewport.width?i.css(n.overflowXProperty,n.autoValue):i.css(n.overflowXProperty,n.hiddenValue),e.viewModel.height>=e.outerViewport.height?i.css(n.overflowYProperty,n.autoValue):i.css(n.overflowYProperty,n.hiddenValue),r.setCanvasScaleFactor(1);var s=e.viewModel.width,l=e.viewModel.height+o;a.css({width:s+"px",height:l+"px"}),h(e,s,l),a.attr("class",t.DisplayAreaNameSelector.class+" "+y(e))}function h(e,t,i){var r={width:t,height:i};r.width>0&&r.height>0&&(e.forceSyncSizeUpdates?e.size=r:e.$evalAsync((function(){return e.size=r})))}function g(i,o,n,c,u,d,p,v){var h=o.find(t.VisualBackgroundContainerSelector.selector);if(!v.getCurrentLayoutCapabilities().canShowCanvasBackground())return void f(l.getDefaultCanvasBackground(),h,null,"",i.hasPopOut);var g=a.getObjectDefinition(n,"background",null);if(i.background&&g||(i.background=l.getDefaultCanvasBackground()),g){var y=s.run(e.data.createStaticEvalContext(),r.Section.objectDescriptors.background,g.properties);y&&null!==y.color||(i.background.color=l.DefaultCanvasBackgroundColor,i.background.image=null),y&&(i.background.color=e.DataViewObject.getFillColorByPropertyName(y,"color",l.DefaultCanvasBackgroundColor),i.background.transparency=i.hasPopOut?0:e.DataViewObject.getValue(y,"transparency",l.DefaultCanvasBackgroundTransparency),i.background.image=y.image)}var w=i.background.image,C=g?g.properties.image:null,S=C&&e.data.SQExpr.isResourcePackageItem(C.url);S?m(i,h,w,C.url,g,u,d,p):f(i.background,h,w,w?w.url:"",i.hasPopOut)}function f(t,i,r,o,n){if(r&&!_.isEmpty(o))switch(i.css({"background-image":"url("+o+")","background-repeat":"no-repeat",opacity:n?1:(100-t.transparency)/100,"background-color":e.common.utils.ColorUtility.hexToRGBString(t.color)}),r.scaling){case e.visuals.imageScalingType.normal:i.css({"background-position":"50% 50%","background-size":""});break;case e.visuals.imageScalingType.fit:i.css({"background-size":"100% 100%","background-position":""});break;case e.visuals.imageScalingType.fill:i.css({"background-size":"100%","background-position":"50% 50%"})}else i.css({"background-image":"","background-size":"","background-position":"",opacity:1,"background-color":e.common.utils.ColorUtility.hexToRGBString(t.color,(100-t.transparency)/100)})}function m(t,i,r,o,n,a,s,l){var u=s.getCurrentExploration();if(u){var d=t.viewModel.contract;c.loadAndResolveFromSQExpr(o,u.resourcePackages,a,l).then((function(a){var s=n.properties.image;d===t.viewModel.contract&&s&&e.data.SQExpr.equals(s.url,o)&&f(t.background,i,r,a.value||"",t.hasPopOut)}))}}function y(e){var t="";return e.useResponsiveLayout&&(t+=" responsive"),e.disableAnimations&&(t+=" disableAnimations"),8===(8&e.canvasViewStyle)&&(t+=" fitToScreen"),4===(4&e.canvasViewStyle)&&(t+=" fitToPage"),1===(1&e.canvasViewStyle)&&(t+=" fitToWidthOrigin"),2===(2&e.canvasViewStyle)&&(t+=" fitToWidthCentered"),256===(256&e.canvasViewStyle)&&(t+=" actualSizeAlignCenter"),512===(512&e.canvasViewStyle)&&(t+=" actualSizeAlignLeft"),64===(64&e.canvasViewStyle)&&(t+=" actualSizeAlignMiddle"),128===(128&e.canvasViewStyle)&&(t+=" actualSizeAlignTop"),32===(32&e.canvasViewStyle)&&(t+=" actualSizeCentered"),16===(16&e.canvasViewStyle)&&(t+=" actualSizeOrigin"),t.trim()}function w(e){return e&&e.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()?0:l.AutoLayoutVisualVCHeader}function C(e,t,r){if(e.viewModel&&e.viewModel.contract){var o=r.canvasScale.getDisplayOption(),n=w(r.formFactor);switch(o){case 2:i(e,t,r.canvasScale,n);break;case 1:u(e,t,r.canvasScale,r.viewModeState,n);break;case 3:p(e,t,r.canvasScale,n);break;case 4:v(e,t,r.canvasScale,n);break;case 0:d(e,t,r.canvasScale,n);break;default:d(e,t,r.canvasScale,n)}}}function S(e,t){E=e.css(n.overflowXProperty),F=e.css(n.overflowYProperty),e.css(n.overflowXProperty,t),e.css(n.overflowYProperty,t)}function b(e){e.css(n.overflowXProperty,E),e.css(n.overflowYProperty,F)}function x(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function D(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}t.DisplayAreaNameSelector=o("displayArea"),t.VisualContainerHostSelector=o("visualContainerHost"),t.VisualBackgroundContainerSelector=o("visualBackgroundContainer"),t.DefaultVisualPosition={x:100,y:100,width:300,height:300};var M=o("canvasBackdrop"),E="",F="";t.fitToWidth=i,t.fitToPage=u,t.fitToScreen=d,t.displayInActualSize=p,t.displayInActualSizeTopLeft=v,t.updateCanvasSize=h,t.updateAndApplyCanvasBackground=g,t.convertDisplayOptionToStyle=y,t.getAutoLayoutVisualVCHeader=w,t.applyFitOption=C,t.storeOverflowValuesAndChange=S,t.restoreOverflowValues=b,t.visualPositionToRect=x,t.rectToVisualPosition=D})(i=t.CanvasDisplayUtility||(t.CanvasDisplayUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions;!(function(r){function n(e,t){return _.filter(e.visualContainers,(function(e){return e.isSelected}))}function a(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.contract===t)return o}}function s(e,t){for(var i=[],r=t.getSelectedElements(),o=0,n=r;o<n.length;o++){var a=n[o];a.visualContainer&&i.push(e.serializeVisualContainer(a.visualContainer))}return i}function l(e,t,i){e=Math.max(0,e-t/2);var r=e+t-i;return r>0&&(e-=r),e}function c(e,i,r,n,a,s,l){if(e&&e.visuals){for(var c=e.visuals,u=[],d=0,v=c.length;d<v;++d){var h=n.deserializeVisualContainer(c[d],!0),g=l.getCurrentLayout(),f=h.layouts.withId(g);h.layouts=o.extendWithId([f]);for(var m=f.position;p(m,i);){m.x+=10,m.y+=10;var y=0;if(m.x+m.width>i.width&&(m.x=Math.max(i.width-m.width,0),y++),m.y+m.height>i.height&&(m.y=Math.max(i.height-m.height,0),y++),2===y)break}i.contract.visualContainers.push(h);var w=t.viewModels.ViewModelFactory.convertVisualContainer(r,i.contract,h,g);w&&(i.visualContainers.push(w),u.push(h))}t.services.selectionUtils.selectVisualContainers(u,a);for(var C=0,S=u;C<S.length;C++){var h=S[C];s.applyFilterOutput(h)}}}function u(t,r,o,n,a){if(t.expr)n.addVisualContainer({expr:t.expr,visualType:t.visualType,targetRole:t.targetRole,dataSources:o,allowAggregate:!0},r).then((function(r){a.logEvent(e.telemetry.EXCreateVisual,d(t.telemetrySource),i.VisualContainerUtils.getVisualType(r))}));else{var s=n.addEmptyVisualContainer(r,t.visualType);a.logEvent(e.telemetry.EXCreateVisual,d(t.telemetrySource),i.VisualContainerUtils.getVisualType(s))}}function d(t){switch(t){case 0:return e.telemetry.HowVisualWasCreated.CheckboxTickedInFieldList;case 3:return e.telemetry.HowVisualWasCreated.DraggedToFieldWell;case 1:return e.telemetry.HowVisualWasCreated.DraggedToCanvas;case 2:return e.telemetry.HowVisualWasCreated.VisualTypeIconClicked;case 4:return e.telemetry.HowVisualWasCreated.InsertVisualButton}}function p(e,t){return _.any(t.visualContainers,(function(t){return t.position.x===e.x&&t.position.y===e.y}))}function v(e,i,r){var o=e.visualContainers.slice().sort(g),n=t.services.selectionUtils.getSelectedVisual(i);if(n){var s=a(e.visualContainers,n);if(s){var l=_.indexOf(o,s);switch(r){case 1:o.push(o.splice(l,1)[0]);break;case 2:o.unshift(o.splice(l,1)[0]);break;case 3:l<o.length-1&&jsCommon.ArrayExtensions.swap(o,l+1,l);break;case 4:l>0&&jsCommon.ArrayExtensions.swap(o,l-1,l)}}}for(var c=0,u=o.length;c<u;c++){var d=o[c];d.position.z=c,d.updateViewState()}}function h(e,i){var r=t.services.selectionUtils.getSelectedVisual(i);if(r)for(var o=_.max(e,(function(e){return e.position.z})),n=o instanceof t.viewModels.VisualContainer?(o.position.z||0)+1:1,s=a(e,r),l=0,c=e;l<c.length;l++){var u=c[l];u.zIndexOverride=u===s?n:null,u.updateViewState()}else for(var d=0,p=e;d<p.length;d++){var u=p[d];u.zIndexOverride=null,u.updateViewState()}}function g(e,t){var i=e.position.z||0,r=t.position.z||0;return i<r?-1:i>r?1:0}function f(e,t,i){var r={x:e.x*t.x,y:e.y*t.y,z:e.z,width:e.width*t.x,height:e.height*t.y,angle:e.angle};if(i===!0){var o=Math.round(r.x),n=Math.round(r.y),a=Math.round(r.x+r.width),s=Math.round(r.y+r.height),l={x:o,y:n,z:r.z,width:a-o,height:s-n,angle:e.angle};r=l}return r}function m(e,t){return{x:e.x/t.x,y:e.y/t.y,z:e.z,width:e.width/t.x,height:e.height/t.y,angle:e.angle}}function y(e,t){return{left:e.left*t.x,top:e.top*t.y,width:e.width*t.x,height:e.height*t.y}}function w(e,t){return{left:e.left/t.x,top:e.top/t.y,width:e.width/t.x,height:e.height/t.y}}function C(e){if(!e||_.isEmpty(e.visualContainers))return 0;var t=_.chain(e.visualContainers).map((function(e){return e.position&&e.position.z||0})).max().value();return t+1}r.getSelectedCanvasVisualContainers=n,r.findVisualContainerViewModel=a,r.serializeSelection=s,r.checkBoundaryForCharts=l,r.duplicateVisuals=c,r.addVisualContainerToCanvas=u,r.rearrangeVisualsOrder=v,r.moveSelectedItemToFront=h,r.convertToScaledPosition=f,r.convertFromScaledPosition=m,r.convertToScaledRect=y,r.convertFromScaledRect=w,r.getZIndexForNewVisual=C})(r=i.CanvasVisualsUtility||(i.CanvasVisualsUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.DataViewObjectDefinitions,o=e.visuals.GradientUtils,n=e.data.SQExprBuilder;!(function(t){function i(e,t,i){var r=u(e,t,i);if(r&&r.solid&&r.solid.color){var n=r.solid.color;if(n&&n.rule){var a=n.rule;return o.getGradientSettings(a)}}}function a(e,t,i){var r=t&&u(e,t,i);return void 0!==r}function s(t,i,r){var o,a={color:n.text(i.minColor)},s=i.minValue;null!=s&&(o=d(s,r));var l,c;if(i.diverging){l={color:n.text(i.midColor)};var u=i.midValue;null!=u&&(c=d(u,r))}var p,v={color:n.text(i.maxColor)},h=i.maxValue;null!=h&&(p=d(h,r));var g,f=i.nullStrategy,m=i.nullColor,y={};return g=i.diverging?y.linearGradient3={min:a,mid:l,max:v}:y.linearGradient2={min:a,max:v},o&&(g.min.value=o),c&&(g.mid.value=c),p&&(g.max.value=p),f&&(g.nullColoringStrategy={strategy:n.text(f)},f===e.NullStrategy.specificColor&&m&&(g.nullColoringStrategy.color=n.text(m))),{solid:{color:n.fillRule(t,y)}}}function l(e,t,i){var r=e.query.defn.selectNameOf(i);return _.find(t,(function(e){return e.selector.metadata===r}))}function c(e){for(var t in e.objects){var i=e.objects[t],r=_.first(i.formattingProperties);if(_.isEmpty(r))return;return{objectName:t,propertyName:r}}}function u(e,t,i){if(e&&e.objects){var o=t.selector,n=c(t);if(n)return r.getValue(e.objects,n,o)}}function d(e,t){if(t.integer){var i=Math.round(e);return n.integer(i)}return 2===t.primitiveType?n.decimal(e):n.double(e)}t.getGradientSettings=i,t.isConditionalFormattingAppliedOnExpr=a,t.createFillDefinition=s,t.findObjectRepetition=l,t.getFirstFormatPropertyPropertyId=c})(i=t.ConditionalFormattingUtil||(t.ConditionalFormattingUtil={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Field="field",e.Sections="sections",e.VisualContainerThumbnail="visual-container-thumbnail"})(t=e.DragDropTypes||(e.DragDropTypes={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){if(!e)return!1;var t=e.displayableErrorInfo;return!_.isEmpty(t)&&(!_.isEmpty(t[0].errorInfoKey)&&!_.isEmpty(t[0].errorInfoValue))}function i(e){return e in r?r[e]:0}var r={BlockedCustomVisual:1};e.hasAdditionalErrorInfo=t,e.getErrorOverlayType=i})(t=e.ErrorDetailsUtility||(e.ErrorDetailsUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.handled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent);var i=t.handled;return void 0!==i&&i===!0}},e.markAsHandled=function(e){if(e){var t=e;e.originalEvent&&(t=e.originalEvent),t.handled=!0}},e})();e.EventBubblingUtility=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.explore.services.FormatPainter;!(function(e){function i(e,i,o,n,a,s,l,c){return{deleteSelection:function(){e.exploration&&e.exploration.exploreCanvas&&n.deleteSelectedVisuals(e.exploration.exploreCanvas)},deserializeAndDuplicateData:function(r){e.exploration&&e.exploration.exploreCanvas&&t.CanvasVisualsUtility.duplicateVisuals(r,e.exploration.exploreCanvas,e.exploration.contract,i,o,s,l)},serializeSelection:function(){return t.CanvasVisualsUtility.serializeSelection(i,o)},deserializeVisualContainer:function(e){return i.deserializeVisualContainer(e,!0)},copyVisualFormat:function(){return r.copyFormatVisualConfig(o,a)},pasteVisualFormat:function(e,t){var i=r.pasteFormatVisualConfig(o,a,c,t);i&&n.raiseVisualContainerChanged(i)}}}e.createClipboardHandler=i})(i=t.ExploreClipboardHandlerUtility||(t.ExploreClipboardHandlerUtility={}))})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=(function(){function t(e,t){this._scope=e,this._eventBridge=t}return t.prototype.addColumn=function(e){this.raiseFieldListActionEvent(10,e)},t.prototype.addMeasure=function(e){this.raiseFieldListActionEvent(7,e)},t.prototype.addHierarchy=function(e){this.raiseFieldListActionEvent(8,e)},t.prototype.addHierarchyLevel=function(e,t,i){var r={action:9,fieldExpr:e,newHierarchyLevel:{hierarchy:t,index:i}};this.raiseEvent(r)},t.prototype.setGroups=function(e){this.raiseEvent({action:11,property:e})},t.prototype.editGroups=function(e){this.raiseEvent({action:12,property:e})},t.prototype.editClustering=function(e){this.raiseEvent({action:13,fieldExpr:e})},t.prototype.collapseAll=function(){this.raiseFieldListActionEvent(14)},t.prototype.delete=function(e){this.raiseFieldListActionEvent(4,e)},t.prototype.moveUp=function(e){this.raiseFieldListActionEvent(5,e)},t.prototype.moveDown=function(e){this.raiseFieldListActionEvent(6,e)},t.prototype.expandAll=function(){this.raiseFieldListActionEvent(15)},t.prototype.select=function(e){this.raiseFieldListActionEvent(3,e)},t.prototype.toggleHidden=function(e){this.raiseFieldListActionEvent(0,e)},t.prototype.unHideAll=function(){this.raiseFieldListActionEvent(2)},t.prototype.viewHidden=function(){this.raiseFieldListActionEvent(1)},t.prototype.raiseFieldListActionEvent=function(e,t){var i={action:e,fieldExpr:t};this.raiseEvent(i)},t.prototype.raiseEvent=function(t){this._eventBridge.publishBubbling(this._scope,e.viewModels.FieldListEvents.fieldListAction,t)},t})();t.FieldListActionEventPublisher=i})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){switch(e){case 1:return new a;case 2:return new s;default:return new n}}var o=e.data.SQExprBuilder;i.createFieldListExprGenerator=r;var n=(function(){function e(){}return e.prototype.fieldExpr=function(e){if(void 0!==e.kind){if(0===e.kind){if(t.utils.GroupUtils.isGroupOrClusteringColumn(e.contract)){var i=o.entity(e.entity.schemaName,e.entity.name),r=t.utils.GroupUtils.getGroupedColumnsFromMetadata(e.contract.column.groupingMetadata,i);return o.fieldExpr({groupingColumn:{schema:e.entity.schemaName,entity:e.entity.name,name:e.name,groupedColumns:r}})}return o.fieldExpr({column:{schema:e.entity.schemaName,entity:e.entity.name,name:e.name}})}if(1===e.kind)return o.fieldExpr({measure:{schema:e.entity.schemaName,entity:e.entity.name,name:e.name}})}},e})(),a=(function(){function e(){}return e.prototype.fieldExpr=function(e){return o.fieldExpr({hierarchy:{name:e.name,schema:e.entity.schemaName,entity:e.entity.name}})},e})(),s=(function(){function e(){}return e.prototype.fieldExpr=function(e){return o.fieldExpr({hierarchyLevel:{schema:e.entity.schemaName,entity:e.entity.name,name:e.parent.name,level:e.name}})},e})()})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(){}return t.getDefaultVisualPlugin=function(){return e.visuals.plugins.table},t})();t.FieldWellUtility=i})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions,n=t.viewModels.FilterCardConverter,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprUtils,u=e.data.TopNFilterPattern;!(function(e){function i(e,t){if(e){var i=e.from(),n=e.conditions();if(!_.isEmpty(n)){for(var a,s=new p,c=[],v=0,h=n;v<h.length;v++){var g=h[v],f=u.extractParametersFromCondition(e.from(),g);if(f)o(c,f.fieldBeingFiltered,i,g,t);else{var m=g.accept(s);if(m)a=a?d.merge(a,m):m;else{var y=r(g);if(!y)return;o(c,y,i,g,t)}}}if(a)for(var w=0,C=a;w<C.length;w++){var S=C[w],b=_.map(S.values,(function(e){return[e]})),x=l.inValues([S.fieldExpr],b),D=S.isNot?l.not(x):x;o(c,S.fieldExpr,i,D,t)}return c}}}function r(e){var t=n.createAdvFilter(e);if(t)return t.field}function o(e,i,r,o,n){e.push({expression:i,filter:a.fromSQFromAndSQExpr(r,o),name:null,type:t.FilterUtils.getDefaultFilterType(i,n),howCreated:0,expanded:!1})}e.fromSemanticFilter=i})(r=i.FilterContainerBuilder||(i.FilterContainerBuilder={}));var d;!(function(e){function t(e,t){for(var i=[],r=function(r,o){var n=_.map(e.values,(function(e){return e[r]}));i.push({fieldExpr:e.args[r],isNot:t,values:c.concatUnique([],n)})},o=0,n=e.args.length;o<n;o++)r(o,n);return i}function i(e,t){for(var i,r=o.copy(e),n=0,a=t;n<a.length;n++){i=a[n];var l=_.findIndex(r,(function(e){return s.equals(e.fieldExpr,i.fieldExpr)}));if(l!==-1){var u=r[l];u.values=c.concatUnique(u.values,i.values)}else r.push(i)}return r}e.fromInExpr=t,e.merge=i})(d||(d={}));var p=(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.visitIn=function(e){return d.fromInExpr(e)},t.prototype.visitNot=function(t){return t&&t.arg&&10===t.arg.kind?d.fromInExpr(t.arg,!0):e.prototype.visitNot.call(this,t,void 0)},t.prototype.visitAnd=function(e){var t=e.left.accept(this),i=e.right.accept(this);if(t&&i)return d.merge(t,i)},t})(e.data.DefaultSQExprVisitor)})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t=$(document.activeElement);return t.is(e)||t.closest(e).length>0}e.isFocusInTree=t})(t=e.FocusUtility||(e.FocusUtility={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.container=e,this.context={pendingGeocodingCount:0}}return e.prototype.newQuery=function(){this.context={pendingGeocodingCount:0}},e.prototype.hasPendingGeocoding=function(){return this.context.pendingGeocodingCount>0},e.prototype.wrapGeocoder=function(e){return{geocode:this.wrapAsyncGeocoderMethod(e,e.geocode),geocodeBoundary:this.wrapAsyncGeocoderMethod(e,e.geocodeBoundary),geocodePoint:this.wrapAsyncGeocoderMethod(e,e.geocodePoint),tryGeocodeImmediate:function(t,i){return e.tryGeocodeImmediate(t,i)},tryGeocodeBoundaryImmediate:function(t,i,r,o,n){return e.tryGeocodeBoundaryImmediate(t,i,r,o,n)}}},e.prototype.wrapAsyncGeocoderMethod=function(e,t){var i=this;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o-0]=arguments[o];var n=i.context,a=t.apply(e,r);return 1===++n.pendingGeocodingCount&&i.container.onStartGeocoding(),a.then((function(){n===i.context&&0===--n.pendingGeocodingCount&&i.container.onStopGeocoding()}),(function(){n===i.context&&0===--n.pendingGeocodingCount&&i.container.onStopGeocoding()})),a}},e})();e.QueryGeocodingTracker=t})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return o(e,"themeName")}function i(e,t,i){return e?i.get(e):t.reject()}function r(e,t){Object.defineProperty(e,"dataSources",{get:function(){return t.get()},set:function(e){return t.set(e)}})}function o(e,t){for(var i,r=e;r&&!(i=r[t]);)r=r.$parent;return i}e.findThemeName=t,e.getSchemaPromise=i,e.defineDataSourcesOnScopeLegacy=r})(t=e.ScopeUtils||(e.ScopeUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,u,d,p,v,h,g,f){return new L(e,t,i,r,o,n,a,s,l,c,u,d,p,v,h,g,f)}function o(e,t,i){var r=e.getMetadata(t);if(r.type.geography)return S.name;var o=E.asFieldPattern(e);if(i&&o){var n=o.column||o.groupingColumn,s=n&&n.name,l=o.hierarchyLevel&&o.hierarchyLevel||o.columnHierarchyLevelVariation&&o.columnHierarchyLevelVariation.level;if(l){var c=l.level;if(i.isGeographic(c))return S.name;var u=P.getConceptualHierarchyLevel(t,l.schema,l.entity,l.name,c);s=u&&u.column&&u.column.name}if(s&&i.isGeographic(s))return S.name}return a(e,r,t)?p.name:I.name}function n(e,t){var i=e.getMetadata(t);if(a(e,i,t))return 2}function a(e,t,i){return 1===t.kind||t.type.numeric&&!V.discourageAggregation(e,i)}function s(t){switch(t.kind){case 0:return e.telemetry.FieldKind.Entity;case 2:return e.telemetry.FieldKind.ColumnRef;case 3:return e.telemetry.FieldKind.MeasureRef;case 4:return e.telemetry.FieldKind.Aggregation;case 5:return e.telemetry.FieldKind.PropertyVariationSource;case 6:return e.telemetry.FieldKind.Hierarchy;case 7:return e.telemetry.FieldKind.HierarchyLevel;default:return e.telemetry.FieldKind.Other}}function l(t){switch(t){case w.Advanced:return e.telemetry.FilterType.Advanced;case w.Categorical:return e.telemetry.FilterType.Categorical;case w.Passthrough:return e.telemetry.FilterType.Passthrough;case w.Range:return e.telemetry.FilterType.Range;case w.Visual:return e.telemetry.FilterType.Visual}}function c(t){switch(t){case 2:return e.telemetry.FilterScopeType.Exploration;case 1:return e.telemetry.FilterScopeType.Section;case 0:return e.telemetry.FilterScopeType.Visual}}var u=jsCommon.ArrayExtensions,d=e.visuals.plugins.basicShape,p=e.visuals.plugins.clusteredColumnChart,v=e.explore.constants,h=e.data.DataViewObjectDefinitions,g=e.data.DataViewObjectDescriptors,f=e.data.DataViewRoleWildcard,m=e.explore.util.DrillUtils,y=t.services.events,w=t.contracts.FilterType,C=e.explore.util.HierarchyUtils,S=e.visuals.plugins.map,b=t.services.selectionUtils,x=e.data.SemanticFilter,D=e.data.SQExpr,M=e.data.SQExprBuilder,E=e.data.SQExprConverter,F=e.data.SQExprHierarchyToHierarchyLevelConverter,V=e.data.SQExprUtils,P=e.data.SQHierarchyExprUtils,I=e.visuals.plugins.table,T=e.explore.contracts.VisualContainer,A=e.explore.util.VisualContainerUtils,k=t.contracts.VisualQuery,N=t.services.isValueTypeDescriptorLatLong;i.createVisualAuthoringOperations=r;var L=(function(){function r(e,i,r,o,n,a,s,l,c,u,d,p,v,h,g,f,m){this.visualPluginService=e,this.displayNameService=i,this.telemetry=r,this.explorationNavigationService=o,this.selectionService=n,this.geotaggingAnalyzerService=a,this.explorationSerializer=s,this.eventBridge=l,this.featureSwitches=c,this.sortService=u,this.visualRelationshipService=d,this.drill=p,this.filterGenerator=v,this.aggrOps=h,this.resourceRegistration=g,this.formFactorProvider=f,this.localizationService=m,this.core=t.services.createVisualAuthoringCore(e,a,h,c)}return r.prototype.addFieldToVisual=function(t,i,r,o){if(!r)return!1;var n=r.config.singleVisual,a=n.query,l=this.visualPluginService.capabilities(n.visualType),c=this.addHierarchyLevelToExistingHierarchiesInVisual(t,l,r.config,i)||this.addExpressionToVisualWithoutAggregation(t,r,l,i)||this.addExpressionToVisualForcingAggregation(t,r,l,i)||this.addExpressionToVisual(t,r,l,i);return c?(this.ensureValidDrillMode(r),this.ensureDefaultFilterAndRaiseEvent(t,r,!1),void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,A.getVisualType(r),s(i),A.hasGroupByItemsInQuery(r),!0),!0):(r.config.singleVisual.query=a,void 0!==o&&this.telemetry.logEvent(e.telemetry.EXAddField,o,A.getVisualType(r),s(i),A.hasGroupByItemsInQuery(r),!1),!1)},r.prototype.addFieldInRole=function(t,i,r,o,n){var a=this.getVisualDataRole(o,r);if(!a)return!1;var l;this.shouldPreferGroupToAggregate(t,i,o,a)||(i=this.createExprWithAggregate(i,t,!0,a),l=!0);var c=this.canHierarchyLevelJoinExistingGroup(t,o.config.singleVisual.query,r,i,n),u=this.getTargetRoleAndExpressionsForAdd(t,o,i,r),d=l||c?i:u&&u.expressions,p={expr:d,schema:t,targetRole:r,targetIndex:n};return this.core.add(p,o.config)?(this.ensureValidDrillMode(o),this.ensureDefaultFilterAndRaiseEvent(t,o,!1),this.telemetry.logEvent(e.telemetry.EXAddField,e.telemetry.HowFieldWasAddedToVisual.DraggedToFieldWell,A.getVisualType(o),s(i),A.hasGroupByItemsInQuery(o),!0),!0):(this.telemetry.logEvent(e.telemetry.EXAddField,e.telemetry.HowFieldWasAddedToVisual.DraggedToFieldWell,A.getVisualType(o),s(i),A.hasGroupByItemsInQuery(o),!1),!1)},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=(t.config.singleVisual.query.tryGetExprs(i)||[]).slice(r,r+o);if(_.isEmpty(n))return!1;var a=n[0];if(D.isHierarchyLevel(a)){var s=a.arg,l=P.expandExpr(e,s);if(_.isArray(l)){var c=l.length;if(o<c){for(var u=t.config.singleVisual.query,d=!1,p=0;p<c;p++)if(!D.equals(u.tryGetExpr(i,r+p),l[p])){if(!this.core.add({expr:l[p],schema:e,targetRole:i,targetIndex:r+p},t.config))break;d=!0}return d&&this.raiseVisualContainerChanged(t),d}}}return!1},r.prototype.removeField=function(e,t){var i=b.getSelectedVisuals(this.selectionService),r=P.expandExpr(t,e,!0);if(_.isArray(r)){var o=!1;return o=this.removeFieldImpl(r,i),o=this.removeFieldImpl(e,i)||o}return this.removeFieldImpl(e,i)},r.prototype.removeProjection=function(e){var t=b.getSelectedVisual(this.selectionService);return!!t&&this.invokeRemoveOnSelectedVisuals(e,[t])},r.prototype.removeInvalidExpressions=function(e,t){var i=t.config.singleVisual;if(!i||!i.query)return!1;for(var r=[],o=0,n=i.query.defn.select();o<n.length;o++){var a=n[o],s=a.expr;_.isEmpty(s.validate(e,this.aggrOps))||r.push(s)}for(var l=0,c=r;l<c.length;l++){var u=c[l];this.removeFiltersWithExpr(u,t)}return this.removeFieldImpl(r,[t]),!0},r.prototype.moveProjection=function(e,t,i,r,o,n){var a=b.getSelectedVisual(this.selectionService);if(!a)return!1;var s;if(t!==i){var l=this.getVisualDataRole(a,i),c=C.getHierarchyReplacementExpressions(a.config,t,r,n,l);if(_.isEmpty(c))return!1;s=c}var u={sourceRole:t,targetRole:i,sourceIndex:r,targetIndex:o,sourceCount:n,replacementExpressions:s,schema:e,allowPartialReplace:!0},d=a.config.singleVisual.query,p=m.getDrillFilterRemovalInfoList(d,u,1);return!!this.core.replace(u,a.config)&&(this.ensureValidDrillState(a,p),this.raiseVisualContainerChanged(a),!0)},r.prototype.drillDownLevel=function(t,i,r){if(i){var o=A.getVisualType(i),n=this.telemetry.startEvent(e.telemetry.EXInteractionExpand,o,2===r),a=i.config.singleVisual,s=this.visualPluginService.capabilities(a.visualType),l=m.getDrillableRoles(s);if(!t&&1===l.length){var c=this.core.changeActiveProjection(l[0],a,r);if(c)return this.raiseVisualContainerChanged(i),void n.resolve()}n.reject()}},r.prototype.replaceProjection=function(e,t,i,r,o){var n=b.getSelectedVisual(this.selectionService);if(!n)return!1;var a={sourceRole:i,targetRole:i,sourceIndex:r,targetIndex:r,sourceCount:1,replacementExpressions:[t],schema:e};return!!this.core.replace(a,n.config)&&(this.ensureValidDrillMode(o),this.resetSearchProperties(o),this.ensureDefaultFilterAndRaiseEvent(e,o,!1),!0)},r.prototype.drillDown=function(t,i,o){var n=A.getVisualType(o),a=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,n,!0);this.filterGenerator.clearCrossHighlight(this.explorationNavigationService.getCurrentSection());var s=o.config.singleVisual,l=s&&s.getCurrentVisual&&s.getCurrentVisual();if(l&&l.onClearSelection&&l.onClearSelection(),_.isEmpty(i)||_.isEmpty(i[0].dataMap))return!1;o.filters||(o.filters=[]);for(var c=i[0].dataMap,u=s.query,d=this.visualPluginService.capabilities(s.visualType),p=m.getDrillableRoles(d),v=0,h=p;v<h.length;v++){var g=h[v],f=u.projections[g].activeProjectionRefs;for(var y in c)if(_.contains(f,y)){var w=u.currentDrillMode(g)||2,C=this.core.changeActiveProjection(g,s,w),S=u.projections[g],b=S.activeProjectionRefs;return C&&_.isEqual(C,b)?(this.core.addDrillFilter(t,o.filters,u,f,r.chooseRepetitionSelectorForDrill(c[y])),this.raiseVisualContainerChanged(o),a.resolve(),!0):(a.reject(),!1)}}return a.reject(),!1},r.chooseRepetitionSelectorForDrill=function(e){if(e=u.ensureArray(e),1===e.length)return e[0];for(var t,i=0,r=e;i<r.length;i++){var o=r[i];t||(t=o),o.key.length>t.key.length&&(t=o)}return t},r.prototype.drillUp=function(t,i){if(i){var r=A.getVisualType(i),o=this.telemetry.startEvent(e.telemetry.EXInteractionDrill,r,!1),n=i.config.singleVisual,a=n.query,s=this.visualPluginService.capabilities(i.config.singleVisual.visualType),l=m.getDrillableRoles(s);if(!t&&1===l.length){var c=this.core.changeActiveProjection(l[0],n,1);if(!_.isEmpty(c)){var u=_.last(c),d=a.defn.select().withName(u).expr;return this.core.removeDrillFilter(i.filters,d,!0),this.raiseVisualContainerChanged(i),void o.resolve()}}o.reject()}},r.prototype.drillToDetails=function(t,i,r,o){var n=T.clone(o,this.explorationSerializer);this.addDrillToDetailsFilters(t,n,r);var a={config:{singleVisual:n.config.singleVisual},layouts:o.layouts,filters:n.filters};if(a.config.singleVisual.visualType!==e.visuals.plugins.table.name){var l=this.convert(t,a,e.visuals.plugins.table.name);if(!l)return}var c=a.config.singleVisual.query;this.handleAggregatesAndMeasuresForDetailTable(t,a);var u=i.getTargetEntity();this.addDetailTableColumns(t,u,a),c.defn=c.defn.addGroupBy(u);var d={expr:M.removeAggregate(i),direction:2};this.sortService.addSort(c,[d]);var p=A.getVisualType(o);return this.telemetry.logEvent(e.telemetry.EXDrillToDetails,p,s(i)),a},r.prototype.handleAggregatesAndMeasuresForDetailTable=function(e,t){for(var i=t.config.singleVisual.query,r=i.defn.select(),o=0,n=r;o<n.length;o++){var a=n[o],s=a.expr;if(V.isMeasure(s)){var l=i.getRoleNameForExpr(s),c=u.indexWithName(i.defn.select(),a.name);i.removeAggregate(l,c,e)}D.isMeasure(s)&&i.removeExpr(s,!1)}},r.prototype.addDetailTableColumns=function(e,t,i){for(var r=i.config.singleVisual.query,o=V.getConceptualEntity(t,e),n=r.defn.select(),a=0,s=n;a<s.length;a++){var l=s[a],c=l.expr,u=c.getTargetEntity();if(!_.isEqual(t,u)){var d=V.isRelatedOneToOne(e,t,u);if(!d){var p=V.isRelatedToMany(e,u,t);p||r.removeExpr(c,!1)}}}for(var v=o.properties,h=0,g=v;h<g.length;h++){var f=g[h];if(!f.hidden&&1!==f.kind&&!f.type.integer&&!f.type.numeric&&(!f.type.dateTime||!f.column||_.isEmpty(f.column.variations))){var m=M.columnRef(t,f.name),y=r.defn.selectNameOf(m);y||this.addFieldToVisual(e,m,i)}}},r.prototype.setAggregate=function(e,t,i,r,o){var n={role:t,index:i,newAggregate:r,schema:e};return!!this.core.setAggregate(n,o.config)&&(this.raiseVisualContainerChanged(o),!0)},r.prototype.removeAggregate=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removeAggregate(o,r.config)&&(this.raiseVisualContainerChanged(r),!0)},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.setPercentOfGrandTotal(o,r.config)&&(this.ensureValidDrillMode(r),this.raiseVisualContainerChanged(r),!0)},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o={role:t,index:i,schema:e};return!!this.core.removePercentOfGrandTotal(o,r.config)&&(this.raiseVisualContainerChanged(r),!0)},r.prototype.setVariation=function(e,t,i,r,o,n){if(n=n||1,o<0)return!1;for(var a=[],s=0;s<n;s++)if(a[s]=t.config.singleVisual.query.tryGetExpr(r,o+s),!a[s])return!1;var l=[i];if(D.isHierarchy(i)&&(l=F.convert(i,e),!l))return!1;var c=this.getVisualDataRole(t,r),u=C.getHierarchyReplacementExpressions(t.config,r,o,n,c,l);if(_.isEmpty(u))return!1;var d=u,p={sourceRole:r,targetRole:r,sourceIndex:o,targetIndex:o,sourceCount:a.length,replacementExpressions:d,schema:e,allowPartialReplace:!0},v=this.core.replace(p,t.config);return v&&this.raiseVisualContainerChanged(t),v},r.prototype.toggleShowAll=function(e,t){
t&&(this.core.toggleShowAll(e,t.config),this.raiseVisualContainerChanged(t))},r.prototype.createVisualContainerConfig=function(e,t){return this.createVisualContainerConfigCore(t,e)},r.prototype.addDrillToDetailsFilters=function(e,t,i){if(!_.isEmpty(i)&&i[0]&&!_.isEmpty(i[0].dataMap)){var o=A.getVisualQuery(t);if(o){var n=[];if(o.projections)for(var a in o.projections)_.isEmpty(o.projections[a].activeProjectionRefs)||n.push(o.projections[a].activeProjectionRefs);var s=i[0].dataMap;t.filters=t.filters||[];var l;for(l in s){var c=_.find(n,(function(e){return _.contains(e,l)}));this.core.addDrillToDetailsFilter(e,t.filters,o,c||[l],r.chooseRepetitionSelectorForDrill(s[l]))}}}},r.prototype.findCompatibleRole=function(r,o,n){var a=o.config.singleVisual,s=a.query||new k(e.data.SemanticQuery.create(),{}),l=this.visualPluginService.capabilities(a.visualType),c=s&&s.projections;if(l&&c){var u=t.services.createVisualCapabilitiesHelper(l,this.geotaggingAnalyzerService,this.featureSwitches.datetimeMinMaxSupported);return u&&u.findCompatibleRole({queryProjections:c,schema:r,expr:n,roleToExprMap:new t.services.SQExprToRoleDictionary(i.HierarchyUtils.hierarchyLevelComparer),preferDrillableRoles:!1})}},r.prototype.getMaxNumberOfExpressionsAllowedInRole=function(i,r,o){var n=r.config.singleVisual,a=n.query||new k(e.data.SemanticQuery.create(),{}),s=this.visualPluginService.capabilities(n.visualType),l=a&&a.projections;if(s&&l){var c=t.services.createVisualCapabilitiesHelper(s,this.geotaggingAnalyzerService,this.featureSwitches.datetimeMinMaxSupported),u=m.getDrillableRoles(s);if(_.contains(u,o))return Number.MAX_VALUE;var d=c.getNumberRangesForRoles(a),p=d[o];if(p&&p.max)return p.max}return 0},r.prototype.getTargetRoleAndExpressionsForAdd=function(e,t,i,r){var o=i;if(P.isHierarchyOrVariation(e,i)&&(o=P.expandExpr(e,i),_.isArray(o))){var n=o;if(!r){var a=this.findCompatibleRole(e,t,n[0]);a&&(r=a.name)}if(r){var s=this.getMaxNumberOfExpressionsAllowedInRole(e,t,r);s!==Number.MAX_VALUE&&(o=1===s&&D.isColumn(i)?i:D.isHierarchy(i)||D.isColumn(i)?n.slice(0,s):n.slice(n.length-s,n.length))}}return{targetRole:r,expressions:o}},r.prototype.addExpressionToVisualWithoutAggregation=function(t,i,r,o){var n=r&&e.ScriptResultUtil.findScriptResultMapping(r.dataViewMappings),a=this.getTargetRoleAndExpressionsForAdd(t,i,o);return a.targetRole&&r.dataRoles[a.targetRole]!==e.VisualDataRoleKind.Measure||(a.expressions instanceof Array&&(a.expressions=o),n||this.shouldPreferGroupToAggregate(t,o,i)||(a.expressions=this.createExprWithAggregate(a.expressions,t,!1))),this.core.add({expr:a.expressions,schema:t,targetRole:a.targetRole},i.config)},r.prototype.addExpressionToVisualForcingAggregation=function(e,t,i,r){var o=this.createExprWithAggregate(r,e,!0);return this.core.add({expr:o,schema:e},t.config)},r.prototype.addExpressionToVisual=function(e,t,i,r){return this.core.add({expr:r,schema:e},t.config)},r.prototype.createVisualContainerConfigCore=function(e,t){var i,r=e.expr,a=r instanceof Array;!e.allowAggregate||a||this.shouldPreferGroupToAggregate(t,r)||(r=this.createExprWithAggregate(r,t,!1));var s=a?r[0]:r,l=e.visualType||o(s,t,this.geotaggingAnalyzerService),c=n(s,t),u={expr:i?e.expr:r,schema:t,visualType:l},d=this.core.create(u);return null!=c&&d&&this.sortService.addSort(d.singleVisual.query,[{expr:s,direction:c}]),d},r.prototype.addVisualContainerImage=function(e,t,i,o,n,a){a=r.getPositionForAddedVisual(e,a);var s="data:image/png;base64,"+t,l=this.resourceRegistration.add(n,100,s),c={singleVisual:{visualType:"image",objects:{general:[{properties:{imageUrl:l}}]}}};this.createVisualFromConfig(e,c,a)},r.prototype.addVisualContainerBasicShape=function(t,i,o){o=r.getPositionForAddedVisual(t,o);var n={singleVisual:{visualType:d.name,objects:{general:[{properties:{shapeType:M.text(i)}}]}}},a=this.createVisualFromConfig(t,n,o);this.telemetry.logEvent(e.telemetry.EXCreateVisual,e.telemetry.HowVisualWasCreated.InsertVisualButton,A.getVisualType(a))},r.prototype.addVisualContainer=function(e,t,i,o){o=r.getPositionForAddedVisual(i,o),t.expr=P.expandExpr(e,t.expr);var n=this.createVisualContainerConfig(e,t);if(n)return this.createVisualFromConfig(i,n,o)},r.prototype.addEmptyVisualContainer=function(e,t,i){i=r.getPositionForAddedVisual(e,i);var o={singleVisual:{visualType:t}};return this.createVisualFromConfig(e,o,i)},r.prototype.createVisualFilters=function(e,i,r){for(var o=t.viewModels.ViewModelFactory.createVisualFilters(e,r,this.displayNameService,this.visualPluginService,this.filterGenerator,this.aggrOps,this.localizationService),n=0,a=o;n<a.length;n++){var s=a[n];s.updateFilterProperties(r,this.visualPluginService,this.aggrOps),s.canVisualize()&&(s.isInvalid()||this.createFilterVisualContainerConfig(s.contract,i,r))}return o},r.prototype.addFilter=function(i,r,o,n){if(!t.FilterUtils.canAdd(r,i,o,this.visualPluginService,this.filterGenerator))return!1;var a=t.FilterUtils.getDefaultFilterType(r,i),u={name:t.FilterUtils.getNextFilterName(o.container.filters),expression:r,type:a,expanded:!0,howCreated:1};e.data.SQExprUtils.isMeasure(r)||this.createFilterVisualContainerConfig(u,n,i),t.FilterUtils.add(o.container,u);var d={filter:u,changeType:1,scope:o};this.eventBridge.publishToChannel(y.filterContainerChanged,d);var p=b.getSelectedVisual(this.selectionService);return V.isMeasure(r)&&this.telemetry.logEvent(e.telemetry.EXAddFilter,l(a),c(o.scopeType),s(r),A.hasGroupByItemsInQuery(p)),!0},r.prototype.removeFilter=function(e,t){return this.removeFilterImpl(e,t)},r.prototype.createFilterVisualContainerConfig=function(t,i,r){var o=t.expression;if(!D.isTransformOutputRoleRef(o)){var n=V.discourageAggregation(o,r),a=E.asFieldPattern(o),s=a.column||a.groupingColumn||a.hierarchyLevel,l={expr:o,dataSources:i,allowAggregate:!1,visualType:e.visuals.plugins.slicer.name};if(!V.isMeasure(o)){var c=this.createVisualContainerConfigCore(l,r);if(c){var u=c.singleVisual.objects;u||(c.singleVisual.objects=u={});var d=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,p=e.visuals.slicerProps.selection.singleSelect,g=e.visuals.slicerProps.header.show,m=e.visuals.slicerProps.data.mode;h.setValue(u,m,null,M.text(e.visuals.slicerMode.basic)),h.setValue(u,d,null,M.boolean(!0)),h.setValue(u,p,null,M.boolean(!1)),h.setValue(u,g,null,M.boolean(!1));var y=e.visuals.slicerProps.items.textSize;if(h.setValue(u,y,null,M.integer(v.smallFontSizeInPoint)),!n&&s){var w=M.entity(s.schema,s.entity,s.entityVar),C=M.aggregate(w,2),S=e.visuals.slicerProps.general.count,b=c.singleVisual.query.getRoleNameForExpr(o),F={data:[f.fromRoles([b])]};h.setValue(u,S,F,C)}var P=0===t.howCreated&&!x.isDefaultFilter(t.filter);if(this.ensureDefaultFilterApplied(r,c.singleVisual,P)&&null==t.filter){var I=a.column||a.groupingColumn?o.getKeyColumns(r):[o];t.filter=x.getDefaultValueFilter(I)}t.config=c}}}},r.prototype.raiseVisualContainerChanged=function(e,i,r){var o=this.explorationNavigationService.getCurrentSection();this.eventBridge.publishToChannel(t.services.events.visualContainerChanged,{affectContainer:i?A.filterAffects(e,o,this.visualRelationshipService,r):A.contractEqualityComparator(e)})},r.prototype.convert=function(i,r,o){var n=A.getVisualType(r),a=this.telemetry.startEvent(e.telemetry.EXInteractionVisualConversion,n,o),s=r.config.singleVisual.query;if(s){this.resetSearchProperties(r);var l=t.contracts.SingleVisualConfig.clone(r.config.singleVisual),c=this.core.convert({schema:i,source:l,target:o});if(!c)return a.reject();r.config.singleVisual=l,a.resolve();var u=this.visualPluginService.capabilities(n),d=this.filterGenerator.tryGetFilterPropertyIdentifier(u);if(!d){var p=this.visualPluginService.capabilities(o);d=this.filterGenerator.tryGetFilterPropertyIdentifier(p)}this.ensureValidDrillMode(r),this.ensureDefaultFilterAndRaiseEvent(i,r,!1,d);var v=r.filters;return _.isEmpty(v)||t.FilterUtils.shouldCreateVisualFilters(r,this.visualPluginService,this.filterGenerator)||(r.filters=[]),c}return r.config.singleVisual.visualType=o,a.resolve(),this.raiseVisualContainerChanged(r),!0},r.prototype.setOrderBy=function(e,t){e.config.singleVisual.query.orderBy(t),this.raiseVisualContainerChanged(e)},r.prototype.removeOrderBy=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];e.config.singleVisual.query.removeOrderBy(o)}this.raiseVisualContainerChanged(e)},r.prototype.deleteVisualRelationships=function(e,t){_.remove(e.relationships,(function(e){return e.source===t||e.target===t}))},r.prototype.addConditionalFormatting=function(e,t,r,o){var n=e.config.singleVisual,a=n.objects;a||(n.objects=a={});var s=t.selector,l=i.ConditionalFormattingUtil.getFirstFormatPropertyPropertyId(t);h.setValue(a,l,s,o)},r.prototype.removeConditionalFormatting=function(e,t,r){var o=e.config.singleVisual.objects,n=t.selector,a=i.ConditionalFormattingUtil.getFirstFormatPropertyPropertyId(t);h.deleteProperty(o,a.objectName,n,a.propertyName)},r.prototype.setVisualRelationship=function(e,t,i,r){if(t!==i){e.relationships=e.relationships||[];var o=this.visualRelationshipService.getVisualRelationship(e,t,i);if(o)o.type=r;else{var n=(_.contains(e.visualContainers,t),_.contains(e.visualContainers,i),{source:t,target:i,type:r});e.relationships.push(n)}}},r.prototype.ensureValidDrillState=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];this.core.removeDrillFilter(e.filters,o.expr,!1);var n=e.config.singleVisual.query,a=n.projections[o.roleName];if(o.isActiveProjection&&a&&a.activeProjectionRefs){var s=a.all(),l=s[o.index-1],c=s[o.index],u=a.activeProjectionRefs.length>1;if(l)u?a.activeProjectionRefs=_.chain(s).take(o.index).map((function(e){return e.queryRef})).value():a.activeProjectionRefs=[l.queryRef];else if(c)u?a.activeProjectionRefs=_.chain(s).take(o.index+1).map((function(e){return e.queryRef})).value():a.activeProjectionRefs=[c.queryRef];else if(s.length>1)if(u)a.activeProjectionRefs=_.map(s,(function(e){return e.queryRef}));else{var d=_.last(s);a.activeProjectionRefs=[d.queryRef]}else a.activeProjectionRefs=[]}}this.ensureValidDrillMode(e)},r.prototype.ensureValidDrillMode=function(e){var t=e.drillMode;(1===t&&0===this.drill.getSupportedDrillDirections(e)||2===t&&!this.drill.canDrillToDetails(e))&&this.drill.setDrillMode(e,0)},r.prototype.getVisualDataRole=function(e,t){var i=A.getDataRolesForVisual(e,this.visualPluginService);if(!_.isEmpty(i))return u.findItemWithName(i,t)},r.prototype.removeFieldImpl=function(e,t){return this.invokeRemoveOnSelectedVisuals({expr:e,ignoreAggregates:!0},t)},r.prototype.removeFilterImpl=function(e,t){if(!t||!t.container||!t.container.filters)return!1;for(var i={filter:e,changeType:0,scope:t},r=0;r<t.container.filters.length;r++)if(t.container.filters[r]===e)return t.container.filters.splice(r,1),this.eventBridge.publishToChannel(y.filterContainerChanged,i),!0;return!1},r.prototype.removeFiltersWithExpr=function(e,t){var i=t.filters;if(!i)return!1;for(var r,o=i.length-1;o>=0;o--){var n=i[o];D.equals(n.expression,e)&&(r=this.removeFilterImpl(n,{scopeType:0,container:t}))}return r},r.prototype.invokeRemoveOnSelectedVisuals=function(e,t){for(var i=!1,r=t.length-1;r>-1;r--){var o=t[r],n=o.config.singleVisual.query,a=m.getDrillFilterRemovalInfoList(n,e,0);this.removeExpressionsFromVisual(e,o.config)&&(this.ensureValidDrillState(o,a),this.raiseVisualContainerChanged(o),i=!0)}return i},r.prototype.removeExpressionsFromVisual=function(e,t){for(var i=e.count||1,r=0;r<i;r++)if(!this.core.remove(e,t))return!1;return!0},r.prototype.createVisualFromConfig=function(e,i,r){var o=this.formFactorProvider.getCurrentLayout(),n={config:i,filters:[],layouts:jsCommon.ArrayExtensions.extendWithId([{id:o,position:r}])};e.contract.visualContainers.push(n);var a=this.explorationNavigationService.getCurrentExploration(),s=t.viewModels.ViewModelFactory.convertVisualContainer(a,e.contract,n,o);if(s)return e.visualContainers.push(s),b.selectVisualContainer(n,this.selectionService),n},r.prototype.createExprWithAggregate=function(e,t,i,r){if(V.discourageAggregation(e,t))return e;var o=this.getPreferredAggregate(t,e,r);return this.aggrOps.createExprWithAggregate(e,t,i,r?r.requiredTypes:null,o)},r.getPositionForAddedVisual=function(e,t){if(!t)return r.getDefaultVisualContainerPosition(e);if(null!=t.z)return t;var o=_.cloneDeep(t);return o.z=i.CanvasVisualsUtility.getZIndexForNewVisual(e),o},r.getDefaultVisualContainerPosition=function(e){return{height:0,width:0,x:0,y:0,z:i.CanvasVisualsUtility.getZIndexForNewVisual(e)}},r.prototype.shouldPreferGroupToAggregate=function(i,r,o,n){if(this.isRoleTypeLatLong(i,r,n)){if(o){var a=A.getVisualQuery(o);if(a&&a.projections)for(var s=this.visualPluginService.capabilities(o.config.singleVisual.visualType),l=t.services.createVisualCapabilitiesHelper(s,this.geotaggingAnalyzerService,this.featureSwitches.datetimeMinMaxSupported),c=l.getNonLatLongCategoricalRoles(),u=0,d=c;u<d.length;u++){var p=d[u];if(a.projections[p])return!1}}return!0}return n&&n.kind!==e.VisualDataRoleKind.Measure},r.prototype.getPreferredAggregate=function(e,t,i){if(this.isRoleTypeLatLong(e,t,i))return 1},r.prototype.isRoleTypeLatLong=function(t,i,r){if(r){var o=r.preferredTypes,n=_.isEmpty(o)?void 0:o[0];if(N(n))return!0}var a=i.getMetadata(t),s=a?a.type:void 0;if(N(s))return!0;if(s){var l=E.asFieldPattern(i),c=l.column||l.columnAggr||l.groupingColumnAggr||l.groupingColumnAggr||l.measure;if(c){var u=c&&this.geotaggingAnalyzerService.getFieldType(c.name);if(null!=u){var d=e.ValueType.fromPrimitiveTypeAndCategory(s.primitiveType,u);if(N(d))return!0}}}return!1},r.prototype.canHierarchyLevelJoinExistingGroup=function(e,t,i,r,o){var n=t&&t.projections[i];if(D.isHierarchyLevel(r)&&n&&n.all().length>0){var a=r,s=n.all(),l=P.expandExpr(e,a.arg),c=_.isNumber(o)?o-1:s.length-1;if(c>=0&&P.areHierarchyLevelsOrdered(l,t.tryGetExpr(i,c),a))return!0;if(_.isNumber(o)&&o<s.length&&P.areHierarchyLevelsOrdered(l,a,t.tryGetExpr(i,o)))return!0}return!1},r.prototype.addHierarchyLevelToExistingHierarchiesInVisual=function(e,t,i,r){var o=!1,n=C.getOptionsToAddHierarchyLevelToExistingHierarchies(e,t,i.singleVisual.query,r);if(n)for(var a=0,s=n;a<s.length;a++){var l=s[a];o=this.core.add(l,i)||o}return o},r.prototype.ensureDefaultFilterAndRaiseEvent=function(e,t,i,r){var o=t.config.singleVisual;if(this.ensureDefaultFilterApplied(e,o,i))this.eventBridge.publishToChannel(y.visualContainerChanged,{affectContainer:function(e){return!0}});else{var n=void 0;if(r&&o.objects){var a=r&&h.getValue(o.objects,r,null);n=null!=a}this.raiseVisualContainerChanged(t,n,e)}},r.prototype.ensureDefaultFilterApplied=function(e,t,i){var r=t.query.getUniqueQueryRefs();if(0===r.length)return!1;var o=t.query.defn.select().withName(r[0]).expr,n=V.getDefaultValue(o,e),a=this.visualPluginService.capabilities(t.visualType),s=a?a.objects:null;if(!n)return this.clearDefaultValueAndFilter(t,o,s),!1;var l=g.findDefaultValue(s);if(!l)return this.clearDefaultValueAndFilter(t,o,s),!1;if(i)return!1;t.objects||(t.objects={});var c,u=E.asFieldPattern(o);c=u.column||u.groupingColumn?o.getKeyColumns(e):o;var d=g.findFilterOutput(s),p=x.getDefaultValueFilter(c);return h.setValue(t.objects,d,null,p),!0},r.prototype.clearDefaultValueAndFilter=function(e,t,i){if(e.objects){var r=g.findFilterOutput(i);if(r){var o=h.getValue(e.objects,r,null);x.isDefaultFilter(o)&&h.deleteProperty(e.objects,r.objectName,null,r.propertyName)}}},r.prototype.resetSearchProperties=function(e){var t=A.getObjectDefinitions(e);if(t){var i=A.getVisualCapabilities(e,this.visualPluginService),r=this.filterGenerator.tryGetSelfFilterEnabledProperty(i);r&&h.deleteProperty(t,r.objectName,null,r.propertyName);var o=this.filterGenerator.tryGetSelfFilterProperty(i);o&&h.deleteProperty(t,o.objectName,null,o.propertyName)}},r})();i.getVisualDefaultType=o,i.getVisualDefaultSort=n})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return{deleteVisualRelationships:_.noop,getFilters:function(){return{dataFilter:null}},getVisualRelationshipFilterAction:function(){return 0},selectDataPoint:_.noop,setVisualRelationshipFilterAction:_.noop,clearHighlight:_.noop}}e.createQueryVisualHostServices=t})(t=e.VisualHostServicesUtil||(e.VisualHostServicesUtil={}))})(t=e.util||(e.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){function i(t){e.common.registerBuildingBlocksForHost(t,o,{componentsTarget:"powerbi.explore.components",componentsMap:e.explore.components,directivesTarget:"powerbi.explore.directives",directivesMap:e.explore.directives,filtersTarget:"powerbi.explore.filters",filtersMap:e.explore.filters})}var r=e.common.HostEnv,o=[{name:"AdvancedFilter",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"AlignmentGroup",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"AnalyticsCard",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"AnalyticsInstanceSelector",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost},{name:"AnalyticsPane",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"BoxGrid",dependencies:[],blockType:2,consumerHostFlags:r.Desktop|r.ExploreHost},{name:"CanvasLayout",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"CanvasLayoutItem",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"CanvasVisualError",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"CanvasVisualErrorOverlay",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"CanvasVisualHeaderIcon",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"Carousel",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ClusteringDialog",dependencies:[],blockType:2,consumerHostFlags:r.Desktop|r.DesktopDialog},{name:"CodePaneContainer",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ConditionalFormattingDialog",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.DesktopDialog|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"DateTimePicker",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost},{name:"DeleteCustomVisualsDialog",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"DeleteVisualWarningDialog",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"DetailVisual",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"DisplayOptionFilter",dependencies:["localizationService"],blockType:4,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"DotGrid",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop},{name:"EmbedModalDialog",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"EsriConsentDialog",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"Exploration",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ExplorationAppBar",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ExplorationFooter",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ExplorationHost",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ExplorationNavigationTab",dependencies:["platformCapabilities"],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ExplorationPaginator",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ExplorationStatusBar",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ExploreCanvas",dependencies:["telemetryService","overlayService","visualHostTooltip"],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"FieldList",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"FieldListEntity",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"FieldListProperty",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"FieldWell",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"FieldWellBucket",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"FieldWellField",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"Filter",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"FilterPane",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"FilterVisual",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ForecastCard",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost},{name:"IncludeExcludeFilter",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"MobileVisualizationPane",dependencies:[],blockType:2,consumerHostFlags:r.Desktop|r.DashboardHost},{name:"ImageUpload",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ImportVisualErrorDialog",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ImportVisualWarningDialog",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ModelingContextChanger",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"NumericUnitSelection",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"PagePropertyPane",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"PbiValidate",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"PenAnnotation",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"PropertyCard",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"PropertyPane",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"PropertyPaneTextBox",dependencies:["localizationService"],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"PropertySlice",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"PropertySliceContainer",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"QuickCalcDialog",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost|r.DesktopDialog},{name:"ReferenceLineCardContainer",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost},{name:"ReferenceLineCard",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost},{name:"SelectionBox",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"ShapeMapSelector",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"Slider",dependencies:["localizationService"],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"TableViewDialog",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.DesktopDialog|r.ExploreHost},{name:"TaskPane",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"TopNFilter",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VirtualList",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainer",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerContextMenu",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerDrill",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerDrillToggle",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerRelationshipFilters",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerHeader",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerOptionsMenu",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerPinButton",dependencies:[],blockType:2,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerPopOutBar",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualContainerThumbnail",dependencies:[],blockType:2,consumerHostFlags:r.Desktop},{name:"VisualizationPane",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualTypesContainer",dependencies:[],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost},{name:"VisualWatermark",dependencies:["$templateCache","visualPlugin"],blockType:1,consumerHostFlags:r.Web|r.Desktop|r.ExploreHost|r.StandaloneReportHost|r.DashboardHost}];angular.module("powerbi.explore.controllers",[]),angular.module("powerbi.explore.directives",[]),angular.module("powerbi.explore.components",[]),angular.module("powerbi.explore.filters",[]);var n=["powerbi.common","powerbi.explore.controllers","powerbi.explore.directives","powerbi.explore.components","powerbi.explore.filters","powerbi.visualHost","ui.bootstrap"];angular.module("powerbi.explore",n).factory("displayNameService",["aggrOps",function(t){var i=e.common.localize,r={aggregateDisplayNames:{Sum:i.get("DisplayName_Sum"),Avg:i.get("DisplayName_Avg"),Count:i.get("DisplayName_Count"),Min:i.get("DisplayName_Min"),Max:i.get("DisplayName_Max"),CountNonNull:i.get("DisplayName_CountNonNull"),Median:i.get("DisplayName_Median"),StandardDeviation:i.get("DisplayName_StandardDeviation"),Variance:i.get("DisplayName_Variance"),DateMin:i.get("DisplayName_DateMin"),DateMax:i.get("DisplayName_DateMax"),StringMin:i.get("DisplayName_StringMin"),StringMax:i.get("DisplayName_StringMax")},quickCalcDisplayNames:{PercentOfGrandTotal:i.get("DisplayName_QuickCalc_PercentOfGrandTotal"),PercentileExclusive:i.get("DisplayName_QuickCalc_PercentileExclusive"),PercentileInclusive:i.get("DisplayName_QuickCalc_PercentileInclusive")},qualifiedDisplayNameTemplate:i.get("Field_Tooltip")};return e.explore.services.createDisplayNameService(r,t)}]).factory("linguisticSchemaProxy",["promiseFactory",function(t){return e.explore.proxies.createLinguisticSchemaProxy(t,e.common.httpService)}]).factory("visualPlugin",["featureSwitchService","mapControlFactory","promiseFactory","resourceLoader",function(t,i,r,o){return e.explore.services.createExplorationVisualPluginService(t.featureSwitches,r,o,i)}]).factory("transformPluginService",[function(){return e.data.transforms.createTransformPluginService()}]).factory("explorationSerializer",["visualPlugin","featureSwitchService",function(t,i){return e.explore.services.createExplorationSerializer(t)}]).factory("reportTileService",["promiseFactory","explorationProxy","$timeout",function(t,i,r){return e.explore.services.createReportTileService(t,i,r)}]).factory("explorationProxy",["promiseFactory","explorationSerializer","telemetryService","featureSwitchService",function(t,i,r,o){return e.explore.proxies.createExplorationProxy(t,e.common.httpService,i,r,o)}]).factory("layoutInsertionHelper",(function(){return e.explore.services.createLayoutInsertionHelper()})).factory("geoTaggingAnalyzerService",["localizationService",function(t){return e.createGeoTaggingAnalyzerService((function(e){return t.get(e)}))}]).factory("embedProxy",["promiseFactory","localizationService",function(i,r){return t.proxies.createEmbedProxy(e.common.httpService,i,r)}]).factory("networkAvailability",[function(){return e.common.createNetworkAvailabilityService()}]).factory("visualStylePreset",(function(){return e.visualHost.services.createVisualStylePresetService()})).factory("visualHostTooltip",["$timeout",function(t){return e.explore.services.createVisualHostTooltipService(t)}]).directive("datepickerPopup",(function(){return{restrict:"EAC",require:"ngModel",link:function(e,t,i,r){r.$formatters.shift()}}})).factory("loadProgressNotificationService",["$timeout",function(t){return e.common.createLoadProgressNotificationService(t,(function(){}))}]).factory("subscription",["taskPaneSliderService","userInfo","localizationService","licenseHelperService",function(t,i,r,o){return e.explore.services.createSubscriptionPaneService(t,i,r,o)}]).factory("loadProgressNotificationService",["$timeout",function(t){return e.common.createLoadProgressNotificationService(t,(function(){}))}]).factory("esriExploration",["$rootScope","errorService","modalDialogService","featureSwitchService","promiseFactory",function(t,i,r,o,n){return e.exploreui.services.createEsriExplorationService(t,i,r,o,n)}]).run(["scopedProvider",function(i){i.register("dataSources",{fn:function(){return t.services.createDataSourcesService()}}).register("canvasScale",{scopedServices:["explorationNavigation","formFactor","popOut","viewModeState"],fn:function(e,i,r,o){return t.services.createCanvasScaleService(e,i,r,o)}}).register("eventBridge",{fn:function(){return e.common.createEventBridge()}}).register("includeExcludeService",{services:["localizationService","telemetryService"],scopedServices:["eventBridge","undoRedo"],fn:function(e,i,r,o){return t.services.createIncludeExcludeService(r,e,o,i);
}}).register("explorationNavigation",{services:["explorationProxy"],scopedServices:["eventBridge"],fn:function(t,i){return e.explore.services.createExplorationNavigationService(t,i)}}).register("servicePauser",{fn:function(){return e.explore.services.createServicePauser()}}).register("formFactor",{services:["$timeout","telemetryService"],scopedServices:["eventBridge","selection","servicePauser","viewModeState"],fn:function(e,i,r,o,n,a){return t.services.createFormFactorProvider(r,o,n,e,a,i)}}).register("viewModeState",{fn:function(){return e.explore.services.createViewModeState()}}).register("colorPicker",{fn:function(){return e.common.createColorPickerService()}}).register("drill",{scopedServices:["eventBridge","visualPlugin"],fn:function(e,i){return t.services.createDrillService(e,i)}}).register("drillToDetails",{services:["aggrOps","conceptualSchemaProxy","displayNameService","explorationSerializer","geoTaggingAnalyzerService","featureSwitchService","localizationService","$rootScope","$timeout","telemetryService"],scopedServices:["drill","eventBridge","explorationNavigation","filterGenerator","popOut","resourceRegistration","selection","sort","undoRedo","visualPlugin","visualRelationship","formFactor"],fn:function(e,i,r,o,n,a,s,l,c,u,d,p,v,h,g,f,m,y,w,C,S,b){return t.services.createDrillToDetailsService(i,o,C,n,w,a,m,v,g,l,c,p,r,u,y,S,d,h,e,f,s,b)}}).register("groupAuthoring",{services:["telemetryService"],fn:function(t){return e.explore.services.createDisabledGroupAuthoringService(t)}}).register("clusteringAuthoring",{services:["conceptualSchemaProxy","promiseFactory","localizationService","transformPluginService"],scopedServices:["modelAuthoring","explorationNavigation","visualQueryGenerator","filterGenerator"],fn:function(t,i,r,o,n,a,s,l){return e.explore.services.createClusteringAuthoringService(t,i,r,o,n,a,s,l)}}).register("selection",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSelectionService(t)}}).register("popOut",{services:["telemetryService"],scopedServices:["eventBridge","selection"],fn:function(t,i,r){return e.explore.services.createPopOutService(t,i,r)}}).register("deleteVisual",{services:["$rootScope","telemetryService"],scopedServices:["eventBridge","visualPlugin","undoRedo"],fn:function(t,i,r,o,n){return e.exploreui.services.createDeleteVisualService(r,t,i,o,n)}}).register("importVisual",{services:["modalDialogService","$rootScope","localizationService","errorService","notificationToast","telemetryService","upload"],scopedServices:["eventBridge","visualPlugin"],fn:function(t,i,r,o,n,a,s,l,c){return e.exploreui.services.createImportVisualService(l,t,i,r,o,n,a,c,s)}}).register("visualRelationship",{scopedServices:["visualPlugin"],fn:function(t){return e.explore.services.createVisualRelationshipService(t)}}).register("undoRedo",{services:["$rootScope","logger"],scopedServices:["eventBridge"],fn:function(t,i,r){return e.explore.services.createUndoRedoService(t,r,i)}}).register("clipboard",{services:["visualStylePreset","$rootScope"],scopedServices:["undoRedo","eventBridge","servicePauser"],fn:function(t,i,r,o,n){return n.register(e.explore.services.createClipboardService(r,o,t,i))}}).register("hostFiltersService",{services:["conceptualSchemaProxy","singleExecutableDataProxyFactory","promiseFactory"],scopedServices:["eventBridge"],fn:function(t,i,r,o){return e.explore.services.createHostFiltersService(t,i,r,o)}}).register("visualPlugin",{services:["featureSwitchService","mapControlFactory","promiseFactory"],scopedServices:["resourceLoader"],fn:function(t,i,r,o){return e.explore.services.createExplorationVisualPluginService(t.featureSwitches,r,o,i)}}).register("sort",{services:["displayNameService","featureSwitches"],scopedServices:["visualPlugin"],fn:function(t,i,r){return e.explore.services.createSortService(t,i,r)}}).register("scriptVisuals",{services:["featureSwitchService","localizationService","userInfo","embedModeService"],scopedServices:["visualPlugin"],fn:function(t,i,r,o,n){return e.explore.services.createScriptVisualsService(n,t,i,r,o)}}).register("filterGenerator",{services:["aggrOps","telemetryService"],scopedServices:["eventBridge","hostFiltersService","visualPlugin","visualRelationship","scriptVisuals"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createFilterGenerator(r,n,t,a,o,i,s)}}).register("visualQueryGenerator",{services:["aggrOps","dataReaderProvider","displayNameService","featureSwitchService","transformPluginService","telemetryService"],scopedServices:["filterGenerator","visualPlugin","sort"],fn:function(t,i,r,o,n,a,s,l,c){return e.explore.services.createVisualQueryGenerator({dataReaders:i,displayNameService:r,featureSwitchService:o,plugin:l,sortService:c,aggrOps:t,filterGenerator:s,transformPluginService:n,telemetryService:a})}}).register("visualAuthoring",{services:["conceptualSchemaProxy","displayNameService","explorationSerializer","telemetryService","promiseFactory","geoTaggingAnalyzerService","featureSwitchService","aggrOps","visualHostTooltip","localizationService"],scopedServices:["drill","eventBridge","undoRedo","explorationNavigation","resourceRegistration","selection","sort","visualPlugin","visualRelationship","filterGenerator","formFactor"],fn:function(t,i,r,o,n,a,s,l,c,u,d,p,v,h,g,f,m,y,w,C,S){return e.explore.services.createVisualAuthoring(y,t,i,o,h,f,a,r,p,n,v,s.featureSwitches,m,w,d,C,l,c,g,S,u)}}).register("layoutAuthoring",{services:["explorationSerializer","telemetryService"],scopedServices:["eventBridge","explorationNavigation","formFactor","undoRedo","selection"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createLayoutAuthoring(t,i,r,a,o,n,s)}}).register("canvasKeyHandler",{services:["explorationSerializer"],scopedServices:["selection","clipboard","undoRedo","viewModeState","visualAuthoring","eventBridge","popOut","formFactor","layoutAuthoring"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createCanvasKeyHandlerService(r,i,t,n,o,a,s,l,c,u)}}).register("modelChangeHandler",{services:["conceptualSchemaProxy","dataProxy","promiseFactory"],scopedServices:["$scope","dataSources","eventBridge","undoRedo","visualPlugin"],fn:function(t,i,r,o,n,a,s,l){return e.explore.services.createModelChangeHandler(t,i,o,n,a,s,l,r)}}).register("modelAuthoring",{fn:function(){return e.explore.services.createModelAuthoringService()}}).register("clusteringState",{fn:function(){return e.explore.services.createClusteringStateService()}}).register("groupingDesignStateService",{fn:function(){return e.explore.services.createGroupingDesignStateService()}}).register("groupQueryService",{services:["conceptualSchemaProxy","promiseFactory","singleExecutableDataProxyFactory"],scopedServices:["filterGenerator","visualQueryGenerator"],fn:function(e,i,r,o,n){return t.services.createGroupQueryService(r,o,e,n,i)}}).register("schemaItemActivation",{scopedServices:["eventBridge"],fn:function(t){return e.explore.services.createSchemaItemActivationService(t)}}).register("shell",{fn:function(){return e.explore.services.createShellService()}}).register("pinVisual",{services:["conceptualSchemaProxy","displayNameService","singleExecutableDataProxyFactory","featureSwitchService","resourcePackagesService"],scopedServices:["visualQueryGenerator","visualPlugin"],fn:function(t,i,r,o,n,a,s){return e.explore.services.createPinVisualService(t,i,r.create(),o,n,a,s)}}).register("explorationCapabilities",{fn:function(){return e.explore.services.createExplorationCapabilitiesService()}}).register("embed",{services:["$location","promiseFactory","explorationSerializer","conceptualSchemaProxy","dataProxy","displayNameService","activeGroupId"],scopedServices:["visualQueryGenerator","visualPlugin","filterGenerator"],fn:function(t,i,r,o,n,a,s,l,c,u){return e.explore.services.createEmbedService(t,i,r,o,l,n,c,a,u,s)}}).register("exportVisualData",{services:["aggrOps","conceptualSchemaProxy","singleExecutableDataProxyFactory","geoTaggingAnalyzerService","featureSwitchService","promiseFactory","displayNameService","userInfo","localizationService"],scopedServices:["visualPlugin","visualQueryGenerator"],fn:function(t,i,r,o,n,a,s,l,c,u,d){return e.explore.services.createExportVisualDataService(u,d,r.create(),i,t,o,n,a,s,l,c)}}).register("resourcePublishing",{fn:function(t){return e.explore.services.createResourcePublishingService()}}).register("resourceRegistration",{scopedServices:["explorationNavigation","resourcePublishing"],fn:function(t,i){return e.explore.services.createResourceRegistrationService(t,i)}}).register("filterRestatement",{services:["conceptualSchemaProxy","promiseFactory","singleExecutableDataProxyFactory"],scopedServices:["filterGenerator","visualQueryGenerator"],fn:function(t,i,r,o,n){return e.explore.services.createFilterRestatementService(t,o,i,r,n)}}).register("clusteringService",{services:["conceptualSchemaProxy","errorService","localizationService","modalDialogService","promiseFactory","telemetryService"],scopedServices:["clusteringAuthoring","clusteringState","groupingDesignStateService","modelChangeHandler","visualAuthoring","visualPlugin"],fn:function(t,i,r,o,n,a,s,l,c,u,d,p){return e.explore.services.createClusteringService(t,s,l,c,d,p,i,r,u,o,n,a)}})}]),t.registerBuildingBlocksForHost=i})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.TransformElementResizeStartEventName="TransformElementResizeStart",e.TransformElementResizeMoveEventName="TransformElementResizeMove",e.TransformElementResizeEndEventName="TransformElementResizeEnd",e.TransformElementDragStartEventName="TransformElementDragStart",e.TransformElementDragMoveEventName="TransformElementDragMove",e.TransformElementDragEndEventName="TransformElementDragEnd",e.TransformElementNudgeEventName="TransformElementNudge",e.scrollCarouselToEndEventName="scrollCarouselToEnd",e.explorationLoadedEventName="explorationLoaded",e.explorationClearedEventName="explorationCleared",e.pinVisualContainerEventName="pinVisualContainer",e.invalidVisualContainerId=-1,e.explorationNextPageEvent="explorationNextPage",e.explorationPreviousPageEvent="explorationPreviousPage",e.insertSectionEvent="insertSectionEvent",e.renameSectionEvent="renameSectionEvent",e.deleteSectionEvent="deleteSectionEvent",e.switchSectionEvent="switchSectionEvent",e.ConnectionSetupLimit=4,e.smallFontSizeInPoint=9;var t;!(function(e){e.AutoLayoutVisualPadding=10,e.AutoLayoutVisualVCHeader=20,e.AutoLayoutVisualSkittlesRightPadding=30,e.AutoLayoutMaxSpaceHeight=300,e.AutoLayoutMaxSpaceWidth=300,e.ResponsiveLayoutMaxWidthBreakpoint=500,e.ScrollbarOffset=15,e.DisplayAreaHeightAdditionMinimumScale=.9,e.DisplayAreaHeightScaleAddtion=.02,e.ExploreCanvasPadding=8,e.PhoneAuthoringViewportHeight=558,e.PhoneAuthoringViewportWidth=324,e.PhonePortraitRowCount=20,e.PhonePortraitCanvasHeight=1200})(t=e.ExploreCanvasConstants||(e.ExploreCanvasConstants={}))})(t=e.constants||(e.constants={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=jsCommon.EnumExtensions;!(function(e){e[e.Rectangle=0]="Rectangle",e[e.Oval=1]="Oval",e[e.Line=2]="Line",e[e.Triangle=3]="Triangle",e[e.Arrow=4]="Arrow"})(e.Shape||(e.Shape={}));var i,r=e.Shape;!(function(e){function i(e,t,i,r){var o=[{text:e.get("ReportAppBar_ViewFitToPage"),description:e.get("ReportAppBar_ViewFitToPageDescription"),action:13,itemClass:"pbi-glyph-fittopage2",type:DropDownMenuItemType.Item,disabled:!1,selected:1===r},{text:e.get("ReportAppBar_ViewFitToWidth"),description:e.get("ReportAppBar_ViewFitToWidthDescription"),action:12,itemClass:"pbi-glyph-fittowidth",type:DropDownMenuItemType.Item,disabled:!1,selected:2===r},{text:e.get("ReportAppBar_ViewActualSize"),description:e.get("ReportAppBar_ViewActualSizeDescription"),action:11,itemClass:"pbi-glyph-actualsize",type:DropDownMenuItemType.Item,disabled:!1,selected:3===r}];return i&&(o.push({action:null,type:DropDownMenuItemType.Separator}),o.push({text:e.get("ReportAppBar_ShowGrid"),description:e.get("ReportAppBar_ShowGridDescription"),action:14,itemClass:"pbi-glyph-showgrid",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:t.getShowGridlines()}),o.push({text:e.get("ReportAppBar_SnapToGrid"),description:e.get("ReportAppBar_SnapToGridDescription"),action:15,itemClass:"pbi-glyph-snaptogrid",type:DropDownMenuItemType.Item,disabled:!1,checkbox:!0,checked:t.getSnapToGrid()})),o}function o(e,t){return[{text:e.get("ReportAppBar_EditReportInWebApp"),description:e.get("ReportAppBar_EditReportInWebAppDescription"),action:16,itemClass:"pbi-glyph-powerbi-service",type:DropDownMenuItemType.Item,tooltip:e.get("ReportAppBar_EditReportInWebAppDescription")},{text:e.get("ReportAppBar_EditReportInDesktop"),description:e.get("ReportAppBar_EditReportInDesktopDescription"),action:17,itemClass:"pbi-glyph-powerbi",type:DropDownMenuItemType.Item,disabled:!t,tooltip:t?e.get("ReportAppBar_EditReportInDesktopDescription"):e.get("ReportAppBar_DisabledEditReportInDesktopTooltip")}]}function n(e){var t=e.localizationService;return[{text:t.get("ReportAppBar_SaveToDashboard"),description:t.get("ReportAppBar_SaveToDashboardDescription"),action:0,itemClass:"pbi-glyph-save",show:e.showSave,tooltip:t.get("ReportAppBar_SaveToDashboardDescription")},{text:t.get("ReportAppBar_SaveAs"),description:t.get("ReportAppBar_SaveAsDescription"),action:1,itemClass:"pbi-glyph-saveas",show:e.showSaveAs,tooltip:t.get("ReportAppBar_SaveAsDescription")},{text:t.get("ReportAppBar_Print"),description:t.get("ReportAppBar_PrintDescription"),action:5,itemClass:"pbi-glyph-print",show:e.showPrint,tooltip:t.get("ReportAppBar_PrintDescription")},{text:t.get("ReportAppBar_SnapshotEmbed"),description:t.get("ReportAppBar_SnapshotEmbedDescription"),action:2,itemClass:"pbi-glyph-publishtoweb",show:e.showEmbed,tooltip:t.get("ReportAppBar_SnapshotEmbedDescription")},{text:t.get("ReportAppBar_SharePointEmbed"),description:t.get("ReportAppBar_SharePointEmbedDescription"),action:3,itemClass:"pbi-glyph-sharepoint",show:e.showSharepointEmbed},{text:t.get("ReportAppBar_Diagnostics"),description:t.get("ReportAppBar_DiagnosticsDescription"),action:6,itemClass:"pbi-glyph-code",show:e.showDiagnostics,tooltip:t.get("ReportAppBar_DiagnosticsDescription")},{text:t.get("ReportAppBar_PowerPoint"),description:t.get("ReportAppBar_PowerPointDescription"),action:8,itemClass:"pbi-glyph-powerpoint",show:e.showPowerPoint,tooltip:t.get("ReportAppBar_PowerPointDescription")},{text:t.get("ReportAppBar_DownloadReport"),description:t.get("ReportAppBar_DownloadReportDescription"),action:9,itemClass:"pbi-glyph-download2",show:e.showDownloadReport,disabled:!e.canDownloadReport,tooltip:e.canDownloadReport?t.get("ReportAppBar_DownloadReportDescription"):t.get("ReportAppBar_DisabledDownloadReportTooltip")}]}function a(e){return[{text:e.get("VisualContainer_SeeData_Enable"),action:18,itemClass:"pbi-glyph-seedata",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDownLevel"),description:e.get("DrillDownLevel_ToolTip"),action:19,itemClass:"pbi-glyph-expand",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDownLevelGrouped"),description:e.get("DrillDownLevelGrouped_ToolTip"),action:20,itemClass:"pbi-glyph-inline-drill",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillUp"),description:e.get("DrillUp_ToolTip"),action:21,itemClass:"pbi-glyph-drillup",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillDown"),description:e.get("DrillDown_ToolTip"),action:22,itemClass:"pbi-glyph-drilldowndisabled",type:DropDownMenuItemType.Item,disabled:!0,selected:!1},{text:e.get("DrillToDetails"),description:e.get("DrillToDetails_ToolTip"),action:23,itemClass:"pbi-glyph-drilltodetail",type:DropDownMenuItemType.Item,disabled:!0,selected:!1}]}function s(e){return[l(e.get("ReportAppBar_ShapeRectangle"),e.get("ReportAppBar_ShapeRectangleDescription"),"shapeRectangle",r.Rectangle),l(e.get("ReportAppBar_ShapeOval"),e.get("ReportAppBar_ShapeOvalDescription"),"shapeOval",r.Oval),l(e.get("ReportAppBar_ShapeLine"),e.get("ReportAppBar_ShapeLineDescription"),"shapeLine",r.Line),l(e.get("ReportAppBar_ShapeTriangle"),e.get("ReportAppBar_ShapeTriangleDescription"),"shapeTriangle",r.Triangle),l(e.get("ReportAppBar_ShapeArrow"),e.get("ReportAppBar_ShapeArrowDescription"),"shapeArrow",r.Arrow)]}function l(e,i,o,n){return{text:e,description:i,action:24,itemClass:"displayOption "+o,type:DropDownMenuItemType.Item,param:t.toString(r,n).toLowerCase()}}function c(e){return[{text:e.get("ReportAppBar_Left"),description:e.get("Align_Left"),action:25,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Center"),description:e.get("Align_Center"),action:26,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Right"),description:e.get("Align_Right"),action:27,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Top"),description:e.get("Align_Top"),action:28,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Middle"),description:e.get("Align_Middle"),action:29,itemClass:"alignAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Bottom"),description:e.get("Align_Bottom"),action:30,itemClass:"alignAction",type:DropDownMenuItemType.Item}]}function u(e){return[{text:e.get("ReportAppBar_Horizontal"),description:e.get("ReportAppBar_HorizontalDescription"),action:31,itemClass:"distributeAction",type:DropDownMenuItemType.Item},{text:e.get("ReportAppBar_Vertical"),description:e.get("ReportAppBar_VerticalDescription"),action:32,itemClass:"distributeAction",type:DropDownMenuItemType.Item}]}function d(e,t,i,r,o){var n=[];return o&&n.push({text:e.get("Report_GenerateQRCode"),action:1,type:DropDownMenuItemType.Item}),t.isAnalyzeInExcelSupported(i,r)&&n.push({text:e.get("ReportAppBar_AnalyzeInExcelMenuItem_Text"),action:0,type:DropDownMenuItemType.Item}),i.featureSwitches.staticExportReportEnabled&&n.push({text:e.get("ReportAppBar_ExportAsImage"),action:2,type:DropDownMenuItemType.Item}),n}e.createViewMenuActions=i,e.createEditReportMenuActions=o,e.createFileMenuActions=n,e.createExploreMenuActions=a,e.createShapeMenuActions=s,e.createAlignmentMenuActions=c,e.createDistributeMenuActions=u,e.createReportMoreOptionsMenuItems=d})(i=e.ExplorationAppBarViewModelFactory||(e.ExplorationAppBarViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){e.selectedValue=e.ngModel.$modelValue}},e.prototype.setAlignment=function(e){this.selectedValue=e,this.ngModel.$setViewValue(this.selectedValue)},e})();e.AlignmentGroupController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.AlignmentGroup={templateUrl:"components/alignmentGroup/alignmentGroup.html",require:{ngModel:"ngModel"},controller:e.common.Services.createController(t.controllers.AlignmentGroupController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){}return Object.defineProperty(i.prototype,"currentInstance",{get:function(){return _.isEmpty(this.instances)?this.card.defaultInstance:this.getInstance(this.instances,this.currentInstanceSelectorId)},set:function(e){this.currentInstanceSelectorId=e.selector?e.selector.id:void 0},enumerable:!0,configurable:!0}),i.prototype.$onInit=function(){this.currentInstance===this.card.defaultInstance&&(this.collapsed=!0),_.isEmpty(this.instances)||this.currentInstanceSelectorId||(this.currentInstance=_.last(this.instances)),this.objects=this.visualContainer.config.singleVisual.objects,this.updateCardStatus(),this.onUpdateInstance&&this.onUpdateInstance({instance:this.currentInstance})},i.prototype.$onChanges=function(e){if(e.instances){var t=e.instances.currentValue,i=e.instances.previousValue;if(t.length<i.length)if(_.isEmpty(this.instances))this.currentInstanceSelectorId=null;else if(!this.getInstance(t,this.currentInstanceSelectorId)){var r=parseInt(this.currentInstanceSelectorId,10),o=_.filter(this.instances,(function(e){return parseInt(e.selector.id,10)>r}));_.isEmpty(o)?this.currentInstance=_.max(this.instances,(function(e){return parseInt(e.selector.id,10)})):this.currentInstance=_.min(o,(function(e){return parseInt(e.selector.id,10)}))}this.currentInstanceSelectorId||_.isEmpty(this.instances)||(this.currentInstance=_.last(this.instances)),this.onUpdateInstance&&this.onUpdateInstance({instance:this.currentInstance})}this.objects!==this.visualContainer.config.singleVisual.objects&&(this.objects=this.visualContainer.config.singleVisual.objects),this.updateCardStatus()},i.findSlice=function(e,t){return _.find(e.slices,{name:t})},i.prototype.toggleCollapsed=function(){this.collapsed=!this.collapsed,this.updateCardStatus()},i.prototype.setCurrentInstance=function(e){this.currentInstance=e,this.onUpdateInstance&&this.onUpdateInstance({instance:this.currentInstance}),this.updateCardStatus()},i.prototype.getSliceComponentType=function(e){return t.viewModels.PropertyPaneViewModelFactory.getSliceComponentType(e)},i.prototype.save=function(e){var t=this;this.services.undoRedo.register("update slices",(function(){return t.saveAction(e)}))},i.prototype.saveAction=function(t){if(this.inputForm&&this.inputForm[t.name]&&this.inputForm[t.name].$invalid)return!1;var i={};if(this.onSave&&this.onSave({changes:i,slice:t,instance:this.currentInstance}))return this.persistProperties(i);if("revertToDefault"===t.name)return this.revertCurrentInstance(i);var r=t.value,o=e.ValueType.fromDescriptor(t.type),n={objectName:this.card.name,selector:this.currentInstance.selector,properties:{}};return o.text||""!==r||(r=null),null==r?(n.properties[t.name]=r,i.remove||(i.remove=[]),i.remove.push(n)):(n.properties[t.name]=r,i.merge||(i.merge=[]),i.merge.push(n)),this.persistProperties(i)},i.prototype.revertCurrentInstance=function(e){var t={objectName:this.card.name,selector:this.currentInstance.selector,properties:{}};e.remove||(e.remove=[]),e.remove.push(t);for(var i=0,r=this.currentInstance.slices;i<r.length;i++){var o=r[i];"show"!==o.name&&"displayName"!==o.name&&(t.properties[o.name]=null)}return this.persistProperties(e)},i.prototype.persistProperties=function(e){var t=this.visualContainer.config.singleVisual;return!!this.services.visualAuthoring.persistProperties(e,t)&&(this.services.visualAuthoring.raiseVisualContainerChanged(this.visualContainer),!0)},i.nextSelectorId=function(e){var t=_.isEmpty(e)?0:_.max(e);return(t+1).toString()},i.prototype.addInstance=function(){var e=this;this.services.undoRedo.register("add instance",(function(){return e.addInstanceAction()}))},i.prototype.addInstanceAction=function(){this.objects||(this.objects={});var t=this.objects[this.card.name],r=null;if(this.card.supportsUserDefinedInstances){var o=[];if(t)for(var n=0,a=t;n<a.length;n++){var s=a[n];void 0!==s.selector.id&&o.push(parseInt(s.selector.id,10))}r={id:i.nextSelectorId(o)}}var l=this.services.localizationService.format("AnalyticsPane_New_Instance_Default_Format",[this.displayName,this.instances.length+1]),c={displayName:l,selector:r,slices:[]};this.instances.push(c);var u={merge:[{objectName:this.card.name,selector:c.selector,properties:{show:!0}}]};return u=this.changeDisplayName(c,l,u),this.onAddInstance&&this.onAddInstance({changes:u,instance:c}),this.currentInstance=c,"referenceLine"!==this.card.name&&this.services.telemetryService.logEvent(e.telemetry.EXAnalyticsPaneAddInstance,this.card.name),this.persistProperties(u)},i.prototype.removeInstance=function(e){var t=this;this.services.undoRedo.register("remove instance",(function(){return t.removeInstanceAction(e)}))},i.prototype.removeInstanceAction=function(t){var i={removeObject:[{objectName:this.card.name,selector:t.selector,properties:{}}]};return this.onDeleteInstance&&this.onDeleteInstance({instance:t}),"referenceLine"!==this.card.name&&this.services.telemetryService.logEvent(e.telemetry.EXAnalyticsPaneRemoveInstance,this.card.name),this.persistProperties(i)},i.prototype.renameInstance=function(e,t){var i=this;this.services.undoRedo.register("rename instance",(function(){var r=i.changeDisplayName(e,t);return i.persistProperties(r)}))},i.prototype.getInstance=function(e,t){return _.find(this.instances,(function(e){return!e.selector||e.selector.id===t}))},i.prototype.changeDisplayName=function(e,t,i){var r={objectName:this.card.name,selector:e.selector,properties:{displayName:t}};return i||(i={merge:[]}),i.merge||(i.merge=[]),i.merge.push(r),i},i.prototype.updateCardStatus=function(){if(this.currentInstance){var t=!!this.isCardDirty&&this.isCardDirty({property:null,value:null}),r=e.data.DataViewObjectDefinitions.getObjectDefinition(this.objects,this.card.name,this.currentInstance.selector);if(r)for(var o in r.properties){var n=r.properties[o],a=this.isCardDirty?this.isCardDirty({property:o,value:n}):i.isCardDirty(o,n);if(a&&"show"!==o&&"displayName"!==o&&"transform"!==o){t=!0;break}}var s=i.findSlice(this.currentInstance,"revertToDefault");s&&(s.value=t)}},i.isCardDirty=function(e,t){return null!==t},i})();i.AnalyticsCardControllerBase=r;var o=(function(e){function t(t,i){e.call(this),this.services=i}return __extends(t,e),t.createOptions=function(){return{additionalServices:["localizationService","telemetryService"],scopedDependencies:["undoRedo","visualAuthoring"]}},t})(r);i.AnalyticsCardController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.AnalyticsCard={templateUrl:"components/analyticsCard/analyticsCard.html",transclude:!0,bindings:{card:"<",instances:"<",maximumInstances:"<",displayName:"<",visualContainer:"<",onAddInstance:"&",onUpdateInstance:"&",onSave:"&",onDeleteInstance:"&",isCardDirty:"&?"},controller:e.common.Services.createController(t.controllers.AnalyticsCardController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t,this.isEditing=!1}return e.createOptions=function(){return{}},e.prototype.editName=function(){this.isEditing=!0},e.prototype.finishEditing=function(e,t){this.renameInstance({instance:e,name:t}),this.isEditing=!1},e})();e.AnalyticsInstanceSelectorController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.AnalyticsInstanceSelector={templateUrl:"components/analyticsInstanceSelector/analyticsInstanceSelector.html",bindings:{instances:"<",currentInstance:"<",maximumInstances:"<",setCurrentInstance:"&",addInstance:"&",removeInstance:"&",renameInstance:"&"},controller:e.common.Services.createController(t.controllers.AnalyticsInstanceSelectorController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=.5,i=-1,r=(function(){function e(e){this.scope=e}return e.prototype.getRows=function(){var e=this.viewModel&&this.viewModel.rowCount;if(e)return this.rows&&this.rows.length===e||(this.rows=_.range(e)),this.rows},e.prototype.getColumns=function(){var e=this.viewModel&&this.viewModel.columnCount;if(e)return this.columns&&this.columns.length===e||(this.columns=_.range(e)),this.columns},e.getSvgSize=function(e,t){return e&&t?2*e.margin+t*(e.size+e.gutter)-e.gutter:0},e.getBoxLocation=function(e,i){return e?e.margin+i*(e.size+e.gutter)+t:0},e.getBoxSize=function(e){return e?e.size+i:0},e.prototype.getSvgWidth=function(){return this.viewModel?e.getSvgSize(this.viewModel.layout&&this.viewModel.layout.horizontal,this.viewModel.columnCount):0},e.prototype.getSvgHeight=function(){return this.viewModel?e.getSvgSize(this.viewModel.layout&&this.viewModel.layout.vertical,this.viewModel.rowCount):0},e.prototype.getBoxX=function(t){return this.viewModel?e.getBoxLocation(this.viewModel.layout&&this.viewModel.layout.horizontal,t):0},e.prototype.getBoxWidth=function(){return this.viewModel?e.getBoxSize(this.viewModel.layout&&this.viewModel.layout.horizontal):0},e.prototype.getBoxY=function(t){return this.viewModel?e.getBoxLocation(this.viewModel.layout&&this.viewModel.layout.vertical,t):0},e.prototype.getBoxHeight=function(){return this.viewModel?e.getBoxSize(this.viewModel.layout&&this.viewModel.layout.vertical):0},e})();e.BoxGridController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.BoxGrid={templateUrl:"components/boxGrid/boxGrid.html",bindings:{viewModel:"<"},controller:e.common.Services.createController(t.controllers.BoxGridController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.common.ArrowPosition,r=(function(){function e(e,t){this.services=t,this.numberOfClustersPlaceholder=this.services.localizationService.get("ClusteringDialog_NumberOfClustersAutoPlaceholder")}return e.createOptions=function(){return{additionalServices:["$timeout","localizationService","modalDialogService"]}},e.prototype.$onInit=function(){var e=function(e){return 1===e.clusterIds.length&&!_.isNumber(e.clusterIds[0])},t=this.args.partitions;t&&(this.partitionsExtended=_.map(t,(function(t,i){return{uniqueId:i,isBlank:e(t),name:t.name,clusterIds:t.clusterIds,numberOfItems:t.numberOfItems}}))),this.viewModel=this.createViewModel(this.args,this.partitionsExtended)},e.prototype.isGroupingColumnNameEmpty=function(){return!this.viewModel||_.isEmpty(this.viewModel.groupingColumnName)||0===this.viewModel.groupingColumnName.trim().length},e.prototype.canCommit=function(){var e=!this.isGroupingColumnNameEmpty(),t=!!this.viewModel&&!this.viewModel.hasDuplicatePartitionNames,i=!this.clusteringParametersForm||this.clusteringParametersForm.$valid;return e&&t&&i},e.prototype.commit=function(){var e={groupingColumnName:this.viewModel.groupingColumnName.trim(),description:this.viewModel.description,partitions:this.convertToPartitionsInfo(this.viewModel.partitions),numberOfClusters:Number(this.viewModel.numberOfClusters)};this.services.modalDialogService.close(e)},e.prototype.cancel=function(){this.services.modalDialogService.close()},e.prototype.startEditName=function(e,t){e.isEditingName=!0,t.stopPropagation()},e.prototype.cancelEditName=function(e){this.abandonRename(e),event.stopPropagation()},e.prototype.rename=function(e,t){var i=this,r=t?t.trim():"";if(_.isEmpty(r))return void this.abandonRename(e);e.displayName=r;var o=_.filter(this.viewModel.partitions,(function(t){return t!==e&&t.hasNameCollision})),n=[e].concat(o);n.forEach((function(e){var t=i.isNameExisting(e,e.displayName);e.hasNameCollision=t,e.isEditingName=t})),this.setPartitionNameDuplicationStatus()},e.prototype.abandonRename=function(e){var t=this.isNameExisting(e,e.displayName);e.hasNameCollision=t,this.setPartitionNameDuplicationStatus(),e.isEditingName=!1,t&&this.services.$timeout((function(){return e.isEditingName=!0}))},e.prototype.setPartitionNameDuplicationStatus=function(){this.viewModel&&(this.viewModel.hasDuplicatePartitionNames=_.any(this.viewModel.partitions,(function(e){return e.hasNameCollision})))},e.prototype.isNameExisting=function(e,t){return _.any(this.viewModel.partitions,(function(i){return i!==e&&i.displayName===t}))},e.prototype.getTooltipConfig=function(e){return e.isNameEditable?{tooltipDisable:!0}:{tooltipDelay:100,tooltipLocalizeTitle:"ClusteringDialog_NullClusterTooltip",isTooltipForModalDialog:!0,tooltipArrowPosition:i.arrowTopLeft
}},e.prototype.createViewModel=function(e,t){return{groupingColumnName:this.args.groupingColumnName,sourcePropertyName:this.args.sourcePropertyName,description:this.args.description,partitions:this.convertToPartitionNodes(t),numberOfClusters:this.args.numberOfClusters,errorMessage:this.args.errorMessage}},e.prototype.convertToPartitionNodes=function(e){var t=this;if(e){var i=function(e){return e.isBlank},r=function(e){return!e.isBlank},o=function(e){return _.min(e.clusterIds)},n=function(e){return{uniqueId:e.uniqueId,displayName:e.isBlank?t.services.localizationService.get("NullValue"):e.name,numberOfItems:t.services.localizationService.format("ClusteringDialog_NumberOfItems",[e.numberOfItems]),isEditingName:!1,isNameEditable:!e.isBlank}},a=_.chain(e).filter(r).sortBy(o).map(n),s=_.find(e,i);return s&&(a=a.concat(n(s))),a.value()}},e.prototype.convertToPartitionsInfo=function(e){var t=this;if(e)return _.map(e,(function(e){var i=_.find(t.partitionsExtended,(function(t){return t.uniqueId===e.uniqueId}));return{name:i.isBlank?null:e.displayName,clusterIds:i.clusterIds}}))},e})();t.ClusteringDialogController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ClusteringDialog={templateUrl:"components/clusteringDialog/clusteringDialog.html",bindings:{args:"<"},controller:e.common.Services.createController(t.controllers.ClusteringDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.visuals.GradientUtils,r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.selectedOptionsChange=function(e){var t=this.viewModel.gradientSettings,i=e.id;switch(i){case 0:break;case 1:t.minValue=void 0;break;case 3:t.midValue=void 0;break;case 2:t.maxValue=void 0}},e.prototype.updateGradientBar=function(){this.viewModel.gradientBarValue=i.getGradientBarColors(this.viewModel.gradientSettings)},e.prototype.updateDiverging=function(){this.viewModel.gradientSettings.diverging=!this.viewModel.gradientSettings.diverging,this.updateGradientBar()},e.prototype.apply=function(){this.viewModel.gradientSettings.nullStrategy=this.viewModel.nullStrategyOption.stringValue;var e={gradientSettings:this.viewModel.gradientSettings,minimumSelectedId:this.viewModel.minimumSelectedOption&&this.viewModel.minimumSelectedOption.id,centerSelectedId:this.viewModel.centerSelectedOption&&this.viewModel.centerSelectedOption.id,maximumSelectedId:this.viewModel.maximumSelectedOption&&this.viewModel.maximumSelectedOption.id};this.services.modalDialogService.close(e)},e.prototype.cancel=function(){this.services.modalDialogService.close()},e})();t.ConditionalFormattingDialogController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ConditionalFormattingDialog={templateUrl:"components/conditionalFormattingDialog/conditionalFormattingDialog.html",bindings:{viewModel:"<"},controller:e.common.Services.createController(t.controllers.ConditionalFormattingDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=t.util.ConditionalFormattingUtil,n=e.visuals.GradientUtils;!(function(t){function i(e,t,i,o,n,a){var s={viewModel:r(e,t,i,o,a)};return{dialogName:"ConditionalFormattingDialog",definitionTemplateCachePath:"components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",bindings:s,dialogCssClass:"conditionalFormattingDialog"}}function r(t,i,r,d,p){var v=o.getGradientSettings(i.config.singleVisual,p,r)||e.visuals.GradientUtils.getDefaultGradientSettings(),h=n.getGradientBarColors(v),g={baseExprDisplayName:d,gradientSettings:v,gradientBarValue:h,colorPickerType:{fill:{solid:{color:!0}}},minimumSelectOptions:c(t),centerSelectOptions:l(t),maximumSelectOptions:s(t),nullStrategyOptions:u(t)};return a(g),g}function a(t){switch(void 0!==t.gradientSettings.minValue?t.minimumSelectedOption=t.minimumSelectOptions[1]:t.minimumSelectedOption=t.minimumSelectOptions[0],void 0!==t.gradientSettings.maxValue?t.maximumSelectedOption=t.maximumSelectOptions[1]:t.maximumSelectedOption=t.maximumSelectOptions[0],void 0!==t.gradientSettings.midValue?t.centerSelectedOption=t.centerSelectOptions[1]:t.centerSelectedOption=t.centerSelectOptions[0],t.gradientSettings.nullStrategy){case e.NullStrategy.noColor:t.nullStrategyOption=t.nullStrategyOptions[0];break;case e.NullStrategy.specificColor:t.nullStrategyOption=t.nullStrategyOptions[2];break;default:t.nullStrategyOption=t.nullStrategyOptions[1]}}function s(e){return[{id:2,value:e.get("ConditionalFormattingDialog_HighestValue"),disableInput:!0},d(e)]}function l(e){return[{id:3,value:e.get("ConditionalFormattingDialog_MiddleValue"),disableInput:!0},d(e)]}function c(e){return[{id:1,value:e.get("ConditionalFormattingDialog_LowestValue"),disableInput:!0},d(e)]}function u(t){return[{id:0,value:t.get("ConditionalFormattingDialog_FormatNull_NoFormat"),disableInput:!0,stringValue:e.NullStrategy.noColor},{id:1,value:t.get("ConditionalFormattingDialog_FormatNull_AsZero"),disableInput:!0,stringValue:e.NullStrategy.asZero},{id:2,value:t.get("ConditionalFormattingDialog_FormatNull_SpecificColor"),disableInput:!1,stringValue:e.NullStrategy.specificColor}]}function d(e){return{id:0,value:e.get("ConditionalFormattingDialog_Number"),disableInput:!1}}t.createDialog=i,t.createConditionalFormattingDialogViewModel=r})(r=i.ConditionalFormattingDialogViewModelFactory||(i.ConditionalFormattingDialogViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.viewModels.ConditionalFormattingDialogViewModelFactory,o=t.util.ConditionalFormattingUtil,n=e.data.SQExprBuilder,a=t.util.VisualContainerUtils,s=(function(){function t(e,t,i,r,o){this.localizationService=e,this.modalDialogService=t,this.promiseFactory=i,this.telemetryService=r,this.visualAuthoring=o}return t.prototype.show=function(t,i,r,o,n,a){var s=this,l={displayName:r,expr:o,objectRepetition:a,role:i,schema:n,selectName:t.config.singleVisual.query.defn.selectNameOf(o),visual:t},c=this.createDialogDefinition(l),u=this.promiseFactory.defer(),d=this.modalDialogService.showHostModalDialog(c);return u.promise.catch((function(){return d.reject()})),d.then((function(e){e&&s.setConditionalFormatting(l,e),u.resolve(null)})),e.RejectablePromise(u)},t.prototype.createDialogDefinition=function(e){var t={viewModel:r.createConditionalFormattingDialogViewModel(this.localizationService,e.visual,e.expr,e.displayName,e.objectRepetition)};return{dialogName:"ConditionalFormattingDialog",definitionTemplateCachePath:"components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",bindings:t}},t.prototype.setConditionalFormatting=function(t,i){var r=i.gradientSettings,s=t.expr,l=n.selectRef(t.selectName),c=s.getMetadata(t.schema).type,u=o.createFillDefinition(l,r,c);this.visualAuthoring.addConditionalFormatting(t.visual,t.objectRepetition,s,u);var d=0===i.minimumSelectedId||0===i.centerSelectedId||0===i.maximumSelectedId;this.telemetryService.logEvent(e.telemetry.EXSetConditionalFormatting,a.getVisualType(t.visual),r.diverging,d)},t})();i.ConditionalFormattingDialogBuilder=s})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["overlayService"]}},e.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){if(_.isNumber(e.ngModel.$viewValue)){var t=new Date(e.ngModel.$viewValue);"Invalid Date"!==t.toString()?e.ngModel.$setViewValue(t):e.ngModel.$setViewValue(void 0)}else void 0===e.ngModel.$viewValue?(e.textVal=void 0,e.dateVal=void 0,e.inputInvalid=!1):e.inputInvalid||(e.dateVal=e.ngModel.$viewValue,e.textVal=e.ngModel.$viewValue.toLocaleDateString()+" "+e.ngModel.$viewValue.toLocaleTimeString())}},e.prototype.$onChanges=function(e){e&&e.validators&&void 0!==this.textVal&&this.validateTextInput()},e.prototype.dateSelected=function(){this.inputInvalid=!1,this.textVal=this.dateVal.toLocaleDateString()+" "+this.dateVal.toLocaleTimeString(),this.ngModel.$setViewValue(this.dateVal),this.services.overlayService.hideAllDropdowns()},e.prototype.dateTextUpdated=function(){this.validateTextInput(),this.inputInvalid||this.ngModel.$setViewValue(this.dateVal)},e.prototype.validateTextInput=function(){if(this.textVal){var e=new Date(this.textVal);this.inputInvalid="Invalid Date"===e.toString()||e<this.validators.min||e>this.validators.max,this.inputInvalid||(this.dateVal=e)}else this.textVal=void 0,this.dateVal=void 0,this.inputInvalid=!1},e})();e.DateTimePickerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.DateTimePicker={templateUrl:"components/dateTimePicker/dateTimePicker.html",bindings:{placeholder:"<",validators:"<"},require:{ngModel:"ngModel"},controller:e.common.Services.createController(t.controllers.DateTimePickerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){e.DotGrid={templateUrl:"components/dotGrid/dotGrid.html",bindings:{viewModel:"<"},controller:["$scope","$element",function(t,i){return new e.DotGridController(t,i)}]};var t;!(function(e){function t(e,t){return e===t||e&&t&&e.UnitLength===t.UnitLength&&e.UnitDivisions===t.UnitDivisions}function i(e,t){for(var i=$("<canvas></canvas>").attr({width:e.UnitLength,height:t.UnitLength}).get(0),r=i.getContext("2d"),o=0;o<e.UnitDivisions;++o){var n=Math.round(o*e.UnitLength/e.UnitDivisions);r.fillRect(n,0,1,1)}for(var o=1;o<t.UnitDivisions;++o){var a=Math.round(o*t.UnitLength/t.UnitDivisions);r.fillRect(0,a,1,1)}return i}function r(t,i){var r=t/(i/e.CanvasLayout.UnitLength);r=Math.floor(r);var o=_.find(a,(function(t){return 1===t||r/t>=e.MinimumUnitDivisionLength}));return{UnitLength:r,UnitDivisions:o}}function o(e,t){return{x:n(e.x,t.width),y:n(e.y,t.height)}}function n(t,i){var r=e.getLayoutForScreen(t*i,i),o=r.UnitLength/e.CanvasLayout.UnitLength,n=e.getLayoutForScreen(o*i,i),a=n.UnitLength/e.CanvasLayout.UnitLength;return a}e.sameLayout=t,e.drawGridUnit=i,e.CanvasLayout={UnitLength:96,UnitDivisions:12};var a=[12,6,4,3,2,1];e.MinimumUnitDivisionLength=8,e.getLayoutForScreen=r,e.adjustScaleForGrid=o})(t=e.DotGridComponent||(e.DotGridComponent={}))})(t=e.components||(e.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.components.DotGridComponent,r=(function(){function e(e,t){this.background=t.find(".background")}return e.prototype.$onInit=function(){this.viewModel&&this.onViewModelChange()},e.prototype.$onChanges=function(e){e.viewModel&&this.onViewModelChange()},e.prototype.onViewModelChange=function(){var e=i.drawGridUnit(this.viewModel.layoutX,this.viewModel.layoutY),t=e.toDataURL("image/png");this.background.css("background-image","url("+t+")")},e})();t.DotGridController=r})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.renameSection,(function(e,t){return i.renameSection(t)}))}return e.createOptions=function(){return{additionalServices:["linguisticSchemaProxy"],scopedDependencies:["eventBridge","formFactor","undoRedo","viewModeState"]}},e.prototype.createSection=function(){this.services.eventBridge.publishToChannel(r.createSection)},e.prototype.isEditMode=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canAddRemoveSections()},e.prototype.getModeString=function(){return this.isEditMode()?"editing":0===this.services.viewModeState.getMode()?"reading":""},e.prototype.renameSection=function(e){var i=this,o=this.viewModel.exploration.contract;this.services.undoRedo.register("RenameNavigationTab",(function(){var n=o.sections[e.sectionIndex].name;t.SectionUtils.renameSection(i.viewModel,e.sectionNewName,e.sectionIndex),t.PodUtils.updateLinguisticPrimaryName(o,n,e.sectionNewName,i.services.linguisticSchemaProxy).then((function(){var t={sectionName:e.sectionNewName,sectionIndex:e.sectionIndex};i.services.eventBridge.publishToChannel(r.sectionNameChanged,t)}))}))},e})();i.ExplorationFooterController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.ExplorationFooter={templateUrl:"components/explorationFooter/explorationFooter.html",bindings:{viewModel:"<"},controller:e.common.Services.createController(e.explore.controllers.ExplorationFooterController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.DataViewObjectDefinitions,n=e.data.SQExpr,a=t.util.VisualContainerUtils,s=e.visuals.forecastUnits,l=e.visuals.forecastConfidenceIntervals;!(function(e){e.forecastName="Forecast",e.unitsSliceName="units",e.forecastDataPointsSliceName="forecastDataPoints",e.ignoreDataPointsSliceName="ignoreDataPoints",e.confidenceIntervalSliceName="confidenceInterval",e.seasonalitySliceName="seasonality"})(r||(r={}));var c=(function(){function c(e,t){this.services=t;var i=s.type.members();this.units=this.getSelectionOptions(i),this.defaultParameterValues=(o={},o[r.unitsSliceName]=s.point,o[r.forecastDataPointsSliceName]=10,o[r.ignoreDataPointsSliceName]=0,o[r.confidenceIntervalSliceName]=l.ninetyFive,o[r.seasonalitySliceName]=void 0,o),this.parameterSlices=(n={},n[r.unitsSliceName]={name:"Unit",value:this.defaultParameterValues[r.unitsSliceName],selectionOptions:this.units,type:{enumeration:s.type}},n[r.forecastDataPointsSliceName]={name:"ForecastLength",value:this.defaultParameterValues[r.forecastDataPointsSliceName],type:{numeric:!0},validators:{decimal:!0,min:1,max:2e9,integer:!0},tooltipConfig:{tooltipTitle:this.services.localizationService.get("Visual_Forecast_Parameter_ForecastLength"),tooltipDescription:this.services.localizationService.get("Visual_Forecast_Parameter_ForecastLength_Description")}},n[r.ignoreDataPointsSliceName]={name:"IgnoreLast",value:this.defaultParameterValues[r.ignoreDataPointsSliceName],type:{numeric:!0},validators:{decimal:!0,min:0,max:500,integer:!0},tooltipConfig:{tooltipTitle:this.services.localizationService.get("Visual_Forecast_Parameter_IgnoreLength"),tooltipDescription:this.services.localizationService.get("Visual_Forecast_Parameter_IgnoreLength_Description")}},n[r.confidenceIntervalSliceName]={name:"ConfidenceLevel",value:this.defaultParameterValues[r.confidenceIntervalSliceName],selectionOptions:this.getSelectionOptions(l.type.members()),type:{enumeration:l.type},tooltipConfig:{tooltipTitle:this.services.localizationService.get("Visual_Forecast_Parameter_ConfidenceInterval"),tooltipDescription:this.services.localizationService.get("Visual_Forecast_Parameter_ConfidenceInterval_Description")}},n[r.seasonalitySliceName]={name:"MaxSeasonality",value:this.defaultParameterValues[r.seasonalitySliceName],type:{numeric:!0},placeholder:this.services.localizationService.get("Visual_Forecast_Seasonality_Auto"),validators:{decimal:!0,min:1,max:2e9,integer:!0},tooltipConfig:{tooltipTitle:this.services.localizationService.get("Visual_Forecast_Parameter_Seasonality"),tooltipDescription:this.services.localizationService.get("Visual_Forecast_Parameter_Seasonality_Description")}},n),this.unitsMap=this.mapUnitsEnumStringsToNumbers(i);var o,n}return c.createOptions=function(){return{additionalServices:["transformPluginService","localizationService","conceptualSchemaProxy","telemetryService"],scopedDependencies:["dataSources","undoRedo","visualAuthoring","visualPlugin"]}},c.prototype.onAddInstance=function(t,i){this.currentInstance=i;var o=this.getTransformParameters(),n=this.services.transformPluginService.getTransformPlugin(r.forecastName),a=_.find(t.merge,(function(t){return e.data.Selector.equals(t.selector,i.selector)}));i.selector.metadata=this.getBoundMeasure(),a.properties.transform={algorithm:n.name,parameters:o},this.updateParameterValues()},c.prototype.onUpdateInstance=function(e){this.currentInstance=e,this.updateParameterValues()},c.prototype.onSave=function(e,t){if("revertToDefault"===t.name)return this.updateParameterValues(!0),!1},c.prototype.saveForecastParameters=function(){var e=this;this.services.undoRedo.register("save forecast",(function(){return e.saveForecastParametersAction()}))},c.prototype.saveForecastParametersAction=function(){var t=this,i=this.getForecastTransform();if(!i)return!1;var o=_.find(i.parameters,(function(e){return e.name===t.parameterSlices[r.seasonalitySliceName].name})),n=o?this.getParameterValueFromObjects(o,r.seasonalitySliceName):void 0,a=this.parameterSlices[r.seasonalitySliceName].value;this.hasValueChanged(n,a)&&this.services.telemetryService.logEvent(e.telemetry.EXAnalyticsPaneForecastParameterUpdated,!0);var s={merge:[{objectName:"forecast",selector:this.currentInstance.selector,properties:{transform:{algorithm:i.algorithm,parameters:this.getTransformParameters()}}}]};return this.services.visualAuthoring.persistProperties(s,this.visualContainer.config.singleVisual),this.services.visualAuthoring.raiseVisualContainerChanged(this.visualContainer),!0},c.prototype.getSliceComponentType=function(e){return t.viewModels.PropertyPaneViewModelFactory.getSliceComponentType(e)},c.prototype.isDisabled=function(){return!this.getForecastTransform()},c.prototype.onUnitsUpdated=function(){var e=this,t=_.find(this.units,(function(t){return e.parameterSlices[r.unitsSliceName].value===t.value}));t&&(this.currentSelectedUnit=t.displayName)},c.prototype.isCardDirty=function(e,t){if(!e||!t){var r=!1;for(var o in this.parameterSlices)if(this.parameterSlices[o].value!==this.defaultParameterValues[o]){r=!0;break}return r}return i.AnalyticsCardControllerBase.isCardDirty(e,t)},c.prototype.haveParametersChanged=function(){var e=this,t=this.getForecastTransform();if(!t)return!1;var i=function(i){var o=_.find(t.parameters,(function(t){return t.name===e.parameterSlices[i].name})),n=r.getParameterValueFromObjects(o,i),a=r.parameterSlices[i].value;if(r.hasValueChanged(n,a))return{value:!0}},r=this;for(var o in this.parameterSlices){var n=i(o);if("object"==typeof n)return n.value}return!1},c.prototype.hasValueChanged=function(e,t){return e&&(e=e.toString()),t&&(t=t.toString()),e!==t},c.prototype.getBoundMeasure=function(){var e=this.visualContainer;if(!(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query))return"";for(var t=e.config.singleVisual,i=a.getDataRolesForVisual(e,this.services.visualPlugin)||[],r=0,o=i;r<o.length;r++){var s=o[r];if(1===s.cartesianKind)for(var l=t.query.tryGetExprs(s.name)||[],c=function(e){var i=t.query.defn.select(),r=_.find(i,(function(t){return n.equals(e,t.expr)}));if(r)return{value:r.name}},u=0,d=l;u<d.length;u++){var p=d[u],v=c(p);if("object"==typeof v)return v.value}}return""},c.prototype.updateParameterValues=function(e){var t=this;this.getConceptualSchema(this.visualContainer).then((function(i){if(t.visualContainer===i.visualContainer){var o=t.getForecastTransform(),n=function(n){var a=t.parameterSlices[n],s=void 0;o&&(s=_.find(o.parameters,(function(e){return e.name===a.name}))),s&&!e?(a.value=t.getParameterValueFromObjects(s,n),n===r.unitsSliceName&&t.updatePossibleUnits(i.schema)):a.value=t.defaultParameterValues[n]};for(var a in t.parameterSlices)n(a);t.onUnitsUpdated(),e&&t.saveForecastParametersAction()}}))},c.prototype.getParameterValueFromObjects=function(e,t){if(e&&e.expr){var i=e.expr.value;return t===r.unitsSliceName?i=this.getUnitsEnumValue(i):t===r.confidenceIntervalSliceName&&(i=this.getConfidenceIntervalEnumValue(i)),i}},c.prototype.updatePossibleUnits=function(t){var i=this.visualContainer.config.singleVisual,o=this.services.visualPlugin.capabilities(i.visualType),n=_.find(o.dataRoles,(function(e){return 0===e.cartesianKind})),a=!1,l=!1;if(n){var c=i.query.defn.select(),u=i.query.projections,d=n.name;if(!u[d])return;for(var p=u[d].all(),v=function(e){var i=_.find(c,(function(t){return e.queryRef===t.name})),r=i.expr.getMetadata(t);a=a||r.type.dateTime},h=0,g=p;h<g.length;h++){var f=g[h];v(f)}l=e.data.ScalarKeyUtils.isScalarKeySupportedForRole(t,i.query.defn,i.query.projections,d)}a||l?this.parameterSlices[r.unitsSliceName].selectionOptions=this.getSelectionOptions(s.type.members()):(this.parameterSlices[r.unitsSliceName].selectionOptions=[_.last(this.getSelectionOptions(s.type.members()))],this.parameterSlices[r.unitsSliceName].value=this.defaultParameterValues[r.unitsSliceName])},c.prototype.getForecastTransform=function(){var e=this.visualContainer.config.singleVisual;if(e&&this.currentInstance)return o.getValue(e.objects,{objectName:"forecast",propertyName:"transform"},this.currentInstance.selector)},c.prototype.getTransformParameters=function(){var e=[];for(var t in this.parameterSlices){var i=this.parameterSlices[t].value;switch(t){case r.forecastDataPointsSliceName:case r.ignoreDataPointsSliceName:_.isFinite(parseInt(i,10))||(i=this.defaultParameterValues[t]);break;case r.unitsSliceName:i=this.getUnitsQueryValue(i);break;case r.confidenceIntervalSliceName:i=this.getConfidenceIntervalQueryValue(i);break;case r.seasonalitySliceName:if(!_.isFinite(parseInt(i,10)))continue}var n=this.parameterSlices[t].type,a=o.encodePropertyValue(i,n);e.push({name:this.parameterSlices[t].name,expr:a})}return e},c.prototype.getSelectionOptions=function(e){return _.map(e,(function(e){return{value:e.value,displayName:t.viewModels.ViewModelFactory.getDisplayName(e.displayName)}}))},c.prototype.getConceptualSchema=function(e){var t=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(t).then((function(t){return{schema:t,visualContainer:e}}))},c.prototype.mapUnitsEnumStringsToNumbers=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].value]=i;return t},c.prototype.getUnitsQueryValue=function(e){return this.unitsMap[e]},c.prototype.getUnitsEnumValue=function(e){var t=this;return _.find(_.keys(this.unitsMap),(function(i){return t.unitsMap[i]===e}))},c.prototype.getConfidenceIntervalQueryValue=function(e){return parseFloat(e)/100},c.prototype.getConfidenceIntervalEnumValue=function(e){return 100*e+"%"},c})();i.ForecastCardController=c})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ForecastCard={templateUrl:"components/forecastCard/forecastCard.html",bindings:{card:"<",displayName:"<",visualContainer:"<",instances:"<"},controller:e.common.Services.createController(t.controllers.ForecastCardController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.services.events,r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{scopedDependencies:["eventBridge","explorationNavigation","formFactor"]}},e.prototype.$onInit=function(){var e=this;this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.viewport={width:106,height:106},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(i.canvasChanged,(function(){return e.updateVisuals()})).subscribe(i.formFactorChanged,(function(){return e.updateVisuals()})),this.updateVisuals()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.updateVisuals=function(){var e=this.services.explorationNavigation.getCurrentSection(),t=this.services.formFactor.getCurrentLayout();this.visuals=e.visualContainers.filter((function(e){return!e.layouts.withId(t)}))},e})();t.MobileVisualizationPaneController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.MobileVisualizationPane={templateUrl:"components/mobileVisualizationPane/mobileVisualizationPane.html",bindings:{},controller:e.common.Services.createController(t.controllers.MobileVisualizationPaneController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){}return e.prototype.$onInit=function(){var e=this;this.ngModel.$render=function(){var t=e.ngModel.$viewValue;e.modelVal=t.value,e.unitVal=t.unitOfMeasurement}},e.prototype.onValueChanged=function(){var e=this.modelVal;if(!isNaN(e)){var t={value:e,unitOfMeasurement:this.unitVal};this.ngModel.$setViewValue(t)}},e})();e.NumericUnitSelectionController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.NumericUnitSelection={templateUrl:"components/numericUnitSelection/numericUnitSelection.html",bindings:{unitOptions:"<",validators:"<",inputName:"<"},require:{ngModel:"ngModel"},controller:e.common.Services.createController(t.controllers.NumericUnitSelectionController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=(function(){function e(e,t){var i=this;this.services=t,this.expandedCards={},this.propertySliceSaveServices={explorationNavigation:this.services.explorationNavigation,featureSwitchService:this.services.featureSwitchService,resourceRegistration:this.services.resourceRegistration,visualStylePresetService:this.services.visualStylePresetService,themeService:this.services.themeService},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.canvasChanged,(function(){return i.updatePagePropertyPane()})).subscribe(r.sectionNameChanged,(function(e,t){return i.updatePagePropertyPane()})),this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.createViewModel().then((function(e){i.viewModel=e}))}return e.createOptions=function(){return{additionalServices:["featureSwitchService","linguisticSchemaProxy","localizationService","promiseFactory","$timeout","themeService","visualStylePresetService"],scopedDependencies:["canvasScale","dataSources","eventBridge","explorationNavigation","resourceRegistration","undoRedo"]}},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.expandCard=function(e){this.expandedCards[e]=!this.expandedCards[e]},e.prototype.isAvailable=function(){return this.viewModel&&(!this.viewModel.cards||0===this.viewModel.cards.length)},e.prototype.isCardExpanded=function(e){return this.expandedCards[e]},e.prototype.save=function(e,i){var o=this,n=this.services.explorationNavigation.getCurrentExploration(),a=this.services.explorationNavigation.getCurrentSection(),s=a.size,l=this.services.canvasScale.getDisplayOption();if(e.name===t.viewModels.PagePropertyPaneViewModelFactory.PageInformationName)if(e.value){var c={sectionNewName:e.value,sectionIndex:_.indexOf(n.sections,a)};this.services.eventBridge.publishToChannel(r.renameSection,c)}else e.value=a.displayName;else if(e.name===t.viewModels.PagePropertyPaneViewModelFactory.PageInformationPodEnabled)e.value?this.services.undoRedo.register("ReportPagePodEnabled",(function(){t.PodUtils.ensurePod(n,a,o.services.linguisticSchemaProxy).then((function(){return o.updatePagePropertyPane()}))})):this.services.undoRedo.register("ReportPagePodDisabled",(function(){t.PodUtils.deletePod(n,a.name,o.services.linguisticSchemaProxy),o.updatePagePropertyPane()}));else if(e.name===t.viewModels.PagePropertyPaneViewModelFactory.PageInformationAltName){var u=e.value.split(",").map((function(e){return e.trim()})).filter((function(e){return!_.isEmpty(e)}));this.services.undoRedo.register("UpdateLinguisticAltNames",(function(){t.PodUtils.updateLinguisticAltNames(n,a,u,o.services.linguisticSchemaProxy),o.updatePagePropertyPane()}))}else if(e.name===t.viewModels.PagePropertyPaneViewModelFactory.PageSizeTypeName){var d=t.viewModels.PagePropertyPaneViewModelFactory.convertPageSizeType(e.value),p=_.find(i.slices,(function(e){return e.name===t.viewModels.PagePropertyPaneViewModelFactory.PageSizeWidthName})),v=_.find(i.slices,(function(e){return e.name===t.viewModels.PagePropertyPaneViewModelFactory.PageSizeHeightName}));e.value===t.viewModels.PagePropertyPaneViewModelFactory.PageSizeTypes.Custom?0!==l&&(d=s):(p.value.value=d.width,v.value.value=d.height),this.services.eventBridge.publishToChannel(r.canvasDimensionChanged,d),p.isDisabled=v.isDisabled=e.value!==t.viewModels.PagePropertyPaneViewModelFactory.PageSizeTypes.Custom}else if(e.name===t.viewModels.PagePropertyPaneViewModelFactory.PageSizeWidthName)this.services.eventBridge.publishToChannel(r.canvasDimensionChanged,{width:parseInt(e.value.value,10),height:s.height,displayOption:l});else if(e.name===t.viewModels.PagePropertyPaneViewModelFactory.PageSizeHeightName)this.services.eventBridge.publishToChannel(r.canvasDimensionChanged,{width:s.width,height:parseInt(e.value.value,10),displayOption:l});else if(i.name===t.viewModels.PagePropertyPaneViewModelFactory.PageBackgroundCardName){var h=a.objects||{};t.viewModels.VisualCapabilitiesSliceFactoryHelper.saveSliceToDefinition(i.name,e,h,this.propertySliceSaveServices),a.objects=h,this.services.eventBridge.publishToChannel(r.canvasBackgroundChanged,a),this.updatePagePropertyPane()}},e.prototype.createViewModel=function(){var e=this.services.explorationNavigation.getCurrentSection();return t.viewModels.PagePropertyPaneViewModelFactory.populatePaneForPage(e,this.services.localizationService,this.services.linguisticSchemaProxy,this.services.explorationNavigation,this.services.promiseFactory)},e.prototype.updatePagePropertyPane=function(){var e=this;this.createViewModel().then((function(t){e.viewModel=t}))},e})();i.PagePropertyPaneController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PagePropertyPane={templateUrl:"components/pagePropertyPane/pagePropertyPane.html",controller:e.common.Services.createController(t.controllers.PagePropertyPaneController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=jsCommon.ArrayExtensions,n=e.explore.contracts,a=e.data.DataViewObjectDefinitions,s=e.data.DataViewObjectEvaluator;!(function(r){function l(e,t,i,r,o){var n=c();return p(n,t,i,r,e.name,e.displayName),d(e,n,t),v(n,e,o,t)}function c(){return{cards:o.createWithName()}}function u(e,t){var i=h(e.size),o=[{value:r.PageSizeTypes.Widescreen,displayName:t.get("PagePropertyPane_PageSizeType_Widescreen")},{value:r.PageSizeTypes.Standard,displayName:t.get("PagePropertyPane_PageSizeType_Standard")},{value:r.PageSizeTypes.Cortana,displayName:t.get("PagePropertyPane_PageSizeType_Cortana")},{value:r.PageSizeTypes.Letter,displayName:t.get("PagePropertyPane_PageSizeType_Letter")},{value:r.PageSizeTypes.Custom,displayName:t.get("PagePropertyPane_PageSizeType_Custom")}];i===r.PageSizeTypes.Dynamic&&o.unshift({value:r.PageSizeTypes.Dynamic,displayName:t.get("PagePropertyPane_PageSizeType_Dynamic")});var n={name:r.PageSizeTypeName,displayName:t.get("PagePropertyPane_PageSizeType"),
type:{},value:h(e.size),show:!0,placeholder:"",isDisabled:!1,isValid:!0,selectionOptions:o};return n}function d(e,t,i){var o=t.cards.withName(r.PageSizeCardName);if(!o){o={name:r.PageSizeCardName,id:r.PageSizeCardName,displayName:i.get("PagePropertyPane_PageSize"),header:[],slices:jsCommon.ArrayExtensions.createWithName(),footer:[],mainShow:null,isDirty:!1},t.cards.push(o);var n=u(e,i);o.slices.push(n);var a={name:r.PageSizeWidthName,displayName:i.get("PagePropertyPane_PageSizeWidth"),type:{numericUnitSelection:!0},value:{value:e.size.width,unitOfMeasurement:r.PageSizeUnits.Pixels},show:!0,placeholder:"",isDisabled:n.value!==r.PageSizeTypes.Custom,isValid:!0,selectionOptions:[{value:r.PageSizeUnits.Pixels,displayName:i.get("PagePropertyPane_PageSizeUnit_Pixel")}],validators:{min:f,max:m}};o.slices.push(a);var s={name:r.PageSizeHeightName,displayName:i.get("PagePropertyPane_PageSizeHeight"),type:{numericUnitSelection:!0},value:{value:e.size.height,unitOfMeasurement:r.PageSizeUnits.Pixels},show:!0,placeholder:"",isDisabled:n.value!==r.PageSizeTypes.Custom,isValid:!0,selectionOptions:[{value:r.PageSizeUnits.Pixels,displayName:i.get("PagePropertyPane_PageSizeUnit_Pixel")}],validators:{min:f,max:m}};o.slices.push(s)}}function p(e,i,o,n,a,s){var l=e.cards.withName(r.PageInformationCardName);if(!l){l={name:r.PageInformationCardName,id:r.PageInformationCardName,displayName:i.get("PagePropertyPane_PageInformation"),header:[],slices:jsCommon.ArrayExtensions.createWithName(),footer:[],mainShow:null,isDirty:!1},e.cards.push(l);var c={name:r.PageInformationName,displayName:i.get("PagePropertyPane_PageInformation_Name"),type:{text:!0},selector:null,value:s,show:!0,placeholder:"",isValid:!0,isDisabled:!1};l.slices.push(c);var u=n.getCurrentExploration();t.PodUtils.getLinguisticMetadata(u,a,o).then((function(e){var t={name:r.PageInformationPodEnabled,displayName:i.get("PagePropertyPane_PageInformation_PodEnabled"),type:{bool:!0},selector:null,value:!!e,show:!0,description:i.get("PagePropertyPane_PageInformation_PodEnabled_Description"),placeholder:"",isValid:!0,isDisabled:!1};if(l.slices.push(t),e){var o={name:r.PageInformationAltName,displayName:void 0,type:{textarea:!0},selector:null,value:e.altNames?e.altNames.join(", "):"",show:!0,placeholder:i.get("PagePropertyPane_PageInformation_AltName_Placeholder"),isValid:!0,isDisabled:!1};l.slices.push(o)}}))}}function v(o,l,c,u){var d={objectDefinitions:l.objects,objectDescriptors:n.Section.objectDescriptors,promiseFactory:c,enumerateObjectInstances:function(i){if(i!==r.PageBackgroundCardName)return null;var o=l.objects&&a.getObjectDefinition(l.objects,r.PageBackgroundCardName,null),c=o&&s.run(e.data.createStaticEvalContext(),n.Section.objectDescriptors[r.PageBackgroundCardName],o.properties),u={selector:null,properties:{color:e.DataViewObject.getFillColorByPropertyName(c,"color",t.constants.ExploreCanvasConstants.DefaultCanvasBackgroundColor),transparency:c&&c.transparency?c.transparency:t.constants.ExploreCanvasConstants.DefaultCanvasBackgroundTransparency},objectName:r.PageBackgroundCardName,validValues:{imageFit:[e.visuals.imageScalingType.normal,e.visuals.imageScalingType.fit,e.visuals.imageScalingType.fill]}};return u.properties.image=c&&c.image,[u]},dirtyCards:{},localizationService:u};return i.PropertyPaneViewModelFactory.populatePane(o,d)}function h(e){return 0===e.displayOption?r.PageSizeTypes.Dynamic:e.width===t.constants.ExploreCanvasConstants.DefaultCanvasWidth&&e.height===t.constants.ExploreCanvasConstants.DefaultCanvasHeight?r.PageSizeTypes.Standard:e.width===t.constants.ExploreCanvasConstants.DefaultWidescreenWidth&&e.height===t.constants.ExploreCanvasConstants.DefaultWidescreenHeight?r.PageSizeTypes.Widescreen:e.width===t.constants.ExploreCanvasConstants.DefaultCortanaWidth&&e.height===t.constants.ExploreCanvasConstants.DefaultCortanaHeight?r.PageSizeTypes.Cortana:e.width===t.constants.ExploreCanvasConstants.DefaultLetterWidth&&e.height===t.constants.ExploreCanvasConstants.DefaultLetterHeight?r.PageSizeTypes.Letter:r.PageSizeTypes.Custom}function g(e){var t=y[e];return{displayOption:t.displayOption,width:t.width,height:t.height}}r.PageSizeCardName="PageSize",r.PageSizeTypeName="PageSizeTypes",r.PageSizeWidthName="PageSizeWidth",r.PageSizeHeightName="PageSizeHeight",r.PageBackgroundColor="color",r.PageInformationCardName="PageInformation",r.PageInformationName="PageInformationName",r.PageInformationPodEnabled="PageInformationPodEnabled",r.PageInformationAltName="PageInformationAltName",r.PageBackgroundImage="image",r.PageBackgroundTransparency="transparency",r.PageBackgroundRevertToDefault="revertToDefault",r.PageBackgroundCardName="background",r.PageSizeTypes={Dynamic:"Dynamic",Standard:"Standard",Widescreen:"Widescreen",Cortana:"Cortana",Letter:"Letter",Custom:"Custom"},r.PageSizeUnits={Pixels:"px"};var f=1,m=9999,y=(w={},w[r.PageSizeTypes.Dynamic]={displayOption:0,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},w[r.PageSizeTypes.Standard]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},w[r.PageSizeTypes.Widescreen]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultWidescreenWidth,height:t.constants.ExploreCanvasConstants.DefaultWidescreenHeight},w[r.PageSizeTypes.Cortana]={displayOption:3,width:t.constants.ExploreCanvasConstants.DefaultCortanaWidth,height:t.constants.ExploreCanvasConstants.DefaultCortanaHeight},w[r.PageSizeTypes.Letter]={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultLetterWidth,height:t.constants.ExploreCanvasConstants.DefaultLetterHeight},w[r.PageSizeTypes.Custom]={displayOption:3,width:t.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:t.constants.ExploreCanvasConstants.DefaultCanvasHeight},w);r.populatePaneForPage=l,r.getPageSizeType=h,r.convertPageSizeType=g;var w})(r=i.PagePropertyPaneViewModelFactory||(i.PagePropertyPaneViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=jsCommon.EnumExtensions,r=e.explore.services.events,o=(function(){function e(e,t){var i=this;this.isExpanded=!1,this.services=t,this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})),this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1}}return e.createOptions=function(){return{scopedDependencies:["includeExcludeService","eventBridge","visualAuthoring"]}},e.prototype.$onInit=function(){this.updateViewModel()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.expand=function(){this.isExpanded=!this.isExpanded},e.prototype.deleteFilter=function(e){var t=this.filterViewModel.getFilterContainerScope();this.services.visualAuthoring.removeFilter(this.filterViewModel.contract,t),e.stopPropagation()},e.prototype.delete=function(e,t,i){return 1===this.viewModel.points.length?void this.deleteFilter(e):(this.viewModel.points.splice(i,1),this.services.includeExcludeService.updateFilterContainer(this.filterViewModel,this.viewModel),void e.stopPropagation())},e.prototype.updateViewModel=function(){var e=this.filterViewModel.contract;this.viewModel=this.services.includeExcludeService.buildViewModel(e.filter,e.type)},e.prototype.onFilterContainerChanged=function(e){e.filter===this.filterViewModel.contract&&i.hasFlag(e.changeType,2)&&this.updateViewModel()},e})();t.IncludeExcludeFilterController=o})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.IncludeExcludeFilter={templateUrl:"components/includeExcludeFilter/includeExcludeFilter.html",controller:e.common.Services.createController(t.IncludeExcludeFilterController),bindings:{filterViewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.annotations=e}return e.prototype.clear=function(){this.annotations=[]},e.prototype.length=function(){return this.annotations.length},e.prototype.removeAt=function(e){this.annotations.splice(e,1)},e.prototype.getAnnotation=function(e){return this.annotations[e]},e.prototype.takeAll=function(){return _.take(this.annotations,this.annotations.length)},e.prototype.push=function(e){this.annotations.push(e)},e.prototype.eraseAnnotations=function(e,t){var i=this.annotations.length;return _.remove(this.annotations,(function(i){return i.polygon.lineIntersectionPoint(e,t)})),i-this.annotations.length},e})();e.AnnotationsList=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.viewModels.AnnotationsList,r=e.explore.services.events,o=e.visuals.shapes.Polygon,n="pen",a=5,s=10,l=(function(){function e(e,t){var i=this;this.services=t,this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionChanged,(function(){return i.invalidateAnnotations()})).subscribe(r.clearAnnotations,(function(){return i.clearAnnotations()})),this.pensAnnotationsDataHelper=new c,this.penAnnotationDrawer=new u(this.services.$element);var o=function(e){i.onPointerDown(e)},n=function(e){i.onPointerMove(e)},a=function(e){i.onPointerUp(e)};interact.on("pointerdown",o),interact.on("pointermove",n),interact.on("pointerup",a),e.$on("$destroy",(function(){interact.off("pointerdown",o),interact.off("pointermove",n),interact.off("pointerup",a),i.clearAnnotationsFromExploration()})),this.resetViewModel()}return e.createOptions=function(){return{scopedDependencies:["eventBridge","explorationNavigation","layoutAuthoring","viewModeState"],additionalServices:["$element"]}},e.prototype.eraseAnnotations=function(e,t){this.viewModel.annotationsList.eraseAnnotations(t,e)>0&&(this.penAnnotationDrawer.redrawAnnotations(this.viewModel),this.persistOnSection(this.viewModel.annotationsList.takeAll()))},e.prototype.onPointerDown=function(e){if(e.pointerType===n){this.penAnnotationDrawer.validateRectPos(this.viewModel.annotationsList.length());var t=this.penAnnotationDrawer.convertToCanvasPosition(e.pageX,e.pageY),i=this.isEraseEvent(e)?2:1;switch(this.pensAnnotationsDataHelper.createPenAnnotationData(e.pointerId,i),i){case 1:this.pensAnnotationsDataHelper.addPoint(e.pointerId,t),this.viewModel.currentAnnotations[e.pointerId]=this.createPenAnnotationCurve(e.pointerId);break;case 2:this.erasePrevPoint=t,this.eraseAnnotations(t,this.erasePrevPoint)}}},e.prototype.onPointerMove=function(e){if(e.pointerType===n){var t=this.penAnnotationDrawer.convertToCanvasPosition(e.pageX,e.pageY),i=this.pensAnnotationsDataHelper.getAnnotationMode(e.pointerId);switch(i){case 1:this.pensAnnotationsDataHelper.addPoint(e.pointerId,t);var r=this.viewModel.currentAnnotations[e.pointerId];r&&(r.polygon=this.createPolygon(e.pointerId)),this.drawAnnotationAddedPoints(r);break;case 2:this.eraseAnnotations(t,this.erasePrevPoint),this.erasePrevPoint=t}}},e.prototype.onPointerUp=function(e){if(e.pointerType===n){var t=this.pensAnnotationsDataHelper.getAnnotationMode(e.pointerId);switch(t){case 1:var i=this.viewModel.currentAnnotations[e.pointerId];i&&(i.polygon.polygonPoints.length>=s&&(this.viewModel.annotationsList.push(i),this.persistOnSection(this.viewModel.annotationsList.takeAll())),delete this.viewModel.currentAnnotations[e.pointerId])}this.pensAnnotationsDataHelper.remove(e.pointerId)}},e.prototype.drawAnnotationAddedPoints=function(e){var t=e.polygon.polygonPoints,i=t.length;i<s||(i===s?this.penAnnotationDrawer.drawAnnotation(e):this.penAnnotationDrawer.drawLine(t[i-2],t[i-1]))},e.prototype.resetViewModel=function(e){void 0===e&&(e=[]),this.viewModel={currentAnnotations:[],annotationsList:new i(e)},this.pensAnnotationsDataHelper.clear()},e.prototype.clearAnnotationsFromExploration=function(){for(var e=this.services.explorationNavigation.getCurrentExploration(),t=0,i=e.sections;t<i.length;t++){var r=i[t];this.services.layoutAuthoring.updateSectionPenAnnotations(r,[])}},e.prototype.isEraseEvent=function(e){return e.button===a||!e.isPrimary&&0===e.pressure},e.prototype.persistOnSection=function(e){var t=this.services.explorationNavigation.getCurrentSection();this.services.layoutAuthoring.updateSectionPenAnnotations(t,e)},e.prototype.getAnnotationsFromSection=function(){var e=this.services.explorationNavigation.getCurrentSection();return e.penAnnotations||[]},e.prototype.clearAnnotations=function(){this.persistOnSection([]),this.invalidateAnnotations()},e.prototype.invalidateAnnotations=function(){var e=this.getAnnotationsFromSection();this.resetViewModel(e),this.penAnnotationDrawer.redrawAnnotations(this.viewModel)},e.prototype.createPenAnnotationCurve=function(e){var t=this.services.viewModeState.getConfig();return{polygon:this.createPolygon(e),lineWidth:t.penProperties.lineWidth,strokeStyle:t.penProperties.strokeStyle,opacity:t.penProperties.opacity}},e.prototype.createPolygon=function(e){for(var t=[],i=0,r=this.pensAnnotationsDataHelper.getPoints(e);i<r.length;i++){var n=r[i];t.push(n.x),t.push(n.y)}return new o(new Float64Array(t))},e})();t.PenAnnotationController=l;var c=(function(){function e(){this.pensAnnotationsData=[]}return e.prototype.getAnnotationMode=function(e){return this.pensAnnotationsData[e]?this.pensAnnotationsData[e].penAnnotationMode:0},e.prototype.createPenAnnotationData=function(e,t){this.pensAnnotationsData[e]={pointerId:e,penAnnotationMode:t,points:[]}},e.prototype.addPoint=function(e,t){this.pensAnnotationsData[e]&&this.pensAnnotationsData[e].points.push(t)},e.prototype.remove=function(e){delete this.pensAnnotationsData[e]},e.prototype.getPoints=function(e){return this.pensAnnotationsData[e]?this.pensAnnotationsData[e].points:[]},e.prototype.clear=function(){this.pensAnnotationsData=[]},e})(),u=(function(){function e(e){this.rect=e.children(0)[0],this.rectContext=this.rect.getContext("2d")}return e.prototype.validateRectPos=function(e){this.loadCanvasClientRects(),0!==e||this.rect.width===Math.floor(this.rectPosition.width)&&this.rect.height===Math.floor(this.rectPosition.height)||(this.rect.width=this.rectPosition.width,this.rect.height=this.rectPosition.height)},e.prototype.drawLine=function(e,t){this.rectContext.moveTo(e.x,e.y),this.rectContext.lineTo(t.x,t.y),this.rectContext.stroke()},e.prototype.loadCanvasClientRects=function(){this.rectPosition=this.rect.getBoundingClientRect(),this.canvasLeft=this.rectPosition.left,this.canvasTop=this.rectPosition.top},e.prototype.redrawAnnotations=function(e){this.loadCanvasClientRects(),this.rectContext.clearRect(0,0,this.rectPosition.width,this.rectPosition.height);for(var t=0,i=this.getAnnotations(e);t<i.length;t++){var r=i[t];this.drawAnnotation(r)}},e.prototype.getAnnotations=function(e){var t=e.annotationsList.takeAll(),i=[];for(var r in e.currentAnnotations)i.push(e.currentAnnotations[r]);return t.concat(i)},e.prototype.drawAnnotation=function(e){this.rectContext.beginPath(),this.setupNewPath(e);var t=e.polygon.polygonPoints;this.rectContext.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;i++)this.rectContext.lineTo(t[i].x,t[i].y);this.rectContext.stroke()},e.prototype.setupNewPath=function(e){this.rectContext.lineWidth=e.lineWidth,this.rectContext.strokeStyle=e.strokeStyle,this.rectContext.globalAlpha=e.opacity,this.rectContext.lineCap="round",this.rectContext.lineJoin="round"},e.prototype.convertToCanvasPosition=function(e,t){return{x:e-this.canvasLeft,y:t-this.canvasTop}},e})()})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PenAnnotation={templateUrl:"components/penAnnotation/penAnnotation.html",controller:e.common.Services.createController(t.controllers.PenAnnotationController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=(function(){function t(){}return t.prototype.$onInit=function(){this.viewModel&&this.viewModel.selectedContainer?this.selectedContainerKey=this.viewModel.selectedContainer.value:this.selectedContainerKey=null},t.prototype.getSliceComponentType=function(t){return e.viewModels.PropertyPaneViewModelFactory.getSliceComponentType(t)},t.prototype.getSliceUniqueId=function(t,i){return e.viewModels.ViewModelFactory.createUniqueId([t.name,i.toString()])},t.prototype.getTooltipConfig=function(){return{tooltipDescription:this.viewModel.description||this.viewModel.displayName}},t.prototype.onSelectedContainerChanged=function(){var e=this;this.viewModel.selectedContainer=_.find(this.viewModel.containers,(function(t){return t.value===e.selectedContainerKey})),this.viewModel.selectedContainer&&this.selectedContainerChanged&&this.selectedContainerChanged({cardName:this.viewModel.name,containerKey:this.selectedContainerKey})},t.prototype.sliceChanged=function(e){this.inputForm&&this.inputForm[e.name]&&this.inputForm[e.name].$invalid||this.cardChanged({slice:e,card:this.viewModel})},t})();t.PropertyCardController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PropertyCard={templateUrl:"components/propertyCard/propertyCard.html",bindings:{expanded:"<",viewModel:"<",cardChanged:"&",selectedContainerChanged:"&"},controller:e.common.Services.createController(t.controllers.PropertyCardController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.ArrayExtensions,o=t.services.events,n=e.visuals.GradientUtils,a=t.services.selectionUtils;i.MaxPrecision=15;var s=(function(){function e(e,t){var i=this;this.services=t,this.expandedCards={},this.selectedContainers={},this.dirtyCards={},this.propertySliceSaveServices={explorationNavigation:this.services.explorationNavigation,featureSwitchService:this.services.featureSwitchService,resourceRegistration:this.services.resourceRegistration,visualStylePresetService:this.services.visualStylePresetService,themeService:this.services.themeService},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){return i.onVisualSelectionChange()})).subscribe(o.visualContainerPositionChanged,(function(e,t){return i.onVisualContainerPositionChanged(t)})).subscribe(o.visualContainerDataRendered,(function(e,t){return i.onVisualDataRendered(t)})),this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.bindToVisualContainer(a.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection))}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","displayNameService","featureSwitchService","localizationService","promiseFactory","$timeout","themeService","visualStylePresetService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","resourceRegistration","selection","undoRedo","visualAuthoring","visualPlugin"]}},e.getCardContainerKey=function(e,i){return t.viewModels.ViewModelFactory.createUniqueId([e,i.toString()])},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.save=function(e,t){for(var i=this,r=a.getSelectedVisuals(this.services.selection),o=0,n=r;o<n.length;o++){var s=n[o];s&&e.save&&(this.services.undoRedo.register("SavePropertyPane",(function(){i.isCardDirty(t.name,e.name),e.save(t.name,e,s,i.propertySliceSaveServices)})),this.services.visualAuthoring.raiseVisualContainerChanged(s))}},e.prototype.selectContainer=function(e,t){this.selectedContainers&&(this.selectedContainers[e]=t)},e.prototype.expandCard=function(e){this.expandedCards[e]=!this.expandedCards[e]},e.prototype.isCardExpanded=function(e){return this.expandedCards[e]},e.prototype.isAvailable=function(){return this.viewModel&&(!this.viewModel.cards||0===this.viewModel.cards.length)},e.prototype.onVisualDataRendered=function(e){var t=this;e===a.getSelectedVisual(this.services.selection)&&this.services.$timeout((function(){return t.bindToVisualContainer(e)}))},e.prototype.onVisualSelectionChange=function(){this.bindToVisualContainer(a.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection))},e.prototype.onVisualContainerPositionChanged=function(e){var t=a.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection);e.affectContainer(t)&&this.bindToVisualContainer(t)},e.prototype.bindToVisualContainer=function(e){var t=this;if(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.getCurrentVisual){var i=e.config.singleVisual,r=i.visualType,o=i.getCurrentVisual(),n=i.objects,a=this.services.visualPlugin.capabilities(r);if(a&&a.objects){var s=i.title,l=this.services.dataSources.get(),c=this.shouldShowGradient(this.services.visualPlugin,e),u=e.layouts.withId(0).position,d={x:Math.round(u.x),y:Math.round(u.y),width:Math.round(u.width),height:Math.round(u.height)},p=function(e){return"referenceLine"!==e&&"forecast"!==e&&"trend"!==e&&"y1AxisReferenceLine"!==e&&"xAxisReferenceLine"!==e},v={visual:o,capabilities:a,visualConfig:i,visualTitle:s,visualObjectDefns:n,visualContainerPosition:d,showGradientCard:c,promiseFactory:this.services.promiseFactory,explorationNavigation:this.services.explorationNavigation,featureSwitchService:this.services.featureSwitchService,selectedContainers:this.selectedContainers,shouldIncludeObject:p,dirtyCards:this.dirtyCards,visualStylePresetService:this.services.visualStylePresetService,localizationService:this.services.localizationService};return void(s&&s.text||!l?this.createViewModel(v).then((function(e){t.updateViewModel(e)})):this.services.conceptualSchemaProxy.get(l).then((function(e){return o!==i.getCurrentVisual()?void(t.viewModel=t.createEmptyViewModel()):(v.visualTitle=t.services.displayNameService.getVisualTitle(i,e,a,t.services.localizationService),void t.createViewModel(v).then((function(e){t.updateViewModel(e)})))})))}}this.viewModel=this.createEmptyViewModel()},e.prototype.createViewModel=function(e){var i=this.createEmptyViewModel();return t.viewModels.PropertyPaneViewModelFactory.populatePaneForVisual(i,e)},e.prototype.createEmptyViewModel=function(){return{cards:r.createWithName()}},e.prototype.isCardDirty=function(e,i){e!==t.viewModels.PropertyCardNames.Background&&e!==t.viewModels.PropertyCardNames.Border&&e!==t.viewModels.PropertyCardNames.Gradient&&e!==t.viewModels.PropertyCardNames.LockAspect&&e!==t.viewModels.PropertyCardNames.Title||(this.dirtyCards[e]=i!==t.viewModels.PropertySliceNames.RevertToDefault)},e.prototype.shouldShowGradient=function(e,t){if(t&&t.config&&t.config.singleVisual){var i=t.config.singleVisual,r=e.capabilities(t.config.singleVisual.visualType),o=n.getFillRuleRole(r.objects);return o?null!=i&&null!=i.query&&null!=i.query.projections&&null!=i.query.projections[o]:n.shouldShowGradient(i)}},e.prototype.updateViewModel=function(e){this.viewModel=e},e})();i.PropertyPaneController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PropertyPane={templateUrl:"components/propertyPane/propertyPane.html",controller:e.common.Services.createController(t.controllers.PropertyPaneController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.Background="background",e.Border="border",e.CategoryAxis="categoryAxis",e.General="general",e.Gradient="gradient",e.Labels="labels",e.LockAspect="lockAspect",e.StylePreset="stylePresetName",e.Title="title",e.ValueAxis="valueAxis"})(t=e.PropertyCardNames||(e.PropertyCardNames={}));var i;!(function(e){e.Position="position",e.RevertToDefault="revertToDefault",e.SecPosition="secPosition",e.Slider="slider",e.Show="show",e.StylePresetName="name"})(i=e.PropertySliceNames||(e.PropertySliceNames={}));var r;!(function(e){e.X="x",e.Y="y",e.Width="width",e.Height="height"})(r=e.PositionPropertyNames||(e.PositionPropertyNames={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.DataViewObjectDefinitions,o=e.visuals.GradientUtils,n=e.visuals.ObjectEnumerationBuilder,a=e.explore.controllers.PropertyPaneController,s=jsCommon.TextSizeDefaults;!(function(e){e.percentLocKey="Slider_Percent",e.weightLocKey="Slider_Weight",e.degreeLocKey="Slider_Degree"})(i||(i={})),t.MinContainerWidth=40,t.MinContainerHeight=40,t.MaxPrecision=15;var l;!(function(l){function c(t){if(!t)return!1;var i=e.ValueType.fromDescriptor(t.type);return 0!==i.extendedType||e.StructuralTypeDescriptor.isValid(t.type)}function u(e){for(var i=[],r=0,o=e;r<o.length;r++){var n=o[r];i.push({value:n.value.toString(),displayName:t.ViewModelFactory.getDisplayName(n.displayName)})}return i}function d(){for(var t=e.visuals.valueFormatter.getDisplayUnits(e.DisplayUnitSystemType.DataLabels),i=[],r=0,o=t;r<o.length;r++){var n=o[r];i.push({displayName:n.title,value:n.value.toString()})}return i}function p(t,i,r){var o=t.enum;if(!o){var n=t.formatting;n&&n.labelDisplayUnits&&(o=e.createEnumType(d()))}if(o){var a=D(i,r);return u(o.members(a))}}function v(e){if(e.sliderOptions)return e.sliderOptions;var r=h(e);if(r===t.PropertySliceNames.Slider)switch(e.name){case"weight":return{unitSymbol:i.weightLocKey,minValue:0,maxValue:50};case"angle":return{unitSymbol:i.degreeLocKey,minValue:0,maxValue:360};case"textSize":case"fontSize":return{unitSymbol:"",minValue:s.TextSizeMin,maxValue:s.TextSizeMax};case"outlineWeight":case"gridVerticalWeight":case"gridHorizontalWeight":case"barWeight":return{unitSymbol:"",minValue:1,maxValue:10};case"rowPadding":case"cardPadding":return{unitSymbol:"",minValue:0,maxValue:20};case"imageHeight":return{unitSymbol:"",minValue:24,maxValue:150};case"borderThickness":return{unitSymbol:"",minValue:0,maxValue:10};default:return{unitSymbol:i.percentLocKey,minValue:0,maxValue:100}}}function h(e){if(e.sliderOptions)return t.PropertySliceNames.Slider;var i=b(e.type);switch(i){case"alignment":return"alignment";case"numericUnitSelection":return"numericUnitSelection";case"fontSize":case"labelDensity":case"bubbleSize":return t.PropertySliceNames.Slider}if(e.selectionOptions)return"selection";switch(e.name){case"transparency":case"weight":case"roundEdge":case"angle":case"textSize":case"outlineWeight":case"gridVerticalWeight":case"gridHorizontalWeight":case"rowPadding":case"barWeight":case"cardPadding":case"imageHeight":case"percentile":case"borderThickness":return t.PropertySliceNames.Slider;case"gradientBar":return"gradientBar";case"expander":return"container"}return i}function g(e){var i=h(e);return i===t.PropertySliceNames.Slider||"fill"===i}function f(e,i){var r=i.promiseFactory.defer(),o=t.VisualCapabilitiesSliceFactoryHelper.createPopulatePaneOptions(i),n=t.VisualContainerSliceFactoryHelper.createPopulatePaneOptions(i);return m(e,o).then((function(){return m(e,n)})).then((function(){return r.resolve(L(e,i.explorationNavigation))})),r.promise}function m(e,i){e.selectedContainers=i.selectedContainers;var r=i.promiseFactory.defer(),o=[];for(var n in i.objectDescriptors)o.push(y(e,i,n));return i.promiseFactory.all(o).then((function(){i.showGradientCard&&!e.cards.withName(t.PropertyCardNames.Gradient)&&I(e,i.objectDefinitions,i.dirtyCards[t.PropertyCardNames.Gradient],i);var o=_.find(e.cards,(function(e){return e.name===t.PropertyCardNames.StylePreset}));o&&(_.pull(e.cards,o),e.cards.splice(1,0,o)),r.resolve(e)})),r.promise}function y(e,i,r){var o=i.objectDescriptors[r];if(o&&(!i.shouldIncludeObject||i.shouldIncludeObject(r))){var a=i.promiseFactory.when(i.enumerateObjectInstances(r)).then((function(a){var s=n.normalize(a);if(!s||_.isEmpty(s.instances))return void(i.showGradientCard&&"dataPoint"===r&&I(e,i.objectDefinitions,i.dirtyCards[t.PropertyCardNames.Gradient],i));var l=e.cards.withName(r);if(!l){var c=i.objectDefinitions&&i.objectDefinitions[r]&&i.objectDefinitions[r].length>0||r===t.PropertyCardNames.Background&&i.dirtyCards[t.PropertyCardNames.Background]||r===t.PropertyCardNames.Border&&i.dirtyCards[t.PropertyCardNames.Border]||r===t.PropertyCardNames.Labels&&i.dirtyCards[t.PropertyCardNames.Labels]||r===t.PropertyCardNames.General&&i.dirtyCards[t.PropertyCardNames.General]||r===t.PropertyCardNames.LockAspect&&i.dirtyCards[t.PropertyCardNames.LockAspect]||r===t.PropertyCardNames.Title&&i.dirtyCards[t.PropertyCardNames.Title];l={name:r,id:G(i.visualType,r),displayName:t.ViewModelFactory.getDisplayName(o.displayName)||r,description:t.ViewModelFactory.getDisplayName(o.description),header:[],slices:jsCommon.ArrayExtensions.createWithName(),footer:[],mainShow:null,isDirty:!!c},e.cards.push(l)}if(w(l,s,o,i,r),!_.isEmpty(l.containers)&&i.selectedContainers){var u=i.selectedContainers[l.name],d=void 0;u&&(d=_.find(l.containers,(function(e){return e.value===u}))),d||(d=_.first(l.containers)),l.selectedContainer=d}l.name!==t.PropertyCardNames.General&&V(l,i)}));return a}}function w(e,i,o,s,l){for(var c=s.isDisabled,u=0,d=i.instances;u<d.length;u++){var p=d[u],v=o.properties,h=p.properties;if(null!=p.containerIdx){var g=n.getContainerForInstance(i,p),f=!1,m=a.getCardContainerKey(e.name,p.containerIdx);if(s.objectDefinitions){var y=r.getObjectDefinition(s.objectDefinitions,l,p.selector);f=void 0!==y}var w={name:"expander",displayName:t.ViewModelFactory.getDisplayName(g.displayName),type:{bool:!0},selector:p.selector,containerIndex:p.containerIdx,value:m,isDisabled:!1,isModified:f,placeholder:"",isValid:!0,show:!0,slices:jsCommon.ArrayExtensions.createWithName()};e.containers||(e.containers=jsCommon.ArrayExtensions.createWithName()),e.containers.push(w),C(p,v,s,h,e,c,w.slices)}else C(p,v,s,h,e,c,e.slices)}}function C(i,r,o,n,a,s,u){var d=o.visualWarningCollection&&o.visualWarningCollection.visualObjectWarnings;for(var h in n){var f=r[h];if(c(f)){var m=i.selector?i.displayName:void 0,y=t.ViewModelFactory.getDisplayName(f.displayName),w=t.ViewModelFactory.getDisplayName(f.description),C=t.ViewModelFactory.getDisplayName(f.placeHolderText),S=h===l.ImageSliceName||h===l.MapSliceName?"":m||y||h,b=p(e.ValueType.fromDescriptor(f.type),i,h),x=H(i,f,h),D=$(n[h],b,e.ValueType.fromDescriptor(x)),M={name:h,displayName:S,description:w,type:x,selector:i.selector,value:D&&D.solid&&A(x)&&"color"!==h?D.solid.color:D,show:P(a,h,i),placeholder:C,isValid:!0,isDisabled:s||k(a,h),containerIndex:i.containerIdx,save:o.save,selectionOptions:b},V=E(i,M)||v(M);V&&(M.sliderOptions=V),F(i,M),M.isPropertyTitleWidthStretch=g(M),h===t.PropertySliceNames.Show?(d&&d[a.name]&&(M.warningMessage=U(d[a.name],o.localizationService)),a.mainShow=M):u.push(M)}}}function S(e,t){if(null!=t&&_.isNumber(t))for(var i=t.toString(),r=0,o=e;r<o.length;r++){var n=o[r];if(n.value===t)break;if(n.value===i)return i}return t}function b(t){var i=e.ValueType.fromDescriptor(t);if(0!==i.extendedType){var r=i.formatting;if(r)return x(r)}return Object.keys(t)[0]}function x(e){for(var t in e)if(e[t]===!0)return t;return null}function D(e,t){var i=e.validValues;return i&&_.isArray(i[t])&&i[t]}function M(e,t){var i=e.validValues;if(i&&i[t]&&!_.isArray(i[t])){var r=i[t];if(r.numberRange&&_.isNumber(r.numberRange.max)&&_.isNumber(r.numberRange.min))return r.numberRange}}function E(t,i){var r=e.ValueType.fromDescriptor(i.type);if(r.integer){var o=M(t,i.name);if(o)return{minValue:o.min,maxValue:o.max}}}function F(t,i){var r=M(t,i.name),o=e.ValueType.fromDescriptor(i.type);o.numeric&&r&&(i.validators=r)}function V(e,i){var r=t.PropertySliceNames.RevertToDefault;_.any(e.footer,(function(e){return e.name===r}))||e.footer.push({value:e.isDirty,name:r,displayName:"",
type:{revertToDefault:!0},show:!0,placeholder:"",isValid:!0,isDisabled:k(e,r),save:i.save})}function P(e,t,i){if(e.name===l.PlotAreaCardName&&i){var r=i.properties[l.ImageSliceName];if(r&&(t===l.ImageFitSliceName||t===l.TransparencySliceName))return null!=r.url}return!0}function I(e,t,i,r){var n=o.getFillRule(t);if(n){var a=T(e,n,i,r);e.cards.push(a),V(a,r)}}function T(i,r,n,a){var s=i.cards.withName(t.PropertyCardNames.Gradient);s||(s={name:t.PropertyCardNames.Gradient,id:G(a.visualType,t.PropertyCardNames.Gradient),displayName:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_DataPoint")),description:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_DataPointDescription")),header:[],slices:jsCommon.ArrayExtensions.createWithName(),footer:[],mainShow:null,isDirty:n});var l=o.getGradientSettings(r),c="diverging";return s.slices.push({value:l.diverging,name:c,displayName:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_Diverging")),description:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_DivergingDescription")),type:{bool:!0},show:!0,placeholder:"",isValid:!0,save:a.save,isDisabled:k(s,c)}),c="gradientBar",s.slices.push({value:o.getGradientBarColors(l),name:c,displayName:"gradientBar",type:{none:!0},show:!0,placeholder:"",isValid:!0,save:a.save,isDisabled:k(s,c)}),c="minColor",s.slices.push({value:l.minColor,name:c,displayName:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MinColor")),description:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MinColorDescription")),type:{fill:{solid:{color:!0}}},show:!0,placeholder:"",isValid:!0,save:a.save,isDisabled:k(s,c)}),c="midColor",s.slices.push({value:l.midColor,name:c,displayName:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MidColor")),description:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MidColorDescription")),type:{fill:{solid:{color:!0}}},show:l.diverging,placeholder:"",isValid:!0,save:a.save,isDisabled:!l.diverging}),c="maxColor",s.slices.push({value:l.maxColor,name:c,displayName:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MaxColor")),description:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MaxColorDescription")),type:{fill:{solid:{color:!0}}},show:!0,placeholder:"",isValid:!0,save:a.save,isDisabled:k(s,c)}),c="minValue",s.slices.push({value:l.minValue,name:c,displayName:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MinValue")),description:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MinValueDescription")),type:{numeric:!0},show:!0,placeholder:"",isValid:!0,save:a.save,isDisabled:k(s,c)}),c="midValue",s.slices.push({value:l.midValue,name:c,displayName:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MidValue")),description:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MidValueDescription")),type:{numeric:!0},show:l.diverging,placeholder:"",isValid:!0,save:a.save,isDisabled:!l.diverging}),c="maxValue",s.slices.push({value:l.maxValue,name:c,displayName:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MaxValue")),description:t.ViewModelFactory.getDisplayName(e.data.createDisplayNameGetter("Visual_Gradient_MaxValueDescription")),type:{numeric:!0},show:!0,placeholder:"",isValid:!0,save:a.save,isDisabled:k(s,c)}),s}function A(e){var t=e.fill;return null!=t}function k(e,t){return null!=e.mainShow&&!e.mainShow.value&&!N(t)}function N(e){switch(e){case t.PropertySliceNames.Show:case t.PropertySliceNames.RevertToDefault:case l.SliceNameStart:case l.SliceNameEnd:case"showAxisTitle":return!0;default:return!1}}function L(e,t){for(var i=0,r=e.cards;i<r.length;i++)for(var o=r[i],n=0,a=o.slices;n<a.length;n++){var s=a[n];R(s,o,t)}return e}function R(i,r,o){var n=e.ValueType.fromDescriptor(i.type);if(n.numeric||n.integer||n.dateTime){switch(r.name){case t.PropertyCardNames.CategoryAxis:case t.PropertyCardNames.ValueAxis:z(i,r);break;case t.PropertyCardNames.General:O(i,r,o)}"labelPrecision"===i.name&&(i.validators={max:t.MaxPrecision})}}function O(e,i,r){var o=r.getCurrentSection().size,n=e.name;switch(e.validators={},n){case t.PositionPropertyNames.Width:var a=B(i,t.PositionPropertyNames.X),s=parseFloat(a.value);e.validators.max=o.width-s,e.validators.min=t.MinContainerWidth,e.validators.integer=!0,e.validators.required=!0;break;case t.PositionPropertyNames.Height:var l=B(i,t.PositionPropertyNames.Y),c=parseFloat(l.value);e.validators.max=o.height-c,e.validators.min=t.MinContainerHeight,e.validators.integer=!0,e.validators.required=!0;break;case t.PositionPropertyNames.X:var u=B(i,t.PositionPropertyNames.Width),d=parseFloat(u.value);e.validators.max=o.width-d,e.validators.min=0,e.validators.integer=!0,e.validators.required=!0;break;case t.PositionPropertyNames.Y:var p=B(i,t.PositionPropertyNames.Height),v=parseFloat(p.value);e.validators.max=o.height-v,e.validators.min=0,e.validators.integer=!0,e.validators.required=!0}}function z(t,i){var r=t.name;if(_.contains(j,r)){t.validators={};for(var o=e.ValueType.fromDescriptor(t.type),n=0,a=i.slices;n<a.length;n++){var s=a[n];if(r===l.SliceNameStart&&s.name===l.SliceNameEnd||r===l.SliceNameSecStart&&s.name===l.SliceNameSecEnd)if(o.dateTime)t.validators.max=s.value;else{var c=parseFloat(s.value);t.validators.max=_.isFinite(c)?c:void 0,t.validators.decimal=!0}else if(r===l.SliceNameEnd&&s.name===l.SliceNameStart||r===l.SliceNameSecEnd&&s.name===l.SliceNameSecStart)if(o.dateTime)t.validators.min=s.value;else{var c=parseFloat(s.value);t.validators.min=_.isFinite(c)?c:void 0,t.validators.decimal=!0}}}}function B(e,t){var i=e.slices.withName(t);return i}function H(t,i,r){var o=e.ValueType.fromDescriptor(i.type);if(!o.variant)return i.type;for(var n=e.ValueType.fromDescriptor(t.propertyTypes[r]),a=0,s=o.variant;a<s.length;a++){var l=s[a];if(n.isCompatibleFrom(l))return t.propertyTypes[r]}}function $(e,t,i){if(null==e)return e;if(t)return S(t,e);if(!i.numeric||_.isFinite(parseFloat(e)))return e}function U(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o&&o.warnings)for(var n=0,a=o.warnings;n<a.length;n++){var s=a[n],l=s.getMessages(t);if(l)return l}}}function G(e,t){return e?e+"-"+t:t}l.SliceNameStart="start",l.SliceNameEnd="end",l.SliceNameSecStart="secStart",l.SliceNameSecEnd="secEnd",l.PlotAreaCardName="plotArea",l.ImageSliceName="image",l.MapSliceName="map",l.ImageFitSliceName="scaling",l.TransparencySliceName="transparency";var j=[l.SliceNameStart,l.SliceNameEnd,l.SliceNameSecStart,l.SliceNameSecEnd];l.canVisualizeProperty=c,l.getDisplayNames=u,l.getDisplayUnits=d,l.getSelectionOptions=p,l.getSliderOptions=v,l.getSliceComponentType=h,l.isPropertyTitleWidthStretch=g,l.populatePaneForVisual=f,l.populatePane=m,l.getValidSelectionValue=S})(l=t.PropertyPaneViewModelFactory||(t.PropertyPaneViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.DataViewObjectDefinition,o=e.data.DataViewObjectDefinitions,n=e.visuals.GradientUtils,a=e.contracts.SharedResourcePackageNames,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.visuals.yAxisPosition,u=jsCommon.UrlUtils;!(function(i){function d(e){return{objectDescriptors:e.capabilities.objects,objectDefinitions:e.visualObjectDefns,shouldIncludeObject:e.shouldIncludeObject,enumerateObjectInstances:function(t){if(e.visual){var i=e.visual,r={objectName:t};return i.enumerateObjectInstancesAsync?i.enumerateObjectInstancesAsync(r):i.enumerateObjectInstances?i.enumerateObjectInstances(r):void 0}},showGradientCard:e.showGradientCard,dirtyCards:e.dirtyCards,selectedContainers:e.selectedContainers,promiseFactory:e.promiseFactory,save:h,visualType:e.visualConfig.visualType,visualWarningCollection:e.visualConfig&&e.visualConfig.getWarnings&&e.visualConfig.getWarnings(),localizationService:e.localizationService}}function p(i,n,c,d){if(n.name===t.PropertySliceNames.RevertToDefault)return void(c[i]=[]);if(r.isValidPropertyName(n.name)){var p,h=n.type;if(h.image){if(n.value){var g=n.value,f=void 0,m=!0;if(g.scaling){var y=o.getValue(c,{objectName:i,propertyName:n.name},n.selector);m=!y||s.equals(y.scaling,l.text(g.scaling))}if(m&&d.resourceRegistration)f=d.resourceRegistration.add(g.name,100,g.url);else{var w=o.getValue(c,{objectName:i,propertyName:n.name},n.selector);w&&(f=w.url)}var C={name:l.text(g.name),url:f};g.scaling&&(C.scaling=l.text(g.scaling)),p=C}}else if(h.geoJson){var S=n.value,b=void 0;if(S.type===e.GeoJsonTypes.shared)b=l.resourcePackageItem(a.ShapeMap,2,S.name);else if(S.type===e.GeoJsonTypes.packaged&&S.content){var x=u.makeJsonDataUri(S.content);b=d.resourceRegistration.add(S.name,100,x)}else b=S.content?l.text(S.content):l.nullConstant();var D={name:l.text(S.name),type:l.text(S.type),content:b};p=D}else p=o.encodePropertyValue(n.value,h);var M=e.ValueType.fromDescriptor(n.type);M.text||""!==p||(p=null),v(p,i,n.name,n.selector,c)}}function v(e,t,i,r,n){null==e?o.deleteProperty(n,t,r,i):(g(t,i,n,e),o.ensure(n,t,r).properties[i]=e)}function h(e,i,r,o){if(e===t.PropertyCardNames.Gradient)f(i,r);else{var n=r.config.singleVisual.objects;n||(r.config.singleVisual.objects=n={}),p(e,i,n,o)}}function g(e,i,r,n){e===t.PropertyCardNames.ValueAxis&&(i===t.PropertySliceNames.Position&&(o.ensure(r,e,null).properties[t.PropertySliceNames.SecPosition]=n.value===c.right?l.text(c.left):l.text(c.right)),i===t.PropertySliceNames.SecPosition&&(o.ensure(r,e,null).properties[t.PropertySliceNames.Position]=n.value===c.right?l.text(c.left):l.text(c.right)))}function f(e,t){var i=t.config.singleVisual.objects;i||(t.config.singleVisual.objects=i={}),n.updateFillRule(e.name,e.value,i)}i.createPopulatePaneOptions=d,i.saveSliceToDefinition=p})(i=t.VisualCapabilitiesSliceFactoryHelper||(t.VisualCapabilitiesSliceFactoryHelper={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.DataViewObjectDefinitions,n=e.explore.contracts.VisualContainer;!(function(r){function a(e){var t=!e.visual;return{objectDescriptors:n.getObjectDescriptors(e.visualConfig.visualType,e.visualStylePresetService),objectDefinitions:null,enumerateObjectInstances:function(t){return t===i.PropertyCardNames.Title?d(e.visualTitle):t===i.PropertyCardNames.Background?p(e.visualConfig[i.PropertyCardNames.Background]):t===i.PropertyCardNames.LockAspect?v(e.visualConfig.aspectRatio):t===i.PropertyCardNames.General?h(e.visualContainerPosition):t===i.PropertyCardNames.Border?g(e.visualConfig[i.PropertyCardNames.Border]):t===i.PropertyCardNames.StylePreset?f(e.visualConfig[i.PropertyCardNames.StylePreset],e.visualConfig.visualType,e.visualStylePresetService):void 0},selectedContainers:e.selectedContainers,promiseFactory:e.promiseFactory,isDisabled:t,dirtyCards:e.dirtyCards,save:s,localizationService:e.localizationService,visualType:e.visualConfig.visualType}}function s(e,t,r,o){if(e===i.PropertyCardNames.Background||e===i.PropertyCardNames.Border||e===i.PropertyCardNames.LockAspect||e===i.PropertyCardNames.Title||e===i.PropertyCardNames.StylePreset){e===i.PropertyCardNames.LockAspect&&(e="aspectRatio");var n=r.config.singleVisual;if(e===i.PropertyCardNames.StylePreset){if(n[e]||(n[e]=""),t.name===i.PropertySliceNames.RevertToDefault?n[e]="":n[e]=t.value,!o)return;l(n,o)}else n[e]||(n[e]={}),t.name===i.PropertySliceNames.RevertToDefault?n[e]={}:n[e][t.name]=t.value}else e===i.PropertyCardNames.General&&c(t)&&u(t,r)}function l(e,t){var i=t.visualStylePresetService,r=t.themeService;if(i&&r){var n=i.getStylePreset(e.visualType,e.stylePresetName);if(n){var a=r.getVisualStyle(""),s=n.evaluate(a);o.deleteProperties(e.objects,s)}}}function c(e){return _.contains(m,e.name)}function u(e,t){var r=t.layouts.withId(0).position,o=parseInt(e.value,10);isNaN(o)||null==o||(e.name===i.PositionPropertyNames.X?r.x=o:e.name===i.PositionPropertyNames.Y?r.y=o:e.name===i.PositionPropertyNames.Width?r.width=o:e.name===i.PositionPropertyNames.Height&&(r.height=o))}function d(e){return e=e||{},[{selector:null,properties:{show:e.show||!t.contracts.VisualTitle.isHidden(e),text:e.text||"",fontColor:e.fontColor||"#C8C8C8",background:e.background||"",alignment:e.alignment||"left",fontSize:e.fontSize||jsCommon.TextSizeDefaults.TextSizeMin},objectName:i.PropertyCardNames.Title}]}function p(t){return[{selector:null,properties:{show:t&&null!=t.show?t.show:e.visuals.visualBackgroundHelper.getDefaultShow(),color:t&&null!=t.color?t.color:e.visuals.visualBackgroundHelper.getDefaultColor(),transparency:t&&null!=t.transparency?t.transparency:e.visuals.visualBackgroundHelper.getDefaultTransparency()},objectName:i.PropertyCardNames.Background}]}function v(e){return[{selector:null,properties:{show:!(!e||!e.show)},objectName:i.PropertyCardNames.LockAspect}]}function h(e){return[{selector:null,properties:{x:e&&e.x,y:e&&e.y,width:e&&e.width,height:e&&e.height},objectName:i.PropertyCardNames.General}]}function g(e){e=e||{};var t=i.VisualBorder.getDefaultValues();return[{selector:null,properties:{show:e.show||t.show,color:e.color||t.color},objectName:i.PropertyCardNames.Border}]}function f(e,t,r){var o=r.getStylePreset(t,e);if(o)return[{selector:null,properties:{name:o.name},objectName:i.PropertyCardNames.StylePreset}]}var m=[i.PositionPropertyNames.X,i.PositionPropertyNames.Y,i.PositionPropertyNames.Width,i.PositionPropertyNames.Height];r.createPopulatePaneOptions=a})(r=i.VisualContainerSliceFactoryHelper||(i.VisualContainerSliceFactoryHelper={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(){}return t.prototype.change=function(){this.sliceChanged({slice:this.viewModel})},t.prototype.getTitleClass=function(){var t=[],i=this.type;switch(this.viewModel.isPropertyTitleWidthStretch===!0?t.push("item-fill"):t.push("item-auto"),(e.ValueType.fromDescriptor(this.viewModel.type).none||"slider"===i)&&t.push("title-no-max-width"),"outlineWeight"===this.viewModel.name&&t.push("title-of-outline-weight"),i){case"numericUnitSelection":t.push("title-align-left");break;case"fill":t.push("title-of-color-picker");break;case"alignment":t.push("title-of-alignment");break;case"dateTime":t.push("title-of-date-picker")}return t.join(" ")},t.prototype.getTooltipConfig=function(){var e=this.viewModel;return{tooltipDisable:!1,tooltipTitle:e.displayName,tooltipDescription:e.description}},t.prototype.showLabel=function(){return this.viewModel.displayName&&"show"!==this.viewModel.name&&"gradientBar"!==this.viewModel.name},t})();t.PropertySliceController=i})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PropertySlice={templateUrl:"components/propertySlice/propertySlice.html",bindings:{type:"<",viewModel:"<",sliceChanged:"&"},controller:e.common.Services.createController(t.controllers.PropertySliceController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=(function(){function t(){}return t.prototype.getSliceComponentType=function(t){return e.viewModels.PropertyPaneViewModelFactory.getSliceComponentType(t)},t.prototype.sliceChanged=function(e){this.onChanged({slice:e})},t})();t.PropertySliceContainerController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.PropertySliceContainer={templateUrl:"components/propertySliceContainer/propertySliceContainer.html",bindings:{slices:"<",onChanged:"&"},controller:e.common.Services.createController(t.controllers.PropertySliceContainerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){return e&&e.aggregate}var i=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.cancel=function(){this.services.modalDialogService.close()},e.prototype.commit=function(){this.services.modalDialogService.close({selectedAggregate:this.viewModel.selectedAggregate&&t(this.viewModel.selectedAggregate.key),selectedQuickCalc:this.viewModel.selectedQuickCalc.kind})},e.prototype.filterQuickCalc=function(){var e=this;return function(i){return!e.viewModel.selectedAggregate||void 0!==t(e.viewModel.selectedAggregate.key)||void 0===i.kind}},e.prototype.onAggregateSelected=function(){this.filterQuickCalc()(this.viewModel.selectedQuickCalc)||(this.viewModel.selectedQuickCalc=_.find(this.viewModel.availableQuickCalcs,(function(e){return void 0===e.kind})))},e})();e.QuickCalcDialogController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.QuickCalcDialog={templateUrl:"components/quickCalcDialog/quickCalcDialog.html",bindings:{viewModel:"<"},controller:e.common.Services.createController(t.controllers.QuickCalcDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){switch(e){case void 0:return"None";case 0:return"PercentOfGrandTotal"}}e.quickCalcKindToTelemetryId=t;var i=(function(){function e(e,t,i){this.kind=e,this.name=i.get(t)}return e})();e.QuickCalcDialogCalculation=i;var r=(function(e){function t(t){e.call(this,void 0,"QuickCalcDialog_Calculation_None",t)}return __extends(t,e),t})(i);e.QuickCalcDialogNoCalculation=r;var o=(function(e){function t(t){e.call(this,0,"QuickCalcDialog_Calculation_PercentOfGrandTotal",t)}return __extends(t,e),t})(i);e.QuickCalcDialogPercentOfGrandTotalCalculation=o})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.data.FieldExprPattern,o=e.data.SQExprConverter;!(function(i){function n(i,n,a,s,l){var c=new t.QuickCalcDialogNoCalculation(s),u=new t.QuickCalcDialogPercentOfGrandTotalCalculation(s),d=t.MenuItemFactory.createAggregateMenuItems(i,n,l,!1,a.kind,a.requiredTypes),p=r.getAggregate(i),v=_.find(d,(function(e){return e.key.aggregate===p})),h=[c],g=r.getSchema(o.asFieldPattern(i));n.schema(g).capabilities.supportsScopedEval&&h.push(u);var f=o.asFieldPattern(i),m=f&&f.percentOfGrandTotal?u:c;return{baseFieldName:r.getFieldExprName(e.data.SQExprConverter.asFieldPattern(i)),availableAggregates:d,selectedAggregate:v,availableQuickCalcs:h,selectedQuickCalc:m}}i.create=n})(i=t.QuickCalcDialogViewModelFactory||(t.QuickCalcDialogViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.viewModels.QuickCalcDialogViewModelFactory,o=(function(){function i(e,t,i,r,o,n){this.aggrOps=e,this.localizationService=t,this.modalDialogService=i,this.telemetryService=r,this.promiseFactory=o,this.visualAuthoring=n}return i.prototype.show=function(t,i,r,o,n){var a=this,s={dataSources:n,expr:t.config.singleVisual.query.tryGetExpr(i.name,r),roleIndex:r,schema:o,visual:t,visualDataRole:i},l=this.createDialogDefinition(s),c=l.bindings.viewModel.selectedQuickCalc.kind,u=this.promiseFactory.defer(),d=this.modalDialogService.showHostModalDialog(l);return u.promise.catch((function(){return d.reject()})),d.then((function(e){if(!e)return void u.resolve(null);var t=function(){return a.applyQuickCalc(s,c,e.selectedQuickCalc)},i=function(){return a.applyAggregate(s,e.selectedAggregate)};return void 0===e.selectedQuickCalc?t().then(i):i().then(t)})).then((function(){return u.resolve(null)})).catch((function(){return u.reject()})),e.RejectablePromise(u)},i.prototype.createDialogDefinition=function(e){var t={viewModel:r.create(e.expr,e.schema,e.visualDataRole,this.localizationService,this.aggrOps)};return{dialogName:"QuickCalcDialog",definitionTemplateCachePath:"components/quickCalcDialog/quickCalcDialogDefinition.html",bindings:t,dialogCssClass:"quickCalcDialog"}},i.prototype.applyQuickCalc=function(i,r,o){var n,a=this;switch(o){case void 0:n=this.visualAuthoring.removePercentOfGrandTotal(i.visualDataRole.name,i.roleIndex,i.visual,i.dataSources);break;case 0:n=this.visualAuthoring.setPercentOfGrandTotal(i.visualDataRole.name,i.roleIndex,i.visual,i.dataSources);break;default:n=this.promiseFactory.reject()}return n.then((function(i){a.telemetryService.logEvent(e.telemetry.EXChangeQuickCalc,t.viewModels.quickCalcKindToTelemetryId(r),t.viewModels.quickCalcKindToTelemetryId(o))}))},i.prototype.applyAggregate=function(t,i){var r,o=e.data.FieldExprPattern.getAggregate(t.expr);return r=void 0===i?this.visualAuthoring.removeAggregate(t.visualDataRole.name,t.roleIndex,t.visual,t.dataSources):this.visualAuthoring.setAggregate(t.visualDataRole.name,t.roleIndex,i,t.visual,t.dataSources),this.telemetryService.logEvent(e.telemetry.EXChangeAggregation,e.data.aggregateFunctionName(o),e.data.aggregateFunctionName(i)),r},i})();i.QuickCalcDialogBuilder=o})(i=t.dialogs||(t.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o="90",n=(function(){function n(e,t){this.services=t}return n.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","displayNameService","localizationService","telemetryService"],scopedDependencies:["undoRedo","visualAuthoring","visualPlugin"]}},n.prototype.saveExpression=function(t,i,n){void 0===n&&(n=o);var a=this.line.valueDecorator(e.data.SQExprBuilder.selectRef(i),n);if(t.selector.metadata!==i){var s=this.visualContainer.config.singleVisual.objects;s&&r.updateSelector(s,this.card.name,t.selector,{id:t.selector.id,metadata:i}),t.selector.metadata=i}t.properties.value=a},n.prototype.onUpdateInstance=function(e){e&&(this.measureSlice=i.AnalyticsCardControllerBase.findSlice(e,"measure"),this.percentileSlice=i.AnalyticsCardControllerBase.findSlice(e,"percentile"),this.measureSlice&&(!this.measureSlice.value&&this.validMeasures[0]&&(this.measureSlice.value=this.validMeasures[0].value),this.measureSlice.selectionOptions=this.validMeasures))},n.prototype.onAddInstance=function(i,r){if(r.type=this.line.type,this.services.telemetryService.logEvent(e.telemetry.EXAnalyticsPaneAddInstance,t.viewModels.ReferenceLineType[this.line.type]),!_.isEmpty(this.validMeasures)){var o={objectName:this.card.name,selector:r.selector,properties:{}};this.saveExpression(o,this.validMeasures[0].value),i.merge||(i.merge=[]),i.merge.push(o)}},n.prototype.onDeleteInstance=function(i){this.services.telemetryService.logEvent(e.telemetry.EXAnalyticsPaneRemoveInstance,t.viewModels.ReferenceLineType[this.line.type])},n.prototype.onSave=function(e,t,r){if("revertToDefault"===t.name){var n={objectName:this.card.name,selector:t.selector,properties:{}};return this.validMeasures[0]&&this.saveExpression(n,this.validMeasures[0].value,o),e.merge||(e.merge=[]),e.merge.push(n),!1}if("measure"===t.name||"percentile"===t.name){var n={objectName:this.card.name,selector:t.selector,properties:{}};return this.measureSlice=this.measureSlice||i.AnalyticsCardControllerBase.findSlice(r,"measure"),this.percentileSlice=this.percentileSlice||i.AnalyticsCardControllerBase.findSlice(r,"percentile"),this.saveExpression(n,this.measureSlice.value,this.percentileSlice?this.percentileSlice.value:null),e.merge||(e.merge=[]),e.merge.push(n),!0}return!1},n.prototype.isCardDirty=function(e,t){if("value"===e){var r=this.measureSlice&&this.measureSlice.value&&this.measureSlice.value!==this.measureSlice.selectionOptions[0].value,n=this.percentileSlice&&this.percentileSlice.value&&this.percentileSlice.value!==o;return r||n}return i.AnalyticsCardControllerBase.isCardDirty(e,t)},n})();i.ReferenceLineCardController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ReferenceLineCard={templateUrl:"components/referenceLineCard/referenceLineCard.html",bindings:{card:"<",displayName:"<",visualContainer:"<",instances:"<",line:"<",validMeasures:"<"},controller:e.common.Services.createController(t.controllers.ReferenceLineCardController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){!(function(e){e[e.Constant=0]="Constant",e[e.Min=1]="Min",e[e.Max=2]="Max",e[e.Average=3]="Average",e[e.Median=4]="Median",e[e.Percentile=5]="Percentile"})(t.ReferenceLineType||(t.ReferenceLineType={}));var i;t.ReferenceLineType;!(function(i){function r(i,r,o,n){var a=[{title:r.get("Visual_Min_Reference_Line"),type:t.ReferenceLineType.Min,valueDecorator:function(t){return e.data.SQExprBuilder.aggregate(t,3)},instances:_.chain(i.instances).filter({type:t.ReferenceLineType.Min}).sortBy((function(e){return parseInt(e.selector.id,10)})).value()},{title:r.get("Visual_Max_Reference_Line"),type:t.ReferenceLineType.Max,valueDecorator:function(t){return e.data.SQExprBuilder.aggregate(t,4)},instances:_.chain(i.instances).filter({type:t.ReferenceLineType.Max}).sortBy((function(e){return parseInt(e.selector.id,10)})).value()},{title:r.get("Visual_Average_Reference_Line"),type:t.ReferenceLineType.Average,valueDecorator:function(t){return e.data.SQExprBuilder.aggregate(t,1)},instances:_.chain(i.instances).filter({type:t.ReferenceLineType.Average}).sortBy((function(e){return parseInt(e.selector.id,10)})).value()}];return o&&a.push({title:r.get("Visual_Median_Reference_Line"),type:t.ReferenceLineType.Median,valueDecorator:function(t){return e.data.SQExprBuilder.aggregate(t,6)},instances:_.chain(i.instances).filter({type:t.ReferenceLineType.Median}).sortBy((function(e){return parseInt(e.selector.id,10)})).value()}),n&&a.push({title:r.get("Visual_Percentile_Reference_Line"),type:t.ReferenceLineType.Percentile,valueDecorator:function(t,i){var r=parseFloat(i);return r=_.isNaN(r)?0:Math.min(Math.max(0,r),100),e.data.SQExprBuilder.percentile(t,r/100,!1)},instances:_.chain(i.instances).filter({type:t.ReferenceLineType.Percentile}).sortBy((function(e){return parseInt(e.selector.id,10)})).value()}),a}i.buildReferenceLines=r})(i=t.ReferenceLineCardContainerViewModelFactory||(t.ReferenceLineCardContainerViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=e.viewModels.ReferenceLineCardContainerViewModelFactory,r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","localizationService"],scopedDependencies:["dataSources"]}},e.prototype.$onInit=function(){this.setReferenceLines()},e.prototype.$onChanges=function(){this.setReferenceLines()},e.prototype.setReferenceLines=function(){var e=this,t=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(t).then((function(r){for(var o=!0,n=!0,a=0,s=t;a<s.length;a++){var l=s[a],c=r.schema(l.name);if(c){var u=c.capabilities;u.supportsMedian||(o=!1),u.supportsPercentile||(n=!1)}}e.referenceLines=i.buildReferenceLines(e.prototypeCard,e.services.localizationService,o,n)}))},e})();t.ReferenceLineCardContainerController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ReferenceLineCardContainer={templateUrl:"components/referenceLineCardContainer/referenceLineCardContainer.html",bindings:{prototypeCard:"<",visualContainer:"<",validMeasures:"<"},controller:e.common.Services.createController(t.controllers.ReferenceLineCardContainerController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["modalDialogService"]}},e.prototype.close=function(){this.services.modalDialogService.close()},e})();e.TableViewDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.TableViewDialog={templateUrl:"components/tableViewDialog/tableViewDialog.html",bindings:{titleKey:"<",columnNames:"<",tableValues:"<"},controller:e.common.Services.createController(t.controllers.TableViewDialogController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){this.modalDialogService=e}return e.prototype.show=function(e,t,i){var r={columnNames:t,tableValues:i,titleKey:e},o={dialogName:"TableViewDialog",definitionTemplateCachePath:"components/tableViewDialog/tableViewDialogDefinition.html",bindings:r};return this.modalDialogService.showHostModalDialog(o)},e})();e.TableViewDialogBuilder=t})(t=e.dialogs||(e.dialogs={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.events,o=t.services.selectionUtils,n=e.data.SQExpr,a=t.util.VisualContainerUtils,s="y1AxisReferenceLine",l="xAxisReferenceLine",c=(function(){function i(e,t){var i=this;this.services=t,this.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){return i.onVisualChange()})).subscribe(r.visualContainerDataRendered,(function(e,t){return i.onVisualDataRendered(t)})),this.onVisualChange()}return i.createOptions=function(){return{additionalServices:["$timeout","promiseFactory","featureSwitchService","telemetryService","conceptualSchemaProxy","displayNameService"],scopedDependencies:["dataSources","eventBridge","selection","visualPlugin"]}},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},Object.defineProperty(i.prototype,"hasCards",{get:function(){return!_.isEmpty(this.cards)},enumerable:!0,configurable:!0}),i.prototype.onVisualChange=function(){this.bindToVisualContainer(o.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection))},i.prototype.onVisualDataRendered=function(e){var t=this;e===o.getSelectedVisual(this.services.selection)&&this.services.$timeout((function(){return t.bindToVisualContainer(e)}))},i.prototype.bindToVisualContainer=function(i){var r=this;this.cards=[],this.visualContainer=null,i&&i.config&&i.config.singleVisual&&i.config.singleVisual.getCurrentVisual&&this.getConceptualSchema(i).then((function(o){if(o.visualContainer===i){r.validMeasures=r.getValidMeasures(o.visualContainer,o.schema);var n=i.config.singleVisual,a=function(e){return"trend"===e||"y1AxisReferenceLine"===e||"xAxisReferenceLine"===e||"referenceLine"===e&&!_.isEmpty(r.validMeasures)||r.services.featureSwitchService.featureSwitches.forecastEnabled&&"forecast"===e&&!r.queryHasGroupOnKeys(o.visualContainer,o.schema)};t.viewModels.AnalyticsPaneViewModelFactory.populatePaneForVisual(n,a,r.services.promiseFactory,r.services.visualPlugin,r.validMeasures).then((function(t){r.cards=t.cards,r.services.telemetryService.logEvent(e.telemetry.EXAnalyticsPaneOpen,r.hasCards,n.visualType)})),r.visualContainer=i}}))},i.prototype.getValidMeasures=function(e,t){if(!(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query))return[];var i=e.config.singleVisual,r=[],o=this.services.visualPlugin.capabilities(i.visualType);
if(!o||!o.objects)return[];o.objects[s]&&r.push(1),o.objects[l]&&r.push(0);for(var c=[],u=a.getDataRolesForVisual(e,this.services.visualPlugin)||[],d=function(e){if(_.some(r,(function(t){return t===e.cartesianKind})))for(var o=i.query.tryGetExprs(e.name)||[],a=i.query.defn.select(),s=function(e){var i=p.services.displayNameService.getDisplayName(e,t),r=_.find(a,(function(t){return n.equals(e,t.expr)}));c.push({displayName:i,value:r.name})},l=0,u=o;l<u.length;l++){var d=u[l];s(d)}},p=this,v=0,h=u;v<h.length;v++){var g=h[v];d(g)}return c},i.prototype.getConceptualSchema=function(e){var t=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(t).then((function(t){return{schema:t,visualContainer:e}}))},i.prototype.queryHasGroupOnKeys=function(e,t){if(!(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query))return!1;var i=e.config.singleVisual.query.defn.select();return _.any(i,(function(e){return e.expr.hasGroupOnKeys(t)}))},i})();i.AnalyticsPaneController=c})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.AnalyticsPane={templateUrl:"components/analyticsPane/analyticsPane.html",bindings:{},controller:e.common.Services.createController(t.controllers.AnalyticsPaneController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i,r=e.visuals.ObjectEnumerationBuilder,o=e.visuals.ReferenceLineHelper.ReferenceLineProps;!(function(i){function n(e,t,i,r,o){var n=i.defer(),s=e.visualType,l=e.getCurrentVisual(),c=r.capabilities(s),u={cards:[]},d=[];if(c&&c.objects)for(var p in c.objects)t(p)&&d.push(a(l,c.objects,p,e,i,o).then((function(e){e&&u.cards.push(e)})));return i.all(d).then((function(){return n.resolve(u)})),n.promise}function a(e,i,o,n,a,l){var c=i[o],u=v[o],p=t.ViewModelFactory.getDisplayName(c.displayName),h={name:o,displayName:_.isString(p)?p:o,description:t.ViewModelFactory.getDisplayName(c.description),instances:[],defaultInstance:null,maxInstances:u?u.maxInstances:1,supportsUserDefinedInstances:!!u&&u.supportsUserDefinedInstances},g=c.properties;return a.when(d(e,o)).then((function(e){var t=r.normalize(e);if(t&&t.instances){for(var i=0,a=t.instances;i<a.length;i++){var c=a[i],u=!c.properties.show;s(c,g,o,n,h,u,l)}return h.defaultInstance||s(t.instances[0],g,o,n,h,!0,l),h}return null}))}function s(e,t,i,r,o,n,a){var s=e.properties,d=n?null:e.selector,p=s.displayName,v={slices:[],displayName:_.isString(p)?p:o.displayName,selector:d};n?o.defaultInstance=v:o.instances.push(v),"referenceLine"===i&&u(v,r,n,a);for(var h in s){var g=s[h],f=t[h];l(i,h,f)&&v.slices.push(c(e,f,h,g,n))}v.slices.push({value:"",name:"revertToDefault",displayName:"",type:{revertToDefault:!0},selector:d,show:!0,placeholder:"",isValid:!0,isDisabled:n})}function l(e,i,r){return("referenceLine"!==e||"value"!==i)&&"displayName"!==i&&"type"!==i&&"show"!==i&&t.PropertyPaneViewModelFactory.canVisualizeProperty(r)}function c(i,r,o,n,a){var s;i.selector&&(s=i.displayName);var l=t.ViewModelFactory.getDisplayName(r.displayName),c=t.ViewModelFactory.getDisplayName(r.description),u=t.ViewModelFactory.getDisplayName(r.placeHolderText),d=s||l||o,v=t.PropertyPaneViewModelFactory.getSelectionOptions(e.ValueType.fromDescriptor(r.type),i,o);v&&(n=t.PropertyPaneViewModelFactory.getValidSelectionValue(v,n));var h={name:o,displayName:d,description:c,type:r.type,selector:i.selector,value:n&&n.solid&&r.type.fill&&"color"!==o?n.solid.color:n,show:!0,placeholder:u,isValid:!0,isDisabled:a,containerIndex:i.containerIdx,selectionOptions:v},g=t.PropertyPaneViewModelFactory.getSliderOptions(h);return g&&(h.sliderOptions=g),h.isPropertyTitleWidthStretch=t.PropertyPaneViewModelFactory.isPropertyTitleWidthStretch(h),p(h),h}function u(i,r,o,n){var a=r.objects,s=r.query.defn.select(),l=e.data.DataViewObjectDefinitions.getValue(a,{objectName:"referenceLine",propertyName:"value"},i.selector),c=l,u={displayName:e.common.localize.get("Visual_Reference_Line_Measure"),name:"measure",show:!0,isDisabled:o,isValid:!0,placeholder:e.common.localize.get("Visual_Reference_Line_Measure_Default"),value:void 0,selectionOptions:n,selector:i.selector,type:{enumeration:{}}};if(i.slices.push(u),c){var d=void 0;if(!e.data.SQExpr.isAggregation(c)&&!e.data.SQExpr.isPercentile(c))return;if(d=c.arg,!d)return;var p=s.withName(d.expressionName);if(u.value=p?p.name:void 0,!o&&e.data.SQExpr.isPercentile(c)){i.type=t.ReferenceLineType.Percentile;var v={displayName:e.common.localize.get("Visual_Reference_Line_Percentile"),name:"percentile",show:!0,isDisabled:!1,isValid:!0,placeholder:void 0,value:100*c.k,selector:i.selector,type:{numeric:!0}};v.sliderOptions=t.PropertyPaneViewModelFactory.getSliderOptions(v),v.isPropertyTitleWidthStretch=t.PropertyPaneViewModelFactory.isPropertyTitleWidthStretch(v),i.slices.push(v)}else e.data.SQExpr.isMinAggregation(c)?i.type=t.ReferenceLineType.Min:e.data.SQExpr.isMaxAggregation(c)?i.type=t.ReferenceLineType.Max:e.data.SQExpr.isMedianAggregation(c)?i.type=t.ReferenceLineType.Median:e.data.SQExpr.isAvgAggregation(c)&&(i.type=t.ReferenceLineType.Average)}}function d(e,t){if(e){var i={objectName:t};return e.enumerateObjectInstancesAsync?e.enumerateObjectInstancesAsync(i):e.enumerateObjectInstances?e.enumerateObjectInstances(i):void 0}}function p(e){e.name===o.dataLabelDecimalPoints&&(e.validators={max:t.MaxPrecision})}var v={trend:{maxInstances:1,supportsUserDefinedInstances:!1},forecast:{maxInstances:1,supportsUserDefinedInstances:!0},y1AxisReferenceLine:{maxInstances:null,supportsUserDefinedInstances:!0},xAxisReferenceLine:{maxInstances:null,supportsUserDefinedInstances:!0},referenceLine:{maxInstances:null,supportsUserDefinedInstances:!0}};i.populatePaneForVisual=n,i.buildReferenceLineSlices=u})(i=t.AnalyticsPaneViewModelFactory||(t.AnalyticsPaneViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=270,i=(function(){function e(e,t){this.services=t,this.showErrorMessage=!0}return e.createOptions=function(){return{}},e.prototype.$onInit=function(){this.updateErrorOverlayVisibility(this.viewport),this.isFixButtonVisible=1===this.viewMode&&0!==this.errorInfo.fixableError||0===this.viewMode&&3===this.errorInfo.fixableError},e.prototype.$onChanges=function(e){e.viewport&&this.updateErrorOverlayVisibility(this.viewport)},e.prototype.updateErrorOverlayVisibility=function(e){e&&(this.showErrorMessage=e.width>=t)},e})();e.CanvasVisualErrorOverlayController=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.CanvasVisualErrorOverlay={templateUrl:"components/canvasVisualErrorOverlay/canvasVisualErrorOverlay.html",bindings:{errorInfo:"<",viewMode:"<",viewport:"<",showErrorDetails:"&",fixErrors:"&"},controller:e.common.Services.createController(t.controllers.CanvasVisualErrorOverlayController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.visuals.GeoJsonHelper,o=t.dialogs.TableViewDialogBuilder;i.ShapeMapSelectorControllerCustomItemValue="@@custom@@";var n=(function(){function n(e,t){this.scope=e,this.services=t,this.tableViewDialog=new o(this.services.modalDialogService)}return Object.defineProperty(n.prototype,"items",{get:function(){return n.standardMaps||(n.standardMaps=t.viewModels.PropertyPaneViewModelFactory.getDisplayNames(e.visuals.standardGeoJson.type.members())),n.standardMapsPlusCustom||(n.CustomItemDisplayName||(n.CustomItemDisplayName=this.services.localizationService.get("Visual_ShapeMap_PropertyPaneCustomMapLabel")),n.standardMapsPlusCustom=n.standardMaps.concat({value:i.ShapeMapSelectorControllerCustomItemValue,displayName:n.CustomItemDisplayName})),this.customMapName()?n.standardMapsPlusCustom:n.standardMaps},enumerable:!0,configurable:!0}),n.createOptions=function(){return{additionalServices:["$element","localizationService","modalDialogService"]}},n.prototype.$onDestroy=function(){this.abortFileInput()},n.prototype.$onInit=function(){var e=this;this.loadedCustomMap=a.FromGeoJson(this.viewModel),this.fileInput=this.services.$element.find(".file-input"),this.fileInput.change((function(){e.fileInputChanged()}))},n.prototype.change=function(){if(this.changed){if(this.viewModel.type===e.GeoJsonTypes.packaged&&!this.viewModel.content)return;if(this.viewModel.type===e.GeoJsonTypes.shared&&!this.viewModel.name)return;this.changed()}},Object.defineProperty(n.prototype,"selectedMapName",{get:function(){return this.viewModel.type===e.GeoJsonTypes.packaged?i.ShapeMapSelectorControllerCustomItemValue:this.viewModel.name},set:function(t){t===i.ShapeMapSelectorControllerCustomItemValue?this.loadedCustomMap&&(this.viewModel.type=e.GeoJsonTypes.packaged,this.viewModel.name=this.loadedCustomMap.name,this.viewModel.content=this.loadedCustomMap.content):(this.viewModel.type=e.GeoJsonTypes.shared,this.viewModel.name=t,this.viewModel.content=null),this.change()},enumerable:!0,configurable:!0}),n.prototype.customMapName=function(){return this.loadedCustomMap&&this.loadedCustomMap.name},n.prototype.addCustomMap=function(){this.fileInput.val(""),this.fileInput.click()},n.prototype.removeCustomMap=function(){this.loadedCustomMap=void 0,this.viewModel.type===e.GeoJsonTypes.packaged&&(this.selectedMapName=e.visuals.standardGeoJson.usaStates)},n.prototype.abortFileInput=function(){this.lastReader&&(this.lastReader.abort(),this.lastReader=void 0)},n.prototype.fileInputChanged=function(){var e=this;this.abortFileInput();var t=this.fileInput.get(0).files;if(t&&t.length){var r=t[0],o=new FileReader;o.onabort=function(t){e.lastReader=void 0},o.onerror=function(t){e.lastReader=void 0},o.onload=function(t){o===e.lastReader&&(e.lastReader=void 0,e.loadedCustomMap=a.FromFile(r.name,o.result),e.selectedMapName=i.ShapeMapSelectorControllerCustomItemValue)},this.lastReader=o,o.readAsText(r)}},n.prototype.showDialog=function(){if(this.viewModel&&this.viewModel.content){var e=jsCommon.JsonExtensions.tryParseJSON(this.viewModel.content);if(e){var t=r.getTopoJsonShapeKeys(e);t&&this.tableViewDialog.show("Visual_ShapeMap_MapKeysDialog_Title",t.names,t.values)}}},n.prototype.customMapLabel=function(){var t=this.viewModel.type!==e.GeoJsonTypes.shared&&this.viewModel.name?this.viewModel.name:this.services.localizationService.get("PropertyPane_AddShapeMap");return t},n})();i.ShapeMapSelectorController=n;var a=(function(){function t(e,t){this.name=e,this.content=t}return t.FromGeoJson=function(i){var r;return i&&i.type===e.GeoJsonTypes.packaged&&i.name&&i.content&&(r=new t(i.name,i.content)),r},t.FromFile=function(e,i){var r;return e&&i&&(r=new t(e,i)),r},t})()})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.ShapeMapSelector={templateUrl:"components/shapeMapSelector/shapeMapSelector.html",bindings:{viewModel:"<",changed:"&"},controller:e.common.Services.createController(t.controllers.ShapeMapSelectorController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.data.FieldExprPattern,n=e.data.SQExprBuilder,a=e.data.SQExprConverter,s=e.data.SQExprUtils,l=e.data.TopNFilterPattern,c=e.explore.util.VisualContainerUtils,u=(function(){function u(t,i){var o=this;this.scope=t,this.services=i,this.dropConfig={accept:r.Field},this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(e.explore.services.events.filterContainerChanged,(function(e,t){return o.onFilterContainerChanged(t)}))}return u.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","dropdown","localizationService","telemetryService"],scopedDependencies:["dataSources","eventBridge","undoRedo","visualAuthoring"]}},u.prototype.$onInit=function(){this.initializeViewModel(this.viewModel.contract),this.checkDisabled()},u.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},u.prototype.applyFilter=function(){var r=this;if(this.canApplyFilter()){var o,n,a=this.viewModel.contract.expression,s=this.vm.orderByField,u=this.viewModel.visualContainer;if(u){var d=c.getVisualQuery(u);if(d){var p=d.defn.select();o=_.any(p,(function(t){return e.data.SQExpr.equals(t.expr,a,!0,!0)})),n=_.any(p,(function(t){return e.data.SQExpr.equals(t.expr,s,!0,!0)}))}}var v=this.vm.targetType.type===i.TopNFilterType.Top,h=this.vm.itemCount,g=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneTopNFilterApplied,v,h,o,n),f=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(f).then((function(e){r.services.undoRedo.register("ApplyTopNFilter",(function(){var e=l.buildFilterFromParameters({fieldBeingFiltered:a,isTop:v,itemCount:h,orderByField:s,aggregate:r.vm.selectedAggregate});r.services.visualAuthoring.updateFilter(r.viewModel.getFilterContainerScope().container,r.viewModel.contract,e);var i={filter:r.viewModel.contract,changeType:2,scope:r.viewModel.getFilterContainerScope()};return r.viewModel.useDefaultFilter=!1,r.updateRestatement(),r.topNFilterForm.$setPristine(),r.services.eventBridge.publishBubbling(r.scope,t.viewModels.FilterEvents.filterChanged,i),g.resolve(),!0}))}))}},u.prototype.canApplyFilter=function(){return this.checkDisabled(),!this.viewModel.cardType.invalid&&this.vm&&this.vm.itemCount>0&&null!=this.vm.orderByField&&this.topNFilterForm.$dirty&&this.topNFilterForm.$valid},u.prototype.dropFilterTarget=function(){var e=this,t=this.services.dragDataService.getDragContext();if(t&&t.field){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=t.field,a=s.isMeasure(o)?o:n.aggregate(o,e.services.aggrOps.defaultAggregate(o,r,!0));e.isValidOrderByExpr(a)&&i.TopNFilterViewModelFactory.updateOrderByField(e.vm,a,r,e.services.displayNameService,e.services.localizationService,e.services.aggrOps)&&e.topNFilterForm.$setDirty()}))}},u.prototype.getDropAction=function(){if(this.viewModel.cardType.invalid)return 0;var e=this.services.dragDataService.getDragContext();if(e&&e.field){var t=e.field;if(this.isValidOrderByExpr(t))return 1}return 0},u.prototype.removeOrderBy=function(){i.TopNFilterViewModelFactory.removeOrderByField(this.vm),this.topNFilterForm.$setDirty()},u.prototype.selectAggregate=function(e){var t=this;if(e!==this.vm.selectedAggregate){var r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){i.TopNFilterViewModelFactory.updateAggregate(t.vm,e,r,t.services.displayNameService,t.services.localizationService)&&t.topNFilterForm.$setDirty()}))}},u.prototype.showContextMenu=function(e){var t=this;this.services.dropdown.showContextMenu(this.vm.availableAggregates,{x:e.pageX,y:e.pageY},(function(e){return t.selectAggregate(e.aggregate)}),!1)},u.prototype.checkDisabled=function(){var t=this,i=this.viewModel.getFilterContainerScope().container;this.viewModel.cardType.invalid=_.any(i.filters,(function(i){return i!==t.viewModel.contract&&e.data.TopNFilterPattern.extractParametersFromFilter(i.filter)}))},u.prototype.isValidOrderByExpr=function(e){var t=a.asFieldPattern(e);return!!(s.isMeasure(e)||o.getProperty(t)||t.hierarchyLevel)},u.prototype.onFilterContainerChanged=function(e){e.filter===this.viewModel.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,10)&&this.initializeViewModel(e.filter),this.checkDisabled()},u.prototype.initializeViewModel=function(e){var t=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=e&&e.filter&&l.extractParametersFromFilter(e.filter);t.vm=i.TopNFilterViewModelFactory.createViewModel(o,r,t.services.localizationService,t.services.displayNameService,t.services.aggrOps),t.updateRestatement()}))},u.prototype.updateRestatement=function(){this.viewModel.restatement=this.vm.getRestatement(this.services.localizationService)},u})();i.TopNFilterController=u})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){t.TopNFilter={templateUrl:"components/topNFilter/topNFilter.html",controller:e.common.Services.createController(t.TopNFilterController),bindings:{viewModel:"<"}}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=jsCommon.StringExtensions,r=e.visuals.valueFormatter;!(function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom"})(t.TopNFilterType||(t.TopNFilterType={}));var o=t.TopNFilterType,n=(function(){function e(e,t,i){this.filterTypes=e,this.targetType=t,this.itemCount=i}return e.prototype.getRestatement=function(e){if(null!=this.itemCount){var t=r.format(this.itemCount,"#,###"),n=this.orderByDisplayName,a=this.targetType.type===o.Top;return n?i.format(e.get(a?"FilterRestatement_TopNBy":"FilterRestatement_BottomNBy"),t,n):i.format(e.get(a?"FilterRestatement_TopN":"FilterRestatement_BottomN"),t)}},e})();t.TopNFilterViewModel=n})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.SQExpr,n=e.data.SQExprBuilder,a=e.data.TopNFilterPattern;!(function(r){function s(e,t,i,r,o){var n=a.extractParametersFromFilter(e);if(n)return l(n,t,i,r,o)}function l(e,t,r,o,n){var a=!e||e.isTop?i.TopNFilterType.Top:i.TopNFilterType.Bottom,s=h(r),l=new i.TopNFilterViewModel(s,_.find(s,(function(e){return e.type===a})),e&&e.itemCount);return e&&u(l,e.orderByField,t,o,r,n),l}function c(e){e.orderByField=null,e.availableAggregates=null,e.selectedAggregate=null,e.orderByDisplayName=null}function u(e,t,i,r,n,a){return!o.equals(t,e.orderByField)&&(e.orderByField=t,e.availableAggregates=v(t,i,a,n),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,{includeVariationSource:!0},n),e.selectedAggregate=o.isAggregation(t)?t.func:null,p(e),!0)}function d(e,t,i,r,o){return e.selectedAggregate!==t&&(e.orderByField=n.setAggregate(e.orderByField,t),e.selectedAggregate=t,p(e),e.orderByDisplayName=r.getDisplayName(e.orderByField,i,{includeVariationSource:!0},o),!0)}function p(e){for(var t=0,i=e.availableAggregates.items;t<i.length;t++){var r=i[t];r.checked=r.key.aggregate===e.selectedAggregate}}function v(i,r,o,n){return{items:t.viewModels.MenuItemFactory.createAggregateMenuItems(i,r,o,!1,e.VisualDataRoleKind.Measure,[])}}function h(e){return[{type:i.TopNFilterType.Top,text:e.get("TopNFilter_Top")},{type:i.TopNFilterType.Bottom,text:e.get("TopNFilter_Bottom")}]}r.createViewModelFromSemanticFilter=s,r.createViewModel=l,r.removeOrderByField=c,r.updateOrderByField=u,r.updateAggregate=d,r.getAvailableAggregates=v})(r=i.TopNFilterViewModelFactory||(i.TopNFilterViewModelFactory={}))})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){var i=e.services.events,r=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["drill","eventBridge","visualAuthoring"]}},e.prototype.$onInit=function(){var e=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(i.visualContainerChanged,(function(t,i){return e.updateDrillMode(i)})),this.updateDrillModeCore()},e.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},e.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(null,this.visual.contract)},e.prototype.drillDownLevel=function(){this.services.visualAuthoring.drillDownLevel(null,this.visual.contract,3)},e.prototype.drillDownLevelGrouped=function(){this.services.visualAuthoring.drillDownLevel(null,this.visual.contract,2)},e.prototype.canDrill=function(){return this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup||this.canDrillUp},e.prototype.drillLevelTitle=function(){var e=this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup?this.services.localizationService.get("DrillDownLevel_ToolTip"):this.services.localizationService.get("DrillDownLevelDisabled_ToolTip");return e},e.prototype.drillLevelGroupedTitle=function(){var e=this.canDrillDownWithCurrentGroup||this.canDrillDownWithoutCurrentGroup?this.services.localizationService.get("DrillDownLevelGrouped_ToolTip"):this.services.localizationService.get("DrillDownLevelDisabled_ToolTip");return e},e.prototype.updateDrillMode=function(e){e&&e.affectContainer(this.visual.contract)&&this.updateDrillModeCore()},e.prototype.updateDrillModeCore=function(){var e=this.visual.contract;this.canDrillDownWithCurrentGroup=this.services.drill.canDrillByDirection(e,2),this.canDrillDownWithoutCurrentGroup=this.services.drill.canDrillByDirection(e,4),this.canDrillUp=this.services.drill.canDrillByDirection(e,1)},e})();t.VisualContainerDrillController=r})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerDrill={templateUrl:"components/visualContainerDrill/visualContainerDrill.html",bindings:{visual:"<"},controller:e.common.Services.createController(t.controllers.VisualContainerDrillController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["drill","visualAuthoring"]}},e.prototype.toggleDrillMode=function(e){var t=this.visual.contract.drillMode,i=t===e?0:e;this.services.drill.setDrillMode(this.visual.contract,i)},e.prototype.isDrillDownEnabled=function(){return this.isDrillModeEnabled(1)},e.prototype.canDrill=function(){if(!this.visual)return!1;var e=this.visual.contract;return this.services.drill.canDrillByDirection(e,2)||this.services.drill.canDrillByDirection(e,4)||this.services.drill.canDrillByDirection(e,1)},e.prototype.drillTitle=function(){var e=1===this.visual.contract.drillMode?this.services.localizationService.get("DrillMode_ToolTip"):this.services.localizationService.get("DrillDown_ToolTip");return e},e.prototype.isDrillModeEnabled=function(e){return!!this.visual&&this.services.drill.isDrillModeEnabled(this.visual.contract,e)},e})();e.VisualContainerDrillToggleController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerDrillToggle={templateUrl:"components/visualContainerDrillToggle/visualContainerDrillToggle.html",bindings:{visual:"<"},controller:e.common.Services.createController(t.controllers.VisualContainerDrillToggleController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.selectionUtils,o=e.explore.util.VisualContainerUtils,n=t.services.VisualRelationshipUtils,a=(function(){function e(e,t){this.services=t,this.menuId=e.$id.toString()}return e.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["popOut","selection","undoRedo","viewModeState","visualPlugin"]}},e.prototype.canPopOut=function(){return!(this.visual.isPoppedOut||!o.supportsFocusMode(o.getVisualType(this.visual.contract),this.services.visualPlugin))},e.prototype.popOutVisualContainer=function(){this.services.popOut.popOutVisualContainer(this.visual.contract,1)},e.prototype.getSeeDataLayoutTitle=function(){return 2===this.visual.contract.detailVisualLayout?this.services.localizationService.get("VisualContainer_SeeData_HorizontalLayoutButton"):this.services.localizationService.get("VisualContainer_SeeData_VerticalLayoutButton")},e.prototype.toggleSeeDataLayout=function(){var e=this.visual.contract,t=e.detailVisualLayout||1;this.services.undoRedo.register("ToggleSeeDataLayout",(function(){1===t?e.detailVisualLayout=2:e.detailVisualLayout=1})),this.visual.updateViewState()},e.prototype.canSetVisualRelationshipFilterAction=function(){if(!this.services.viewModeState.getConfig().showRelationships||1!==this.services.selection.getSelectedElements().length)return!1;var e=r.getSelectedVisual(this.services.selection);return!!n.supportsAnyFilterAction(e,this.services.visualPlugin)&&!r.isVisualContainerSelected(this.visual.contract,this.services.selection)},e})();i.VisualContainerHeaderController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerHeader={templateUrl:"components/visualContainerHeader/visualContainerHeader.html",bindings:{visual:"<",menuOptions:"<",disablePin:"<",showWarningDetails:"&",showTransformWarningDetails:"&",showInfoDetails:"&",onVisualContainerChanged:"&"},controller:e.common.Services.createController(t.controllers.VisualContainerHeaderController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.visualHost.ResourcePackageReferenceResolver,r=e.explore.contracts.VisualContainer,o=e.explore.util.VisualContainerUtils,n=(function(){function e(e,t){this.services=t}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","explorationSerializer","localizationService","promiseFactory"],scopedDependencies:["dataSources","explorationNavigation","filterGenerator","pinVisual","resourceLoader","viewModeState","visualPlugin"]}},e.prototype.pinVisualContainer=function(e){var t,i=this,r=this.services.dataSources.get(),o=this.visual;this.services.conceptualSchemaProxy.get(r).then((function(e){t=i.visual.hostServices.getFilters(i.services.filterGenerator,e)})).then((function(){return i.resolveResourceReferences(o.contract)})).then((function(e){return i.services.pinVisual.pinVisualContainer(r,e,o.readOnlyState.visual.type,t,o.themeName)})),e&&e.stopPropagation&&e.stopPropagation()},e.prototype.canPin=function(){if(!this.visual)return!1;if(o.hasGroupByItemsInQuery(this.visual.contract))return!1;var e=!1,t=this.visual.readOnlyState.visual.type;return e=this.services.pinVisual.canPinVisualType(t),this.services.viewModeState.getConfig().supportsPinning&&e&&!this.visual.showWatermark},e.prototype.showPin=function(){return this.visual&&this.visual.options.showPin},e.prototype.getPinTileTitle=function(){var e=this.visual.options.disablePin?this.services.localizationService.get("PinTile_NotSupportedTitle"):this.services.localizationService.get("PinVisual_ToolTip");return e},e.prototype.resolveResourceReferences=function(e){var t=this,n=this.services.promiseFactory.defer(),a=o.getVisualType(e),s=o.getObjectDefinitions(e),l=this.services.explorationNavigation.getCurrentExploration(),c=this.services.visualPlugin.capabilities(a),u=c&&c.objects;return i.loadAndResolveFromDataViewObjects(s,u,l.resourcePackages,this.services.resourceLoader,this.services.promiseFactory,!0).then((function(i){var o=r.clone(e,t.services.explorationSerializer);o.config.singleVisual.objects=i,n.resolve(o)})),n.promise},e})();t.VisualContainerPinButtonController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerPinButton={templateUrl:"components/visualContainerPinButton/visualContainerPinButton.html",bindings:{visual:"<",disablePin:"<"},controller:e.common.Services.createController(t.controllers.VisualContainerPinButtonController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.services.events,o=t.services.selectionUtils,n=e.explore.util.VisualContainerUtils,a=t.services.VisualRelationshipUtils,s=(function(){function i(e,t){this.services=t}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","telemetryService"],scopedDependencies:["dataSources","eventBridge","selection","viewModeState","visualAuthoring","visualPlugin","visualRelationship"]}},i.prototype.$onInit=function(){var e=this;this.loadVisualRelationshipFilterAction(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){return e.loadVisualRelationshipFilterAction()}))},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.setVisualRelationshipFilterAction=function(i,r){i&&i.stopPropagation&&i.stopPropagation();var a=o.getSelectedVisual(this.services.selection);this.visual.hostServices.setVisualRelationshipFilterAction(a,this.visual.contract,r,this.services.visualAuthoring),this.services.telemetryService.logEvent(e.telemetry.EXVisualRelationshipOverride,n.getVisualType(a),n.getVisualType(this.visual.contract),t.contracts.VisualRelationshipFilterActionUtil.toString(r)),this.filterAction=r,this.onVisualContainerChanged()},i.prototype.loadVisualRelationshipFilterAction=function(){var e=this,t=o.getSelectedVisual(this.services.selection);if(t){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){var r=e.visual.hostServices.getVisualRelationshipFilterAction(t,e.services.visualRelationship,i);0===r&&(r=a.getDefaultFilterAction(t,e.visual.contract,e.services.visualPlugin)),e.filterAction=r}))}},i.prototype.supportsVisualRelationshipFilterAction=function(e){var t=o.getSelectedVisual(this.services.selection);return a.supportsFilterActionTarget(t,this.visual.contract,e,this.services.visualPlugin)},i})();i.VisualContainerRelationshipFiltersController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerRelationshipFilters={templateUrl:"components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",bindings:{visual:"<",onVisualContainerChanged:"&"},controller:e.common.Services.createController(t.controllers.VisualContainerRelationshipFiltersController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.models.ApplyStyle,o=t.util.ErrorDetailsUtility,n=e.explore.services.events,a=t.util.VisualContainerUtils,s=(function(){function i(e,t){this.services=t}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dataProxy","displayNameService","embedModeService","featureSwitchService","geocoder","localizationService","networkAvailability","promiseFactory","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","resourceLoader","scriptVisuals","shell","visualPlugin","visualQueryGenerator"]}},i.prototype.$onInit=function(){var e=this;this.initializeQueryHandler(),this.initializeVisual(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(n.visualContainerChanged,(function(t,i){i&&e.visual&&i.affectContainer(e.visual)&&e.onVisualContainerChanged()})),this.onVisualContainerChanged(!0,!this.services.networkAvailability.isNetworkAvailable())},i.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},i.prototype.initializeQueryHandler=function(){var i=this,r={getDataSources:function(){return i.services.dataSources.get()},notifyStart:_.noop,notifyEnd:_.noop,clearErrors:function(){
return i.clearErrorState()},handleErrors:function(t){return i.setErrorState(t.getDetails(e.common.localize),t.code)},handleWarnings:_.noop,applyUpdate:function(e,t,r){return i.handleQueryResult(e,t,r)},loadMergedData:function(e){return _.noop}},o=this.createQueryVisualHostServices();this.queryHandler=t.services.createVisualContainerQueryHandler(r,o,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.dataProxy,this.services.networkAvailability,this.services.singleExecutableDataProxyFactory,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell,this.services.localizationService)},i.prototype.initializeVisual=function(){var o=this,n=this.services.visualPlugin.getPlugin(this.visual.config.singleVisual.visualType);if(n){var a=e.Prototype.inherit(t.services.createVisualHostServices(e.visuals.services.createGeolocation(),this.services.geocoder),(function(t){t.getLocalizedString=function(e){return o.services.localizationService.get(e)},t.getViewMode=function(){return o.viewMode},t.locale=function(){return e.common.unmappedCultureInfo},t.promiseFactory=function(){return o.services.promiseFactory}})),s=this.visual.config.singleVisual,l=this.services.explorationNavigation.getCurrentExploration();this.visualDefinition={interactivityOptions:{overflow:"hidden"},type:n.name,allowInvalidDataView:!0,themeName:l&&l.theme,viewport:{width:this.viewport.width*i.VisualScaleFactor,height:this.viewport.height*i.VisualScaleFactor},dataTransforms:{objects:s.objects},hostServices:a,stylePresetName:s.stylePresetName},this.style=new r,this.visualStyle=new r,this.applyStyles()}},i.prototype.applyStyles=function(){this.style.viewport(this.viewport);var e=this.visual.config.singleVisual.background,t=a.getVisualBackgroundRGBColor(e),r=a.getVisualStyleAttributes(this.visualDefinition.viewport,1/i.VisualScaleFactor,t);this.visualStyle.addAttributes(r),this.visualStyle.apply()},i.prototype.onVisualContainerChanged=function(e,t){this.clearErrorState();var i=this.queryHandler.validate(this.visual);return i?void this.setErrorState(i.details,i.code):void(a.isQueryVisualContainer(this.visual,this.services.visualPlugin)?this.applyUpdate(e,!1,t):this.queryHandler.updateNonQueryVisual(this.visual,this.visualDefinition.dataTransforms))},i.prototype.applyUpdate=function(e,t,i){this.queryHandler.runQuery({contract:this.visual,viewport:this.visualDefinition.viewport,initialLoad:e,useVisualContainerCache:!1,preferCurrentData:t,allowCache:i,currentData:this.visualDefinition.data})},i.prototype.handleQueryResult=function(t,i,r){var o=this.visualDefinition;o.dataTransforms=i,r&&(o.dataTransforms=e.Prototype.inherit(o.dataTransforms),o.dataTransforms.objects=r),o.data=t},i.prototype.clearErrorState=function(){this.errorInfo=null},i.prototype.setErrorState=function(e,t){this.errorInfo={code:t,details:e,fixableError:0,hideSeeDetails:!0,overlayType:o.getErrorOverlayType(t)}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateVisualContainerFilter(r.getCurrentExploration(),r.getCurrentSection(),i.visual,t)}}))},i.VisualScaleFactor=2,i})();i.VisualContainerThumbnailController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerThumbnail={templateUrl:"components/visualContainerThumbnail/visualContainerThumbnail.html",bindings:{visual:"<",viewport:"<"},controller:e.common.Services.createController(t.controllers.VisualContainerThumbnailController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=t.services.selectionUtils,a=t.util.VisualContainerUtils,s=(function(){function t(e,t){this.isSearchOn=!1,this.scope=e,this.services=t}return t.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","overlayService"],scopedDependencies:["dataSources","eventBridge","filterGenerator","selection","undoRedo","visualAuthoring","visualPlugin"]}},t.prototype.$onInit=function(){var e=this;this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){return e.onSelectionChanged()})),this.onSelectionChanged()},t.prototype.$onDestroy=function(){this.subscriptionManager.unsubscribeAll()},t.prototype.exportVisualData=function(e){var t=this;e.stopPropagation();var i=this.visual.readOnlyState.visual,r=i&&i.data&&i.data.dataViewSource,n=i&&i.dataTransforms,a=this.visual.contract.config.singleVisual,s=this.visual.visualTitle,l=null!=s?s.text:"",c=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(c).then((function(e){t.services.eventBridge.publishToChannel(o.exportVisualData,{dataViewSource:r,visualConfig:a,visualTitle:l,transformActions:n,additionalFilters:t.visual.hostServices.getFilters(t.services.filterGenerator,e)})})).finally((function(){t.services.overlayService.hideAllDropdowns()}))},t.prototype.toggleSort=function(e,t,i){e.stopPropagation(),this.services.overlayService.hideAllDropdowns();var r={sortableField:t,sortDirection:i};this.services.eventBridge.publishBubbling(this.scope,o.toggleSortVisualContainer,r)},t.prototype.toggleSearch=function(t){var i=this;t.stopPropagation();var o=this.visual.contract.config.singleVisual;o.objects||(o.objects={});var n=a.getVisualCapabilities(this.visual.contract,this.services.visualPlugin),s=this.services.filterGenerator.tryGetSelfFilterEnabledProperty(n);if(s){var l=r.getValue(o.objects,s,null),c=l&&l.value||!1;this.services.undoRedo.register("ToggleSearchVisualContainer",(function(){if(c){r.deleteProperty(o.objects,s.objectName,null,s.propertyName);var t=i.services.filterGenerator.tryGetSelfFilterProperty(n);t&&r.deleteProperty(o.objects,t.objectName,null,t.propertyName),i.isSearchOn=!1}else r.setValue(o.objects,s,null,e.data.SQExprBuilder.boolean(!0)),i.isSearchOn=!0;i.services.visualAuthoring.raiseVisualContainerChanged(i.visual.contract)}))}this.services.overlayService.hideAllDropdowns()},t.prototype.deleteVisualContainer=function(){var e=this;this.services.undoRedo.register("DeleteVisualContainer",(function(){e.services.eventBridge.publishBubbling(e.scope,o.deleteVisualContainer,e.visual.contract)}))},t.prototype.getClusters=function(){this.services.eventBridge.publishBubbling(this.scope,o.getClusters,{})},t.prototype.getSpatialClusters=function(){this.services.eventBridge.publishBubbling(this.scope,o.getClusters,{useSpatialClustering:!0})},t.prototype.onSelectionChanged=function(){this.visual&&this.visual.contract&&(this.isSelected=n.isVisualContainerSelected(this.visual.contract,this.services.selection))},t})();i.VisualContainerOptionsMenuController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){i.VisualContainerOptionsMenu={templateUrl:"components/visualOptionsMenu/visualContainerOptionsMenu.html",bindings:{visual:"<",menuOptions:"<",menuId:"<"},controller:e.common.Services.createController(t.controllers.VisualContainerOptionsMenuController)}})(i=t.components||(t.components={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.DateExtensions,o=jsCommon.DOMConstants,n=t.services.events,a=e.data.SemanticFilter,s=e.common.directives.TooltipAnchorElementType,l=(function(){function i(e,t){this.scope=e,this.services=t,this.initialize()}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","overlayService","telemetryService","localizationService","tooltipService"],scopedDependencies:["dataSources","eventBridge","undoRedo","visualAuthoring","visualPlugin"]}},i.prototype.initialize=function(){var i=this;this.getConceptualSchema().then((function(e){var r=i.scope;i.advFilterCard=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(r.viewModel.contract),r.advFilterCard=i.advFilterCard,r.applyFilter=function(){return i.applyFilter()},r.handleFocusedInputChanged=function(e,t){return i.handleFocusedInputChanged(e,t)},r.handleInputBlur=function(){return i.handleInputBlur()},r.isDirty=!1,r.markDirty=function(){return i.scope.isDirty=!0},r.clearDirty=function(){return i.scope.isDirty=!1},r.validateFilterInput=function(e){return i.validateFilterInput(e)},r.dateOptions={showWeeks:!1},r.dateSelected=function(e){return i.dateSelected(e)},r.timeSelected=function(e){return i.timeSelected(e)},r.dateTextUpdateComplete=function(e){return i.dateTextUpdateComplete(e)},r.dateTextUpdated=function(e){return i.dateTextUpdated(e)},r.keyUp=function(e){return i.onKeyUp(e)},r.tooltipConfig={tooltipLocalizeTitle:"AdvancedFilter_InvalidTooltip",tooltipAnchorElementSelector:"input[type='text']:first",tooltipAnchorElementType:s.Sibling},i.updateRestatement(),i.updateModel(e);var o=i.services.eventBridge.createChannelSubscriptionManager().subscribe(n.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)}));r.$on("$destroy",(function(){return o.unsubscribeAll()}))})).catch((function(){return i.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Conceptual schema could not be found.")}))},i.prototype.updateModel=function(t){var i=this;if(this.advFilterCard.loadOperators(t,this.services.aggrOps),!this.advFilterCard.operators)return void this.services.telemetryService.logEvent(e.telemetry.EXLoadFilterError,"Filter operators failed to load.");var r=this.advFilterCard.field,o=r.getMetadata(t);o&&(this.advFilterCard.isDateTime=!!o.type.dateTime),this.advFilterCard.ensureConditions();var n=this.advFilterCard.conditions,a=this.scope;a.viewModel.updateFilterProperties(t,this.services.visualPlugin,this.services.aggrOps);for(var s=0,l=n;s<l.length;s++){var c=l[s];c&&c.value&&(c.value.formatter=this.scope.viewModel.formatter)}a.viewModel.updateViewState(),a.canApplyFilter=function(){return i.canApplyFilter(t)}},i.prototype.applyFilter=function(){var i=this,r=this.scope.viewModel,o=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneAdvancedFilterApplied,r.isVisualFilter,t.contracts.FilterType.Advanced);this.getConceptualSchema().then((function(e){i.services.undoRedo.register("ApplyAdvancedFilter",(function(){if(!i.canApplyFilter(e))return o.reject(),!1;var n,s=i.advFilterCard.toSQExpr(e),l=i.scope.viewModel;s?(i.services.visualAuthoring.updateFilter(l.getFilterContainerScope().container,l.contract,a.fromSQExpr(s)),n=2):(i.services.visualAuthoring.updateFilter(l.getFilterContainerScope().container,l.contract,void 0),n=10);var c={filter:r.contract,changeType:n,scope:r.getFilterContainerScope()};return i.scope.clearDirty(),i.scope.viewModel.useDefaultFilter=!1,i.updateRestatement(),i.services.eventBridge.publishBubbling(i.scope,t.viewModels.FilterEvents.filterChanged,c),o.resolve(),!0}))}),o.reject())},i.prototype.validateFilterInput=function(e){var t=this;this.getConceptualSchema().then((function(i){e.value&&e.value.value&&!t.advFilterCard.isConditionValid(i,e)?e.isInvalid=!0:(e.isInvalid=!1,t.services.tooltipService.hideTooltip())}))},i.prototype.handleFocusedInputChanged=function(e,t){this.validateFilterInput(t)},i.prototype.handleInputBlur=function(){this.services.tooltipService.hideTooltip()},i.prototype.dateSelected=function(e){this.services.overlayService.hideAllDropdowns(),e.value.dateValue&&(e.value.value=e.value.dateValue),this.scope.markDirty()},i.prototype.timeSelected=function(e){if(e.value.value&&e.value.value instanceof Date){var t=e.value.timePickerValue.getHours(),i=e.value.timePickerValue.getMinutes();e.value.dateValue=e.value.value=new Date(e.value.value.setHours(t,i))}else e.value.value=e.value.dateValue=e.value.timePickerValue;this.scope.markDirty()},i.prototype.dateTextUpdateComplete=function(e){var t=e.value;_.isString(t.value)&&(t.value=t.dateValue)},i.prototype.dateTextUpdated=function(e){var t=e.value,i=r.parseIsoDate(t.value);i&&(t.dateValue=i)},i.prototype.updateRestatement=function(){if(!this.scope.viewModel.useDefaultFilter){var e=this.scope.viewModel;e.restatement=this.advFilterCard.getRestatement(e.formatter)}},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(e)},i.prototype.onFilterContainerChanged=function(e){var i=this.scope.viewModel;if(e.filter===i.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)){var r=t.viewModels.FilterViewModelFactory.extractAdvFilterCard(e.filter);this.advFilterCard.conditions=r.conditions,this.updateRestatement(),this.advFilterCard.ensureConditions()}},i.prototype.canApplyFilter=function(e){return this.scope.isDirty&&!this.scope.viewModel.readOnlyState.disabled&&this.advFilterCard.areConditionsValid(e)},i.prototype.onKeyUp=function(e){var t=this;e.preventDefault();var i=e.keyCode||e.which;i===o.enterKeyCode&&this.scope.$applyAsync((function(){return t.applyFilter()}))},i})();i.AdvancedFilterController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e){return{left:e.x,top:e.y,width:e.width,height:e.height}}function r(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}var o=e.util.CanvasVisualsUtility,n=(function(){function e(e,t){this.items=[],this.services=t}return e.createOptions=function(){return{scopedDependencies:["canvasScale"]}},e.prototype.registerLayoutItem=function(e){this.items.push(e)},e.prototype.unregisterLayoutItem=function(e){_.pull(this.items,e)},e.prototype.dragEnd=function(e,t,i){this.canProcess(e)&&e.dragEnd(t,this.getNormalizedPosition(e,i))},e.prototype.dragStart=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.dragStart(t,i))},e.prototype.nudge=function(e,t,i,r){this.canProcess(e)&&e.nudge(t,this.getNormalizedPosition(e,i,r))},e.prototype.resizeStart=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.resizeStart(t,i))},e.prototype.resizeMove=function(e,t,i){this.canProcess(e)&&(i=this.getIntermediateDimensions(e,i),e.resizeMove(t,i))},e.prototype.resizeEnd=function(e,t,i){this.canProcess(e)&&e.resizeEnd(t,this.getNormalizedPosition(e,i))},e.prototype.setStrategy=function(e){this.strategy=e},e.prototype.setCanvasSize=function(e){this.canvasSize=e},e.prototype.getDropPosition=function(e,t,i){var r=i;if(!r){var o=this.services.canvasScale.getCanvasScaleFactor();r={x:o,y:o}}var n=this.strategy.getNearestDropPosition({item:null,allItems:this.items,rawItemPosition:{left:e,top:t,width:0,height:0},canvasSize:this.canvasSize,canvasScale:r});return n},e.prototype.getIntermediateDimensions=function(e,t){if(this.strategy.isEnforcedForIntermediateStates()){var o=i(this.getScaledPosition(e,t));return r(this.strategy.getHostRectFromScaled(o))}return t},e.prototype.getScaledPosition=function(e,t,n){var a=e.getScale(),s={x:!_.isFinite(t.x),y:!_.isFinite(t.y),width:!_.isFinite(t.width),height:!_.isFinite(t.height)};if(s.x||s.y||s.width||s.height)if(e){var l=e.getPosition(),c=o.convertToScaledPosition(l,a,!1),u=this.strategy.getHostRectFromScaled(i(c));t=_.clone(t),s.x&&(t.x=u.left),s.y&&(t.y=u.top),s.width&&(t.width=u.width),s.height&&(t.height=u.height)}else t=_.clone(t),s.x&&(t.x=0),s.y&&(t.y=0),s.width&&(t.width=0),s.height&&(t.height=0);var d=i(t),p=this.strategy.getNearestValidPosition({item:e,allItems:this.items,canvasSize:this.canvasSize,canvasScale:a,rawItemPosition:d,nudge:n});return r(p)},e.prototype.getNormalizedPosition=function(e,t,n){var a=this.getScaledPosition(e,t,n),s=o.convertFromScaledRect(i(a),e.getScale());return r(s)},e.prototype.canProcess=function(e){return!!e&&!e.isSuspended()&&_.contains(this.items,e)},e})();t.CanvasLayoutController=n})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){var n=i(e,o);return{width:l(r,n.width,o.colSpacing),height:l(t,n.height,o.rowSpacing)}}function i(e,t){var i=t.cols,r=t.rows,o=t.rowSpacing,n=t.colSpacing,a=n*(i+1),s=o*(r+1),l=Math.floor((e.width-a)/i),c=Math.floor((e.height-s)/r);return{width:l,height:c}}function r(e,t,r){for(var o=i(e,t),n=t.cols,a=t.rows,s=t.rowSpacing,l=t.colSpacing,c=r.width,u=r.height,d=o.width,p=o.height,v=Math.ceil(c/(d+l)),h=Math.ceil(u/(p+s)),g=[],f=0,m=0;m<=a-h;++m){f+=s;for(var y=0,w=0;w<=n-v;++w)y+=l,g.push({left:y,top:f,width:c,height:u}),y+=d;f+=p}return g}function o(e,t,i,r){return[n(t,e,r),i]}function n(e,t,r){var o=i(t,e),n=e.rowSpacing,l=e.colSpacing,c=o.width,u=o.height;return{left:a(r.left,c,l),top:a(r.top,u,n),width:s(r.width,c,l),height:s(r.height,u,n)}}function a(e,t,i){var r=e+t/2;r-=1;var o=Math.floor(r/(t+i));return c(o,t,i)}function s(e,t,i){var r=e+t/2+i,o=Math.floor(r/(t+i));return o=Math.max(1,o),l(o,t,i)}function l(e,t,i){return e*t+Math.max(0,e-1)*i}function c(e,t,i){return e*t+e*i+i}e.getSpanSize=t,e.getCellSize=i,e.getAllSlots=r,e.getAllResizeSlots=o})(t=e.CanvasLayoutGrid||(e.CanvasLayoutGrid={}))})(t=e.canvas||(e.canvas={}))})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r;!(function(i){function r(e,t,i){var r=_.chain(i).without(t).map((function(e){return a.visualPositionToRect(e.getPosition())})).value();return _.remove(e,(function(e){return _.any(r,(function(t){return o(t,e)}))})),e}function o(e,t){return!(t.left>=e.left+e.width||e.left>=t.left+t.width||t.top>=e.top+e.height||e.top>=t.top+t.height)}function n(e,t){return l.getDistance(c.getCentroid(e),c.getCentroid(t))}var a=t.util.CanvasDisplayUtility,s=t.util.CanvasVisualsUtility,l=e.visuals.shapes.Point,c=e.visuals.shapes.Rect,u=(function(){function e(e,t){void 0===t&&(t={width:3,height:3}),this.options=e,this.defaultNewCellSize=t}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=c.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=c.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(e){var t=e.rawItemPosition,i=this.options.offset;i&&(t=c.add(e.rawItemPosition,i));var r,o=s.convertFromScaledRect(t,e.canvasScale),l=!1;e.item&&(r=a.visualPositionToRect(e.item.getPosition()),l=o.width!==r.width||o.height!==r.height);var u,d;if(l)u=this.getAvailableResizeRects(e.item,e.allItems,e.canvasSize,r,o),d=u[0];else{if(u=this.getAvailableRects(e.item,e.allItems,e.canvasSize,o),_.isEmpty(u))return;d=_.min(u,(function(e){return n(e,o)}))}return s.convertToScaledRect(d,e.canvasScale)},e.prototype.getNearestDropPosition=function(e){var t=c.getCentroid(e.rawItemPosition);this.options.offset&&(t.x-=this.options.offset.left,t.y-=this.options.offset.top),t.x/=e.canvasScale.x,t.y/=e.canvasScale.y;var r=this.defaultNewCellSize.width,o=this.defaultNewCellSize.height,a=function(){var a=i.CanvasLayoutGrid.getSpanSize(e.canvasSize,r,o,s.options),l={left:t.x-a.width/2,top:t.y-a.height/2,width:a.width,height:a.height},u=s.getAvailableRects(e.item,e.allItems,e.canvasSize,l);return _.isEmpty(u)||(_.remove(u,(function(e){return!c.containsPoint(e,t)})),_.isEmpty(u))?(--r,void--o):{value:_.min(u,(function(e){return n(e,l)}))}},s=this;do{var l=a();if("object"==typeof l)return l.value}while(r>=1&&o>=1)},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e.prototype.getAvailableRects=function(e,t,o,n){var a=i.CanvasLayoutGrid.getAllSlots(o,this.options,n);return r(a,e,t)},e.prototype.getAvailableResizeRects=function(e,t,o,n,a){var s=i.CanvasLayoutGrid.getAllResizeSlots(o,this.options,n,a);return r(s,e,t)},e})();i.CanvasLayoutGridStrategy=u,i.isIntersecting=o})(r=i.canvas||(i.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){})(t=e.canvas||(e.canvas={}))})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.explore.util.CanvasVisualsUtility,o=e.visuals.shapes.Rect,n=(function(){function e(e){this.offset=e}return e.prototype.getScaledRectFromHost=function(e){return o.add(e,this.offset)},e.prototype.getHostRectFromScaled=function(e){return o.subtract(e,this.offset)},e.prototype.getNearestValidPosition=function(e){return o.add(e.rawItemPosition,this.offset)},e.prototype.getNearestDropPosition=function(e){var t=e.rawItemPosition.left+e.rawItemPosition.width/2,o=e.rawItemPosition.top+e.rawItemPosition.height/2;t-=this.offset.left,o-=this.offset.top,t/=e.canvasScale.x,o/=e.canvasScale.y;var n=i.DefaultVisualPosition.width,a=i.DefaultVisualPosition.height;return{left:r.checkBoundaryForCharts(t,n,e.canvasSize.width),top:r.checkBoundaryForCharts(o,a,e.canvasSize.height),width:n,height:a}},e.prototype.isEnforcedForIntermediateStates=function(){return!1},e})();t.DefaultLayoutStrategy=n})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){var i=e.explore.util.CanvasDisplayUtility,r=e.explore.components.DotGridComponent,o=e.visuals.shapes.Rect,n=e.common.controllers.TransformNudgeDirection,a=(function(){function e(e){this.options=e}return e.prototype.getScaledRectFromHost=function(e){var t=this.options.offset;return t&&(e=o.add(e,t)),e},e.prototype.getHostRectFromScaled=function(e){var t=this.options.offset;return t&&(e=o.subtract(e,t)),e},e.prototype.getNearestValidPosition=function(t){var i=o.add(t.rawItemPosition,this.options.offset),r=t.canvasScale;if(t.nudge&&t.item){var a=t.item.getPosition(),s=a.x,l=a.y;t.nudge.direction===n.Left||t.nudge.direction===n.Right?s=e.applyNudge(s,this.options.layoutX.UnitDivisions,t.nudge.direction===n.Left,t.nudge.bigNudge):t.nudge.direction!==n.Up&&t.nudge.direction!==n.Down||(l=e.applyNudge(l,this.options.layoutY.UnitDivisions,t.nudge.direction===n.Up,t.nudge.bigNudge)),i.left=s*r.x,i.top=l*r.y}var c=this.getNearestUnscaledGridRect(i,r);return{left:c.left*r.x,top:c.top*r.y,width:c.width*r.x,height:c.height*r.y}},e.applyNudge=function(e,t,i,o){e=Math.round(e);var n=o?r.CanvasLayout.UnitLength:r.CanvasLayout.UnitLength/t,a=n*(i?Math.floor:Math.ceil)(e/n);return a===e&&(a+=i?-n:n),a},e.prototype.getNearestDropPosition=function(e){var t=o.getCentroid(e.rawItemPosition);t.x-=this.options.offset.left,t.y-=this.options.offset.top;var r={left:t.x-i.DefaultVisualPosition.width/2,top:t.y-i.DefaultVisualPosition.height/2,width:i.DefaultVisualPosition.width,height:i.DefaultVisualPosition.height};return r=this.getNearestUnscaledGridRect(r,e.canvasScale)},e.prototype.getNearestUnscaledGridRect=function(t,i){var r=this.getNearestUnscaledGridPoint({x:t.left,y:t.top},i),o=this.getNearestUnscaledGridPoint({x:t.left+t.width,y:t.top+t.height},i),n=this.options.limits;if(n){var a=e.limitAdjustment(r.x,o.x,n.left,n.width);0!==a&&(r.x+=a,o.x+=a);var s=e.limitAdjustment(r.y,o.y,n.top,n.height);0!==s&&(r.y+=s,o.y+=s)}return{left:r.x,top:r.y,width:o.x-r.x,height:o.y-r.y}},e.limitAdjustment=function(e,t,i,r){if(e<i)return i-e;var o=i+r;return t>o?o-t:0},e.prototype.getNearestUnscaledGridPoint=function(t,i){return{x:e.getNearestUnscaledGridCoordinate(this.options.layoutX,t.x,i.x),y:e.getNearestUnscaledGridCoordinate(this.options.layoutY,t.y,i.y)}},e.getNearestUnscaledGridCoordinate=function(e,t,i){var o=t/i,n=r.CanvasLayout.UnitLength/e.UnitDivisions,a=Math.round(o/n);return a*n},e.prototype.isEnforcedForIntermediateStates=function(){return!0},e})();t.DotGridLayoutStrategy=a})(i=t.canvas||(t.canvas={}))})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.ErrorDetailsUtility,o=e.explore.services.events,n=e.data.SQExprUtils,a=e.explore.services,s=jsCommon.TraceType,l="Sampled",c=(function(){function t(e,t){this.scope=e,this.services=t}return t.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","errorService","featureSwitchService","telemetryService"],scopedDependencies:["dataSources","eventBridge","selection","visualAuthoring"]}},t.prototype.showErrorDetails=function(){var e=this.scope.viewModel;this.logErrorAndShowDialog(e.errorInfo,e.readOnlyState.visual.type,!0)},t.prototype.showWarningDetails=function(){var e=this.scope.viewModel,t={details:e.warningInfo.details,code:e.warningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1)},t.prototype.showTransformWarningDetails=function(){var e=this.scope.viewModel,t={details:e.transformWarningInfo.details,code:e.transformWarningInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1)},t.prototype.showInfoDetails=function(){var e=this.scope.viewModel,t={details:e.visualInfo.details,code:e.visualInfo.code,fixableError:0};this.logErrorAndShowDialog(t,e.readOnlyState.visual.type,!1)},t.prototype.clearError=function(){var e=this.scope.viewModel;e.errorInfo=void 0,e.warningInfo=void 0,e.transformWarningInfo=void 0,e.visualInfo=void 0},t.prototype.showErrorOverlay=function(t,i,o){var n=this.scope.viewModel,a=n.readOnlyState.visual.type;if(this.services.telemetryService.logEvent(e.telemetry.VisualError,i,a,t.message),!n.errorInfo){var s=r.getErrorOverlayType(i),l=this.shouldHideSeeDetails(i),c=this.getFixableErrorKind(i,this.services.featureSwitchService.featureSwitches.enableTableToTableRelationship);n.errorInfo={details:t,code:i,fixableError:c,hideSeeDetails:l,overlayType:s,requestId:o}}},t.prototype.showWarningIcon=function(e,t){var i=this.scope.viewModel,r=i.readOnlyState.visual.type;this.logVisualWarning(r,t,e.message),i.warningInfo||(i.warningInfo={details:e,code:t})},t.prototype.showTransformWarningIcon=function(e,t,i){var r=this.scope.viewModel,o=r.readOnlyState.visual.type,n=i?t.concat("|").concat(l):t;this.logVisualWarning(o,n,e.message),r.transformWarningInfo||(r.transformWarningInfo={details:e,code:t})},t.prototype.showInfoIcon=function(e,t){var i=this.scope.viewModel,r=i.readOnlyState.visual.type;this.logVisualWarning(r,t,e.message),i.visualInfo||(i.visualInfo={details:e,code:t})},t.prototype.fixErrors=function(){var e=this.scope.viewModel;switch(e.errorInfo.fixableError){case 1:a.selectionUtils.selectVisualContainer(e.contract,this.services.selection),this.services.visualAuthoring.removeInvalidExpressions(e.contract,this.services.dataSources.get());break;case 2:var t=n.getActiveTablesNames(e.contract.config.singleVisual.query.defn);this.services.eventBridge.publishToChannel(o.missingTableRelationship,{tables:t});break;case 3:this.removeBrokenFilters();break;case 0:}},t.prototype.removeBrokenFilters=function(){var e=this,t=this.scope.viewModel,i=t.contract.filters,r={scopeType:0,container:t.contract};this.services.conceptualSchemaProxy.get(this.services.dataSources.get()).then((function(t){for(var o=0,n=i;o<n.length;o++){var a=n[o];a.filter&&!_.isEmpty(a.filter.validate(t,e.services.aggrOps))&&e.services.visualAuthoring.removeFilter(a,r)}}))},t.prototype.generateShowMoreErrorDetails=function(t){var i=[],o=t.message,n=e.common.localize.get("ServiceError_CannotLoadVisual");if(r.hasAdditionalErrorInfo(t)&&(n=t.displayableErrorInfo[0].errorInfoKey,o=t.displayableErrorInfo[0].errorInfoValue,t.displayableErrorInfo.length>1))for(var a=1;a<t.displayableErrorInfo.length;a++)i.push(t.displayableErrorInfo[a]);var s={title:n,message:o,displayableErrorInfo:i,debugErrorInfo:t.debugErrorInfo};return s},t.prototype.getFixableErrorKind=function(e,t){switch(e){case"Missing_References":return 1;case"InvalidUnconstrainedJoin":return t?2:0;case"Broken_Filters":return 3;default:return 0}},t.prototype.shouldHideSeeDetails=function(e){return 1===r.getErrorOverlayType(e)},t.prototype.logErrorAndShowDialog=function(e,t,i){var r,o,n=this.generateShowMoreErrorDetails(e.details),a=e.code;i?(r="VisualErrorSeeDetails_"+a+"_"+t,o=s.Error):(r="VisualWarningSeeDetails_"+a+"_"+t,o=s.Warning);var l={title:n.title,displayableErrorInfo:n.displayableErrorInfo,debugErrorInfo:n.debugErrorInfo,level:o};e.details&&e.details.helpLink&&(l.helpLink=e.details.helpLink),e.requestId&&(l.requestId=e.requestId),this.services.errorService.error(n.message,r,l)},t.prototype.logVisualWarning=function(t,i,r){this.services.telemetryService.logEvent(e.telemetry.VisualWarning,t,void 0,!1,e.telemetry.ErrorSource.PowerBI,i,r)},t})();i.CanvasVisualErrorController=c})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.util.ErrorDetailsUtility,o=(function(){function t(t,i){var r=this;this.services=i,this.tooltipConfigManager={getTooltipConfig:function(){return{tooltipArrowPosition:e.common.ArrowPosition.arrowTopLeft,tooltipDelay:100,tooltipDescription:r.getWarningMessage()}}}}return t.createOptions=function(){return{additionalServices:["localizationService"]}},t.prototype.isClickable=function(){var e=this.details;return!!e&&(!_.isEmpty(e.message)||this.hasAdditionalErrorInfo(e))},t.prototype.hasAdditionalErrorInfo=function(e){return r.hasAdditionalErrorInfo(e)},t.prototype.getWarningMessage=function(){var e=this.details;if(!e)return"";var t=this.hasAdditionalErrorInfo(e)?e.message+" "+this.services.localizationService.get("VisualContainer_ClickToSeeMore"):e.message;return t},t})();i.CanvasVisualHeaderIconController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=jsCommon.JsonExtensions,n=e.explore.util.ScriptVisualsUtil,a=t.services.selectionUtils,s=e.explore.util.VisualContainerUtils,l=(function(){function i(i,o){var n=this;this.services=o,this.scope=i,this.queryVisualHostServices=this.createQueryVisualHostServices(),this.scope.showCodePanel=!1,this.scope.isMinimized=!1,this.scope.scriptInput="",this.scope.datafields=[],this.scope.dataFieldsNamesList="",this.scope.dataFrameName="",this.scope.showWarningBar=!0,this.scope.canvasResize=!1;var a=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){return n.update()})).subscribe(r.visualContainerChanged,(function(e,t){return n.update()})).subscribe(r.canvasSizeChangedEvent,(function(){return n.scope.canvasResize=!n.scope.canvasResize}));this.scope.$on("$destroy",(function(){a.unsubscribeAll()})),this.scope.togglePanel=function(){n.scope.showCodePanel=!n.scope.showCodePanel},this.scope.minimizeToggle=function(){n.scope.isMinimized=!n.scope.isMinimized,n.services.telemetryService.logEvent(e.telemetry.EXCodePaneResize,n.scope.currentHeight,!n.scope.isMinimized,n.scope.isMinimized)},this.scope.onResize=function(t){n.services.telemetryService.logEvent(e.telemetry.EXCodePaneResize,t,n.scope.isMinimized,n.scope.isMinimized)},this.scope.hideWarning=function(){n.hideWarningBar()},this.scope.runButtonClicked=function(){n.services.eventBridge.publishToChannel(t.services.events.visualContainerChanged,{affectContainer:s.contractEqualityComparator(n.scope.selectedVisual),allowCache:!1}),n.services.telemetryService.logEvent(e.telemetry.EXCodePaneUserRunScript)},this.scope.canLaunchExternalIDE=this.services.scriptVisuals.canLaunchExternalIDE(),
this.scope.launchExternalIDEClicked=function(){return n.launchExternalIDE()},this.scope.optionsButtonClicked=function(){return n.openOptionsDialog()},this.scope.scriptInputChanged=function(){n.setScriptCode(n.scope.scriptInput)},this.setAndDisplayWarning("CodePane_WarningDuplicateRowsRemoved"),this.update()}return i.createOptions=function(){return{scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","formFactor","scriptVisuals","selection","visualAuthoring","visualQueryGenerator"],additionalServices:["conceptualSchemaProxy","displayNameService","errorService","localizationService","telemetryService","visualPlugin"]}},i.prototype.update=function(){this.scope.selectedVisual=this.getSelectedVisual(),this.scope.selectedSingleVisual=this.scope.selectedVisual&&this.scope.selectedVisual.config&&this.scope.selectedVisual.config.singleVisual?this.scope.selectedVisual.config.singleVisual:null,this.visualShouldDisplayCodePane(this.scope.selectedSingleVisual)?(this.scope.showCodePanel=!0,this.scope.scriptInput=this.getScriptCode(this.scope.selectedSingleVisual),this.compareAndUpdateDatafields(this.scope.selectedSingleVisual)):this.scope.showCodePanel=!1},i.prototype.launchExternalIDE=function(){var t=this;this.services.telemetryService.logEvent(e.telemetry.EXCodePaneUserEditScriptWithExternalIDE);var r=this.services.dataSources.get(),a=!1;""===this.getScriptCode(this.scope.selectedSingleVisual)&&(a=!0,this.setScriptCode(n.defaultScript)),this.services.conceptualSchemaProxy.get(r).then((function(s){var l=t.services.visualQueryGenerator.execute({dataSources:r,config:t.scope.selectedSingleVisual,schema:s,additionalFilters:t.queryVisualHostServices.getFilters(t.services.filterGenerator,s),dataWindow:i.DefaultVisualViewPort});return a&&t.getScriptCode(t.scope.selectedSingleVisual)===n.defaultScript&&t.setScriptCode(""),!l||l.error?void t.services.telemetryService.logEvent(e.telemetry.EXCodePaneLaunchExternalIDEFailed,e.telemetry.LaunchExternalIDEFailureType.GenerateQueryFail):void t.services.scriptVisuals.launchExternalIDE(l).then((function(){t.services.telemetryService.logEvent(e.telemetry.EXCodePaneLaunchExternalIDESucceeded)}),(function(i){var r=o.tryParseJSON(i);r&&r.title&&r.message?t.services.errorService.fatalCustom(r.title,r.message,"ScriptVisual_FailedOpeningScriptEditor"):t.services.errorService.fatal(t.services.localizationService.get("CodePane_GeneralError"),"ScriptVisual_FailedOpeningScriptEditor"),t.services.telemetryService.logEvent(e.telemetry.EXCodePaneLaunchExternalIDEFailed,e.telemetry.LaunchExternalIDEFailureType.LaunchIDEFail)}))}))},i.prototype.openOptionsDialog=function(){this.services.telemetryService.logEvent(e.telemetry.EXCodePaneUserOpenOptionsDialog),this.services.scriptVisuals.openOptionsDialog()},i.prototype.getSelectedVisual=function(){return a.getSelectedVisual(this.services.selection)},i.prototype.visualShouldDisplayCodePane=function(t){if(!t||!t.visualType||!this.services.formFactor.getCurrentLayoutCapabilities().canShowCodePane())return!1;if(this.services.visualPlugin.isCustomVisual(t.visualType))return!1;var i=this.getDataViewMappings(t);return!(!i||!e.ScriptResultUtil.findScriptResultMapping(i))},i.prototype.getScriptCode=function(t){var i=this.getDataViewMappings(t);if(!i)return"";var r,o=t.objects;return o&&(r=e.ScriptResultUtil.extractScriptResultFromVisualConfig(i,o)),r||(r=e.ScriptResultUtil.extractScriptResultDefaultFromDataViewMappings(i)),r?r.source:""},i.prototype.setScriptCode=function(t){function i(e,t){var i={objectName:e.objectName,properties:{},selector:null};return i.properties[e.propertyName]=t,i}var r=e.ScriptResultUtil.findScriptResultMapping(this.getDataViewMappings());if(r&&r.script){jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(t)&&(t="");var o=r.script,n=[];n.push(i(o.source,t)),n.push(i(o.provider,"R"));var a={merge:n};this.services.visualAuthoring.persistProperties(a,this.scope.selectedSingleVisual)}},i.prototype.getDataViewMappings=function(e){var t=e||this.scope.selectedSingleVisual;if(t&&t.visualType){var i=this.services.visualPlugin.capabilities(t.visualType);if(i&&i.dataViewMappings)return i.dataViewMappings}return null},i.prototype.compareAndUpdateDatafields=function(t){var r=this;if(this.scope.datafields=[],t&&t.query&&t.query.defn&&t.query.defn.select&&!_.isEmpty(t.query.defn.select())&&t.query.projections){var o=t.query.defn.select(),n=t.query.projections,a=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(a).then((function(a){var s=e.ScriptResultUtil.getScriptInput(n,o,a,e.ScriptResultUtil.findScriptResultMapping(r.getDataViewMappings(t)),null);s&&s.Columns&&s.VariableName&&(r.scope.dataFrameName=s.VariableName,r.scope.datafields=s.Columns,r.scope.dataFieldsNamesList=i.generateDataFieldsNamesList(s.Columns))}))}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateDetailVisualFilter(r.getCurrentExploration(),r.getCurrentSection(),i.getSelectedVisual(),t,1)}}))},i.generateDataFieldsNamesList=function(e){for(var t=e,i="",r=0;r<t.length;r++)r>0&&(i+=", "),i+=t[r].Name;return i},i.prototype.setAndDisplayWarning=function(t){this.scope.warningText=this.services.localizationService.get(t),this.scope.showWarningBar=!0,this.services.telemetryService.logEvent(e.telemetry.EXCodePaneShowWarning,t)},i.prototype.hideWarningBar=function(){this.scope.warningText="",this.scope.showWarningBar=!1,this.services.telemetryService.logEvent(e.telemetry.EXCodePaneUserCloseWarning)},i.DefaultVisualViewPort={width:1,height:1},i})();i.CodePaneContainerController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.deleteVisuals=function(){return t.deleteVisuals()},this.scope.closeDialog=function(){return t.closeDialog()},this.scope.selectVisual=function(e){return t.selectVisual(e)},this.scope.visualStyle=function(e){return t.visualStyle(e)}}return e.prototype.selectVisual=function(e){e.selected=!e.selected,this.scope.viewModel.selectedVisualCount=_.filter(this.scope.viewModel.customVisuals,(function(e){return e.selected})).length},e.prototype.deleteVisuals=function(){this.closeDialog();var e=[],t=0;this.scope.viewModel.customVisuals.forEach((function(i){i.selected&&(e.push(i.plugin),t+=i.tileCount)}));var i=this.scope.$root.$new(),r=this.scope.explorationContract;i.deleteVisualService=this.scope.deleteVisualService,i.errorService=this.errorService,i.explorationContract=r,i.customVisuals=e,i.deleteVisualButtonText=this.scope.localizationService.get("DeleteVisual_Confirm"),i.deleteVisualWarningText=this.scope.localizationService.format("DeleteVisuals_WarningMessage",[e.length,t]);var o={dialogName:this.scope.localizationService.get("DeleteVisuals_WarningHeader"),isDismissable:!0,scope:i,template:"<delete-visual-warning-dialog></delete-visual-warning-dialog>",dialogCssClass:"deleteVisualWarning"};this.scope.modalDialogService.showLegacyWebModalDialog(o)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e.prototype.visualStyle=function(e){return{"background-image":e.plugin.iconUrl}},e})();e.DeleteCustomVisualsDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.deleteVisual=function(){return t.deleteVisual()},this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.deleteVisual=function(){this.closeDialog(),this.scope.deleteVisualService.deleteCustomVisuals(this.scope.explorationContract,this.scope.customVisuals)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.DeleteVisualWarningDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.data.SQExprBuilder,a=e.visuals.controls.internal.TablixObjects,s=e.explore.util.VisualContainerUtils,l=(function(){function i(e,i){var r=this;this.scope=e,this.services=i,this.dataProxy=this.services.singleExecutableDataProxyFactory.create(),this.visualDataProxyService=t.services.createExploreVisualDataProxyService(this.dataProxy,this.services.filterGenerator),this.queryVisualHostServices=this.createQueryVisualHostServices(),this.spinnerService=t.services.createDetailVisualSpinnerService(e,i.eventBridge),this.initialize(),this.scope.$on("$destroy",(function(){r.subscriptionManager&&r.subscriptionManager.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","featureSwitchService","geocoder","localizationService","singleExecutableDataProxyFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","visualPlugin","visualAuthoring","visualQueryGenerator"]}},i.prototype.initialize=function(){var e=this;if(!this.initializeVisual())var t=this.scope.$watch("viewModel",(function(i){e.initializeVisual()&&t()}))},i.prototype.initializeVisual=function(){var i=this;if(!this.scope.viewModel||!this.scope.viewModel.parentContract)return!1;var r=this.scope.viewModel.visual;return r.visualPlugin=this.services.visualPlugin,r.interactivityOptions={isInteractiveLegend:!1,selection:!1},r.hostServices=e.Prototype.inherit(t.services.createVisualHostServices(e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return i.persistProperties(e)},e.getLocalizedString=function(e){return i.services.localizationService.get(e)},e.getViewMode=function(){return 1}})),r.type=e.visuals.plugins.matrix.name,this.initializeMatrixContract(),this.subscriptionManager=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.visualContainerChanged,(function(e,t){t&&i.scope.viewModel.parentContract&&t.affectContainer(i.scope.viewModel.parentContract)&&i.runQuery(!1)})).subscribe(o.filterContainerChanged,(function(e,t){0===t.scope.scopeType&&t.scope.container!==i.scope.viewModel.parentContract||i.runQuery(!1)})),this.runQuery(!0),!0},i.prototype.initializeMatrixContract=function(){this.matrixContract={config:{singleVisual:{visualType:e.visuals.plugins.matrix.name}},layouts:jsCommon.ArrayExtensions.extendWithId([{id:0,position:{x:0,y:0,width:0,height:0}}])};var t={};r.setValue(t,a.PropGeneralMatrixRowSubtotals,null,n.boolean(!1)),r.setValue(t,a.PropGeneralMatrixColumnSubtotals,null,n.boolean(!1)),this.matrixContract.config.singleVisual.objects=t},i.prototype.persistProperties=function(e){var t=this.matrixContract.config.singleVisual,i=_.isArray(e)?{replace:e}:e;this.services.visualAuthoring.persistProperties(i,t)&&this.runQuery(!1,!0)},i.prototype.runQuery=function(e,t){var i=this;if(this.scope.viewModel&&this.scope.viewModel.parentContract){var r=this.scope.viewModel.parentContract,o=this.services.dataSources.get();o&&r.config&&r.config.singleVisual&&(this.spinnerService.startSpinner(),this.services.conceptualSchemaProxy.get(o).then((function(r){var n=i.scope.viewModel.parentContract,a={dataSources:o,schema:r,config:n.config.singleVisual,hostServices:i.queryVisualHostServices,visualQueryGenerator:i.services.visualQueryGenerator,isLoadMore:!1,preferCurrentData:t};return i.visualDataProxyService.runQuery(a).then((function(t){return i.onDataChanged(t,e)}),(function(t){return i.clearData("Query error",e)}))}),(function(t){return i.clearData("Conceptual schema error",e)})).finally((function(){return i.spinnerService.stopSpinner()})))}},i.prototype.clearData=function(t,i){var r=this.scope.viewModel,o=r.hasData&&r.visual.data&&r.visual.data.dataView;(o||i)&&this.services.telemetryService.logEvent(e.telemetry.EXSeeDataNoMatrixData,s.getVisualType(r.parentContract),t);var n={dataView:{metadata:{columns:[]},matrix:{rows:{root:{children:[],childIdentityFields:[]},levels:[]},columns:{root:{children:[]},levels:[]},valueSources:[]}},dataViewSource:null};this.scope.viewModel.visual.dataTransforms={},this.scope.viewModel.visual.data=n,this.scope.viewModel.hasData=!1},i.prototype.onDataChanged=function(e,i){var r;if(r=e?{dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null,dataViewSource:e&&e.dataViewSource?e.dataViewSource:null}:this.scope.viewModel.visual.data){if(r.dataView&&!r.dataView.matrix){var o="No matrix data view";return void this.clearData(o,i)}var n=s.isSegment(r.dataView);n&&(r.isFirstSegment=n);var a;if(null!=r.dataView){var l=this.visualDataProxyService.lastExecutedQuery(),c=s.getDataRolesForVisual(this.scope.viewModel.parentContract,this.services.visualPlugin),u=_.map(c,(function(e){return e.name}));if(a=t.util.MatrixVisualDataViewConverter.generate(r.dataView,l.transforms.selects,u,l.transforms.roles&&l.transforms.roles.ordering,this.services.featureSwitchService),!a)return void this.clearData("Failed to generate data view transform actions",i);a.objects=this.matrixContract.config.singleVisual.objects}this.scope.viewModel.visual.dataTransforms=a,this.scope.viewModel.visual.data=r,this.scope.viewModel.hasData=!0}},i.prototype.createQueryVisualHostServices=function(){var i=this;return e.Prototype.inherit(t.util.VisualHostServicesUtil.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){var r=i.services.explorationNavigation;return e.calculateDetailVisualFilter(r.getCurrentExploration(),r.getCurrentSection(),i.scope.viewModel.parentContract,t,1)}}))},i})();i.DetailVisualController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){var i=this;this.services=t,this.scope=e,this.errorService=this.services.errorService,this.modalDialog=this.errorService.control(),this.scope.acceptTermsOfService=function(){return i.acceptTermsOfService()},this.scope.rejectTermsOfService=function(){return i.rejectTermsOfService()},this.scope.byClickingText=this.services.localizationService.format("EsriConsentDialog_ByClicking",['<a href="https://go.microsoft.com/fwlink/?LinkID=826322" target="_blank">'+this.services.localizationService.get("EsriConsentDialog_Terms")+"</a>",'<a href="https://go.microsoft.com/fwlink/?LinkID=826323" target="_blank">'+this.services.localizationService.get("EsriConsentDialog_PrivacyPolicy")+"</a>"])}return e.createOptions=function(){return{additionalServices:["errorService","localizationService"]}},e.prototype.acceptTermsOfService=function(){this.closeDialog(),this.scope.esriConsentDialogCallback(!0)},e.prototype.rejectTermsOfService=function(){this.closeDialog(),this.scope.esriConsentDialogCallback(!1)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.EsriConsentDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.scope.isMasterFormFactor=function(){return 0===t.formFactor.getCurrentLayout()},this.scope.isMobileLayoutAuthoring=function(){return 0!==t.formFactor.getCurrentLayout()&&1===t.viewModeState.getMode()}}return e.createOptions=function(){return{scopedDependencies:["formFactor","viewModeState"]}},e})();e.ExplorationController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.overridePosition||e.position;return{height:t.height,width:t.width,top:t.y,left:t.x}}function o(t){return 0!==t.contract.popOutMode?e.common.constants.MaxSupportedZIndexValue:t.position.z}var n=e.explore.util.CanvasDisplayUtility,a=e.explore.controllers.canvas.CanvasLayoutGrid,s=i.canvas.CanvasLayoutGridStrategy,l=t.util.CanvasVisualsUtility,c=e.common.constants,u=i.canvas.DefaultLayoutStrategy,d=e.explore.components.DotGridComponent,p=i.canvas.DotGridLayoutStrategy,v=e.explore.util.DragDropTypes,h=e.common.directives.DragDropUtils,g=e.explore.constants.ExploreCanvasConstants,f=e.explore.services.events,m=e.visuals.shapes.Rect,y=e.common.directives.SwipeDirections,w=e.explore.util.VisualContainerUtils;i.CursorClass={Brush:"brush-cursor"};var C={width:0,height:0},S=0,b=0,x=(function(){function x(i,r){var o=this;this.uiScale=x.DefaultNoUiScale,this.isDraggingVisual=!1,this.scope=i,this.model=i.viewModel,this.services=r,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(i),this.scope.displayOptionServices={canvasScale:this.services.canvasScale,viewModeState:this.services.viewModeState,formFactor:this.services.formFactor},this.viewModeState=this.services.viewModeState,this.scope.clearSelection=function(e){o.scope.viewModel.preventSelectionClearing||t.util.EventBubblingUtility.handled(e)||(o.services.selection.clearSelection(),o.services.overlayService.hideAllDropdowns(),o.services.clipboard.clearFormatData())},this.showDotGrid=r.settingsService.getShowGridlines(),this.snapToDotGrid=r.settingsService.getSnapToGrid(),this.scope.keyDown=function(e){return o.onKeyDown(e)},this.scope.swipeHorizontally=function(e){return o.onHorizontalSwipe(e)},this.scope.drop=function(e,t){return o.drop(e,t)},this.scope.dropConfig={accept:v.Field+" "+v.VisualContainerThumbnail},this.scope.getExploreCanvasClass=function(){return o.getClass()},this.scope.shouldDisableZoom=function(){return o.shouldDisableZoom()},this.scope.canPinch=function(){return o.canPinch()},this.scope.canSwipe=function(){return o.canSwipe()},this.scope.isCanvasBackdropVisible=function(){return o.isCanvasBackdropVisible()},this.scope.showBoxGrid=function(){return o.services.formFactor.getCurrentLayoutCapabilities().canShowLayoutGrid()&&1===o.services.formFactor.getCurrentLayout()},this.scope.showDotGrid=function(){return o.showDotGrid&&o.services.formFactor.getCurrentLayoutCapabilities().canShowLayoutGrid()&&0===o.services.formFactor.getCurrentLayout()},this.scope.snapToDotGrid=function(){return o.snapToDotGrid&&0===o.services.formFactor.getCurrentLayout()},this.scope.adjustScaleForLayout=function(e){return o.adjustScaleForLayout(e)},this.subscribeToEvents(),this.scope.$watch("size",(function(e){if(e){var i=o.services.canvasScale.getDisplayOption();o.scope.useResponsiveLayout=e.width<=t.constants.ExploreCanvasConstants.ResponsiveLayoutMaxWidthBreakpoint&&o.scope.viewModel&&o.scope.viewModel.contract&&0===i,o.updateSize(),o.services.eventBridge.publishToChannel(f.canvasSizeChangedEvent)}})),this.updateCanvasLayoutSize(),this.updateLayoutStrategy(),this.scope.$watch("viewModel.contract.objects",(function(e){n.updateAndApplyCanvasBackground(o.scope,o.services.$element,e,o.services.featureSwitchService,o.services.resourceLoader,o.services.explorationNavigation,o.services.promiseFactory,o.services.formFactor)}),!0),this.scope.$watchCollection("viewModel.visualContainers",(function(){o.scaleVisualContainersToCanvas(o.uiScale),o.scope.viewModel&&o.services.loadProgressNotificationService.reset()})),this.scope.canvasOptions||(this.scope.canvasOptions={autoLayoutVisualPadding:t.constants.ExploreCanvasConstants.AutoLayoutVisualPadding,scrollbarOffset:t.constants.ExploreCanvasConstants.ScrollbarOffset}),this.services.loadProgressNotificationService.register(this)}return x.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dragDataService","layoutInsertionHelper","$element","featureSwitchService","linguisticSchemaProxy","telemetryService","overlayService","dropdownMenuService","promiseFactory","loadProgressNotificationService","settingsService"],scopedDependencies:["canvasScale","canvasKeyHandler","canvasScale","clipboard","dataSources","eventBridge","explorationNavigation","formFactor","layoutAuthoring","popOut","resourceLoader","selection","undoRedo","viewModeState","visualAuthoring","visualQueryGenerator"]}},x.prototype.isScrollablePhoneAuthoring=function(){return 0!==this.services.formFactor.getCurrentLayout()&&1===this.services.viewModeState.getMode()},x.prototype.shouldTrackLoadProgress=function(){var e=!1,t=this.scope.viewModel&&this.scope.viewModel.visualContainers.length>0;if(t){var i=this.services.dataSources.get();if(i)for(var r=0,o=this.scope.viewModel.visualContainers;r<o.length;r++){var n=o[r];if(this.services.visualQueryGenerator.shouldExecute(n.contract.config.singleVisual,i)){e=!0;break}}}return e},x.prototype.onHorizontalSwipe=function(e){var i=this.isNextSection(e)?t.constants.explorationNextPageEvent:t.constants.explorationPreviousPageEvent;this.scope.$root.$emit(i,t.services.SectionNavigationAction.Swipe)},x.prototype.subscribeToEvents=function(){var e=this,i=this.services.eventBridge.createChannelSubscriptionManager().subscribe(f.selectionChanged,(function(){return e.onSelectionChanged()})).subscribe(f.explorationLoaded,(function(){return e.onExplorationLoaded()})).subscribe(f.explorationUnloaded,(function(t,i){return e.onExplorationUnloaded()})).subscribe(f.canvasDisplayChanged,(function(t,i){return e.applyFitOption(i)})).subscribe(f.canvasDimensionChanged,(function(t,i){return e.updateCanvasDimension(i)})).subscribe(f.align,(function(t,i){return e.alignVisuals(i)})).subscribe(f.canvasBackgroundChanged,(function(t,i){return e.updateCanvasBackground(i)})).subscribe(f.popOutModeChanged,(function(){return e.onPopOutModeChanged()})).subscribe(f.clipboardDataUpdated,(function(){return e.onClipboardDataUpdated()})).subscribe(f.formFactorChanged,(function(){return e.onFormFactorChanged()}));this.scope.$watch((function(){return e.services.settingsService.getShowGridlines()}),(function(){return e.onShowGridlinesChanged()})),this.scope.$watch((function(){return e.services.settingsService.getSnapToGrid()}),(function(){return e.onSnapToGridChanged()})),this.scope.$on("$destroy",(function(){return i.unsubscribeAll()})),this.scopeEventManager.subscribe(t.constants.TransformElementDragStartEventName,(function(t,i){e.onDragStartPosition={x:i.x,y:i.y,width:i.width,height:i.height},e.isDraggingVisual=!0})).subscribe(t.constants.TransformElementDragMoveEventName,(function(t,i){e.moveSelectedContainersWrapper(t,i)})),this.services.eventBridge.subscribeToBubbling(this.scope,f.deleteVisualContainer,(function(t,i){e.services.visualAuthoring.deleteVisualContainer(i,e.scope.viewModel),t.stopPropagation&&t.stopPropagation()})),this.services.eventBridge.subscribeToBubbling(this.scope,f.removeVisualContainerFromLayout,(function(t,i){e.services.layoutAuthoring.removeLayoutFromVisualContainer(e.scope.viewModel,i),t.stopPropagation&&t.stopPropagation()}))},x.prototype.onShowGridlinesChanged=function(){this.showDotGrid=this.services.settingsService.getShowGridlines(),this.scope.applyFitOption()},x.prototype.onSnapToGridChanged=function(){this.snapToDotGrid=this.services.settingsService.getSnapToGrid(),this.updateLayoutStrategy()},x.prototype.applyFitOption=function(e){this.services.canvasScale.setDisplayOption(e),this.scope.applyFitOption()},x.prototype.moveSelectedContainersWrapper=function(e,t){var i=this,r=this.services.selection.getSelectedElements().length>1&&this.services.formFactor.getCurrentLayoutCapabilities().canMoveMultipleVisuals();r&&(this.isDraggingVisual?(this.isDraggingVisual=!1,this.services.undoRedo.register("MoveSelectedVisualContainers",(function(){i.moveSelectedContainers(e,t)}))):this.moveSelectedContainers(e,t))},x.prototype.alignVisuals=function(e){var t={width:this.model.width,height:this.model.height};this.services.layoutAuthoring.alignSelectedVisuals(e.alignmentType,t,l.getSelectedCanvasVisualContainers(this.scope.viewModel,this.services.selection)),this.scope.$broadcast(c.VisualSelectionOrPositionChangedEventName)},x.prototype.moveSelectedContainers=function(e,t){for(var i=this.onDragStartPosition,r={x:i.x-t.x,y:i.y-t.y,width:0,height:0},o=l.convertFromScaledPosition(r,this.uiScale),n=0,a=this.model.visualContainers;n<a.length;n++){var s=a[n];if(s.isSelected){var c=_.cloneDeep(s.position);c.x-=o.x,c.y-=o.y,this.services.layoutAuthoring.moveVisualContainer(s,c)}}i.x=t.x,i.y=t.y},x.prototype.updateCanvasDimension=function(e){var i=this;this.services.undoRedo.register("UpdateCanvasDimension",(function(){i.scope.viewModel.contract.size=e;var r=i.services.explorationNavigation.getCurrentExploration(),o=i.services.explorationNavigation.getCurrentSection(),n=t.viewModels.PagePropertyPaneViewModelFactory.getPageSizeType(e);t.PodUtils.setCortanaEnabled(r,o.name,n===t.viewModels.PagePropertyPaneViewModelFactory.PageSizeTypes.Cortana,i.services.linguisticSchemaProxy)}))},x.prototype.updateCanvasBackground=function(e){var t=this;this.services.undoRedo.register("UpdateCanvasBackground",(function(){t.scope.viewModel.contract.objects=e.objects}))},x.prototype.onPopOutModeChanged=function(){this.scope.hasPopOut=!!this.services.popOut.getPoppedOutVisualContainer(),this.updateSizeAndFitOption(),this.updateAndApplyCanvasBackground()},x.prototype.onFormFactorChanged=function(){this.updateSizeAndFitOption(),this.updateLayoutStrategy(),this.updateAndApplyCanvasBackground()},x.prototype.updateAndApplyCanvasBackground=function(){if(this.scope.viewModel){var e=this.scope.viewModel.contract.objects;n.updateAndApplyCanvasBackground(this.scope,this.services.$element,e,this.services.featureSwitchService,this.services.resourceLoader,this.services.explorationNavigation,this.services.promiseFactory,this.services.formFactor)}},x.prototype.updateSizeAndFitOption=function(){var e=this.scope.viewModel;e&&(this.scope.applyFitOption(),this.updateSize())},x.prototype.updateLayoutStrategy=function(){var e,i=this.services.formFactor.getCurrentLayout(),r=this.services.formFactor.getCurrentLayoutCapabilities(),o=t.viewModels.VisualContainer.getVisualBodyOffset(r);switch(i){case 1:var n=t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout;e=new s({rows:n.rowCount,cols:n.columnCount,rowSpacing:b,colSpacing:S});break;default:if(this.scope&&this.scope.snapToDotGrid&&this.scope.snapToDotGrid()){var a=void 0,l=void 0,c=this.scope.dotGridViewModel,v=this.scope.canvasLayoutSize;c?(a=c.layoutX,l=c.layoutY):(a=d.getLayoutForScreen(this.uiScale.x*v.width,v.width),l=d.getLayoutForScreen(this.uiScale.y*v.height,v.height));var h={layoutX:a,layoutY:l,offset:o,limits:{left:0,top:0,width:v.width,height:v.height}};e=new p(h)}else e=new u(o)}this.scope.layoutStrategy=e,this.updateGridLayout()},x.prototype.adjustScaleForLayout=function(e){return this.scope.showDotGrid()?d.adjustScaleForGrid(e,this.scope.canvasLayoutSize):e},x.prototype.updateGridLayout=function(){this.model&&(this.updateBoxGridLayout(),this.updateDotGridLayout())},x.prototype.updateDotGridLayout=function(){var e=this.scope.canvasLayoutSize,t=this.scope.dotGridViewModel,i=!t,r=d.getLayoutForScreen(this.uiScale.x*e.width,e.width),o=t&&t.layoutX;i||(i=!d.sameLayout(r,o));var n=d.getLayoutForScreen(this.uiScale.y*e.height,e.height),a=t&&t.layoutY;i||(i=!d.sameLayout(n,a)),i&&(this.scope.dotGridViewModel={layoutX:r,layoutY:n})},x.prototype.updateBoxGridLayout=function(){var e,i=t.viewModels.FixedPhoneCanvasSettings.phoneGridLayout;switch(this.services.formFactor.getCurrentLayout()){case 1:var r={rows:i.rowCount,cols:i.columnCount,rowSpacing:b,colSpacing:S},o=a.getCellSize({width:this.model.width,height:this.model.height},r);e={columnCount:i.columnCount,rowCount:i.rowCount,layout:{horizontal:{margin:S,gutter:S,size:o.width},vertical:{margin:b,gutter:b,size:o.height}}};break;default:e=void 0}this.scope.boxGridLayout=e},x.prototype.autoLayoutVisualVCHeader=function(){return n.getAutoLayoutVisualVCHeader(this.services.formFactor)},x.prototype.updateSize=function(){var e=this.scope.size;if(this.model=this.scope.viewModel,e&&this.model){var t=this.services.canvasScale.getDisplayOption();if(0===t){var i=this.services.viewModeState.getConfig(),r=i.displayOptions.hideTileMenu?e.height:e.height-this.autoLayoutVisualVCHeader(),o=e.width-2*g.ExploreCanvasPadding;this.uiScale={x:o/this.model.width,y:r/this.model.height}}else{var n=this.services.canvasScale.getCanvasScaleFactor();this.uiScale={x:n,y:n}}this.scaleVisualContainersToCanvas(this.uiScale),this.updateCanvasLayoutSize(),this.updateLayoutStrategy()}},x.prototype.updateCanvasLayoutSize=function(){var e=this.scope.viewModel;e?this.scope.canvasLayoutSize={width:e.width,height:e.height}:this.scope.canvasLayoutSize=C,this.updateGridLayout()},x.prototype.scaleVisualContainersToCanvas=function(e){var i=this;if(this.model=this.scope.viewModel,this.model){for(var r=this.model.visualContainers,o=!!this.services.popOut.getPoppedOutVisualContainer(),n=this.services.canvasScale.getDisplayOption(),a=this.scope.viewModel.contract.size&&3!==n&&0!==n,s=0,l=r;s<l.length;s++){var c=l[s];if(c.uiScale=e,c.enableVisualScaling=a,!c.isPositioned){var u=this.getEmptyRawCanvasSpaces();u.z=r.length,this.services.layoutAuthoring.moveVisualContainer(c,u)}o?this.setVisualContainerSizeForPopOutMode(c):this.scope.useResponsiveLayout||(c.overridePosition=null,c.updateViewState()),this.scope.canvasOptions.disableDeferredRendering&&(c.allowDeferredRendering=!1)}if(this.scope.useResponsiveLayout&&!o)for(var d=0,p=_.sortBy(r,(function(e){return e.position.y*i.model.width+e.position.x})),v=0,h=p;v<h.length;v++){var c=h[v],g=c.getScaledPosition();d+=20,c.overridePosition={width:this.scope.size.width-2*t.constants.ExploreCanvasConstants.AutoLayoutVisualSkittlesRightPadding,height:g.height,x:t.constants.ExploreCanvasConstants.AutoLayoutVisualSkittlesRightPadding,y:d},d+=Math.round(g.height),c.updateViewState()}}},x.prototype.setVisualContainerSizeForPopOutMode=function(e){if(e.isPoppedOut){var i=this.services.formFactor.getCurrentLayoutCapabilities(),r=t.viewModels.VisualContainer.getVisualBodyOffset(i),o=this.scope.size.height,n=this.scope.size.width,a=this.services.canvasScale.getDisplayOption();if(0!==a){var s=this.services.canvasScale.getCanvasScaleFactor();o=this.scope.viewModel.height*s-r.height,n=this.scope.viewModel.width*s-r.width}e.overridePosition={width:n,height:o,x:-r.left,y:-r.top},e.updateViewState()}},x.prototype.onSelectionChanged=function(){this.getFocusOnClearSelection(),this.updateZIndexOnSelectionChanged()},x.prototype.onExplorationLoaded=function(){this.updateAndApplyCanvasBackground()},x.prototype.onExplorationUnloaded=function(){this.services.dropdownMenuService.hideMenu(),this.scope.suspendSizeUpdates&&this.scope.suspendSizeUpdates()},x.prototype.isCanvasBackdropVisible=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canShowCanvasBackdrop()},x.prototype.getFocusOnClearSelection=function(){var e=this.services.selection;_.isEmpty(e.getSelectedElements())&&(this.scope.hasFocus=!0)},x.prototype.updateZIndexOnSelectionChanged=function(){this.scope.viewModel&&l.moveSelectedItemToFront(this.scope.viewModel.visualContainers,this.services.selection)},x.prototype.getEmptyRawCanvasSpaces=function(){if(this.scope.size){var e={x:0,y:0,width:this.model.width,height:this.model.height},i=_.map(this.model.visualContainers,(function(e){var t=e.position;return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}})),r=this.services.layoutInsertionHelper.getEmptySpaces(e,i);if(r.length>0){var o=r[0];o.height=Math.min(o.height,t.constants.ExploreCanvasConstants.AutoLayoutMaxSpaceHeight),o.width=Math.min(o.width,t.constants.ExploreCanvasConstants.AutoLayoutMaxSpaceWidth);var a=this.scope.canvasOptions.autoLayoutVisualPadding,s=this.autoLayoutVisualVCHeader();return o.x+=a,o.y+=s,o.width-=2*a,o.height-=2*a,o}}return n.DefaultVisualPosition},x.prototype.drop=function(e,i){
var r=this,o=this.services.dragDataService.getDragContext();if(o){var a={left:0,top:0};if(e.target){var s=$(e.target).find(n.VisualContainerHostSelector.selector);s&&(a=s.offset())}var c,u=e.pageX-a.left,d=e.pageY-a.top,p=this.services.canvasScale.getDisplayOption();if(0===p&&(c=this.uiScale),o.field){var v=this.services.formFactor.getCurrentLayoutCapabilities(),g=t.viewModels.VisualContainer.getVisualBodyOffset(v),f=u,m=d;this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(m-=g.top);var y=c;if(!y){var w=this.services.canvasScale.getCanvasScaleFactor();y={x:w,y:w}}var C=f/y.x,S=m/y.y;if(h.tryFindChildDropTarget(i.draggable,(function(){return r.getVisualContainerFromCoordinate(C,S)})))return}var b=this.scope.layout.getDropPosition(u,d,c);if(b){var x=n.rectToVisualPosition(b);if(o.field)x.z=l.getZIndexForNewVisual(this.scope.viewModel),this.addVisual(o.field,x);else if(o.source){var D=o.source;this.services.layoutAuthoring.addLayoutToVisualContainer(this.scope.viewModel,D,x)}}}},x.prototype.getVisualContainerFromCoordinate=function(e,t){var i={x:e,y:t},n=this.scope.viewModel.visualContainers,a=_.filter(n,(function(e){return m.containsPoint(r(e),i)}));if(!_.isEmpty(a)){var s=_.max(a,(function(e){return o(e)}));return s.contract}},x.prototype.addVisual=function(t,i){var r=this,o=this.services.dataSources.get();o&&this.services.visualAuthoring.addVisualContainer({expr:t,dataSources:o,allowAggregate:!0},this.scope.viewModel,i).then((function(t){r.services.telemetryService.logEvent(e.telemetry.EXCreateVisual,e.telemetry.HowVisualWasCreated.DraggedToCanvas,w.getVisualType(t))}))},x.prototype.onKeyDown=function(e){return this.services.canvasKeyHandler.onKeyDown(e,this.scope.viewModel)},x.prototype.isNextSection=function(e){var t=e.type===y[y.Left];return t},x.prototype.onClipboardDataUpdated=function(){this.updateCanvasCursor()},x.prototype.updateCanvasCursor=function(){var e=this.services.clipboard.canPasteFormat();this.setCursorClass(e?i.CursorClass.Brush:void 0)},x.prototype.setCursorClass=function(e){this.scope.customCursorClass=e},x.prototype.shouldDisableZoom=function(){return this.viewModeState.getConfig().touchOptions.disableTouchZoom},x.prototype.getClass=function(){var e=["exploreCanvas"];return this.scope.disableAnimations&&e.push("disableAnimations"),this.scope.useResponsiveLayout&&e.push("responsive"),this.scope.hasPopOut&&e.push("popOut"),this.scope.customCursorClass&&e.push(this.scope.customCursorClass),this.shouldDisableZoom()&&e.push("disableTouchZoom"),this.isScrollablePhoneAuthoring()&&e.push("scrollablePhoneAuthoring"),e.join(" ")},x.prototype.canSwipe=function(){var e=this.services.viewModeState.getConfig();return e.touchOptions.isCanvasSwipeable},x.prototype.canPinch=function(){return!(this.viewModeState&&this.viewModeState.getConfig().touchOptions.disableCanvasPinch)},x.DefaultNoUiScale={x:1,y:1},x})();i.ExploreCanvasController=x})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=t.viewModels.ExplorationAppBarViewModelFactory,n=e.explore.services.selectionUtils,a=jsCommon.StringExtensions,s=(function(){function i(t,i){var a=this;this.services=i,this.scope=t,this.viewModeState=this.services.viewModeState,this.viewMenuActions=o.createViewMenuActions(this.services.localizationService,this.services.settingsService,1===this.viewModeState.getMode(),this.getDisplayOption()),this.exploreMenuActions=o.createExploreMenuActions(this.services.localizationService),this.shapeMenuActions=o.createShapeMenuActions(this.services.localizationService),this.fileMenuActions=this.createFileMenuActions(),this.alignActions=o.createAlignmentMenuActions(this.services.localizationService),this.distributeActions=o.createDistributeMenuActions(this.services.localizationService),this.services.featureSwitchService.featureSwitches.pauseQueriesEnabled&&(this.canPause=!0),this.scope.$watchGroup(["$ctrl.viewModel.exploration.contract.reportId","$ctrl.viewModel.canEdit"],(function(){a.fileMenuActions=a.createFileMenuActions(),a.updateReportMoreOptionsMenuItems()})),this.scope.$watch("$ctrl.viewModeState.getMode()",(function(e){a.fileMenuActions=a.createFileMenuActions(),a.viewMenuActions=o.createViewMenuActions(a.services.localizationService,a.services.settingsService,1===e,a.getDisplayOption());var t=1===e||2;t?a.scope.$emit("EditMode"):t||(a.scope.$emit("ViewMode"),a.viewModeState.updateConfig((function(e){e.showRelationships&&(e.showRelationships=!1)})))})),this.scope.$watch("$ctrl.viewModel.isReportFromPbix",(function(){var e=a.viewModel&&a.viewModel.isReportFromPbix;a.editReportMenuActions=o.createEditReportMenuActions(a.services.localizationService,e),a.fileMenuActions=a.createFileMenuActions()})),this.scope.$watchGroup(["$ctrl.viewModel.exploration.exploreCanvas.contract.size.displayOption","$ctrl.services.settingsService.getShowGridlines()","$ctrl.services.settingsService.getSnapToGrid()"],(function(e){a.updateViewMenu(e[0])}));var s=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.popOutModeChanged,(function(){a.isPopOutMode=!!a.services.popOut.getPoppedOutVisualContainer(),a.updateExploreMenuStates()})).subscribe(r.canvasChanged,(function(){var e=a.services.explorationNavigation.getCurrentSection();a.isTransientPage=e.transient})).subscribe(r.visualContainerChanged,(function(e,t){t&&t.affectContainer(n.getSelectedVisual(a.services.selection))&&a.updateExploreMenuStates()})).subscribe(r.drillModeChanged,(function(e,t){t&&t.visualContainer===n.getSelectedVisual(a.services.selection)&&a.updateExploreMenuStates()})).subscribe(r.selectionChanged,(function(){a.updateExploreMenuStates()})),l=this.services.rootScope.$on(e.common.constants.onReportChangedEventName,(function(e,t){a.pinnedToReportPage&&(a.pinReportPage(),a.pinnedToReportPage=!1)}));this.scope.$on("$destroy",(function(){s.unsubscribeAll(),l()}))}return i.createOptions=function(){return{additionalServices:["activeGroupId","localizationService","modalDialogService","embedProxy","embed","explorationSerializer","featureSwitchService","errorService","checkUnsavedService","reportTileService","telemetryService","$window","analyzeInExcel","powerBIDesktopLauncher","overlayService","auditing","downloadReport","subscription","userInfo","settingsService"],scopedDependencies:["canvasScale","eventBridge","viewModeState","explorationNavigation","popOut","drill","selection","visualAuthoring"]}},i.prototype.updateReportMoreOptionsMenuItems=function(){this.viewModel.reportPermission&&(this.reportMoreOptionsMenu=o.createReportMoreOptionsMenuItems(this.services.localizationService,this.services.analyzeInExcel,this.services.featureSwitchService,this.viewModel.reportPermission,this.canGenerateQR()))},i.prototype.isSnapshotAllowed=function(){var e=this.services.featureSwitchService.featureSwitches,t=e.snapshotEmbedEnabled||e.anonymousEmbeddingEnabled,i=this.viewModel,r=i&&i.canEdit&&i.canWrite,o=this.viewModel.exploration,n=o&&o.contract&&void 0!==o.contract.reportId,a=i.datasetModel,s=a&&a.contract,l=a&&a.cloudRlsEnabled,c=s&&s.originalModelId,u=s&&s.onPremModelConnectionString,d=this.services.featureSwitchService.featureSwitches.publishToWebEnabled,p=this.services.activeGroupId.isReadOnly;return t&&!p&&r&&n&&!c&&!u&&d&&!l},i.prototype.isSharePointEmbedAllowed=function(){var e=this.services.featureSwitchService.featureSwitches.sharePointEmbedEnabled,t=this.services.userInfo.isPremiumUser,i=this.viewModel.exploration,r=i&&i.contract&&i.contract.report&&void 0!==i.contract.report.objectId;return e&&t&&r},i.prototype.isExportToPowerPointAllowed=function(){var e=this.services.featureSwitchService.featureSwitches,t=e.exportReportToPowerPointEnabled&&e.exportToPowerPointEnabled,i=this.viewModel.exploration,r=i&&i.contract&&void 0!==i.contract.reportId;return t&&r},i.prototype.canDuplicatePage=function(){var e=this.services.viewModeState;return 1===e.getMode()&&this.viewModel.canWrite&&!this.isPopOutMode&&!this.isTransientPage},i.prototype.canPinPage=function(){var e=this.viewModel;return e&&e.exploration&&e.exploration.contract.reportId&&e.canWrite&&!this.isTransientPage},i.prototype.canGenerateQR=function(){return this.viewModel&&this.viewModel.exploration&&void 0!==this.viewModel.exploration.contract.reportId},i.prototype.getFileMenuActions=function(){var e,t,i;return this.fileMenuActions.forEach((function(r,o,n){2===r.action&&(e=r),3===r.action&&(t=r),8===r.action&&(i=r)})),e&&(e.show=this.isSnapshotAllowed()),t&&(t.show=this.isSharePointEmbedAllowed()),i&&(i.show=this.isExportToPowerPointAllowed()),this.fileMenuActions},i.prototype.onEmbed=function(){var i=this.scope.$new(!0),r=this.viewModel.exploration.contract.reportId,o=this.services.explorationNavigation.getCurrentSection(),n=this.viewModel.displayName+" - "+o.displayName,a={reportSections:[o.id]},s={name:n,reportId:r,culture:e.common.cultureInfo,size:{height:this.viewModel.exploration.contract.height,width:this.viewModel.exploration.contract.width},version:e.build,metadata:JSON.stringify(a)},l=this.services.embedProxy.getLiveEmbedsForReport(r);i.viewModel=t.viewModels.ViewModelFactory.createEmbedModalDialog(this.services.localizationService,this.services.embed,this.viewModel.exploration,s,l,this.viewModel.exploration.contract.sections);var c=_.filter(i.viewModel.embedTab.sections,(function(e){return e.contract.name===o.name}))[0];i.viewModel.embedTab.selectedSection=c;var u={containerCssClass:"small embedContainer",dialogCssClass:"embedDialog",dialogName:null,template:"<embed-modal-dialog></embed-modal-dialog>",scope:i};this.services.modalDialogService.showLegacyWebModalDialog(u)},i.prototype.onSharepointEmbed=function(){var i=this.scope.$new(!0),r={name:this.viewModel.displayName,reportId:null,culture:e.common.cultureInfo,size:{height:this.viewModel.exploration.contract.height,width:this.viewModel.exploration.contract.width},version:e.build,metadata:null};i.viewModel=t.viewModels.ViewModelFactory.createSharepointEmbedModalDialog(this.viewModel.exploration,r);var o={containerCssClass:"embedContainer",dialogCssClass:"spEmbedDialog",dialogName:null,template:"<embed-modal-dialog></embed-modal-dialog>",scope:i};this.services.modalDialogService.showLegacyWebModalDialog(o)},i.prototype.insertTextbox=function(){this.services.eventBridge.publishToChannel(r.createTextbox)},i.prototype.showReportMoreOptionsMenu=function(){return!_.isEmpty(this.reportMoreOptionsMenu)},i.prototype.fileMenuActionSelected=function(e){if(!e.disabled)switch(e.action){case 0:this.save();break;case 1:this.services.eventBridge.publishBubbling(this.scope,r.saveAsExploration);break;case 2:this.onEmbed();break;case 3:this.onSharepointEmbed();break;case 5:this.print();break;case 6:this.showDiagnosticInfo();break;case 8:this.exportToPowerPoint();break;case 9:this.downloadReport()}},i.prototype.createFileMenuActions=function(){var e=this.services.featureSwitchService.featureSwitches,t={localizationService:this.services.localizationService,showSave:1===this.viewModeState.getMode(),showSaveAs:this.viewModel&&this.viewModel.canEdit,showPrint:e.printingEnabled!==!1,showEmbed:!1,showSharepointEmbed:!1,showPowerPoint:!1,showDiagnostics:e.diagnostics,showDownloadReport:e.downloadReportEnabled&&e.exportDataEnabled&&this.viewModel&&this.viewModel.canEdit,canDownloadReport:this.viewModel&&this.viewModel.isReportFromPbix};return o.createFileMenuActions(t)},i.prototype.showDiagnosticInfo=function(){if(this.viewModel.exploration&&this.viewModel.exploration.contract){var e=this.services.rootScope.$new(),t=this.services.explorationSerializer.serializeExploration(this.viewModel.exploration.contract),i=a.stringifyAsPrettyJSON(t),r={dialogName:"",isDismissable:!0,scope:e,template:"<custom-modal-dialog></custom-modal-dialog>",dialogCssClass:"monotype",notificationText:i};this.services.modalDialogService.showLegacyWebModalDialog(r)}},i.prototype.alignActionSelected=function(e){switch(e.action){case 25:this.align(0);break;case 26:this.align(1);break;case 27:this.align(2);break;case 28:this.align(3);break;case 29:this.align(4);break;case 30:this.align(5)}},i.prototype.distributeActionSelected=function(e){switch(e.action){case 31:this.align(6);break;case 32:this.align(7)}},i.prototype.align=function(e){var t={alignmentType:e};this.services.eventBridge.publishToChannel(r.align,t)},i.prototype.print=function(){window.print(),this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsPrint,e.telemetry.PrintType.Report);var t=this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.reportId;this.services.auditing.auditEvent(t,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.printReport)},i.prototype.save=function(){this.services.eventBridge.publishBubbling(this.scope,r.saveExploration)},i.prototype.refresh=function(){if(this.viewModel.exploration&&this.viewModel.exploration.contract){var t=this.viewModel.exploration.contract;t.report&&this.services.telemetryService.logEvent(e.telemetry.EXRefreshReport,t.report.objectId,t.activeSectionIndex)}this.services.eventBridge.publishBubbling(this.scope,r.refreshExploration)},i.prototype.edit=function(){this.services.eventBridge.publishToChannel(r.changeViewMode,1)},i.prototype.stopEditing=function(){this.services.eventBridge.publishToChannel(r.changeViewMode,0)},i.prototype.navigateBack=function(){this.services.$window.history.back()},i.prototype.exportToPowerPoint=function(){this.services.eventBridge.publishBubbling(this.scope,r.exportToPowerPoint)},i.prototype.viewMenuActionSelected=function(e){if(null!=e.action)if(14===e.action)this.services.settingsService.setShowGridlines(!this.services.settingsService.getShowGridlines());else if(15===e.action)this.services.settingsService.setSnapToGrid(!this.services.settingsService.getSnapToGrid());else{var t=void 0;switch(e.action){case 10:t=0;break;case 11:t=3;break;case 12:t=2;break;case 13:t=1}this.services.eventBridge.publishToChannel(r.canvasDisplayChanged,t)}},i.prototype.editReportMenuActionSelected=function(e){if(this.services.overlayService.hideAllDropdowns(),!e.disabled)switch(e.action){case 16:this.edit();break;case 17:var t=this.services.activeGroupId.activeGroupObjectId,i=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report&&this.viewModel.exploration.contract.report.objectId;t&&i&&this.services.powerBIDesktopLauncher(i,t)}},i.prototype.isEditInDesktopEnabled=function(){return this.services.featureSwitchService.featureSwitches.editInDesktopEnabled},i.prototype.shapeMenuActionSelected=function(e){this.services.eventBridge.publishToChannel(r.createBasicShape,{shapeType:e.param})},i.prototype.togglePlayPause=function(){this.services.eventBridge.publishBubbling(this.scope,r.pauseQueriesChanged)},i.prototype.showSubscriptionPane=function(){var t=this,i=this.services.explorationNavigation,r=this.viewModel.datasetModel;if(r.getPermissions()===e.common.contracts.Permissions.CopyOnWrite)return void this.services.modalDialogService.showFeatureNotSupportedDialog(this.services.localizationService.get("ModalDialog_EmailSubscriptionUnSupportedContentPackTitle"),this.services.localizationService.get("ModalDialog_EmailSubscriptionUnSupportedContentPackMessage"),"https://go.microsoft.com/fwlink/?linkid=836808","emailSubscriptionDialog");var o=i.getCurrentExploration();o.report?this.services.subscription.expandPaneForReportSubscription({currentSection:i.getCurrentSection(),report:o.report,sections:o.sections,modelId:o.dataSources[0].id}):i.getCurrentExplorationAsync().then((function(e){t.services.subscription.expandPaneForReportSubscription({currentSection:i.getCurrentSection(),report:e.report,sections:o.sections,modelId:o.dataSources[0].id})}))},i.prototype.isEmailSubscriptionEnabled=function(){return 1!==this.viewModeState.getMode()&&this.services.featureSwitchService.featureSwitches.emailSubscriptionEnabled},i.prototype.showPinReportPageDialog=function(){var t=this;if(this.viewModel.canCopy)return void this.scope.$emit(e.common.constants.onReportPersonalizedEventName,this.viewModel.exploration.contract.reportId);if(1===this.viewModeState.getMode()&&this.services.checkUnsavedService.userHasUnsavedWork){var i=this.services.errorService.control(),r=this.services.localizationService.get("PinLiveReport_UnsavedTitle"),o=this.services.localizationService.get("PinLiveReport_UnsavedChangesMessage"),n=[new InJs.ModalDialogAction(this.services.localizationService.get("PinLiveReport_SaveAndPin"),function(e,r){t.save(),i.hideDialog(),t.pinnedToReportPage=!0}),new InJs.ModalDialogAction(this.services.localizationService.get("PinLiveReport_GoBack"),function(e,t){i.hideDialog()})];i.showPrompt(r,o,n,!0)}else this.pinReportPage()},i.prototype.pinReportPage=function(){var t=this.services.explorationNavigation.getCurrentSection();if(t){var i={exploration:this.viewModel.exploration,section:t,reportId:this.viewModel.exploration.contract.reportId,modelId:this.viewModel.datasetModel.id,packageId:this.viewModel.datasetModel.packageId};this.services.rootScope.$emit(e.common.constants.pinReportPageToDashboard,i)}},i.prototype.duplicateReportPage=function(){var e=this.services.explorationNavigation.getCurrentSection(),i=t.SectionUtils.findSectionIndexForSection(this.viewModel.exploration.contract,e);this.services.eventBridge.publishToChannel(r.duplicateSection,i)},i.prototype.showDatasetErrorDetails=function(){if(this.viewModel.datasetModel){var e=this.services.localizationService;this.services.errorService.error(e.get("InternalSystemErrorMessage"),"ExplorationAppBar_DatasetError",{title:e.get("InternalSystemErrorTitle")})}},i.prototype.toggleVisualInteractions=function(){this.services.eventBridge.publishToChannel(r.visualRelationshipsModeChanged)},i.prototype.reportMoreOptionsMenuSelected=function(t){switch(t.action){case 0:this.services.telemetryService.logEvent(e.telemetry.DashboardAndReportsAnalyzeInExcel,"Report More Options Menu",this.viewModel.datasetModel.contentProviderId,this.viewModel.datasetModel.contract.modelFeatures,this.viewModel.datasetModel.dbName),this.services.analyzeInExcel.startAnalyzeInExcel(this.viewModel.datasetModel);var i=this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.reportId;this.services.auditing.auditEvent(i,e.common.contracts.AuditEntityType.Report,e.common.contracts.AuditActivityType.analyzeReport);break;case 1:this.services.eventBridge.publishBubbling(this.scope,r.generateReportQR);break;case 2:this.services.eventBridge.publishBubbling(this.scope,r.exportAsImage)}},i.prototype.exploreMenuActionSelected=function(e){if(!e.disabled)switch(e.action){case 18:this.toggleSeeDataMode();break;case 19:this.drillDownLevel(3);break;case 20:this.drillDownLevel(2);break;case 21:this.drillUp();break;case 22:this.setDrillMode(1);break;case 23:this.setDrillMode(2)}},i.prototype.updateExploreMenuStates=function(){if(this.exploreMenuActions)for(var e=this.getSelectedVisual(),t=0,i=this.exploreMenuActions;t<i.length;t++){var r=i[t];switch(r.action){case 18:var o=this.services.popOut.getPoppedOutVisualContainer();r.selected=o&&2===o.popOutMode,r.disabled=!this.services.drill.canSeeData(e);break;case 19:r.disabled=!this.services.drill.canDrillByDirection(e,4);break;case 20:r.disabled=!this.services.drill.canDrillByDirection(e,2);break;case 22:var n=this.services.drill.isDrillModeEnabled(e,1);r.selected=n;var a=this.services.drill.canDrillByDirection(e,4),s=this.services.drill.canDrillByDirection(e,1);r.disabled=!a&&!s;break;case 21:r.disabled=!this.services.drill.canDrillByDirection(e,1);break;case 23:var l=this.services.drill.isDrillModeEnabled(e,2);r.selected=l,r.disabled=!this.services.drill.canDrillToDetails(e)}}},i.prototype.toggleSeeDataMode=function(){var e=this.services.popOut.getPoppedOutVisualContainer()||this.getSelectedVisual();if(e){var t=e.popOutMode;2===t?this.services.popOut.clearPopOut():this.services.popOut.popOutVisualContainer(e,2)}},i.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(null,this.getSelectedVisual())},i.prototype.drillDownLevel=function(e){this.services.visualAuthoring.drillDownLevel(null,this.getSelectedVisual(),e)},i.prototype.setDrillMode=function(e){var t=this.getSelectedVisual();if(t){var i=t.drillMode,r=i===e?0:e;this.services.drill.setDrillMode(t,r)}},i.prototype.getSelectedVisual=function(){return n.getSelectedVisual(this.services.selection)},i.prototype.getDisplayOption=function(){return this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.exploreCanvas&&this.viewModel.exploration.exploreCanvas.contract&&this.viewModel.exploration.exploreCanvas.contract.size&&this.viewModel.exploration.exploreCanvas.contract.size.displayOption},i.prototype.updateViewMenu=function(e){if(this.viewMenuActions)for(var t=0,i=this.viewMenuActions;t<i.length;t++){var r=i[t];10===r.action&&(r.selected=0===e),13===r.action&&(r.selected=1===e),12===r.action&&(r.selected=2===e),11===r.action&&(r.selected=3===e),14===r.action&&(r.checked=this.services.settingsService.getShowGridlines()),15===r.action&&(r.checked=this.services.settingsService.getSnapToGrid())}},i.prototype.downloadReport=function(){var e=this.viewModel&&this.viewModel.exploration&&this.viewModel.exploration.contract&&this.viewModel.exploration.contract.report;if(e){var t=e.objectId,i=e.displayName;if(t&&i){var r={reportId:t,filename:a.normalizeFileName(i)};this.services.downloadReport.downloadReport(r)}}},i})();i.ExplorationAppBarController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.services.SectionNavigationAction,n=(function(){function i(t,i){var n=this;this.scope=t,this.services=i,this.services.eventBridge.setBubblingScope(t).subscribe(r.switchSection,(function(e,t){return n.onSwitchSection(e,t)})).subscribe(r.reorderSection,(function(e,t){return n.onReorderSection(e,t)})).subscribe(r.visualConversion,(function(e,t){return n.onVisualConversion(t)})).subscribe(r.undo,(function(e,t){return i.undoRedo.undo()})).subscribe(r.redo,(function(e,t){return i.undoRedo.redo()}));var a=this.services.rootScope.$on(e.explore.constants.explorationNextPageEvent,(function(e,t){return void 0===t&&(t=o.Unknown),n.switchToAdjacentSection(!0,t)})),s=this.services.rootScope.$on(e.explore.constants.explorationPreviousPageEvent,(function(e,t){return void 0===t&&(t=o.Unknown),n.switchToAdjacentSection(!1,t)})),l=this.services.rootScope.$on(e.explore.constants.deleteSectionEvent,(function(e,t){return n.onDeleteSection(e,t)})),c=this.services.rootScope.$on(e.explore.constants.insertSectionEvent,(function(e,t){return n.onInsertSection(e,t)})),u=this.services.rootScope.$on(e.explore.constants.switchSectionEvent,(function(e,t){return n.onSwitchSection(e,t)})),d=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.podParameterChanged,(function(e,t){return n.onPodParameterChanged(t)})).subscribe(r.createSection,(function(e,t){return n.onCreateSection(e,t)})).subscribe(r.duplicateSection,(function(e,t){return n.onDuplicateSection(e,t)})).subscribe(r.deleteSection,(function(e,t){return n.onDeleteSection(e,t)}));t.$on(e.common.constants.scopeDestroyEventName,(function(){a(),s(),l(),c(),u(),d.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["explorationSerializer","linguisticSchemaProxy","localizationService","telemetryService","featureSwitchService"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","formFactor","selection","undoRedo","visualAuthoring"]}},i.prototype.switchToAdjacentSection=function(e,i){if(void 0===i&&(i=o.Unknown),this.scope.viewModel.exploration){var r=this.scope.viewModel.sectionStatus&&this.scope.viewModel.sectionStatus.currentSectionNumber;if(null==r)return;var n=r+(e?1:-1),a=this.scope.viewModel.exploration.sections.length;(n<0||n===a)&&(n=a-Math.abs(n)),t.SectionUtils.gotoSection(this.scope.viewModel,n,this.services.selection,this.services.explorationNavigation,this.services.formFactor.getCurrentLayout(),i)}},i.prototype.onSwitchSection=function(e,i){if(this.scope.viewModel.exploration){for(var r=this.scope.viewModel.exploration.sections,o=!0,n=0,a=r.length;n<a;n++)this.scope.viewModel.exploration.sections[n].selected===!0&&n===i&&(o=!1);o&&t.SectionUtils.gotoSection(this.scope.viewModel,i,this.services.selection,this.services.explorationNavigation,this.services.formFactor.getCurrentLayout())}e.stopPropagation&&e.stopPropagation()},i.prototype.onCreateSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("CreateSection",(function(){var e=i?i.size:void 0;t.SectionUtils.createSection(r.scope.viewModel,r.services.selection,r.services.explorationNavigation,r.services.localizationService,e)})),e.stopPropagation&&e.stopPropagation())},i.prototype.onDuplicateSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("DuplicateSection",(function(){var e=r.scope.viewModel,o=t.SectionUtils.duplicateSection(e,i,r.services.localizationService,r.services.featureSwitchService);t.PodUtils.duplicatePod(e.exploration.contract,o,i,r.services.linguisticSchemaProxy).then((function(){t.SectionUtils.insertSection(e,o,r.services.selection,r.services.explorationNavigation)}))})),e.stopPropagation&&e.stopPropagation())},i.prototype.onDeleteSection=function(e,i){var r=this;if(this.scope.viewModel.exploration){var o=this.scope.viewModel.exploration.contract;this.services.undoRedo.register("DeleteSection",(function(){t.PodUtils.deletePod(o,o.sections[i].name,r.services.linguisticSchemaProxy),t.SectionUtils.deleteSection(r.scope.viewModel,i,r.services.selection,r.services.explorationNavigation)}))}e.stopPropagation&&e.stopPropagation()},i.prototype.onInsertSection=function(e,i){var r=this;this.scope.viewModel.exploration&&(this.services.undoRedo.register("InsertSection",(function(){t.SectionUtils.insertSection(r.scope.viewModel,i,r.services.selection,r.services.explorationNavigation)})),e.stopPropagation&&e.stopPropagation())},i.prototype.onReorderSection=function(e,i){var r=this;this.services.undoRedo.register("ReorderSection",(function(){return t.SectionUtils.reorderSection(r.scope.viewModel,i.originalIndex,i.targetIndex)})),e.stopPropagation&&e.stopPropagation(),this.scope.$apply()},i.prototype.onVisualConversion=function(e){var t=this;this.services.undoRedo.register("VisualConversion",(function(){return t.services.visualAuthoring.convert(e.visualContainer,t.services.dataSources.get(),e.newVisualType).then((function(){e.actionAfterConversion&&e.actionAfterConversion()}))}))},i.prototype.onPodParameterChanged=function(e){var i=this,r=this.scope.viewModel.exploration.contract;if(r){var o=this.services.explorationNavigation.getCurrentSection();this.services.undoRedo.register("PodParameterChanged",(function(){switch(e.type){case 0:t.PodUtils.addParameter(r,o.name,e.filterName);break;case 1:case 2:t.PodUtils.deleteParameter(r,o.name,e.filterName,i.services.linguisticSchemaProxy)}}))}},i})();i.ExplorationHostController=n})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=(function(){function i(i,o){var n=this;this.scope=i,this.scope.tabIndex=i.tabIndex,this.scope.isOnlyTab=i.isOnlyTab,this.scope.viewModel.isTabEditable=!1,this.services=o,this.scope.viewModeState=this.services.viewModeState,this.scope.eventBridge=this.services.eventBridge,this.scope.renameSection=function(e){return n.renameSection(e,n.scope.tabIndex)},this.scope.changeSection=function(e){return n.changeSection(e,n.scope.tabIndex)},this.scope.deleteSection=function(e){return n.deleteSection(e,n.scope.tabIndex)},this.scope.selectMenuItem=function(e){return n.selectMenuItem(e)},this.scope.beginEditSection=function(){return n.beginEditSection()},this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.sectionNameChanged,(function(e,i){n.scope.tabIndex===i.sectionIndex&&(n.scope.viewModel.displayName=i.sectionName,n.scope.$emit(t.constants.renameSectionEvent))})),this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){n.scope.viewModel.isTabEditable=!1,n.scope.$emit(t.constants.renameSectionEvent)})),this.scope.$watch("isOnlyTab",(function(){n.scope.isOnlyTab?n.scope.dropdownItems=n.scope.viewModel.menuItems.slice(0,2):n.scope.dropdownItems=n.scope.viewModel.menuItems}))}return i.createOptions=function(){return{additionalServices:["localizationService"],scopedDependencies:["eventBridge","viewModeState"]}},i.prototype.beginEditSection=function(){this.scope.viewModel.isTabEditable=!0,this.scope.toggleDraggable(!1),this.scope.$emit(t.constants.renameSectionEvent)},i.prototype.renameSection=function(e,t){if(!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)){var i={sectionNewName:e,sectionIndex:t};this.services.eventBridge.publishToChannel(r.renameSection,i),this.scope.toggleDraggable(!0)}},i.prototype.deleteSection=function(e,t){this.services.eventBridge.publishToChannel(r.deleteSectionInitiated,{sectionIndex:t,supportMinervaDialog:this.scope.supportsMinervaDialog}),e&&e.stopPropagation&&e.stopPropagation()},i.prototype.changeSection=function(e,t){this.services.eventBridge.publishBubbling(this.scope,r.switchSection,t),e&&e.stopPropagation&&e.stopPropagation()},i.prototype.selectMenuItem=function(e){switch(e.action){case 0:this.services.eventBridge.publishToChannel(r.duplicateSection,this.scope.tabIndex);break;case 1:this.beginEditSection();break;case 2:this.deleteSection(null,this.scope.tabIndex)}},i})();i.ExplorationNavigationTabController=o})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.services.events,r=(function(){function e(e,t){var i=this;this.scope=e,this.services=t,this.scope.prev=function(){return i.prev()},this.scope.next=function(){return i.next()},this.scope.getSelectedPageIndex=function(){return i.getSelectedPageIndex()}}return e.createOptions=function(){return{scopedDependencies:["eventBridge"]}},e.prototype.prev=function(){var e=this.getSelectedPageIndex();if(void 0!==e){var t=e-1;t>-1&&this.services.eventBridge.publishBubbling(this.scope,i.switchSection,t)}},e.prototype.next=function(){var e=this.getSelectedPageIndex();if(void 0!==e){var t=e+1;t<this.scope.viewModel.exploration.sections.length&&this.services.eventBridge.publishBubbling(this.scope,i.switchSection,t)}},e.prototype.getSelectedPageIndex=function(){if(this.scope.viewModel.exploration)for(var e=this.scope.viewModel.exploration.sections,t=e.length-1;t>=0;--t)if(e[t].selected)return t},e})();t.ExplorationPaginatorController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.services.events,r=(function(){function e(e,t){var r=this;this.scope=e,this.services=t,this.scope.startEditing=function(){return r.services.eventBridge.publishToChannel(i.changeViewMode,1)},this.scope.stopEditing=function(){return r.services.eventBridge.publishToChannel(i.changeViewMode,0)}}return e.createOptions=function(){return{scopedDependencies:["eventBridge"]}},e})();t.ExplorationStatusBarController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.data.FieldExprPattern,n=e.explore.util.HierarchyUtils,a=e.explore.util.ModelAuthoringUtility,s=t.services.selectionUtils,l=(e.data.SQColumnRefExpr,e.data.SQExpr),c=e.data.SQExprBuilder,u=e.data.SQExprConverter,d=jsCommon.StringExtensions,p=(function(){function e(e,i){var o=this;this.scope=e,this.services=i,
this.scope.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.scope.$on(t.constants.explorationLoadedEventName,(function(){return o.explorationLoaded()}));var n=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.modelChanged,(function(e,t){return o.explorationLoaded(t)})).subscribe(r.selectionChanged,(function(){return o.updateChecked()})).subscribe(r.visualContainerChanged,(function(){return o.updateChecked()})).subscribe(r.selectionChanged,(function(){return o.unselect()})).subscribe(r.modelingContextChanged,(function(){return o.unselect()}));this.services.eventBridge.subscribeToBubbling(e,t.viewModels.FieldListEvents.fieldListAction,(function(e,t){return o.processFieldListAction(e,t)})),this.scope.$on("$destroy",(function(){return n.unsubscribeAll()})),this.scope.unselect=function(){return o.unselect()},this.scope.onSearchStringChanged=function(){return o.onSearchStringChanged()},this.scope.showContextMenu=function(e){return o.showContextMenu(e)},this.explorationLoaded()}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dropdown","errorService","featureSwitchService","localizationService","modalDialogService","promiseFactory","$timeout"],scopedDependencies:["clusteringAuthoring","clusteringService","clusteringState","dataSources","eventBridge","groupingDesignStateService","groupAuthoring","modelAuthoring","modelChangeHandler","selection","shell","schemaItemActivation","visualAuthoring","visualPlugin"]}},e.prototype.onDestroy=function(){this.modalDialogPromise&&this.modalDialogPromise.pending&&this.modalDialogPromise.reject("fieldListController destroyed")},e.prototype.explorationLoaded=function(e){var t=this,i=this.services.dataSources.get();return i?void this.services.conceptualSchemaProxy.get(i).then((function(r){return t.loadModel(r,i,e)}),(function(){return t.clearModel()})):void this.clearModel()},e.prototype.clearModel=function(){this.loadModel(null)},e.prototype.loadModel=function(e,i,r){var n,a=this;i&&i.length>0&&(n=i[0].name);var s=!1;if(e){var l=e.schema(n),c=l&&l.capabilities;s=c&&c.discourageQueryAggregateUsage}var u=this.services.featureSwitchService.featureSwitches.showNonUserEntitiesEnabled;this.scope.viewModel=t.viewModels.FieldListViewModelMerger.mergeModel(this.scope.viewModel,e,n,this.scope.fieldListConfig.viewModelFactory,r,u);var d=this.getConceptualModel();d&&(this.scope.modelChangeEnabled=d.canEdit,d.showHidden=this.services.shell.canShowHiddenSchemaItem(),d.showCheckboxes=this.services.shell.canToggleSchemaItems()),this.updateChecked(),this.updateMenuCheckStatus(),this.updateUnsupportedProperties();var p=t.viewModels.FieldListViewModelOperations.applyModelChanges(d,this.services.schemaItemActivation,r);if(p){var v=o.toFieldExprEntityItemPattern(p),h=p.column||p.columnAggr||p.groupingColumn||p.groupingColumnAggr||p.measure,g=h?h.name:void 0;this.services.$timeout((function(){return a.scope.scrollToItem(v.entity,g)}),0,!1)}},e.prototype.updateMenuCheckStatus=function(){var e=this.getConceptualModel();e&&t.viewModels.FieldListViewModelOperations.updateAllMenuItemsCheckStatus(e)},e.prototype.updateUnsupportedProperties=function(){var e=this.getConceptualModel();e&&t.viewModels.FieldListViewModelOperations.updateSupportedProperties(e)},e.prototype.updateChecked=function(){var e=this.getConceptualModel();if(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.hasCheckedProperties=!1;for(var n=0,a=r.properties;n<a.length;n++){var c=a[n];c.checked=!1,c.hasCheckedChildren=!1}}var d=s.getSelectedVisual(this.services.selection);if(d&&d.config.singleVisual&&d.config.singleVisual.query&&d.config.singleVisual.query.defn)for(var p=d.config.singleVisual.query.defn.select(),v=0,h=p;v<h.length;v++){var c=h[v];if(!l.isTransformOutputRoleRef(c.expr)){var g=u.asFieldPattern(c.expr),f=o.toFieldExprEntityItemPattern(g);if(g){var m=g.hierarchyLevel||g.hierarchyLevelAggr;if(m){var y=e.findHierarchies(f.entity,m.name);if(y)for(var w=0,C=y;w<C.length;w++){var S=C[w];S.checked=!0,S.entity.hasCheckedProperties=!0,this.updateCheckedStateForAncestors(S);for(var b=0,x=S.hierarchyLevels;b<x.length;b++){var D=x[b];D.name===m.level&&(D.checked=!0,this.updateCheckedStateForAncestors(D))}}}else{var M=g.columnHierarchyLevelVariation?g.columnHierarchyLevelVariation.source.name:o.getPropertyName(g),E=e.findFields(f.entity,M)||e.findKpiMeasures(f.entity,M);if(E)for(var F=0,V=E;F<V.length;F++){var P=V[F];P.checked=!0,P.entity.hasCheckedProperties=!0,this.updateCheckedStateForAncestors(P)}}}}}}},e.prototype.updateCheckedStateForAncestors=function(e){e&&e.parent&&(e.parent.hasCheckedChildren=!0,this.updateCheckedStateForAncestors(e.parent))},e.prototype.unselect=function(){if(this.scope.modelChangeEnabled&&!this.scope.fieldListConfig.alwaysHasActiveItem){var e=this.getConceptualModel();if(!e)return;for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.selected=!1;for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.selected=!1}}this.services.schemaItemActivation.clearActiveItem()}},e.prototype.showContextMenu=function(e){this.services.dropdown.showContextMenu(this.scope.viewModel.schema.menuItems,{x:e.pageX,y:e.pageY},this.onMenuItemSelected.bind(this),!1)},e.prototype.onMenuItemSelected=function(e){var t;switch(e.action){case 2:t=1;break;case 3:t=2;break;case 14:t=14;break;case 15:t=15;break;default:return}var i={action:t};this.processFieldListAction(null,i)},e.prototype.processFieldListAction=function(e,i){var r,s=this.getConceptualModel();if(s){var l,d;switch(i.fieldExpr&&(d=u.asFieldPattern(i.fieldExpr),l=o.toFieldExprEntityItemPattern(d)),i.action){case 0:var p=t.viewModels.FieldListViewModelOperations.toggleHide(s,i.fieldExpr);p&&!s.showHidden&&this.unselect(),a.hide(i.fieldExpr,p,this.services.modelAuthoring);break;case 4:a.deleteItem(i.fieldExpr,this.services.modelAuthoring);var v=t.ScopeUtils.getSchemaPromise(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy);this.services.groupAuthoring.telemetry.logGroupsDeleteTelemetry(v,i.fieldExpr);break;case 5:r=n.findHierarchyLevelIndex(s.contract,i.fieldExpr),null!=r&&a.move(i.fieldExpr,r-1,this.services.modelAuthoring);break;case 6:r=n.findHierarchyLevelIndex(s.contract,i.fieldExpr),null!=r&&a.move(i.fieldExpr,r+1,this.services.modelAuthoring);break;case 1:t.viewModels.FieldListViewModelOperations.toggleShowHidden(s),this.services.shell.setShowHiddenSchemaItem(s.showHidden);break;case 2:t.viewModels.FieldListViewModelOperations.unhideAll(s);var h=c.entity(s.schemaName,"");a.hide(h,!1,this.services.modelAuthoring);break;case 7:a.createMeasure(c.entity(s.schemaName,l.entity),this.services.modelAuthoring);break;case 8:a.createHierarchy([i.fieldExpr],this.services.modelAuthoring);break;case 9:a.createHierarchyLevel(i.fieldExpr,i.newHierarchyLevel.hierarchy,i.newHierarchyLevel.index,this.services.modelAuthoring);break;case 10:a.createCalculatedColumn(c.entity(s.schemaName,l.entity),this.services.modelAuthoring);break;case 11:this.showGroupsDialog(i.property,!0);break;case 12:this.showGroupsDialog(i.property,!1);break;case 13:this.showEditClusteringDialog(d);break;case 14:t.viewModels.FieldListViewModelOperations.collapseOrExpandAllEntities(s,!1);break;case 15:t.viewModels.FieldListViewModelOperations.collapseOrExpandAllEntities(s,!0)}e&&e.stopPropagation&&e.stopPropagation()}},e.prototype.onSearchStringChanged=function(){var e=this.getConceptualModel();if(e){var t=_.trim(this.scope.searchString);if(_.isEmpty(t))for(var i=0,r=e.entities;i<r.length;i++){var o=r[i];o.isShownInSearch=void 0;for(var n=0,a=o.properties;n<a.length;n++){var s=a[n];s.isShownInSearch=void 0}}else for(var l=0,c=e.entities;l<c.length;l++){for(var o=c[l],u=d.containsIgnoreCase(o.displayName,t),p=0,v=o.properties;p<v.length;p++){var s=v[p];s.isShownInSearch=this.isSearchHit(s,t)||u,2===s.fieldType&&this.setHierarchyShownInSearch(s,t)}o.isShownInSearch=u||_.any(o.properties,(function(e){return e.isShownInSearch}))}}},e.prototype.setHierarchyShownInSearch=function(e,t){for(var i=0,r=e.hierarchyLevels;i<r.length;i++){var o=r[i];o.isShownInSearch=this.isSearchHit(o,t)||e.isShownInSearch}e.isShownInSearch=_.any(e.hierarchyLevels,(function(e){return e.isShownInSearch}))},e.prototype.showGroupsDialog=function(e,t){var i={schema:e.entity.schema.schemaName,entity:e.entity.name,name:t?null:e.name,sourcePropertyName:t?e.name:null,valueType:e.type,groupingMetadata:t?null:e.contract.column.groupingMetadata};this.services.groupAuthoring.dialog.showDialog(i)},e.prototype.showEditClusteringDialog=function(e){this.modalDialogPromise=this.services.clusteringService.editClustering(e,this.services.dataSources.get())},e.prototype.getConceptualModel=function(){return this.scope.viewModel&&this.scope.viewModel.schema},e.prototype.isSearchHit=function(e,i){return t.viewModels.FieldListUtils.isFieldVisible(e)&&d.containsIgnoreCase(e.displayName,i)},e})();i.FieldListController=p})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.explore.util.FieldListActionEventPublisher,n=e.explore.util.ModelAuthoringUtility,a=t.services.schemaItemActivationUtils,s=(function(){function i(i,r){var n=this;this.scope=i,this.services=r,this.scope.toggle=function(e){return n.toggle(e)},this.scope.select=function(){return n.select()},this.scope.editLabel=function(){return n.editLabel()},this.scope.rename=function(e){return n.rename(e)},this.scope.isNameValid=function(e){return n.isNameValid(e)},this.scope.filterProperties=function(t){return e.explore.viewModels.FieldListUtils.isFieldVisible(t)},this.scope.showContextMenu=function(e){return n.showContextMenu(e)},this.scope.viewModel.schema&&(this.scope.modelChangeEnabled=this.scope.viewModel.schema.canEdit),this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){n.scope.viewModel.isEditingLabel=!1})),this.fieldListActionEventPublisher=new o(this.scope,this.services.eventBridge),this.scope.tooltipConfigManager={getTooltipConfig:function(){return{tooltipTitle:n.scope.viewModel.displayName}}};var a=this.services.eventBridge.createChannelSubscriptionManager().subscribe(t.services.events.schemaItemActivationChanged,(function(){return n.schemaItemActivationChanged()}));this.scope.$on("$destroy",(function(){return a.unsubscribeAll()}))}return i.createOptions=function(){return{additionalServices:["dropdown"],scopedDependencies:["eventBridge","modelAuthoring","schemaItemActivation","shell"]}},i.prototype.toggle=function(e){var t=this.scope.viewModel;t.expanded=!t.expanded,this.select(),e.stopPropagation()},i.prototype.select=function(){if(this.scope.modelChangeEnabled){var i=this.scope.viewModel,r=e.data.SQExprBuilder.entity(i.schemaName,i.name);a.setActiveSchemaItem(this.services.schemaItemActivation,r),t.viewModels.FieldListViewModelOperations.clearSelection(i.schema),i.selected=!0}},i.prototype.editTable=function(){var t=this.scope.viewModel,i=e.data.SQExprBuilder.entity(t.schemaName,t.name);this.services.shell.showEditQueriesEditor(i.entity)},i.prototype.fieldExpr=function(){var t=this.scope.viewModel;return e.data.SQExprBuilder.entity(t.schemaName,t.name)},i.prototype.selectMenuItem=function(e){switch(e.action){case 4:this.editLabel();break;case 1:this.fieldListActionEventPublisher.toggleHidden(this.fieldExpr());break;case 5:this.fieldListActionEventPublisher.delete(this.fieldExpr());break;case 2:this.fieldListActionEventPublisher.viewHidden();break;case 3:this.fieldListActionEventPublisher.unHideAll();break;case 10:this.fieldListActionEventPublisher.addMeasure(this.fieldExpr());break;case 11:this.fieldListActionEventPublisher.addHierarchy(this.fieldExpr());break;case 13:this.fieldListActionEventPublisher.addColumn(this.fieldExpr());break;case 14:this.fieldListActionEventPublisher.collapseAll();break;case 15:this.fieldListActionEventPublisher.expandAll();break;case 6:n.refreshEntity(this.fieldExpr(),this.services.modelAuthoring);break;case 9:this.editTable();break;case 19:this.services.eventBridge.publishToChannel(r.copyTable,this.scope.viewModel.name)}},i.prototype.showContextMenu=function(e){this.services.dropdown.showContextMenu(this.scope.viewModel.menuItems,{x:e.pageX,y:e.pageY},this.selectMenuItem.bind(this),!1)},i.prototype.editLabel=function(){this.scope.modelChangeEnabled&&(this.scope.viewModel.isEditingLabel=!0,this.scope.toggleDraggable(!1))},i.prototype.rename=function(e){this.scope.toggleDraggable(!1),this.isNameValid(e)&&n.rename(this.fieldExpr(),e,this.services.modelAuthoring)},i.prototype.isNameValid=function(e){var t=this.scope.viewModel;if(!t.schema)return!0;var i=t.schema.findEntity(e),r=jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e);return!i&&!r},i.prototype.schemaItemActivationChanged=function(){var e=this.services.schemaItemActivation.getActiveItem();this.scope.viewModel.selected=e&&e.entity===this.scope.viewModel.name},i})();i.FieldListEntityController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.explore.services.events,n=e.explore.util.FieldListActionEventPublisher,a=t.util.HierarchyUtils,s=e.explore.util.ModelAuthoringUtility,l=t.services.schemaItemActivationUtils,c=t.services.selectionUtils,u=jsCommon.StringExtensions,d=e.data.SQExpr,p=e.data.SQExprConverter,v=0,h=(function(){function i(i,o){var a=this;this.scope=i,this.services=o,o.featureSwitchService.featureSwitches.hierarchyAuthoringEnabled&&o.featureSwitchService.featureSwitches.hierarchyDragDrop&&(this.dropConfig={accept:r.Field,greedy:!1}),this.services.localizationService.ensureLocalization((function(){a.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDisable:a.viewModel.isEditingLabel,tooltipTitle:a.getTooltipTitle()}}}})),this.elementId=this.createUniqueId();var s=this.scope.$watch((function(){return a.viewModel}),(function(e){a.fieldListExprGenerator=t.util.createFieldListExprGenerator(a.getExprKind(a.viewModel)),s()})),l=this.services.eventBridge.createChannelSubscriptionManager().subscribe(t.services.events.selectionChanged,(function(){return a.updateSelection()})).subscribe(t.services.events.schemaItemActivationChanged,(function(){return a.schemaItemActivationChanged()}));this.scope.$on(e.common.constants.editableLabelOnBlurEventName,(function(e){a.viewModel.isEditingLabel=!1})),this.scope.$on("$destroy",(function(){return l.unsubscribeAll()})),this.updateSelection(),this.fieldListActionEventPublisher=new n(this.scope,this.services.eventBridge)}return i.createOptions=function(){return{additionalServices:["dragDataService","dropdown","featureSwitchService","localizationService","telemetryService"],scopedDependencies:["dataSources","eventBridge","schemaItemActivation","explorationNavigation","selection","visualAuthoring","modelAuthoring"]}},i.prototype.drop=function(e,t,i){var r=this.services.dragDataService.getDragContext();if(r&&r.field){var o=r.field,n=this.fieldExpr();if(d.isColumn(o))d.isColumn(n)?s.createHierarchy([n,o],this.services.modelAuthoring):d.isHierarchy(n)&&s.createHierarchyLevel(o,n.hierarchy,void 0,this.services.modelAuthoring);else if(d.isHierarchyLevel(o)&&d.isHierarchy(n))s.move(o,0,this.services.modelAuthoring);else if(d.isHierarchyLevel(o)&&d.isHierarchyLevel(n)){var l=a.findHierarchyLevelIndex(this.viewModel.entity.schema.contract,o),c=a.findHierarchyLevelIndex(this.viewModel.entity.schema.contract,n),u=l>c?c:c-1;3===i&&(u+=1),s.move(o,u,this.services.modelAuthoring)}}},i.prototype.canCreateHierarchyLevelFromColumn=function(e,t){if(d.isEntity(e.arg)&&d.equals(e.arg,t.source)){var i=this.viewModel.entity.findHierarchies(e.hierarchy);if(!_.isEmpty(i)){var r=_.first(i),o=r.hierarchyLevels,n=t.ref,a=_.find(o,(function(e){return e.contract.name===n}));return _.isEmpty(a)}}},i.prototype.getDropAction=function(e){var t=this.services.dragDataService.getDragContext();if(!t||!this.viewModel.entity.schema.canEdit)return 0;var i=t.field,r=this.fieldExpr();if(_.isEmpty(i)||d.equals(i,r))return 0;if(d.isColumn(i)&&d.isHierarchy(r)&&this.canCreateHierarchyLevelFromColumn(r,i))return 1;if(d.isColumn(i)&&d.isColumn(r)&&d.equals(i.source,r.source))return 1;var o=this.viewModel.entity.schema.contract;if(d.isHierarchyLevel(i)&&d.isHierarchyLevel(r)&&d.equals(i.arg,r.arg)){var n=a.findHierarchyLevelIndex(o,i),s=a.findHierarchyLevelIndex(o,r);if(n<s&&(s-=1),1===e&&(s+=1),n!==s)return 0===e?2:3}return d.isHierarchyLevel(i)&&2===this.viewModel.fieldType&&d.equals(i.arg,r)&&0!==a.findHierarchyLevelIndex(o,i)?3:0},i.prototype.getExprKind=function(e){switch(e.fieldType){case 2:return 1;case 3:return 2;case 0:return 0;default:return 0}},i.prototype.getTooltipTitle=function(){var e,t=this.viewModel;if(5===t.fieldType){var i=t;e=2===i.kpiType?u.format(this.services.localizationService.get("Field_Tooltip"),i.entity.displayName,i.parent.displayName):u.format(this.services.localizationService.get("Field_Kpi_Tooltip"),i.entity.displayName,i.parent.displayName,i.displayName)}else e=t.entity?u.format(this.services.localizationService.get("Field_Tooltip"),t.entity.displayName,t.displayName):t.displayName;return e},i.prototype.getPropertyStyle=function(){var e=this.viewModel,t={selected:e.selected,inactive:e.hidden&&e.showHidden,isLeaf:3===e.fieldType||5===e.fieldType,lastLeaf:this.isLastLeaf(),expanded:this.viewModel.expanded};return t[this.getFieldType()]=!0,t},i.prototype.getIndentationStyle=function(){var e=this.getIndentationLevel(),t=8*e,i={"padding-left":t+"px"};return i},i.prototype.getIndentationLevel=function(){for(var e=this.viewModel,t=1,i=e.parent;i;)t++,i=i.parent;return t},i.prototype.isLastLeaf=function(){var e=this.viewModel.fieldType,t=this.viewModel.parent;return!(3!==e&&5!==e||!t||_.last(t.children)!==this.viewModel)},i.prototype.createUniqueId=function(){return"fieldListProp_"+ ++v},i.prototype.toggle=function(){this.viewModel.checked?this.addField():this.removeField()},i.prototype.addField=function(){var t=this,i=this.fieldExpr(),r=c.getSelectedVisuals(this.services.selection);if(1===r.length){var n=r[0];if(n){var a=this.services.dataSources.get();this.services.visualAuthoring.addFieldToVisual(i,a,n,e.telemetry.HowFieldWasAddedToVisual.CheckboxTickedInFieldList).catch((function(){t.viewModel.checked=!1}))}}else this.services.eventBridge.publishToChannel(o.addVisualContainer,{expr:i,allowAggregate:!0,telemetrySource:0})},i.prototype.removeField=function(){var e=this.services.dataSources.get();this.services.visualAuthoring.removeField(e,this.fieldExpr())},i.prototype.getIconClassName=function(){var e=this.viewModel.fieldType;if(1===e)return"folder";if(3===e||5===e)return"none";if(2===e)return"hierarchy";var t=this.viewModel;if(1===t.contract.queryable)return"error";if(1===t.kind)return t.contract.measure&&t.contract.measure.kpi&&4===t.fieldType?"kpi":"measure";if(void 0!==t.contract.type&&void 0!==t.contract.type.geography)return"geoData";if(0===t.kind){if(t.contract.column&&t.contract.column.groupingMetadata)return"group";if(t.contract.column&&t.contract.column.calculated)return t.type&&t.type.numeric?"numericCalculatedColumn":"calculatedColumn";if(t.idOnEntityKey)return"identity"}return t.type&&t.type.numeric&&1!==t.defaultAggregate&&this.allowAggregation()?"numeric":"none"},i.prototype.getDragContext=function(){return{field:this.fieldExpr()}},i.prototype.fieldExpr=function(){return this.fieldListExprGenerator.fieldExpr(this.viewModel)},i.prototype.updateSelection=function(){this.selectedVisualContainer=null;var e=c.getSelectedVisual(this.services.selection);e&&(this.selectedVisualContainer=e)},i.prototype.select=function(e){if(!this.viewModel.entity||!this.viewModel.entity.schema||this.viewModel.entity.schema.canEdit){var i=this.viewModel,r=this.fieldExpr();i.selected||(t.viewModels.FieldListViewModelOperations.clearSelection(i.entity.schema),i.selected=!0),l.setActiveSchemaItem(this.services.schemaItemActivation,r),e.stopPropagation()}},i.prototype.selectMenuItem=function(e){switch(e.action){case 4:this.editLabel();break;case 0:this.addFilter();break;case 1:this.fieldListActionEventPublisher.toggleHidden(this.fieldExpr());break;case 5:this.fieldListActionEventPublisher.delete(this.fieldExpr());break;case 7:this.fieldListActionEventPublisher.moveUp(this.fieldExpr());break;case 8:this.fieldListActionEventPublisher.moveDown(this.fieldExpr());break;case 2:this.fieldListActionEventPublisher.viewHidden();break;case 3:this.fieldListActionEventPublisher.unHideAll();break;case 10:this.fieldListActionEventPublisher.addMeasure(this.fieldExpr());break;case 11:this.fieldListActionEventPublisher.addHierarchy(this.fieldExpr());break;case 12:this.fieldListActionEventPublisher.addHierarchyLevel(this.fieldExpr(),e.hierarchyName);break;case 13:this.fieldListActionEventPublisher.addColumn(this.fieldExpr());break;case 16:this.fieldListActionEventPublisher.setGroups(this.viewModel);break;case 17:this.fieldListActionEventPublisher.editGroups(this.viewModel);break;case 18:this.fieldListActionEventPublisher.editClustering(this.fieldExpr());break;case 14:this.fieldListActionEventPublisher.collapseAll();break;case 15:this.fieldListActionEventPublisher.expandAll()}},i.prototype.toggleExpand=function(e){var t=this.viewModel;t.expanded=!t.expanded,this.select(e),e.stopPropagation()},i.prototype.showContextMenu=function(e){this.services.dropdown.showContextMenu(this.viewModel.menuItems,{x:e.pageX,y:e.pageY},this.selectMenuItem.bind(this),!1)},i.prototype.addFilter=function(){var e;e=this.selectedVisualContainer?{container:this.selectedVisualContainer,scopeType:0}:{container:this.services.explorationNavigation.getCurrentSection(),scopeType:1},this.services.visualAuthoring.addFilter(this.fieldExpr(),e,this.services.dataSources.get())},i.prototype.editLabel=function(){var e=this.viewModel;e.entity&&e.entity.schema&&e.entity.schema.canEdit&&this.isEditableField(e.fieldType)&&(e.isEditingLabel=!0,this.scope.toggleDraggable(!1))},i.prototype.rename=function(t){this.scope.toggleDraggable(!0),this.isNameValid(t)&&e.explore.util.ModelAuthoringUtility.rename(this.fieldExpr(),t,this.services.modelAuthoring)},i.prototype.isNameValid=function(e){if(u.isNullOrUndefinedOrWhiteSpaceString(e))return!1;var t=this.viewModel;if(!t.entity)return!0;var i;if(2===this.viewModel.fieldType)i=t.entity.findHierarchies(e);else if(3===this.viewModel.fieldType){var r=p.asFieldPattern(this.fieldExpr()),o=r.hierarchyLevel,n=t.entity.findHierarchies(o.name);if(n)return!_.first(n).findLevel(e)}else i=t.entity.findFields(e)||t.entity.findKpis(e);return!i},i.prototype.allowAggregation=function(){return!(this.viewModel.entity&&this.viewModel.entity.schema&&this.viewModel.entity.schema.contract&&this.viewModel.entity.schema.contract.capabilities)||!this.viewModel.entity.schema.contract.capabilities.discourageQueryAggregateUsage},i.prototype.isEditableField=function(e){return 5!==e&&(2!==e&&3!==e||this.services.featureSwitchService.featureSwitches.hierarchyAuthoringEnabled)},i.prototype.schemaItemActivationChanged=function(){var e=this.services.schemaItemActivation.getActiveItem();this.viewModel.selected=e&&e.entity===this.viewModel.entity.name&&e.property===this.viewModel.name},i.prototype.getFieldType=function(){switch(this.viewModel.fieldType){case 0:return"property";case 1:return"displayFolder";case 4:return"kpi";case 2:return"hierarchy";case 5:return"kpiMeasure";case 3:return"hierarchyLevel";default:return"property"}},i})();i.FieldListPropertyController=h})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.ArrayExtensions,o=t.services.events,n=e.explore.util.FieldWellUtility,a=t.services.selectionUtils,s=t.util.VisualContainerUtils,l=(function(){function e(e,i){var r=this;this.scope=e,this.services=i,this.scope.viewModel=t.viewModels.ViewModelFactory.createFieldWell(),this.scope.$on(t.constants.explorationLoadedEventName,(function(){return r.requestModelAndUpdate()}));var n=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.modelChanged,(function(){return r.requestModelAndUpdate(!0)})).subscribe(o.selectionChanged,(function(){return r.requestModelAndUpdate()})).subscribe(o.visualContainerChanged,(function(){return r.requestModelAndUpdate(!0)})).subscribe(o.visualContainerDataRendered,(function(){return r.requestModelAndUpdate(!0)}));this.scope.$on("$destroy",(function(){return n.unsubscribeAll()})),this.requestModelAndUpdate()}return e.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","featureSwitchService","geoTaggingAnalyzerService","promiseFactory"],scopedDependencies:["dataSources","eventBridge","groupingDesignStateService","selection","visualPlugin"]}},e.prototype.requestModelAndUpdate=function(e){var t=this,i=this.services.dataSources.get();i&&this.services.conceptualSchemaProxy.get(i).then((function(i){return t.update(i,e)}),(function(){return t.update(null)}))},e.prototype.update=function(e,i){var r,o=this,a=this.getSelectedVisual();if(this.deferredCreateBuckets&&(this.deferredCreateBuckets.reject(),this.deferredCreateBuckets=void 0),e)if(a){var l={aggrOps:this.services.aggrOps,displayName:this.services.displayNameService,featureSwitch:this.services.featureSwitchService,geoTagging:this.services.geoTaggingAnalyzerService,groupingDesignState:this.services.groupingDesignStateService,promiseFactory:this.services.promiseFactory,visualPlugin:this.services.visualPlugin};this.deferredCreateBuckets=t.viewModels.FieldWellViewModelFactory.createBuckets(a,e,l),this.deferredCreateBuckets.promise.then((function(e){o.updateViewModel(e,i),o.deferredCreateBuckets=void 0}))}else{var c=s.getDataRolesForVisualPlugin(n.getDefaultVisualPlugin());r=t.viewModels.FieldWellViewModelFactory.createEmptyBuckets(c),this.updateViewModel(r,i)}else r=null,this.updateViewModel(r,i)},e.prototype.updateViewModel=function(e,t){t&&r.comparableSequenceEqual(e,this.scope.viewModel.buckets)||(this.scope.viewModel.buckets=e)},e.prototype.getSelectedVisual=function(){return a.getSelectedVisual(this.services.selection)},e})();i.FieldWellController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.ArrayExtensions,o=t.dialogs.ConditionalFormattingDialogBuilder,n=e.explore.util.DragDropTypes,a=t.dialogs.QuickCalcDialogBuilder,s=t.services.selectionUtils,l=e.data.SQExprConverter,c=t.util.VisualContainerUtils,u=(function(){function i(e,t){var i=this;this.scope=e,this.services=t,this.dropConfig={accept:n.Field,greedy:!1},this.tooltipConfigManager={getTooltipConfig:function(){return{tooltipTitle:i.viewModel.tooltip}}},this.conditionalFormattingDialog=new o(this.services.localizationService,this.services.modalDialogService,this.services.promiseFactory,this.services.telemetryService,this.services.visualAuthoring),this.quickCalcDialog=new a(this.services.aggrOps,this.services.localizationService,this.services.modalDialogService,this.services.telemetryService,this.services.promiseFactory,this.services.visualAuthoring)}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","dragDataService","dropdown","localizationService","modalDialogService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","clusteringAuthoring","clusteringService","eventBridge","groupAuthoring","modelChangeHandler","selection","visualAuthoring","visualPlugin"]}},i.prototype.onDestroy=function(){this.modalDialogPromise&&this.modalDialogPromise.pending&&this.modalDialogPromise.reject("fieldWellFieldController destroyed")},i.prototype.getDropAction=function(e){var t=this.services.dragDataService.getDragContext();if(!t)return 0;var i=t.sourceRole;if(i){var r=t.hierarchyLevelCount||1,o=t.sourceIndex,n=this.getTargetIndex(i,o,r,1===e);if(void 0===n)return 0}return this.viewModel.isReplaceable?1:0===e?2:3},i.prototype.drop=function(e,t,i){var r=this.services.dragDataService.getDragContext(),o=r,n=this.viewModel,a=this.services.dataSources.get(),s=o.sourceRole;if(s){var l=o.hierarchyLevelCount||1,c=o.sourceIndex,u=this.getTargetIndex(s,c,l,3===i);return void this.services.visualAuthoring.moveProjection(s,n.role,c,u,l,a)}var d=r;d.field&&(n.isReplaceable?this.services.visualAuthoring.replaceProjection(d.field,n.role,n.startIndex,this.getSelectedVisual(),a):this.services.visualAuthoring.addFieldInRole(d.field,n.role,a,this.getSelectedVisual(),3===i?n.startIndex+(n.hierarchyLevels.length||1):n.startIndex))},i.prototype.getTargetIndex=function(e,t,i,r){var o=this.viewModel,n=o.startIndex;if(r&&(n+=o.hierarchyLevels.length||1),e===o.role){if(n===t||n===t+i)return;n>t&&(n=Math.max(n-i,0))}return n},i.prototype.deleteField=function(e){this.services.visualAuthoring.removeProjection({role:this.viewModel.role,index:this.viewModel.startIndex+(e||0),count:_.isNumber(e)?1:this.viewModel.hierarchyLevels.length||1}),this.logDeleteTelemetry()},i.prototype.logDeleteTelemetry=function(){var i=t.ScopeUtils.getSchemaPromise(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy),r=t.util.VisualContainerUtils.getVisualType(this.getSelectedVisual());this.services.groupAuthoring.telemetry.logGroupsUsageTelemetry(i,this.viewModel.expr,r,null,this.viewModel.role,e.telemetry.EditorAction.Delete)},i.prototype.getDragContext=function(){return{sourceIndex:this.viewModel.startIndex,sourceRole:this.viewModel.role,hierarchyLevelCount:this.viewModel.hierarchyLevels.length}},i.prototype.setAggregate=function(i,r){var o=this.getAuthoringContext();if(o){var n=e.data.FieldExprPattern.getAggregate(i.expr),a=this.services.visualAuthoring.setAggregate(this.viewModel.role,this.viewModel.startIndex,r,o.visual,o.dataSources);return t.viewModels.FieldWellViewModelOperations.updateSelectedMenuItems(i,o.visual),this.services.telemetryService.logEvent(e.telemetry.EXChangeAggregation,e.data.aggregateFunctionName(n),e.data.aggregateFunctionName(r)),a}},i.prototype.setVariation=function(e,t){var i=this.getAuthoringContext();i&&this.services.visualAuthoring.setVariation(i.dataSources,i.visual,t,this.viewModel.role,this.viewModel.startIndex,this.viewModel.hierarchyLevels.length)},i.prototype.removeAggregate=function(e){var i=this.getAuthoringContext();i&&(this.services.visualAuthoring.removeAggregate(this.viewModel.role,this.viewModel.startIndex,i.visual,i.dataSources),t.viewModels.FieldWellViewModelOperations.updateSelectedMenuItems(e,i.visual))},i.prototype.restoreHierarchy=function(e){var t=this.getAuthoringContext();t&&this.services.visualAuthoring.expandHierarchy(t.dataSources,t.visual,this.viewModel.role,this.viewModel.startIndex,this.viewModel.hierarchyLevels.length)},i.prototype.toggleShowAll=function(i){var r=this.getAuthoringContext();r&&(this.services.visualAuthoring.toggleShowAll(i.role,r.visual),t.viewModels.FieldWellViewModelOperations.updateSelectedMenuItems(i,r.visual),this.services.telemetryService.logEvent(e.telemetry.EXFieldWellEnableDisableShowAll,r.visual.config.singleVisual.query.projections[i.role].showAll))},i.prototype.selectFieldMenuItem=function(e){switch(e.action){case 0:this.deleteField();break;case 2:this.setAggregate(this.viewModel,e.aggregate);break;case 1:this.removeAggregate(this.viewModel);break;case 3:this.toggleShowAll(this.viewModel);break;case 5:this.setVariation(this.viewModel,e.variationExpr);break;case 4:this.showQuickCalcDialog();break;case 6:this.showGroupsDialog(this.viewModel,!0);break;case 7:this.showGroupsDialog(this.viewModel,!1);break;case 8:this.showEditClusteringDialog(this.viewModel);break;case 9:this.restoreHierarchy(this.viewModel);break;case 10:this.createConditionalFormattingDialog();break;case 11:this.removeConditionalFormatting()}},i.prototype.showMenu=function(e){this.services.dropdown.showContextMenu(this.viewModel.dropDownItems,{x:e.pageX,
y:e.pageY},this.selectFieldMenuItem.bind(this),!1)},i.prototype.showQuickCalcDialog=function(){var e=this,t=this.getAuthoringContext();if(t){var i=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(i).then((function(i){e.modalDialogPromise=e.quickCalcDialog.show(t.visual,e.getVisualDataRole(),e.viewModel.startIndex,i,t.dataSources)}))}},i.prototype.showGroupsDialog=function(e,t){var i=this,r=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(r).then((function(r){var o=e.expr.getTargetEntity(),n=e.expr.getConceptualProperty(r),a={schema:o.schema,entity:o.entity,name:t?null:n.name,sourcePropertyName:t?n.name:null,valueType:n.type,groupingMetadata:t?null:n.column.groupingMetadata},s=i.services.modelChangeHandler.register((function(t){return i.handleNewGroupsBins(o,e,t),i.services.promiseFactory.resolve()}));i.services.groupAuthoring.dialog.showDialog(a).finally((function(){s.stopHandling()}))}))},i.prototype.showEditClusteringDialog=function(e){this.modalDialogPromise=this.services.clusteringService.editClustering(l.asFieldPattern(e.expr),this.services.dataSources.get())},i.prototype.handleNewGroupsBins=function(t,i,r){var o,n=_.find(r.changes,(function(e){return e.newBins}));n&&(o=e.data.SQExprBuilder.columnRef(t,n.newBins.name));var a=_.find(r.changes,(function(e){return e.newGroups}));if(a){var s=e.data.services.SemanticGroupingSerializer.deserialize(a.newGroups.definition),l=s.groupedColumns[0];o=e.data.SQExprBuilder.groupRef(a.newGroups.name,t,[l])}if(o){var c=this.services.dataSources.get();this.services.visualAuthoring.replaceProjection(o,i.role,i.startIndex,this.getSelectedVisual(),c)}},i.prototype.createConditionalFormattingDialog=function(){var e=this,t=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(t).then((function(t){e.modalDialogPromise=e.conditionalFormattingDialog.show(e.getSelectedVisual(),e.viewModel.role,e.viewModel.displayName,e.viewModel.expr,t,e.viewModel.visualObjectRepetition)}))},i.prototype.removeConditionalFormatting=function(){var t=this.getSelectedVisual(),i=this.viewModel;this.services.visualAuthoring.removeConditionalFormatting(t,i.visualObjectRepetition,i.expr),this.services.telemetryService.logEvent(e.telemetry.EXRemoveConditionalFormatting,c.getVisualType(t))},i.prototype.getSelectedVisual=function(){return s.getSelectedVisual(this.services.selection)},i.prototype.getVisualDataRole=function(){var e=c.getDataRolesForVisual(this.getSelectedVisual(),this.services.visualPlugin);if(!_.isEmpty(e))return r.findItemWithName(e,this.viewModel.role)},i.prototype.getAuthoringContext=function(){var e=this.getSelectedVisual();if(e){var t=this.services.dataSources.get();if(t)return{visual:e,dataSources:t}}},i})();i.FieldWellFieldController=u})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.explore.services.events,n=e.explore.util.FieldWellUtility,a=t.services.selectionUtils,s=(function(){function i(e,t){var i=this;this.scope=e,this.services=t,this.scope.viewModel=e.viewModel,this.scope.drop=function(e,t,r){return i.drop(e,t,r)},this.scope.getDropAction=function(e){return i.getDropAction(e)},this.scope.dropConfig={accept:r.Field,greedy:!1}}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","dragDataService","promiseFactory","telemetryService"],scopedDependencies:["dataSources","eventBridge","groupAuthoring","selection","visualAuthoring"]}},i.prototype.getDropAction=function(e){var t=this.services.dragDataService.getDragContext();if(t){var i=this.scope.viewModel;return t.sourceRole===i.role&&_.last(i.properties).startIndex===t.sourceIndex?0:_.isEmpty(this.scope.viewModel.properties)?1:2}},i.prototype.drop=function(e,t,i){var r=this.services.dragDataService.getDragContext();if(r){var a=r,s=this.scope.viewModel,l=this.getSelectedVisual();if(a.sourceRole){var c=0;s.properties.length>0&&(c=_.last(s.properties).endIndex+1),a.sourceRole===s.role&&(c=Math.max(c-(a.hierarchyLevelCount||1),0));var u=this.services.dataSources.get();this.services.visualAuthoring.moveProjection(a.sourceRole,s.role,a.sourceIndex,c,a.hierarchyLevelCount||1,u);var d=l?l.config.singleVisual.query.tryGetExpr(a.sourceRole,a.sourceIndex):null;return void this.logTelemetry(d,a.sourceRole)}var p=this.services.dragDataService.getDragContext();if(p.field){var d=p.field;if(l){var u=this.services.dataSources.get();this.services.visualAuthoring.addFieldInRole(d,s.role,u,l)}else this.services.eventBridge.publishToChannel(o.addVisualContainer,{expr:d,visualType:n.getDefaultVisualPlugin().name,targetRole:s.role,allowAggregate:!0,telemetrySource:3});this.logTelemetry(d,null)}}},i.prototype.getSelectedVisual=function(){return a.getSelectedVisual(this.services.selection)},i.prototype.logTelemetry=function(i,r){if(i){var o=e.telemetry.EditorAction.Create;r&&(o=e.telemetry.EditorAction.Update,this.services.telemetryService.logEvent(e.telemetry.EXChangeFieldWell,r,this.scope.viewModel.role));var n=t.util.VisualContainerUtils.getVisualType(this.getSelectedVisual()),a=t.ScopeUtils.getSchemaPromise(this.services.dataSources.get(),this.services.promiseFactory,this.services.conceptualSchemaProxy);this.services.groupAuthoring.telemetry.logGroupsUsageTelemetry(a,i,n,this.scope.viewModel.role,r,o)}},i})();i.FieldWellBucketController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=t.contracts.FilterType,n=e.data.SemanticFilter,a=(function(){function i(e,i){var o=this;this.scope=e,this.services=i,this.scope.viewModel.updateViewState(),this.scope.viewModel.updateAvailableTypes(),this.scope.toggle=function(e,t){return o.toggle(e,t)},this.scope.deleteFilter=function(e,t){return o.deleteFilter(e,t)},this.scope.clearFilter=function(e,t){return o.clearFilter(e,t)},this.scope.restoreDefaultFilter=function(e,t){return o.restoreDefaultFilter(e,t)},this.scope.switchCardType=function(e,t){return o.switchCardType(e,t)},this.scope.invalidFilterTooltip=this.services.localizationService.get("Invalid_Filter_Tooltip"),this.scope.updateRequiredState=function(){return o.updateRequiredState()},this.scope.viewModel.isSingleSelectionRequired=this.scope.viewModel.isPodEnabled()&&this.initializeDefaultRequiredState(),this.scope.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDisable:!e.viewModel.readOnlyState.invalid,tooltipTitle:i.localizationService.get("Invalid_Filter_Tooltip")}}},this.services.eventBridge.subscribeToBubbling(e,t.viewModels.FilterEvents.filterChanged,(function(e,t){return o.onFilterChanged(e,t)})),this.scope.viewModel.chevronExpandDescription=i.localizationService.get("Chevron_ExpandDescription"),this.scope.viewModel.chevronCollapseDescription=i.localizationService.get("Chevron_CollapseDescription");var n=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.filterContainerChanged,(function(e,t){return o.onFilterContainerChanged(t)}));this.scope.$on("$destroy",(function(){return n.unsubscribeAll()})),this.initializeDefaultValue()}return i.createOptions=function(){return{additionalServices:["localizationService","featureSwitchService","telemetryService"],scopedDependencies:["eventBridge","explorationNavigation","visualAuthoring"]}},i.prototype.onFilterChanged=function(e,t){var i=this.scope.viewModel.contract.expression;this.scope.viewModel.useDefaultFilter&&(t.filter.filter=n.getDefaultValueFilter(i)),this.services.eventBridge.publishToChannel(r.filterContainerChanged,t),this.updateRestatement()},i.prototype.onFilterContainerChanged=function(e){var t=this.scope.viewModel;e.filter===t.contract&&jsCommon.EnumExtensions.hasFlag(e.changeType,2)&&this.updateRestatement()},i.prototype.toggle=function(t,i){var o=i.contract;o.expanded=!o.expanded;var n=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneExpandCollapseFilter,o.expanded);i.updateViewState();var a=this.scope.viewModel,s={filter:a.contract,changeType:16,scope:a.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,s),n.resolve()},i.prototype.clearFilter=function(t,i){if(!i.contract.filter)return void t.stopPropagation();var o=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneClearAdvancedFilter),n=this.scope.viewModel;this.services.visualAuthoring.clearFilter(n.getFilterContainerScope().container,n.contract);var a={filter:i.contract,changeType:10,scope:i.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,a),t.stopPropagation(),o.resolve()},i.prototype.restoreDefaultFilter=function(t,i){var o=this.services.telemetryService.startEvent(e.telemetry.EXFilterPaneClearAdvancedFilter),a=this.scope.viewModel,s=this.scope.viewModel.contract.expression;this.services.visualAuthoring.updateFilter(a.getFilterContainerScope().container,a.contract,n.getDefaultValueFilter(s));var l={filter:i.contract,changeType:10,scope:i.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,l),a.useDefaultFilter=!0,this.updateRestatement(),t.stopPropagation(),o.resolve()},i.prototype.deleteFilter=function(e,t){var i=t.getFilterContainerScope();if(this.services.visualAuthoring.removeFilter(t.contract,i),this.scope.viewModel.isSingleSelectionRequired){var o={filterName:t.contract.name,type:2};this.services.eventBridge.publishToChannel(r.podParameterChanged,o)}e.stopPropagation()},i.prototype.switchCardType=function(e,t){switch(e.type){case o.Advanced:case o.Categorical:case o.TopN:t.switchType(e.type),t.updateViewState()}},i.prototype.updateRequiredState=function(){var e={filterName:this.scope.viewModel.contract.name,type:this.scope.viewModel.isSingleSelectionRequired?0:1};this.services.eventBridge.publishToChannel(r.podParameterChanged,e);var t=this.scope.viewModel;if(t.isSingleSelectionRequired){this.services.visualAuthoring.updateFilter(t.getFilterContainerScope().container,t.contract,void 0);var i={filter:t.contract,changeType:10,scope:t.getFilterContainerScope()};this.services.eventBridge.publishToChannel(r.filterContainerChanged,i)}},i.prototype.initializeDefaultRequiredState=function(){var e=this.services.explorationNavigation.getCurrentExploration(),i=this.services.explorationNavigation.getCurrentSection(),r=this.scope.viewModel.contract.name;return!!(e&&i&&r)&&t.PodUtils.hasParameter(e,i.name,r)},i.prototype.updateRestatement=function(){var e=this.scope.viewModel;e.useDefaultFilter?e.restatement=t.viewModels.RestatementHelper.fromDefault(e.defaultValue.value):e.contract.type===o.Passthrough&&(e.restatement=e.contract.restatement,e.updateViewState())},i.prototype.initializeDefaultValue=function(){var e=this.scope.viewModel;(e.hasDefaultValue&&!e.contract.filter||n.isDefaultFilter(e.contract.filter))&&(e.useDefaultFilter=!0,this.updateRestatement())},i})();i.FilterController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.util.DragDropTypes,o=e.explore.services.events,n=e.explore.util.ScriptVisualsUtil,a=t.services.selectionUtils,s=e.explore.util.VisualContainerUtils,l=(function(){function i(e,i){var n=this;this.scope=e,this.services=i;var a=this.services.explorationNavigation.getCurrentExploration();this.scope.viewModel=t.viewModels.ViewModelFactory.createFilterPane(null!=a),this.scope.viewModeState=i.viewModeState,this.scope.dropPageFilter=function(e,t,i){return n.dropPageFilter(e,t,i)},this.scope.dropReportFilter=function(e,t,i){return n.dropReportFilter(e,t,i)},this.scope.dropVisualFilter=function(e,t,i){return n.dropVisualFilter(e,t,i)},this.scope.dropConfig={accept:r.Field},this.scope.getDropAction=function(e){return n.getDropAction(e)},this.scope.isVisualFiltersVisible=function(){return n.isVisualFiltersVisible()},this.scope.isPageFiltersVisible=function(){return n.isPageFiltersVisible()},this.scope.isReportFiltersVisible=function(){return n.isReportFiltersVisible()};var s=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.selectionChanged,(function(){return n.updateSelection()})).subscribe(o.modelChanged,(function(){return n.onModelChanged()})).subscribe(o.canvasChanged,(function(){return n.onCanvasChanged()})).subscribe(o.explorationLoaded,(function(){return n.onModelChanged()})).subscribe(o.visualContainerChanged,(function(e,t){return n.onVisualContainerChanged(t)})).subscribe(o.filterContainerChanged,(function(e,t){return n.onFilterContainerChanged(t)}));e.$on("$destroy",(function(){return s.unsubscribeAll()})),this.updateSelection(),this.onModelChanged()}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","displayNameService","dragDataService","localizationService","telemetryService"],scopedDependencies:["dataSources","eventBridge","explorationCapabilities","explorationNavigation","scriptVisuals","selection","viewModeState","visualAuthoring","visualPlugin"]}},i.prototype.onModelChanged=function(){this.createReportFilters(),this.createPageFilters()},i.prototype.onCanvasChanged=function(){this.createPageFilters()},i.prototype.getDropAction=function(e){var t=this.services.dragDataService.getDragContext();return t&&t.field?3:0},i.prototype.dropVisualFilter=function(e,t,i){var r=this.getSelectedVisual();r&&this.addFilterToScopeFromDrop(0,r)},i.prototype.dropPageFilter=function(e,t,i){var r=this.services.explorationNavigation.getCurrentSection();this.addFilterToScopeFromDrop(1,r)},i.prototype.dropReportFilter=function(e,t,i){var r=this.services.explorationNavigation.getCurrentExploration();this.addFilterToScopeFromDrop(2,r)},i.prototype.addFilterToScopeFromDrop=function(e,t){var i=this.services.dragDataService.getDragContext();if(i&&i.field){var r={scopeType:e,container:t},o=this.services.dataSources.get();this.services.visualAuthoring.addFilter(i.field,r,o)}},i.prototype.isVisualFiltersVisible=function(){var e=this.scope.viewModeState,t=this.scope.viewModel;return 1===e.getMode()&&t.isVisualVisible||2===e.getMode()&&t.isVisualVisible||0===e.getMode()&&!!t.visualFilters.length},i.prototype.isPageFiltersVisible=function(){var e=this.scope.viewModeState,t=this.scope.viewModel;return t.pageFilters&&(e.getConfig().alwaysPopulatePanes||1===e.getMode()||2===e.getMode()||!!t.pageFilters.length)},i.prototype.isReportFiltersVisible=function(){var e=this.scope.viewModeState,t=this.scope.viewModel;return t.reportFilters&&(e.getConfig().alwaysPopulatePanes||1===e.getMode()||2===e.getMode()||!!t.reportFilters.length)},i.prototype.updateSelection=function(){var e=this.scope.viewModel,t=this.getSelectedVisual();e.visualFilters.length=0,t&&s.isQueryVisual(t.config.singleVisual.visualType,this.services.visualPlugin)?(e.isVisualVisible=!0,this.createVisualFilters()):this.scope.viewModel.isVisualVisible=!1},i.prototype.onVisualContainerChanged=function(e){if(e){var t=this.getSelectedVisual();t&&e.affectContainer(t)&&this.createVisualFilters()}},i.prototype.onFilterContainerChanged=function(e){var i=this;if(2===e.scope.scopeType){var r=this.services.explorationNavigation.getCurrentExploration();s.clearVisualContainerQueryCaches(r)}var o=this.scope.viewModel;if(1===e.changeType)this.getConceptualSchema().then((function(r){var n=t.viewModels.FilterViewModelFactory.convertFilterContainer(e.filter,r,i.services.displayNameService,e.scope,i.services.visualPlugin,i.services.aggrOps,i.services.localizationService);0===e.scope.scopeType&&e.scope.container===i.getSelectedVisual()?o.visualFilters.push(n):1===e.scope.scopeType?(o.pageFilters.push(n),i.addConfigToPageOrReportFilters(o.pageFilters,r)):2===e.scope.scopeType&&(o.reportFilters.push(n),i.addConfigToPageOrReportFilters(o.reportFilters,r))}));else if(0===e.changeType){var n;switch(e.scope.scopeType){case 0:n=o.visualFilters;break;case 1:n=o.pageFilters;break;case 2:n=o.reportFilters;break;default:return}for(var a=0,l=n.length;a<l;a++)if(n[a].contract===e.filter){n.splice(a,1);break}}4!==e.changeType&&(this.updateCategoricalFiltersOnParentFilterChange(this.scope.viewModel.visualFilters,e.filter),0!==e.scope.scopeType&&this.updateCategoricalFiltersOnParentFilterChange(this.scope.viewModel.pageFilters,e.filter),2===e.scope.scopeType&&this.updateCategoricalFiltersOnParentFilterChange(this.scope.viewModel.reportFilters,e.filter)),this.logRTelemetry(e)},i.prototype.logRTelemetry=function(t){var i=this.services.explorationNavigation,r=i.getCurrentExploration(),o=i.getCurrentSection(),a=t.scope.scopeType,s=n.getScriptVisualIds(a,r,o,this.getSelectedVisual(),this.services.scriptVisuals);if(!_.isEmpty(s)){var l=t.changeType.toString();this.services.telemetryService.logEvent(e.telemetry.EXFilterScriptVisual,l,JSON.stringify(s))}},i.prototype.updateCategoricalFiltersOnParentFilterChange=function(e,i){for(var r=0,n=e;r<n.length;r++){var a=n[r];if(t.FilterUtils.isCategoricalFilter(a.contract.type)&&a.contract!==i){var s={filter:a.contract,changeType:4,scope:a.getFilterContainerScope()};this.services.eventBridge.publishToChannel(o.filterContainerChanged,s)}}},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(e)},i.prototype.getSelectedVisual=function(){return a.getSelectedVisual(this.services.selection)},i.prototype.createPageFilters=function(){var e=this,i=this.services.explorationNavigation.getCurrentSection(),r=this.services.explorationCapabilities.getCapabilities();return!i||r.shouldShowPageFilters&&!r.shouldShowPageFilters(i)?void(this.scope.viewModel.pageFilters=null):void this.getConceptualSchema().then((function(r){e.scope.viewModel.pageFilters=t.viewModels.ViewModelFactory.createFilters({scopeType:1,container:i},r,e.services.displayNameService,e.services.visualPlugin,e.services.aggrOps,e.services.localizationService),e.addConfigToPageOrReportFilters(e.scope.viewModel.pageFilters,r)}))},i.prototype.createReportFilters=function(){var e=this,i=this.services.explorationNavigation.getCurrentExploration();return i?void this.getConceptualSchema().then((function(r){e.scope.viewModel.reportFilters=t.viewModels.ViewModelFactory.createFilters({scopeType:2,container:i},r,e.services.displayNameService,e.services.visualPlugin,e.services.aggrOps,e.services.localizationService),e.addConfigToPageOrReportFilters(e.scope.viewModel.reportFilters,r)})):void(this.scope.viewModel.reportFilters=null)},i.prototype.addConfigToPageOrReportFilters=function(e,t){if(!_.isEmpty(e)){var i=this.services.dataSources.get();this.services.visualAuthoring.addConfigToCategoricalFilters(e,t,i)}},i.prototype.createVisualFilters=function(){var e=this;this.getConceptualSchema().then((function(t){var i=e.getSelectedVisual();i&&(e.scope.viewModel.visualFilters=e.services.visualAuthoring.createVisualFilters(i,e.services.dataSources.get(),t))}))},i})();i.FilterPaneController=l})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.data.DataViewObjectDefinitions,o=e.explore.services.events,n=e.explore.services,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprConverter,u=e.explore.util.VisualContainerUtils,d=e.explore.util.VisualHostServicesUtil,p=jsCommon.EnumExtensions,v=(function(){function i(e,t){var i=this;this.scope=e,this.services=t;var r=this.services.singleExecutableDataProxyFactory.create();this.visualDataProxyService=n.createExploreVisualDataProxyService(r,this.services.filterGenerator),this.crossFilteringHostService=this.createFilteringHostService();var a=this.scope.$watch("viewModel",(function(e){i.init(e),a()})),s=this.services.eventBridge.createChannelSubscriptionManager().subscribe(o.filterContainerChanged,(function(e,t){return i.onFilterContainerChanged(t)})).subscribe(o.podParameterChanged,(function(e,t){return i.updateFilterConfig(t)}));this.scope.$on("$destroy",(function(){s.unsubscribeAll(),i.viewModel.setServices(void 0,i.services.visualPlugin),i.viewModel.readOnlyState.visual=void 0}))}return i.createOptions=function(){return{additionalServices:["aggrOps","conceptualSchemaProxy","geocoder","localizationService","promiseFactory","singleExecutableDataProxyFactory"],scopedDependencies:["dataSources","eventBridge","explorationNavigation","filterGenerator","filterRestatement","hostFiltersService","undoRedo","visualAuthoring","visualPlugin","visualQueryGenerator","visualRelationship"]}},i.prototype.init=function(i){var o=this;this.viewModel=i,this.viewModel.setServices(e.Prototype.inherit(t.services.createVisualHostServices(e.visuals.services.createGeolocation(),this.services.geocoder),(function(e){e.persistProperties=function(e){return o.persistProperties(e)},e.loadMoreData=function(){return o.loadMoreData()},e.promiseFactory=function(){return o.services.promiseFactory},e.analyzeFilter=function(e){return o.createAnalyzedFilter(e)},e.canSelect=function(e){return!0},e.setIdentityDisplayNames=function(e){return o.updateCachedLabel(e)},e.getIdentityDisplayNames=function(e){return o.getLabelForScopeId(e)}})),this.services.visualPlugin),this.getConceptualSchema().then((function(t){if(o.viewModel.updateFilterProperties(t,o.services.visualPlugin,o.services.aggrOps),o.viewModel.updateViewState(),o.viewModel.isSingleSelectionRequired){var i=o.viewModel.contract.config.singleVisual.objects;i||(i={});var n=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,a=e.visuals.slicerProps.selection.singleSelect;r.setValue(i,n,null,l.boolean(!1)),r.setValue(i,a,null,l.boolean(!0))}if(o.viewModel.readOnlyState.expanded)o.loadData(!1);else var s=o.scope.$watch("viewModel.readOnlyState.expanded",(function(e,t,i){e!==t&&e&&(o.loadData(!1),s())}));o.loadRestatement()}))},i.prototype.loadRestatement=function(){var e=this;this.services.filterRestatement.loadRestatement(this.services.dataSources.get(),this.viewModel.contract,this.viewModel.formatter).then((function(t){return e.viewModel.restatement=t}))},i.prototype.createAnalyzedFilter=function(e){var i=this.viewModel.contract;e.filter=i.filter;var r=1!==i.howCreated&&!a.isDefaultFilter(i.filter),o=t.services.createAnalyzedFilter(e,r);return o},i.prototype.persistProperties=function(i){var r=this,o=this.viewModel;o.useDefaultFilter=!1;var n;if(i&&!_.isEmpty(i.merge)){var s=this.services.filterGenerator.tryGetFilterPropertyIdentifier(e.visuals.plugins.slicer.capabilities);n=i.merge[0].properties[s.propertyName]}if(!a.isSameFilter(o.contract.filter,n)&&(!a.isAnyFilter(o.contract.filter)||n)){var l=this.viewModel.readOnlyState.visual,c=_.clone(l.data);l.data=c,this.services.undoRedo.register("UpdateFilter",(function(){r.services.visualAuthoring.updateFilter(o.getFilterContainerScope().container,o.contract,n);var e=n?2:10,i={filter:o.contract,changeType:e,scope:o.getFilterContainerScope()};r.services.eventBridge.publishToChannel(t.services.events.filterContainerChanged,i),r.loadRestatement()}))}},i.prototype.createFilteringHostService=function(){var t=this;return e.Prototype.inherit(d.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,i){return{dataFilter:t.services.filterGenerator.calculateFilterContainerInputFilter(t.services.explorationNavigation.getCurrentExploration(),t.services.explorationNavigation.getCurrentSection(),t.viewModel.contract,i,t.viewModel.getFilterContainerScope())}}}))},i.prototype.loadMoreData=function(){this.visualDataProxyService.canLoadMore()&&this.loadData(!0)},i.prototype.loadData=function(e){var t=this;this.viewModel.isLoading=!0,this.hasQueryError=!1,this.getConceptualSchema().then((function(i){var r=t.services.dataSources.get(),o={dataSources:r,schema:i,config:t.viewModel.contract.config.singleVisual,hostServices:t.crossFilteringHostService,visualQueryGenerator:t.services.visualQueryGenerator,isLoadMore:e};return t.visualDataProxyService.runQuery(o).then((function(r){var o=t.visualDataProxyService.lastExecutedQuery();e===!0?t.onMergeMoreData(r,i,o.transforms):t.onDataChanged(r,i,o.transforms)}),(function(e){t.hasQueryError=!0})).finally((function(){t.viewModel.isLoading=!1}))}))},i.prototype.onDataChanged=function(e,t,i){var r=this.viewModel.readOnlyState.visual;if(e&&e.dataReaderResult&&r){var o={dataView:e&&e.dataReaderResult?e.dataReaderResult.dataView:null,dataViewSource:e&&e.dataViewSource?e.dataViewSource:null},n=u.isSegment(o.dataView);n&&(o.isFirstSegment=n),r.data=o,r.dataTransforms=i,this.viewModel.updateViewState(),this.dataLoaded=!0}},i.prototype.onMergeMoreData=function(t,i,r){var o=this.viewModel.readOnlyState.visual;if(t&&t.dataReaderResult&&o){var n=t.dataReaderResult.dataView;if(n){var a=o.data.dataView;e.data.segmentation.DataViewMerger.mergeDataViews(a,n);var s={dataView:a,dataViewSource:t&&t.dataViewSource,isFirstSegment:!1};o.data=s,o.dataTransforms=r}}},i.prototype.onFilterContainerChanged=function(i){var r=this.viewModel,o=r.readOnlyState.visual;if(i.filter===r.contract)if(p.hasFlag(i.changeType,2)){if(10===i.changeType)return o&&o.visual&&o.visual.onClearSelection(),void(r.contract.filter||(r.restatement=t.viewModels.RestatementHelper.fromDataViewScopeIdentities([],!1,r.formatter)));a.isSameFilter(r.contract.filter,i.filter.filter)||(this.services.visualAuthoring.updateFilter(r.getFilterContainerScope().container,r.contract,i.filter.filter),null!=i.filter.filter&&this.loadData(!1))}else this.dataLoaded&&p.hasFlag(i.changeType,4)?this.loadData(!1):p.hasFlag(i.changeType,16)&&o&&o.visual&&o.visual.update({viewport:t.viewModels.FilterViewModel.DefaultVisualViewPort,type:e.VisualUpdateType.Resize,dataViews:null})},i.prototype.updateFilterConfig=function(t){if(2!==t.type){var i=this.viewModel.readOnlyState.visual;if(i&&i.data){var o=this.viewModel.isSingleSelectionRequired,n=i.dataTransforms.objects,a=e.visuals.slicerProps.selection.selectAllCheckboxEnabled,s=e.visuals.slicerProps.selection.singleSelect;n||(n={}),r.setValue(n,a,null,l.boolean(!o)),r.setValue(n,s,null,l.boolean(o));var c={dataView:i.data.dataView,dataViewSource:i.data.dataViewSource,isFirstSegment:i.data.isFirstSegment};i.data=c}}},i.prototype.updateCachedLabel=function(t){if(!_.isEmpty(t)){var i=t[0].identity,r=i&&i.expr,o=e.data.ScopeIdentityExtractor.getKeys(r),n=this.viewModel.contract;1===o.length&&s.equals(n.expression,o[0])||(n.cachedValueItems=t,this.loadRestatement())}},i.prototype.getLabelForScopeId=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i],n=this.getDisplayNameFromCache(o);n||(n={displayName:c.getFirstComparandValue(o),identity:o}),t.push(n)}return t},i.prototype.getDisplayNameFromCache=function(t){var i=this.viewModel.contract.cachedValueItems;if(!_.isEmpty(i))return _.find(this.viewModel.contract.cachedValueItems,(function(i){return e.DataViewScopeIdentity.equals(i.identity,t,!0)}))},i.prototype.getConceptualSchema=function(){var e=this.services.dataSources.get();return e&&this.viewModel.contract.config&&this.viewModel.contract.config.singleVisual?this.services.conceptualSchemaProxy.get(e):this.services.promiseFactory.reject()},i})();i.FilterVisualController=v})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(i){var r=this;this.scope=i,this.scope.uploadImage=function(e){return r.uploadImage(e)},this.scope.items=t.viewModels.PropertyPaneViewModelFactory.getDisplayNames(e.visuals.imageScalingType.type.members())}return i.prototype.setNgModelController=function(e){this.ngModelController=e},i.prototype.uploadImage=function(t){var i=this;if(t){var r=t.name,o=new FileReader;o.onload=function(t){var n=i.ngModelController.$viewValue;n?(n.url=o.result,n.name=r):n={url:o.result,name:r,scaling:e.visuals.imageScalingType.normal},i.ngModelController.$setViewValue(n)},o.readAsDataURL(t)}},i})();i.ImageUploadController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.ImportVisualErrorDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.errorService=this.scope.errorService,this.modalDialog=this.errorService.control(),this.scope.importVisual=function(){return t.importVisual()},this.scope.closeDialog=function(){return t.closeDialog()}}return e.prototype.importVisual=function(){this.closeDialog(),this.scope.importVisualService.importWithDialog(this.scope.explorationContract)},e.prototype.closeDialog=function(){this.modalDialog&&this.modalDialog.hideDialog()},e})();e.ImportVisualWarningDialogController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this.scope=e,this.services=t,this.scope.eventBridge=this.services.eventBridge,this.scope.schemaItemActivationService=this.services.schemaItemActivation}return e.createOptions=function(){return{scopedDependencies:["eventBridge","schemaItemActivation"]}},e})();e.ModelingContextChangerController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){return jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(e)?"":e.length>=260?t.get("ReportAppBar_SaveError_TooLong"):null}function i(e,i,r,o,n){var a=$.Deferred();n=n||i.get("ModalDialog_Save");var s=e.control();o=o||i.get("ReportAppBar_SaveAsDialogInstructions");var l='<div class="content"><div class="message instructions"></div><input type="text" class="explorationSaveAsName" /><div class="errorMessage"></div></div>',c=$(l);c.find(".message").text(o);var u=c.find(".explorationSaveAsName"),d=[new InJs.ModalDialogAction(n,function(e,t){var i=jsCommon.StringExtensions.trimWhitespace(u.val());s.hideDialog(),a.resolve(i)}),new InJs.ModalDialogAction(i.get("ModalDialog_Cancel"),function(e,t){s.hideDialog(),a.reject()})];return r=r||i.get("ReportAppBar_SaveAsDialogTitle"),s.showCustomDialog(r,c,d,(function(e){e.parent().find('input[value = "'+n+'"]').prop("disabled",!0),u.focus().on("change keyup paste mouseup",(function(r){var o=t($(r.target).val(),i);e.parent().find('input[value = "'+n+'"]').prop("disabled",null!==o),e.parent().find(".errorMessage").text(o)})).on("keyup",(function(e){e.which===jsCommon.DOMConstants.enterKeyCode&&null===t($(e.target).val(),i)?d[0].actionCallback(null,null,null):e.which===jsCommon.DOMConstants.escKeyCode&&d[1].actionCallback(null,null,null)}))}),!0),a}e.validateReportName=t,e.showSaveAsDialog=i})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){for(var i=w.filterTransient(t),r=w.filterTransient(e),o=i.length-1;o>=0;o--){var n=i[o],a=r[o];n.id=a.id;for(var s=n.visualContainers.length-1;s>=0;s--){var l=n.visualContainers[s];l.id=a.visualContainers[s].id}}}function o(e,i,r,o,n,a){void 0===a&&(a=C.Unknown);var s=e.exploration.contract;if(i>-1&&s&&i<s.sections.length){r&&r.getSelectedElements().length>0&&r.clearSelection(),e.sectionStatus.currentSectionNumber=i;var l=s.sections[i];e.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(s,s.sections[i],n);for(var c=e.exploration.sections,u=c.length-1;u>=0;--u)c[u].selected=u===i;l.crossHighlight=void 0,o.goto(l,{action:a})}}function n(e,t,i){e.exploration.contract.sections[i].displayName=t,
e.exploration.sections[i].isTabEditable=!1}function a(t,i,r,o){var n=t.exploration.contract,a=e.explore.services.createExplorationSerializer(e.explore.services.createExplorationVisualPluginService(o.featureSwitches,null,null)),s=a.serializePage(n.sections[i],1),l=a.deserializePage(s);return l.name=c(n),l.displayName=r.format("DuplicateSectionName_StartingText",[l.displayName]),l}function s(e,i,r,n){i.id=void 0;var a=e.exploration.contract,s=a.sections;s.push(i),e.exploration.sections.push(t.viewModels.ViewModelFactory.convertSectionToViewModel(i)),o(e,s.length-1,r,n,0)}function l(e,t,i,r){var n=e.exploration.contract;if(t>-1&&n&&t<n.sections.length){var a=n.sections[t];n.sections.splice(t,1);var s=e.exploration.sections,l=s[t];l&&l.contract===a&&s.splice(t,1);var c=e.sectionStatus.currentSectionNumber;if(c===t){var u=t;u>=n.sections.length&&(u=n.sections.length-1),o(e,u,i,r,0)}else{var d=t>c?c:c-1;e.sectionStatus.currentSectionNumber=d,n.activeSectionIndex=d}}}function c(e){for(var t={},i=0,r=e.sections;i<r.length;i++){var o=r[i];t[o.name]=!0}return S.findUniqueName(t,b)}function u(e,t){for(var i=1,r=t.format("Explore_Section_Page",[i.toFixed()]);_.findLastIndex(e,(function(e){return e.displayName===r}))>=0;)r=t.format("Explore_Section_Page",[(++i).toFixed()]);return r}function d(e,i,r,n,a,s){var l=e.exploration.contract,d=l.sections;a||(a={displayOption:1,width:t.constants.ExploreCanvasConstants.DefaultWidescreenWidth,height:t.constants.ExploreCanvasConstants.DefaultWidescreenHeight});var p={name:c(l),displayName:u(l.sections,n),size:a,objects:s,visualContainers:[],filters:[]};d.push(p),e.exploration.sections.push(t.viewModels.ViewModelFactory.convertSectionToViewModel(d[d.length-1])),o(e,d.length-1,i,r,0)}function p(e,t){if(e&&e.sections){var i=e.sections,r=_.findIndex(i,(function(e){return e.name===t}));return r!==-1?r:void 0}}function v(e,t){if(!e||!e.sections)return-1;var i=e.sections,r=_.findIndex(i,(function(e){return e===t}));return r}function h(e,t){return e&&e.sections?y.findWithId(e.sections,t):null}function g(e,t){if(!e||!e.sections)return-1;var i=e.sections,r=_.findIndex(i,(function(e){return e.id===t}));return r}function f(e,t){for(var i=e.sections,r=0,o=i;r<o.length;r++){var n=o[r];n.displayName||(n.displayName=u(e.sections,t))}}function m(e,t,i){if(t<0||i<0)return!1;var r=!1,o=e.exploration.contract.sections,n=o[t];o.splice(t,1),o.splice(i,0,n);var a=e.exploration.sections,s=a[t];s&&s.contract===n&&(a.splice(t,1),a.splice(i,0,s),r=!0);for(var l=a.length-1;l>=0;--l)if(a[l].selected){e.sectionStatus.currentSectionNumber=l;break}return r}var y=jsCommon.ArrayExtensions,w=e.explore.contracts.Section,C=e.explore.services.SectionNavigationAction,S=jsCommon.StringExtensions,b="ReportSection";i.synchronizeSectionsIds=r,i.gotoSection=o,i.renameSection=n,i.duplicateSection=a,i.insertSection=s,i.deleteSection=l,i.createSection=d,i.findSectionIndexForSectionName=p,i.findSectionIndexForSection=v,i.findSectionById=h,i.findSectionIndexForSectionId=g,i.fillDefaultSectionDisplayNames=f,i.reorderSection=m})(i=t.SectionUtils||(t.SectionUtils={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=8192,o=8192,n=128,a=(function(){function i(e,t){var i=this;this.scope=e,this.services=t,this.scope.eventBridge=this.services.eventBridge,this.scope.generateEmbedCode=function(){return i.generateEmbedCode()},this.scope.goToConfirmation=function(){return i.goToConfirmation()},this.scope.generateEmbedCodeAndGoToSuccess=function(){return i.generateEmbedCodeAndGoToSuccess()},this.scope.getCode=function(e){return i.getCode(e)},this.scope.showDeleteMessage=function(e){return i.showDeleteMessage(e)},this.scope.formatDate=function(e){return i.formatDate(e)},this.scope.refresh=function(e){return i.refresh(e)},this.scope.delete=function(e){return i.delete(e)},this.scope.interactiveReportEmbedEnabled=this.services.featureSwitchService.featureSwitches.anonymousEmbeddingEnabled,this.scope.updateEmbedTab=function(e){return i.updateEmbedTab(e)},this.scope.showEmbedCode=function(){return i.showEmbedCode()},this.scope.nameChanged=function(){return i.nameChanged()},this.scope.sizeChanged=function(){return i.sizeChanged()},this.scope.pagesChanged=function(e,t){return i.pagesChanged(e,t)},this.scope.updateSize=function(){return i.updateSize()},this.scope.includeShareLinkChanged=function(){return i.reset()},this.scope.setSharepointEmbedLink=function(){return i.setSharepointEmbedLink()},this.updateEmbedTypes(),this.updateSize(),this.setSharepointEmbedLink()}return i.createOptions=function(){return{additionalServices:["embedProxy","localizationService","notificationToast","telemetryService","featureSwitchService","embed","promiseFactory"],scopedDependencies:["eventBridge"]}},i.prototype.goToConfirmation=function(){this.scope.viewModel.publishState=2},i.prototype.generateEmbedCodeAndGoToSuccess=function(){var e=this,t=function(){e.scope.viewModel.publishState=3};this.generateEmbedCode(t)},i.prototype.generateEmbedCode=function(i){var r=this,o=this.scope.viewModel.embedTab;o.generating=!0;var n=o.embed,a=o.selectedSection,s=[],l=this.services.localizationService.get("Embed_EntireReport");a.contract.displayName===l&&a.contract.id===-1?(s=_.map(o.sections,(function(e){return e.contract.id})),s=_.filter(s,(function(e){return e!==-1}))):s.push(a.contract.id);var c,u={enableShareLink:o.embed.enableShareLink,ignoreExistingCache:!0},d=o.selectedEmbedType.value===t.contracts.EmbedType.Interactive?e.telemetry.EXPublicEmbedCreate:e.telemetry.EXSnapshotEmbedCreate,p=this.services.telemetryService.startEvent(d);c=o.selectedEmbedType.value===t.contracts.EmbedType.Static?this.services.embed.createEmbedReportResource(this.scope.viewModel.exploration.contract,s,u):this.services.promiseFactory.resolve(null),c.then((function(a){var l=JSON.stringify({resourceLang:e.common.localizedStrings?e.common.cultureInfo:"en-US",cultureLang:e.common.cultureInfo}),c={snapshotEmbedResource:null!=a?JSON.stringify(a):"{}",options:{name:n.contract.name,culture:l,version:e.build,type:t.contracts.SnapshotReportType,size:{height:n.contract.size.height,width:n.contract.size.width},reportId:r.scope.viewModel.exploration.contract.reportId,metadata:JSON.stringify({reportSections:s}),embedType:o.selectedEmbedType.value}};r.services.embedProxy.createEmbed(c).then((function(e){r.scope.viewModel.currentEmbed=e;var n=t.viewModels.ViewModelFactory.createEmbed(e);n.embedCode=r.services.embed.createEmbedCode(e),n.link=r.services.embed.createEmbedUri(e),o.embed=n,r.scope.viewModel.embeddedInTab.embeds.push(n),o.error.exist=!1,p.resolve(),i&&i()}),(function(e){var t=o.error;t.type="create",t.info=r.services.localizationService.get("Embed_CreateError"),t.message=e.error.message,t.requestId=e.requestId,t.activityId=e.activityId,t.exist=!0,p.reject()})).finally((function(){o.generating=!1,o.edit=!0}))}))},i.prototype.checkEnabled=function(){var e=this.scope.viewModel.embedTab;return 0===e.nameError.length&&0===e.sizeError.length},i.prototype.nameChanged=function(){var e=this.scope.viewModel.embedTab,t=e.embed.contract.name.length;0===t?e.nameError=this.services.localizationService.get("Embed_NameErrorEmpty"):t>n?e.nameError=this.services.localizationService.get("Embed_NameErrorTooLong"):e.nameError="",e.disabled=!this.checkEnabled(),this.reset()},i.prototype.pagesChanged=function(e,t){var i=this.scope.viewModel.embedTab.embed.contract.name;i=i.replace(t,e),this.reset()},i.prototype.updateEmbedTab=function(e){this.showEmbedCode()&&this.reset(),1===e&&(this.scope.viewModel.embedTab.error.exist=!1),this.scope.viewModel.viewModeState=e},i.prototype.getCode=function(e){if(e.showCode||e.refreshingData)return void(e.showCode=!1);if(e.embedCode.length<=0){var t=this.services.embed.createEmbedCode(e.contract);e.embedCode=t,e.showCode=!0}else e.showCode=!0},i.prototype.showDeleteMessage=function(e){return e.refreshingData?void(e.deleteRequest=!1):(e.deleteRequest=!0,void(e.showCode=!1))},i.prototype.formatDate=function(e){var t=e.contract.date.slice(8,27),i=new Date(Date.parse(t));return i.toLocaleDateString()},i.prototype.refresh=function(t){var i=this;t.refreshingData=!0;var r=this.services.telemetryService.startEvent(e.telemetry.EXSnapshotEmbedRefresh),o={ignoreExistingCache:!0},n=JSON.parse(t.contract.metadata),a=n.reportSections;this.services.embed.createEmbedReportResource(this.scope.viewModel.exploration.contract,a,o).then((function(o){var n={snapshotEmbedResource:JSON.stringify(o),options:{version:e.build}};i.services.embedProxy.saveSnapshotEmbed(t.contract.snapshotId,n).then((function(o){i.services.notificationToast.notify({title:i.services.localizationService.get("Embed_RefreshSuccess"),message:i.services.localizationService.format("Embed_RefreshSuccessDetail",[t.contract.name]),notificationType:e.common.NotificationToastType.Success}),t.error.exist=!1,r.resolve()})).catch((function(e){var o=t.error;o.type="refresh",o.exist=!0,o.info=i.services.localizationService.get("Embed_RefreshError"),o.message=e.error.message,o.requestId=e.requestId,o.activityId=e.activityId,r.reject()})).finally((function(){t.refreshingData=!1}))}),(function(e){r.reject()}))},i.prototype.delete=function(t){var i=this;t.deleteConfirm=!0;var r=this.services.telemetryService.startEvent(e.telemetry.EXSnapshotEmbedDelete);this.services.embedProxy.deleteSnapshotEmbed(t.contract.snapshotId).then((function(){var o=i.scope.viewModel.embeddedInTab.embeds.indexOf(t);i.scope.viewModel.embeddedInTab.embeds.splice(o,1),i.services.notificationToast.notify({title:i.services.localizationService.get("Embed_DeleteSuccess"),message:i.services.localizationService.format("Embed_DeleteSuccessDetail",[t.contract.name]),notificationType:e.common.NotificationToastType.Success}),r.resolve()}),(function(e){var o=t.error;o.exist=!0,o.type="delete",o.info=i.services.localizationService.get("Embed_DeleteError"),o.message=e.error.message,o.requestId=e.requestId,o.activityId=e.activityId,r.reject(),t.deleteConfirm=!1}))},i.prototype.sizeChanged=function(){var e=this.scope.viewModel.embedTab,t=e.embed.contract.size;if(t.width<=0||t.height<=0?e.sizeError=this.services.localizationService.get("Embed_SizeErrorNegative"):t.width>r||t.height>o?e.sizeError=this.services.localizationService.get("Embed_SizeErrorTooLarge"):e.sizeError="",e.disabled=!this.checkEnabled(),this.showEmbedCode()){var i=this.services.embed.createEmbedCode(this.scope.viewModel.currentEmbed);e.embed.embedCode=i}else this.reset()},i.prototype.updateEmbedTypes=function(){},i.prototype.updateSize=function(){var e=this.scope.viewModel.embedTab,i=this.scope.viewModel.currentEmbed.size;switch(e.selectedEmbedSize.value){case t.viewModels.EmbedSize.Small:i.height=t.viewModels.EmbedSizes.small.height,i.width=t.viewModels.EmbedSizes.small.width;break;case t.viewModels.EmbedSize.Medium:i.height=t.viewModels.EmbedSizes.medium.height,i.width=t.viewModels.EmbedSizes.medium.width;break;case t.viewModels.EmbedSize.Large:i.height=t.viewModels.EmbedSizes.large.height,i.width=t.viewModels.EmbedSizes.large.width}if(e.disabled=!1,this.showEmbedCode()){var r=this.services.embed.createEmbedCode(this.scope.viewModel.currentEmbed);e.embed.embedCode=r}},i.prototype.showEmbedCode=function(){var e=this.scope.viewModel.embedTab.embed.embedCode;return this.scope.viewModel.currentEmbed&&e&&e.length>0},i.prototype.reset=function(){this.scope.viewModel.currentEmbed=null,this.scope.viewModel.embedTab.embed.embedCode=""},i.prototype.setSharepointEmbedLink=function(){var e=this.scope.viewModel.publishState;if(5===e){var t=this.scope.viewModel.embedTab,i=this.scope.viewModel.exploration.contract.report.objectId;t.embed.link=this.services.embed.createSharepointEmbedUri(i)}},i})();i.EmbedModalDialogController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.scope=e,this.scope.toggleTaskPane=function(){return t.toggleTaskPane()}}return e.createOptions=function(){return{}},e.prototype.toggleTaskPane=function(){this.scope.viewModel.isPaneExpanded=!this.scope.viewModel.isPaneExpanded},e})();e.TaskPaneController=t})(t=e.controllers||(e.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(e.explore.contracts,(function(){function e(e,t){var i=this;this.services=t,this.updateMenuItemsCallId=0,e.$watchCollection("$ctrl.selectors",(function(){return i.updateMenuItems()}))}return e.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","featureSwitchService","localizationService","overlayService","promiseFactory"],scopedDependencies:["dataSources","drill","drillToDetails","groupAuthoring","eventBridge","includeExcludeService","popOut","visualAuthoring"]}},e.prototype.updateMenuItems=function(){var e=this;this.updateMenuItemsCallId++;var i=this.updateMenuItemsCallId,r=this.services.drill.getSupportedDrillDirections(this.visualContainer),o=this.services.drill.canDrillToDetails(this.visualContainer),n=this.visualContainer&&2!==this.visualContainer.popOutMode&&this.services.drill.canSeeData(this.visualContainer),a=!1,s=!1,l=this.services.dataSources.get();l?this.services.conceptualSchemaProxy.get(l).then((function(l){e.isLastUpdateMenuItemsCall(i)&&(e.services.featureSwitchService.featureSwitches.includeExcludeEnabled&&!_.isEmpty(e.selectors)&&null!=e.selectors[0].dataMap&&(s=e.services.includeExcludeService.isIncludeExcludeSupported(e.visualContainer,l,e.services.featureSwitchService.featureSwitches.tuplesFiltering)),e.services.featureSwitchService.featureSwitches.enableGroupAuthoring&&!e.pendingGroupOperation&&(a=e.services.groupAuthoring.visual.canGroup(e.visualContainer,e.selectors,l)),e.resetUpdateMenuItemsCallCount(),e.menuItems=t.viewModels.VisualContainerContextMenuViewModelFactory.createMenuItems({drillDirections:r,canDrillToDetails:o,canSeeData:n,enableGroupAuthoring:a,enableIncludeExclude:s},e.services.localizationService))})):(this.resetUpdateMenuItemsCallCount(),this.menuItems=t.viewModels.VisualContainerContextMenuViewModelFactory.createMenuItems({drillDirections:r,canDrillToDetails:o,canSeeData:n,enableGroupAuthoring:a,enableIncludeExclude:s},this.services.localizationService))},e.prototype.select=function(e){if(e.type===DropDownMenuItemType.Item){switch(e.action){case 1:this.drillDown();break;case 0:this.drillUp();break;case 2:this.drillDownLevel(3);break;case 3:this.drillDownLevel(2);break;case 4:this.drillToDetails();break;case 5:this.seeData();break;case 6:this.createGroup();break;case 7:this.services.includeExcludeService.setFilter(3,this.selectors,this.visualContainer);break;case 8:this.services.includeExcludeService.setFilter(4,this.selectors,this.visualContainer)}this.services.overlayService.hideAllDropdowns()}},e.prototype.isLastUpdateMenuItemsCall=function(e){return this.updateMenuItemsCallId===e},e.prototype.resetUpdateMenuItemsCallCount=function(){this.updateMenuItemsCallId=0},e.prototype.drillUp=function(){this.services.visualAuthoring.drillUp(null,this.visualContainer)},e.prototype.drillDownLevel=function(e){this.services.visualAuthoring.drillDownLevel(null,this.visualContainer,e)},e.prototype.seeData=function(){this.services.popOut.popOutVisualContainer(this.visualContainer,2)},e.prototype.drillToDetails=function(){if(!_.isEmpty(this.selectors)){var e=this.services.dataSources.get();this.services.drillToDetails.drillToDetails(this.selectors,this.visualContainer,e)}},e.prototype.drillDown=function(){_.isEmpty(this.selectors)||this.services.visualAuthoring.drillDown(this.selectors,this.visualContainer,this.services.dataSources.get())},e.prototype.createGroup=function(){var e=this;if(!this.pendingGroupOperation){this.pendingGroupOperation=!0;var t=this.services.dataSources.get();this.services.conceptualSchemaProxy.get(t).then((function(i){return e.services.groupAuthoring.visual.group(e.visualContainer,e.selectors,!0,t,i)})).finally((function(){e.pendingGroupOperation=!1}))}},e})());i.VisualContainerContextMenuController=r})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.constants,o=e.common.events,n=t.util.DragDropTypes,a=e.common.directives.DragDropUtils,s=e.data.dsr.DsrMessage,l=t.services.events,c=t.util.QueryGeocodingTracker,u=t.services.selectionUtils,d=e.data.Selector,p=e.data.SQExpr,v=e.data.SQExprConverter,h=t.util.VisualContainerUtils,g=(function(){function i(i,o){var a=this;this.scope=i,this.services=o,this.isExplorationUnloaded=!1,this.initializeVisualContainerQueryHandler(),this.progressBarCount=0,this.detailVisualProgressBarCount=0,this.scopeEventManager=e.common.createScopeEventSubscriptionManager(i),this.scope.getVisualContainerStyle=function(){return a.getVisualContainerStyle()},this.scope.isHeaderVisible=function(){return a.isHeaderVisible()},this.scope.canRemoveFromLayout=function(){return a.canRemoveFromLayout()},this.scope.removeVisualFromLayout=function(){return a.removeVisualFromLayout()},this.scope.isPopOutBarVisible=function(){return a.isPopOutBarVisible()},this.scope.canInFocusEdit=function(){return a.canInFocusEdit()},this.scope.toggleInFocusEditMode=function(){return a.toggleInFocusEditMode()},this.scope.viewModeState=o.viewModeState,this.scope.viewModel.showWatermark=!1,this.scope.viewModel.options=o.explorationCapabilities.getCapabilities().visualContainerOptions,this.scope.$watch("viewModel.errorInfo",(function(){return a.updateDetailVisualVisibility()})),this.scope.ensureFocus=function(e){return a.ensureFocus(e)},this.scope.toggleSelect=function(e){return a.toggleSelect(e)},this.scope.onDoubleClick=function(e){return a.onDoubleClick(e)},this.scope.onTouchMove=function(e){return a.onTouchMove(e)},this.scope.onVisualContainerChanged=function(){return a.onVisualContainerChanged()},this.scope.menuOptions={canDelete:!1,canExport:!1,canSort:!1,canSearch:!1,canCluster:!1,canSpatialCluster:!1,hasMoreOptions:!1,sortSetting:{defaultSortBehavior:!1,sortableFields:[]}},this.visualSort=e.explore.services.createVisualSortHelper(this.scope.menuOptions.sortSetting,this.scope.viewModel,this.services.sort,this.services.undoRedo,this.services.timeout,this.services.visualAuthoring),this.scope.hasPositionOverride=function(){return null!=a.scope.viewModel.overridePosition},this.scope.getDragRestriction=function(){return a.getDragRestrictElementRect()},this.scope.drop=function(e,t){return a.drop(e,t)},this.scope.dropConfig={accept:n.Field,greedy:!1},this.scopeEventManager.subscribe(t.constants.explorationLoadedEventName,(function(){return a.applyUpdate(!0)})),this.setViewModelServices(),this.scope.closePopOut=function(){a.setPopOutMode(0),2===a.services.viewModeState.getMode()&&a.services.viewModeState.setMode(1)},this.scope.getContextMenuId=function(){return a.getContextMenuId()},this.scope.getMenuId=function(){return a.getMenuId()},this.scope.disablePin=this.scope.viewModel.options.disablePin,this.scope.$watch("viewModel.options.disablePin",(function(){return a.updateDisablePin()})),this.resetVisualStyle(),this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.resetSortSettings(),this.scope.viewModel.updateViewState(),this.updateSelection(),this.resetPadding(),this.scopeEventManager.subscribe(t.constants.TransformElementDragStartEventName,(function(e,t){a.isSelected()||a.selectVisualContainer()})),this.scopeEventManager.subscribe(r.visualDataChanged,(function(e){e.stopPropagation(),a.services.eventBridge.publishToChannel(l.visualContainerDataRendered,a.scope.viewModel.contract)})),this.createCanvasLayoutItemOptions(),this.subscribeToEvents();var s=this.scope.viewModel.contract,u=!s.initialLoadCompleted;s.initialLoadCompleted=!0;var d;this.services.networkAvailability.isNetworkAvailable()||(d=!0),this.scope.$applyAsync((function(){return a.onVisualContainerChanged(u,d)})),this.geocodingTracker=new c({onStartGeocoding:function(){a.scope.viewModel.showProgressBar=!0,a.scope.$applyAsync()},onStopGeocoding:function(){a.updateProgressBarState(),a.scope.$applyAsync()}}),this.setTransformScopeProperties(this.scope)}return i.createOptions=function(){return{additionalServices:["conceptualSchemaProxy","errorService","dataProxy","displayNameService","dragDataService","embedModeService","errorService","explorationSerializer","featureSwitchService","geocoder","loadProgressNotificationService","localizationService","networkAvailability","overlayService","promiseFactory","singleExecutableDataProxyFactory","telemetryService","visualHostTooltip"],scopedDependencies:["clipboard","clusteringService","clusteringState","dataSources","drill","drillToDetails","eventBridge","explorationCapabilities","explorationNavigation","filterGenerator","formFactor","groupingDesignStateService","layoutAuthoring","popOut","resourceLoader","scriptVisuals","selection","shell","sort","undoRedo","viewModeState","visualAuthoring","visualPlugin","visualQueryGenerator"]}},i.prototype.setTransformScopeProperties=function(t){var i=this.services.formFactor.getCurrentLayoutCapabilities();t.aspectRatioOffset=e.explore.viewModels.VisualContainer.getVisualBodyOffset(i)},i.prototype.initializeVisualContainerQueryHandler=function(){var e=this,i={getDataSources:function(){return e.services.dataSources.get()},notifyStart:function(){return e.startProgressBar()},notifyEnd:function(){return e.stopProgressBar()},clearErrors:function(){return e.scope.ctrlError.clearError()},handleErrors:function(t){return e.handleQueryErrors(t)},handleWarnings:function(t,i){return e.handleWarnings(t,i)},applyUpdate:function(t,i,r){return e.handleQueryResult(t,i,r)},loadMergedData:function(t){return e.loadMergedData(t)}};this.queryHandler=t.services.createVisualContainerQueryHandler(i,this.scope.viewModel.hostServices,this.services.promiseFactory,this.services.conceptualSchemaProxy,this.services.featureSwitchService,this.services.telemetryService,this.services.visualQueryGenerator,this.services.visualPlugin,this.services.dataProxy,this.services.networkAvailability,this.services.singleExecutableDataProxyFactory,this.services.embedModeService,this.services.filterGenerator,this.services.scriptVisuals,this.services.displayNameService,this.services.explorationNavigation,this.services.resourceLoader,this.services.eventBridge,this.services.shell,this.services.localizationService)},i.prototype.getVisualContainerStyle=function(){var e=this.scope.viewModel,t=this.services.viewModeState,i=this.services.viewModeState.getConfig();return{loading:!e.contract.initialLoadCompleted,selected:e.isSelected,"swipeable-blocked":e.isSelected,readMode:0===t.getMode(),editMode:1===t.getMode(),hideBorder:i.displayOptions.hideVisualBorders,disableFadeout:i.displayOptions.disableFadeout,popOut:e.isPoppedOut,seeData:2===e.contract.popOutMode,seeDataVerticalLayout:2===e.contract.detailVisualLayout,paddingDisabled:e.isPaddingDisabled,noVisualTitle:!e.visualTitleVisible(),preventVisualScrolling:this.preventInnerScroll()}},i.prototype.toggleSelect=function(e){var i=this;if(e.ctrlKey&&this.isSelected()&&u.getSelectedVisuals(this.services.selection).length>1)return t.util.EventBubblingUtility.markAsHandled(e),this.services.overlayService.hideAllDropdowns(),void u.unselectVisualContainer(this.scope.viewModel.contract,this.services.selection);this.selectVisualContainer(e.ctrlKey),this.services.overlayService.hideAllDropdowns();var r=!t.util.EventBubblingUtility.handled(e),o=$(e.currentTarget);t.util.EventBubblingUtility.markAsHandled(e),this.services.timeout((function(){r&&o.focus(),i.services.clipboard.tryPasteFormat()}))},i.prototype.onDoubleClick=function(e){this.services.viewModeState.getConfig().visualDoubleClickEnabled&&this.popOutVisualContainer()},i.prototype.getContextMenuId=function(){return"contextMenu"+this.getMenuId()},i.prototype.getMenuId=function(){if(this.scope)return this.scope.$id.toString()},i.prototype.onContextMenu=function(e){if(this.scope.viewModel.options.showContextMenu){this.scope.contextMenuData=e.data,this.isSelected()||this.selectVisualContainer();var t=this.scope.getContextMenuId(),i=this.services.overlayService.getOverlayElement(t);this.services.overlayService.showOverlay(i,{position:e.position,hideExistingOverlays:!0})}},i.prototype.ensureFocus=function(e){t.util.FocusUtility.isFocusInTree($(e.currentTarget))&&t.util.EventBubblingUtility.markAsHandled(e)},i.prototype.setViewModelServices=function(){var i=this;this.scope.viewModel.setServices({getLocalizedString:function(e){return i.services.localizationService.get(e)},canSelect:function(e){return i.canSelect(e)},onDragStart:function(e){return i.onDragStart(e)},onContextMenu:function(e){return i.scope.$applyAsync((function(){return i.onContextMenu(e)}))},onSelecting:function(e){return i.onSelecting(e)},onSelect:function(e){return i.onSelect(e)},persistProperties:function(e){return i.persistProperties(e)},shouldRetainSelection:function(){return i.shouldRetainSelection()},loadMoreData:function(){return i.loadMoreData()},onCustomSort:function(e){return i.onCustomSort(e.sortDescriptors)},getViewMode:function(){return i.scope.viewModeState.getMode()},setWarnings:function(e){return i.setClientWarnings(e)},setToolbar:function(e){return i.setToolbar(e)},geocoder:function(){return i.geocodingTracker.wrapGeocoder(i.services.geocoder)},geolocation:function(){return e.visuals.services.createGeolocation()},locale:function(){return e.common.unmappedCultureInfo},promiseFactory:function(){return i.services.promiseFactory},analyzeFilter:function(e){return t.services.createAnalyzedFilter(e,!1)},setIdentityDisplayNames:_.noop,getIdentityDisplayNames:function(e){return i.getLabelForScopeId(e)},visualCapabilitiesChanged:function(){return i.visualCapabilitiesChanged()},tooltips:function(){return i.services.visualHostTooltip}},this.services.visualPlugin,this.scope.viewModeState,this.services.formFactor,{getNextDataSegment:function(){return i.getNextDataSegment()},startProgressBar:function(){return i.startProgressBar()},stopProgressBar:function(){return i.stopProgressBar()}})},i.prototype.visualCapabilitiesChanged=function(){this.convertTo(this.scope.viewModel.readOnlyState.visual.type),this.services.eventBridge.publishToChannel(l.visualContainerChanged,{affectContainer:function(){return!0}})},i.prototype.getLabelForScopeId=function(e){return _.map(e,(function(e){return{displayName:v.getFirstComparandValue(e),identity:e}}))},i.prototype.createCanvasLayoutItemOptions=function(){var e=this,t=function(t,i){e.hideOverlays()},i=function(t,i){1===e.services.selection.getSelectedElements().length&&e.updateDimensions(t,i)},r=function(t,i){if(e.isEditable()&&!e.scope.viewModel.isPoppedOut&&1===e.services.selection.getSelectedElements().length){var r=new m(e.scope.viewModel.id,"nudge");e.updateDimensions(t,i,r),e.services.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1})}},n=function(t,i){e.hideOverlays(),e.services.eventBridge.publishToChannel(o.visualContainerResizeStart)},a=function(t,i){return e.updateVisualViewport(t,i)},s=function(t,i){e.updateDimensions(t,i),e.services.eventBridge.publishToChannel(o.visualContainerResizeEnd)},l=function(){return e.isExplorationUnloaded},c=function(){return e.getPosition(e.scope.viewModel.contract)},u=function(){return e.scope.viewModel.uiScale};this.scope.canvasLayoutItemOptions={dragEnd:i,dragStart:t,nudge:r,resizeStart:n,resizeMove:a,resizeEnd:s,isSuspended:l,getPosition:c,getScale:u}},i.prototype.subscribeToEvents=function(){var e=this,i=this.services.eventBridge.createChannelSubscriptionManager().subscribe(l.selectionChanged,(function(){return e.updateSelection()})).subscribe(l.visualContainerChanged,(function(t,i){i&&i.affectContainer(e.scope.viewModel.contract)&&!e.tryDeleteEmptyContainer()&&e.onVisualContainerChanged(!1,i.allowCache)})).subscribe(l.filterContainerChanged,(function(t,i){0===i.scope.scopeType&&i.scope.container!==e.scope.viewModel.contract||e.applyUpdate()})).subscribe(l.dataSelectionChanged,(function(t,i){i&&i.affectContainer(e.scope.viewModel.contract)&&e.clearDataSelection()})).subscribe(l.explorationUnloaded,(function(t,i){e.scopeEventManager.unsubscribeAll(),e.isExplorationUnloaded=!0})).subscribe(l.changeViewMode,(function(t,i){return e.onChangeViewMode(i)})).subscribe(l.popOutModeChanged,(function(){var t=e.scope.viewModel.readOnlyState.visual;t.isInFocus=e.scope.viewModel.isPoppedOut,e.detailVisualProgressBarCount&&2!==e.scope.viewModel.contract.popOutMode&&(e.detailVisualProgressBarCount=0,e.updateProgressBarState()),e.scope.viewModel.updateViewState(),h.isScriptVisual(e.scope.viewModel.contract,e.services.visualPlugin)&&e.applyUpdate()}));this.services.eventBridge.subscribeToBubbling(this.scope,t.viewModels.DetailVisualEvents.spinnerAction,(function(t,i){if(t.stopPropagation&&t.stopPropagation(),2===e.scope.viewModel.contract.popOutMode)switch(i){case 0:e.scope.viewModel.showProgressBar=!0,e.detailVisualProgressBarCount++;break;case 1:0===--e.detailVisualProgressBarCount&&e.updateProgressBarState()}})),this.services.eventBridge.subscribeToBubbling(this.scope,l.toggleSortVisualContainer,(function(t,i){e.visualSort.toggleSort(i.sortableField,i.sortDirection)})),this.services.eventBridge.subscribeToBubbling(this.scope,l.getClusters,(function(t,i){e.services.clusteringService.createClusters(e.scope.viewModel,e.services.dataSources.get(),i.useSpatialClustering)})),this.scope.$on("$destroy",(function(){i.unsubscribeAll(),e.scope.viewModel.contract.config.singleVisual.getCurrentVisual=void 0,e.scope.viewModel.contract.config.singleVisual.getErrorDetails=void 0,e.scope.viewModel.contract.config.singleVisual.getWarnings=void 0,e.scope.viewModel.contract.config.singleVisual.getCurrentVisualSelection=void 0}))},i.prototype.drop=function(t,i){var r=this.services.dragDataService.getDragContext();r&&r.field&&a.isDropOnExpectedTarget(i.draggable,this.scope.viewModel.contract)&&(u.selectVisualContainer(this.scope.viewModel.contract,this.services.selection),this.services.visualAuthoring.addFieldToVisual(r.field,this.services.dataSources.get(),this.scope.viewModel.contract,e.telemetry.HowFieldWasAddedToVisual.DraggedToVisual))},i.prototype.getDragRestrictElementRect=function(){var e={top:0,left:0,bottom:1,right:1};if(u.hasMultipleVisualContainerSelection(this.services.selection)){for(var t=u.getSelectedVisuals(this.services.selection),i=0,r=0,o=0,n=0,a=null,s=0,l=0,c=t.length;l<c;l++){s=l;var d=t[l],p=this.scope.viewModel.contract;if(d===p){a=this.getPosition(d);break}}if(!a)return;if(t.splice(s,1),a){for(var v=0,h=t;v<h.length;v++){var d=h[v],g=this.getPosition(d),f=a.x-g.x;i=i<f?f:i,f=g.y+g.height-(a.y+a.height),r=r<f?f:r,f=a.y-g.y,o=o<f?f:o,f=g.x+g.width-(a.x+a.width),n=n<f?f:n}e={top:0-(o>0?o/a.height:0),left:0-(i>0?i/a.width:0),bottom:1+(r>0?r/a.height:0),right:1+(n>0?n/a.width:0)}}}return e},i.prototype.setClientWarnings=function(e){if(_.isEmpty(e))return void(this.warnings=null);if(_.isArray(e)?this.warnings={warnings:e}:this.warnings=e,!_.isEmpty(this.warnings.warnings)){var t=this.warnings.warnings[0].getMessages(this.services.localizationService),i={message:t.message,displayableErrorInfo:[{errorInfoKey:t.title,errorInfoValue:t.detail}]};this.scope.ctrlError.showInfoIcon(i,this.warnings.warnings[0].code)}},i.prototype.setToolbar=function(e){this.scope.viewModel.toolbarViewModel.$element=e,this.scope.viewModel.toolbarViewModel.update(),null!=e&&this.setToolbarVisible(!0)},i.prototype.setToolbarVisible=function(e){var t=this;if(this.scope.viewModel.toolbarViewModel.$element){var i=this.services.viewModeState.getMode();if(e=e&&this.scope.viewModel.isSelected&&(1===i||2===i)){var r=this.services.formFactor.getCurrentLayoutCapabilities();e=r.canShowVisualToolbar()}this.scope.viewModel.toolbarViewModel.visible!==e&&this.scope.$applyAsync((function(){t.scope.viewModel.toolbarViewModel.visible=e,t.scope.viewModel.toolbarViewModel.update()}))}},i.prototype.hideOverlays=function(){this.services.overlayService.hideAllDropdowns(),
this.setToolbarVisible(!1)},i.prototype.onVisualContainerChanged=function(e,t){var i=this,r=this.scope.viewModel;r.contract.config.singleVisual.getCurrentVisual=function(){return r.readOnlyState.visual.visual},r.contract.config.singleVisual.getErrorDetails=function(){return i.getErrorDetails()},r.contract.config.singleVisual.getWarnings=function(){return i.getWarnings()},r.contract.config.singleVisual.getCurrentVisualSelection=function(){},this.updateVisualContainerProperties();var o=r.dataViewSource,n=this.scope.viewModel.readOnlyState.visual;o?(this.queryHandler.visualizeDataViewSource(r.contract,o,n.viewport),r.dataViewSource=null):h.isQueryVisualContainer(r.contract,this.services.visualPlugin)?this.scope.viewModel.errorInfo||this.applyUpdate(e,!1,t):this.queryHandler.updateNonQueryVisual(r.contract,n.dataTransforms)},i.prototype.updateVisualContainerProperties=function(){var e=this.scope.viewModel;this.scope.ctrlError.clearError();var t=this.queryHandler.validate(e.contract);t&&(this.scope.ctrlError.showErrorOverlay(t.details,t.code),this.updateDisablePin()),this.updateDetailVisualVisibility(),this.resetBackground(),this.resetTitle(),this.resetAspectRatio(),this.resetBorder(),this.resetPadding(),this.resetSortSettings(),this.updateMenuButtonsState(),this.scope.viewModel.errorInfo||e.updateViewState()},i.prototype.getErrorDetails=function(){if(this.scope.viewModel.errorInfo)return this.scope.viewModel.errorInfo.details},i.prototype.getWarnings=function(){return this.warnings},i.prototype.updateMenuButtonsState=function(){var e=this,t=this.scope.menuOptions;t.canExport=this.canExport(),t.canDelete=(1===this.services.viewModeState.getMode()||2===this.services.viewModeState.getMode())&&this.services.viewModeState.getConfig().supportsDeletion;var i=t.sortSetting;t.canSort=i.defaultSortBehavior&&i.sortableFields.length>0;var r=[];r.push(this.canSearch().then((function(){return t.canSearch=!0,!0}),(function(){return t.canSearch=!1,!0}))),r.push(this.canCluster().then((function(){return t.canCluster=1===e.services.viewModeState.getMode(),t.canSpatialCluster=t.canCluster&&e.services.featureSwitchService.featureSwitches.spatialClusteringEnabled,!0}),(function(){return t.canCluster=!1,t.canSpatialCluster=!1,!0}))),this.services.promiseFactory.all(r).then((function(){t.hasMoreOptions=e.scope.viewModel.options.showMenu&&(t.canExport||t.canDelete||t.canSort||t.canSearch||t.canCluster)}))},i.prototype.canCluster=function(){var t=this;if(!this.services.featureSwitchService.featureSwitches.clusteringEnabled)return this.services.promiseFactory.reject();var i=this.scope.viewModel.contract.config.singleVisual,r=this.services.visualPlugin.capabilities(i.visualType);if(!r||!r.grouping||!r.grouping.cluster)return this.services.promiseFactory.reject();var o=r.grouping.cluster,n=this.services.dataSources.get();return this.services.conceptualSchemaProxy.get(n).then((function(r){var a=_.every(n,(function(e){return r.schema(e.name).capabilities.supportsClustering}));if(!a)return t.services.promiseFactory.reject();var s=i.query;if(!s||!s.defn||_.some(s.defn.select(),(function(e){return p.isHierarchyLevel(e.expr)||p.isHierarchy(e.expr)}))||h.hasGroupByItems(s))return t.services.promiseFactory.reject();for(var l=s.projections,c=h.createRoleKindByQueryRef(i.query,r),u=0,d=o.conditions;u<d.length;u++){var v=d[u],g=e.DataViewAnalysis.checkForConditionErrors(l,v,c,!1);if(_.isEmpty(g))return t.services.promiseFactory.resolve()}return t.services.promiseFactory.reject()}))},i.prototype.updateVisualViewport=function(e,t){e.stopPropagation();var i={width:t.width,height:t.height};this.scope.viewModel.updateVisualViewportForUserResize(i),this.setToolbarVisible(!1)},i.prototype.updateDimensions=function(e,t,i){var r=this;e.stopPropagation&&e.stopPropagation(),this.services.undoRedo.register("VisualContainerUpdateDimensions",(function(){var e=r.scope.viewModel,i={x:t.x,y:t.y,z:e.position.z,width:t.width,height:t.height,angle:t.angle};r.services.layoutAuthoring.moveVisualContainer(r.scope.viewModel,i)}),i),this.setToolbarVisible(!0)},i.prototype.convertTo=function(e){var i=this;this.services.eventBridge.publishBubbling(this.scope,l.visualConversion,{visualContainer:this.scope.viewModel.contract,newVisualType:e,actionAfterConversion:function(){i.resetSortSettings(),t.util.VisualContainerUtils.notifyVisualContainersExceptSource(i.services.eventBridge,i.scope.viewModel.contract)}})},i.prototype.getPosition=function(e){var t=e.layouts.withId(this.services.formFactor.getCurrentLayout());return t&&t.position},i.prototype.selectVisualContainer=function(e){u.selectVisualContainer(this.scope.viewModel.contract,this.services.selection,e)},i.prototype.isSelected=function(){return u.isVisualContainerSelected(this.scope.viewModel.contract,this.services.selection)},i.prototype.updateSelection=function(){var e=this.isSelected();this.scope.viewModel.setSelected(e),this.setToolbarVisible(e),this.scope.$emit(r.VisualSelectionOrPositionChangedEventName)},i.prototype.preventInnerScroll=function(){return!this.isSelected()&&this.services.viewModeState.getConfig().touchOptions.touchEventsOnSelectedVisualOnly},i.prototype.onTouchMove=function(e){this.isSelected()&&this.services.viewModeState.getConfig().touchOptions.disableCanvasScrollOnSelectedVisual&&e.preventDefault()},i.prototype.clearDataSelection=function(){var e=this.scope.viewModel.readOnlyState.visual,t=e.visual;t&&t.onClearSelection&&t.onClearSelection()},i.prototype.onChangeViewMode=function(e){this.updateMenuButtonsState();var t=1===e||2===e;this.setToolbarVisible(t);var i=this.scope.viewModel.readOnlyState.visual,r=i.visual;r&&r.onViewModeChanged&&r.onViewModeChanged(e)},i.prototype.canInFocusEdit=function(){return this.services.featureSwitchService.featureSwitches.inFocusEditModeEnabled?this.canPhysicallyInFocusEdit():(this.scope.viewModel.contract.config.singleVisual.visualType===e.visualHost.EsriVisual||this.scope.viewModel.contract.config.singleVisual.visualType===e.visualHost.SandDanceVisual)&&this.canPhysicallyInFocusEdit()},i.prototype.canPhysicallyInFocusEdit=function(){return!!(1===this.services.viewModeState.getMode()&&0===this.services.formFactor.getCurrentLayout()&&!this.scope.viewModel.errorInfo&&this.canPopOut()&&this.scope.viewModel.readOnlyState.visual.viewport.width>=100&&this.scope.viewModel.readOnlyState.visual.viewport.height>=50)},i.prototype.popOutVisualContainer=function(){var e=this.scope.viewModel;this.services.popOut.popOutVisualContainer(e.contract,1)},i.prototype.canPopOut=function(){return!this.scope.viewModel.isPoppedOut&&h.supportsFocusMode(h.getVisualType(this.scope.viewModel.contract),this.services.visualPlugin)},i.prototype.toggleInFocusEditMode=function(){this.services.viewModeState.setMode(2),this.services.viewModeState.updateConfig((function(e){e.alwaysPopulatePanes||(e.alwaysPopulatePanes=!0)})),this.popOutVisualContainer()},i.prototype.resetSortSettings=function(){var e=this,t=this.services.dataSources.get();t&&this.services.conceptualSchemaProxy.get(t).then((function(t){var i=e.scope.viewModel.contract.config.singleVisual;if(i&&i.query){var r=e.services.visualPlugin.capabilities(i.visualType),o=i.query;if(r){var n=void 0!==r.sorting&&void 0!==r.sorting.default,a=e.services.sort.getSortableFields({query:o,schema:t,visualType:i.visualType,objectDefns:i.objects});e.visualSort.resetSortSettings(a,n)}}var s=_.findIndex(e.scope.menuOptions.sortSetting.sortableFields,(function(e){return e.active}));s>=0&&(e.scope.viewModel.readOnlyState.actualSortDirection=e.scope.menuOptions.sortSetting.sortableFields[s].sortDirection),e.updateMenuButtonsState()}))},i.prototype.resetVisualStyle=function(){var e=t.ScopeUtils.findThemeName(this.scope);this.scope.viewModel.themeName=e},i.prototype.resetPadding=function(){var e=this.scope.viewModel.contract.config.singleVisual,t=this.services.visualPlugin.capabilities(e.visualType);this.scope.viewModel.isPaddingDisabled=t&&t.suppressDefaultPadding},i.prototype.resetBackground=function(){var e=this.scope.viewModel.contract.config.singleVisual,t=e.background,i=this.scope.viewModel;t&&t.show?i.visualBackground={colorRGB:h.getVisualBackgroundRGBColor(t)}:i.visualBackground=null},i.prototype.resetAspectRatio=function(){var e=this.scope.viewModel,t=e.contract.config.singleVisual.aspectRatio;e.lockAspectRatio=!(!t||!t.show)},i.prototype.resetBorder=function(){var e=this.scope.viewModel.contract.config.singleVisual,i=e.border,r=this.scope.viewModel,o=t.viewModels.VisualBorder.getDefaultValues(),n={show:i?i.show:o.show,color:i&&i.color?i.color:o.color};r.visualBorder=n.show?new t.viewModels.VisualBorder(n):null},i.prototype.resetTitle=function(){var i=this,r=this.scope.viewModel,o=r.contract.config.singleVisual,n=this.services.visualPlugin.capabilities(o.visualType),a=this.services.dataSources.get();this.startProgressBar(),n&&!t.contracts.VisualTitle.isHidden(o.title)&&a?this.services.conceptualSchemaProxy.get(a).then((function(t){i.services.displayNameService&&(r.setVisualTitle(i.services.displayNameService.getVisualTitle(o,t,n,e.common.localize)),r.updateViewState())})).finally((function(){i.stopProgressBar()})):(r.visualTitle=void 0,this.stopProgressBar())},i.prototype.hasMultipleScopeIds=function(e){if(!(e&&e.data&&e.data.length>0))return!1;if(e.data.length>1)return!0;if(!e.data[0])return!1;var t=e.data[0];if(!t.expr)return!1;var i=t.expr;return 8===i.kind},i.prototype.canSelect=function(i){var r,o=this,n=e.extensibility.legacy.isOldSelectEventArgs(i);if(r=n?e.extensibility.legacy.getSelectors(i):_.map(i.visualObjects,(function(e){return d.convertSelectorsByColumnToSelector(e.selectorsByColumn)})),r.length>1&&r.some((function(e){return o.hasMultipleScopeIds(e)}))){if(i.visualObjects){var a=this.scope.viewModel.contract.config.singleVisual,s=_.map(i.visualObjects,(function(e){return e.selectorsByColumn}));if(this.services.featureSwitchService.featureSwitches.tuplesFiltering||t.utils.GroupUtils.canGroup(s,a.query))return!0}return!1}return!0},i.prototype.onDragStart=function(e){},i.prototype.shouldRetainSelection=function(){return this.isDrillEnabled()},i.prototype.isDrillEnabled=function(){var e=this.scope.viewModel.contract,t=this.services.drill;if(e&&e.drillMode)return t.isDrillModeEnabled(e,1)||t.isDrillModeEnabled(e,2)},i.prototype.drill=function(e){var t=this.scope.viewModel.contract,i=this.services.dataSources.get();switch(t.drillMode){case 1:this.services.visualAuthoring.drillDown(e,t,i);break;case 2:this.services.drillToDetails.drillToDetails(e,t,i)}},i.prototype.onSelecting=function(e){this.isDrillEnabled()?(this.drill(_.map(e.visualObjects,(function(e){return e.selectorsByColumn}))),e.action=1):e.action=0},i.prototype.onSelect=function(t){var i=e.extensibility.legacy.isOldSelectEventArgs(t);if(this.isDrillEnabled())this.services.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1}),i?this.drill(e.extensibility.legacy.getSelectorsByColumn(t)):this.drill(_.map(t.visualObjects,(function(e){return e.selectorsByColumn})));else{var r=void 0;r=i?e.extensibility.legacy.getSelectors(t):_.map(t.visualObjects,(function(e){return d.convertSelectorsByColumnToSelector(e.selectorsByColumn)}));for(var o=0,n=r;o<n.length;o++){var a=n[o];a.data=d.filterTransformSelectorsForSelection(a.data)}var s=this.scope.viewModel.contract.config.singleVisual,l=!0;s.getCurrentVisualSelection&&(l=0!==_.size(t.visualObjects)||0!==_.size(s.getCurrentVisualSelection())),s.getCurrentVisualSelection=function(){return t.visualObjects?_.map(t.visualObjects,(function(e){return e.selectorsByColumn})):void 0},this.scope.viewModel.hostServices.selectDataPoint(this.services.filterGenerator,r),l&&this.raiseDataPointsSelectedEvent(r)}},i.prototype.raiseDataPointsSelectedEvent=function(e){var t={selectors:e,visualContainer:this.scope.viewModel.contract,visualTitleText:this.scope.viewModel.visualTitle?this.scope.viewModel.visualTitle.text:null};this.services.eventBridge.publishToChannel(l.dataPointsSelected,t)},i.prototype.startProgressBar=function(){var e=this.scope.viewModel.showProgressBar;this.scope.viewModel.showProgressBar=!0,this.progressBarCount++,e||this.services.loadProgressNotificationService.beginLoad()},i.prototype.stopProgressBar=function(){0===--this.progressBarCount&&this.updateProgressBarState()},i.prototype.updateProgressBarState=function(){this.scope.viewModel.showProgressBar=this.progressBarCount>0&&this.detailVisualProgressBarCount>0&&this.geocodingTracker.hasPendingGeocoding(),this.scope.viewModel.showProgressBar||this.services.loadProgressNotificationService.endLoad()},i.prototype.updateDisablePin=function(){this.scope.disablePin=this.scope.viewModel.options.disablePin||this.shouldBlockPinButtonForScriptVisual()},i.prototype.shouldBlockPinButtonForScriptVisual=function(){var e=this.services.visualPlugin,t=this.scope.viewModel.contract;return h.isScriptVisual(t,e)&&this.services.viewModeState.getConfig().supportsPinning&&this.services.scriptVisuals.shouldBlockScriptVisual()},i.prototype.applyUpdate=function(e,t,i){var r=this.scope.viewModel,o=r.contract,n=r.readOnlyState.visual&&r.readOnlyState.visual.viewport,a=this.scope.viewModel.readOnlyState.visual;this.queryHandler.runQuery({contract:o,viewport:n,initialLoad:e,useVisualContainerCache:r.shouldUseCache(),preferCurrentData:t,allowCache:i,currentData:a.data,geocodingTracker:this.geocodingTracker})},i.prototype.loadMergedData=function(e){var t=this.scope.viewModel.readOnlyState.visual;t.data=e},i.prototype.handleQueryResult=function(t,i,r){var o=this.scope.viewModel.readOnlyState.visual;o.dataTransforms=i,r&&(o.dataTransforms=e.Prototype.inherit(o.dataTransforms),o.dataTransforms.objects=r),o.data=t;var n=this.scope.viewModel;n&&n.contract&&n.contract.cachedData&&n.contract.cachedData.dataUpdatedTime&&(n.lastUpdateAttemptTime=(new Date).toLocaleString())},i.prototype.handleQueryErrors=function(i){if(i||(i=new f),!i.ignorable||i.ignorable!==!0){var o,n=this.scope.viewModel.readOnlyState.visual;if(i instanceof e.DsrClientError){var a=i,s=a.powerBiErrorDetails,l=a.AdditionalErrorMessages;if(s)try{var c=JSON.parse(s);o=c.error,this.services.eventBridge.publishBubbling(this.scope,t.services.events.showErrorNotification,c.error)}catch(e){}if(l)for(var u=0,d=l.length;u<d;u++){var p=l[u];if(p.Code&&p.Message){var v=p.Code,g=p.Message;if(v===r.serverErrors.onPremiseServiceException)try{var c=JSON.parse(g);o=c.error,this.services.eventBridge.publishBubbling(this.scope,t.services.events.showErrorNotification,c.error)}catch(e){}}}}var m=i.getDetails(e.common.localize);if(o){m.displayableErrorInfo.length>0&&(m.displayableErrorInfo[0].errorInfoValue=e.common.localize.get(e.helpers.PowerBIServiceExceptionErrorHelper.serverErrorPrefix+o.code)),m.displayableErrorInfo.push({errorInfoKey:e.common.localize.get("AdditionalErrorInfo_ErrorText"),errorInfoValue:o.code});var y=e.helpers.PowerBIServiceExceptionErrorHelper.GenerateErrorMessage(o);y.always((function(e){if(e&&e.displayableErrorInfo)for(var t=0;t<e.displayableErrorInfo.length;t++)m.displayableErrorInfo.push(e.displayableErrorInfo[t])}))}if(h.isScriptVisual(this.scope.viewModel.contract,this.services.visualPlugin)){var w=this.services.scriptVisuals.overrideEmbeddedErrorDetails(m);m=w||m}this.scope.ctrlError.showErrorOverlay(m,i.code,i.requestId),n.data=null}},i.prototype.handleWarnings=function(t,i){if(!_.isEmpty(t))for(var r=_.any(t,(function(t){return t instanceof e.data.dsr.DsrLimitsWarning})),o=0,n=t;o<n.length;o++){var a=n[o];a.columnNameFromIndex=function(e){var t=i.selects;return t.length<=e?null:t[e].displayName};var l=a.getDetails(e.common.localize);a instanceof e.data.dsr.DsrLimitsWarning?this.scope.ctrlError.showInfoIcon(l,a.code):a instanceof s&&a.isTransformMessage()?this.scope.ctrlError.showTransformWarningIcon(l,a.code,r):this.scope.ctrlError.showWarningIcon(l,a.code)}},i.prototype.getNextDataSegment=function(){var e=this.scope.viewModel,t=e.contract,i=e.readOnlyState.visual&&e.readOnlyState.visual.viewport;return this.queryHandler.getNextDataSegment({contract:t,viewport:i,useVisualContainerCache:e.shouldUseCache()})},i.prototype.loadMoreData=function(){var e=this.scope.viewModel,t=e.contract,i=e.readOnlyState.visual&&e.readOnlyState.visual.viewport,r=e.readOnlyState.visual.data;this.queryHandler.loadMoreData({contract:t,currentData:r,useVisualContainerCache:e.shouldUseCache(),viewport:i})},i.prototype.persistProperties=function(e){var t=this,i=this.scope.viewModel,r=i.contract.config.singleVisual;this.services.undoRedo.register("VisualContainerPersistProperties",(function(){var i=_.isArray(e)?{replace:e}:e;return!!t.services.visualAuthoring.persistProperties(i,r)&&(t.applyUpdate(void 0,!0),t.updateVisualContainerProperties(),!0)}))},i.prototype.onCustomSort=function(e){var t=e[0],i=this.scope.menuOptions.sortSetting.sortableFields.filter((function(e){return _.any(e.exprs,(function(e){return e.name===t.queryName}))}));if(i&&1===i.length){var r=i[0],o=t.sortDirection;r.active?this.visualSort.toggleSort():this.visualSort.toggleSort(r,o),this.services.overlayService.hideAllDropdowns()}},i.prototype.tryDeleteEmptyContainer=function(){var t=this.scope.viewModel.contract.config;if(t&&t.singleVisual&&h.isQueryVisual(t.singleVisual.visualType,this.services.visualPlugin)&&t.singleVisual.query&&0===t.singleVisual.query.defn.select().length){var i=this.services.visualPlugin.capabilities(t.singleVisual.visualType);if(i){var r=e.ScriptResultUtil.extractScriptResultFromVisualConfig(i.dataViewMappings,t.singleVisual.objects);if(r&&!jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(r.source))return!1}return this.deleteVisualContainer(!0),!0}return!1},i.prototype.deleteVisualContainer=function(e){var t=this;e?this.deleteVisualContainerInternal():this.services.undoRedo.register("DeleteVisualContainer",(function(){return t.deleteVisualContainerInternal()}))},i.prototype.deleteVisualContainerInternal=function(){var e=this.scope.viewModel,t=this.services,i=t.eventBridge;i.publishBubbling(this.scope,l.deleteVisualContainer,e.contract)},i.prototype.updateDetailVisualVisibility=function(){var e=this.scope.viewModel.contract,t=2===e.popOutMode;t&&!this.services.drill.canSeeData(e)&&this.setPopOutMode(1)},i.prototype.setPopOutMode=function(e){0===e?this.services.popOut.clearPopOut():this.services.popOut.popOutVisualContainer(this.scope.viewModel.contract,e)},i.prototype.isHeaderVisible=function(){if(this.services.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeader()){var e=this.services.viewModeState.getConfig().displayOptions;return(!e.hideInFocusTileMenu||!this.scope.viewModel.isPoppedOut)&&!(e.hideTileMenu||this.scope.viewModel.options.hideHeader)}},i.prototype.canRemoveFromLayout=function(){return this.services.formFactor.getCurrentLayoutCapabilities().canRemoveVisualFromLayout()&&!this.isHeaderVisible()},i.prototype.removeVisualFromLayout=function(){this.services.eventBridge.publishBubbling(this.scope,l.removeVisualContainerFromLayout,this.scope.viewModel.contract)},i.prototype.isPopOutBarVisible=function(){return this.scope.viewModel.isPoppedOut&&!this.scope.viewModel.options.hideHeader&&!this.services.viewModeState.getConfig().displayOptions.hideInFocusBar},i.prototype.isEditable=function(){return 1===this.services.viewModeState.getMode()},i.prototype.canExport=function(){var e=!1,t=!1,i=!!this.services.viewModeState.getConfig().supportsExportData,r=this.scope.viewModel;if(null!=r){t=r.showWatermark;var o=r.contract&&r.contract.config,n=o&&o.singleVisual&&o.singleVisual.visualType;jsCommon.StringExtensions.isNullOrUndefinedOrWhiteSpaceString(n)||(e=h.isQueryVisual(n,this.services.visualPlugin))}return i&&e&&!t},i.prototype.canSearch=function(){var e=this,t=this.scope.viewModel;if(t){var i=h.getVisualType(t.contract);if(h.supportVisualSearch(i,this.services.visualPlugin)){var r=this.services.dataSources.get();if(r)return this.services.conceptualSchemaProxy.get(r).then((function(i){return h.containSearchableField(t.contract,e.services.visualPlugin,i)?e.services.promiseFactory.resolve():e.services.promiseFactory.reject()}))}}return this.services.promiseFactory.reject()},i})();i.VisualContainerController=g;var f=(function(e){function t(){e.call(this,"VisualDataProxyExecutionUnknownError")}return __extends(t,e),t})(e.UnknownClientError),m=(function(){function e(e,t){this.visualContainerId=e,this.action=t}return e.prototype.equals=function(e){return!!e&&this.action===e.action&&this.visualContainerId===e.visualContainerId},e})()})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=e.visuals.plugins,n=t.services.selectionUtils,a=t.util.VisualContainerUtils,s=(function(){function e(e,i){var o=this;this.scope=e,this.services=i,this.scope.viewModeState=i.viewModeState,this.scope.setActiveSection=function(e){return o.setActiveSection(e)},this.scope.setActivePagePaneSection=function(e){return o.setActivePagePaneSection(e)},this.scope.toggle=function(){return o.toggle()},this.scope.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1},this.updateAll();var n=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){o.updateSections(),o.updateHeader(),o.updatePagePaneSections()}));this.scope.$watchGroup(["viewModeState.getMode()","viewModeState.getConfig().alwaysPopulatePanes"],(function(){return o.updateAll()})),this.scope.$on(t.constants.explorationLoadedEventName,(function(){return o.updateAll()})),this.scope.$on("$destroy",(function(){return n.unsubscribeAll()}))}return e.createOptions=function(){return{additionalServices:["featureSwitchService","localizationService"],scopedDependencies:["eventBridge","selection","viewModeState","visualPlugin"]}},e.prototype.setActiveSection=function(e){this.scope.viewModel.activeSection=e,this.updateShowHideElements()},e.prototype.setActivePagePaneSection=function(e){this.scope.viewModel.activePageSection=e,this.updateShowHideElements()},e.prototype.updateAll=function(){this.scope.isEditing=1===this.scope.viewModeState.getMode()||2===this.scope.viewModeState.getMode(),this.scope.populatePanes=this.scope.isEditing||this.scope.viewModeState.getConfig().alwaysPopulatePanes,this.scope.showVisualTypes=this.scope.populatePanes,this.scope.viewModel&&(this.updateShowHideElements(),this.updateSections(),this.updatePagePaneSections(),this.updateHeader())},e.prototype.updateShowHideElements=function(){var e=this.scope.viewModel.activeSection,t=this.scope.viewModel.activePageSection,i=this.scope.populatePanes,r=this.getSelectedVisual();r?this.scope.showVisualTypes=i&&a.canConvertVisual(r,this.services.visualPlugin):this.scope.showVisualTypes=i,this.scope.showFieldWellOrFilters=!e&&!t||0===e||0===t,this.scope.showFieldWell=i&&(0===e||0===t),this.scope.showPropertyPane=i&&1===e,this.scope.showPagePropertyPane=i&&1===t&&!this.scope.isNonQueryVisual,this.scope.showAnalyticsPane=i&&2===e},e.prototype.updateSections=function(){var e=this.getSelectedVisual(),t=this.scope.viewModel,i=a.getVisualType(e),r=a.isSupportedVisual(e,this.services.visualPlugin),o=i&&a.isQueryVisual(i,this.services.visualPlugin);if(this.scope.isNonQueryVisual=void 0!==e&&!o,!e||!r)return this.setActiveSection(void 0),void(t.sections=[]);if(this.scope.isNonQueryVisual)this.setActiveSection(1);else{var n=t.activeSection;void 0===n&&this.setActiveSection(0),t.sections=[{sectionType:0,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"}]}a.canFormatVisual(e)&&t.sections.push({sectionType:1,displayName:this.services.localizationService.get("VisualizationPane_Section_Format"),cssClass:"format"}),t.sections.push({sectionType:2,displayName:this.services.localizationService.get("VisualizationPane_Section_Analytics"),cssClass:"analytics"})},e.prototype.updatePagePaneSections=function(){var e=this.getSelectedVisual(),t=this.scope.viewModel;if(e)return this.setActivePagePaneSection(void 0),void(t.pagePaneSections=[]);var i=t.activePageSection;void 0===i&&this.setActivePagePaneSection(0),t.pagePaneSections=[{sectionType:0,displayName:this.services.localizationService.get("VisualizationPane_Section_Fields"),cssClass:"fields"}],t.pagePaneSections.push({sectionType:1,displayName:this.services.localizationService.get("VisualizationPane_Section_Format"),cssClass:"format"})},e.prototype.updateHeader=function(){var e;if(this.scope.populatePanes){var t=this.getSelectedVisual();if(t){var i=t.config.singleVisual.visualType;i===o.basicShape.name?e="VisualizationPane_Shape":i===o.image.name&&(e="VisualizationPane_Image")}e=e||"VisualizationPane_Title"}else e="VisualizationPane_Filters";this.scope.viewModel.header=this.services.localizationService.get(e)},e.prototype.toggle=function(){this.scope.viewModel.isPaneExpanded=!this.scope.viewModel.isPaneExpanded},e.prototype.getSelectedVisual=function(){return n.getDefaultSelectedVisualInSingleOrMultiCase(this.services.selection)},e})();i.VisualizationPaneController=s})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=t.services.selectionUtils,n=e.explore.util.VisualContainerUtils,a=(function(){function i(e,t){var i=this;this.services=t,this.scope=e,this.loadVisualTypes(),this.loadMenuItems(),this.scope.visualAction=function(e){return i.visualAction(e)},this.scope.visualStyle=function(e){return i.visualStyle(e)},this.scope.importVisual=function(){return i.importVisual()},this.scope.eventBridge=this.services.eventBridge,this.scope.selectMenuItem=function(e,t){return i.selectMenuItem(e,t)},this.scope.enableDeleteCustomVisual=this.services.featureSwitchService.featureSwitches.deleteCustomVisualEnabled;var o=this.services.eventBridge.createChannelSubscriptionManager().subscribe(r.selectionChanged,(function(){return i.update()})).subscribe(r.visualContainerChanged,(function(){return i.update()})).subscribe(r.visualPluginsChanged,(function(){i.loadVisualTypes(),i.update()}));this.scope.$on("$destroy",(function(){return o.unsubscribeAll()})),this.update()}return i.createOptions=function(){return{additionalServices:["featureSwitchService","localizationService","modalDialogService","errorService","esriExploration"],scopedDependencies:["eventBridge","selection","visualPlugin"]}},i.prototype.selectMenuItem=function(t,i){if(t)switch(t.action){case 0:if(i){var r={visual:i.plugin};this.services.eventBridge.publishBubbling(this.scope,e.explore.services.events.deleteVisual,r)}else this.services.eventBridge.publishBubbling(this.scope,e.explore.services.events.deleteCustomVisuals);break;case 1:this.services.eventBridge.publishToChannel(e.explore.services.events.importVisual)}},i.prototype.importVisual=function(){this.services.eventBridge.publishToChannel(r.importVisual)},i.prototype.loadVisualTypes=function(){var e=this.services.visualPlugin.getConvertibleVisuals(),i=this.scope.visualPluginFilter;i&&(e=_.filter(e,i));var r=t.viewModels.ViewModelFactory.getAvailableVisualTypes(e,this.scope.esriVisualEnabled,this.scope.esriVisualDisallowed);this.scope.viewModel=t.viewModels.ViewModelFactory.createVisualTypesContainer(r)},i.prototype.loadMenuItems=function(){this.scope.customVisualMenuItems=[],this.scope.customVisualMenuItems.push(this.createCustomVisualMenuItem(this.services.localizationService.get("ImportVisuals_ContextMenu"),1)),this.scope.customVisualMenuItems.push(this.createCustomVisualMenuItem(this.services.localizationService.get("DeleteVisuals_ContextMenu"),0))},i.prototype.createCustomVisualMenuItem=function(e,t){return{text:e,hasGlyph:!1,labelClass:"itemLabel",action:t,type:DropDownMenuItemType.Item,checked:!1,hrefTarget:jsCommon.DOMConstants.selfValue}},i.prototype.update=function(){for(var e=this.scope.viewModel.visuals,t=this.getSelectedVisual(),i=0,r=e;i<r.length;i++){var o=r[i];o.enabled=this.isVisualTypeEnabled(o.plugin,t),o.active=this.isVisualTypeActive(o.plugin,t)}},i.prototype.isVisualTypeEnabled=function(e,t){return!t||n.getVisualType(t)!==e.name&&n.isQueryVisual(n.getVisualType(t),this.services.visualPlugin)},i.prototype.isVisualTypeActive=function(e,t){return t&&n.getVisualType(t)===e.name},i.prototype.showThirdPartyVisualConsentDialog=function(t){var i=this;switch(t.plugin.name){case e.visualHost.EsriVisual:this.services.esriExploration.showEsriConsentDialog(this.scope).then((function(e){e&&(t.requiresConsent=!1,i.visualAction(t))}))}},i.prototype.visualAction=function(e){var t=this.getSelectedVisual(),i=e.plugin;return e.requiresConsent?void this.showThirdPartyVisualConsentDialog(e):void(t?this.isVisualTypeEnabled(i,t)&&this.services.eventBridge.publishBubbling(this.scope,r.visualConversion,{visualContainer:t,newVisualType:i.name}):this.services.eventBridge.publishToChannel(r.addVisualContainer,{visualType:i.name,telemetrySource:2}))},i.prototype.getSelectedVisual=function(){return o.getSelectedVisual(this.services.selection)},i.prototype.visualStyle=function(e){return e.plugin.custom&&e.plugin.iconUrl?{"background-image":e.plugin.iconUrl}:null},i})();i.VisualTypesContainerController=a})(i=t.controllers||(t.controllers={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.Services.createController(t.controllers.ImportVisualErrorDialogController),this.templateUrl="views/importVisualErrorDialog.html"}return i})();i.ImportVisualErrorDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.Services.createController(t.controllers.ImportVisualWarningDialogController),this.templateUrl="views/importVisualWarningDialog.html"}return i})();i.ImportVisualWarningDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.scope={items:"=",selectedValue:"=",onSelect:"="},this.templateUrl="views/inputFields/selectionBox.html",this.link=function(e,t){function i(i){e.selectedItem=i,e.selectedValue=i.value,e.showDropdown=!1,t.focus(),e.onSelect(e.selectedValue)}function r(){if(e.selectedItem=null,e.items)for(var t=e.selectedValue,i=0,r=e.items;i<r.length;i++){var o=r[i];if(o.value===t){e.selectedItem=o;break}}}e.showDropdown=!1,e.hasHideableItems=_.any(e.items,(function(e){return void 0!==e.isHidden})),e.itemSelected=function(e){return i(e)},r();var o=e.$watch("selectedValue",(function(e,t){r()})),n=e.$on("$destroy",(function(){o(),n()}))}}return e})();e.SelectionBox=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.require=["imageUpload","ngModel"],this.restrict="E",this.controller=e.common.Services.createController(t.controllers.ImageUploadController),this.replace=!0,this.templateUrl="views/inputFields/imageUpload.html",this.link=function(e,t,i,r){var o=t.find(".file-input"),n=r[0],a=r[1];n.setNgModelController(a),o.change((function(t){var i=o[0].files[0];e.uploadImage(i)})),e.hasImage=function(){var e=a.$viewValue;return!!e&&!_.isEmpty(e.name)},e.upload=function(){o.click()},e.removeImage=function(){o.val(""),a.$setViewValue(void 0)},e.onSelectScaling=function(){var t=a.$viewValue;t&&a.$setViewValue(e.image)},a.$render=function(){var t=a.$viewValue;t?e.image={url:t.url,name:t.name,scaling:t.scaling}:o.val("")}}}return i})();i.ImageUpload=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(t){var i=this;this.require="ngModel",this.restrict="E",this.scope={options:"<",inputName:"<"},this.templateUrl="views/inputFields/slider.html",
this.link=function(t,r,o,n){n.$render=function(){t.rangeValue=e.getRangeValue(t.options.minValue,t.options.maxValue,n.$viewValue),t.textValue=Number(n.$viewValue)},t.onTextValueChanged=function(){void 0!==t.textValue&&(t.rangeValue=e.getRangeValue(t.options.minValue,t.options.maxValue,t.textValue),n.$setViewValue(t.textValue.toString()))},t.onRangeValueChanged=function(){t.textValue=e.getTextValue(t.options.minValue,t.options.maxValue,t.rangeValue),n.$setViewValue(t.textValue.toString())},t.inputInvalid=function(){return isNaN(t.textValue)||t.textValue>t.options.maxValue||t.textValue<t.options.minValue},t.unitSymbol=i.localizationService.get(t.options.unitSymbol),t.integerPattern=/^\d+$/},this.localizationService=t}return e.getRangeValue=function(e,t,i){return(i-e)/(t-e)*100},e.getTextValue=function(e,t,i){return Math.round(e+i/100*(t-e))},e})();e.Slider=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e){var t=this;this.require="ngModel",this.restrict="E",this.scope={validators:"=",placeholder:"<",inputType:"@"},this.templateUrl="views/inputFields/propertyPaneTextBox.html",this.link=function(e,i,r,o){o.$render=function(){e.sliceValue=o.$viewValue},e.onKeydown=function(e){e.which===$.ui.keyCode.DELETE&&e.stopPropagation()},e.onChange=function(){e.inputForm&&!e.inputForm.$invalid&&o.$setViewValue(e.sliceValue)},e.getErrorMessage=function(){var i,r=e.inputForm.$error;return r&&(r.decimal?i=t.localizationService.get("Validation_NotANumber"):r.min?i=t.localizationService.get("Validation_NumberBelowMin"):r.max?i=t.localizationService.get("Validation_NumberAboveMax"):r.integer?i=t.localizationService.get("Validation_NumberNotInteger"):r.required&&(i=t.localizationService.get("Validation_Empty"))),{tooltipDescription:i,tooltipDisable:_.isEmpty(r)}}},this.localizationService=e}return e})();e.PropertyPaneTextBox=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.AdvancedFilterController),this.templateUrl="views/advancedFilter.html"}return i})();i.AdvancedFilter=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.controllers.CanvasLayoutController,o=(function(){function t(){this.restrict="A",this.controller=e.common.Services.createController(r),this.link=function(e,t,i,r){function o(){var t=e.layoutStrategy;r.setStrategy(t)}function n(){var t=e.canvasLayoutSize;r.setCanvasSize(t)}o(),e.$watch("layoutStrategy",o),e.$watch("canvasLayoutSize",n)}}return t})();i.CanvasLayout=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(i,r,o){var n=function(e,t){return r.dragStart(o,e,t)},a=function(e,t){return r.dragEnd(o,e,t)},s=function(e,t,i){return r.nudge(o,e,t,i)},l=function(e,t){return r.resizeStart(o,e,t)},c=function(e,t){return r.resizeMove(o,e,t)},u=function(e,t){return r.resizeEnd(o,e,t)};return e.common.createScopeEventSubscriptionManager(i).subscribe(t.constants.TransformElementDragEndEventName,a).subscribe(t.constants.TransformElementDragStartEventName,n).subscribe(t.constants.TransformElementNudgeEventName,s).subscribe(t.constants.TransformElementResizeStartEventName,l).subscribe(t.constants.TransformElementResizeMoveEventName,c).subscribe(t.constants.TransformElementResizeEndEventName,u)}var o=(function(){function e(){this.restrict="A",this.require="^canvasLayout",this.link=function(e,t,i,o){var n=e.canvasLayoutItemOptions;o.registerLayoutItem(n),e.getIntermediateDimensions=function(e){return o.getIntermediateDimensions(n,e)};var a=r(e,o,n);e.$on("$destroy",(function(){o.unregisterLayoutItem(n),a.unsubscribeAll()}))}}return e})();i.CanvasLayoutItem=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="A",this.scope=!1,this.controller=e.common.Services.createController(t.controllers.CanvasVisualErrorController),this.controllerAs="ctrlError",this.bindToController=!0}return i})();i.CanvasVisualError=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.replace=!0,this.restrict="E",this.scope={},this.controller=e.common.Services.createController(t.controllers.CanvasVisualHeaderIconController),this.controllerAs="$ctrl",this.bindToController={details:"=",iconType:"="},this.templateUrl="views/canvasVisualHeaderIcon.html"}return i})();i.CanvasVisualHeaderIcon=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){var r=this;this.restrict="E",this.templateUrl="views/carousel.html",this.transclude=!0,this.replace=!0,this.scope={autoResize:"="},this.link=function(o,n){o.element=n,o.scrollPane=n.find(".carouselScrollPane"),o.previousNavButton=n.find(".carouselNavButton.previousPage"),o.nextNavButton=n.find(".carouselNavButton.nextPage");var a=o.previousNavButton,s=o.nextNavButton,l=o.scrollPane,c=250,u=!1,d=function(){return l.children()},p=function(){a.prop("disabled",!1),s.prop("disabled",!1),0===l.scrollLeft()&&a.prop("disabled",!0);var e=2;Math.abs(l.scrollLeft()+l.width()-l[0].scrollWidth)<=e&&s.prop("disabled",!0)},v=function(e){if(e&&e.length>0){u=!0;var t=d(),i=e.position().left-r.getLeftmostScrollChildOffset(t);l.animate({scrollLeft:i},c,(function(){p(),u=!1}))}},h=function(){if(!u){var e=l.find(".selected");v(e)}};if(o.scrollToLast=function(){var e=d(),t=$(e[e.length-1]);v(t)},o.updateCarouselWidth=function(){window.setTimeout((function(){for(var e=o.element.parent().width(),t=d(),r=0,n=0,a=t.length;n<a;n++)r+=$(t[n]).outerWidth(!0);var s=r+i.navButtonsWidth;e>i.createButtonWidth&&(s=Math.min(e-i.createButtonWidth,s)),o.element.width(s),p()}),0)},o.scrollToNext=function(){for(var e,t=d(),i=l.scrollLeft()+l.width()+r.getLeftmostScrollChildOffset(t),o=0;o<t.length;o++)if(e=$(t[o]),e.position().left+e.width()>i){v(e);break}},o.scrollToPrevious=function(){for(var e,t=d(),i=l.scrollLeft()-l.width()+r.getLeftmostScrollChildOffset(t),o=0;o<t.length;o++)if(e=$(t[o]),e.position().left>=i){v(e);break}},o.autoResize)if(e.common.createScopeEventSubscriptionManager(o).subscribe(t.constants.renameSectionEvent,(function(){window.setTimeout((function(){o.updateCarouselWidth()}),0)})),10===jsCommon.BrowserUtils.getInternetExplorerVersion())o.$watch((function(){return d().length}),(function(e,t){e-1===t?o.scrollToLast():0===t&&h(),o.updateCarouselWidth()}));else{var g=0,f=new MutationObserver(function(e){e.forEach((function(e){if(e.addedNodes.length>0||e.removedNodes.length>0){o.updateCarouselWidth();var t=d().length;g===t-1?o.scrollToLast():0===g&&h(),g=t}}))}),m={childList:!0,characterData:!0,attributes:!0};f.observe(o.scrollPane[0],m)}var y=0;o.carouselResized=function(){if(o.autoResize){var e=n.parent().width();e!==y&&(y=e,o.updateCarouselWidth(),h())}},o.$on(t.constants.explorationLoadedEventName,(function(){o.enableResize()})),o.$on(t.constants.explorationClearedEventName,(function(){o.suspendResize()}))}}return i.prototype.getLeftmostScrollChildOffset=function(e){return e.length>0?e.eq(0).position().left:0},i.createButtonWidth=41,i.navButtonsWidth=35,i})();i.Carousel=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={},this.controller=e.common.Services.createController(t.controllers.CodePaneContainerController),this.templateUrl="views/codePaneContainer.html"}return i})();i.CodePaneContainer=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.Services.createController(t.controllers.DeleteCustomVisualsDialogController),this.templateUrl="views/deleteCustomVisualsDialog.html"}return i})();i.DeleteCustomVisualsDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.Services.createController(t.controllers.DeleteVisualWarningDialogController),this.templateUrl="views/deleteVisualWarningDialog.html"}return i})();i.DeleteVisualWarningDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.templateUrl="views/detailVisual.html",this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.DetailVisualController)}return i})();i.DetailVisual=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.Services.createController(t.controllers.EsriConsentDialogController),this.templateUrl="views/esriConsentDialog.html"}return i})();i.EsriConsentDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,i,r,s,l){var c={width:0,height:0};e.outerViewport=c;var u=null;e.canvasPinchStart=function(t){l&&l.hide({isTouchEvent:!0,immediately:!0}),1===t&&(e.suspendResize(),o.storeOverflowValuesAndChange(i,jsCommon.CssConstants.visibleValue))},e.canvasPinchEnd=function(t){1===t&&(o.restoreOverflowValues(i),e.enableResize&&e.enableResize())};var d=function(){var t=e.onResizeViewport.width,r=e.onResizeViewport.height;e.outerViewport={width:t,height:r},t===c.width&&r===c.height||(c.width=t,c.height=r,e.forceSyncSizeUpdates?o.applyFitOption(e,i,e.displayOptionServices):window.requestAnimationFrame((function(){o.applyFitOption(e,i,e.displayOptionServices)}))),e.$emit(n.domLayoutChangedEvent)},p=_.throttle(d,a);e.canvasResized=function(){return e.forceSyncSizeUpdates?d():void p()},e.$evalAsync((function(){e.enableResize()})),e.disableAnimations=!0,e.$watch("useResponsiveLayout",(function(){i.scrollTop(0)})),e.$watch("hasFocus",(function(t){t===!0&&(i.focus(),e.hasFocus=!1)})),e.$watch("viewModel.contract.size",(function(t){t&&(o.updateCanvasSize(e,t.width,t.height),o.applyFitOption(e,i,e.displayOptionServices))}));var v=null;e.$on(t.constants.explorationLoadedEventName,(function(){s&&s.startPerfEventDeprecated&&(u=s.startPerfEventDeprecated(e,null),v&&v(),v=e.$watchCollection("viewModel.visualContainers",(function(e){e&&(0===e.length&&u&&(u.resolve(),u=null),v(),v=null)})))})),e.$on("visualContainerRepeatFinished",(function(){u&&(u.resolve(),u=null),document.activeElement||i.focus(),e.$emit(n.domLayoutChangedEvent)})),e.applyFitOption=function(){o.applyFitOption(e,i,e.displayOptionServices),e.$emit(n.domLayoutChangedEvent)},e.$on("$destroy",(function(){e.suspendResize()}))}var o=t.util.CanvasDisplayUtility,n=e.common.constants,a=300;i.linkCanvas=r;var s=(function(){function i(i,o,n){var a=this;this.telemetryService=i,this.overlayService=o,this.visualHostTooltip=n,this.restrict="E",this.replace=!0,this.scope={viewModel:"=",disablePrint:"=",canvasOptions:"=?"},this.controller=e.common.Services.createController(t.controllers.ExploreCanvasController),this.controllerAs="$ctrl",this.templateUrl="views/exploreCanvas.html",this.require="canvasLayout",this.link=function(e,t,i,o){e.layout=o,r(e,t,a.overlayService,a.telemetryService,a.visualHostTooltip)},this.telemetryService=i,this.overlayService=o,this.visualHostTooltip=n}return i})();i.ExploreCanvas=s})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={},this.controller=e.common.Services.createController(t.controllers.ExplorationAppBarController),this.controllerAs="$ctrl",this.bindToController={viewModel:"="},this.templateUrl="views/explorationAppBar.html"}return i})();i.ExplorationAppBar=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.ExplorationHostController),this.templateUrl="views/explorationHost.html"}return i})();i.ExplorationHost=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.directives.DragDropUtils,o="dragover",n="section",a=".pane.sections",s=".section.dynamic",l=(function(){function i(i){var a=this;this.restrict="E",this.replace=!0,this.scope={viewModel:"=",tabIndex:"=",isOnlyTab:"<",isEditing:"="},this.controller=e.common.Services.createController(t.controllers.ExplorationNavigationTabController),this.templateUrl="views/explorationNavigationTab.html",this.link=function(t,i,s){t.toggleDraggable=function(e){return i.draggable({disabled:!e})},t.supportsMinervaDialog=a.platformCapabilities.supportsMinervaDialog,i.droppable({accept:function(e){return"sections"===r.getDragSourceType(e)},activate:function(e,i){return t.dragoverIndex=-1},hoverClass:o,tolerance:"pointer",over:function(e,r){if(1===t.viewModeState.getMode()){var o=-1,s=a.getSections();o=i.hasClass(n)?s.index(i):Math.max(s.length-1,0),t.dragoverIndex=o,t.$apply()}},drop:function(i,r){if(1===t.viewModeState.getMode()){var o=r.draggable;if(o){var n=a.getSections(),s=n.index(o),l=t.dragoverIndex;s!==l&&s!==-1&&t.eventBridge.publishBubbling(t,e.explore.services.events.reorderSection,{originalIndex:s,targetIndex:l})}}}}),t.$on("$destroy",(function(){return i.droppable({disabled:!0}).droppable("destroy")}))},this.platformCapabilities=i}return i.prototype.getSections=function(){return $(a).find(s)},i})();i.ExplorationNavigationTab=l})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.ExplorationPaginatorController),this.templateUrl="views/explorationPaginator.html"}return i})();i.ExplorationPaginator=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.Services.createController(t.controllers.ExplorationStatusBarController),this.templateUrl="views/explorationStatusBar.html"}return i})();i.ExplorationStatusBar=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",disablePrint:"=",canvasOptions:"<"},this.controller=e.common.Services.createController(t.controllers.ExplorationController),this.templateUrl="views/exploration.html"}return i})();i.Exploration=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.common.directives.NgScrollbars,o=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={fieldListConfig:"<"},this.controller=e.common.Services.createController(t.controllers.FieldListController),this.templateUrl="views/fieldList.html",this.link=function(e,t,i){t.click((function(){e.$evalAsync((function(){return e.unselect()}))})),e.$on("$destroy",(function(){return t.unbind("click")})),e.scrollToItem=function(e,i){var o=t.find(".fieldListEntityContainer").filter((function(t,i){return $(i).find(".fieldListEntity").text().trim()===e})),n=o.find(".fieldListProperty").filter((function(e,t){return $(t).text().trim()===i})),a=t.find(".scroll-wrapper .scroll-content");r.scrollVertical(a[0],n[0]||o[0])}}}return i})();i.FieldList=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={viewModel:"=",searchString:"="},this.controller=e.common.Services.createController(t.controllers.FieldListEntityController),this.templateUrl="views/fieldListEntity.html",this.link=function(e,t,i){e.toggleDraggable=function(e){t.attr("draggable",e.toString())}}}return i})();i.FieldListEntity=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={},this.controller=e.common.Services.createController(t.controllers.FieldListPropertyController),this.controllerAs="ctrl",this.bindToController={viewModel:"=",searchString:"="},this.templateUrl="views/fieldListProperty.html",this.link=function(e,t,i,r){e.toggleDraggable=function(e){r.viewModel.draggable&&t.draggable({disabled:!e})}}}return i})();i.FieldListProperty=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={},this.controller=e.common.Services.createController(t.controllers.FieldWellController),this.templateUrl="views/fieldWell.html"}return i})();i.FieldWell=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.FieldWellBucketController),this.templateUrl="views/fieldWellBucket.html",this.link=function(e,t,i){e.tooltipConfigManager={getTooltipConfig:function(){return{tooltipDescription:e.viewModel.description||e.viewModel.displayName}}}}}return i})();i.FieldWellBucket=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.FieldWellFieldController),this.controllerAs="ctrl",this.bindToController=!0,this.templateUrl="views/fieldWellField.html"}return i})();i.FieldWellField=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.FilterController),this.templateUrl="views/filter.html"}return i})();i.Filter=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={},this.controller=e.common.Services.createController(t.controllers.FilterPaneController),this.templateUrl="views/filterPane.html"}return i})();i.FilterPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.bindtoController={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.FilterVisualController),this.controllerAs="$ctrl",this.templateUrl="views/filterVisual.html"}return i})();i.FilterVisual=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=e.explore.services.events,o=(function(){function i(){this.restrict="A",this.controller=e.common.Services.createController(t.controllers.ModelingContextChangerController),this.link=function(e,t,i){var o=e.eventBridge.createChannelSubscriptionManager().subscribe(r.schemaItemActivationChanged,(function(){e.schemaItemActivationService.getActiveItem()?t.on("click",(function(){e.eventBridge.publishToChannel(r.modelingContextChanged)})):t.off("click")}));e.$on("$destroy",(function(){return o.unsubscribeAll()}))}}return i})();i.ModelingContextChanger=o})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="A",this.require="ngModel",this.scope={pbiValidate:"="},this.link=function(t,i,r,o){t.pbiValidate&&(o.$validators.required=function(e,i){return null==i||!t.pbiValidate.required||""!==i},o.$validators.min=function(i,r){return e.isLargerOrEqual(r,t.pbiValidate.min)},o.$validators.max=function(i,r){return e.isLargerOrEqual(t.pbiValidate.max,r)},o.$validators.decimal=function(e,i){return null==i||!t.pbiValidate.decimal||_.isFinite(Number(i))},o.$validators.integer=function(e,i){if(null==i||!t.pbiValidate.integer)return!0;var r=Number(i);return _.isFinite(r)&&Math.floor(r)===r})}}return e.isLargerOrEqual=function(e,t){if(null==e||null==t||""===e||""===t)return!0;var i=Number(e),r=Number(t);return!_.isFinite(i)||!_.isFinite(r)||i>=r},e})();e.PbiValidate=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.controller=e.common.Services.createController(t.controllers.EmbedModalDialogController),this.templateUrl="views/embedModalDialog.html"}return i})();i.EmbedModalDialog=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"=",fieldListConfig:"<"},this.controller=e.common.Services.createController(t.controllers.TaskPaneController),this.templateUrl="views/taskPane.html"}return i})();i.TaskPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.VisualContainerController),this.templateUrl="views/visualContainer.html"}return i})();i.VisualContainer=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.templateUrl="views/visualContainerContextMenu.html",this.scope={},this.controller=e.common.Services.createController(t.controllers.VisualContainerContextMenuController),this.controllerAs="$ctrl",this.bindToController={menuId:"=",visualContainer:"=",selectors:"="}}return i})();i.VisualContainerContextMenu=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.templateUrl="views/visualContainerPopOutBar.html"}return e})();e.VisualContainerPopOutBar=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={viewModel:"="},this.controller=e.common.Services.createController(t.controllers.VisualizationPaneController),this.templateUrl="views/visualizationPane.html"}return i})();i.VisualizationPane=r})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=24,o=6,n=1,a=(function(){function i(){this.restrict="E",this.replace=!0,this.scope={visualPluginFilter:"=",esriVisualEnabled:"=",esriVisualDisallowed:"="},this.link=function(e,i,a){function s(e,t){var i=Math.ceil((e.viewModel.visuals.length+n)/o)*r;t.height(i)}s(e,i),e.eventBridge.createChannelSubscriptionManager().subscribe(t.services.events.visualPluginsChanged,(function(t,r){return s(e,i)}))},this.controller=e.common.Services.createController(t.controllers.VisualTypesContainerController),this.templateUrl="views/visualTypesContainer.html"}return i})();i.VisualTypesContainer=a})(i=t.directives||(t.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(t,i){var r=this;this.restrict="E",this.replace=!0,this.template='<div class="watermark"></div>',this.scope={visualType:"="},this.link=function(t,i){function o(e,t,i,r){var o=e.indexOf('id="'+t),n=t.length+6,a=e.substring(o+n,e.indexOf(i)),s=a.indexOf(r),l=a.substring(0,s);return l}function n(t,i,r){t=o(t,i,"</svg>","</symbol>");var n=$(e.svgTemplate+t+"</svg>");n.appendTo(r)}function a(t,i,r,o){var a=o.getPlugin(i),s=a&&a.watermarkKey||e.defaultWatermark;r.attr(e.dataAttribute,s),n(t,s,r)}var s="views/svg/visualsWatermarks.svg",l=r.visualPlugin,c=r.templateCache.get(s),u=t.visualType;a(c,u,i,l),t.$watch("visualType",(function(e,t){e!==t&&(i.empty(),a(c,e,i,l))}))},this.templateCache=t,this.visualPlugin=i}return e.svgTemplate='<svg id="Layer_1" x="0px" y="0px" viewBox="0 0 400 300" enable-background="new 0 0 400 300" xml:space="preserve">',e.dataAttribute="data-svg-visual-key",e.defaultWatermark="defaultWatermark",e})();e.VisualWatermark=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(){this.restrict="E",this.replace=!0,this.transclude=!0,this.scope={initLimit:"=",totalItemsAmount:"="},this.templateUrl="views/virtualList.html",this.link=function(e,t){var i=0,r=10;e.limitItems=+e.initLimit,e.scrollbarsConfig={ignoreOverlay:!1,ignoreMobile:!1};var o=t.find(".virtual-list"),n=2*t.height();o.scroll((function(){var a=o.scrollTop();n||(n=2*t.height()),a+n>o.height()&&e.totalItemsAmount>=e.limitItems&&a>i&&(i=a,e.limitItems+=r,e.$digest())}))}}return e})();e.VirtualList=t})(t=e.directives||(e.directives={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t){var i="";switch(e){case 0:i=t.get("ReportAppBar_ViewDynamic");break;case 1:i=t.get("ReportAppBar_ViewFitToPage");break;case 2:i=t.get("ReportAppBar_ViewFitToWidth");break;case 3:i=t.get("ReportAppBar_ViewActualSize")}return i}e.convert=t})(t=e.DisplayOptionFilter||(e.DisplayOptionFilter={}))})(t=e.filters||(e.filters={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t=(function(){function e(e,t){this._contract=e,this._state=t}return Object.defineProperty(e.prototype,"contract",{get:function(){return this._contract},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readOnlyState",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.updateViewState=function(){this.updateViewStateCore(this._state)},e.prototype.updateViewStateCore=function(e){},e})();e.ViewModel=t})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.spinnerAction={name:"spinnerAction"}})(t=e.DetailVisualEvents||(e.DetailVisualEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=e.explore.constants.ExploreCanvasConstants;t.FixedPhoneCanvasSettings={phoneWidth:i.PhoneAuthoringViewportWidth,phoneHeight:i.PhonePortraitCanvasHeight,phoneGridLayout:{columnCount:6,rowCount:i.PhonePortraitRowCount,layout:{horizontal:{margin:9.5,gutter:9,size:44},vertical:{margin:9.5,gutter:9,size:50}}}};var r=(function(){function e(e,t){void 0===t&&(t=0),this.selectedVisualOriginalPosition=-1,this.contract=e,this.canvasLayout=t}return Object.defineProperty(e.prototype,"width",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.width:t.FixedPhoneCanvasSettings.phoneWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return 0===this.canvasLayout?this.contract.size&&this.contract.size.height:t.FixedPhoneCanvasSettings.phoneHeight},enumerable:!0,configurable:!0}),e})();t.ExploreCanvas=r})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){function i(){return r.createNavigationMenuItems()}t.createNavigationMenuItems=i;var r;!(function(t){function i(){return[r("Duplicate_page",0),r("Rename_page",1),r("Delete_page",2)]}function r(t,i){return{text:e.common.localize.get(t),labelClass:"itemLabel",action:i,type:DropDownMenuItemType.Item,hrefTarget:jsCommon.DOMConstants.selfValue}}t.createNavigationMenuItems=i})(r||(r={}))})(i=t.ExplorationContainerViewModelFactory||(t.ExplorationContainerViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e){var t={checked:e.checked,text:e.text,type:e.type,disabled:e.disabled,key:e.key};return t}function i(e){if(_.isEmpty(e))return e;for(var i=e.items,r={items:[]},o=r.items,n=0,a=i;n<a.length;n++){var s=a[n];o.push(t(s))}return r}var r=jsCommon.EnumExtensions,o=(function(){function e(e){this.contract=e,this.showCheckboxes=!0}return e.prototype.findEntity=function(e){return _.find(this.entities,(function(t){return t.name===e}))},e.prototype.findFields=function(e,t){var i=this.findEntity(e);if(i)return i.findFields(t)},e.prototype.findHierarchies=function(e,t){var i=this.findEntity(e);if(i)return i.findHierarchies(t)},e.prototype.findKpis=function(e,t){var i=this.findEntity(e);if(i)return i.findKpis(t)},e.prototype.findKpiMeasures=function(e,t){var i=this.findEntity(e);if(i)return i.findKpiMeasures(t)},e})();e.FieldListConceptualModel=o;var n=(function(){function e(e,t,i){this.hasCheckedProperties=!1,this.contract=e,this.schemaName=t,this.schema=i}return Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"calculated",{get:function(){return this.contract.calculated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iconClassName",{get:function(){return 1===this.contract.queryable?"error":this.calculated?"calculatedTable":this.isMeasureGroup?"measureGroup":void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return r.hasFlag(this.contract.visibility,1);
},set:function(e){e?this.contract.visibility=r.setFlag(this.contract.visibility,1):this.contract.visibility=r.resetFlag(this.contract.visibility,1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"private",{get:function(){return r.hasFlag(this.contract.visibility,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showAsVariationsOnly",{get:function(){return r.hasFlag(this.contract.visibility,2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showHidden",{get:function(){return!!this.schema&&this.schema.showHidden},enumerable:!0,configurable:!0}),e.prototype.findFields=function(e){return this.findFieldsByType(e,0)},e.prototype.findKpis=function(e){return this.findFieldsByType(e,4)},e.prototype.findKpiMeasures=function(e){return this.findFieldsByType(e,5)},e.prototype.findHierarchies=function(e){return this.findFieldsByType(e,2)},e.prototype.findFieldsByType=function(e,t){var i;if(i=2===t?_.filter(this.hierarchies,(function(t){return t.name===e})):_.filter(this.properties,(function(i){return i.name===e&&i.fieldType===t})),!_.isEmpty(i))return i},Object.defineProperty(e.prototype,"userEntity",{get:function(){return this.schema.showNonUserEntities||!(this.private||this.showAsVariationsOnly)},enumerable:!0,configurable:!0}),e})();e.FieldListConceptualEntity=n;var a=(function(){function e(e,t){this.hasCheckedChildren=!1,this.contract=e,this.entity=t}return Object.defineProperty(e.prototype,"showHidden",{get:function(){return this.entity&&this.entity.showHidden},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.contract.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this.contract.displayName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return!this.parent||this.parent.expanded&&this.parent.visible},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.contract.hidden},set:function(e){this.contract.hidden=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this.contract,this.entity);return t.menuItems=i(this.menuItems),t.template=this.template,t},e})();e.FieldListConceptualItem=a;var s=(function(e){function t(t,i){e.call(this,t,i),this.draggable=!0,this.fieldType=0}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultAggregate",{get:function(){return this.contract.column?this.contract.column.defaultAggregate:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.contract.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idOnEntityKey",{get:function(){return!!this.contract.column&&this.contract.column.idOnEntityKey},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t(this.contract,this.entity);return e.menuItems=i(this.menuItems),e.template=this.template,e},t})(a);e.FieldListConceptualProperty=s;var l=(function(e){function t(t,i,r){e.call(this,t.column,r),this.hierarchyLevelContract=t,this.parent=i,this.fieldType=3}return __extends(t,e),Object.defineProperty(t.prototype,"hidden",{get:function(){return this.parent.hidden},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.hierarchyLevelContract.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this.hierarchyLevelContract.displayName},enumerable:!0,configurable:!0}),t.prototype.clone=function(e){var r=e||this.parent,o=new t(this.hierarchyLevelContract,r,this.entity);return o.menuItems=i(this.menuItems),o.template=this.template,o},t})(s);e.FieldListConceptualHierarchyLevel=l;var c=(function(e){function t(t,i){e.call(this,t,i),this.expanded=!1,this.hierarchyLevels=[],this.draggable=!0,this.fieldType=2}return __extends(t,e),Object.defineProperty(t.prototype,"properties",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.hierarchyLevels},enumerable:!0,configurable:!0}),t.prototype.findLevel=function(e){return _.find(this.hierarchyLevels,(function(t){return t.name===e}))},t.prototype.clone=function(){var e=new t(this.contract,this.entity);return e.menuItems=i(this.menuItems),e.hierarchyLevels=_.map(this.hierarchyLevels,(function(t){return t.clone(e)})),e.template=this.template,e},t})(a);e.FieldListConceptualHierarchy=c;var u=(function(e){function t(t,i){e.call(this,t,i),this.expanded=!1,this.kpiMeasures=[],this.fieldType=4}return __extends(t,e),Object.defineProperty(t.prototype,"kind",{get:function(){return this.contract.kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"properties",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this.kpiMeasures},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t(this.contract,this.entity);return e.menuItems=i(this.menuItems),e.kpiMeasures=_.map(this.kpiMeasures,(function(t){return t.clone(e)})),e.template=this.template,e},t})(a);e.FieldListConceptualKpi=u;var d=(function(e){function t(t,i,r,o,n){e.call(this,t,o),this.kpiType=i,this.parent=r,this.locOptions=n,this.draggable=!0,this.fieldType=5}return __extends(t,e),Object.defineProperty(t.prototype,"displayName",{get:function(){var e;switch(this.kpiType){case 2:e=this.locOptions.KpiValueDisplayName;break;case 1:e=this.locOptions.KpiGoalDisplayName;break;case 0:e=this.locOptions.KpiStatusDisplayName;break;case 3:e=this.locOptions.KpiTrendDisplayName}return e||this.contract.displayName},enumerable:!0,configurable:!0}),t.prototype.clone=function(e){var r=e||this.parent,o=new t(this.contract,this.kpiType,r,this.entity,this.locOptions);return o.menuItems=i(this.menuItems),o.template=this.template,o},t})(s);e.FieldListConceptualKpiMeasure=d;var p=(function(e){function t(t,i,r,o){e.call(this,t,o),this.expanded=!1,this.parent=r,this.children=i,this.fieldType=1;for(var n=0,a=i;n<a.length;n++){var s=a[n];s.parent=this}}return __extends(t,e),t})(a);e.FieldListConceptualDisplayFolder=p})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.fieldListAction={name:"fieldListAction"}})(t=e.FieldListEvents||(e.FieldListEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new a(e,t,i)}var r=e.explore.utils.GroupUtils,o=e.explore.util.HierarchyUtils;t.createFieldListMenuItemFactory=i;var n;!(function(e){function i(){return{type:1,checked:!1}}function r(e,r){var a=[],s=r.contract,l=r.entity.contract.hierarchies;if(a=a.concat([n("FieldListMenuItem_NewHierarchy",{action:11},e),i()]),!_.isEmpty(l)){var c=l.slice(0);o.sortHierarchies(c);var u=t.FieldListViewModelGenerator.getHierarchyLevelDictionary(l),d=_.filter(c,(function(e){var t=u[e.name];return!(t&&t[s.name])})),p=_.map(d,(function(e){return{text:e.displayName,key:{action:12,hierarchyName:e.name},type:0,checked:!1}}));if(!_.isEmpty(p)){var v=n("FieldListMenuItem_AddToHierarchy",void 0,e);v.children=p,a=a.concat(v,i())}}return a}function n(e,t,i){return{text:i.get(e),key:t,type:0,checked:!1}}e.createItemSeparator=i,e.createHierarchyModelOperationMenuItems=r,e.createFieldListMenuItem=n})(n=t.FieldListMenuItemViewModelGenerator||(t.FieldListMenuItemViewModelGenerator={}));var a=(function(){function e(e,t,i){this.localizationService=e,this.featureSwitchService=t,this.groupingDesignStateService=i}return e.prototype.createSchemaMenuItems=function(e){return{items:e.canEdit?this.createMenuItems(this.localizationService,{canViewHidden:!0,canUnHideAll:!0,canExpandCollaseAll:!0}):this.createMenuItems(this.localizationService,{canExpandCollaseAll:!0})}},e.prototype.createHierarchyMenuItems=function(e){return{items:e.entity.canEdit?this.createMenuItems(this.localizationService,{canDelete:!0,canRename:!0,canHide:!0,canCreateMeasureOrColumn:!0,canViewHidden:!0,canUnHideAll:!0,canExpandCollaseAll:!0}):this.createMenuItems(this.localizationService,{canExpandCollaseAll:!0})}},e.prototype.createHierarchyLevelMenuItems=function(e){var t=this.createMenuItems(this.localizationService,{canAddToFilter:!0});if(e.entity.canEdit){var i=e.parent.contract.levels;t=t.concat(this.createMenuItems(this.localizationService,{canDelete:!0,canRename:!0,canMoveUp:_.first(i).name!==e.hierarchyLevelContract.name,canMoveDown:_.last(i).name!==e.hierarchyLevelContract.name,canCreateMeasureOrColumn:!0,canViewHidden:!0,canUnHideAll:!0,canExpandCollaseAll:!0}))}else t=t.concat(this.createMenuItems(this.localizationService,{canExpandCollaseAll:!0}));return{items:t}},e.prototype.createPropertyMenuItems=function(e){var t=this.createMenuItems(this.localizationService,{canAddToFilter:!0});if(e.entity.canEdit){var i=1!==e.kind,o=[];i&&(o=n.createHierarchyModelOperationMenuItems(this.localizationService,e)),t=t.concat(o,this.createMenuItems(this.localizationService,{canDelete:this.canDeleteProperty(e),canRename:!0,canHide:!0,canGroup:this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&0===e.kind&&r.canPropertyBeGrouped(e.contract),canEditGroups:this.featureSwitchService.featureSwitches.enableGroupAuthoring&&this.groupingDesignStateService&&r.isGroupOrBinColumn(e.entity.name,e.contract,this.groupingDesignStateService),canEditClustering:this.featureSwitchService.featureSwitches.clusteringEnabled&&this.groupingDesignStateService&&r.isClusteringColumn(e.entity.name,e.contract,this.groupingDesignStateService),canCreateMeasureOrColumn:!0,canViewHidden:!0,canUnHideAll:!0,canExpandCollaseAll:!0}))}else t=t.concat(this.createMenuItems(this.localizationService,{canExpandCollaseAll:!0}));return{items:t}},e.prototype.canDeleteProperty=function(e){return!(e.entity&&e.entity.calculated&&e.contract.column&&!e.contract.column.calculated)},e.prototype.createKpiMenuItems=function(e){return{items:e.entity.canEdit?this.createMenuItems(this.localizationService,{canDelete:!0,canRename:!0,canCreateMeasureOrColumn:!0,canViewHidden:!0,canUnHideAll:!0,canExpandCollaseAll:!0}):this.createMenuItems(this.localizationService,{canExpandCollaseAll:!0})}},e.prototype.createKpiMeasureMenuItems=function(e){return{items:this.createMenuItems(this.localizationService,{canExpandCollaseAll:!0})}},e.prototype.createEntityMenuItems=function(e){return{items:e.canEdit?this.createMenuItems(this.localizationService,{canDelete:!0,canRename:!0,canViewHidden:!0,canUnHideAll:!0,canExpandCollaseAll:!0,isEntity:!0,canHide:!0,canEditEntity:!e.calculated,canCreateMeasureOrColumn:!0}):this.createMenuItems(this.localizationService,{canExpandCollaseAll:!0})}},e.prototype.createMenuItems=function(e,t){var i=[];return t.canAddToFilter&&(i=i.concat([n.createFieldListMenuItem("FieldListMenuItem_AddFilter",{action:0},this.localizationService),n.createItemSeparator()])),t.canCreateMeasureOrColumn&&(i=i.concat([n.createFieldListMenuItem("FieldListMenuItem_NewMeasure",{action:10},e),n.createFieldListMenuItem("FieldListMenuItem_NewColumn",{action:13},e),n.createItemSeparator()])),t.isEntity&&(i.push(n.createFieldListMenuItem("FieldListMenuItem_RefreshEntity",{action:6},e)),t.canEditEntity&&i.push(n.createFieldListMenuItem("FieldListMenuItem_EditEntity",{action:9},e)),i.push(n.createItemSeparator()),t.canCopyTable&&(i.push(n.createFieldListMenuItem("DataExplorerFieldListMenuItem_CopyTable",{action:19},e)),i.push(n.createItemSeparator()))),t.canMoveUp&&i.push(n.createFieldListMenuItem("FieldListMenuItem_MoveUp",{action:7},e)),t.canMoveDown&&i.push(n.createFieldListMenuItem("FieldListMenuItem_MoveDown",{action:8},e)),t.canRename&&i.push(n.createFieldListMenuItem("FieldListMenuItem_Rename",{action:4},e)),t.canDelete&&i.push(n.createFieldListMenuItem("FieldListMenuItem_Delete",{action:5},e)),t.canHide&&i.push(n.createFieldListMenuItem("FieldListMenuItem_Hide",{action:1},e)),t.canHideInReportView&&i.push(n.createFieldListMenuItem("FieldListMenuItem_HideInReportView",{action:1},e)),(t.canUnHideAll||t.canViewHidden)&&(i.push(n.createItemSeparator()),t.canViewHidden&&i.push(n.createFieldListMenuItem("FieldListMenuItem_ViewHidden",{action:2},this.localizationService)),t.canUnHideAll&&i.push(n.createFieldListMenuItem("FieldListMenuItem_UnHideAll",{action:3},this.localizationService))),t.canExpandCollaseAll&&(i.length>0&&i.push(n.createItemSeparator()),i=i.concat([n.createFieldListMenuItem("FieldListMenuItem_CollapseAll",{action:14},this.localizationService),n.createFieldListMenuItem("FieldListMenuItem_ExpandAll",{action:15},this.localizationService)])),t.canGroup&&(i=i.concat([n.createItemSeparator(),n.createFieldListMenuItem("ContextMenuItem_CreateGroups",{action:16},e)])),t.canEditGroups&&i.push(n.createFieldListMenuItem("ContextMenuItem_EditGroups",{action:17},this.localizationService)),t.canEditClustering&&i.push(n.createFieldListMenuItem("Clustering_EditClusters",{action:18},this.localizationService)),i},e})();t.FieldListMenuItemFactory=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}e.DefaultPropertyTemplate="Default",e.FolderPropertyTemplate="Folder",e.KpiPropertyTemplate="Kpi",e.HierarchyPropertyTemplate="Hierarchy",e.LeafPropertyTemplate="Leaf",e.createFieldListPropertyTemplateGenerator=t;var i=(function(){function t(){}return t.prototype.getTemplate=function(t){switch(t.fieldType){case 0:return this.getTemplateUri(e.DefaultPropertyTemplate);case 1:return this.getTemplateUri(e.FolderPropertyTemplate);case 4:return this.getTemplateUri(e.KpiPropertyTemplate);case 2:return this.getTemplateUri(e.HierarchyPropertyTemplate);case 5:case 3:return this.getTemplateUri(e.LeafPropertyTemplate);default:return this.getTemplateUri(e.DefaultPropertyTemplate)}},t.prototype.getTemplateUri=function(e){return"views/fieldListProperty"+e+".html"},t})();e.FieldListPropertyTemplateGenerator=i})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){return new i(e,t,r,o)}e.createFieldListViewModelFactory=t;var i=(function(){function t(e,t,i,r){this.menuItemFactory=e,this.propertyTemplateGenerator=t,this.localizationService=i,this.featureSwitchService=r}return Object.defineProperty(t.prototype,"featureSwitches",{get:function(){return this.featureSwitchService.featureSwitches},enumerable:!0,configurable:!0}),t.prototype.convertConceptualSchema=function(t,i,r){return e.FieldListViewModelGenerator.convertConceptualSchema(t,i,this.localizationService,this.menuItemFactory,this.propertyTemplateGenerator,this.featureSwitches,r)},t.prototype.convertConceptualEntity=function(t,i,r,o){return e.FieldListViewModelGenerator.convertConceptualEntity(t,i,this.localizationService,this.menuItemFactory,this.propertyTemplateGenerator,this.featureSwitches,r,o)},t.prototype.convertConceptualDisplayFolder=function(t,i,r){return e.FieldListViewModelGenerator.convertConceptualDisplayFolder(t,this.localizationService,this.propertyTemplateGenerator,i,r)},t.prototype.convertConceptualHierarchy=function(t,i,r){return e.FieldListViewModelGenerator.convertConceptualHierarchy(t,this.localizationService,this.menuItemFactory,this.propertyTemplateGenerator,i,this.featureSwitches,r)},t.prototype.convertConceptualHierarchyLevel=function(t,i,r){return e.FieldListViewModelGenerator.convertConceptualHierarchyLevel(t,this.localizationService,this.menuItemFactory,this.propertyTemplateGenerator,i,this.featureSwitches,r)},t.prototype.convertConceptualProperty=function(t,i){return e.FieldListViewModelGenerator.convertConceptualProperty(t,this.localizationService,this.menuItemFactory,this.propertyTemplateGenerator,i)},t.prototype.ConvertConceptualKpi=function(t,i,r){return e.FieldListViewModelGenerator.ConvertConceptualKpi(t,this.localizationService,this.menuItemFactory,this.propertyTemplateGenerator,i,r)},t})()})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(t){function i(t,i,o,n,a,s,l){var c=t.schema(i);if(c){var u=new e.FieldListConceptualModel(c);return u.entities=_.map(c.entities,(function(e){return r(e,i,o,n,a,s,c.canEdit,u)})),u.schemaName=i,u.canEdit=c.canEdit,u.showNonUserEntities=l,e.FieldListViewModelOperations.expandIfSingleEntity(u.entities),o.ensureLocalization((function(){u.menuItems=n.createSchemaMenuItems(u)})),u}}function r(t,i,r,n,s,u,h,f){var y=new e.FieldListConceptualEntity(t,i,f);y.canEdit=h,y.properties=[];for(var w=0,C=t.properties;w<C.length;w++){var S=C[w];S.measure&&S.measure.kpi?y.properties.push(c(S,r,n,s,h,y)):S.kpiValue||y.properties.push(l(S,r,n,s,y))}if(y.expanded=!1,y.isMeasureGroup=d(t.properties),null!=t.hierarchies&&t.hierarchies.length>0){y.hierarchies=_.map(t.hierarchies,(function(e){return a(e,r,n,s,h,u,y)}));for(var b=0,x=y.hierarchies;b<x.length;b++){var D=x[b];y.properties.push(D)}}return _.isEmpty(t.displayFolders)||(y.displayFolders=_.map(t.displayFolders,(function(e){return o(e,r,s,void 0,y)})),y.properties.push.apply(y.properties,y.displayFolders)),v(y.properties),g(y.properties,y.displayFolders),m(y),p(y),r.ensureLocalization((function(){y.menuItems=n.createEntityMenuItems(y)})),y}function o(e,t,i,r,o){for(var a={},s=0,l=o.properties;s<l.length;s++){var c=l[s];a[c.name]=c}return n(e,t,i,null,a,o)}function n(t,i,r,o,a,s){for(var l=[],c=0,u=t.properties;c<u.length;c++){var d=u[c];if(d){var p=a[d.name];p&&l.push(p.clone())}}for(var h=0,g=t.hierarchies;h<g.length;h++){var f=g[h];if(f){var p=a[f.name];p&&l.push(p.clone())}}var m=new e.FieldListConceptualDisplayFolder(t,l,o,s);m.template=r.getTemplate(m);for(var y=0,w=t.displayFolders;y<w.length;y++){var C=w[y];m.children.push(n(C,i,r,m,a,s))}return v(m.children),m}function a(t,i,r,o,n,a,l){var c=new e.FieldListConceptualHierarchy(t,l);i.ensureLocalization((function(){c.menuItems=r.createHierarchyMenuItems(c)})),c.template=o.getTemplate(c),c.hierarchyLevels=[];for(var u=0,d=t.levels;u<d.length;u++){var p=d[u];c.hierarchyLevels.push(s(p,i,r,o,n,a,c))}return c}function s(t,i,r,o,n,a,s){var l=new e.FieldListConceptualHierarchyLevel(t,s,s.entity);return l.template=o.getTemplate(l),i.ensureLocalization((function(){l.menuItems=r.createHierarchyLevelMenuItems(l)})),l}function l(t,i,r,o,n){var a=new e.FieldListConceptualProperty(t,n);return a.template=o.getTemplate(a),i.ensureLocalization((function(){a.menuItems=r.createPropertyMenuItems(a)})),a}function c(t,i,r,o,n,a){var s=new e.FieldListConceptualKpi(t,a);s.template=o.getTemplate(s);var l={};i.ensureLocalization((function(){s.menuItems=r.createKpiMenuItems(s),l.KpiValueDisplayName=i.get("KpiValueFieldListDisplayName"),l.KpiStatusDisplayName=i.get("KpiStatusFieldListDisplayName"),l.KpiGoalDisplayName=i.get("KpiGoalFieldListDisplayName"),l.KpiTrendDisplayName=i.get("KpiTrendFieldListDisplayName")}));var c=t.measure.kpi,d=c.goal,p=c.status,v=c.trend;return s.kpiMeasures=[],s.kpiMeasures.push(u(t,i,r,o,2,s,a,l)),d&&s.kpiMeasures.push(u(d,i,r,o,1,s,a,l)),p&&s.kpiMeasures.push(u(p,i,r,o,0,s,a,l)),v&&s.kpiMeasures.push(u(v,i,r,o,3,s,a,l)),s}function u(t,i,r,o,n,a,s,l){var c=new e.FieldListConceptualKpiMeasure(t,n,a,s,l);return c.template=o.getTemplate(c),i.ensureLocalization((function(){c.menuItems=r.createKpiMeasureMenuItems(c)})),c}function d(e){return _.find(e,(function(e){return!e.hidden}))&&!_.find(e,(function(e){return!e.hidden&&1!==e.kind&&2!==e.kind}))}function p(e){for(var t=0,i=e.properties;t<i.length;){var r=i[t];if(r.properties)for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];i.splice(t+1,0,a),t++}t++}}function v(e){_.isEmpty(e)||e.sort(h)}function h(e,t){var i=e.displayName.toLocaleUpperCase(),r=t.displayName.toLocaleUpperCase();return i.localeCompare(r)}function g(e,t){if(!_.isEmpty(e)){var i={};f(t,i);var r=_.filter(e,(function(e){return 1!==e.fieldType&&i[e.name]}));_.isEmpty(r)||_.pull.apply(_,[e].concat(r))}}function f(e,t){if(!_.isEmpty(e)){for(var i=[],r=0,o=e;r<o.length;r++)for(var n=o[r],a=0,s=n.children;a<s.length;a++){var l=s[a];1===l.fieldType?i.push(l):t[l.name]=l}f(i,t)}}function m(e){var t=[];y(e.properties,t),e.properties=t}function y(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(t.push(o),1===o.fieldType){var n=o;y(n.children,t)}}}function w(e){var t={};if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i],n={};t[o.name]=n;for(var a=0,s=o.levels;a<s.length;a++){var l=s[a];n[l.column.name]=l}}return t}t.convertConceptualSchema=i,t.convertConceptualEntity=r,t.convertConceptualDisplayFolder=o,t.convertConceptualHierarchy=a,t.convertConceptualHierarchyLevel=s,t.convertConceptualProperty=l,t.ConvertConceptualKpi=c,t.updatePropertiesWithChildren=p,t.sortProperties=v,t.removeDuplicateProperties=g,t.flattenFolders=m,t.getHierarchyLevelDictionary=w})(t=e.FieldListViewModelGenerator||(e.FieldListViewModelGenerator={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n){if(!e||!e.schema||!t)return e={schema:t?r.convertConceptualSchema(t,i,n):null,isLoaded:!!t};var a=t.schema(i);return a?(h.visitModel(a,[new g(e.schema,o),new f(i,r),new m(r,o),new y]),e):e}function o(e,t,i,r){t.contract=i;for(var o=i.measure.kpi,a=0,s=t.kpiMeasures;a<s.length;a++){var l=s[a],c=void 0;switch(l.kpiType){case 2:c=i;break;case 1:c=o.goal;break;case 0:c=o.status;break;case 3:c=o.trend}n(l,c)}}function n(e,t){e.contract=t}function a(e,i,r,o,n){var l={};if(!_.isEmpty(i))for(var c=0,u=i;c<u.length;c++){var d=u[c];l[d.name]=d}for(var p=0,v=r;p<v.length;p++){var h=v[p],g=h.name,d=l[g];if(d){delete l[g];var f=_.filter(d.children,(function(e){return 1===e.fieldType}));s(e,d,h),a(e,f,h.displayFolders,o,d)}else{var m=o.convertConceptualDisplayFolder(h,n,e);n?(n.children||(n.children=[]),n.children.push(m),t.FieldListViewModelGenerator.sortProperties(n.children)):(e.displayFolders||(e.displayFolders=[]),e.displayFolders.push(m),e.properties.push(m))}}if(!_.isEmpty(l)){var y=_.values(l);n?_.pull.apply(_,[n.children].concat(y)):_.pull.apply(_,[e.displayFolders].concat(y))}}function s(e,t,i){var r={},o=_.filter(t.children,(function(e){return 1!==e.fieldType}));if(!_.isEmpty(o))for(var n=0,a=o;n<a.length;n++){var s=a[n];r[s.name]=s}if(!_.isEmpty(i.properties))for(var l=0,c=i.properties;l<c.length;l++){var u=c[l],d=u.name,s=r[d];if(s)delete r[d];else{var p=e.findFields(d)||e.findKpis(d);p&&t.children.push(p[0].clone())}}if(!_.isEmpty(i.hierarchies))for(var v=0,h=i.hierarchies;v<h.length;v++){var g=h[v],f=g.name,m=r[f];if(m)delete r[f];else{var p=e.findHierarchies(f);p&&t.children.push(_.first(p).clone())}}if(!_.isEmpty(r)){var y=_.values(r);_.pull.apply(_,[t.children].concat(y))}}function l(e){var t=e.properties,i=_.filter(t,(function(e){return 1===e.fieldType}));_.isEmpty(i)||_.pull.apply(_,[t].concat(i)),e.displayFolders&&t.push.apply(t,e.displayFolders)}function c(e){return!!e.measure&&!!e.measure.kpi}function u(e){return!!e.kpiValue}function d(e,t,i,r){if(!_.isEmpty(e)){var o=_.filter(e,(function(e){return e.propertyRename&&e.propertyRename.after===t}));_.isEmpty(o)||(t=o[0].propertyRename.before)}return i.findFieldsByType(t,r)}var p=e.explore.util.HierarchyUtils,v=e.data.SchemaChangeType.ObjectTypeEnum;i.mergeModel=r;var h;!(function(e){function t(e,t){for(var r,o=0,n=t;o<n.length;o++){var a=n[o];r=a.visitModel(r,e)}for(var s=0,l=e.entities;s<l.length;s++){var c=l[s];i(c,t)}for(var u=0,d=t;u<d.length;u++){var a=d[u];r=a.modelVisited(r,e)}}function i(e,t){for(var i,s=0,d=t;s<d.length;s++){var p=d[s];i=p.visitEntity(i,e)}for(var v=0,h=e.properties;v<h.length;v++){var g=h[v];c(g)?o(g,t):u(g)?n(g,t):r(g,t)}for(var f=0,m=e.hierarchies;f<m.length;f++){var y=m[f];a(y,t)}for(var w=0,C=t;w<C.length;w++){var p=C[w];i=p.entityVisited(i,e)}for(var S=0,b=e.displayFolders;S<b.length;S++){var x=b[S];l(x,t)}}function r(e,t){for(var i,r=0,o=t;r<o.length;r++){var n=o[r];i=n.visitProperty(i,e)}}function o(e,t){for(var i,r=0,o=t;r<o.length;r++){var n=o[r];i=n.visitKpi(i,e)}}function n(e,t){for(var i,r=0,o=t;r<o.length;r++){var n=o[r];i=n.visitKpiMeasure(i,e)}}function a(e,t){for(var i,r=0,o=t;r<o.length;r++){var n=o[r];i=n.visitHierarchy(i,e)}for(var a=0,l=e.levels;a<l.length;a++){var c=l[a];s(c,t)}}function s(e,t){for(var i,r=0,o=t;r<o.length;r++){var n=o[r];i=n.visitHierarchyLevel(i,e)}}function l(e,t){for(var i,r=0,o=t;r<o.length;r++){var n=o[r];i=n.visitDisplayFolder(i,e)}for(var a=0,s=e.displayFolders;a<s.length;a++){var c=s[a];l(c,t)}}e.visitModel=t})(h||(h={}));var g=(function(){function e(e,t){this.fieldListConceptualModel=e,t&&(this.schemaChanges=t.changes,this.entityRenameChanges=_.filter(this.schemaChanges,(function(e){return e.entityRename})))}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel},e.prototype.visitEntity=function(e,t){return this.fieldListConceptualEntity=this.getFieldListConceptualEntity(t),this.propertyRenameChanges=this.fieldListConceptualEntity&&_.filter(this.schemaChanges,(function(e){return e.propertyRename&&e.propertyRename.entity===t.name&&e.propertyRename.objectType!==v.Hierarchy})),this.hierarchyRenameChanges=this.fieldListConceptualEntity&&_.filter(this.schemaChanges,(function(e){return e.propertyRename&&e.propertyRename.entity===t.name&&e.propertyRename.objectType===v.Hierarchy})),this.fieldListConceptualEntity},e.prototype.visitProperty=function(e,t){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,t.name,this.fieldListConceptualEntity,0)},e.prototype.visitHierarchy=function(e,t){if(this.fieldListConceptualHierarchies=this.fieldListConceptualEntity&&d(this.hierarchyRenameChanges,t.name,this.fieldListConceptualEntity,2),_.isEmpty(this.fieldListConceptualHierarchies))this.fieldListConceptualHierarchies=null,this.existingLevels=null;else{this.existingLevels={};for(var i=_.first(this.fieldListConceptualHierarchies).hierarchyLevels,r=0,o=i;r<o.length;r++){var n=o[r];this.existingLevels[n.name]=n}}return this.fieldListConceptualHierarchies},e.prototype.visitHierarchyLevel=function(e,t){var i=this;if(!_.isEmpty(this.fieldListConceptualHierarchies)){var r=t.name,o=_.first(this.fieldListConceptualHierarchies),n=_.filter(this.schemaChanges,(function(e){return e.hierarchyLevelRename&&e.hierarchyLevelRename.entity===i.fieldListConceptualEntity.contract.name&&e.hierarchyLevelRename.hierarchy===o.contract.name&&e.hierarchyLevelRename.after===r}));return _.isEmpty(n)||(r=_.first(n).hierarchyLevelRename.before),this.existingLevels[r]}},e.prototype.visitKpi=function(e,t){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,t.name,this.fieldListConceptualEntity,4)},e.prototype.visitKpiMeasure=function(e,t){if(this.fieldListConceptualEntity)return d(this.propertyRenameChanges,t.name,this.fieldListConceptualEntity,5)},e.prototype.visitDisplayFolder=function(e,t){return this.fieldListConceptualEntity?d(this.propertyRenameChanges,t.name,this.fieldListConceptualEntity,1):e},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e},e.prototype.getFieldListConceptualEntity=function(e){var t=e.name;if(!_.isEmpty(this.entityRenameChanges)){var i=_.filter(this.entityRenameChanges,(function(t){return t.entityRename&&t.entityRename.after===e.name}));_.isEmpty(i)||(t=i[0].entityRename.before)}return this.fieldListConceptualModel.findEntity(t)},e})(),f=(function(){function e(e,t){this.schemaName=e,this.fieldListViewModelFactory=t}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel=e,e.contract=t,e.canEdit=t.canEdit,e},e.prototype.visitEntity=function(e,t){return this.fieldListConceptualEntity=e,e&&(e.schemaName=this.schemaName,e.contract=t),this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e},e.prototype.visitProperty=function(e,t){if(e)for(var i=this.fieldListConceptualModel.canEdit?this.fieldListViewModelFactory.convertConceptualProperty(t,this.fieldListConceptualEntity):null,r=0,o=e;r<o.length;r++){var n=o[r];n.contract=t,i&&(n.menuItems=i.menuItems)}return e},e.prototype.visitHierarchy=function(e,t){if(e){for(var i=0,r=e;i<r.length;i++){var o=r[i];o.contract=t}this.fieldListConceptualHierarchies=e;for(var n=0,a=this.fieldListConceptualHierarchies;n<a.length;n++){var s=a[n];s.hierarchyLevels=[]}}return e},e.prototype.visitHierarchyLevel=function(e,t){if(e){e.contract=t.column,e.hierarchyLevelContract=t;var i=_.first(this.fieldListConceptualHierarchies);if(this.fieldListConceptualModel.canEdit){var r=this.fieldListViewModelFactory.convertConceptualHierarchyLevel(t,this.fieldListConceptualModel.canEdit,i);e.menuItems=r.menuItems}for(var o=0,n=this.fieldListConceptualHierarchies;o<n.length;o++){var a=n[o];a.hierarchyLevels.push(e)}}return e},e.prototype.visitKpi=function(e,t){if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var n=r[i];o(this.fieldListConceptualEntity,n,t,this.fieldListConceptualEntity.contract)}return e},e.prototype.visitKpiMeasure=function(e,t){if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i];o.contract=t}return e},e.prototype.visitDisplayFolder=function(e,t){return e},e})(),m=(function(){function e(e,t){this.fieldListViewModelFactory=e,t&&(this.modelSchemaChanges=t.changes)}return e.prototype.visitModel=function(e,t){return this.fieldListConceptualModel=e,e},e.prototype.visitEntity=function(e,i){if(this.fieldListConceptualEntity=e,this.fieldListConceptualModel&&!e){var r=this.fieldListViewModelFactory.convertConceptualEntity(i,this.fieldListConceptualModel.schemaName,this.fieldListConceptualModel.canEdit,this.fieldListConceptualModel);this.fieldListConceptualModel.entities.push(r)}return this.sortedHierarchies=i.hierarchies.slice(0),p.sortHierarchies(this.sortedHierarchies),this.hierarchyLevelDictionary=this.fieldListConceptualModel.canEdit&&t.FieldListViewModelGenerator.getHierarchyLevelDictionary(i.hierarchies),this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,t){return e},e.prototype.entityVisited=function(e,t){return e&&a(this.fieldListConceptualEntity,this.fieldListConceptualEntity.displayFolders,t.displayFolders,this.fieldListViewModelFactory,null),e},e.prototype.visitProperty=function(e,t){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var i=this.fieldListViewModelFactory.convertConceptualProperty(t,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(i),e=[i]}return e},e.prototype.visitHierarchy=function(e,t){if(this.fieldListConceptualHierarchies=e,this.fieldListConceptualEntity&&_.isEmpty(e)){var i=this.fieldListViewModelFactory.convertConceptualHierarchy(t,this.fieldListConceptualModel.canEdit,this.fieldListConceptualEntity);this.fieldListConceptualEntity.hierarchies||(this.fieldListConceptualEntity.hierarchies=[]),this.fieldListConceptualEntity.hierarchies.push(i),this.fieldListConceptualEntity.properties.push(i),this.expandHierarchyIfJustCreated(i),e=[i]}return e},e.prototype.visitHierarchyLevel=function(e,t){if(!_.isEmpty(this.fieldListConceptualHierarchies)&&!e){var i=_.first(this.fieldListConceptualHierarchies);e=this.fieldListViewModelFactory.convertConceptualHierarchyLevel(t,this.fieldListConceptualModel.canEdit,i);for(var r=0,o=this.fieldListConceptualHierarchies;r<o.length;r++){var n=o[r];n.hierarchyLevels.push(e)}}return e},e.prototype.visitKpi=function(e,t){if(this.fieldListConceptualEntity&&_.isEmpty(e)){var i=this.fieldListViewModelFactory.ConvertConceptualKpi(t,this.fieldListConceptualModel.canEdit,this.fieldListConceptualEntity);this.fieldListConceptualEntity.properties.push(i),
e=[i]}return e},e.prototype.visitKpiMeasure=function(e,t){return e},e.prototype.visitDisplayFolder=function(e,t){return e},e.prototype.expandHierarchyIfJustCreated=function(e){var t=this;_.any(this.modelSchemaChanges,(function(i){var r=i.hierarchyCreate&&i.hierarchyCreate.entity===t.fieldListConceptualEntity.contract.name&&i.hierarchyCreate.name===e.name;return r}))&&(e.expanded=!0)},e})(),y=(function(){function e(){}return e.prototype.visitModel=function(e,t){this.fieldListConceptualModel=e,this.existingEntities=[];for(var i=0,r=this.fieldListConceptualModel.entities;i<r.length;i++){var o=r[i];this.existingEntities.push(o)}return e},e.prototype.visitEntity=function(e,t){if(this.fieldListConceptualEntity=e,e){if(_.pull(this.existingEntities,e),this.existingHierarchies=[],this.fieldListConceptualEntity.hierarchies)for(var i=0,r=this.fieldListConceptualEntity.hierarchies;i<r.length;i++){var o=r[i];this.existingHierarchies.push(o)}this.existingProperties=[];for(var n=0,a=this.fieldListConceptualEntity.properties;n<a.length;n++){var s=a[n];this.existingProperties.push(s)}}return this.fieldListConceptualEntity},e.prototype.modelVisited=function(e,i){return _.pull.apply(_,[this.fieldListConceptualModel.entities].concat(this.existingEntities)),t.FieldListViewModelOperations.expandIfSingleEntity(this.fieldListConceptualModel.entities),e},e.prototype.entityVisited=function(e,i){return e&&(_.pull.apply(_,[this.fieldListConceptualEntity.hierarchies].concat(this.existingHierarchies)),_.pull.apply(_,[this.fieldListConceptualEntity.properties].concat(this.existingProperties)),l(this.fieldListConceptualEntity),t.FieldListViewModelGenerator.sortProperties(this.fieldListConceptualEntity.properties),t.FieldListViewModelGenerator.removeDuplicateProperties(this.fieldListConceptualEntity.properties,this.fieldListConceptualEntity.displayFolders),t.FieldListViewModelGenerator.flattenFolders(this.fieldListConceptualEntity),t.FieldListViewModelGenerator.updatePropertiesWithChildren(this.fieldListConceptualEntity)),e},e.prototype.visitProperty=function(e,t){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i];_.pull(this.existingProperties,o)}return e},e.prototype.visitHierarchy=function(e,t){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i];_.pull(this.existingProperties,o),_.pull(this.existingHierarchies,o)}return e},e.prototype.visitHierarchyLevel=function(e,t){return e},e.prototype.visitKpi=function(e,t){if(!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i];_.pull(this.existingProperties,o)}return e},e.prototype.visitKpiMeasure=function(e,t){return e},e.prototype.visitDisplayFolder=function(e,t){if(this.fieldListConceptualEntity&&!_.isEmpty(e))for(var i=0,r=e;i<r.length;i++){var o=r[i];_.pull(this.existingProperties,o)}return e},e})()})(i=t.FieldListViewModelMerger||(t.FieldListViewModelMerger={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.services.schemaItemActivationUtils;!(function(e){function t(e){return e.supported&&(!e.hidden||e.showHidden)}e.isFieldVisible=t})(r=i.FieldListUtils||(i.FieldListUtils={}));var a;!(function(t){function i(t,i,r){var o=e.explore.util.ModelAuthoringUtility.getLastNewCalculationSchemaChangeAsFieldExpr(r);if(o)return s(t,o),n.setActiveSchemaItem(i,o),o}function r(e,t){for(var i=0,r=e.entities;i<r.length;i++){var o=r[i];o.expanded=t;for(var n=0,a=o.properties;n<a.length;n++){var s=a[n];2!==s.fieldType&&4!==s.fieldType&&1!==s.fieldType||(s.expanded=t)}}}function a(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n.entity){var a=t.findEntity(n.entity);a&&(a.expanded=!0)}}function s(e,i){a(e,i),t.updateSelection(e,i)}function l(t,i){var r=e.data.SQExprConverter.asFieldPattern(i),n=o.toFieldExprEntityItemPattern(r);if(n&&n.entity)if(o.hasFieldExprName(r)){var a=t.findFields(n.entity,o.getPropertyName(r));if(a){for(var s=0,l=a;s<l.length;s++){var c=l[s];c.hidden=!c.hidden,f(c.menuItems,1,c.hidden)}return _.first(a).hidden}}else if(r.hierarchy){var u=t.findHierarchies(n.entity,o.getHierarchyName(r));if(u){for(var d=0,p=u;d<p.length;d++){var v=p[d];v.hidden=!v.hidden,f(v.menuItems,1,v.hidden)}return _.first(u).hidden}}else{var h=t.findEntity(n.entity);if(h)return h.hidden=!h.hidden,f(h.menuItems,1,h.hidden),h.hidden}}function c(e){e.showHidden=!e.showHidden,u(e)}function u(e){f(e.menuItems,2,e.showHidden);for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];f(r.menuItems,2,e.showHidden),f(r.menuItems,1,r.hidden);for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];f(a.menuItems,2,e.showHidden),f(a.menuItems,1,a.hidden)}}}function d(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.hidden&&(r.hidden=!1,f(r.menuItems,1,!1));for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.hidden&&(a.hidden=!1,f(a.menuItems,1,!1))}}}function p(e){for(var t=0,i=e.entities;t<i.length;t++)for(var r=i[t],o=0,n=r.properties;o<n.length;o++){var a=n[o],s=a;s.supported=!(s.type&&s.type.binary)}}function v(e){for(var t=0,i=e.entities;t<i.length;t++){var r=i[t];r.selected=!1;for(var o=0,n=r.properties;o<n.length;o++){var a=n[o];a.selected=!1}}}function h(i,r){t.clearSelection(i);var n=e.data.SQExprConverter.asFieldPattern(r);if(n){var a=o.toFieldExprEntityItemPattern(n);if(a.entity)if(o.hasFieldExprName(n)){var s=i.findFields(a.entity,o.getPropertyName(n));if(s)for(var l=0,c=s;l<c.length;l++){var u=c[l];u.selected=!0}}else{var d=i.findEntity(a.entity);d&&(d.selected=!0)}}}function g(e){var t=_.filter(e,(function(e){return e.userEntity&&!e.hidden}));1===t.length&&(t[0].expanded=!0)}function f(e,t,i){if(e)for(var r=0,o=e.items;r<o.length;r++){var n=o[r];n.key&&n.key.action===t&&(n.checked=i)}}t.applyModelChanges=i,t.collapseOrExpandAllEntities=r,t.expandEntity=a,t.expandEntityAndSelect=s,t.toggleHide=l,t.toggleShowHidden=c,t.updateAllMenuItemsCheckStatus=u,t.unhideAll=d,t.updateSupportedProperties=p,t.clearSelection=v,t.updateSelection=h,t.expandIfSingleEntity=g})(a=i.FieldListViewModelOperations||(i.FieldListViewModelOperations={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=jsCommon.ArrayExtensions,r=e.data.SQExpr,o=e.VisualObjectRepetition,n=(function(){function e(e,t,i,r,o,n,a,s,l,c,u){this.expr=e,this.role=t,this.startIndex=i,this.endIndex=r,this.isReplaceable=o,this.displayName=n,this.dropDownItems=a,this.tooltip=s,this.valid=l,this.hierarchyLevels=c,this.visualObjectRepetition=u}return e.prototype.equals=function(e){return this.role===e.role&&this.startIndex===e.startIndex&&this.endIndex===e.endIndex&&this.displayName===e.displayName&&this.isReplaceable===e.isReplaceable&&this.tooltip===e.tooltip&&this.valid===e.valid&&o.equals(this.visualObjectRepetition,e.visualObjectRepetition)&&r.equals(this.expr,e.expr)&&_.isEqual(this.dropDownItems,e.dropDownItems)&&i.comparableSequenceEqual(this.hierarchyLevels,e.hierarchyLevels)},e})();t.FieldWellProperty=n;var a=(function(){function e(e,t){this.expr=e,this.displayName=t}return e.prototype.equals=function(e){return r.equals(this.expr,e.expr)&&this.displayName===e.displayName},e})();t.FieldWellHierarchyLevel=a;var s=(function(){function e(e,t,i,r,o){this.role=e,this.displayName=t,this.properties=i,this.supportsMultipleItems=r,this.description=o}return e.prototype.equals=function(e){return this.role===e.role&&this.displayName===e.displayName&&i.comparableSequenceEqual(this.properties,e.properties)&&this.supportsMultipleItems===e.supportsMultipleItems&&this.description===e.description},e})();t.FieldWellBucket=s;var l=(function(){function e(e){this.buckets=e}return e})();t.FieldWell=l})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.explore.util.ConditionalFormattingUtil,n=e.data.FieldExprPattern,a=e.explore.utils.GroupUtils,s=e.data.SQExprBuilder,l=e.data.SQExprUtils,c=e.data.SQHierarchyExprUtils,u=e.explore.util.VisualContainerUtils;!(function(i){function r(e,t,i,r,o,a,s){var l=new g(e,o,a,t,i,r,s);return n.visit(e,l)}function d(e){return{type:0}}function p(e,t,i,r,o,a,s,l){return{items:n.visit(e.expr,new f(e,t,i,r,o,a,s,l))}}function v(e,t){var i=e.getConceptualProperty(t);return i&&1===i.kind}var h="Aggregate_";i.createAggregateMenuItems=r;var g=(function(){function i(e,t,i,r,o,n,a){this.sqExpr=e,this.dataRoleKind=t,this.requiredTypes=i,this.schema=r,this.aggrOps=o,this.hasHierarchyLevels=n,this.property=a}return i.prototype.visitEntity=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumn=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitGroupingColumnAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitColumnHierarchyLevelVariation=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitEntityAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchy=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevel=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitHierarchyLevelAggr=function(e){return this.createMenuItems(this.sqExpr)},i.prototype.visitMeasure=function(e){return[]},i.prototype.visitPercentOfGrandTotal=function(e){var t=s.fieldExpr(e.baseExpr);return this.createMenuItems(t)},i.prototype.visitPercentile=function(e){return[]},i.prototype.visitSelectRef=function(e){return[]},i.prototype.createMenuItems=function(t){var i=[];if(!this.hasHierarchyLevels&&_.isEmpty(t.validate(this.schema,this.aggrOps))&&!l.discourageAggregation(t,this.schema)){var r=this.dataRoleKind===e.VisualDataRoleKind.Grouping,o=this.dataRoleKind===e.VisualDataRoleKind.GroupingOrMeasure,n=r?[]:this.aggrOps.getSupportedAggregates(t,this.schema,this.requiredTypes);o&&!v(t,this.schema)&&i.push(this.createRemoveAggregateMenuItem());for(var a=0,s=n;a<s.length;a++){var c=s[a];i.push(this.createAggregateMenuItem(c))}}return i},i.prototype.createAggregateMenuItem=function(i){var r=d(this.property);r.key={action:2,aggregate:i};var o=s.removeAggregate(this.sqExpr).getMetadata(this.schema),n=t.services.getAggregateKey(i,o);return r.text=e.common.localize.get(h+n),r},i.prototype.createRemoveAggregateMenuItem=function(){var t=d(this.property);return t.key={action:1},t.text=e.common.localize.get("FieldWell_RemoveAggregate"),t},i.prototype.visitTransformOutputRoleRef=function(e){return[]},i})(),f=(function(){function t(e,t,i,r,o,n,a,s){this.property=e,this.bucket=t,this.dataRole=i,this.schema=r,this.aggrOps=o,this.visual=n,this.featureSwitchService=a,this.groupingDesignStateService=s,this.menuItems=[this.createDeleteMenuItem()]}return t.prototype.visitEntity=function(e){return this.menuItems},t.prototype.visitColumn=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.schema),this.addConditionalFormattingMenuItem(t),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitColumnAggr=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.schema),this.addConditionalFormattingMenuItem(t),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumn=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.schema),this.addConditionalFormattingMenuItem(t),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.addGroupsMenuItems(e),this.menuItems},t.prototype.visitGroupingColumnAggr=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.schema),this.addConditionalFormattingMenuItem(t),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.addVariationsMenuItems(e),this.menuItems},t.prototype.visitColumnHierarchyLevelVariation=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.source.schema),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitEntityAggr=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.schema),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitHierarchy=function(e){return this.addQuickCalcMenuItem(e.schema),this.addAggregateMenuItems(),this.addShowAllMenuItem(_.first(this.property.hierarchyLevels).expr),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevel=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.schema),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels),this.menuItems},t.prototype.visitHierarchyLevelAggr=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.schema),this.addConditionalFormattingMenuItem(t),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitMeasure=function(e){var t=this.property.expr;return this.addQuickCalcMenuItem(e.schema),this.addConditionalFormattingMenuItem(t),this.addShowAllMenuItem(t),this.menuItems},t.prototype.visitPercentile=function(e){var t=this.property.expr;return this.addConditionalFormattingMenuItem(t),this.menuItems},t.prototype.visitSelectRef=function(e){return[]},t.prototype.visitTransformOutputRoleRef=function(e){return[]},t.prototype.visitPercentOfGrandTotal=function(e){var t=s.fieldExpr(e.baseExpr);this.addQuickCalcMenuItem(n.getSchema(e.baseExpr)),this.addConditionalFormattingMenuItem(t),this.addAggregateMenuItems(),this.addShowAllMenuItem(t),this.addHierarchiesMenuItems(this.property.hierarchyLevels);var i=n.getProperty(e.baseExpr);return i&&this.addVariationsMenuItems(i),this.menuItems},t.prototype.addAggregateMenuItems=function(){var e=r(this.property.expr,this.schema,this.aggrOps,!_.isEmpty(this.property.hierarchyLevels),this.dataRole.kind,this.dataRole.requiredTypes,this.property);_.isEmpty(e)||(this.menuItems.push(this.createSeparatorMenuItem()),(t=this.menuItems).push.apply(t,e));var t},t.prototype.addConditionalFormattingMenuItem=function(e){var t=this.property.visualObjectRepetition;if(t){var i=e.getMetadata(this.schema);if(i){var r=1===i.kind&&i.type.numeric,n=u.hasGroupByItems(this.visual.query);r&&!n&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createConditionalFormattingMenuItem()),o.isConditionalFormattingAppliedOnExpr(this.visual,t,this.property.expr)&&this.menuItems.push(this.createRemoveConditionalFormattingMenuItem()))}}},t.prototype.addShowAllMenuItem=function(t){var i=l.isMeasure(t);u.hasGroupByItems(this.visual.query)||(this.dataRole.kind===e.VisualDataRoleKind.Grouping||this.dataRole.kind===e.VisualDataRoleKind.GroupingOrMeasure&&!i)&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createShowAllMenuItem()))},t.prototype.addHierarchiesMenuItems=function(e){if(!_.isEmpty(e)){var t=_.first(e),i=c.expandExpr(this.schema,t.expr.arg);i instanceof Array&&i.length===e.length||this.bucket.supportsMultipleItems&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createRestoreHierarchyMenuItem()))}},t.prototype.addQuickCalcMenuItem=function(t){if(_.isEmpty(this.property.hierarchyLevels)){var i=this.schema.schema(t),r=i&&i.capabilities.supportsScopedEval;this.featureSwitchService.featureSwitches.quickCalc&&!u.hasGroupByItems(this.visual.query)&&r&&this.dataRole.kind!==e.VisualDataRoleKind.Grouping&&(this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(this.createQuickCalcMenuItem()))}},t.prototype.addVariationsMenuItems=function(t){var i=s.fromColumn(t),r=i.getConceptualProperty(this.schema);if(r){var o=r.column;if(o&&!_.isEmpty(o.variations)){for(var n=s.entity(t.schema,t.entity),a=this.createVariationMenuItem(r.displayName,i),l=[],c=0,u=o.variations;c<u.length;c++){var d=u[c];if(d.navigationProperty&&d.navigationProperty.targetEntity){var p=d.navigationProperty.targetEntity;if(this.dataRole.kind!==e.VisualDataRoleKind.Measure)for(var v=_.filter(p.hierarchies,(function(e){return!e.hidden})),h=0,g=v;h<g.length;h++){var f=g[h],m=s.hierarchy(s.propertyVariationSource(n,d.name,r.name),f.name);l.push(this.createVariationMenuItem(f.name,m))}for(var y=s.entity(n.schema,p.name),w=_.filter(p.properties,(function(e){return!e.hidden})),C=0,S=w;C<S.length;C++){var b=S[C],x=s.columnRef(y,b.name);l.push(this.createVariationMenuItem(b.displayName,x))}}}if(!_.isEmpty(l)){this.menuItems.push(this.createSeparatorMenuItem()),this.menuItems.push(a),(D=this.menuItems).push.apply(D,l);var D}}}},t.prototype.addGroupsMenuItems=function(e){var t=this.featureSwitchService.featureSwitches.enableGroupAuthoring,i=this.featureSwitchService.featureSwitches.clusteringEnabled;if(t||i){var r=[],o=this.property.expr.getConceptualProperty(this.schema);!a.canExprBeGrouped(this.schema,this.property.expr)||this.property.hierarchyLevels&&this.property.hierarchyLevels.length>0||r.push(this.createGroupsMenuItem()),a.isGroupOrBinColumn(e.entity,o,this.groupingDesignStateService)&&r.push(this.createEditGroupsMenuItem()),a.isClusteringColumn(e.entity,o,this.groupingDesignStateService)&&r.push(this.createEditClusteringMenuItem()),r.length>0&&(this.menuItems.push(this.createSeparatorMenuItem()),(n=this.menuItems).push.apply(n,r))}var n},t.prototype.createConditionalFormattingMenuItem=function(){var t=d(this.property);return t.key={action:10},t.text=e.common.localize.get("FieldWell_ConditionalFormatting"),t},t.prototype.createRemoveConditionalFormattingMenuItem=function(){var t=d(this.property);return t.key={action:11},t.text=e.common.localize.get("FieldWell_RemoveConditionalFormatting"),t},t.prototype.createQuickCalcMenuItem=function(){var t=d(this.property);t.key={action:4};var i="FieldWell_QuickCalc";return t.text=e.common.localize.get(i),t},t.prototype.createGroupsMenuItem=function(){var t=d(this.property);return t.key={action:6},t.text=e.common.localize.get("ContextMenuItem_CreateGroups"),t},t.prototype.createEditGroupsMenuItem=function(){var t=d(this.property);return t.text=e.common.localize.get("ContextMenuItem_EditGroups"),t.key={action:7},t},t.prototype.createEditClusteringMenuItem=function(){var t=d(this.property);return t.text=e.common.localize.get("Clustering_EditClusters"),t.key={action:8},t},t.prototype.createRestoreHierarchyMenuItem=function(){var t=d(this.property);return t.text=e.common.localize.get("FieldWell_RestoreHierarchy"),t.key={action:9},t},t.prototype.createVariationMenuItem=function(e,t){var i=d(this.property);return i.text=e,i.key={action:5,variationExpr:t},i},t.prototype.createShowAllMenuItem=function(){var t=d(this.property);return t.key={action:3},t.text=e.common.localize.get("FieldWell_ShowAll"),t},t.prototype.createDeleteMenuItem=function(){var t=d(this.property);return t.key={action:0},t.text=e.common.localize.get("FieldWell_Remove"),t},t.prototype.createSeparatorMenuItem=function(){var e=d(this.property);return e.type=1,e},t})();i.createDropDownItems=p})(r=i.MenuItemFactory||(i.MenuItemFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r;!(function(r){function o(e,t,i){var r=i.promiseFactory.defer(),o=C.getDataRolesForVisual(e,i.visualPlugin);return _.isEmpty(o)?r.resolve([]):y.enumerateObjectRepetition(e.config.singleVisual,i.promiseFactory).then((function(n){r.resolve(a(e,t,o,n,r,i))}),(function(n){r.resolve(a(e,t,o,[],r,i))})),r}function n(e){if(!e)return[];for(var t=[],r=0,o=e;r<o.length;r++){var n=o[r];s(n)&&t.push(new i.FieldWellBucket(n.name,n.displayName?i.ViewModelFactory.getDisplayName(n.displayName):n.name,[],(!1),i.ViewModelFactory.getDisplayName(n.description)))}return t}function a(e,t,i,r,o,a){var s=n(i);return r=r||[],l(s,e,r,t,i,a),s}function s(t){var i=t.kind;return i===e.VisualDataRoleKind.Measure||i===e.VisualDataRoleKind.Grouping||i===e.VisualDataRoleKind.GroupingOrMeasure}function l(e,t,i,r,o,n){var a=t.config.singleVisual.query;if(a&&a.defn){var s=a.projections,l=v(e);for(var d in s){var h=l[d];if(h)for(var g=a.tryGetExprs(d),m=w.groupExprs(r,g),y=0,C=m;y<C.length;y++){var S=C[y],b=void 0;S.children||(b=f.findObjectRepetition(t.config.singleVisual,i,S.expr));var x={group:S,schema:r,displayNameService:n.displayName,roleName:d,dataRoles:o,bucket:h,visual:t,objectRepetition:b,featureSwitchService:n.featureSwitch};h.properties.push(u(x,n.aggrOps))}}p(e,t,n.visualPlugin,n.featureSwitch,n.geoTagging),c(e,t,n.aggrOps,r,o,n.featureSwitch,n.groupingDesignState)}}function c(e,t,r,o,n,a,s){for(var l=0,c=e;l<c.length;l++)for(var u=c[l],d=0,p=u.properties;d<p.length;d++){var v=p[d];v.dropDownItems=i.MenuItemFactory.createDropDownItems(v,u,g.findItemWithName(n,u.role),o,r,t.config.singleVisual,a,s),i.FieldWellViewModelOperations.updateSelectedMenuItems(v,t)}}function u(e,r){var o=t.util.ModelAuthoringUtility.validate(e.group.expr,e.schema,r),n=_.isEmpty(o);if(e.group.children)for(var a=0,s=e.group.children.length;n&&a<s;a++){var l=t.util.ModelAuthoringUtility.validate(e.group.children[a],e.schema,r);n=n&&_.isEmpty(l)}var c=new i.FieldWellProperty(e.group.expr,e.roleName,e.group.selectQueryIndex,e.group.selectQueryIndex+(e.group.children?e.group.children.length-1:0),(!1),e.displayNameService.getDisplayName(e.group.expr,e.schema),null,h(e.group.expr,e.schema,n,e.displayNameService),n,d(e),e.objectRepetition);return c}function d(e){var t=[];if(e.group.children)for(var r=0,o=e.group.children.length;r<o;r++){var n=e.group.children[r];t.push(new i.FieldWellHierarchyLevel(n,e.displayNameService.getDisplayName(n,e.schema)))}return t}function p(e,t,i,r,o){for(var n=i.capabilities(t.config.singleVisual.visualType),a=m.getDrillableRoles(n),s=C.getNumberRangesForRoles(t,i,o,r.featureSwitches.datetimeMinMaxSupported),l=0,c=e;l<c.length;l++){var u=c[l],d=s[u.role];u.supportsMultipleItems=_.contains(a,u.role)||!d||null==d.max||d.max>1;for(var p=0,v=u.properties;p<v.length;p++){var h=v[p];h.isReplaceable=!u.supportsMultipleItems}}}function v(e){for(var t={},i=0,r=e;i<r.length;i++){var o=r[i];t[o.role]=o}return t}function h(t,i,r,o){return r?o.getQualifiedDisplayName(t,i,{includeDefaultAggregate:!0}):e.common.localize.get("Invalid_FieldWellProperty_Tooltip")}var g=jsCommon.ArrayExtensions,f=t.util.ConditionalFormattingUtil,m=e.explore.util.DrillUtils,y=t.contracts.SingleVisualConfig,w=e.data.SQExprGroupUtils,C=e.explore.util.VisualContainerUtils;r.createBuckets=o,r.createEmptyBuckets=n})(r=i.FieldWellViewModelFactory||(i.FieldWellViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i;!(function(t){function i(e,t){var i=n.getAggregate(e.expr),o=void 0!==i,a=e.dropDownItems;if(a)for(var s=0,l=a.items;s<l.length;s++){var c=l[s],u=c.key;if(u)switch(u.action){case 2:c.checked=o&&u.aggregate===i;break;case 1:c.checked=!o;break;case 3:c.checked=t.config.singleVisual.query.projections[e.role].showAll;break;case 5:c.checked=r(e,c.text);break;default:c.checked=!1}}}function r(e,t){var i=o(e);if(i)return i.hierarchy===t;var r=a.asFieldPattern(e.expr);return!!r&&(r.columnAggr?r.columnAggr.name===t:r.groupingColumnAggr?r.groupingColumnAggr.name===t:r.column?r.column.name===t:!!r.groupingColumn&&r.groupingColumn.name===t)}function o(e){if(!_.isEmpty(e.hierarchyLevels)){var t=e.hierarchyLevels[0],i=t.expr;return i.arg}}var n=e.data.FieldExprPattern,a=e.data.SQExprConverter;e.data.SQHierarchyExpr;t.updateSelectedMenuItems=i})(i=t.FieldWellViewModelOperations||(t.FieldWellViewModelOperations={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t;!(function(e){e.filterChanged={name:"filterChanged"}})(t=e.FilterEvents||(e.FilterEvents={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=t.contracts.FilterType,o=e.data.SQExprUtils,n=e.explore.util.VisualContainerUtils,a=(function(i){function a(e,t){i.call(this,e,{expanded:!1,canToggleSingleSelect:!1,availableTypes:[],type:e.type}),this.id=a.counter++,this.restatement="",this.displayName="",this.containerScope=t,this.howCreated=0}return __extends(a,i),a.prototype.setServices=function(e,t){this.visualHostServices=e,this.visualPlugin=t},a.prototype.isInvalid=function(){return this.invalid},Object.defineProperty(a.prototype,"isVisualFilter",{get:function(){return this.containerScope&&0===this.containerScope.scopeType},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hasDefaultValue",{get:function(){return void 0!==this.defaultValue&&1===this.howCreated},enumerable:!0,configurable:!0}),a.prototype.getFilterContainerScope=function(){return this.containerScope},Object.defineProperty(a.prototype,"visualContainer",{get:function(){if(this.isVisualFilter)return this.containerScope.container},enumerable:!0,configurable:!0}),a.prototype.updateFilterProperties=function(e,i,r){if(this.contract.expression){var a=this.contract.expression;this.isMeasure=o.isMeasure(a),this.discourageAggregation=o.discourageAggregation(a,e),this.valueType=t.FilterUtils.getValueType(a,e),this.formatter=t.FilterUtils.getFormatter(a,e),this.defaultValue=o.getDefaultValue(a,e),1===o.getAggregateBehavior(a,e)&&(this.isSingleSelectionRequired=!0,this.disableSelectionModeToggle=!0)}var s=this.containerScope.container;this.hasGroupingScope=s&&n.hasGrouping(s,e),this.invalid=!_.isEmpty(t.FilterUtils.validate(this.contract,e,r)),this.disabled=t.FilterUtils.shouldDisableFilter(this.contract,e,s,r,i)},a.prototype.switchType=function(e){this.contract.type=e},a.prototype.canVisualize=function(){var e=this.contract;return e.expression&&e.type!==r.Passthrough&&!this.isMeasure},a.prototype.updateViewStateCore=function(t){var i=this.contract,o=!this.invalid;if(t.disabled=this.disabled,t.expanded=i.expanded&&o,t.invalid=!o,_.any(this.availableTypes,(function(e){return e.type===r.Categorical}))&&!t.visual&&i.config){var n=i.config.singleVisual;n&&this.visualHostServices&&this.visualPlugin&&(t.visual={viewport:a.DefaultVisualViewPort,type:e.visuals.plugins.slicer.name,dataTransforms:{objects:n.objects},hostServices:this.visualHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin})}t.canToggleSingleSelect=!!(!t.disabled&&this.isPodEnabled()&&t.expanded&&t.visual&&t.visual.data)},a.prototype.updateAvailableTypes=function(){var t=this,i=this.contract.type;if(i===r.Passthrough)return void(this.availableTypes=[]);var o=[];this.valueType&&!this.valueType.bool&&o.push({type:r.Advanced,label:e.common.localize.get("FilterPane_Advanced")}),this.isMeasure||(o.push({type:r.Categorical,label:e.common.localize.get("FilterPane_Basic")}),this.isVisualFilter&&o.push({type:r.TopN,label:e.common.localize.get("FilterPane_TopN")})),this.availableTypes=o,this.cardType=_.find(o,(function(e){return e.type===t.contract.type}))},a.prototype.isPodEnabled=function(){return this.containerScope&&1===this.containerScope.scopeType&&t.FilterUtils.isCategoricalFilter(this.contract.type)},a.DefaultVisualViewPort={width:146,height:180},a.counter=0,a})(i.ViewModel);i.FilterViewModel=a})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.data.FieldExprPattern,n=t.contracts.FilterType,a=e.data.SQExprConverter;!(function(r){function s(e,t,r,o,a,s,l){var c;switch(e.type){case n.TopN:c=v(e,o,t,a,s,r,l);break;case n.Advanced:case n.Categorical:c=p(e,o,t,r,l);break;case n.Passthrough:c=d(e,o);break;case n.Include:case n.Exclude:c=new i.FilterViewModel(e,o);break;default:c=v(e,o,t,a,s,r,l)||p(e,o,t,r,l)||d(e,o)}return c.howCreated=e.howCreated,c.updateFilterProperties(t,a,s),c}function l(e){var t;if(e.filter){var r=e.filter.conditions(),o=r[0];o&&(t=i.FilterCardConverter.createAdvFilter(o,null,e.expression))}return!t&&e.expression&&(t=new i.AdvFilterCard(e.expression)),t}function c(e,t,i,r){var n=a.asFieldPattern(e),s={includeVariationSource:!0};return i.getDisplayName(e,t,s,r)||(n?o.getFieldExprName(n):void 0)}function u(e,t,i){return i.getQualifiedDisplayName(e,t)}function d(e,t){var r=new i.FilterViewModel(e,t);return null==e.type&&(e.type=n.Passthrough),r.restatement=e.restatement,r}function p(e,r,o,a,s,d){var p=l(e);if(p){e.expression||(e.expression=p.field),null==e.type&&(e.type=t.FilterUtils.getDefaultFilterType(e.expression,o)),null==e.type&&(e.type=n.Categorical);var v=e.expression,h=new i.FilterViewModel(e,r);return h.displayName=c(v,o,a,s),h.tooltip=u(v,o,a),h}}function v(t,r,o,a,s,l,d){var p=e.data.TopNFilterPattern.extractParametersFromFilter(t.filter);if(p){null==t.type&&(t.type=n.TopN);var v=new i.FilterViewModel(t,r);return v.displayName=c(p.fieldBeingFiltered,o,l,d),v.tooltip=u(p.fieldBeingFiltered,o,l),v}if(t.type===n.TopN&&t.expression){var v=new i.FilterViewModel(t,r);return v.displayName=c(t.expression,o,l,d),v.tooltip=u(t.expression,o,l),v}}r.convertFilterContainer=s,r.extractAdvFilterCard=l})(r=i.FilterViewModelFactory||(i.FilterViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){!(function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.Custom=3]="Custom"})(e.EmbedSize||(e.EmbedSize={}));e.EmbedSize;e.EmbedSizes={small:{height:510,width:680},medium:{height:600,width:800},large:{height:700,width:933}}})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r,o=e.common.models.ApplyStyle,n=jsCommon.ArrayExtensions,a=e.visuals.plugins,s=e.data.SQExpr,l=e.data.SQExprUtils,c=jsCommon.StringExtensions,u=e.explore.util.VisualContainerUtils;!(function(r){function d(){return{exploration:null,options:null,taskPane:v(),visualizationPane:h(),sectionStatus:{currentSectionNumber:-1,isEditing:!1},isNavPaneCollapsed:!0}}function p(e){return{contract:e,selected:!1,displayName:e.displayName,menuItems:i.ExplorationContainerViewModelFactory.createNavigationMenuItems()}}function v(){return{isPaneExpanded:!0}}function h(){return{sections:[],activeSection:0,pagePaneSections:[],activePageSection:0,isPaneExpanded:!1}}function g(e){return{visuals:e}}function f(e){var t=_.filter(e,(function(e){return e.custom}));return m(t)}function m(t,i,r){for(var o=[],n=e.common.localize,s=0,l=t;s<l.length;s++){var c=l[s];if(c&&(!r||c.name!==e.visualHost.EsriVisual)){var u={plugin:c,enabled:!0,active:!1,menuItems:[],requiresConsent:!1};switch(c.name){case a.table.name:u.class="table",u.title=n.get("Table_ToolTip");break;case a.matrix.name:u.class="matrix",u.title=n.get("Matrix_ToolTip");break;case a.scatterChart.name:u.class="scatterChart",u.title=n.get("ScatterChart_ToolTip");break;case a.barChart.name:u.class="barChart",u.title=n.get("BarChart_ToolTip");break;case a.clusteredBarChart.name:u.class="clusteredBarChart",u.title=n.get("ClusteredBarChart_ToolTip");break;case a.hundredPercentStackedBarChart.name:u.class="hundredPercentStackedBarChart",u.title=n.get("HundredPercentStackedBarChart_ToolTip");
break;case a.columnChart.name:u.class="columnChart",u.title=n.get("ColumnChart_ToolTip");break;case a.clusteredColumnChart.name:u.class="clusteredColumnChart",u.title=n.get("ClusteredColumnChart_ToolTip");break;case a.dataDotClusteredColumnComboChart.name:u.class="dataDotClusteredColumnComboChart",u.title=n.get("DataDotClusteredColumnComboChart_ToolTip");break;case a.dataDotStackedColumnComboChart.name:u.class="dataDotStackedColumnComboChart",u.title=n.get("DataDotStackedColumnComboChart_ToolTip");break;case a.hundredPercentStackedColumnChart.name:u.class="hundredPercentStackedColumnChart",u.title=n.get("HundredPercentStackedColumnChart_ToolTip");break;case a.realTimeLineChart.name:case a.lineChart.name:u.class="lineChart",u.title=n.get("LineChart_ToolTip");break;case a.areaChart.name:u.class="areaChart",u.title=n.get("AreaChart_ToolTip");break;case a.stackedAreaChart.name:u.class="stackedAreaChart",u.title=n.get("StackedAreaChart_ToolTip");break;case a.lineClusteredColumnComboChart.name:u.class="lineClusteredColumnComboChart",u.title=n.get("LineClusteredColumnComboChart_ToolTip");break;case a.lineStackedColumnComboChart.name:u.class="lineStackedColumnComboChart",u.title=n.get("LineStackedColumnComboChart_ToolTip");break;case a.pieChart.name:u.class="pieChart",u.title=n.get("PieChart_ToolTip");break;case a.treemap.name:u.class="treemap",u.title=n.get("Treemap_ToolTip");break;case a.sunburst.name:u.class="sunburst",u.title=n.get("Sunburst_ToolTip");break;case a.map.name:u.class="map",u.title=n.get("Map_ToolTip");break;case a.filledMap.name:u.class="filledMap",u.title=n.get("FilledMap_ToolTip");break;case a.shapeMap.name:u.class="shapeMap",u.title=n.get("ShapeMap_ToolTip");break;case a.funnel.name:u.class="funnel",u.title=n.get("Funnel_ToolTip");break;case a.gauge.name:u.class="gauge",u.title=n.get("Gauge_ToolTip");break;case a.multiRowCard.name:u.class="multiRowCard",u.title=n.get("MultiRowCard_ToolTip");break;case a.card.name:u.class="card",u.title=n.get("Card_ToolTip");break;case a.waterfallChart.name:u.class="waterfallChart",u.title=n.get("WaterfallChart_ToolTip");break;case a.slicer.name:u.class="slicer",u.title=n.get("Slicer_ToolTip");break;case a.donutChart.name:u.class="donutChart",u.title=n.get("DonutChart_ToolTip");break;case a.kpi.name:u.class="kpi",u.title=n.get("kpi_Tooltip");break;case a.scriptVisual.name:u.class="scriptVisual",u.title=n.get("ScriptVisual_ToolTip");break;case a.realTimeLineChart.name:u.class="lineChart",u.title=n.get("LineChart_ToolTip");break;case a.debugVisual.name:u.class="debugVisual",u.title=n.get("DebugVisual_ToolTip");break;case e.visualHost.EsriVisual:u.class="esriVisual",u.plugin.watermarkKey="map",u.title=n.get("EsriVisual_ToolTip"),u.requiresConsent=!i;break;default:a.pivotTable&&c.name===a.pivotTable.name?(u.class="matrix",u.title=n.get("PivotTable_ToolTip")):(u.class=c.class,u.title=c.name)}if(c.custom){u.title=c.displayName||c.name.match(/([A-z]+)/g)[0];var d=y(n.get("DeleteVisual_ContextMenu"),0);u.menuItems.push(d)}o.push(u)}}return o}function y(e,t){return{text:e,hasGlyph:!1,labelClass:"visualContextMenu itemLabel",action:t,type:DropDownMenuItemType.Item,checked:!1,hrefTarget:jsCommon.DOMConstants.selfValue}}function w(e,t,i){i.hostServices={deleteVisualRelationships:function(e,i){return i.deleteVisualRelationships(t,e)},getFilters:function(r,o){return r.calculateVisualContainerFilter(e,t,i.contract,o)},getVisualRelationshipFilterAction:function(e,r,o){return r.getVisualRelationshipFilterAction(t,e,i.contract,o)},selectDataPoint:function(e,r){e.setFilterOnSelectData(r,t,i.contract)},setVisualRelationshipFilterAction:function(e,i,r,o){return o.setVisualRelationship(t,e,i,r)},clearHighlight:function(e){e.clearCrossHighlight(t)}}}function C(e,t,i){var r=_.map(e.sections,p),o=e.sections,n=void 0;if(o&&o.length>0){var a=void 0!==i?i:0;if(a<o.length){n=S(e,o[a],t);for(var s=o.length-1;s>=0;--s)r[s].selected=s===a}}return{contract:e,sections:r,exploreCanvas:n}}function S(e,t,r){var o=new i.ExploreCanvas(t,r);if(t.visualContainers&&(o.visualContainers=n.extendWithId(_(t.visualContainers).map((function(e){return b(e,r)})).filter((function(e){return!!e})).value()),!_.isEmpty(o.visualContainers)))for(var a=o.visualContainers,s=0,l=a;s<l.length;s++){var c=l[s];w(e,t,c)}return o}function b(e,t){void 0===t&&(t=0);var r=new o,n=e.layouts.withId(t);if(n){var a=n.position;return r.position({y:a.y,x:a.x}),r.zIndex(a.z||0),r.viewport({height:a.height,width:a.width}),new i.VisualContainer(e,r,t)}}function x(e,t,i,r){var o=b(i,r);if(o)return w(e,t,o),o}function D(t){return e.data.getDisplayName(t,e.common.localize)}function M(){return{schema:null,isLoaded:!1}}function E(){return new i.FieldWell([])}function F(t){return void 0===t&&(t=!0),{isVisualVisible:!1,reportFilters:t?[]:null,pageFilters:[],visualFilters:[],activeFilterPane:void 0,addFilterLabel:e.common.localize.get("FieldDropZone_Watermark")}}function V(e,r,o,n,a,c,d){var p=e.filters||[],v=[];if(!t.FilterUtils.shouldCreateVisualFilters(e,n,a))return v;var h,g={container:e,scopeType:0},f=u.getSelectExprs(e);f&&(h=_.map(f,(function(e){return e.expr})));for(var m=0,y=p;m<y.length;m++){var w=y[m],C=i.FilterViewModelFactory.convertFilterContainer(w,r,o,g,n,c,d);if(v.push(C),h){var S=w.expression?l.indexOfExpr(h,w.expression):-1;S===-1?0===w.howCreated&&(C.howCreated=w.howCreated=1):(1===w.howCreated&&(C.howCreated=w.howCreated=0),h.splice(S,1))}}if(h)for(var b=0,x=h;b<x.length;b++){var D=x[b];if(!s.isTransformOutputRoleRef(D)&&_.isEmpty(D.validate(r,c))){var M={name:void 0,expression:D,expanded:!1,howCreated:0,type:t.FilterUtils.getDefaultFilterType(D,r)},C=i.FilterViewModelFactory.convertFilterContainer(M,r,o,g,n,c,d);C.howCreated=M.howCreated,v.push(C)}}return v.sort(N),v}function P(t,r,o,n,a,s){var l=[];if(!t||!t.container||!t.container.filters)return l;for(var c=0,u=t.container.filters;c<u.length;c++){var d=u[c];d.name||(d.name=e.explore.FilterUtils.getNextFilterName(t.container.filters));var p=i.FilterViewModelFactory.convertFilterContainer(d,r,o,t,n,a,s);l.push(p)}return l.sort(N),l}function I(r,o,n,a,s,l){var c={name:i.EmbedSizes.medium.width+" x "+i.EmbedSizes.medium.height+" px",value:i.EmbedSize.Medium},u=r.get("Embed_CopyEmbedCode"),d=r.get("Embed_DeleteReportSnapshot"),v=[{name:r.get("Embed_EmbedType_Interactive"),value:t.contracts.EmbedType.Interactive},{name:r.get("Embed_EmbedType_Static"),value:t.contracts.EmbedType.Static}],h={currentEmbed:a,exploration:n,embedTab:{embed:A(a),sections:_.map(l,p),selectedSection:null,selectedEmbedSize:c,sizes:[{name:i.EmbedSizes.small.width+" x "+i.EmbedSizes.small.height+" px",value:i.EmbedSize.Small},c,{name:i.EmbedSizes.large.width+" x "+i.EmbedSizes.large.height+" px",value:i.EmbedSize.Large}],embedTypes:v,selectedEmbedType:v[0],edit:!1,generating:!1,disabled:!1,nameError:"",sizeError:"",error:{exist:!1,showDetails:!1}},embeddedInTab:{embeds:[],loaded:!1,localizedCopyEmbedCodeTitle:u,localizedDeleteReportSnapshotTitle:d},viewModeState:0,publishState:0},g=r.get("Embed_EntireReport");return h.embedTab.sections.push({displayName:g,contract:{id:-1,displayName:g,name:g,size:{displayOption:0,width:e.explore.constants.ExploreCanvasConstants.DefaultCanvasWidth,height:e.explore.constants.ExploreCanvasConstants.DefaultCanvasHeight},visualContainers:[]},selected:!1}),s.then((function(e){for(var t=0;t<e.length;t++)h.embeddedInTab.embeds.push(A(e[t]));if(h.embeddedInTab.loaded=!0,e.length>0){var r=e[0];r.size.height=i.EmbedSizes.medium.height,r.size.width=i.EmbedSizes.medium.width,h.currentEmbed=r;var n=A(r);n.embedCode=o.createEmbedCode(r),n.link=o.createEmbedUri(r),h.embedTab.embed=n,h.publishState=4}else h.publishState=1})),h}function T(e,t){var r={name:i.EmbedSizes.medium.width+" x "+i.EmbedSizes.medium.height+" px",value:i.EmbedSize.Medium},o={currentEmbed:t,exploration:e,embedTab:{embed:A(t),sections:null,selectedSection:null,selectedEmbedSize:r,sizes:void 0,embedTypes:null,selectedEmbedType:null,edit:!1,generating:!1,disabled:!1,nameError:"",sizeError:"",error:{exist:!1,showDetails:!1}},embeddedInTab:void 0,viewModeState:0,publishState:5};return o}function A(e){return{contract:e,showCode:!1,deleteRequest:!1,deleteConfirm:!1,refreshingData:!1,embedCode:"",enableShareLink:!0,error:{exist:!1,showDetails:!1}}}function k(e){var t=_.map(e,(function(e){return c.replaceAll(e,L,R)}));return t.join(L)}function N(e,t){var i=e.displayName?-1:1,r=t.displayName?-1:1;if(i!==r)return i-r;var o=e.displayName||e.restatement||"",n=t.displayName||t.restatement||"";return o.localeCompare(n)}var L="-",R="\\"+L;r.createExplorationContainer=d,r.convertSectionToViewModel=p,r.createTaskPane=v,r.createVisualizationPane=h,r.createVisualTypesContainer=g,r.getCustomVisualTypes=f,r.getAvailableVisualTypes=m,r.convertExploration=C,r.convertSectionToExploreCanvas=S,r.convertVisualContainerStandalone=b,r.convertVisualContainer=x,r.getDisplayName=D,r.createFieldList=M,r.createFieldWell=E,r.createFilterPane=F,r.createVisualFilters=V,r.createFilters=P,r.createEmbedModalDialog=I,r.createSharepointEmbedModalDialog=T,r.createEmbed=A,r.createUniqueId=k})(r=i.ViewModelFactory||(i.ViewModelFactory={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){var i=(function(){function t(e){e&&(this.color=e.color,this.visible=e.show)}return Object.defineProperty(t.prototype,"thickness",{get:function(){return t.Width},enumerable:!0,configurable:!0}),t.prototype.getBorderStyle=function(){if(this.visible)return t.Width+"px "+t.Style+" "+e.common.utils.ColorUtility.hexToRGBString(this.color)},t})();t.VisualBorder=i;var i;!(function(e){function t(){return{color:e.DefaultColor,show:e.DefaultShow}}e.Width=1,e.Style="solid",e.DefaultColor="#000",e.DefaultShow=!1,e.getDefaultValues=t})(i=t.VisualBorder||(t.VisualBorder={}))})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){var r=jsCommon.CssConstants,o=t.util.DetailVisualUtils,n=jsCommon.KeyUtils,a=e.explore.util.VisualContainerUtils,s=(function(s){function l(e,t,i){s.call(this,e,{style:t,titleStyle:null,visualViewportStyle:null,popOutBarTitle:"",popOutBarSubtitle:""}),this.uiScale={x:1,y:1},this.availableVisuals=[],this.toolbarViewModel={visible:!1,$element:null,update:_.noop},this.currentCanvasLayout=i}return __extends(l,s),l.getVisualBodyOffset=function(e){return e.canShowVisualContainerHeaderInset()?{top:0,height:0,width:0,left:0}:{top:this.VisualContainerHeaderHeight,height:-this.VisualContainerHeaderHeight,width:0,left:0}},Object.defineProperty(l.prototype,"id",{get:function(){return this.contract.id},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"position",{get:function(){var e=this.currentCanvasLayout;return this.contract.layouts.withId(e).position},set:function(e){var t=this.currentCanvasLayout,i=this.contract.layouts.withId(t);i.position=e},enumerable:!0,configurable:!0}),l.prototype.getScaledPosition=function(){return this.convertToScaledPosition(this.position)},l.prototype.setScaledPosition=function(e){this.position=this.convertToUnscaledPosition(e)},Object.defineProperty(l.prototype,"isPositioned",{get:function(){var e=this.position;return 0!==e.width&&0!==e.height},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isPoppedOut",{get:function(){return null!=this.contract.popOutMode&&0!==this.contract.popOutMode},enumerable:!0,configurable:!0}),l.prototype.visualTitleVisible=function(){var e=this.contract.config.singleVisual.title||this.visualTitle;return void 0!==this.visualTitle&&e&&!t.contracts.VisualTitle.isHidden(e)&&!this.isPoppedOut&&!_.isEmpty(this.visualTitle.text)&&!this.viewModeState.getConfig().displayOptions.hideVisualBodyTitle},l.prototype.setServices=function(e,t,i,r,o){this.visualHostServices=e,this.visualAdapterHostServices=o,this.visualPlugin=t,this.viewModeState=i,this.formFactor=r},l.prototype.setSelected=function(e){this.isSelected=e},l.prototype.handleKeyDown=function(t){var i=this.contract.config.singleVisual.visualType;if(i===e.visuals.plugins.textbox.name&&!n.isArrowKey(t.keyCode)&&!n.isNudgeModifierKey(t.keyCode)){var r=this.readOnlyState.visual.visual,o=r.unwrap?r.unwrap():r;return o.focus()}},l.prototype.setVisualTitle=function(e){this.visualTitle=e;var t="",i="";e&&(e.titleComponents&&e.titleComponents.title?t=e.titleComponents.title:e.text&&(t=e.text),e.titleComponents&&e.titleComponents.subtitle&&(i=e.titleComponents.subtitle)),this.readOnlyState.popOutBarTitle=t,this.readOnlyState.popOutBarSubtitle=i},l.prototype.updateVisualViewportForUserResize=function(e){var t=this.readOnlyState.visual;this.enableVisualScaling?(e.width/=this.uiScale.x,this.visualBorder&&(e.width-=2*this.visualBorder.thickness),e.height-=l.VisualContainerHeaderHeight,e.height/=this.uiScale.y,this.visualBorder&&(e.height-=2*this.visualBorder.thickness)):e.height-=l.VisualContainerHeaderHeight;var i=this.getVisualViewport(e.width,e.height);t&&this.updateVisualViewPort(t,i),this.hasDetailVisual()&&this.updateVisualViewPort(this.readOnlyState.detailVisual.visual,i),this.applyVisualBodyStyle(this.readOnlyState,e)},l.prototype.shouldUseCache=function(){return this.contract.id&&!this.options.disableQueryCacheUpdates},l.prototype.adjustForVisualContainerHeader=function(e,t){this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()||(e.y+=t,e.height-=t)},l.prototype.convertToScaledPosition=function(e){var i=t.util.CanvasVisualsUtility.convertToScaledPosition(e,this.uiScale,!0);return this.adjustForVisualContainerHeader(i,-l.VisualContainerHeaderHeight),i},l.prototype.convertToUnscaledPosition=function(e){this.adjustForVisualContainerHeader(e,+l.VisualContainerHeaderHeight);var i=t.util.CanvasVisualsUtility.convertFromScaledPosition(e,this.uiScale);return i},l.prototype.updateViewStateCore=function(t){var r=this.contract,n=this.position,s=this.overridePosition||this.convertToScaledPosition(n),c=e.Prototype.inherit(s);if(this.enableVisualScaling?this.overridePosition?(c.height-=l.VisualContainerHeaderHeight,c.height/=this.uiScale.y,c.width/=this.uiScale.x):(c=e.Prototype.inherit(n),this.formFactor&&this.formFactor.getCurrentLayoutCapabilities().canShowVisualContainerHeaderInset()&&(c.height-=l.VisualContainerHeaderHeight/this.uiScale.y)):c.height-=l.VisualContainerHeaderHeight,this.visualBorder&&(c.width-=2*this.visualBorder.thickness,c.height-=2*this.visualBorder.thickness),this.isPoppedOut&&(!this.options||!this.options.hideHeader)){var u=i.VisualContainer.PopOutBarHeight;this.enableVisualScaling&&(u/=this.uiScale.y),c.height-=u}var d=this.getVisualViewport(c.width,c.height),p=r.config.singleVisual;if(p){if(p.query){var v=p.query.defn;if(v){var h=v.orderBy();t.actualSortDirection=h&&h.length?h[0].direction:void 0}this.showWatermark=!1}else{var g=p.visualType;"debugVisual"===g?this.showWatermark=!1:this.visualPlugin&&a.isQueryVisual(g,this.visualPlugin)&&(this.showWatermark=!0)}t.visual?(t.visual.type!==p.visualType&&(t.visual.data=null),t.visual.type=p.visualType,t.visual.stylePresetName=p.stylePresetName):this.visualHostServices&&(t.visual={viewport:d,type:p.visualType,dataTransforms:{objects:p.objects},hostServices:this.visualHostServices,visualAdapterHostServices:this.visualAdapterHostServices,interactivityOptions:{dragDataPoint:!1,selection:!0},allowInvalidDataView:!0,visualPlugin:this.visualPlugin,themeName:this.themeName}),this.hasDetailVisual()?t.detailVisual||(t.detailVisual={parentContract:this.contract,visual:{viewport:o.getDetailVisualViewport(d,this.contract.detailVisualLayout),themeName:this.themeName,allowInvalidDataView:!0,hostServices:null},hasData:!1}):t.detailVisual=null,this.setViewport(t,d)}t.style.position({x:s.x,y:s.y}),t.style.viewport({width:s.width,height:s.height}),null==this.zIndexOverride?t.style.zIndex(n.z||0):t.style.zIndex(this.zIndexOverride),t.style.rotate(n.angle||0),t.style.apply(),this.applyTitleStyle(t),this.applyVisualBodyStyle(t,c),this.toolbarViewModel.update(),this.availableVisuals=this.visualPlugin?this.visualPlugin.getVisuals():[]},l.prototype.getAdjustedVisualScale=function(){var e=this.getScaledPosition(),t=this.position.width;return e.width/t},l.prototype.applyVisualBodyStyle=function(t,i){var r=this.getAdjustedVisualScale();t.visualViewportStyle||(t.visualViewportStyle=new e.common.models.ApplyStyle);var o=a.getVisualStyleAttributes(i,this.enableVisualScaling?r:void 0,this.visualBackground&&this.visualBackground.colorRGB,this.visualBorder&&this.visualBorder.getBorderStyle());t.visualViewportStyle.addAttributes(o),t.visualViewportStyle.apply()},l.prototype.applyTitleStyle=function(t){var i={};if(this.visualTitleVisible()){i[r.visibilityProperty]=r.visibleValue;var o=this.contract.config.singleVisual.title;if(o){i[r.textAlignProperty]=o.alignment?o.alignment:"",i[r.backgroundColorProperty]=o.background?o.background:"",i[r.colorProperty]=o.fontColor?o.fontColor:"";var n=a.getTitleFontSize(o);i[r.fontSizeProperty]=n,i[r.heightProperty]=a.getTitleHeight(o)}}else i[r.visibilityProperty]=r.hiddenValue;t.titleStyle||(t.titleStyle=new e.common.models.ApplyStyle),t.titleStyle.addAttributes(i),t.titleStyle.apply()},l.prototype.setViewport=function(e,t){e.visual&&this.setVisualViewport(e.visual,t),this.hasDetailVisual()&&this.setVisualViewport(e.detailVisual.visual,o.getDetailVisualViewport(t,this.contract.detailVisualLayout))},l.prototype.setVisualViewport=function(e,t){e&&t&&(e.viewport.height===t.height&&e.viewport.width===t.width||(e.viewport=t))},l.prototype.getVisualViewport=function(e,t){var r=this.isPaddingDisabled?0:i.VisualContainer.VisualContainerPaddingRight+i.VisualContainer.VisualContainerPaddingLeft,o=this.isPaddingDisabled?0:i.VisualContainer.VisualContainerPaddingTop+i.VisualContainer.VisualContainerPaddingBottom,n=0;this.visualTitleVisible()&&(n=a.getTitleHeight(this.contract.config.singleVisual.title));var s=e-r,l=t-o-n;if(this.hasDetailVisual()){var c=this.contract.detailVisualLayout||1;1===c?(l-=o,l/=2):(s-=r,s/=2)}return{width:Math.max(s,0),height:Math.max(l,0)}},l.prototype.updateVisualViewPort=function(t,i){if(t&&i){var r=t.visual;r&&r.update({viewport:i,suppressAnimations:!0,dataViews:t.dataViews,type:e.VisualUpdateType.Resize,resizeMode:1,viewMode:this.visualHostServices.getViewMode()})}},l.prototype.hasDetailVisual=function(){return 2===this.contract.popOutMode},l.VisualContainerHeaderHeight=20,l.VisualContainerPaddingTop=5,l.VisualContainerPaddingRight=5,l.VisualContainerPaddingBottom=5,l.VisualContainerPaddingLeft=5,l.PopOutBarHeight=40,l})(i.ViewModel);i.VisualContainer=s})(i=t.viewModels||(t.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){var t,i=jsCommon.DOMConstants,r=jsCommon.EnumExtensions,o="disabled";!(function(e){function t(e,t){var i=[],o=r.hasFlag(e.drillDirections,4),l=r.hasFlag(e.drillDirections,2),c=o||l,u=r.hasFlag(e.drillDirections,1),d=e.canDrillToDetails,p=e.canSeeData,v=e.enableGroupAuthoring,h=e.enableIncludeExclude;return c&&i.push(n("DrillDown",1,t)),d&&i.push(n("DrillToDetails",4,t)),c&&(i.push(s()),o&&i.push(n("DrillDownLevel",2,t)),l&&i.push(n("DrillDownLevelGrouped",3,t))),u&&(c||_.isEmpty(i)||i.push(s()),i.push(n("DrillUp",0,t))),p&&(_.isEmpty(i)||i.push(s()),i.push(n("VisualContainer_SeeData_Enable",5,t))),v&&!_.isEmpty(i)&&i.push(s()),v&&i.push(n("VisualContainer_Group",6,t)),h&&(_.isEmpty(i)||i.push(s()),i.push(n("VisualContainer_ContextMenu_Include",7,t)),i.push(n("VisualContainer_ContextMenu_Exclude",8,t))),_.isEmpty(i)&&i.push(a("VisualContainer_ContextMenu_NoAvailableActions",t)),i}function n(e,t,r){return{text:r.get(e),action:t,labelClass:"itemLabel",type:DropDownMenuItemType.Item,hrefTarget:i.selfValue}}function a(e,t){var i=n(e,null,t);return i.dropdownItemClass=o,i.type=DropDownMenuItemType.Title,i}function s(){return{action:null,labelClass:"itemLabel",type:DropDownMenuItemType.Separator}}e.createMenuItems=t})(t=e.VisualContainerContextMenuViewModelFactory||(e.VisualContainerContextMenuViewModelFactory={}))})(t=e.viewModels||(e.viewModels={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,s){return new a(e,t,i,r,o,n,s)}function o(e,t,i){var r=_.find(t.visualContainers,(function(e){return e.contract===i}));r&&(_.remove(i.layouts,(function(t){return t.id===e})),_.pull(t.visualContainers,r))}var n=e.telemetry;i.createLayoutAuthoring=r;var a=(function(){function e(e,t,i,r,o,n,a){this.explorationSerializer=e,this.telemetryService=t,this.eventBridge=i,this.undoRedoService=r,this.explorationNavigation=o,this.formfactorProvider=n,this.selectionService=a}return e.prototype.addLayoutToVisualContainer=function(e,r,o){var n=this;this.undoRedoService.register("AddLayoutToVisualContainer",(function(){var a=n.formfactorProvider.getCurrentLayout();r.layouts.push({id:a,position:o});var s=t.viewModels.ViewModelFactory.convertVisualContainer(n.explorationNavigation.getCurrentExploration(),e.contract,r,a);e.visualContainers.push(s),n.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.removeLayoutFromSelectedVisuals=function(e){var t=this;this.undoRedoService.register("RemoveLayoutFromSelectedVisuals",(function(){for(var r=_.map(t.selectionService.getSelectedElements(),(function(e){return e.visualContainer})),n=t.formfactorProvider.getCurrentLayout(),a=0,s=r;a<s.length;a++){var l=s[a];o(n,e,l)}t.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.removeLayoutFromVisualContainer=function(e,t){var r=this;this.undoRedoService.register("RemoveLayoutFromVisualContainer",(function(){var n=r.formfactorProvider.getCurrentLayout();o(n,e,t),r.eventBridge.publishToChannel(i.events.canvasChanged)}))},e.prototype.updateSectionPenAnnotations=function(e,t){e.penAnnotations=t},e.prototype.updateExplorationActiveSectionIndex=function(e,i,r){var o=t.SectionUtils.findSectionIndexForSectionName(e,i);o&&e&&e.sections&&e.sections[o].transient||(e.activeSectionIndex=o,this.telemetryService.logEvent(n.ExploreHostChangeReportPage,e.reportId,r,o))},e.prototype.moveVisualContainer=function(e,t){e.position=t,e.updateViewState();var r=e.contract;this.eventBridge.publishToChannel(i.events.visualContainerPositionChanged,{affectContainer:function(e){return e===r}})},e.prototype.moveVisualContainersHelper=function(e,t){for(var i=0,r=e;i<r.length;i++){var o=r[i],n=o.position;t(n),this.moveVisualContainer(o,n)}},e.prototype.alignSelectedVisuals=function(e,t,i){1===i.length?this.alignSingleVisualContainer(e,t,i[0]):this.alignMultipleVisualContainers(e,t,i)},e.prototype.alignMultipleVisualContainers=function(t,i,r){var o=this;this.undoRedoService.register("AlignMultipleVisualContainers",(function(){var n=_.map(r,(function(e){return e.position}));switch(t){case 3:var a=_.min(_.map(n,(function(e){return e.y})));o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(a,t.height,i)}));break;case 4:var s=_.sum(n,(function(e){return e.y+e.height/2})),l=s/n.length;o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(l-t.height/2,t.height,i)}));break;case 5:var c=_.max(_.map(n,(function(e){return e.y+e.height})));o.moveVisualContainersHelper(r,(function(t){return t.y=e.clampYValue(c-t.height,t.height,i)}));break;case 0:var u=_.min(_.map(n,(function(e){return e.x})));o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(u,t.width,i)}));break;case 1:var d=_.sum(n,(function(e){return e.x+e.width/2})),p=d/n.length;o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(p-t.width/2,t.width,i)}));break;case 2:var v=_.max(_.map(n,(function(e){return e.x+e.width})));o.moveVisualContainersHelper(r,(function(t){return t.x=e.clampXValue(v-t.width,t.width,i)}));break;case 6:o.distributeSpace(r,n,!0);break;case 7:o.distributeSpace(r,n,!1)}}))},e.prototype.alignSingleVisualContainer=function(e,t,i){var r=this;this.undoRedoService.register("AlignSingleVisualContainer",(function(){var o=i.position;switch(e){case 3:r.moveVisualContainersHelper([i],(function(e){return e.y=0}));break;case 4:case 7:var n=t.height/2-o.height/2;r.moveVisualContainersHelper([i],(function(e){return e.y=n}));break;case 5:var a=t.height-o.height;r.moveVisualContainersHelper([i],(function(e){return e.y=a}));break;case 0:r.moveVisualContainersHelper([i],(function(e){return e.x=0}));break;case 1:case 6:var s=t.width/2-o.width/2;r.moveVisualContainersHelper([i],(function(e){return e.x=s}));break;case 2:var l=t.width-o.width;r.moveVisualContainersHelper([i],(function(e){return e.x=l}))}}))},e.prototype.distributeSpace=function(e,t,i){for(var r=i?"x":"y",o=i?"width":"height",n=_.min(_.map(t,(function(e){return e[r]}))),a=_.max(_.map(t,(function(e){return e[r]+e[o]}))),s=_.reduce(t,(function(e,t){return e-t[o]}),a-n),l=s/(e.length-1),c=_.sortBy(e,(function(e){return e.position[r]})),u=n,d=0,p=c;d<p.length;d++){var v=p[d],h=v.position;h[r]=u,u+=h[o]+l,this.moveVisualContainer(v,h)}},e.clampXValue=function(e,t,i){return e<0?0:t+e>i.width?i.width-t:e},e.clampYValue=function(e,t,i){return e<0?0:t+e>i.height?i.height-t:e},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,l,c,u,d,p,v,h,g,f,m,y,w,C,S){return new s(t,r,o,e,n,a,l,c,u,d,p,i,v,h,g,f,m,y,w,C,S)}var o=e.data.DataViewObjectDefinition,n=e.data.DataViewObjectDefinitions,a=e.visuals.plugins.textbox;i.createVisualAuthoring=r;var s=(function(){function r(e,i,r,o,n,a,s,l,c,u,d,p,v,h,g,f,m,y,w,C,S){this.schemaProxy=e,this.telemetry=i,this.explorationNavigationService=r,this.visualPluginService=o,this.selectionService=n,this.geotaggingAnalyzerService=a,this.explorationSerializer=s,this.eventBridge=l,this.promiseFactory=c,this.undoRedoService=u,this.featureSwitches=d,this.displayNameService=p,this.sortService=v,this.visualRelationshipService=h,this.drill=g,this.filterGenerator=f,this.aggrOps=m,this.visualHostTooltip=y,this.resourceRegistration=w,this.formFactorProvider=C,this.localizationService=S,this.visualAuthoringOperations=t.util.createVisualAuthoringOperations(o,p,i,r,n,a,s,l,d,v,h,g,f,m,w,C,S)}return r.prototype.addFieldToVisual=function(e,t,i,r){var o=this;return this.registerUndoableAction(t,(function(t){return o.visualAuthoringOperations.addFieldToVisual(t,e,i,r)}),"AddFieldToVisual")},r.prototype.addFieldInRole=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(i,(function(i){return n.visualAuthoringOperations.addFieldInRole(i,e,t,r,o)}),"AddFieldInRole")},r.prototype.expandHierarchy=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(e,(function(e){return n.visualAuthoringOperations.expandHierarchy(e,t,i,r,o)}),"ExpandHierarchy")},r.prototype.removeField=function(e,t){var i=this;return this.registerUndoableAction(e,(function(e){return i.visualAuthoringOperations.removeField(t,e)}),"RemoveField")},r.prototype.removeProjection=function(e){var t=this;return this.undoRedoService.register("RemoveProjection",(function(){return t.visualAuthoringOperations.removeProjection(e)}))},r.prototype.removeInvalidExpressions=function(e,t){var i=this;return this.registerUndoableAction(t,(function(t){return i.visualAuthoringOperations.removeInvalidExpressions(t,e)}),"RemoveInvalidExpressions")},r.prototype.moveProjection=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(n,(function(n){return a.visualAuthoringOperations.moveProjection(n,e,t,i,r,o)}),"MoveProjection")},r.prototype.drillDownLevel=function(e,t,i){var r=this;this.undoRedoService.register("DrillDownLevel",(function(){return r.visualAuthoringOperations.drillDownLevel(e,t,i)}))},r.prototype.replaceProjection=function(e,i,r,o,n){var a=this;return this.undoRedoService.register("ReplaceProjection",(function(){return a.schemaProxy.get(n).then((function(n){var s=a.filterGenerator.supportsFilterOutput(o),l=a.visualAuthoringOperations.replaceProjection(n,e,i,r,o);return l&&s&&t.util.VisualContainerUtils.notifyVisualContainersExceptSource(a.eventBridge,o),l}))}))},r.prototype.drillDown=function(e,t,i){var r=this;return this.registerUndoableAction(i,(function(i){return r.visualAuthoringOperations.drillDown(i,e,t)}),"DrillDown")},r.prototype.drillUp=function(e,t){var i=this;this.undoRedoService.register("DrillUp",(function(){return i.visualAuthoringOperations.drillUp(e,t)}))},r.prototype.setAggregate=function(e,t,i,r,o){var n=this;return this.registerUndoableAction(o,(function(o){return n.visualAuthoringOperations.setAggregate(o,e,t,i,r)}),"SetAggregate")},r.prototype.removeAggregate=function(e,t,i,r){var o=this;return this.registerUndoableAction(r,(function(r){return o.visualAuthoringOperations.removeAggregate(r,e,t,i)}),"RemoveAggregate")},r.prototype.setPercentOfGrandTotal=function(e,t,i,r){var o=this;return this.registerUndoableAction(r,(function(r){return o.visualAuthoringOperations.setPercentOfGrandTotal(r,e,t,i)}),"SetPercentOfGrandTotal")},r.prototype.removePercentOfGrandTotal=function(e,t,i,r){var o=this;return this.registerUndoableAction(r,(function(r){return o.visualAuthoringOperations.removePercentOfGrandTotal(r,e,t,i)}),"RemovePercentOfGrandTotal")},r.prototype.toggleShowAll=function(e,t){this.visualAuthoringOperations.toggleShowAll(e,t)},r.prototype.setVariation=function(e,t,i,r,o,n){var a=this;return this.registerUndoableAction(e,(function(e){return a.visualAuthoringOperations.setVariation(e,t,i,r,o,n)}),"SetVariation")},r.prototype.createVisualContainerConfig=function(e){var t=this;return this.schemaProxy.get(e.dataSources).then((function(i){return t.visualAuthoringOperations.createVisualContainerConfig(i,e)}))},r.prototype.addVisualContainerImage=function(e,t,i,r,o,n){var a=this;this.undoRedoService.register("AddVisualContainerImage",(function(){return a.visualAuthoringOperations.addVisualContainerImage(e,t,i,r,o,n)}))},r.prototype.addVisualContainerBasicShape=function(e,t,i){var r=this;this.undoRedoService.register("AddVisualContainerBasicShape",(function(){return r.visualAuthoringOperations.addVisualContainerBasicShape(e,t,i)}))},r.prototype.addVisualContainerTextbox=function(e,t){return this.addEmptyVisualContainer(e,a.name,t)},r.prototype.addVisualContainer=function(e,t,i){var r=this;return this.undoRedoService.register("AddVisualContainer",(function(){return r.schemaProxy.get(e.dataSources).then((function(o){return r.visualAuthoringOperations.addVisualContainer(o,e,t,i)}))}))},r.prototype.addEmptyVisualContainer=function(e,t,i){var r=this;return this.undoRedoService.register("AddEmptyVisualContainer",(function(){return r.visualAuthoringOperations.addEmptyVisualContainer(e,t,i)}))},r.prototype.copyVisual=function(e,t,i){var r=this.explorationSerializer.deserializeVisualContainer(e);r.id=100;var o=this.formFactorProvider.getCurrentLayout(),n=r.layouts.withId(o),a=n.position;return n.position={height:a.height,width:a.width,x:Math.max(0,t?t-a.width/2:0),y:Math.max(0,i?i-a.height/2:0),z:a.z},r},r.prototype.addConfigToCategoricalFilters=function(e,t,i){var r=_.filter(e,(function(e){return!e.isInvalid()&&e.canVisualize()}));if(r)for(var o=0,n=r;o<n.length;o++){var a=n[o];this.createFilterVisualContainerConfig(a.contract,i,t)}},r.prototype.createVisualFilters=function(e,t,i){return this.visualAuthoringOperations.createVisualFilters(e,t,i)},r.prototype.addFilter=function(e,t,i){var r=this;return this.registerUndoableAction(i,(function(o){return r.visualAuthoringOperations.addFilter(o,e,t,i)}),"AddFilter")},r.prototype.removeFilter=function(e,t){var i=this;return this.undoRedoService.register("RemoveFilter",(function(){return i.visualAuthoringOperations.removeFilter(e,t)}))},r.prototype.clearFilter=function(e,t){var i=this;return this.undoRedoService.register("ClearFilter",(function(){return i.updateFilter(e,t,void 0)}))},r.prototype.updateFilter=function(e,t,i){t.filter=i;var r=t.config&&t.config.singleVisual;if(r){var o=this.visualPluginService.capabilities(r.visualType),a=this.filterGenerator.tryGetFilterPropertyIdentifier(o);
a&&(r.objects||(r.objects={}),null==i?n.deleteProperty(r.objects,a.objectName,null,a.propertyName):n.setValue(r.objects,a,null,i))}null==e.filters&&(e.filters=[]),_.indexOf(e.filters,t)===-1&&e.filters.push(t)},r.prototype.createFilterVisualContainerConfig=function(e,t,i){return this.visualAuthoringOperations.createFilterVisualContainerConfig(e,t,i)},r.prototype.raiseVisualContainerChanged=function(e){this.visualAuthoringOperations.raiseVisualContainerChanged(e)},r.prototype.convert=function(e,t,i){var r=this;return this.schemaProxy.get(t).then((function(t){return r.visualAuthoringOperations.convert(t,e,i)?r.promiseFactory.resolve():r.promiseFactory.reject()}))},r.prototype.setOrderBy=function(e,t){e.config.singleVisual.query.orderBy(t),this.raiseVisualContainerChanged(e)},r.prototype.removeOrderBy=function(e,t){for(var i=0,r=t;i<r.length;i++){var o=r[i];e.config.singleVisual.query.removeOrderBy(o)}this.raiseVisualContainerChanged(e)},r.prototype.addConditionalFormatting=function(e,t,i,r){var o=this;this.undoRedoService.register("Set Conditional Formatting",(function(){return o.visualAuthoringOperations.addConditionalFormatting(e,t,i,r),o.raiseVisualContainerChanged(e),!0}))},r.prototype.removeConditionalFormatting=function(e,t,i){var r=this;this.undoRedoService.register("Removing Conditional Formatting",(function(){return r.visualAuthoringOperations.removeConditionalFormatting(e,t,i),r.raiseVisualContainerChanged(e),!0}))},r.prototype.persistProperties=function(e,t){var i=!1,a=t.objects||{},s=this.visualPluginService.capabilities(t.visualType),l=s?s.objects:void 0;if(e.replace)for(var c=0,u=e.replace;c<u.length;c++){var d=u[c],p=n.ensure(a,d.objectName,d.selector),v={};for(var h in d.properties)o.isValidPropertyName(h)&&(v[h]=r.encodePropertyValue(d,h,l));n.allPropertiesAreEqual(p.properties,v)||(i=!0,p.properties=v)}if(e.merge)for(var g=0,f=e.merge;g<f.length;g++){var d=f[g],p=n.ensure(a,d.objectName,d.selector);for(var h in d.properties)if(o.isValidPropertyName(h)){var m=r.encodePropertyValue(d,h,l);n.propertiesAreEqual(p.properties[h],m)||(i=!0,p.properties[h]=m)}}if(e.remove)for(var y=0,w=e.remove;y<w.length;y++){var d=w[y],p=n.getObjectDefinition(a,d.objectName,d.selector);if(p)for(var h in d.properties)o.isValidPropertyName(h)&&p.properties.hasOwnProperty(h)&&(delete p.properties[h],i=!0)}if(e.removeObject)for(var C=0,S=e.removeObject;C<S.length;C++){var d=S[C];n.getObjectDefinition(a,d.objectName,d.selector)&&(i=n.deleteObjectDefinition(a,d.objectName,d.selector)||i)}return!!i&&(t.objects=a,!0)},r.prototype.deleteSelectedVisuals=function(e){for(var t=_.map(this.selectionService.getSelectedElements(),(function(e){return e.visualContainer})),i=!1,r=0,o=t;r<o.length;r++){var n=o[r];n&&(i=this.deleteVisualContainerInternal(n,e)||i)}i&&(this.notifyVisualContainersAndClearSelection(t,e),this.visualHostTooltip.hide({immediately:!0,isTouchEvent:!1}))},r.prototype.deleteVisualContainer=function(e,t){this.deleteVisualContainerInternal(e,t)&&this.notifyVisualContainersAndClearSelection([e],t)},r.prototype.deleteVisualContainers=function(e,t){var i=this,r=t.sections.filter((function(e){return e.selected}))[0],o=[];t.contract.sections.forEach((function(t){t.name===r.contract.name?e.forEach((function(e){_.any(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e.config.singleVisual.visualType}))&&o.push(e)})):e.forEach((function(e){_.remove(t.visualContainers,(function(t){return e.config.singleVisual.visualType===t.config.singleVisual.visualType}))}))})),o.length>0&&(o.forEach((function(e){i.deleteVisualContainer(e,t.exploreCanvas)})),this.notifyVisualContainersAndClearSelection(o,t.exploreCanvas))},r.prototype.deleteVisualRelationships=function(e,t){this.visualAuthoringOperations.deleteVisualRelationships(e,t)},r.prototype.setVisualRelationship=function(e,t,i,r){var o=this;this.undoRedoService.register("SetVisualRelationship",(function(){return o.visualAuthoringOperations.setVisualRelationship(e,t,i,r)}))},r.prototype.registerUndoableAction=function(e,t,i){var r=this;return this.undoRedoService.register(i,(function(){return r.schemaProxy.get(e).then((function(e){return t(e)?r.promiseFactory.resolve():r.promiseFactory.reject()}))}))},r.prototype.notifyVisualContainersAndClearSelection=function(e,t){var r=this;t.contract.crossHighlight&&_.any(e,(function(e){return e===t.contract.crossHighlight.sourceVisualContainer}))?this.filterGenerator.clearCrossHighlight(t.contract):_.any(e,(function(e){return r.filterGenerator.supportsFilterOutput(e)}))&&this.eventBridge.publishToChannel(i.events.visualContainerChanged,{affectContainer:function(e){return!0}}),this.selectionService.clearSelection()},r.prototype.deleteVisualContainerInternal=function(t,i){if(t){var r=e.explore.util.CanvasVisualsUtility.findVisualContainerViewModel(i.visualContainers,t);if(r){this.visualAuthoringOperations.deleteVisualRelationships(i.contract,t);var o=i.visualContainers.indexOf(r);i.visualContainers.splice(o,1);var n=i.contract,a=n.visualContainers.indexOf(t);return n.visualContainers.splice(a,1),!0}}},r.encodePropertyValue=function(e,t,i){var r,o=e.properties[t];return i&&i[e.objectName]&&i[e.objectName].properties[t]&&(r=i[e.objectName].properties[t].type),n.encodePropertyValue(o,r||{})},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,l,c,u){return new s(e,t,i,r,o,n,a,l,c,u)}var o=jsCommon.DOMConstants,n=e.explore.util.CanvasVisualsUtility,a=t.services.selectionUtils;i.createCanvasKeyHandlerService=r;var s=(function(){function e(e,t,i,r,o,n,a,s,l,c){this.clipboardService=e,this.selectionService=t,this.explorationSerializer=i,this.viewModeState=r,this.undoRedoService=o,this.visualAuthoring=n,this.eventBridge=a,this.popOutService=s,this.formFactor=l,this.layoutAuthoring=c}return e.prototype.onKeyDown=function(e,t){var i=e.which,r=e.ctrlKey;if(i===o.escKeyCode)return this.onClearSelection(e),this.onClearFormatPainterData(e),this.preventStopAndReturnFalse(e);if(this.isSaveEvent(e))return this.onSave(),this.preventStopAndReturnFalse(e);if(0!==this.viewModeState.getMode()){var n=this.formFactor.getCurrentLayoutCapabilities();if(this.isDeleteEvent(e))return n.canRemoveVisualFromLayout()?this.onRemoveFromLayout(e,t):n.canDelete()&&this.onDelete(e,t),this.preventStopAndReturnFalse(e);if(r)switch(i){case o.aKeyCode:return this.onSelectAll(e,t),this.preventStopAndReturnFalse(e);case o.cKeyCode:return n.canCutCopyPaste()&&this.onCopy(e),this.preventStopAndReturnFalse(e);case o.xKeyCode:return n.canCutCopyPaste()&&this.onCut(e),this.preventStopAndReturnFalse(e);case o.vKeyCode:return n.canCutCopyPaste()&&this.onPaste(e),this.preventStopAndReturnFalse(e);case o.yKeyCode:return this.onRedo(),this.preventStopAndReturnFalse(e);case o.zKeyCode:return this.onUndo(),this.preventStopAndReturnFalse(e)}else if(n.canPassUnhandledKeysToSelectedVisual())return this.allowSelectedVisualContainerToHandle(e,t)}},e.prototype.allowSelectedVisualContainerToHandle=function(e,t){var i=a.getSelectedVisual(this.selectionService);if(i){var r=n.findVisualContainerViewModel(t.visualContainers,i);if(r)return r.handleKeyDown(e)}},e.prototype.preventStopAndReturnFalse=function(e){return e.originalEvent&&(e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()),!1},e.prototype.onUndo=function(){this.undoRedoService.undo()},e.prototype.onRedo=function(){this.undoRedoService.redo()},e.prototype.onCopy=function(e){this.canCopyOrCut()&&this.clipboardService.copy()},e.prototype.onCut=function(e){this.canCopyOrCut()&&this.clipboardService.cut()},e.prototype.onPaste=function(e){this.clipboardService.paste()},e.prototype.onRemoveFromLayout=function(e,t){this.layoutAuthoring.removeLayoutFromSelectedVisuals(t)},e.prototype.onDelete=function(e,t){var i=this;this.undoRedoService.register("CanvasKeyDelete",(function(){i.visualAuthoring.deleteSelectedVisuals(t)}))},e.prototype.onClearSelection=function(e){this.selectionService.clearSelection()},e.prototype.onClearFormatPainterData=function(e){this.clipboardService.clearFormatData()},e.prototype.onSelectAll=function(e,t){var i=_.map(t.visualContainers,(function(e){return e.contract}));a.selectVisualContainers(i,this.selectionService)},e.prototype.onSave=function(){this.eventBridge.publishToChannel(i.events.saveKeyPressedEvent)},e.prototype.isSaveEvent=function(e){return e.ctrlKey&&e.which===o.sKeyCode},e.prototype.isDeleteEvent=function(e){return!e.ctrlKey&&e.which===o.deleteKeyCode},e.prototype.canCopyOrCut=function(){return!this.popOutService.getPoppedOutVisualContainer()},e})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(e,t,r,o){return new i(e,t,r,o)}e.createCanvasScaleService=t;var i=(function(){function e(e,t,i,r){this.explorationNavigation=e,this.formFactorProvider=t,this.popOut=i,this.viewModeState=r,this.m_scale=1}return e.prototype.setCanvasScaleFactor=function(e){this.m_scale=e},e.prototype.getCanvasScaleFactor=function(){return this.m_scale},e.prototype.getDisplayOption=function(){var e=this.formFactorProvider.getCurrentLayout();if(1===e&&1===this.viewModeState.getMode())return 3;var t=!!this.popOut.getPoppedOutVisualContainer();if(t)return 0;var i=this.explorationNavigation.getCurrentSection();if(i)return i.size.displayOption},e.prototype.setDisplayOption=function(e){var t=this.explorationNavigation.getCurrentSection();t&&(t.size.displayOption=e)},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s){return new d(t,e,i,r,o,n,a,s)}var o=e.data.services.SemanticGroupingSerializer,n=e.data.transforms.plugins.KMeansClustering,a=e.data.transforms.plugins.SpatialClustering,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprUtils,u=e.data.VariationRewriter;i.createClusteringAuthoringService=r;var d=(function(){function i(e,t,i,r,o,n,a,s){this.promiseFactory=e,this.conceptualSchemaProxy=t,this.localizationService=i,this.transformPluginService=r,this.modelAuthoring=o,this.explorationNavigation=n,this.visualQueryGenerator=a,this.filterGenerator=s}return i.prototype.applyClustering=function(e,t,i,r,n,a){var s=a.partitionTable.partitions;a.partitionTable.partitions=this.getPartitionsWithEnsuredNullDefaults(s);var l={newClustering:{description:e,entity:t,name:i,property:r,schema:n,definition:o.serialize(a)}};return this.modelAuthoring.apply({changes:[l]})},i.prototype.getClusteringDialogArgs=function(e,t){var i=this,r=e.contract,o=r.config.singleVisual;return o&&t?this.conceptualSchemaProxy.get(t).then((function(n){var a=i.explorationNavigation.getCurrentExploration(),s=i.explorationNavigation.getCurrentSection(),l=i.filterGenerator.calculateVisualContainerFilter(a,s,r,n),c=i.createClusteringDialogArgs(o,t,n,l,e.visualTitle);return c?i.promiseFactory.resolve(c):i.promiseFactory.reject()}),(function(e){return i.promiseFactory.reject()})):this.promiseFactory.reject()},i.prototype.editClusteringPartitions=function(t,i,r,n,a,s){var c;s&&(c=_.map(s,(function(t){return{displayName:t.name,partitionIds:_.map(t.clusterIds,(function(t){return l.typedConstant(t,e.ValueType.fromDescriptor({integer:!0}))}))}}))),c=this.getPartitionsWithEnsuredNullDefaults(c);var u={updateClustering:{schema:t,entity:i,property:r,newName:n,description:a,partitions:o.serializePartitions(c)}};return this.modelAuthoring.apply({changes:[u]})},i.prototype.editClusteringDefinition=function(e,t,i,r,n,a){var s=a.partitionTable.partitions;a.partitionTable.partitions=this.getPartitionsWithEnsuredNullDefaults(s);var l={reevaluateClustering:{schema:e,entity:t,groupingColumnName:i,newName:r,description:n,partitionTableDefinition:o.serialize(a).PartitionTable.Definition}};return this.modelAuthoring.apply({changes:[l]})},i.prototype.getPartitionsWithEnsuredNullDefaults=function(e){var t=e?e:[],i=l.nullConstant(),r=_.find(t,(function(e){return _.any(e.partitionIds,(function(e){return s.equals(e,i)}))}));return r||(t=t.concat({displayName:null,partitionIds:[l.nullConstant()]})),t},i.prototype.createClusteringDialogArgs=function(e,t,i,r,o){var n=this.createClusteringGroupingDefinition(e,t,i,r);if(n){var a,l,c=n.groupedColumns[0];if(s.isColumn(c)?(l=c.source,a=c.ref):s.isHierarchyLevel(c)&&(l=u.run(c,i).getTargetEntity(),a=c.level),l)return{entity:l.entity,groupingColumnName:this.getSuggestedClusteringColumnName(a),sourcePropertyName:a,schema:l.schema,description:jsCommon.StringExtensions.format(this.localizationService.get("ClusteringDialog_DefaultDescription"),o&&o.text&&""!==o.text.trim()?o.text:a),semanticGroupingDefinition:n}}},i.prototype.createClusteringGroupingDefinition=function(e,r,o,n){var a=this,s=t.contracts.SingleVisualConfig.clone(e);s.objects=void 0;var c=this.visualQueryGenerator.executeForFlattenedQuery({config:e,dataSources:r,schema:o,additionalFilters:n},(function(e){return a.getMappingTableQueryFromTransformedQuery(e)}));if(c){var u=i.getGroupedAndClusterIdColumn(c),d=u.groupedColumns,p=_.map(d,(function(e){return i.getGroupedColumnExpr(c,e)})),v={mappingTable:c,itemIdColumns:u.groupedColumns,partitionIdColumn:u.clusterIdColumn,defaultPartitionPrefix:this.localizationService.get("ClusteringLegend_Prefix"),partitions:[{displayName:null,partitionIds:[l.nullConstant()]}]};return{groupedColumns:p,partitionTable:v}}},i.prototype.getMappingTableQueryFromTransformedQuery=function(e){var t=i.getClusteringTransform(e);if(t){var r=t.output;if(r){var o=r.table;if(o){for(var n,a=[],l=0,c=e.select();l<c.length;l++){var u=c[l],d=i.getTransformTableColumn(u,o);d&&(s.isTransformOutputRoleRef(d.expression.expr)?n=u:this.isForClusteringGroupedColumn(t,d)&&a.push(u))}if(_.any(a)&&n){var p=a.concat(n);e=e.select(p);var v=_.map(p,(function(e){return e.expr.ref}));return t.output.table.columns=_.filter(t.output.table.columns,(function(e){return v.indexOf(e.expression.name)>=0})),e=e.transforms([t]),e=e.orderBy([])}}}}},i.getGroupedAndClusterIdColumn=function(e){for(var t,r=e.transforms()[0].output.table,o=[],n=0,a=e.select();n<a.length;n++){var l=a[n],c=i.getTransformTableColumn(l,r);s.isTransformOutputRoleRef(c.expression.expr)?t=l:o.push(l)}return{groupedColumns:_.map(o,(function(e){return e.name})),clusterIdColumn:t.name}},i.getClusteringTransform=function(e){return _.find(e.transforms(),(function(e){return e.algorithm===n.name||e.algorithm===a.name}))},i.prototype.isForClusteringGroupedColumn=function(e,t){if(t&&t.expression&&t.expression.expr){var r=e.input.table,o=i.getTransformTableColumn(t.expression,r);return!(!o||!o.expression||!o.expression.expr||c.isMeasure(o.expression.expr))}return!1},i.getTransformTableColumn=function(e,t){var i=e.expr;if(s.isColumn(i)){var r=i,o=r.source;if(s.isTransformTableRef(o)&&o.source===t.name)return _.find(t.columns,(function(e){return e.expression.name===r.ref}))}},i.prototype.getSuggestedClusteringColumnName=function(e){return this.localizationService.format("ClusteringDialog_DefaultClusterColumnNamePattern",[e])},i.getGroupedColumnExpr=function(e,t){var i=_.find(e.select(),(function(e){return e.name===t})),r=e.transforms()[0],o=_.find(r.output.table.columns,(function(e){return e.expression.name===i.expr.ref})),n=_.find(r.input.table.columns,(function(e){return e.expression.name===o.expression.expr.ref})),a=n.expression.expr;return a},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n,a,s,l,c,d,p){return new u(e,t,i,r,o,n,a,s,l,c,d,p)}var r=e.data.dsr.DsrMessage,o=e.data.FieldExprPattern,n=e.data.transforms.plugins.KMeansClustering,a=e.data.transforms.plugins.SpatialClustering,s=e.data.SchemaChangeType.ObjectTypeEnum,l=e.data.services.SemanticGroupingSerializer,c=e.data.SQExprBuilder;t.createClusteringService=i;var u=(function(){function t(e,t,i,r,o,n,a,s,l,c,u,d){this.conceptualSchemaProxy=e,this.clusteringAuthoringService=t,this.clusteringStateService=i,this.groupingDesignStateService=r,this.visualAuthoringService=o,this.visualPluginService=n,this.errorService=a,this.localizationService=s,this.modelChangeHandler=l,this.modalDialogService=c,this.promiseFactory=u,this.telemetryService=d,this.autoClustersNumber=-1,this.numberOfClustersParameter="NumberOfClusters",this.notEnoughDimensionsCode="ClusteringErrorType.NotEnoughDimensions",this.extraDimensionsCode="ClusteringErrorType.ExtraDimensions",this.notEnoughMeasuresCode="ClusteringErrorType.NotEnoughMeasures",this.extraMeasuresCode="ClusteringErrorType.ExtraMeasures",this.minimumDimensions=1,this.maximumDimensions=1,this.minimumMeasures=1,this.maximumMeasures=15}return t.prototype.isClusteringColumn=function(e){var t=o.getProperty(e);if(t){var i=this.groupingDesignStateService.getGroupingDesignState(t.entity,t.name);return!!i&&!!i.partitionTable}return!1},t.prototype.createClusters=function(t,i,r){var o,s=this,u=t.contract,d=u.config.singleVisual.query.defn.select(),p=_.filter(d,(function(t){return e.data.SQExprUtils.isMeasure(t.expr)})).length,v=d.length-p;if(v<this.minimumDimensions?o=this.notEnoughDimensionsCode:v>this.maximumDimensions?o=this.extraDimensionsCode:p<this.minimumMeasures?o=this.notEnoughMeasuresCode:p>this.maximumMeasures&&(o=this.extraMeasuresCode),o)return this.telemetryService.logEvent(e.telemetry.EXClusteringWarning,o),void this.errorService.infoCustom(this.localizationService.get("Clustering_InvalidColumnsTitle"),this.localizationService.get("Clustering_InvalidColumnsMessage"));var h=u.config.singleVisual;this.addClusteringToVisualContainer(h,r?a.name:n.name)&&this.clusteringAuthoringService.getClusteringDialogArgs(t,i).then((function(t){s.showDialog({description:t.description,entity:t.entity,groupingColumnName:t.groupingColumnName,sourcePropertyName:t.sourcePropertyName,schema:t.schema,isNewClustering:!0}).then((function(r){if(s.removeClusteringFromVisualContainer(h),r){var o=t.semanticGroupingDefinition.partitionTable.mappingTable.transforms(),a=_.find(o,(function(e){return e.algorithm===n.name})),d=r.numberOfClusters?r.numberOfClusters:s.autoClustersNumber;a&&(a.input.parameters=[{name:s.numberOfClustersParameter,expr:c.integer(d)}]);var g=s.telemetryService.startEvent(e.telemetry.EXClusteringAddClustering,d,h.visualType,p,v,u.filters?u.filters.length:0),f=s.modelChangeHandler.register((function(e){g.resolve();var t=e.changes;if(!_.isEmpty(t)){var r=_.find(t,(function(e){return e.newClustering&&_.all(e.newClustering.definition.PartitionTable.Definition.ItemIdColumns,(function(e){return _.any(h.query.defn.select(),(function(t){return t.name===e}))}))})),o=s.visualPluginService.capabilities(h.visualType),n=o&&o.grouping&&o.grouping.cluster&&o.grouping.cluster.clusteringRole;if(r&&n){var a=r.newClustering,d=a.definition.PartitionTable.Result.TableName;s.checkToDisplayWarning(a.schema,d,i,g.event).then((function(e){if(!e){var t=l.deserialize(a.definition);s.visualAuthoringService.addFieldInRole(c.groupRef(a.name,c.entity(a.schema,a.entity),t.groupedColumns),n,i,u)}}))}}return s.promiseFactory.resolve()}));s.clusteringAuthoringService.applyClustering(r.description,t.entity,r.groupingColumnName,t.sourcePropertyName,t.schema,t.semanticGroupingDefinition).finally((function(){return f.stopHandling()}))}}))}))},t.prototype.editClustering=function(t,i){var n=this,a=this.clusteringStateService.getMetadata(t),s=o.getProperty(t),l=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(t){var o,c=n.groupingDesignStateService.getGroupingDesignState(s.entity,s.name),u=t.schema(s.schema),d=u.entities.withName(c.partitionTableResult.tableName);if(1===d.queryable){var p=d.errorMessage,v=new r({Code:p,Severity:"Warning",Message:void 0});if(e.data.dsr.KnownDsrMessages[p]){var h=v.getDetails(n.localizationService);o=h.displayableErrorInfo[0].errorInfoValue}else o=n.localizationService.get("ErrorMessage_DefaultTitle")}var g=_.some(a.partitions,(function(e){return 1===e.clusterIds.length&&!_.isNumber(e.clusterIds[0])})),f=a.partitions?a.partitions.length:void 0;g&&f>0&&f--;var m={entity:s.entity,groupingColumnName:s.name,sourcePropertyName:a.sourceColumnName,description:a.description,partitions:a.partitions,numberOfClusters:f,errorMessage:o},y=n.showDialog(m);l.promise.catch((function(){return y.reject()})),y.then((function(e){return n.checkToUpdateClustering(s.schema,m,e,i,c.partitionTableResult.tableName)})).then((function(){l.resolve(null)})).catch((function(){return l.reject()}))})),e.RejectablePromise(l)},t.prototype.showDialog=function(e){var t={dialogName:"ClusteringDialog",definitionTemplateCachePath:"components/clusteringDialog/clusteringDialogDefinition.html",bindings:{args:e},dialogCssClass:"clusteringDialog"};return this.modalDialogService.showHostModalDialog(t)},t.prototype.arePartitionNameToClusterIdsMappingsEqual=function(e,t){var i=_.sortBy(e,(function(e){return e.name})),r=_.sortBy(t,(function(e){return e.name}));return i.length===r.length&&_.every(i,(function(e,t){if(e.name!==r[t].name)return!1;var i=e.clusterIds,o=r[t].clusterIds;return i.length===o.length&&_.isEqual(_.sortBy(i),_.sortBy(o))}))},t.prototype.checkToDisplayWarning=function(t,i,o,n){var a=this,s=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(o).then((function(o){var l=o.schema(t),c=l.entities.withName(i);if(1===c.queryable){var u=c.errorMessage,d=new r({Code:u,Severity:"Warning",Message:void 0}),p=d.getDetails(a.localizationService);a.errorService.infoCustom(p.displayableErrorInfo[0].errorInfoKey,p.displayableErrorInfo[0].errorInfoValue),a.telemetryService.logChildEvent(n,e.telemetry.EXClusteringWarning,u),s.resolve(!0)}else s.resolve(!1)}),(function(e){s.reject()})),s.promise},t.prototype.checkToUpdateClustering=function(t,i,r,o,n){if(!r)return this.promiseFactory.resolve(null);var a=i.groupingColumnName===r.groupingColumnName,s=i.description===r.description,l=this.arePartitionNameToClusterIdsMappingsEqual(i.partitions,r.partitions),c=i.numberOfClusters===r.numberOfClusters;if(a&&s&&l&&c)return this.promiseFactory.resolve(null);var u=this.telemetryService.startEvent(e.telemetry.EXClusteringEditClustering,a,s,l,c,c?i.numberOfClusters:r.numberOfClusters);return c?this.editClusteringPartitions(t,i,r,o,u):this.editClusteringDefinition(t,i,r,o,u,n)},t.prototype.editClusteringPartitions=function(e,t,i,r,o){var n=this,a=this.modelChangeHandler.register((function(a){o.resolve();var l=n.promiseFactory.defer(),c=a.changes;if(_.isEmpty(c))l.resolve(null);else{var u=_.find(c,(function(i){var r=i.updateClusteringDefinition;return r&&r.schema===e&&r.entity===t.entity&&r.property===t.groupingColumnName})),d=t.groupingColumnName!==i.groupingColumnName,p=d?_.find(c,(function(i){var r=i.propertyRename;return r&&r.schema===e&&r.entity===t.entity&&r.before===t.groupingColumnName&&r.objectType===s.Column})):void 0;if(u&&(!d||p)){var v=n.groupingDesignStateService.getGroupingDesignState(t.entity,d?p.propertyRename.after:t.groupingColumnName);n.checkToDisplayWarning(e,v.partitionTableResult.tableName,r,o.event).finally((function(){l.resolve(null)}))}}return l.promise}));return this.clusteringAuthoringService.editClusteringPartitions(e,t.entity,t.groupingColumnName,i.groupingColumnName,i.description,i.partitions).finally((function(){return a.stopHandling()}))},t.prototype.editClusteringDefinition=function(e,t,i,r,o,a){var s=this,l=this.groupingDesignStateService.getGroupingDesignState(t.entity,t.groupingColumnName);if(!l||!l.partitionTable||!l.partitionTable.mappingTable)return this.promiseFactory.reject();var u=this.modelChangeHandler.register((function(t){o.resolve();var i=s.promiseFactory.defer(),n=t.changes,l=_.find(n,(function(e){return e.reevaluateClusteringDefinition}));return l?s.checkToDisplayWarning(e,a,r,o.event).finally((function(){i.resolve(null)})):i.resolve(null),i.promise})),d=l.partitionTable.mappingTable.transforms(),p=_.find(d,(function(e){return e.algorithm===n.name}));if(!p)return this.promiseFactory.reject();p.input.parameters=[{name:this.numberOfClustersParameter,expr:c.integer(i.numberOfClusters?i.numberOfClusters:this.autoClustersNumber)}];var v=_.clone(l);return v.partitionTable.mappingTable.transforms([p]),v.partitionTableResult=null,v.partitionTable.partitions=void 0,this.clusteringAuthoringService.editClusteringDefinition(e,t.entity,t.groupingColumnName,i.groupingColumnName,i.description,v).finally((function(){return u.stopHandling()}))},t.prototype.addClusteringToVisualContainer=function(e,t){var i={merge:[this.getClusteringObject(t)]};return this.visualAuthoringService.persistProperties(i,e)},t.prototype.removeClusteringFromVisualContainer=function(e){var t={removeObject:[this.getClusteringObject(n.name),this.getClusteringObject(a.name)]};return this.visualAuthoringService.persistProperties(t,e)},t.prototype.getClusteringObject=function(e){return{objectName:"clustering",selector:null,properties:{transform:{algorithm:e,parameters:[]}}}},t})();t.ClusteringService=u})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new o(e,t,i,r)}i.createConnectionSetupService=r;var o=(function(){function i(e,t,i,r){this.conceptualSchemaProxy=e,this.dataProxy=t,this.visualAuthoring=i,this.visualQueryGenerator=r}return i.prototype.setup=function(i,r){var o=this;void 0===r&&(r=t.constants.ConnectionSetupLimit);var n=1,a="undefined";i&&i.length>0&&(a=i[0].name),r>t.constants.ConnectionSetupLimit&&(r=t.constants.ConnectionSetupLimit),this.conceptualSchemaProxy.get(i).then((function(t){var s=t.schema(a),l=s.capabilities;if(!l||!l.discourageQueryAggregateUsage)for(var c=s.entities,u=0,d=c;u<d.length;u++){var p=d[u];if(n>r)break;for(var v=0,h=p.properties;v<h.length;v++){var g=h[v];if(n>r)break;n++;var f=e.data.SQExprBuilder.fieldExpr({column:{schema:a,entity:p.name,name:g.name}});o.visualAuthoring.createVisualContainerConfig({expr:f,dataSources:i,allowAggregate:!0}).then((function(e){var r=o.visualQueryGenerator.execute({config:e.singleVisual,dataSources:i,schema:t,additionalFilters:null});r&&r.options&&r.options.query&&(r.options.query.allowCache=!1,o.dataProxy.execute(r.options).then((function(){}),(function(){})))}))}}}))},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,n){return new o(e,t,i,r,n)}var r=e.explore.services.events;t.createDeleteVisualService=i;var o=(function(){function t(e,t,i,r,o){this.eventBridge=e,this.$rootScope=t,this.telemetryService=i,this.visualPluginService=r,this.undoRedoService=o}return t.prototype.deleteCustomVisuals=function(t,i){var o=this;this.undoRedoService.register("DeleteCustomVisual",(function(){i.forEach((function(i){o.telemetryService.logEvent(e.telemetry.EXDeleteCustomViz,i.name),o.visualPluginService.removePlugin(i.name),_.remove(t.resourcePackages,(function(e){return e.name===i.name})),o.eventBridge.publishToChannel(r.deleteCustomVisual,{visual:i})})),o.eventBridge.publishToChannel(r.visualPluginsChanged)}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(t){function i(e,t){return new r(e,t)}t.createDetailVisualSpinnerService=i;var r=(function(){function t(e,t){this.scope=e,this.eventBridge=t}return t.prototype.startSpinner=function(){this.eventBridge.publishBubbling(this.scope,e.viewModels.DetailVisualEvents.spinnerAction,0)},t.prototype.stopSpinner=function(){this.eventBridge.publishBubbling(this.scope,e.viewModels.DetailVisualEvents.spinnerAction,1)},t})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t){return new c(e,t)}var o=e.explore.util.DrillUtils,n=jsCommon.EnumExtensions,a=t.util.DetailVisualUtils,s=e.visuals.plugins,l=t.util.VisualContainerUtils;i.createDrillService=r;var c=(function(){function t(e,t){this.eventBridge=e,this.visualPlugin=t}return t.prototype.getSupportedDrillDirections=function(e){var t=this.getProjections(e);for(var i in t){var r=t[i];if(r.activeProjectionRefs){var o=0,n=r.all();if(1===n.length)return o;var a=r.activeProjectionRefs,s=this.findActiveProjectionIndexInQueryCollection(n,a);return _.isEmpty(a)||s+a.length===n.length||(this.canDrillDownLevel(e,2)&&(o|=2),this.canDrillDownLevel(e,3)&&(o|=4)),!_.isEmpty(r.activeProjectionRefs)&&(0!==s||a.length>1)&&(o|=1),o}}return 0},t.prototype.setDrillMode=function(e,t){e&&e.drillMode!==t&&(e.drillMode=t,this.raiseDrillModeChanged(e,t))},t.prototype.canSeeData=function(e){if(!(e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query))return!1;var t=l.getVisualType(e),i=e.config.singleVisual,r=i.getErrorDetails&&!!i.getErrorDetails();return!r&&a.supportsVisualDetails(t,this.visualPlugin)},t.prototype.canDrillToDetails=function(t){if(!t)return!1;var i=l.getVisualQuery(t);if(!i)return!1;var r=l.getVisualType(t);if(r===s.lineChart.name||r===s.areaChart.name||r===s.stackedAreaChart.name)return!1;var o=l.getVisualCapabilities(t,this.visualPlugin);if(!o||o.supportsSelection===!1)return!1;var n=_(l.getSelectExprs(t)).filter((function(t){return e.data.SQExpr.isAggregation(t.expr)})).map((function(e){return e.name})).value();if(_.isEmpty(n))return!1;var a=o.dataRoles;if(_.isEmpty(a))return!1;for(var c=_(a).filter((function(t){return t.kind===e.VisualDataRoleKind.Measure&&0!==t.joinPredicate})).map((function(e){return e.name})).value(),u=0,d=0,p=c;d<p.length;d++){var v=p[d],h=i.projections[v];if(!_.isEmpty(h)){if(u++,u>1)return!1;var g=h.all(),f=_.some(g,(function(e){return!_.contains(n,e.queryRef)}));if(f)return!1}}return 0!==u},t.prototype.canDrillByDirection=function(e,t){if(!e)return!1;var i=this.getSupportedDrillDirections(e);return!!i&&n.hasFlag(i,t)},t.prototype.isDrillModeEnabled=function(e,t){return!!e&&e.drillMode===t},t.prototype.canDrillDownLevel=function(e,t){var i=e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query;if(!i)return!1;var r=l.getVisualCapabilities(e,this.visualPlugin);if(!r)return!1;var n=_.first(o.getDrillableRoles(r));if(!n)return!1;var a=i.projections[n],s=a.getLastActiveQueryReference();if(!s)return!1;var c=_.findIndex(a.all(),(function(e){return e.queryRef===s})),u=_.filter(e.filters,(function(e){return 2===e.howCreated})).length;return c===u||i.currentDrillMode(n)===t},t.prototype.getProjections=function(e){return e&&e.config&&e.config.singleVisual&&e.config.singleVisual.query&&e.config.singleVisual.query.projections},t.prototype.findActiveProjectionIndexInQueryCollection=function(e,t){if(!_.isEmpty(t))for(var i=0;i<e.length;i++){for(var r=i,o=0;o<t.length&&r<e.length&&t[o]===e[r].queryRef;)o++,r++;if(o===t.length)return i}return-1},t.prototype.raiseDrillModeChanged=function(e,t){var r={visualContainer:e};this.eventBridge.publishToChannel(i.events.drillModeChanged,r)},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,i,r,o,n,a,s,l,c,u,p,v,h,g,f,m,y,w,C,S,b,x){var D=t.util.createVisualAuthoringOperations(r,h,g,l,s,o,i,v,a.featureSwitches,f,m,y,w,C,S,x,b);return new d(e,D,n,s,l,i,c,u,p,v,g,w,b,r)}var o=jsCommon.ArrayExtensions,n=t.util.FilterContainerBuilder,a=e.explore.FilterUtils,s=e.data.SQExpr,l=e.visuals.controls.internal.TablixObjects,c=t.util.VisualContainerUtils,u=(function(){function e(e,t,i,r,o){this.sourceSection=e,this.sourceVisualContainer=t,this.targetSection=i,this.targetVisualContainer=r,this.navigationState=o}return e.prototype.toSnapshot=function(e){var i=this;if(e.getCurrentSection()===this.targetSection){var r=e.getCurrentExploration(),o=t.SectionUtils.findSectionIndexForSection(r,this.sourceSection),n=t.SectionUtils.findSectionIndexForSection(r,this.targetSection),a=_.findIndex(this.sourceSection.visualContainers,(function(e){return e===i.sourceVisualContainer;
})),s=_.findIndex(this.targetSection.visualContainers,(function(e){return e===i.targetVisualContainer}));return{sourceSectionIndex:o,sourceVisualIndex:a,targetSectionIndex:n,targetVisualIndex:s}}},e.fromSnapshot=function(t,i){if(t){var r=i.getCurrentExploration(),o=r.sections[t.sourceSectionIndex],n=o.visualContainers[t.sourceVisualIndex],a=r.sections[t.targetSectionIndex],s=a.visualContainers[t.targetVisualIndex];return new e(o,n,a,s,0)}},e})();i.DrillToDetailsContext=u,i.createDrillToDetailsService=r;var d=(function(){function r(e,t,r,o,n,a,s,l,c,u,d,p,v,h){var g=this;this.conceptualSchemaProxy=e,this.visualAuthoringOperations=t,this.undoRedo=r,this.selectionService=o,this.explorationNavigationService=n,this.explorationSerializer=a,this.popOut=s,this.rootScope=l,this.timeout=c,this.eventBridge=u,this.telemetryService=d,this.filterGenerator=p,this.localizationService=v,this.visualPluginService=h,u.createChannelSubscriptionManager().subscribe(i.events.canvasChanged,(function(){return g.onSectionChanged()})).subscribe(i.events.popOutModeChanged,(function(){return g.onPopOutModeChanged()})).subscribe(i.events.explorationUnloaded,(function(e,t){return g.clearContext()}))}return r.prototype.drillToDetails=function(t,i,r){var o=this;if(!_.isEmpty(t)){var n=_.first(t);if(n&&!_.isEmpty(n.metadata)){var a=c.getVisualQuery(i);if(a&&a.defn){if(_.isEmpty(n.dataMap)){if(!a.projections)return;var u=c.getDataRolesForVisual(i,this.visualPluginService),d=_(u).filter((function(t){return t.kind!==e.VisualDataRoleKind.Measure})).map((function(e){return e.name})).value();for(var p in a.projections)if(!_.isEmpty(a.projections[p])&&_.contains(d,p))return}var v=a.defn.select().withName(n.metadata);v&&s.isAggregation(v.expr)&&this.conceptualSchemaProxy.get(r).then((function(r){var n=o.visualAuthoringOperations.drillToDetails(r,v.expr,t,i);n&&(o.addCrossFilters(i,o.explorationNavigationService.getCurrentSection(),n,!1,r),n.config.singleVisual.objects=l.generateTablixDefaultObjects(e.visuals.controls.TablixType.Table),o.drillToDetailsCore(t,i,n))}),(function(){return _.noop}))}}}},r.prototype.generateDetailsTable=function(e,t,i){if(i){var r=this.mockVisualContainer(e),o=i,n=this.visualAuthoringOperations.drillToDetails(t,o,null,r);return n?n.config.singleVisual:void 0}},r.prototype.clear=function(){if(this.drillToDetailsContext){this.drillToDetailsContext.navigationState=1;var e=t.SectionUtils.findSectionIndexForSection(this.explorationNavigationService.getCurrentExploration(),this.drillToDetailsContext.sourceSection);this.rootScope.$emit(t.constants.switchSectionEvent,e)}},r.prototype.getContext=function(){return this.drillToDetailsContext},r.prototype.setContext=function(e){this.drillToDetailsContext=e},r.prototype.clearContext=function(){this.drillToDetailsContext=null},r.prototype.getDetailsTableTargetMeasure=function(t){var i=this.mockVisualContainer(t),r=c.getVisualQuery(i);if(r&&r.defn){var o=c.getDataRolesForVisual(i,this.visualPluginService);if(!_.isEmpty(o))for(var n=_(o).filter((function(t){return(t.kind===e.VisualDataRoleKind.Measure||t.kind===e.VisualDataRoleKind.GroupingOrMeasure)&&0!==t.joinPredicate})).map((function(e){return e.name})).value(),a=0,l=n;a<l.length;a++){var u=l[a],d=r.projections[u];if(!_.isEmpty(d))for(var p=d.all(),v=0,h=p;v<h.length;v++){var g=h[v],f=r.defn.select().withName(g.queryRef);if(f&&s.isAggregation(f.expr))return f.expr}}}},r.prototype.mockVisualContainer=function(e){var t={config:{singleVisual:e},layouts:o.createWithId(),filters:[]};return t.layouts.push({id:0,position:{x:0,y:0,width:0,height:0}}),t},r.prototype.onSectionChanged=function(){var e=this;if(this.drillToDetailsContext){this.explorationNavigationService.getCurrentSection();switch(this.drillToDetailsContext.navigationState){case 0:this.timeout((function(){i.selectionUtils.selectVisualContainer(e.drillToDetailsContext.targetVisualContainer,e.selectionService),e.popOut.popOutVisualContainer(e.drillToDetailsContext.targetVisualContainer,1)}),0);break;case 1:var r=t.SectionUtils.findSectionIndexForSection(this.explorationNavigationService.getCurrentExploration(),this.drillToDetailsContext.targetSection),o=this.drillToDetailsContext.sourceVisualContainer;this.drillToDetailsContext=null,this.rootScope.$emit(t.constants.deleteSectionEvent,r),this.timeout((function(){i.selectionUtils.selectVisualContainer(o,e.selectionService),e.undoRedo.clear()}),0)}}},r.prototype.onPopOutModeChanged=function(){if(this.drillToDetailsContext){var e=this.explorationNavigationService.getCurrentSection();if(e!==this.drillToDetailsContext.sourceSection){var t=this.popOut.getPoppedOutVisualContainer();t!==this.drillToDetailsContext.targetVisualContainer&&this.clear()}}},r.prototype.drillToDetailsCore=function(e,i,r){var o=this.explorationNavigationService.getCurrentSection();if(o){var n=this.explorationSerializer.serializePage(o,1),a=this.explorationSerializer.deserializePage(n),s={name:"Drill to Details",displayName:"Drill to Details",filters:a.filters,size:a.size,visualContainers:[r],transient:!0};this.drillToDetailsContext=new u(o,i,s,r,0),this.rootScope.$emit(t.constants.insertSectionEvent,s)}},r.prototype.addCrossFilters=function(e,t,i,r,o){var n=this.filterGenerator.getVisualContainerCrossFilters(t,e,o);if(n.dataFilters)for(var a=0,s=n.dataFilters;a<s.length;a++){var l=s[a];this.addVisualFilters(i,l,o,!1)}r&&this.addVisualFilters(i,n.highlightFilter,o,r)},r.prototype.addVisualFilters=function(e,t,i,r){var o=n.fromSemanticFilter(t,i);if(o)for(var s=0,l=o;s<l.length;s++){var c=l[s];a.add(e,c)}else{var u={name:a.getNextFilterName(e.filters),restatement:a.getNextAutoGenRestatement(e.filters,"DetailVisual_CrossFilter",this.localizationService),filter:t,howCreated:0};a.add(e,u)}},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,o,n){return new r(e,t,i,o,n)}t.createEsriExplorationService=i;var r=(function(){function t(e,t,i,r,o){this.$rootScope=e,this.errorService=t,this.modalDialogService=i,this.featureSwitchService=r,this.promiseFactory=o}return t.prototype.esriVisualAllowed=function(){return this.featureSwitchService.featureSwitches.esriEnabled&&this.featureSwitchService.featureSwitches.esriVisualEnabled},t.prototype.explorationContractContainsEsriVisual=function(e){return this.sectionsContainEsriVisual(e.sections)},t.prototype.explorationViewModelContainsEsriVisual=function(e){var t=e.sections.map((function(e){return e.contract}));return this.sectionsContainEsriVisual(t)},t.prototype.sectionsContainEsriVisual=function(t){return _.any(t,(function(t){return _.any(t.visualContainers,(function(t){return t.config.singleVisual.visualType===e.visualHost.EsriVisual}))}))},t.prototype.showEsriConsentDialog=function(e){var t=this.promiseFactory.defer(),i=this.$rootScope.$new(!0,e);i.errorService=this.errorService,i.esriConsentDialogCallback=function(e){t.resolve(e)};var r={dialogName:void 0,isDismissable:!0,scope:i,template:"<esri-consent-dialog></esri-consent-dialog>",dialogCssClass:"esriConsentDialog"};return this.modalDialogService.showLegacyWebModalDialog(r),t.promise},t})(),o=(function(){function e(){}return e.prototype.showEsriConsentDialog=function(e){},e.prototype.esriVisualAllowed=function(){return!1},e.prototype.explorationContractContainsEsriVisual=function(e){return!1},e.prototype.explorationViewModelContainsEsriVisual=function(e){return!1},e})();t.MockEsriExplorationService=o})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new i}e.createExplorationCapabilitiesService=t;var i=(function(){function e(){this.options={showAppBar:!0,showTaskPane:!0,showVisualizationPane:!0,showNavContentPane:!0,visualContainerOptions:{showMenu:!0,showPin:!0,showContextMenu:!0,disablePin:!1,disableQueryCacheUpdates:!1},showBackButtonOnAppBar:!1,esriVisualEnabled:!1,esriVisualDisallowed:!1}}return e.prototype.setCapabilities=function(e){_.merge(this.options,e)},e.prototype.getCapabilities=function(){return this.options},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,n){var a=o.createExploreVisualDataProxyService(r.create(),t);return new c(e,t,i,a,n)}var o=e.explore.services,n=e.data.SemanticFilter,a=e.data.SQExprConverter,s=e.data.SQExprUtils,l=e.explore.util.VisualHostServicesUtil;i.createFilterRestatementService=r;var c=(function(){function i(e,t,i,r,o){this.conceptualSchemaProxy=e,this.filterGenerator=t,this.promiseFactory=i,this.dataProxyService=r,this.visualQueryGenerator=o}return i.prototype.loadRestatement=function(e,i,r){var o=this,a=i.filter;return!a||n.isAnyFilter(a)?this.promiseFactory.resolve(null):this.conceptualSchemaProxy.get(e).then((function(l){if(n.isDefaultFilter(a)){var c=s.getDefaultValue(i.expression,l);return t.viewModels.RestatementHelper.fromDefault(c?c.value:"")}return o.loadRestatementForSQExpr(l,i,e,r)}))},i.prototype.loadRestatementForSQExpr=function(e,t,i,r){var o=t.expression,n=o.hasGroupOnKeys(e);return n?this.loadRestatementForSQExprWithGroupOnKeys(e,t,i):this.promiseFactory.resolve(this.getRestatementForSimpleSQExpr(e,t,r))},i.prototype.getRestatementForSimpleSQExpr=function(e,i,r){var o=this.getSelectedScopeIdsContainerFromFilter(e,i);return o&&t.viewModels.RestatementHelper.fromDataViewScopeIdentities(o.scopeIds,o.isNot,r)},i.prototype.loadRestatementForSQExprWithGroupOnKeys=function(e,i,r){var o,n,a=this.getSelectedScopeIdsContainerFromFilter(e,i);if(a&&(o=a.isNot,n=a.scopeIds),_.isEmpty(n))return this.promiseFactory.resolve(null);var s=i.cachedValueItems;return _.isEmpty(s)||s.length!==n.length?this.runQueryToGetRestatement(e,i,o,n,r):this.promiseFactory.resolve(t.viewModels.RestatementHelper.fromLabels(s,o))},i.prototype.runQueryToGetRestatement=function(i,r,o,n,a,s){var c=r.config&&r.config.singleVisual;if(!a||!c)return this.promiseFactory.resolve(null);var u=e.DataViewScopeIdentity.filterFromIdentity(n,!1),d={dataSources:a,schema:i,config:c,hostServices:e.Prototype.inherit(l.createQueryVisualHostServices(),(function(e){return e.getFilters=function(e,t){return{dataFilter:u}}})),visualQueryGenerator:this.visualQueryGenerator,isLoadMore:!1};return this.dataProxyService.runQuery(d).then((function(e){for(var i=e.dataReaderResult.dataView,n=i&&i.categorical&&i.categorical.categories[0],a=n&&n.values?n.values.length:0,l=[],c=0;c<a;c++){var u=n.identity&&n.identity[c],d=n.values&&n.values[c],p=s?s.format(d):d;l.push({displayName:p,identity:u})}return r.cachedValueItems=l,t.viewModels.RestatementHelper.fromLabels(l,o)}))},i.prototype.getSelectedScopeIdsContainerFromFilter=function(e,t){var i=t.expression.getKeyColumns(e);if(i){var r=t.filter;return r?a.asScopeIdsContainer(r,i):void 0}},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n){return new a(e,t,i,r,o,n)}var o=jsCommon.FreezeUtility,n=e.common.helpers.TelemetryHelper;i.createFormFactorProvider=r;var a=(function(){function r(e,t,i,r,o,n){this.canvasLayout=0,this.canvasLayoutCapabilities=this.initializeLayoutCapabilities(),this.eventBridge=e,this.selection=t,this.servicePauser=i,this.timeout=r,this.viewModeState=o,this.telemetry=n}return r.prototype.getCurrentLayout=function(){return this.canvasLayout},r.prototype.changeFormFactor=function(r,o){var a=this;if(this.canvasLayout!==r){this.telemetry.logEvent(e.telemetry.EXChangeCanvasLayout,n.getTelemetryCanvasLayout(this.canvasLayout),n.getTelemetryCanvasLayout(r),this.getTelemetryViewMode(this.viewModeState.getMode())),this.selection.clearSelection(),this.setCurrentLayout(r);var s=o.exploration.contract,l=s.activeSectionIndex;o.exploration.exploreCanvas=t.viewModels.ViewModelFactory.convertSectionToExploreCanvas(s,s.sections[l],this.canvasLayout),this.updateViewModeState();var c={layout:r};this.timeout((function(){return a.eventBridge.publishToChannel(i.events.formFactorChanged,c)}))}},r.prototype.getCurrentLayoutCapabilities=function(){return this.canvasLayoutCapabilities[this.canvasLayout]},r.prototype.setCurrentLayout=function(e){this.canvasLayout=e,0===this.canvasLayout?this.servicePauser.resume():this.servicePauser.pause()},r.prototype.updateViewModeState=function(){var e=this.getCurrentLayoutCapabilities();this.viewModeState.updateConfig((function(t){t.displayOptions.showMobilePane=e.canShowMobileVisualizationPane()}))},r.prototype.initializeLayoutCapabilities=function(){var e=this,t=function(){return 1===e.viewModeState.getMode()},i=function(){return 0===e.viewModeState.getMode()},r=(n={},n[0]={canMoveMultipleVisuals:_.noopTrue,canShowCanvasBackground:_.noopTrue,canShowCanvasBackdrop:_.noopFalse,canShowCodePane:_.noopTrue,canShowVisualContainerHeader:_.noopTrue,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopFalse,canShowLayoutGrid:t,canRemoveVisualFromLayout:_.noopFalse,canCutCopyPaste:_.noopTrue,canDelete:_.noopTrue,canPassUnhandledKeysToSelectedVisual:_.noopTrue,canAddRemoveSections:t,canShowVisualToolbar:t},n[1]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopFalse,canShowCanvasBackdrop:t,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:i,canShowVisualContainerHeaderInset:_.noopTrue,canShowMobileVisualizationPane:t,canShowLayoutGrid:t,canRemoveVisualFromLayout:t,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopFalse,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},n[2]={canMoveMultipleVisuals:_.noopFalse,canShowCanvasBackground:_.noopFalse,canShowCanvasBackdrop:_.noopTrue,canShowCodePane:_.noopFalse,canShowVisualContainerHeader:_.noopFalse,canShowVisualContainerHeaderInset:_.noopFalse,canShowMobileVisualizationPane:_.noopTrue,canShowLayoutGrid:_.noopFalse,canRemoveVisualFromLayout:_.noopTrue,canCutCopyPaste:_.noopFalse,canDelete:_.noopFalse,canPassUnhandledKeysToSelectedVisual:_.noopFalse,canAddRemoveSections:_.noopFalse,canShowVisualToolbar:_.noopFalse},n);return o.deepFreeze(r),r;var n},r.prototype.getTelemetryViewMode=function(t){switch(t){case 0:return e.telemetry.ViewMode.View;case 1:return e.telemetry.ViewMode.Edit}},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o){return new a(e,t,i,r,o)}var r=e.data.SemanticQuery,o=e.explore.util.VisualHostServicesUtil,n=e.explore.contracts.VisualQuery;t.createGroupQueryService=i;var a=(function(){function i(e,t,i,r,o){this.conceptualSchemaProxy=i,this.visualQueryGenerator=r,this.promiseFactory=o,this.singleExecutableDataProxyFactory=e,this.filterGenerator=t,this.reset()}return i.prototype.getValuesForColumn=function(t,i,a){var s=this,l=this.promiseFactory.defer();return this.conceptualSchemaProxy.get(i).then((function(c){var u=new n(r.create(),{});u.add(t,"Values"),s.runQueryImpl({dataSources:i,schema:c,config:{visualType:e.visuals.plugins.table.name,query:u},hostServices:o.createQueryVisualHostServices(),visualQueryGenerator:s.visualQueryGenerator,isLoadMore:a,preferCurrentData:!a,allowCache:!1,isInitialLoad:!a}).then((function(e){s.lastResult=e?{table:e.dataReaderResult.dataView.table,canLoadMore:s.dataProxy.canLoadMore()}:s.lastResult,l.resolve(s.lastResult)}),(function(e){l.reject(e)}))}),(function(e){l.reject(e.clientError)})),l.promise},i.prototype.reset=function(){this.conceptualSchemaProxy.clearCache(),this.dataProxy=t.createExploreVisualDataProxyService(this.singleExecutableDataProxyFactory.create(),this.filterGenerator)},i.prototype.runQueryImpl=function(e){return this.dataProxy.runQuery(e)},i})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,n,s,l,c){return new a(e,t,i,r,o,n,s,l,c)}var r=e.explore.services.events,o=e.explore.util.ResourcePackageUtils;t.createImportVisualService=i;var n="/powerbi/content/visual",a=(function(){function t(e,t,i,r,o,n,a,s,l){this.eventBridge=e,this.modalDialogService=t,this.$rootScope=i,this.localizationService=r,this.errorService=o,this.notificationToast=n,this.telemetryService=a,this.visualPluginService=s,this.upload=l}return t.prototype.createFileDialogInput=function(){return $('<input id="myInput" type="file" style="visibility:hidden" accept=".pbiviz" />')},t.prototype.importWithDialog=function(t){var i,r=this,o=this.createFileDialogInput();o.on("change",(function(){var a=o[0];if(a.files){if(i=a.files[0],!/.*\.pbiviz$/.test(i.name))return void r.showImportErrorDialog();var s=e.common.httpService.powerbiRequestOptions();s.retryCount=0,s.headers[e.common.constants.uploadFileSizeHeaderName]=i.size.toString(),r.notifyWhenLoadingCustomVisual("ImportCustomVisualLoadingTitle",0,"ImportCustomVisualLoadingMessage");var l=r.telemetryService.startEvent(e.telemetry.EXImportCustomViz,i.name,-1,"");r.upload.post(n,[i],s).then((function(e){var i=e.data;null==i.type&&(i.type=0);for(var o=0,n=i.items;o<n.length;o++){var a=n[o];null==a.type&&(a.type=0)}r.import(t,i),l.event.info.resourcePackageId=i.id,l.event.info.resourcePackageName=i.name,l.resolve()}),(function(e){r.showImportErrorDialog();var t=e&&e.error?e.error.code:"-1",i={errorCode:jsCommon.StringExtensions.format("Import of custom visual failed -> Code: {0}",t)};l.reject(i)}))}})),o.click()},t.prototype.showImportErrorDialog=function(){var e=this.$rootScope.$new();e.errorService=this.errorService;var t={dialogName:this.localizationService.get("ImportVisual_ErrorDialogHeader"),isDismissable:!0,scope:e,template:"<import-visual-error-dialog></import-visual-error-dialog>",dialogCssClass:"importVisualError"};this.modalDialogService.showLegacyWebModalDialog(t)},t.prototype.import=function(e,t){var i=this;return this.visualPluginService.ensurePlugins([t],!0).then((function(){o.ensureResourcePackages(e),_.remove(e.resourcePackages,(function(e){return e.name===t.name})),e.resourcePackages.push(t),i.eventBridge.publishToChannel(r.addCustomVisual,t),i.eventBridge.publishToChannel(r.visualPluginsChanged),i.notificationToast.hide(i.toastNotificationId),i.toastNotificationId=void 0}))},t.prototype.notifyWhenLoadingCustomVisual=function(t,i,r){var o=this;this.localizationService.ensureLocalization((function(){o.toastNotificationId=o.notificationToast.notify({title:o.localizationService.get(t),message:o.localizationService.get(r),notificationType:e.common.NotificationToastType.Loading})}))},t})()})(i=t.services||(t.services={}))})(t=e.exploreui||(e.exploreui={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r){return new v(e,t,i,r)}var o=e.explore.contracts.FilterType,n=e.data.Selector,a=e.data.SemanticFilter,s=e.data.SQExpr,l=e.data.SQExprBuilder,c=e.data.SQExprUtils,u=e.visuals.valueFormatter,d=e.data.VariationRewriter,p=e.explore.util.VisualContainerUtils;i.createIncludeExcludeService=r;var v=(function(){function r(e,t,i,r){this.eventBridge=e,this.localizationService=t,this.undoRedoService=i,this.telemetry=r}return r.prototype.setFilter=function(r,a,s){var l=this,c=_.map(a,(function(e){return n.convertSelectorsByColumnToSelector(e)})),u=_.find(s.filters,(function(e){return e.howCreated===r})),d=2;u||(u={howCreated:r,name:t.FilterUtils.getNextFilterName(s.filters),type:3===r?o.Include:o.Exclude},d=1);var v=u.filter;v=3===r?this.getIncludeFilter(c):this.getExcludeFilter(v,c),this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){u.filter=v;var o={container:s,scopeType:0};1===d&&(t.FilterUtils.add(o.container,u),l.telemetry.logEvent(e.telemetry.EXAddFilter,3===r?e.telemetry.FilterType.Include:e.telemetry.FilterType.Exclude,e.telemetry.FilterScopeType.Visual,e.telemetry.FieldKind.Entity,p.hasGroupByItemsInQuery(s)));var n={filter:u,changeType:d,scope:o};l.eventBridge.publishToChannel(i.events.filterContainerChanged,n)}))},r.prototype.buildViewModel=function(e,t){for(var i=e.where(),r=[],o=0,n=i;o<n.length;o++){var a=n[o],s=a.condition,l=new h;s.accept(l),r.push.apply(r,l.dataPoints)}return{points:r,filter:e,restatement:this.getRestatement(t,r.length)}},r.prototype.updateFilterContainer=function(e,t){var r=this,o=e.contract,n=o.type,a=this.buildFilter(t,n);this.undoRedoService.register("UpdateIncludeExcludeFilter",(function(){var t=e.getFilterContainerScope();o.filter=a;var n={filter:o,changeType:2,scope:t};r.eventBridge.publishToChannel(i.events.filterContainerChanged,n)}))},r.prototype.isIncludeExcludeSupported=function(e,t,i){if(e&&e.config&&e.config.singleVisual){var r=e.config.singleVisual,o=r.query;if(o){if(i)return!0;for(var n=o.defn.select(),a=void 0,l=0,u=n;l<u.length;l++){var p=u[l],v=p.expr;if(!c.isMeasure(v)){v=d.run(v,t);var h=v.getTargetEntity();if(a){if(!s.equals(a,h))return!1}else a=h}}return!0}}return!1},r.prototype.buildFilter=function(t,i){for(var r,n=t.points[0],a=l.inValues(n.columns,[n.values]),s=1;s<t.points.length;s++)n=t.points[s],r=l.inValues(n.columns,[n.values]),a=l.or(a,r);return i===o.Exclude&&(a=l.not(a)),e.data.SemanticFilter.fromSQExpr(a)},r.prototype.getRestatement=function(e,t){var i=null;return i=e===o.Include?this.localizationService.get("FilterPane_Include"):this.localizationService.get("FilterPane_Exclude"),i+" ("+t+")"},r.prototype.getIncludeFilter=function(t){var i=n.filterExprsFromSelectors(t);return e.DataViewScopeIdentity.filterFromExprs(i,!1)},r.prototype.getExcludeFilter=function(t,i){var r=n.filterExprsFromSelectors(i);if(t){var o=_.find(t.where(),(function(e){return 16===e.condition.kind}));if(o){for(var s=o.condition,c=s.arg,u=0,d=r;u<d.length;u++){var p=d[u],v=e.data.ScopeIdentityExtractor.getInExpr(p);c=l.or(c,v)}return c=l.not(c),a.fromSQExpr(c)}}return e.DataViewScopeIdentity.filterFromExprs(r,!0)},r})();i.IncludeExcludeService=v;var h=(function(e){function t(){e.apply(this,arguments),this.dataPoints=[]}return __extends(t,e),t.prototype.visitNot=function(e){e.arg.accept(this)},t.prototype.visitOr=function(e){e.left.accept(this),e.right.accept(this)},t.prototype.visitIn=function(e){for(var t=[],i=e.args,r=0;r<e.values.length;r++){var o=e.values[r];t.push({values:o,columns:i,text:this.getDataPointText(i,o),expr:e,index:r})}(n=this.dataPoints).push.apply(n,t);var n},t.prototype.getDataPointText=function(e,t){for(var i="",r=0;r<e.length;r++){var o=t[r],n=e[r];i+=u.format(o.value)+" ("+n.ref+") - "}return i=i.slice(0,i.length-3)},t})(e.data.DefaultSQExprVisitor)})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){var e=250,t=250;return new i(e,t)}e.createLayoutInsertionHelper=t;var i=(function(){function e(e,t){this.emptySpaceMinWidth=e,this.emptySpaceMinHeight=t}return e.prototype.getEmptySpaces=function(e,t){for(var i=this.getNonOverlapingRects(e,t),r=this.filterWithMinimumWidth(i),o=[],n=0,a=r;n<a.length;n++){var s=a[n],l=this.extendRect(s,i);l.height>=this.emptySpaceMinHeight&&o.push(l)}return o},e.prototype.extendRect=function(e,t){for(var i,r=!1,o=0,n=t;o<n.length;o++){var a=n[o];if(a!==e){var s=!1,l=!1;if(this.doIntersect(a,e)&&(s=a.y+a.height===e.y,l=a.y===e.y+e.height),!(a.width<e.width))if(l){var c={x:e.x,y:e.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}else if(s){var c={x:e.x,y:a.y,width:e.width,height:e.height+a.height},u=this.getIntersectingRectangle(c,a);u&&u.width===c.width&&(r=!0,i=c)}}}return r?this.extendRect(i,t):e},e.prototype.getIntersectingRectangle=function(e,t){var i=Math.max(e.x,t.x),r=Math.min(e.x+e.width,t.x+t.width),o=Math.max(e.y,t.y),n=Math.min(e.y+e.height,t.y+t.height);return i<=r&&o<=n?{x:i,y:o,width:r-i,height:n-o}:null},e.prototype.doIntersect=function(e,t){return!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y)},e.prototype.filterWithArea=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>0&&o.height>0&&t.push(o)}return t},e.prototype.filterWithMinimumWidth=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var o=r[i];o.width>=this.emptySpaceMinWidth&&t.push(o)}return t},e.prototype.splitRectangleOnIntersection=function(e,t){var i=this.getIntersectingRectangle(e,t);return i?this.filterWithArea([{x:e.x,y:e.y,width:e.width,height:i.y-e.y},{x:e.x,y:i.y+i.height,width:e.width,height:e.y+e.height-(i.y+i.height)},{x:e.x,y:i.y,width:i.x-e.x,height:i.height},{x:i.x+i.width,y:i.y,width:e.x+e.width-(i.x+i.width),height:i.height}]):[e]},e.prototype.getNonOverlapingRects=function(e,t){if(!t.length)return[];for(var i=[e],r=0;r<t.length;r++){for(var o=[],n=0;n<i.length;n++)o=o.concat(this.splitRectangleOnIntersection(i[n],t[r]));i=o}return i},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,n,a,s,l){return new o(e,t,i,r,n,a,s,l)}i.createModelChangeHandler=r;var o=(function(){function r(e,t,r,o,n,a,s,l){var c=this;this.dataProxy=t,this.eventBridge=n,this.undoRedoService=a,this.visualPluginService=s,this.conceptualSchemaProxy=e,this.promiseFactory=l,this.dataSources=o,this.scope=r,this.handlerTokens=[];var u=n.createChannelSubscriptionManager().subscribe(i.events.explorationLoaded,(function(e,t){return c.currentExplorationContract=t}));r.$on("$destroy",(function(){return u.unsubscribeAll()}))}return r.prototype.applyChange=function(r){var o=this,n=r.providerType;n||(n="dsr");var a=t.contracts.DataSource.referenced(this.dataSources.get(),null);if(a){var s=this.conceptualSchemaProxy,l=this.dataProxy;s.stopCommunication(new e.IgnorableClientError),s.clearCache(),l.stopCommunication(n),r.change.then((function(t){t.isSchemaChangeListComplete||l.clearCache(n,a);var s;if(t&&(s=t.changes)&&!_.isEmpty(s)){t.isSchemaChangeListComplete&&"dsr"===n&&e.data.dsr.createQueryCacheHandler().apply(l,a,s);var c=o.currentExplorationContract;c&&i.createSchemaChangeHandler(o.visualPluginService).apply(c,s)}o.conceptualSchemaProxy.resumeCommunication();var u=[];try{for(var d=0,p=o.handlerTokens;d<p.length;d++){var v=p[d];u.push(v.handle(t))}}finally{o.promiseFactory.all(u).finally((function(){o.dataProxy.resumeCommunication(n),r.leaveUndo||(o.undoRedoService.canUndo()||o.undoRedoService.canRedo())&&(o.undoRedoService.clear(),o.eventBridge.publishToChannel(i.events.undoRedoStackCleared));var e=o.eventBridge;e.publishToChannel(i.events.enableEditing),e.publishToChannel(i.events.modelChanged,t),e.publishToChannel(i.events.visualContainerChanged,{affectContainer:function(){return!0}})}))}}),(function(){return o.resumeCommunication(n)}))}},r.prototype.register=function(e){var t=this,i={handle:e,stopHandling:function(){var e=t.handlerTokens.indexOf(i);e>-1&&t.handlerTokens.splice(e,1)}};return this.handlerTokens.push(i),i},r.prototype.resumeCommunication=function(e){this.conceptualSchemaProxy.resumeCommunication(),this.dataProxy.resumeCommunication(e)},r})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a){return new l(e,t,i,r,o,n,a)}var o=jsCommon.ArrayExtensions,n=e.data.QueryProjectionsByRole,a=e.data.dsr.transformDataQueryToSemanticQueryDataShapeCommand,s=t.util.VisualContainerUtils;i.createPinVisualService=r;var l=(function(){function t(e,t,i,r,o,n,a){this.conceptualSchemaProxy=e,this.displayNameService=t,this.dataProxy=i,this.featureSwitchService=r,this.resourcePackagesService=o,this.visualQueryGenerator=n,this.visualPlugin=a}return t.prototype.getPinData=function(e,t,i,r,o,n,a,l){var c;if(n){var u=n.options.query.command,d=s.describeForPinning(this.displayNameService,l,t.query,this.visualPlugin.capabilities(e).dataViewMappings,r?r.filterMetadata:null);c={query:u,dataViewSource:o?o.dataViewSource:null,visualType:e,queryMetadata:d.queryMetadata,elements:d.visualElements,objects:t.objects,tileHeading:t.title&&t.title.text,themeName:a,stylePresetName:t.stylePresetName&&t.stylePresetName,tileLayoutType:i,dataTransforms:n.transforms}}else c={visualType:e,objects:t.objects,dataViewSource:{data:void 0},themeName:a,stylePresetName:t.stylePresetName&&t.stylePresetName,tileLayoutType:i};return this.addResourcePackageIdToPinData(e,c)},t.prototype.pinVisualContainer=function(t,i,r,o,n){var s=this,l=this.handler,c=r===e.visuals.plugins.image.name?e.common.contracts.TileLayoutType.Full:e.common.contracts.TileLayoutType.Default;this.conceptualSchemaProxy.get(t).then((function(u){var d,p=i.config.singleVisual;if(s.visualQueryGenerator.shouldExecute(p,t)){var v=e.common.GridLayoutConstants.getDefaultGridItemViewport(e.common.GridLayoutConstants.getMediumLandscapeGridItem());d=s.visualQueryGenerator.execute({config:p,dataSources:t,schema:u,additionalFilters:o,dataWindow:v,ignoreViewportForCache:!0,allowClientSideFilters:!1})}if(d){var h=d.options.query.command,g=a(h);s.modifyPinnedVisualDataShapeBinding(g.Binding,p.query,u,r),s.dataProxy.execute(d.options).then((function(e){var t=s.getPinData(r,p,c,o,e,d,n,u);l&&l.pinVisual(t)}),(function(){}))}else{var f=s.getPinData(r,p,c,null,null,null,n,null);l&&l.pinVisual(f)}}))},t.prototype.canPinVisualType=function(t){return null!=t&&null!=this.visualPlugin.getPlugin(t)&&t!==e.visuals.plugins.slicer.name&&t!==e.visuals.plugins.basicShape.name},t.prototype.setHandler=function(e){this.handler=e},t.prototype.modifyPinnedVisualDataShapeBinding=function(e,i,r,a){var s=this.visualPlugin.capabilities(a);if(t.isTableOrMatrix(a))return e.DataReduction||(e.DataReduction={}),void(e.DataReduction.Primary={Window:{Count:100}});if(t.supportsScalarCategoryAxis(s)){var l=i.projections,c=i.defn.select();if(!l||_.isEmpty(c))return;var u="Category",d=n.getRole(l,u);if(!d||_.isEmpty(d.all()))return;var p=d.getLastActiveQueryReference()||d.all()[0].queryRef,v=o.findItemWithName(c,p);if(!v)return;var h=v.expr.getMetadata(r);h&&0===h.kind&&h.type.dateTime&&(e.DataReduction||(e.DataReduction={}),e.DataReduction.Primary={Bottom:{}})}},t.prototype.addResourcePackageIdToPinData=function(e,t){if(this.visualPlugin.isCustomVisual(e)){var i=this.resourcePackagesService.getPackage(e);i&&(t.resourcePackageIds=[i.id])}return t},t.supportsScalarCategoryAxis=function(e){return e.objects&&e.objects.categoryAxis&&e.objects.categoryAxis.properties&&void 0!==e.objects.categoryAxis.properties.axisType},t.isTableOrMatrix=function(t){var i=e.visuals.plugins;return t===i.table.name||t===i.matrix.name},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(){return new r}t.createShellService=i;var r=(function(){function t(){}return t.prototype.canShowHiddenSchemaItem=function(){return!1},t.prototype.canToggleSchemaItems=function(){return!0},t.prototype.setShowHiddenSchemaItem=function(e){},t.prototype.areScriptVisualsApproved=function(){return!0},t.prototype.approveScriptVisuals=function(){e.contract.fail("ShellService.approveScriptVisuals is not available in ExploreUI view")},t.prototype.showEditQueriesEditor=function(e){},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r){return new n(e,t,i,r)}var r=e.common.models.CollapsiblePaneExpandedWidth,o=e.common.constants.TaskPaneCollapsiblePaneMode;t.createSubscriptionPaneService=i;var n=(function(){function t(e,t,i,r){this.taskPaneSliderService=e,this.userInfo=t,this.localizationService=i,this.licenseHelperService=r}return t.prototype.expandPaneForReportSubscription=function(t,i){var n=this;this.taskPaneSliderService.isPaneExpanded()||this.userInfo.userMetadataPromise.then((function(){n.userInfo.isPremiumUser?(n.reportInfo=t,n.currentSubscriptionGUID=i,n.taskPaneSliderService.expandPane(o.EmailSubscription,r.Small)):n.licenseHelperService.displayFeatureDisabledErrorMessage(e.telemetry.LicenseEnforcementOperation.EmailSubscription,n.localizationService.get("UpgradeAccount_EmailSubscriptionMessage"),n.localizationService.get("UpgradeAccount_EmailSubscriptionTitle"));
}))},t.prototype.collapseSubscriptionPane=function(){this.taskPaneSliderService.isPaneExpanded()&&(this.taskPaneSliderService.collapsePane(),this.currentSubscriptionGUID=void 0)},t.prototype.getReportInfo=function(){return this.reportInfo},t.prototype.getCurrentSubscriptionGUID=function(){return this.currentSubscriptionGUID},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(e){var t;!(function(e){function t(){return new n}function i(){return{supportsPinning:void 0,supportsDeletion:void 0,enablePenAnnotation:!1,visualDoubleClickEnabled:!1,displayOptions:{canShowCanvasWatermark:!1,hideVisualBorders:!1,hideVisualizationPane:!1,hideVisualBodyTitle:!1,hideTileMenu:!1,hideNavigationPane:!1,disableFadeout:!1,showMobilePane:!1,hideInFocusBar:!1,hideInFocusTileMenu:!1,hideCanvasSwipeHandles:!1},touchOptions:{deselectVisualOnCanvasScroll:!1,disableCanvasScrollOnSelectedVisual:!1,disableTouchZoom:!1,isCanvasSwipeable:!1,touchEventsOnSelectedVisualOnly:!1,disableCanvasPinch:!1},penProperties:{strokeStyle:r.DefaultPenStrokeStyle,lineWidth:r.DefaultPenLineWidth,opacity:r.DefaultPenOpacity}}}var r,o=jsCommon.FreezeUtility;!(function(e){e.DefaultPenStrokeStyle="#939598",e.DefaultPenLineWidth=20,e.DefaultPenOpacity=1})(r=e.annotations||(e.annotations={})),e.createViewModeState=t;var n=(function(){function e(){this.config=i(),this.freeze()}return e.prototype.getConfig=function(){return this.frozenConfig},e.prototype.updateConfig=function(e){e&&(e(this.config),this.freeze())},e.prototype.getMode=function(){return this.mode},e.prototype.setMode=function(e){this.mode=e},e.prototype.freeze=function(){var e=_.cloneDeep(this.config);o.deepFreeze(e),this.frozenConfig=e},e})()})(t=e.services||(e.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,s,l,c,d,p,v,h,g,f,m,y,w,C){return new u(e,t,i,r,o,n,a,s,l,c,p,d,v,h,g,f,m,y,w,C)}var o=(e.data,e.data.segmentation.DataViewMerger),n=e.data.services.DataViewTransformActionsSerializer,a=e.data.dsr,s=e.visualHost.ResourcePackageReferenceResolver,l=t.util.VisualContainerUtils,c=e.visualHost;i.createVisualContainerQueryHandler=r;var u=(function(){function r(e,i,r,o,n,a,s,l,c,u,d,p,v,h,g,f,m,y,w,C){this.queryExecutionServices=e,this.hostServices=i,this.promiseFactory=r,this.conceptualSchemaProxy=o,this.visualQueryGenerator=s,this.visualPlugin=l,this.filterGenerator=v,this.scriptVisuals=h,this.displayNameService=g,this.explorationNavigation=f,this.resourceLoader=m,this.eventBridge=y,this.shell=w,this.localizationService=C,this.visualDataProxyExecutionService=t.services.createVisualDataProxyExecutionService(r,o,n,a,s,l,c,t.services.createExploreVisualDataProxyService(p.create(),v),u,d)}return r.prototype.runQuery=function(e){var t=this,i=this.queryExecutionServices.getDataSources(),r=e.contract;if(!this.shouldBlockVisualQuery(r)&&this.visualQueryGenerator.shouldExecute(r.config.singleVisual,i)){var o=this.visualDataProxyExecutionService.runQuery({dataSources:i,contract:r,viewport:e.viewport,hostServices:this.hostServices,initialLoad:e.initialLoad,useVisualContainerCache:e.useVisualContainerCache,preferCurrentData:e.preferCurrentData,allowCache:e.allowCache}),n=r.config.singleVisual.visualType,a=r.config.singleVisual.objects,s=this.loadResourcePackageReferences(n,a);e.geocodingTracker&&e.geocodingTracker.newQuery(),this.queryExecutionServices.notifyStart();var l=!1;o.previewPromise.then((function(e){e&&!l&&t.resolveResourcePackageReferences(n,e.dataProxyQuery.transforms.objects).then((function(i){t.handleQueryResult(r,e.result,e.dataProxyQuery,i)}))})),o.finalPromise.then((function(i){s.then((function(){var o;i&&(o={updateContractCache:!0,updateServerCache:i.updateServerVisualContainerCache}),t.resolveResourcePackageReferences(n,i.dataProxyQuery.transforms.objects).then((function(n){t.handleQueryResult(r,i&&i.result,i.dataProxyQuery,n,o,e.currentData)}))}))}),(function(e){t.queryExecutionServices.handleErrors(e)})).finally((function(){l=!0,t.queryExecutionServices.notifyEnd()}))}},r.prototype.loadMoreData=function(e){var t=this;this.queryExecutionServices.notifyStart(),this.getNextDataSegment(e).then((function(i){i&&t.mergeMoreData(i.result,i.dataProxyQuery,e.currentData)})).finally((function(){t.queryExecutionServices.notifyEnd()}))},r.prototype.getNextDataSegment=function(e){var t=this,i=this.promiseFactory.defer();return this.visualDataProxyExecutionService.canLoadMoreData()?this.visualDataProxyExecutionService.loadMoreData({dataSources:this.queryExecutionServices.getDataSources(),contract:e.contract,hostServices:this.hostServices,viewport:e.viewport,useVisualContainerCache:e.useVisualContainerCache}).then((function(e){t.handleLoadMoreDataWarnings(e&&e.result,e&&e.dataProxyQuery),i.resolve(e)}),(function(e){t.queryExecutionServices.handleErrors(e),i.reject(e)})):i.reject("Cannot load more data"),i.promise},r.prototype.mergeMoreData=function(e,t,i){var n=r.getDataProxyQueryExecutionResultWarnings(e,t),a=e?e.dataReaderResult.dataView:null;if(a){var s=i.dataView;o.mergeDataViews(s,a);var l={dataView:s,dataViewSource:e&&e.dataViewSource,isFirstSegment:!1};_.isEmpty(n)||(l.warnings=n),this.queryExecutionServices.loadMergedData(l)}},r.prototype.visualizeDataViewSource=function(e,t,i){var r=this,o=a.read(31,t.data),n=o.error;if(n)return void this.queryExecutionServices.handleErrors(n);var s=this.queryExecutionServices.getDataSources(),l=e&&e.config&&e.config.singleVisual;s&&l&&this.conceptualSchemaProxy.get(s).then((function(n){var a=r.visualQueryGenerator.execute({config:l,dataSources:s,schema:n,additionalFilters:r.hostServices.getFilters(r.filterGenerator,n),restartToken:o.restartToken,dataWindow:i});if(a){var c=r.promiseFactory.defer();c.resolve(a.options),r.handleQueryResult(e,{dataViewSource:t,dataReaderResult:o},{transforms:a.transforms,error:a.error,warnings:a.warnings,options:c.promise},null,{updateContractCache:!0})}}))},r.prototype.updateNonQueryVisual=function(e,t){var i=this,r={dataView:null,dataViewSource:null};if(t){var o=e.config.singleVisual.visualType,n=e.config.singleVisual.objects;this.queryExecutionServices.notifyStart(),this.resolveResourcePackageReferences(o,n).then((function(e){i.queryExecutionServices.applyUpdate(r,t,e)})).finally((function(){i.queryExecutionServices.notifyEnd()}))}else this.queryExecutionServices.applyUpdate(r,t,null)},r.prototype.validate=function(t){if(l.isScriptVisual(t,this.visualPlugin)){var i=this.scriptVisuals.getScriptVisualErrorDetails();if(i)return{details:i,code:"ScriptVisualError"}}var o=l.getVisualType(t);if(o&&!this.visualPlugin.getPlugin(o)){if(!this.visualPlugin.isCustomVisual(o)){var i=r.buildErrorDetails(this.localizationService.get("VisualContainer_UnableToFindVisualMessage"),this.localizationService.get("VisualContainer_UnableToFindVisualKey"),this.localizationService.get("VisualContainer_UnableToFindVisualValue"));return{details:i,code:"UnsupportedVisual"}}}else if(c.utils.shouldDisableVisual(o,e.common.localize.shouldDisableMap())){var i=r.buildErrorDetails(this.localizationService.get("VisualContainer_NotSupportedForLocaleMessage"),this.localizationService.get("VisualContainer_NotSupportedForLocaleKey"),this.localizationService.get("VisualContainer_NotSupportedForLocaleValue"));return{details:i,code:"NotSupportedForLocale"}}},r.prototype.updateContractCache=function(t,i,r){var o=this;if(!t)return this.promiseFactory.reject(null);var n=this.queryExecutionServices.getDataSources();if(!n)return this.promiseFactory.reject(null);var a=t.cachedData&&t.cachedData.dataUpdatedTime?t.cachedData.dataUpdatedTime:null,s=i&&i.dataViewSource?i.dataViewSource.data:void 0,c=r&&r.error;return i&&i.dataReaderResult&&i.dataReaderResult.disallowPersisting&&(a=null,s=null,c=new e.IgnorableClientError),this.conceptualSchemaProxy.get(n).then((function(e){return r.options.then((function(i){var n={transforms:r.transforms,error:c,warnings:r.warnings,options:i};t.cachedData=l.createCacheEntry(o.visualPlugin,o.displayNameService,s,n,e,t.config.singleVisual,o.filterGenerator.generateFilterMetadata(t.filters),a)}))}))},r.prototype.handleQueryResult=function(e,t,o,n,a,s){var c=this;void 0===a&&(a={}),this.queryExecutionServices.clearErrors();var u=r.getDataProxyQueryExecutionResultWarnings(t,o);u&&this.queryExecutionServices.handleWarnings(u,o.transforms);var d;if(t){d={dataView:t&&t.dataReaderResult?t.dataReaderResult.dataView:null,dataViewSource:t&&t.dataViewSource?t.dataViewSource:null},u&&(d.warnings=u);var p=l.isSegment(d.dataView);p&&(d.isFirstSegment=p)}else d={dataView:s&&s.dataView,dataViewSource:s&&s.dataViewSource};if(this.queryExecutionServices.applyUpdate(d,o.transforms,n),a.updateContractCache){var v=t&&t.dataViewSource?t.dataViewSource.data:void 0,h=this.updateContractCache(e,v,o);a.updateServerCache&&h.then((function(){o.options.then((function(t){var r=e.id,o={visualContainerId:r,query:JSON.stringify(t.query.command),dataTransforms:c.getCachedTransformsString(e)};c.eventBridge.publishToChannel(i.events.newQueryCacheResultAvailable,o)}))}))}},r.prototype.handleLoadMoreDataWarnings=function(e,t){this.queryExecutionServices.clearErrors();var i=r.getDataProxyQueryExecutionResultWarnings(e,t);i&&this.queryExecutionServices.handleWarnings(i,t.transforms)},r.prototype.getCachedTransformsString=function(e){if(e.cachedData){var t=e.cachedData.transformsObject;if(t)return n.serializeTransformActions(t)}},r.prototype.shouldBlockVisualQuery=function(e){if(l.isScriptVisual(e,this.visualPlugin)&&(!this.shell.areScriptVisualsApproved()||this.scriptVisuals.shouldBlockScriptVisual())){var t=l.getVisualType(e);return this.eventBridge.publishToChannel(i.events.visualContainerQueryBlocked,{visualType:t}),!0}return!1},r.prototype.loadResourcePackageReferences=function(e,t){var i=this.visualPlugin.capabilities(e),r=i&&i.objects,o=this.explorationNavigation.getCurrentExploration();return s.loadFromDataViewObjects(t,r,o?o.resourcePackages:null,this.resourceLoader,this.promiseFactory)},r.prototype.resolveResourcePackageReferences=function(e,t){var i=this.visualPlugin.capabilities(e),r=i&&i.objects,o=this.explorationNavigation.getCurrentExploration();return s.loadAndResolveFromDataViewObjects(t,r,o?o.resourcePackages:null,this.resourceLoader,this.promiseFactory)},r.getDataProxyQueryExecutionResultWarnings=function(e,t){return t&&!_.isEmpty(t.warnings)?t.warnings:e&&e.dataReaderResult&&!_.isEmpty(e.dataReaderResult.warnings)?e.dataReaderResult.warnings:void 0},r.buildErrorDetails=function(e,t,i){return{message:e,displayableErrorInfo:[{errorInfoKey:t,errorInfoValue:i}]}},r})();i.VisualContainerQueryHandler=u})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e,t,i,r,o,n,a,l,c,u){return new s(e,t,i,r,o,n,a,l,c,u)}var o=e.data.services.DataViewTransformActionsSerializer,n=e.data.dsr,a=t.util.VisualContainerUtils;i.createVisualDataProxyExecutionService=r;var s=(function(){function t(e,t,i,r,o,n,a,s,l,c){this.promiseFactory=e,this.conceptualSchemaProxy=t,this.featureSwitchService=i,this.telemetryService=r,this.visualQueryGenerator=o,this.visualPlugin=n,this.dataProxy=a,this.visualDataProxyService=s,this.networkAvailability=l,this.embedTypeDescription=c.getEmbedTypeDescription()}return t.prototype.runQuery=function(e){var t=this,i=this.promiseFactory.defer(),r=this.promiseFactory.defer(),o={previewPromise:i.promise,finalPromise:r.promise};return this.applyVisualCache(e,i,r).then((function(i){i&&t.runQueryImpl(e,r,!1)})),o},t.prototype.applyVisualCache=function(t,i,r){var o=this,n=this.promiseFactory.defer(),s=this.featureSwitchService.featureSwitches.embeddedEnabled,l=t.contract;if(t.useVisualContainerCache&&t.initialLoad||s){var c=a.hasOnPremDataSource(t.dataSources);this.retrieveFromVisualContainerCache(t.dataSources,l,t.viewport,t.hostServices).then((function(t){t.isFinal||s||!o.networkAvailability.isNetworkAvailable()?(i.reject(),r.resolve(t.result),n.resolve(!1),s||o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.Cache,c,e.telemetry.VisualInitialLoadTypeWarning.None,o.embedTypeDescription)):(i.resolve(t.result),n.resolve(!0),s||o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.StaleCache,c,e.telemetry.VisualInitialLoadTypeWarning.None,o.embedTypeDescription))}),(function(t){i.reject(),l.useInitialCachedQuery=!1,s?(r.reject(),n.resolve(!1)):(n.resolve(!0),o.telemetryService.logEvent(e.telemetry.EXVisualFirstLoad,e.telemetry.VisualInitialLoadType.NoCache,c,t,o.embedTypeDescription))}))}else i.reject(),n.resolve(!0);return n.promise},t.prototype.runQueryImpl=function(e,t,i){var r=this,o=e.contract,n=e.dataSources,a=e.initialLoad&&!!e.useVisualContainerCache;return!o||!o.config||o.useInitialCachedQuery&&a||!this.visualQueryGenerator.shouldExecute(o.config.singleVisual,n)?void t.resolve(null):void this.conceptualSchemaProxy.get(n).then((function(s){var l={dataSources:n,schema:s,config:o.config.singleVisual,hostServices:e.hostServices,visualQueryGenerator:r.visualQueryGenerator,isLoadMore:i,isInitialLoad:a,allowCache:e.allowCache,preferCurrentData:e.preferCurrentData,viewport:e.viewport};r.visualDataProxyService.runQuery(l).then((function(i){return r.loadData(i,s,o,a,e.useVisualContainerCache,t)}),(function(e){return t.reject(e)}))}),(function(e){t.reject(e?e.clientError:null)}))},t.prototype.canLoadMoreData=function(){return this.visualDataProxyService.canLoadMore()},t.prototype.loadMoreData=function(e){var t=this.promiseFactory.defer();return this.visualDataProxyService.canLoadMore()?this.runQueryImpl(e,t,!0):t.reject(),t.promise},t.prototype.loadData=function(e,t,i,r,o,n){var a=this.visualDataProxyService.lastExecutedQuery(),s=r&&o&&(this.isMissingVisualQueryOrDataTransformsContract(i)||this.isGeneratedQueryDifferentToContainerQuery(i,a)),l=this.promiseFactory.defer();l.resolve(a.options),n.resolve({result:e,dataProxyQuery:{transforms:a.transforms,error:a.error,warnings:a.warnings,options:l.promise},schema:t,updateServerVisualContainerCache:s})},t.prototype.isMissingVisualQueryOrDataTransformsContract=function(e){var t=a.getVisualType(e);return!(!t||!a.isQueryVisual(t,this.visualPlugin))&&(null==e.cachedData||null==e.cachedData.query&&null==e.cachedData.queryObject||!e.cachedData.transforms)},t.prototype.isGeneratedQueryDifferentToContainerQuery=function(e,t){var i=e.cachedData;if(i&&i.query){var r=JSON.stringify(t.options.query.command);return r!==i.query}return!1},t.prototype.retrieveFromVisualContainerCache=function(t,i,r,o){if(i.cachedData&&i.cachedData.data)return this.processVisualContainerCache(t,i,r,o);var n=this.promiseFactory.defer();return n.reject(e.telemetry.VisualInitialLoadTypeWarning.CacheMissing),n.promise},t.prototype.processVisualContainerCache=function(t,i,r,s){var l,c=this,u=this.promiseFactory.defer(),d=jsCommon.GzipUtility.uncompress(i.cachedData.data);try{l=JSON.parse(d)}catch(t){return u.reject(e.telemetry.VisualInitialLoadTypeWarning.JsonParseFailed),u.promise}var p=null;try{p=n.read(31,l)}catch(t){return u.reject(e.telemetry.VisualInitialLoadTypeWarning.DsrReadFailed),u.promise}if(!p)return u.reject(e.telemetry.VisualInitialLoadTypeWarning.DataObjectNull),u.promise;var v={data:l},h=a.getVisualType(i),g=this.visualPlugin.capabilities(h),f=g?g.objects:void 0,m=jsCommon.JsonExtensions.tryParseJSON(i.cachedData.transforms),y=m?o.deserializeDataViewTransformActions(m,f):void 0,w=this.promiseFactory.defer(),C={result:{dataViewSource:v,dataReaderResult:p},dataProxyQuery:{transforms:y,warnings:p.warnings?p.warnings:void 0,error:p.error,options:w.promise},schema:void 0,updateServerVisualContainerCache:!1};return p.error||!y?u.reject(p.error?e.telemetry.VisualInitialLoadTypeWarning.DsrHasOdataError:e.telemetry.VisualInitialLoadTypeWarning.DataTransformsMissing):(u.resolve({isFinal:i.useInitialCachedQuery,result:C}),i.useInitialCachedQuery&&this.conceptualSchemaProxy.get(t).then((function(e){var o=c.visualDataProxyService.generateQuery({dataSources:t,schema:e,config:i.config.singleVisual,hostServices:s,visualQueryGenerator:c.visualQueryGenerator,isLoadMore:!1,isInitialLoad:!1,allowCache:!0,viewport:r});c.dataProxy.setLocalCacheResult(o.options,l),w.resolve(o.options)}))),u.promise},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new o(e,t)}var r=jsCommon.JsonComparer;t.createExploreVisualDataProxyService=i;var o=(function(){function t(t,i){this.dataProxy=t,this.promiseFactory=e.createJQueryPromiseFactory(),this.filterGenerator=i}return t.prototype.generateQuery=function(e){return e.visualQueryGenerator.execute({config:e.config,dataSources:e.dataSources,schema:e.schema,additionalFilters:e.hostServices.getFilters(this.filterGenerator,e.schema),restartToken:e.preferCurrentData?this.currentDataToken:this.moreDataToken,cacheResponseOnServer:e.isInitialLoad,allowCache:e.allowCache,dataWindow:e.viewport})},t.prototype.runQuery=function(t){var i=this,o=this.promiseFactory.defer(),n=this.moreDataToken;if(t.isLoadMore||(this.moreDataToken=void 0),t.isLoadMore&&!this.moreDataToken)o.reject();else{var a=this.generateQuery(t);if(a)if(a.error)o.reject(a.error),this.generatedQuery=void 0;else{if(!(this.generatedQuery&&t.preferCurrentData&&r.equals(a.options,this.generatedQuery.options))){var s=this.dataProxy.execute(a.options);return s.then((function(e){i.generatedQuery=a,i.currentDataToken=i.moreDataToken,i.moreDataToken=e&&e.dataReaderResult&&e.dataReaderResult.restartToken,o.resolve(e)}),(function(e){i.generatedQuery=void 0,o.reject(e)})),s}o.resolve(null),this.generatedQuery=a,this.moreDataToken=n}else this.generatedQuery=void 0,o.reject()}return e.RejectablePromise2(o)},t.prototype.canLoadMore=function(){return null!=this.moreDataToken},t.prototype.lastExecutedQuery=function(){return this.generatedQuery},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t){return new o(e,t)}var r={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"},o=(function(){function t(e,t){this.geolocationService=e,this.geocoderService=t}return t.initialize=function(i){e.visuals.valueFormatter.setLocaleOptions(t.createLocaleOptions(i)),e.visuals.TooltipManager.setLocalizedStrings(t.createTooltipLocaleOptions(i)),e.data.DataViewTransform.setLocalizationOptions(t.createDataViewTransformLocalizationOptions(i))},t.createLocaleOptions=function(e){return{null:e.get("NullValue"),true:e.get("BooleanTrue"),false:e.get("BooleanFalse"),NaN:e.get("NaNValue"),infinity:e.get("InfinityValue"),negativeInfinity:e.get("NegativeInfinityValue"),beautify:function(i){return t.beautify(e,i)},describe:function(i){return t.describeUnit(e,i)},restatementComma:e.get("FilterRestatement_Comma"),restatementCompoundAnd:e.get("FilterRestatement_CompoundAnd"),restatementCompoundOr:e.get("FilterRestatement_CompoundOr")}},t.createTooltipLocaleOptions=function(t){return{highlightedValueDisplayName:t.get(e.visuals.ToolTipComponent.highlightedValueDisplayNameResorceKey)}},t.createDataViewTransformLocalizationOptions=function(t){return{quarterPrefix:t.get(e.visuals.ForecastHelper.quarterHierarchyLevelPrefixResorceKey)}},t.prototype.getLocalizedString=function(t){return e.common.localize.get(t)},t.prototype.onDragStart=function(){},t.prototype.canSelect=function(){return!1},t.prototype.onSelecting=function(){},t.prototype.onSelect=function(){},t.prototype.onContextMenu=function(){},t.prototype.loadMoreData=function(){},t.prototype.persistProperties=function(e){},t.prototype.onCustomSort=function(e){},t.prototype.getViewMode=function(){return 0},t.prototype.setWarnings=function(e){},t.prototype.setToolbar=function(e){},t.prototype.shouldRetainSelection=function(){return!1},t.prototype.geocoder=function(){return this.geocoderService},t.prototype.geolocation=function(){return this.geolocationService},t.prototype.locale=function(){return e.common.unmappedCultureInfo},t.prototype.promiseFactory=function(){return e.createJQueryPromiseFactory()},t.prototype.analyzeFilter=function(t){return e.explore.services.createAnalyzedFilter(t,!1)},t.prototype.getIdentityDisplayNames=function(e){},t.prototype.setIdentityDisplayNames=function(e){},t.prototype.tooltips=function(){},t.beautify=function(e,t){var i=r[t];return i?e.getOptional(i)||t:t},t.describeUnit=function(e,t){var i=t===-1?"Auto":t.toString(),r=e.getOptional("DisplayUnitSystem_E"+i+"_Title"),o=t<=0?"{0}":e.getOptional("DisplayUnitSystem_E"+i+"_LabelFormat");if(r||o)return{title:r,format:o}},t})();t.VisualHostServices=o,t.createVisualHostServices=i})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i,r,o,a){return new n(e,t,i,r,o,a)}var r=jsCommon.ArrayExtensions,o=e.data.SQExpr;t.createVisualSortHelper=i;var n=(function(){function e(e,t,i,r,o,n){this.setting=e,this.model=t,this.sort=i,this.undoRedo=r,this.timeout=o,this.visualAuthoring=n,this.sortDelay=500}return e.prototype.resetSortSettings=function(e,t){this.setting.defaultSortBehavior=t,this.setting.sortableFields=e},e.prototype.toggleSort=function(e,t){var i=this;this.sortPromise&&this.timeout.cancel(this.sortPromise),this.sortPromise=this.timeout((function(){i.undoRedo.register("VisualContainerToggleSort",(function(){var r=!1;return e?(t&&(e.sortDirection=t),i.sortByField(e),r=!0):void 0!==i.model.readOnlyState.actualSortDirection&&(i.sortByOrder(),r=!0),i.sortPromise=void 0,r}))}),this.sortDelay)},e.prototype.toggleDirection=function(e){return 1===e?2:1},e.prototype.sortByOrder=function(){var e=this.model.contract.config.singleVisual.query.defn.orderBy();if(!_.isEmpty(e)){for(var t=0,i=e;t<i.length;t++){var r=i[t];r.direction=this.toggleDirection(this.model.readOnlyState.actualSortDirection)}this.visualAuthoring.setOrderBy(this.model.contract,e)}},e.prototype.sortByField=function(e){var t=this,i=_.map(e.exprs,(function(t){return{direction:e.sortDirection||2,expr:t.expr}})),r=this.model.contract.config.singleVisual.query;e.active?this.visualAuthoring.removeOrderBy(this.model.contract,i.map((function(e){return e.expr}))):(this.sort.resetSort(r),this.resetSortableFieldsStatus(),this.visualAuthoring.setOrderBy(this.model.contract,i));var o=_.find(this.setting.sortableFields,(function(i){return t.compareSortableFieldExprs(e,i)}));o&&(o.active=!e.active)},e.prototype.resetSortableFieldsStatus=function(e){var t=e||!1;if(this.setting.sortableFields)for(var i=0,r=this.setting.sortableFields;i<r.length;i++){var o=r[i];o.active=t}},e.prototype.compareSortableFieldExprs=function(e,t){var i=e.exprs,n=t.exprs;return r.sequenceEqual(i,n,(function(e,t){return o.equals(e.expr,t.expr)}))},e})();t.VisualSortHelper=n})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(t){function i(e,t,i){return new d(e,t,i)}var r=e.visuals.ToolTipComponent;t.createVisualHostTooltipService=i;var o=350,n=350,a=350,s=350,l=500,c=12,u="body",d=(function(){function t(t,i,o){this.$timeout=t,this.parentContainer=i||$(u);var n=this.parentContainer.get(0);this.tooltipContainer=o||new e.visuals.TooltipContainer(n,r.DefaultTooltipOptions)}return t.prototype.show=function(e){var t=this;this.clearTooltipTimeout();var i;i=this.tooltipContainer.isVisible()?16:e.isTouchEvent?a:o,this.move(e),this.delayedTooltipPromise=this.$timeout((function(){t.tooltipContainer.show(e.dataItems),t.startLongPause(e.identities)}),i)},t.prototype.move=function(e){var t=this.getClickedArea(e.coordinates,e.isTouchEvent);this.tooltipContainer.move(e.dataItems,t),this.startLongPause(e.identities)},t.prototype.hide=function(t){var i,r=this;i=t.immediately?0:t.isTouchEvent?s:n,this.clearTooltipTimeout(),this.delayedTooltipPromise=this.$timeout((function(){r.tooltipContainer.hide(),e.visuals.TooltipManager.ToolTipInstance.hide()}),i),this.longPauseDebounced&&(this.longPauseDebounced.cancel(),this.longPauseDebounced=void 0)},t.prototype.container=function(){return this.parentContainer.get(0)},t.prototype.enabled=function(){return e.visuals.TooltipManager.ShowTooltips},t.prototype.onLongPause=function(e){this.longPauseDebounced=void 0},t.prototype.startLongPause=function(e){var t=this;this.longPauseDebounced||(this.longPauseDebounced=_.debounce((function(){return t.onLongPause(e)}),l)),this.longPauseDebounced()},t.prototype.clearTooltipTimeout=function(){null!=this.delayedTooltipPromise&&(this.$timeout.cancel(this.delayedTooltipPromise),this.delayedTooltipPromise=void 0)},t.prototype.getClickedArea=function(t,i){var r=0,o=t[0],n=t[1];if(i){r=c;var a=r/2;o=Math.max(o-a,0),n=Math.max(n-a,0)}return new e.visuals.Rect(o,n,r,r)},t})()})(i=t.services||(t.services={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={}));var powerbi;!(function(e){var t;!(function(t){var i;!(function(i){function r(e){var t=e.sectionStatus.currentSectionNumber;return t<0&&e.exploration.sections.length>0&&(t=0),e.exploration.sections[t]}var o=e.explore.services.DrillToDetailsContext,n=e.explore.services.selectionUtils,a=(function(){function i(){}return i.createUndoRedoHandler=function(i,a,s,l,c,u,d,p,v,h){return{takeSnapshot:function(t){var o=r(i).contract.name,n=e.explore.services.selectionUtils.getSelectedVisuals(s),a=[];if(n)for(var v=i.exploration.exploreCanvas.visualContainers,h=0;h<n.length;h++)for(var g=0;g<v.length;g++)if(n[h]===v[g].contract){a.push(g);break}var f,m={withPopOut:!0,withTransientPages:!0},y=l.getContext();return f=t&&null!=t.canvasLayout?t.canvasLayout:c&&c.getCurrentLayout(),{contract:u.serializeExploration(i.exploration.contract,m),linguisticSchema:p.getSchema(i.exploration.contract.reportId),selectedSlide:o,selectedVisualsIndex:a,drillToDetailsState:y?y.toSnapshot(d):void 0,canvasLayout:f}},rollback:function(e){l.clearContext();var g=u.deserializeExploration(e.contract,[],!0);h.removeAllCustomVisuals();var f=_.filter(g.resourcePackages,(function(e){return 0===e.type}));h.ensurePlugins(f).finally((function(){v.publishToChannel(t.services.events.visualPluginsChanged)}));var m=t.SectionUtils.findSectionIndexForSectionName(g,e.selectedSlide);i.sectionStatus.currentSectionNumber=m,i.exploration=t.viewModels.ViewModelFactory.convertExploration(g,e.canvasLayout,m),p.setSchema(g.reportId,e.linguisticSchema);var y=r(i);d.loadExploration(i.exploration.contract),d.goto(y.contract),a((function(){var t=i.exploration.exploreCanvas.visualContainers,r=[];if(e.selectedVisualsIndex.length>0){for(var a=0;a<e.selectedVisualsIndex.length;a++)t.length>e.selectedVisualsIndex[a]&&r.push(t[e.selectedVisualsIndex[a]].contract);n.selectVisualContainers(r,s),e.drillToDetailsState&&l.setContext(o.fromSnapshot(e.drillToDetailsState,d))}else s.clearSelection();c.changeFormFactor(e.canvasLayout,i)}),0)}}},i})();i.ExploreUndoRedoHandlerUtility=a})(i=t.util||(t.util={}))})(t=e.explore||(e.explore={}))})(powerbi||(powerbi={})),angular.module("powerbi.explore").run(["$templateCache",function(e){e.put("views/advancedFilter.html",'<li class="advanced"><h3 class="description" localize="AdvancedFilter_Description"/><div ng-repeat="condition in advFilterCard.conditions"> <select class="comparisonOperator advancedControl" ng-model="condition.operator" ng-change="markDirty()" ng-disabled="viewModel.readOnlyState.disabled" ng-options="operatorInfo.value as operatorInfo.label for operatorInfo in advFilterCard.operators"/><div class="advancedControl conditionValue flex" ng-if="!advFilterCard.isDateTime" ng-show="condition.valueRequired"> <input type="text" class="item-fill" ng-model="condition.value.stringValue" ng-disabled="viewModel.readOnlyState.disabled" ng-focus="handleFocusedInputChanged($event, condition)" ng-blur="handleInputBlur()" ng-change="validateFilterInput(condition); markDirty();" fast-keyup="keyUp($event)"/><span class="errorIcon item-auto" ng-if="condition.isInvalid" tooltip tooltip-config="tooltipConfig"></span></div><section class="datetime datetimePicker" ng-if="advFilterCard.isDateTime" ng-show="condition.valueRequired"><div class="datePicker flex"> <input type="text" class="calendarInput item-fill" ng-blur="dateTextUpdateComplete(condition)" ng-change="dateTextUpdated(condition); markDirty();" ng-model="condition.value.value" ng-disabled="!condition.valueRequired" fast-keyup="keyUp($event)"/> <button class="filterPaneIcon calendar item-auto" dropdown-overlay-invoke="calendar"></button><dropdown-overlay class="datetime calendarDropDown" dropdown-overlay-name="calendar"><datepicker class="calendar" ng-model="condition.value.dateValue" ng-disabled="!condition.valueRequired" ng-change="dateSelected(condition)" onclick="event.stopPropagation()" show-weeks="false"></datepicker></dropdown-overlay></div><timepicker class="timePicker" ng-model="condition.value.timePickerValue" ng-model-options="{ getterSetter: true }" ng-change="timeSelected(condition)"></timepicker></section><section class="logicalOperator advancedControl" ng-if="$index < (advFilterCard.conditions.length -1)"> <label class="logicalOperatorField"><input type="radio" ng-model="advFilterCard.logicalOperator" ng-value="advFilterCard.logicalAndOperator" ng-disabled="viewModel.readOnlyState.disabled" ng-change="markDirty()" ng-checked="advFilterCard.logicalOperator === advFilterCard.logicalAndOperator"/><span localize="Logical_And_Operator"/></label> <label class="logicalOperatorField"><input type="radio" ng-model="advFilterCard.logicalOperator" ng-value="advFilterCard.logicalOrOperator" ng-disabled="viewModel.readOnlyState.disabled" ng-change="markDirty()" ng-checked="advFilterCard.logicalOperator === advFilterCard.logicalOrOperator"/><span localize="Logical_Or_Operator"/></label></section></div> <button class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-click="applyFilter()" ng-disabled="!canApplyFilter()"/></li>'),e.put("views/canvasVisualHeaderIcon.html",'<button tooltip tooltip-config="$ctrl.tooltipConfigManager.getTooltipConfig()" ng-disabled="!$ctrl.isClickable()" ng-switch="$ctrl.iconType"><i class="infoIcon pbi-glyph-info glyphicon" ng-switch-when="info"></i><i class="warningIcon pbi-glyph-warning glyphicon" ng-switch-when="warning"></i><i class="errorIcon pbi-glyph-error glyphicon" ng-switch-when="error"></i></button>'),e.put("views/carousel.html",'<div class="carouselControl" fast-mouseenter="updateNavButtonVisibility()" on-resize="carouselResized()"> <button class="carouselNavButton previousPage" ng-click="scrollToPrevious()" localize-tooltip="Carousel_PreviousPages"><i class="glyphicon pbi-glyph-caretleft glyph-mini"></i></button> <button class="carouselNavButton nextPage" ng-click="scrollToNext()" localize-tooltip="Carousel_NextPages"><i class="glyphicon pbi-glyph-caretright  glyph-mini"></i></button><div class="carouselScrollPane" ng-transclude></div></div>'),e.put("views/codePaneContainer.html",'<div ng-show="showCodePanel"><div class="codePaneContainer" ng-class="{codePaneContainerMinimized: isMinimized}" v-resizable v-resizable-container-id="desktopExplorationHost" v-resizable-expanded="{{ !isMinimized }}" v-resizable-container-resize="{{canvasResize}}" v-resizable-default-height="34%" v-resizable-min-height="150" v-resizable-collapsed-height="34" v-resizable-other-siblings-height="37" v-resizable-on-resize-callback="onResize"><div class="codePaneTopBar unselectable"><span localize="CodePaneTopBarTitle"></span> <button class="codePaneTopBarButton" fast-click="minimizeToggle()" localize-tooltip="{{isMinimized ? \'CodePane_ExpandTooltip\' : \'CodePane_MinimizeTooltip\' }}" dynamic-tooltip-update><i class="glyphicon glyph-mini" ng-class="{\'pbi-glyph-chevronupmedium\':isMinimized, \'pbi-glyph-chevrondownmedium\':!isMinimized}"></i></button> <button class="codePaneTopBarButton" fast-click="launchExternalIDEClicked()" ng-if="::canLaunchExternalIDE" ng-disabled="!(datafields.length> 0)" localize-tooltip="CodePane_LaunchExternalIDEButtonTooltip"><i class="glyphicon pbi-glyph-go glyph-mini"></i></button> <button class="codePaneTopBarButton" fast-click="optionsButtonClicked()" localize-tooltip="CodePane_RScriptOptionsButtonTooltip"><i class="glyphicon pbi-glyph-gear glyph-mini"></i></button> <button class="codePaneTopBarButton" fast-click="runButtonClicked()" ng-disabled="!(datafields.length> 0 && scriptInput.length > 0)" localize-tooltip="CodePane_RunButtonTooltip"><i class="glyphicon pbi-glyph-play glyph-mini"></i></button></div><div class="codePaneWarningBar" ng-show="showWarningBar && !isMinimized && datafields && datafields.length> 0"><i class="glyphicon glyph-small pbi-glyph-warning"></i> {{warningText}} <button class="codePaneWarningBarButton" fast-click="hideWarning()"><i class="glyphicon glyph-mini pbi-glyph-close"></i></button></div><div class="codePaneMain" ng-style="{\'height\':currentHeight-((showWarningBar && datafields && datafields.length> 0)?68:34)+\'px\'}" ng-hide="isMinimized"><div class="codePaneDataHintsContainer selectable" ng-hide="isMinimized || !(datafields && datafields.length> 0)"><div># Create dataframe</div><div># {{dataFrameName}} &lt;- data.frame({{dataFieldsNamesList}})</div><br/><div># Remove duplicated rows</div><div># {{dataFrameName}} &lt;- unique({{dataFrameName}})</div></div><div class="codePaneScriptContainer" ng-hide="isMinimized || !(datafields && datafields.length> 0)"><pre><span>{{scriptInput}}</span><br/><br/><br/><br/></pre><textarea type="text" placeholder="Paste or type your R-script code here" ng-model="scriptInput" ng-change="scriptInputChanged()" ng-trim="false" spellcheck="false" autocorrect="off"></textarea></div><div class="codePaneContainerDisabled unselectable" ng-show="!isMinimized && !(datafields && datafields.length> 0)" localize="CodePane_DisabledNoDatafields" ng-style="{\'height\':currentHeight-34+\'px\'}"></div></div></div></div>'),
e.put("views/deleteCustomVisualsDialog.html",'<div><div class="warningMessage" localize="DeleteVisuals_DialogMessage"></div><div class="customVisualsListContainer"><div ng-repeat="customVisual in viewModel.customVisuals track by customVisual.plugin.name" class="customVisualsListItem" ng-click="selectVisual(customVisual)" ng-class="{active: customVisual.selected}"><div class="visual-icon-container" ng-class="{active: customVisual.selected}" ng-style="visualStyle(customVisual)"><span class="visual-icon visual-icon-outer {{::customVisual.class}}"><span class="visual-icon-inner"></span></span></div><div class="customVisualText"> <span class="customVisualTitleText">{{customVisual.title}}</span> <span>{{customVisual.tileCountMessage}}</span></div></div></div><div><div class="selectedVisualCount" ng-if="viewModel.selectedVisualCount> 0"> <span>{{viewModel.selectedVisualCount}}</span><span ng-if="viewModel.selectedVisualCount == 1" localize="DeleteVisual_VisualSelected"></span> <span ng-if="viewModel.selectedVisualCount>1" localize="DeleteVisual_VisualsSelected"></span></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="deleteVisuals()" localize="DeleteVisual_Delete" ng-disabled="viewModel.selectedVisualCount === 0"></button> <button class="btn button" ng-click="closeDialog()" localize="DeleteVisual_Cancel"></button></div><div></div>'),e.put("views/deleteVisualWarningDialog.html",'<div><div class="warningMessage"> {{::deleteVisualWarningText}}</div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="deleteVisual()">{{::deleteVisualButtonText}}</button> <button class="btn button" ng-click="closeDialog()" localize="DeleteVisual_Cancel"></button></div></div>'),e.put("views/detailVisual.html",'<div class="detailVisual" ng-switch="viewModel.hasData"><visual view-model="viewModel.visual" ng-switch-when="true"></visual><div class="noDataOverlay" ng-switch-when="false"></div></div>'),e.put("views/embedModalDialog.html",'<div class="reportEmbed"><div ng-switch="viewModel.publishState"><div ng-switch-when="0"><span localize="Embed_ShowCodeTitle" class="title publishTitle"></span><div class="centeredSpinner" ng-show="viewModel.publishState == 0"><spinner modern></spinner></div></div><div ng-switch-when="1"><span localize="Embed_DialogTitle" class="title publishTitle"></span><div><span class="legalText regularText" localize="Embed_Warning_Public"></span><span class="legalText regularText" localize="Embed_Warning_UpdateLiveReport"></span></div><div class="buttons"> <button localize="Embed_PublishToWeb" class="primary button embedCodeButton" ng-hide="viewModel.embedTab.generating || viewModel.embedTab.disabled || showEmbedCode()" ng-click="goToConfirmation()"></button> <button localize="Embed_PublishToWeb" class="primary button disabled embedCodeButton" ng-show="viewModel.embedTab.disabled && !showEmbedCode()"></button> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()" ng-show="viewModel.publishState==1"></button></div></div><div ng-switch-when="2"><span localize="Embed_DialogTitle" class="title publishTitle"></span><span class="legalText regularText" localize="Embed_LegalTitle"></span><span class="legalText regularText" localize="Embed_LegalText"></span><div ng-show="viewModel.embedTab.generating" class="loading"><i class="glyphicon pbi-spinner-large"></i><span localize="Embed_GeneratingEmbedCode" class="semiBoldBlackText loadingText"></span></div></div><div ng-if="viewModel.publishState == 3 || viewModel.publishState == 4"><span ng-if="viewModel.publishState == 3" localize="Embed_SuccessTitle" class="title successTitle"></span><span ng-if="viewModel.publishState == 4" localize="Embed_ShowCodeTitle" class="title successTitle"></span><span class="successLabel semiLightBlackText" localize="Embed_LinkTitle"></span> <input class="succesInputBox semiBoldBlackText" readonly ng-show="showEmbedCode()" onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.link"/><span class="successLabel semiLightBlackText" localize="Embed_EmbedCodeTitle"></span> <input class="succesInputBox semiBoldBlackText" readonly ng-show="showEmbedCode()" onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.embedCode"/><span class="semiBoldBlackText" localize="Embed_Size"></span> <select ng-change="updateSize()" ng-options="size.name for size in viewModel.embedTab.sizes" ng-model="viewModel.embedTab.selectedEmbedSize" class="sizeOptions regularBlackText"></select></div><div ng-switch-when="5"><span localize="Embed_SharepointTitle" class="title publishTitle"></span><div><span class="successLabel regularBlackText" localize="Embed_SharePointLinkTitle"></span><a href="http://go.microsoft.com/fwlink/?LinkID=825698" target="_blank"><span class="successLabel regularBlackText" localize="ModalDialog_LearnMore"></span></a> <input class="sharePointEmbedCodeInputBox semiBoldBlackText" readonly onClick="this.setSelectionRange(0, this.value.length);" ng-model="viewModel.embedTab.embed.link"/></div><div class="spEmbedButtons"> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()"></button></div></div><div class="buttons"> <button localize="Embed_GenerateEmbedCode" class="button embedCodeButton actionButton" ng-hide="viewModel.embedTab.disabled || showEmbedCode() || viewModel.publishState !== 2" ng-click="generateEmbedCodeAndGoToSuccess()"></button> <button localize="Embed_Close" class="button actionButton" ng-click="closeDialog()" ng-hide="viewModel.publishState==1 || viewModel.publishState==5"></button></div></div></div>'),e.put("views/esriConsentDialog.html",'<div><div class="esriDialogTitle"><div class="EsriConsentDialog_Esri" localize="EsriConsentDialog_Esri"></div><div class="EsriConsentDialog_WelcomeTo" localize="EsriConsentDialog_WelcomeTo"></div><div class="EsriConsentDialog_ArcGISMaps" localize="EsriConsentDialog_ArcGISMaps"></div></div><div class="esriDialogBody"><div class="EsriConsentDialog_GetMore" localize="EsriConsentDialog_GetMore"></div><div class="EsriConsentDialog_ByClicking" ng-bind-html="::byClickingText"></div><div class="EsriConsentDialog_LearnMore"><a href="https://go.microsoft.com/fwlink/?LinkID=825665" target="_blank" localize="EsriConsentDialog_LearnMore"></a></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="acceptTermsOfService()" localize="EsriConsentDialog_OK"></button> <button class="btn button" ng-click="rejectTermsOfService()" localize="EsriConsentDialog_Cancel"></button></div></div></div>'),e.put("views/exploration.html",'<div class="exploration {{isMasterFormFactor()? \'\': \'phone-form-factor-background\'}}" toolbar-container><explore-canvas view-model="viewModel.exploreCanvas" disable-print="disablePrint" canvas-options="canvasOptions" ng-class=\'{"master-form-factor": isMasterFormFactor(), "phone-form-factor": !isMasterFormFactor(), "disable-visual-interactivity": isMobileLayoutAuthoring()}\' canvas-scroll></explore-canvas></div>'),e.put("views/explorationAppBar.html",'<div class="explorationAppBarContent appBar trimmedTextWithEllipsis unselectable"><div class="appBarSection left"><dropdown-overlay dropdown-overlay-name="fileMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: $ctrl.viewModeState.getMode() === 0}"><li ng-repeat="item in $ctrl.getFileMenuActions()" ng-if="::item.show" class="dropdown-item" ng-mousedown="$ctrl.fileMenuActionSelected(item); $event.stopPropagation();" ng-disabled="item.disabled"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}}"></i><div class="dropdown-label" ng-bind="::item.text"></div><div class="dropdown-description" title="{{::item.tooltip}}" ng-bind="::item.description"></div></div></a></li></ul></dropdown-overlay><dropdown-overlay dropdown-overlay-name="viewMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: $ctrl.viewModeState.getMode() === 0}"><li ng-repeat="item in $ctrl.viewMenuActions" class="themeYellowDark dropdown-item view-menu" ng-class="{\'selected\': item.selected, \'dropdown-separator\': item.type === 2}" ng-disabled="item.disabled" ng-mousedown="$ctrl.viewMenuActionSelected(item); $event.stopPropagation(); $event.preventDefault() "><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}} glyph-small"></i><div class="dropdown-label" ng-bind="::item.text"></div><pbi-toggle class="base4" ng-if="item.checkbox" ng-model="item.checked" no-label on-state-text="ToggleSwitchOn" off-state-text="ToggleSwitchOff"></pbi-toggle></div></a></li></ul></dropdown-overlay><dropdown-overlay dropdown-overlay-name="editReportMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: $ctrl.viewModeState.getMode() === 0}"><li ng-repeat="item in $ctrl.editReportMenuActions" class="dropdown-item" ng-mousedown="$ctrl.editReportMenuActionSelected(item); $event.stopPropagation();" ng-disabled="item.disabled"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}}"></i><div class="dropdown-label" ng-bind="::item.text"></div><div class="dropdown-description" title="{{::item.tooltip}}" ng-bind="::item.description"></div></div></a></li></ul></dropdown-overlay><dropdown-overlay dropdown-overlay-name="reportMoreOptionsMenu"><ul class="angular-dropdown explorationAppBarMenu active" ng-class="{dark: $ctrl.viewModeState.getMode() === 0}"><li ng-repeat="item in $ctrl.reportMoreOptionsMenu" class="dropdown-item moreOptions" ng-class="{\'selected\': item.selected}" ng-mousedown="$ctrl.reportMoreOptionsMenuSelected(item); $event.stopPropagation();"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><div class="dropdown-label" ng-bind="::item.text"></div></div></a></li></ul></dropdown-overlay><dropdown-overlay dropdown-overlay-name="exploreMenu"><ul class="angular-dropdown explorationAppBarMenu explore active" ng-class="{dark: $ctrl.viewModeState.getMode() === 0}"><li ng-repeat="item in $ctrl.exploreMenuActions" class="dropdown-item explore" ng-class="{\'selected\': item.selected}" ng-disabled="item.disabled" ng-mousedown="$ctrl.exploreMenuActionSelected(item); $event.stopPropagation();"><a href="" target="_blank"><div class="dropdown-content {{::item.itemClass}}"><i class="glyphicon glyph {{::item.itemClass}} glyph-small"></i><div class="dropdown-label" ng-bind="::item.text"></div></div></a></li></ul></dropdown-overlay><ul><li ng-if="$ctrl.viewModel.options.showBackButtonOnAppBar" ng-click="$ctrl.navigateBack()"><i class="glyphicon pbi-glyph-pageleft glyph-small backBtn"></i></li><li class="file-menu" dropdown-overlay-invoke="fileMenu" prefer-left="false" need-blur="true" disable-animation="true" tabindex="0"><span localize="ReportAppBar_FileButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li class="pageview-menu" dropdown-overlay-invoke="viewMenu" prefer-left="false" need-blur="true" disable-animation="true" tabindex="0" localize-tooltip="ReportAppBar_ViewButton" ng-if="$ctrl.viewMenuActions && !$ctrl.isPopOutMode"><span localize="ReportAppBar_ViewButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li localize="ReportAppBar_SwitchModeButton" ng-click="$ctrl.stopEditing()" class="switch" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.viewModel.canWrite"></li><li localize="ReportAppBar_EditReportButton" ng-click="$ctrl.edit()" class="edit" ng-if="$ctrl.viewModeState.getMode() === 0 && $ctrl.viewModel.canEdit && !$ctrl.isEditInDesktopEnabled()"></li><li localize="ReportAppBar_EditReportButton" localize-tooltip="ReportAppBar_EditReportButtonSharedDisabled" class="edit-disabled" ng-if="$ctrl.viewModel.canEdit === false || $ctrl.viewModel.canCopy"></li><li class="editreport-menu" dropdown-overlay-invoke="editReportMenu" prefer-left="false" need-blur="true" disable-animation="true" tabindex="0" ng-if="$ctrl.viewModeState.getMode() === 0 && $ctrl.viewModel.canEdit && $ctrl.isEditInDesktopEnabled()"><span localize="ReportAppBar_EditReportButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li></ul></div><div class="appBarSection right"><ul><li class="appBarDivider"></li><li class="explore" dropdown-overlay-invoke="exploreMenu" prefer-left="false" need-blur="true" disable-animation="true" tabindex="0" localize-tooltip="ReportAppBar_ExploreButton"><i class="glyphicon pbi-glyph-seedata glyph-small"></i><span localize="ReportAppBar_ExploreButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li ng-if="$ctrl.viewModeState.getMode() === 1 && !$ctrl.isPopOutMode" class="insert-textbox" ng-click="$ctrl.insertTextbox()"><i class="glyphicon pbi-glyph-inserttextbox glyph-small"></i><span localize="ReportAppBar_InsertTextboxButton"></span></li><li class="insert-shape" dropdown-menu dropdown-items="$ctrl.shapeMenuActions" dropdown-class="explorationAppBarMenu" dropdown-on-item-selected="$ctrl.shapeMenuActionSelected(selected)" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.shapeMenuActions && !$ctrl.isPopOutMode"><i class="glyphicon pbi-glyph-shapes glyph-small"></i><span localize="ReportAppBar_ShapeButton"></span><i class="glyphicon pbi-glyph-chevrondownmedium glyph-mini"></i></li><li ng-click="$ctrl.toggleVisualInteractions()" class="visualInteractions" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.toggleVisualInteractions && !$ctrl.isPopOutMode" ng-class="{ \'active\': $ctrl.viewModeState.getConfig().showRelationships }"><i class="glyphicon pbi-glyph-visualsinteraction glyph-mini"></i><span localize="ReportAppBar_VisualInteractionsButton"></span></li><li ng-click="$ctrl.refresh()" class="refresh" localize-tooltip="ReportAppBar_RefreshButton"><i class="glyphicon pbi-glyph-refresh glyph-mini" aria-hidden="true"></i><span localize="ReportAppBar_RefreshButton"></span></li><li ng-click="$ctrl.duplicateReportPage()" class="duplicate" ng-if="$ctrl.canDuplicatePage()"><i class="glyphicon pbi-glyph-chromerestore glyph-small" aria-hidden="true"></i><span localize="ReportAppBar_duplicateButton_Text"></span></li><li ng-click="$ctrl.save()" class="save" ng-if="$ctrl.viewModeState.getMode() === 1 && $ctrl.viewModel.canWrite"><i class="glyphicon pbi-glyph-save glyph-small" aria-hidden="true"></i><span localize="ReportAppBar_SaveReportButton"></span></li><li ng-if=$ctrl.canPinPage() localize-tooltip="ReportAppBar_PinPage" class="pin-report" ng-click="$ctrl.showPinReportPageDialog()"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></li><li ng-if="$ctrl.viewModel.canEdit === false && $ctrl.viewModel.canCopy === false" localize-tooltip="PinTile_NotSupportedTitle" class="pin-disabled"><i class="glyphicon pbi-glyph-pinned glyph-small"></i><span localize="ReportAppBar_PinPage"></span></li><li ng-if="$ctrl.canPause && !$ctrl.viewModeState.getConfig().pauseQueryExecution" class="pause" localize-tooltip="ReportAppBar_PauseQueries" ng-click="$ctrl.togglePlayPause()"><span localize="ReportAppBar_PauseQueries"></span></li><li ng-if="$ctrl.canPause && $ctrl.viewModeState.getConfig().pauseQueryExecution" class="play" localize-tooltip="ReportAppBar_ResumeQueries" ng-click="$ctrl.togglePlayPause()"><span localize="ReportAppBar_ResumeQueries"></span></li><li ng-if="$ctrl.isEmailSubscriptionEnabled()" class="subscription" localize-tooltip="ReportAppBar_Subscribe" ng-click="$ctrl.showSubscriptionPane()"><i class="glyphicon pbi-glyph-mail glyph-small"></i><span localize="ReportAppBar_Subscribe"></span></li><li class="moreOptionsItem reportMoreOptionsItem"> <button ng-if="$ctrl.showReportMoreOptionsMenu()" class="moreOptionsDashboardButton" dropdown-overlay-invoke="reportMoreOptionsMenu" localize-tooltip="Options_Menu" prefer-left="true" need-blur="true"><i class="glyphicon glyph-small pbi-glyph-more"></i></button></li></ul></div></div>'),e.put("views/explorationHost.html",'<div class="fillAvailableSpace verticalItemsContainer" ng-transclude></div>'),e.put("views/explorationNavigationTab.html",'<div drag="sections" class="thumbnail-container" ng-dblclick="beginEditSection()" ng-click="changeSection($event)"><div dropdown-menu dropdown-items="dropdownItems" dropdown-on-item-selected="selectMenuItem(selected)" dropdown-on-left-click="false" dropdown-on-right-click="isEditing" dropdown-follow-mouse-position="true"><editable-label class="section-index" on-blur="renameSection(newName)" view-model="viewModel" editable="viewModel.isTabEditable && isEditing" disable-click="true"></editable-label><div class="sectionDeleteIcon" ng-if="isEditing && !isOnlyTab" ng-click="deleteSection($event)" localize-tooltip="Carousel_DeletePage">x</div></div></div>'),e.put("views/explorationPaginator.html",'<div class="paginator unselectable"><span class="prev" ng-click="prev()"></span><span class="status"><span localize="ReportPaginator_Page"></span> <span>{{getSelectedPageIndex() + 1}}</span><span localize="ReportPaginator_PageOf"></span><span ng-bind="viewModel.exploration.sections.length"></span></span><span class="next" ng-click="next()"></span></div>'),e.put("views/explorationStatusBar.html",'<div class="explorationStatusBarContent"><exploration-paginator ng-if="viewModel.exploration" view-model="viewModel"></exploration-paginator><div class="viewSwitch"><a class="editMode" localize-tooltip="ReportPaginator_EditingView" ng-click="startEditing()"></a><a class="readMode" localize-tooltip="ReportPaginator_ReadingView" ng-click="stopEditing()"></a></div></div>'),e.put("views/exploreCanvas.html",'<div class="{{getExploreCanvasClass()}}" drop="dropConfig" drop-handler="drop(event, ui)" ng-click="clearSelection($event)" ng-keydown="keyDown($event)" on-resize="canvasResized()" canvas-layout pinchable="{ \'startHandler\' : \'canvasPinchStart(scale)\', \'endHandler\' : \'canvasPinchEnd(scale)\', \'scrollParentSelector\' : \'.exploration\', \'zoomDisabled\': \'shouldDisableZoom()\', \'childDisplaySelector\': \'.displayArea\' }" enable-pinch="{{canPinch()}}" swipeable="{ enabled: {{canSwipe()}}, ignoreFrom: \'.swipeable-blocked\' }" canvas-navigation="{{canSwipe()}}"><canvas-watermark canvas-view-model="viewModel"></canvas-watermark><div class="canvasBackdrop" ng-if="isCanvasBackdropVisible()"></div><div class="displayArea" explore-canvas-printer disable-print="{{::disablePrint}}"><div class="visualBackgroundContainer"></div><div class="visualContainerHost"><dot-grid ng-if="showDotGrid() && dotGridViewModel" view-model="dotGridViewModel"></dot-grid><box-grid ng-if="showBoxGrid() && boxGridLayout" view-model="boxGridLayout"></box-grid><visual-container ng-repeat="visualContainer in viewModel.visualContainers" view-model="visualContainer" ng-repeat-finish-event="visualContainerRepeatFinished"></visual-container></div><pen-annotation ng-if="$ctrl.viewModeState.getConfig().enablePenAnnotation"></pen-annotation></div></div>'),e.put("views/fieldList.html",'<section class="fieldList unselectable"><search-box filter="searchString" on-change="onSearchStringChanged()"></search-box><hr/><ng-scrollbars ng-scrollbars-config="::scrollbarsConfig" ng-right-click="showContextMenu($event)"><div ng-if="viewModel.isLoaded"><field-list-entity ng-repeat="entity in viewModel.schema.entities | orderBy:[\'!isMeasureGroup\', \'displayName\']" view-model="entity" search-string="searchString" ng-if="(!entity.hidden || entity.showHidden) && entity.isShownInSearch !== false && entity.userEntity"></field-list-entity></div><div class="centeredSpinner" ng-if="!viewModel.isLoaded"><spinner></spinner></div></ng-scrollbars></section>'),e.put("views/fieldListEntity.html",'<li class="entityContainer"><h1 ng-click="toggle($event)" ng-right-click="showContextMenu($event)" class="fieldListEntity flex smallFontSize" ng-class="{selected: viewModel.selected, inactive: viewModel.hidden && viewModel.showHidden}"><i class="caret glyphicon pbi-glyph-caretright glyph-mini smallFontSize item-auto" ng-class="{expanded : viewModel.expanded || viewModel.isShownInSearch}"/><i class="entity fieldListIcon item-auto" ng-class="viewModel.iconClassName"/><editable-label class="unselectable title item-fill" ng-class="{hasCheckedProperties: viewModel.hasCheckedProperties}" view-model="viewModel" on-blur="rename(newName)" validate="isNameValid" editable="viewModel.isEditingLabel" disable-click="true" search-string="searchString" ng-dblclick="editLabel()" tooltip tooltip-config="tooltipConfigManager.getTooltipConfig()" custom-tooltip="true"></editable-label> <i class="menuContainer item-auto"><button class="optionsMenu" ng-click="showContextMenu($event)"><span class="glyphicon pbi-glyph-more"></span></button></i></h1><div class="entityFields" ng-if="viewModel.expanded || viewModel.isShownInSearch"><ol class="entityList"><field-list-property ng-repeat="prop in viewModel.properties | filter:filterProperties" ng-if="prop.isShownInSearch || (prop.isShownInSearch !== false && prop.visible)" search-string="searchString" view-model="prop" id="{{::\'container\'+$id}}"></field-list-property><li class="lastLineBorder"/></ol></div></li>'),e.put("views/fieldListProperty.html",'<li class="fieldListProperty flex" ng-click="ctrl.select($event)" ng-right-click="ctrl.showContextMenu($event)" ng-class="ctrl.getPropertyStyle()" drag="{{::ctrl.viewModel.draggable ? \'field\' : undefined}}" drag-context="ctrl.getDragContext()" drop="{{::ctrl.dropConfig}}" drop-handler="ctrl.drop(event, ui, dropAction)" drop-action="ctrl.getDropAction(dropPosition)" drop-container-id="{{::\'container\'+$parent.$id}}" tooltip tooltip-config="ctrl.tooltipConfigManager.getTooltipConfig()" ng-style="::ctrl.getIndentationStyle()"><ng-include src="ctrl.viewModel.template"></ng-include><editable-label class="propertyText propertyContent item-fill" ng-class="{hasCheckedChildren: ctrl.viewModel.hasCheckedChildren}" view-model="ctrl.viewModel" search-string="ctrl.searchString" on-blur="ctrl.rename(newName)" editable="ctrl.viewModel.isEditingLabel" disable-click="true" ng-dblclick="ctrl.editLabel()" custom-tooltip="true"></editable-label> <i class="menuContainer propertyMenu item-auto"><button class="optionsMenu" ng-click="ctrl.showContextMenu($event)"><span ng-if="::ctrl.viewModel.menuItems" class="glyphicon pbi-glyph-more"></span></button></i></li>'),e.put("views/fieldListPropertyDefault.html",'<input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyFolder.html",'<span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyHierarchy.html",' <span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyKpi.html",'<span class="caret glyphicon pbi-glyph-caretright glyph-mini propertyContent item-auto" ng-class="{expanded : ctrl.viewModel.expanded || ctrl.viewModel.isShownInSearch}" ng-click="ctrl.toggleExpand($event)"/><i class="fieldListIcon propertyContent item-auto {{ctrl.getIconClassName()}}"/>'),e.put("views/fieldListPropertyLeaf.html",'<input class="pane-checkbox propertyContent item-auto" type="checkbox" id="{{::ctrl.elementId}}" ng-change="ctrl.toggle()" ng-model="ctrl.viewModel.checked" onclick="event.stopPropagation()"/><label class="propertyContent item-auto caption" for="{{::ctrl.elementId}}" onclick="event.stopPropagation()"/><i class="fieldListIcon propertyContent item-auto {{::ctrl.getIconClassName()}}"/>'),e.put("views/fieldWell.html",'<section class="fieldWell unselectable"><ol ng-if="viewModel.buckets"><field-well-bucket ng-repeat="bucket in viewModel.buckets" view-model="bucket"></field-well-bucket></ol></section>'),e.put("views/fieldWellBucket.html",'<li class="bucket"><h1 class="caption trimmedTextWithEllipsis smallFontSize" ng-bind="::viewModel.displayName" tooltip tooltip-config="tooltipConfigManager.getTooltipConfig()"></h1><ol class="properties" drop="dropConfig"><li class="bucketTopBorder"></li><field-well-field ng-repeat="property in viewModel.properties" view-model="property" id="{{::\'container\'+$id}}"></field-well-field><li drop="dropConfig" drop-handler="drop(event, ui, dropAction)" drop-action="getDropAction(dropPosition)" class="trimmedTextWithEllipsis" ng-class="{\'dropzone\': viewModel.properties.length===0, \'end-dropzone\': viewModel.properties.length> 0, \'supports-multiple-items\': viewModel.supportsMultipleItems}" ng-attr-localize="{{viewModel.properties.length === 0 ? \'FieldDropZone_Watermark\' : \'\'}}" ng-attr-localize-tooltip="{{viewModel.properties.length === 0 ? \'FieldDropZone_Watermark\' : \'\'}}"></li></ol></li>'),e.put("views/fieldWellField.html",'<li class="fieldWellProperty" ng-class="{\'can-prepend\': !ctrl.viewModel.isReplaceable}" drag="field" drag-context="ctrl.getDragContext()" drop="ctrl.dropConfig" drop-handler="ctrl.drop(event, ui, dropAction)" drop-action="ctrl.getDropAction(dropPosition)" drop-container-id="{{::\'container\'+$parent.$id}}" tooltip tooltip-config="ctrl.tooltipConfigManager.getTooltipConfig()"><h2 class="flex smallFontSize" ng-right-click="ctrl.showMenu($event)"><i ng-if="::!ctrl.viewModel.valid" class="errorIcon error item-auto"/><span class="caption trimmedTextWithEllipsis item-fill" ng-bind="ctrl.viewModel.displayName"></span> <button class="fieldWellIcon dropDown item-auto" ng-click="ctrl.showMenu($event)"></button> <button ng-click="ctrl.deleteField()" class="delete glyphicon pbi-glyph-close glyph-micro"></button></h2><ol class="hierarchyList" ng-if="::ctrl.viewModel.hierarchyLevels"><li ng-repeat="hierarchyLevel in ::ctrl.viewModel.hierarchyLevels" class="flex"><span class="subcaption trimmedTextWithEllipsis item-fill" ng-bind="::hierarchyLevel.displayName"></span> <button ng-click="ctrl.deleteField($index)" class="delete glyphicon pbi-glyph-close glyph-micro"></button></li></ol></li>'),e.put("views/filter.html",'<li class="card unselectable" ng-switch="viewModel.readOnlyState.type"><div class="passthroughCardHeader" ng-switch-when="3"> <button type="button" class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="deleteFilter($event, viewModel)" localize-tooltip="FilterPane_DeleteFilter"></button><h2 class="passthroughRestatement unselectable trimmedTextWithEllipsis smallFontSize" ng-bind="viewModel.restatement"></h2></div><include-exclude-filter ng-switch-when="6" filter-view-model="viewModel"></include-exclude-filter><include-exclude-filter ng-switch-when="7" filter-view-model="viewModel"></include-exclude-filter><div ng-switch-default><div class="filterCardTitleSection" ng-click="toggle($event, viewModel)"><div class="cardHeader" ng-attr-tooltip="::viewModel.readOnlyState.invalid" tooltip-config="tooltipConfigManager.getTooltipConfig()"> <button class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="deleteFilter($event, viewModel)" localize-tooltip="FilterPane_DeleteFilter" ng-if="viewModel.howCreated === 1 || viewModel.readOnlyState.invalid"></button><span ng-if="::!viewModel.readOnlyState.invalid" ng-class="viewModel.readOnlyState.expanded ? \'expand\' : \'collapse\'" ng-bind-attr="{title: viewModel.readOnlyState.expanded ?  viewModel.chevronCollapseDescription : viewModel.chevronExpandDescription}"></span><h2 class="title trimmedTextWithEllipsis unselectable smallFontSize" ng-bind-attr="{title: viewModel.tooltip}"><i ng-if="::viewModel.readOnlyState.invalid" class="filterPaneIcon error"/><span ng-bind="viewModel.displayName"></span><span ng-if="!viewModel.restatement" localize="FilterRestatement_All"></span></h2></div><div ng-class="{\'cardCollapsed\': !viewModel.readOnlyState.expanded && !viewModel.restatement}" class="controlPanel"> <button ng-if="!viewModel.hasDefaultValue && viewModel.restatement" class="filterPaneIcon clear largeFontSize" ng-class="{\'cardExpanded\': viewModel.readOnlyState.expanded}" ng-click="clearFilter($event, viewModel)" localize-tooltip="FilterPane_ClearFilter"></button> <button ng-if="viewModel.hasDefaultValue" class="filterPaneIcon clear largeFontSize" ng-class="{\'cardExpanded\': viewModel.readOnlyState.expanded}" ng-click="restoreDefaultFilter($event, viewModel)" localize-tooltip="FilterPane_ResetDefault"></button><h2 ng-if="viewModel.restatement" class="restatement trimmedTextWithEllipsis smallFontSize" ng-bind-attr="{title: viewModel.restatement}" ng-bind="viewModel.restatement"></h2></div></div><div ng-show="viewModel.readOnlyState.expanded"><div ng-if="viewModel.availableTypes.length> 1 && !viewModel.isSingleSelectionRequired && !viewModel.invalid"><h2 class="typeSelectTitle trimmedTextWithEllipsis smallFontSize" localize="FilterCardTypeSwitchLabel"></h2> <select class="typeSwitchOptions" ng-class="{ invalidType: viewModel.cardType.invalid }" localize="FilterCardTypeSwitchLabel" ng-options="cardType.label for cardType in ::viewModel.availableTypes track by cardType.label" ng-model="viewModel.cardType" ng-change="switchCardType(viewModel.cardType, viewModel)"/></div><ul><advanced-filter view-model="viewModel" ng-if="viewModel.cardType.type === 2"></advanced-filter><filter-visual view-model="viewModel" ng-if="(viewModel.cardType.type === 0 || viewModel.cardType.type === 4)"></filter-visual><top-n-filter view-model="viewModel" ng-if="viewModel.cardType.type === 5"></top-n-filter></ul></div><div class="cardFooter" ng-if="viewModel.readOnlyState.canToggleSingleSelect"><div class="required flex"> <input class="item-auto" type="checkbox" ng-click="updateRequiredState()" ng-model="viewModel.isSingleSelectionRequired" ng-disabled="::viewModel.disableSelectionModeToggle"><span localize="PageFilter_SingleSelectionRequired" class="label item-fill trimmedTextWithEllipsis" localize-tooltip="PageFilter_SingleSelectionRequired_Tooltip"></span></div></div></div></li>'),e.put("views/filterPane.html",'<section class="filterPane"><div id="visualFilterContainer" ng-if="isVisualFiltersVisible()"><h3 class="header unselectable trimmedTextWithEllipsis smallFontSize" localize="FilterPane_Visual" localize-tooltip="FilterPane_VisualDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropVisualFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.visualFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.visualFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.visualFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.visualFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div><div id="pageFilterContainer" ng-if="isPageFiltersVisible()"><h3 class="header smallFontSize unselectable" localize="FilterPane_Page" localize-tooltip="FilterPane_PageDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropPageFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.pageFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.pageFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.pageFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.pageFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div><div id="exploreFilterContainer" ng-if="isReportFiltersVisible()"><h3 class="header smallFontSize unselectable" localize="FilterPane_Report" localize-tooltip="FilterPane_ReportDescription"></h3><div class="cards" drop="dropConfig" drop-handler="dropReportFilter(event, ui, dropAction)" drop-action="getDropAction(dropPosition)"><ul><filter ng-repeat="filter in viewModel.reportFilters" view-model="filter"></filter></ul><div ng-if="viewModeState.getConfig().alwaysPopulatePanes || viewModeState.getMode() === 1" class="unselectable trimmedTextWithEllipsis" ng-class="viewModel.reportFilters.length === 0 ? \'dropzone\' : \'end-dropzone\'" title="{{viewModel.reportFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}"> {{viewModel.reportFilters.length === 0 ? viewModel.addFilterLabel : \'\'}}</div></div></div></section>'),
e.put("views/filterVisual.html",'<div class="filterVisual"><visual ng-if="$ctrl.dataLoaded" view-model="$ctrl.viewModel.readOnlyState.visual"></visual><div class="filterSpinner" ng-if="$ctrl.viewModel.isLoading && !$ctrl.dataLoaded"><spinner></spinner><span class="message" localize="FilterCard_Loading"/></div><div class="filterError" ng-if="$ctrl.hasQueryError"><i class="icon filterPaneIcon error"/><span class="message" localize="FilterCard_ErrorMessage"/></div></div>'),e.put("views/importVisualErrorDialog.html",'<div><div class="importFailMessage" localize="ImportVisual_ErrorDialogMessage"></div><div class="buttons errorButton"> <button class="btn button primary" localize="ImportVisual_Close" ng-click="closeDialog()"></button></div></div>'),e.put("views/importVisualWarningDialog.html",'<div><div class="warningMessage" localize="ImportVisual_CautionDialogMessage"></div><div class="buttons warningButtons"> <button class="btn button primary" ng-click="importVisual()" localize="ImportVisual_Import"></button> <button class="btn button" ng-click="closeDialog()" localize="ImportVisual_Cancel"></button></div></div>'),e.put("views/taskPane.html",'<article class="taskPane sidePane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" modeling-context-changer><div class="paneHeader"> <button class="toggleBtn" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggleTaskPane()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><h2 class="sidePaneHorizontalTitle sidePaneTitle unselectable fieldsTab largeFontSize trimmedTextWithEllipsis" ng-if="viewModel.isPaneExpanded" localize="TaskPane_Fields"></h2><div class="verticalTitle"><h2 class="largeFontSize" localize="TaskPane_Fields"></h2></div></button></div><div class="paneContents" ng-if="viewModel.isPaneExpanded"><field-list field-list-config="::fieldListConfig"></field-list></div></article>'),e.put("views/virtualList.html",'<div class="virtual-list-container"><ng-scrollbars class="virtual-list" ng-scrollbars-config="::scrollbarsConfig"><ng-transclude></ng-transclude></ng-scrollbars></div>'),e.put("views/visualContainer.html",'<div class="visualContainer unselectable" canvas-visual-error canvas-layout-item drop="dropConfig" drop-handler="drop(event, ui)" double-click="onDoubleClick($event)" ng-click="toggleSelect($event)" ng-class="getVisualContainerStyle()" apply-style="::viewModel.readOnlyState.style" tabindex="0" transform transform-restriction="parent" auto-scroll-parent-selector=".displayArea" drag-resize-disabled="{{viewModel.disableResize || viewModeState.getMode() === 0 || hasPositionOverride()}}" toolbar-anchor preserve-aspect-ratio="{{viewModel.lockAspectRatio}}" fast-touchmove="onTouchMove($event)"><div class="visualContainerBorder"></div><div class="visualContainerScreen"></div><toolbar-overlay view-model="viewModel.toolbarViewModel"></toolbar-overlay><spinner delay="1000" class="xsmall" ng-if="viewModel.showProgressBar"></spinner><visual-container-header visual="::viewModel" menu-options="::menuOptions" disable-pin="disablePin" show-warning-details="ctrlError.showWarningDetails()" show-transform-warning-details="ctrlError.showTransformWarningDetails()" show-info-details="ctrlError.showInfoDetails()" on-visual-container-changed="onVisualContainerChanged()" ng-if="isHeaderVisible()"></visual-container-header><i class="removeFromLayout itemIcon glyphicon pbi-glyph-close glyph-mini" ng-click="removeVisualFromLayout()" ng-if="canRemoveFromLayout()"></i><visual-container-pop-out-bar ng-if="isPopOutBarVisible()"></visual-container-pop-out-bar> <button class="vcInFocusEditBtn" fast-click="toggleInFocusEditMode()" ng-if="canInFocusEdit()" localize-tooltip="InFocusEditMode_ToolTip"><i class="ui-icon pencil-edit"></i></button><div class="vcBody" apply-style="::viewModel.readOnlyState.visualViewportStyle" ng-switch="viewModel.showWatermark" fast-click="ensureFocus($event)"><div class="visualTitle preTextWithEllipsis" ng-switch-when="false" ng-if="viewModel.visualTitleVisible()" title="{{viewModel.visualTitle.text}}" apply-style="::viewModel.readOnlyState.titleStyle" ng-bind="viewModel.visualTitle.text"></div><visual ng-switch-when="false" view-model="viewModel.readOnlyState.visual" allow-deferred-rendering="::viewModel.allowDeferredRendering"></visual><detail-visual ng-if="viewModel.contract.popOutMode === 2" view-model="viewModel.readOnlyState.detailVisual"></detail-visual><visual-watermark ng-switch-when="true" visual-type="viewModel.contract.config.singleVisual.visualType"></visual-watermark><canvas-visual-error-overlay ng-if="viewModel.errorInfo" error-info="viewModel.errorInfo" view-mode="viewModeState.getMode()" viewport="viewModel.position" show-error-details="ctrlError.showErrorDetails()" fix-errors="ctrlError.fixErrors()"></canvas-visual-error-overlay></div><visual-container-context-menu menu-id="::getContextMenuId()" visual-container="::viewModel.contract" selectors="contextMenuData" ng-if="viewModel.options.showContextMenu"></visual-container-context-menu></div>'),e.put("views/visualContainerContextMenu.html",'<dropdown-overlay dropdown-overlay-name="{{::$ctrl.menuId}}"><dropdown-menu-items dropdown-items="$ctrl.menuItems" dropdown-class="visualContextMenu smallFontSize active angular-dropdown" dropdown-on-item-selected="$ctrl.select(selected)"></dropdown-menu-items></dropdown-overlay>'),e.put("views/visualContainerPopOutBar.html",'<ul class="popOutBar"><li> <button ng-click="closePopOut()"><i class="glyphicon iconBox pbi-glyph-chevronleftmedium glyph-small"></i><span class="menuItem" localize="VisualContainer_PopOut_BackToReportButton"></span></button></li><li class="divider"></li><li class="title trimmedTextWithEllipsis" ng-bind="viewModel.readOnlyState.popOutBarTitle" title="{{viewModel.readOnlyState.popOutBarTitle}}"></li><li class="subtitle" ng-bind="viewModel.readOnlyState.popOutBarSubtitle"></li><li class="visualLastRefreshTime" ng-if="viewModel.lastUpdateAttemptTime"><span localize="ReportAppBar_LastRefresh"></span><span class="dataUpdatedTime" ng-bind="viewModel.lastUpdateAttemptTime"></span></li></ul>'),e.put("views/visualizationPane.html",'<article class="visualizationPane sidePane rightSidePane smallFontSize" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" modeling-context-changer><div class="paneHeader"> <button class="toggleBtn" ng-class="{ isCollapsed: !viewModel.isPaneExpanded }" ng-click="toggle()" localize-tooltip="Pane_Toggle"><div class="btnIcon glyphicon pbi-glyph-chevronrightmedium glyph-mini"></div><h2 class="sidePaneHorizontalTitle unselectable sidePaneTitle largeFontSize trimmedTextWithEllipsis" ng-bind="viewModel.header" ng-show="viewModel.isPaneExpanded"></h2><h2 class="verticalTitle verticalText" ng-show="!viewModel.isPaneExpanded"><span class="collapsedVisualsTitle largeFontSize" localize="VisualizationPane_Title" ng-show="populatePanes"></span><span class="collapsedFiltersTitle largeFontSize" localize="VisualizationPane_Filters"></span></h2></button></div><div class="paneContents flex" ng-if="viewModel.isPaneExpanded"><visual-types-container ng-if="showVisualTypes" visual-plugin-filter="viewModel.visualPluginFilter" esri-visual-enabled="viewModel.esriVisualEnabled" esri-visual-disallowed="viewModel.esriVisualDisallowed"></visual-types-container><nav class="sectionHeader item-auto" ng-if="viewModel.sections.length && !isNonQueryVisual && populatePanes"><ul><li ng-repeat="section in viewModel.sections" ng-click="setActiveSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activeSection}" ng-bind-attr-once="{title: section.displayName}"><i ng-class="[\'sectionIcon\', section.cssClass]"></i></li></ul></nav><nav class="sectionHeader item-auto" ng-if="viewModel.pagePaneSections.length && populatePanes"><ul><li ng-repeat="section in viewModel.pagePaneSections" ng-click="setActivePagePaneSection(section.sectionType)" class="sectionTab" ng-class="{active: section.sectionType === viewModel.activePageSection}" ng-bind-attr-once="{title: section.displayName}"><i ng-class="[\'sectionIcon\', section.cssClass]"></i></li></ul></nav><div class="sectionHost item-fill" ng-if="showFieldWellOrFilters" ng-class="{\'readOnly\' : !populatePanes}"><ng-scrollbars ng-scrollbars-config="::scrollbarsConfig"><field-well ng-if="showFieldWell"></field-well><h3 class="sectionHeader" ng-if="showFieldWell || showVisualTypes"><span class="sectionTitle sidePaneTitle unselectable largeFontSize" localize="VisualizationPane_Filters"></span></h3><filter-pane></filter-pane></ng-scrollbars></div><property-pane ng-if="showPropertyPane" class="item-fill"></property-pane><page-property-pane ng-if="showPagePropertyPane" class="item-fill"></page-property-pane><analytics-pane ng-if="showAnalyticsPane" class="item-fill propertyPaneContents"></analytics-pane></div></article>'),e.put("views/visualTypesContainer.html",'<div class="visual-types-container"> <button ng-if="enableDeleteCustomVisual" ng-repeat="visual in viewModel.visuals track by visual.plugin.name" class="visual-icon-container" ng-class="{active: visual.active}" ng-click="visualAction(visual)" title="{{::visual.title}}" ng-style="visualStyle(visual)" dropdown-menu dropdown-items="visual.menuItems" dropdown-class="visual-types-contextMenu smallFontSize" dropdown-on-item-selected="selectMenuItem(selected, visual)" dropdown-on-left-click="false" dropdown-on-right-click="visual.plugin.custom" dropdown-follow-mouse-position="true"><span class="visual-icon visual-icon-outer {{::visual.class}}" ng-class="{disabled: !visual.enabled}"><span class="visual-icon-inner"></span></span></button> <button ng-if="enableDeleteCustomVisual" class="visual-icon-container" localize-tooltip="ImportVisual_importButtonTootip" dropdown-menu dropdown-items="customVisualMenuItems" dropdown-class="visual-types-contextMenu smallFontSize" dropdown-on-item-selected="selectMenuItem(selected, undefined)" dropdown-on-left-click="true" dropdown-on-right-click="false" dropdown-follow-mouse-position="false"><span class="visual-icon-inner glyphicon pbi-glyph-more"></span></button> <button ng-if="!enableDeleteCustomVisual" ng-repeat="visual in viewModel.visuals track by visual.plugin.name" class="visual-icon-container" ng-class="{active: visual.active}" ng-click="visualAction(visual)" title="{{::visual.title}}" ng-style="visualStyle(visual)"><span class="visual-icon visual-icon-outer {{::visual.class}}" ng-class="{disabled: !visual.enabled}"><span class="visual-icon-inner"></span></span></button> <button ng-if="!enableDeleteCustomVisual" class="visual-icon-container" ng-click="importVisual()" localize-tooltip="ImportVisual_importButtonTootip"><span class="visual-icon-inner glyphicon pbi-glyph-more"></span></button></div>'),e.put("views/inputFields/imageUpload.html",'<div class="imageUpload" ng-class="{hasImage: hasImage()}"><div class="imagePicker"> <input class="file-input" type="file" accept="image/*"/><span class="custom-file-input unselectable" ng-click="upload()" localize="PropertyPane_AddImage"></span> <img class="preview-background-image"/><span class="image-name trimmedTextWithEllipsis" ng-attr-title="{{image.name}}" ng-bind="image.name"></span><span class="remove-image glyphicon pbi-glyph-close" ng-click="removeImage()"></span></div><div ng-if="hasImage()" class="imagefit"><span class="unselectable label" localize="PagePropertyPane_PageBackgroundImageFit"></span><select-menu class="selection" ng-model="image.scaling" ng-change="onSelectScaling()" options="::items"></select-menu></div></div>'),e.put("views/inputFields/propertyPaneTextBox.html",'<form name="inputForm" novalidate> <input type="{{::inputType}}" class="inputFieldInSlice" pbi-validate="validators" autocomplete="off" ng-change="onChange()" ng-model="sliceValue" ng-model-options="{ debounce: 400 }" tooltip tooltip-config="getErrorMessage()" placeholder="{{::placeholder}}" maxlength="250" name="inputField" ng-keydown="onKeydown($event)"/></form>'),e.put("views/inputFields/selectionBox.html",'<div class="popup-container-toggle" ng-click="showDropdown=!showDropdown"><div class="selection-box selection-box-position"><div class=\'selection-box-selected-block\'><span class=\'selection-box-icon\'></span><span class=\'selection-box-selected-item\' ng-bind="selectedItem.displayName"></span></div><popup-container ng-if="showDropdown" bind-parent-width><ul class="selection-box-menu"><li ng-repeat="item in items | filter: ( hasHideableItems ? {isHidden : false} : \'\') track by $index" class=\'selection-box-item trimmedTextWithEllipsis\' ng-click="itemSelected(item)" ng-class="{\'selected\': selectedItem === item}"><span ng-bind="item.displayName"></span></li></ul></popup-container></div></div>'),e.put("views/inputFields/slider.html",'<div class="slider"> <input class="barRange" type="range" min="0" max="100" ng-model="rangeValue" ng-change="onRangeValueChanged()"/><div class="inputRange" ng-class="{\'invalid\': inputInvalid()}"> <input type="number" name="{{::inputName}}" min="{{::options.minValue}}" max="{{::options.maxValue}}" ng-model="textValue" ng-change="onTextValueChanged()" ng-pattern="::integerPattern" required/><span ng-bind="::unitSymbol"></span></div></div>'),e.put("components/alignmentGroup/alignmentGroup.html","<div class='alignment-group'><div class=\"alignment-option-wrapper\" ng-class=\"{'alignment-selected': $ctrl.selectedValue === 'left'}\"><span class='alignment-option left' ng-click=\"$ctrl.setAlignment('left')\"/></div><div class=\"alignment-option-wrapper\" ng-class=\"{'alignment-selected': $ctrl.selectedValue === 'center'}\"><span class='alignment-option center' ng-click=\"$ctrl.setAlignment('center')\"/></div><div class=\"alignment-option-wrapper\" ng-class=\"{'alignment-selected': $ctrl.selectedValue === 'right'}\"><span class='alignment-option right' ng-click=\"$ctrl.setAlignment('right')\"/></div></div>"),e.put("components/analyticsCard/analyticsCard.html",'<section class="card"><header ng-click="::$ctrl.toggleCollapsed()" ng-class="{\'expanded\': !$ctrl.collapsed}"> {{$ctrl.displayName}} <span class="instanceCount" ng-if="$ctrl.instances && $ctrl.instances.length>0" ng-bind="$ctrl.instances.length"></span></header><div class="cardItems" ng-if="!$ctrl.collapsed"><analytics-instance-selector instances="$ctrl.instances" current-instance="$ctrl.currentInstance" maximum-instances="::$ctrl.maximumInstances" set-current-instance="$ctrl.setCurrentInstance(instance)" add-instance="$ctrl.addInstance()" remove-instance="$ctrl.removeInstance(instance)" rename-instance="$ctrl.renameInstance(instance, name)"></analytics-instance-selector><ng-transclude></ng-transclude><form name="$ctrl.inputForm" ng-if="$ctrl.currentInstance"><ol><li class="card-slice" ng-repeat="slice in $ctrl.currentInstance.slices track by $index"><property-slice view-model="slice" slice-changed="$ctrl.save(slice)" type="$ctrl.getSliceComponentType(slice)"></property-slice></li></ol></form></div></section>'),e.put("components/analyticsInstanceSelector/analyticsInstanceSelector.html",'<ul class="instances"><li class="instance flex" ng-repeat="instance in $ctrl.instances track by instance.selector.id" ng-if="!instance.isDefault" ng-dblclick="$ctrl.editName()" ng-click="$ctrl.setCurrentInstance({instance: instance})"><editable-label class="instanceName item-fill" ng-class="{ current: $ctrl.currentInstance.selector === instance.selector }" on-blur="$ctrl.finishEditing(instance, newName)" view-model="instance" editable="$ctrl.currentInstance === instance && $ctrl.isEditing" disable-click="true"></editable-label> <button class="remove glyphicon glyph-micro pbi-glyph-close" ng-click="$ctrl.removeInstance({instance: instance}); $event.stopPropagation();"></button></li> <button class="add pbi-glyph-add" ng-click="$ctrl.addInstance()" localize="AnalyticsPane_Add_Instance_Label" ng-if="!$ctrl.maximumInstances || $ctrl.instances.length < $ctrl.maximumInstances"></button></ul>'),e.put("components/analyticsPane/analyticsPane.html",'<ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><header class="unavailable" ng-if="!$ctrl.hasCards"><span localize="AnalyticsPane_Unavailable"></span><br><a class="learn-more" href="http://go.microsoft.com/fwlink/?LinkID=825117" target="_blank" localize="AnalyticsPane_Unavailable_LearnMore"></a></header><div ng-repeat="card in $ctrl.cards track by card.name" ng-switch="card.name"><reference-line-card-container valid-measures="$ctrl.validMeasures" prototype-card="card" visual-container="$ctrl.visualContainer" ng-if="card.name === \'referenceLine\'"></reference-line-card-container><forecast-card card="card" instances="card.instances" display-name="card.displayName" visual-container="$ctrl.visualContainer" ng-if="card.name === \'forecast\'"></forecast-card><analytics-card card="card" instances="card.instances" maximum-instances="::card.maxInstances" display-name="card.displayName" visual-container="$ctrl.visualContainer" ng-if="card.name !== \'referenceLine\' && card.name !== \'forecast\'"></analytics-card></div></ng-scrollbars>'),e.put("components/boxGrid/boxGrid.html",'<triggered-recompile trigger="$ctrl.viewModel"><svg class="box-grid" ng-attr-width="{{::$ctrl.getSvgWidth()}}" ng-attr-height="{{::$ctrl.getSvgHeight()}}"><g ng-repeat="row in ::$ctrl.getRows()"><rect ng-repeat="column in ::$ctrl.getColumns()" ng-attr-width="{{::$ctrl.getBoxWidth()}}" ng-attr-height="{{::$ctrl.getBoxHeight()}}" ng-attr-x="{{::$ctrl.getBoxX(column)}}" ng-attr-y="{{::$ctrl.getBoxY(row)}}"></rect></g></svg></triggered-recompile>'),e.put("components/canvasVisualErrorOverlay/canvasVisualErrorOverlay.html",'<div class="errorMessage"><div ng-switch="$ctrl.errorInfo.overlayType"><div class="glyphicon pbi-glyph-error glyph-med" ng-switch-default></div><div class="glyphicon pbi-glyph-blockedsite glyph-med" ng-switch-when="1"></div></div><div><span class="errorSpan" ng-bind="$ctrl.errorInfo.details.message" ng-show="$ctrl.showErrorMessage"/><ng-switch on="$ctrl.errorInfo.details.errorType"><a localize="VisualContainer_ShowErrorDetails" class="errorSeeMore" href ng-click="$ctrl.showErrorDetails()" ng-if="!$ctrl.errorInfo.hideSeeDetails" ng-switch-default/><a localize="OpenReport_EnableScriptVisualWarningLinkText" class="errorSeeMore" href="https://powerbi.microsoft.com/documentation/powerbi-desktop-r-visuals/" ng-switch-when="1" target="_blank"/></ng-switch></div><div class="fixThisContainer"> <button class="primary" ng-show="$ctrl.isFixButtonVisible" ng-click="$ctrl.fixErrors() "><ng-switch on="$ctrl.errorInfo.fixableError"><span ng-switch-when="1" localize="Fix_This" localize-tooltip="FixReferences_ToolTip"></span><span ng-switch-when="2" localize="Fix_This" localize-tooltip="RelationshipDetection_Tooltip"></span><span ng-switch-when="3" localize="Fix_This" localize-tooltip="FixReferences_ToolTip"></span></ng-switch></button></div></div>'),e.put("components/clusteringDialog/clusteringDialog.html",'<dialog-frame><dialog-header><span localize="ClusteringDialog_Title"></span></dialog-header><dialog-body><section class="topPanel"><div class="row"><div class="cell cellContentFlowX"><label localize="GroupsDialog_Name"></label> <input type="text" spellcheck="false" ng-model="$ctrl.viewModel.groupingColumnName" maxlength="100"/></div><div class="cell cellContentFlowX lastItemInRow"><label localize="GroupsDialog_FromColumnName"></label> <input type="text" spellcheck="false" ng-model="::$ctrl.viewModel.sourcePropertyName" disabled/></div></div><div class="row"><label localize="ClusteringDialog_Description"></label> <input type="text" spellcheck="false" ng-model="$ctrl.viewModel.description" maxlength="250"/></div></section><section class="mainPanel"><div class="scrollableContainer cell" ng-if="$ctrl.viewModel.partitions.length> 0"><div class="partitionsList"><div class="partitionNode" ng-click="$ctrl.onNodeClick(partition, $event)" ng-class="{\'editDisabled\': !partition.isNameEditable,                                    \'isNameInvalid\': partition.hasNameCollision}" tooltip tooltip-config="$ctrl.getTooltipConfig(partition)" ng-repeat="partition in ::$ctrl.viewModel.partitions"><editable-label class="unselectable" view-model="partition" cancel="$ctrl.cancelEditName(partition)" ng-dblclick="$ctrl.startEditName(partition, $event)" on-blur="$ctrl.rename(partition, newName)" editable="!!partition.isNameEditable && !!partition.isEditingName" disable-click="true" input-match-label-width="false" custom-tooltip="true"></editable-label><label ng-bind-template="({{::partition.numberOfItems}})"></label></div></div></div><form name="$ctrl.clusteringParametersForm" class="parametersContainer cell lastItemInRow"><label class="numberOfClustersLabel" localize="ClusteringDialog_NumberOfClusters"></label> <label class="clustersUpdateWarningLabel" ng-if="$ctrl.viewModel.partitions.length>0" localize="ClusteringDialog_DiscardNames"></label> <input type="number" class="numberOfClustersParameter" ng-model="$ctrl.viewModel.numberOfClusters" placeholder="{{::$ctrl.numberOfClustersPlaceholder}}" ng-min="1" ng-max="25" ng-pattern="/^\\d+$/"/><div class="warning" ng-if="!$ctrl.clusteringParametersForm.$valid"><i class="errorIcon"></i><span localize="ClusteringDialog_NumberClustersOutOfRange"></span></div></form></section><section class="messagePanel"><div class="warning" ng-if="$ctrl.viewModel.errorMessage"><i class="errorIcon"></i><span ng-bind="$ctrl.viewModel.errorMessage"></span></div><div class="warning" ng-if="$ctrl.isGroupingColumnNameEmpty()"><i class="errorIcon"></i><span localize="ClusteringDialog_ClusteringColumnNameCannotBeEmpty"></span></div><div class="warning" ng-if="$ctrl.viewModel.hasDuplicatePartitionNames"><i class="errorIcon"></i><span localize="ClusteringDialog_DuplicateNames"></span></div></section></dialog-body><dialog-footer> <button type="submit" localize="OK_ButtonText" ng-disabled="!$ctrl.canCommit()" ng-click="$ctrl.commit()" class="actionButton primary" ng-disabled="!$ctrl.clusteringParametersForm.$valid"></button> <button class="cancel" autofocus localize="Cancel_ButtonText" ng-click="$ctrl.cancel()"></button></dialog-footer></dialog-frame>'),e.put("components/clusteringDialog/clusteringDialogDefinition.html",'<clustering-dialog args="args"></clustering-dialog>'),e.put("components/conditionalFormattingDialog/conditionalFormattingDialog.html",'<form name="conditionalFormattingForm"><dialog-frame><dialog-header><span localize="ConditionalFormattingDialog_Title"></span></dialog-header><dialog-body><p class="description" localize="ConditionalFormattingDialog_Description"></p><section><fieldset class="gradientSettings nullColoringSettings"><legend localize="ConditionalFormattingDialog_FormatNull" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.nullStrategyOption" ng-options="element.value for element in ::$ctrl.viewModel.nullStrategyOptions track by element.id"/><color-picker class="colorpicker" ng-model="$ctrl.viewModel.gradientSettings.nullColor" type="::$ctrl.viewModel.colorPickerType" ng-style="{\'visibility\': $ctrl.viewModel.nullStrategyOption.disableInput ? \'hidden\' : \'visible\'}"></color-picker></section></fieldset><fieldset><legend localize="ConditionalFormattingDialog_BaseValueHeader"></legend><h2 class="displayNameSelectItem" ng-bind="::$ctrl.viewModel.baseExprDisplayName"></h2></fieldset></section><section class="divergingSettings"> <input type="checkbox" id="divergingCheckbox" ng-model="$ctrl.viewModel.gradientSettings.diverging" ng-change="$ctrl.updateGradientBar()" onclick="event.stopPropagation()"/><label for="divergingCheckbox" onclick="event.stopPropagation()"/><h2 localize="ConditionalFormattingDialog_Diverging" ng-click="$ctrl.updateDiverging()"></h2></section><section class="gradientSettings"><fieldset><legend localize="ConditionalFormattingDialog_MinimumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.minimumSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.minimumSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.minimumSelectOptions track by element.id"/><color-picker class="colorpicker" ng-change="$ctrl.updateGradientBar()" ng-model="$ctrl.viewModel.gradientSettings.minColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.minimumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.minimumSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.minValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_LowestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_LowestValuePlaceHolder"/></fieldset><fieldset ng-if="$ctrl.viewModel.gradientSettings.diverging"><legend localize="ConditionalFormattingDialog_CenterHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.centerSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.centerSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.centerSelectOptions track by element.id"/><color-picker class="colorpicker" ng-change="$ctrl.updateGradientBar()" ng-model="$ctrl.viewModel.gradientSettings.midColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.centerSelectedOption.disableInput" ng-required="!$ctrl.viewModel.centerSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.midValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_MiddleValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_MiddleValuePlaceHolder"/></fieldset><fieldset><legend localize="ConditionalFormattingDialog_MaximumHeader" localize-tooltip></legend><section class="colorSettings"> <select ng-model="$ctrl.viewModel.maximumSelectedOption" ng-change="$ctrl.selectedOptionsChange($ctrl.viewModel.maximumSelectedOption)" ng-options="element.value for element in ::$ctrl.viewModel.maximumSelectOptions track by element.id"/><color-picker class="colorpicker" ng-change="$ctrl.updateGradientBar()" ng-model="$ctrl.viewModel.gradientSettings.maxColor" type="::$ctrl.viewModel.colorPickerType"></color-picker></section> <input type="number" ng-disabled="$ctrl.viewModel.maximumSelectedOption.disableInput" ng-required="!$ctrl.viewModel.maximumSelectedOption.disableInput" ng-model="$ctrl.viewModel.gradientSettings.maxValue" localize-attr="{placeholder: \'ConditionalFormattingDialog_HighestValuePlaceHolder\'}" localize-tooltip="ConditionalFormattingDialog_HighestValuePlaceHolder"/></fieldset></section><section class="gradientValue"><gradient-bar ng-model="$ctrl.viewModel.gradientBarValue"></gradient-bar></section></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="conditionalFormattingForm.$valid && $ctrl.apply()" class="actionButton primary" localize="OK_ButtonText"></button> <button class="cancel" autofocus localize="Cancel_ButtonText" ng-click="$ctrl.cancel()"></button></dialog-footer></dialog-frame></form>'),e.put("components/conditionalFormattingDialog/conditionalFormattingDialogDefinition.html",'<conditional-formatting-dialog view-model="viewModel"></conditional-formatting-dialog>'),e.put("components/dateTimePicker/dateTimePicker.html",'<div class="datetimePicker"> <input type="text" class="inputFieldInSlice" ng-blur="$ctrl.dateTextUpdated()" ng-model="$ctrl.textVal" ng-class="{\'ng-invalid\': $ctrl.inputInvalid}" placeholder="{{::$ctrl.placeholder}}"/> <button class="calendar" dropdown-overlay-invoke="calendar"></button><dropdown-overlay class="calendarDropDown" dropdown-overlay-name="calendar"><datepicker class="calendar" ng-model="$ctrl.dateVal" ng-change="$ctrl.dateSelected()" onclick="event.stopPropagation()" show-weeks="false" min-date="$ctrl.validators.min" max-date="$ctrl.validators.max"></datepicker></dropdown-overlay></div>'),e.put("components/dotGrid/dotGrid.html",'<div class="container"><div class="hideEdgeDots"><div class="background"></div></div></div>'),e.put("components/explorationFooter/explorationFooter.html",'<div class="explorationNavigationContent unselectable {{$ctrl.getModeString()}}" tabindex="0"><div class="background"></div><ul class="pane sections"><carousel auto-resize="::true"><li class="section static" ng-if="$ctrl.isEditMode()" ng-class="{\'selected\' : page.selected}" ng-repeat="page in $ctrl.viewModel.exploration.sections"><exploration-navigation-tab class="section dynamic" view-model="page" is-editing="true" tab-index="$index" ng-style="page.style" is-only-tab="$ctrl.viewModel.exploration.sections.length === 1"></exploration-navigation-tab></li><li class="section static" ng-if="!$ctrl.isEditMode()" ng-class="{\'selected\' : page.selected}" ng-repeat="page in $ctrl.viewModel.exploration.sections"><exploration-navigation-tab class="section dynamic" view-model="page" is-editing="false" tab-index="$index" ng-style="page.style"></exploration-navigation-tab></li></carousel><li ng-if="$ctrl.isEditMode()" class="section static create" ng-click="$ctrl.createSection()" localize-tooltip="Carousel_NewPage"><div class="thumbnail-container"><div class="thumbnail"></div></div></li></ul></div>'),e.put("components/forecastCard/forecastCard.html",'<analytics-card card="$ctrl.card" instances="$ctrl.instances" maximum-instances="::$ctrl.card.maxInstances" display-name="$ctrl.displayName" visual-container="$ctrl.visualContainer" on-add-instance="::$ctrl.onAddInstance(changes, instance)" on-update-instance="::$ctrl.onUpdateInstance(instance)" on-save="::$ctrl.onSave(changes, slice)" is-card-dirty="::$ctrl.isCardDirty(property, value)"><div class="parameterValues" ng-class="{disabled: $ctrl.card.instances.length === 0}"><label localize="Visual_Forecast_Parameter_ForecastLength" class="forecastLabel trimmedTextWithEllipsis" tooltip tooltip-config="$ctrl.parameterSlices[\'forecastDataPoints\'].tooltipConfig"></label><div class="inputField forecastParameterField" ng-class="{disabled: $ctrl.card.instances.length === 0}"><property-pane-text-box ng-model="$ctrl.parameterSlices[\'forecastDataPoints\'].value" validators="$ctrl.parameterSlices[\'forecastDataPoints\'].validators"></property-pane-text-box><select-menu class="selection" ng-model="$ctrl.parameterSlices[\'units\'].value" options="$ctrl.parameterSlices[\'units\'].selectionOptions" ng-change="$ctrl.onUnitsUpdated()"></select-menu></div><label localize="Visual_Forecast_Parameter_IgnoreLength" class="forecastLabel trimmedTextWithEllipsis" tooltip tooltip-config="$ctrl.parameterSlices[\'ignoreDataPoints\'].tooltipConfig"></label><div class="inputField forecastParameterField" ng-class="{disabled: $ctrl.card.instances.length === 0}"><property-pane-text-box ng-model="$ctrl.parameterSlices[\'ignoreDataPoints\'].value" validators="$ctrl.parameterSlices[\'ignoreDataPoints\'].validators"></property-pane-text-box><span class="selectedUnits" ng-bind="$ctrl.currentSelectedUnit"></span></div><label localize="Visual_Forecast_Parameter_ConfidenceInterval" class="forecastLabel trimmedTextWithEllipsis" tooltip tooltip-config="$ctrl.parameterSlices[\'confidenceInterval\'].tooltipConfig"></label><div class="inputField forecastParameterField" ng-class="{disabled: $ctrl.card.instances.length === 0}"><select-menu class="selection" ng-model="$ctrl.parameterSlices[\'confidenceInterval\'].value" options="$ctrl.parameterSlices[\'confidenceInterval\'].selectionOptions"></select-menu></div><label localize="Visual_Forecast_Parameter_Seasonality" class="forecastLabel trimmedTextWithEllipsis" tooltip tooltip-config="$ctrl.parameterSlices[\'seasonality\'].tooltipConfig"></label><div class="inputField forecastParameterField" ng-class="{disabled: $ctrl.card.instances.length === 0}"><property-pane-text-box ng-model="$ctrl.parameterSlices[\'seasonality\'].value" validators="$ctrl.parameterSlices[\'seasonality\'].validators" placeholder="$ctrl.parameterSlices[\'seasonality\'].placeholder"></property-pane-text-box><span class="selectedUnits" localize="Visual_Forecast_Units_Point"></span></div><div class="applyButton"><pbi-button kind="text" label="ForecastPane_Apply_Label" ng-click="$ctrl.saveForecastParameters()" ng-class="{active: $ctrl.haveParametersChanged()}"></pbi-button></div></div></analytics-card>'),
e.put("components/includeExcludeFilter/includeExcludeFilter.html",'<div class="cardHeader"><i ng-if="::$ctrl.filterViewModel.invalid" class="filterPaneIcon error"/><span class="caption trimmedTextWithEllipsis item-fill" ng-bind="$ctrl.viewModel.restatement"></span> <button class="fieldWellIcon dropDown item-auto" ng-class="$ctrl.isExpanded ? \'expand\' : \'collapse\'" ng-click="$ctrl.expand()"></button> <button class="delete glyphicon pbi-glyph-close glyph-micro item-auto" ng-click="$ctrl.deleteFilter($event, filterViewModel)" localize-tooltip="FilterPane_DeleteFilter"></button></div><div class="include-exclude-filter-items" ng-if="$ctrl.isExpanded"><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><div class="include-exclude-filter-item flex" ng-repeat="dataPoint in $ctrl.viewModel.points"><div class="smallFontSize trimmedTextWithEllipsis unselectable item-fill" ng-bind-attr="{title: dataPoint.text}" ng-bind="dataPoint.text"></div> <button type="button" class="delete glyphicon pbi-glyph-close glyph-micro" ng-click="$ctrl.delete($event, dataPoint, $index)"></button></div></ng-scrollbars></div>'),e.put("components/mobileVisualizationPane/mobileVisualizationPane.html",'<article class="sidePane rightSidePane visualizationPane smallFontSize"><div class="paneHeader"> <button class="toggleBtn"><h2 class="sidePaneHorizontalTitle unselectable sidePaneTitle largeFontSize trimmedTextWithEllipsis" localize="VisualizationPane_Title"></h2></button></div><div class="paneContents flex"><div class="sectionHost item-fill"><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><ul><visual-container-thumbnail ng-repeat="visual in $ctrl.visuals" visual="visual" viewport="$ctrl.viewport" drag="visual-container-thumbnail" drag-context="{ source: visual }"></visual-container-thumbnail></ul></ng-scrollbars></div></div></article>'),e.put("components/numericUnitSelection/numericUnitSelection.html",'<div class="numeric-unit-selector"><num-up-down class="unit-numupdown" ng-change="$ctrl.onValueChanged()" ng-model="$ctrl.modelVal" validators="$ctrl.validators" input-name="::$ctrl.inputName"></num-up-down><select-menu class="selection unit-selection-box" ng-model="$ctrl.unitVal" ng-change="$ctrl.onValueChanged()" options="$ctrl.unitOptions"></select-menu></div>'),e.put("components/pagePropertyPane/pagePropertyPane.html",'<section class="propertyPaneContents"><header class="unavailable" ng-if="$ctrl.isAvailable()" localize="PropertyPane_Unavailable"></header><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><property-card class="card" ng-repeat="card in $ctrl.viewModel.cards track by card.id" ng-click="$ctrl.expandCard(card.name)" view-model="card" expanded="$ctrl.isCardExpanded(card.name)" card-changed="$ctrl.save(slice, card)"></property-card></ng-scrollbars></section>'),e.put("components/penAnnotation/penAnnotation.html",'<canvas class="penAnnotationCanvas"></canvas>'),e.put("components/propertyCard/propertyCard.html",'<div class="flex cardTitle"><div class="cardTitleExpander arrowTop item-auto" ng-class="{\'selected\': $ctrl.expanded}"></div><header class="cardTitleDisplayName item-fill trimmedTextWithEllipsis" ng-bind="::$ctrl.viewModel.displayName" tooltip tooltip-config="$ctrl.getTooltipConfig()"></header><div class="cardTitleToggle item-auto" ng-if="$ctrl.viewModel.mainShow"><property-slice view-model="$ctrl.viewModel.mainShow" slice-changed="$ctrl.sliceChanged(slice)" type="$ctrl.getSliceComponentType($ctrl.viewModel.mainShow)"></property-slice></div></div><form ng-if="$ctrl.expanded" name="$ctrl.inputForm" class="contents" onclick="event.stopPropagation()"><property-slice-container slices="$ctrl.viewModel.header" on-changed="$ctrl.sliceChanged(slice)"></property-slice-container><virtual-list total-items-amount="$ctrl.viewModel.slices.length" init-limit="20"><div class="card-slice" ng-repeat="slice in $ctrl.viewModel.slices | limitTo:limitItems track by $ctrl.getSliceUniqueId(slice, $index)" ng-switch="$ctrl.getSliceComponentType(slice)"><property-slice view-model="slice" slice-changed="$ctrl.sliceChanged(slice)" type="$ctrl.getSliceComponentType(slice)" ng-switch-default></property-slice></div><div ng-if="$ctrl.viewModel.containers && $ctrl.viewModel.containers.length> 0"><div class="inputField"><select-menu class="item-fill selection full-line" ng-model="$ctrl.selectedContainerKey" ng-change="$ctrl.onSelectedContainerChanged()" options="$ctrl.viewModel.containers"></select-menu></div><property-slice-container slices="$ctrl.viewModel.selectedContainer.slices" on-changed="$ctrl.sliceChanged(slice)"></property-slice-container></div></virtual-list><property-slice-container slices="$ctrl.viewModel.footer" on-changed="$ctrl.sliceChanged(slice)"></property-slice-container></form>'),e.put("components/propertyPane/propertyPane.html",'<section class="propertyPaneContents"><header class="unavailable" ng-if="$ctrl.isAvailable()" localize="PropertyPane_Unavailable"></header><ng-scrollbars ng-scrollbars-config="::$ctrl.scrollbarsConfig"><property-card class="card" ng-repeat="card in $ctrl.viewModel.cards track by card.id" ng-click="$ctrl.expandCard(card.name)" view-model="card" expanded="$ctrl.isCardExpanded(card.name)" card-changed="::$ctrl.save(slice, card)" selected-container-changed="::$ctrl.selectContainer(cardName, containerKey)"></property-card></ng-scrollbars></section>'),e.put("components/propertySlice/propertySlice.html",'<div class="inputField" ng-show="$ctrl.viewModel.show" ng-switch="$ctrl.type" ng-class="{\'disabled\': $ctrl.viewModel.isDisabled,     \'multiline-flex\': $ctrl.type === \'numericUnitSelection\' }"><label class="title unselectable trimmedTextWithEllipsis {{$ctrl.getTitleClass()}}" ng-bind="$ctrl.viewModel.displayName" ng-if="$ctrl.showLabel()" tooltip tooltip-config="$ctrl.getTooltipConfig()"></label><property-pane-text-box class="item-fill" ng-model="$ctrl.viewModel.value" ng-change="$ctrl.change()" ng-switch-when="text" validators="$ctrl.viewModel.validators" placeholder="$ctrl.viewModel.placeholder" input-type="text"></property-pane-text-box><property-pane-text-box class="item-fill" ng-model="$ctrl.viewModel.value" ng-change="$ctrl.change()" ng-switch-when="numeric" validators="$ctrl.viewModel.validators" placeholder="$ctrl.viewModel.placeholder" input-type="number"></property-pane-text-box><toggle-switch class="item-auto" ng-class="{\'main-show\': $ctrl.viewModel.name === \'show\'}" ng-switch-when="bool" ng-change="$ctrl.change()" ng-model="$ctrl.viewModel.value" warning-message="$ctrl.viewModel.warningMessage"></toggle-switch><select-menu class="item-fill selection" ng-switch-when="selection" ng-model="$ctrl.viewModel.value" ng-change="$ctrl.change()" options="$ctrl.viewModel.selectionOptions"></select-menu><slider class="item-auto" ng-switch-when="slider" ng-change="$ctrl.change()" ng-model="$ctrl.viewModel.value" options="$ctrl.viewModel.sliderOptions" input-name="::$ctrl.viewModel.name"></slider><alignment-group class="item-auto" ng-switch-when="alignment" ng-change="$ctrl.change()" ng-model="$ctrl.viewModel.value"></alignment-group><color-picker class="item-auto" ng-switch-when="fill" ng-change="$ctrl.change()" ng-model="$ctrl.viewModel.value" type="$ctrl.viewModel.type"></color-picker><gradient-bar class="item-auto" ng-switch-when="gradientBar" ng-model="$ctrl.viewModel.value"></gradient-bar><image-upload ng-switch-when="image" ng-change="$ctrl.change()" ng-model="$ctrl.viewModel.value"></image-upload><numeric-unit-selection ng-switch-when="numericUnitSelection" unit-options="$ctrl.viewModel.selectionOptions" ng-change="$ctrl.change()" ng-model="$ctrl.viewModel.value" input-name="::$ctrl.viewModel.name" validators="$ctrl.viewModel.validators"></numeric-unit-selection><shape-map-selector class="item-fill selection" ng-switch-when="geoJson" view-model="$ctrl.viewModel.value" changed="$ctrl.change()"></shape-map-selector><textarea class="paragraph item-fill" ng-blur="$ctrl.change()" ng-model="$ctrl.viewModel.value" type="text" ng-switch-when="textarea" placeholder="{{::$ctrl.viewModel.placeholder}}" maxlength="250"></textarea><date-time-picker class="item-fill" ng-switch-when="dateTime" ng-model="$ctrl.viewModel.value" ng-change="$ctrl.change()" placeholder="$ctrl.viewModel.placeholder" validators="$ctrl.viewModel.validators"></date-time-picker><div type="button" class="clearAll trimmedTextWithEllipsis" ng-class="{\'dirtyCard\': $ctrl.viewModel.value}" ng-switch-when="revertToDefault" ng-click="$ctrl.change()" localize="Visual_RevertToDefault" localize-tooltip="Visual_RevertToDefaultDescription"></div></div>'),e.put("components/propertySliceContainer/propertySliceContainer.html",'<div ng-repeat="slice in $ctrl.slices track by $index"><property-slice view-model="slice" slice-changed="$ctrl.sliceChanged(slice)" type="$ctrl.getSliceComponentType(slice)"></property-slice></div>'),e.put("components/quickCalcDialog/quickCalcDialog.html",'<dialog-frame><dialog-header><span localize="QuickCalcDialog_Title"/></span></dialog-header><dialog-body><form class="quickCalcDialog"><section><h2 localize="QuickCalcDialog_BaseValueHeader"></h2><div class="boxed parameter baseFieldName trimmedTextWithEllipsis" ng-bind="::$ctrl.viewModel.baseFieldName"></div></section><section class="base-aggregation" ng-if="$ctrl.viewModel.availableAggregates.length> 0"><h2 localize="QuickCalcDialog_AggregateHeader"></h2> <select class="boxed parameter" ng-model="$ctrl.viewModel.selectedAggregate" ng-options="item.text for item in ::$ctrl.viewModel.availableAggregates track by item.key.aggregate" ng-change="$ctrl.onAggregateSelected()"></select></section><section class="calculation"><h2 localize="QuickCalcDialog_CalculationHeader"></h2> <select class="boxed parameter" ng-model="$ctrl.viewModel.selectedQuickCalc" ng-options="item.name for item in $ctrl.viewModel.availableQuickCalcs | filter:$ctrl.filterQuickCalc() track by item.kind"></select></section></form></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="$ctrl.commit()" class="primary" localize="OK_ButtonText"></button> <button ng-click="$ctrl.cancel()" localize="Cancel_ButtonText"></button></dialog-footer></dialog-frame>'),e.put("components/quickCalcDialog/quickCalcDialogDefinition.html",'<quick-calc-dialog view-model="viewModel"></quick-calc-dialog>'),e.put("components/referenceLineCard/referenceLineCard.html",'<analytics-card card="$ctrl.card" instances="$ctrl.instances" maximum-instances="::$ctrl.card.maxInstances" display-name="$ctrl.displayName" visual-container="$ctrl.visualContainer" on-add-instance="::$ctrl.onAddInstance(changes, instance)" on-delete-instance="::$ctrl.onDeleteInstance(instance)" on-update-instance="::$ctrl.onUpdateInstance(instance)" on-save="::$ctrl.onSave(changes, slice, instance)" is-card-dirty="::$ctrl.isCardDirty(property, value)"></analytics-card>'),e.put("components/referenceLineCardContainer/referenceLineCardContainer.html",'<reference-line-card card="$ctrl.prototypeCard" display-name="::line.title" visual-container="$ctrl.visualContainer" ng-repeat="line in $ctrl.referenceLines track by line.type" line="line" valid-measures="$ctrl.validMeasures" instances="line.instances"></reference-line-card>'),e.put("components/shapeMapSelector/shapeMapSelector.html",'<div class="shapeMapSelector"> <input class="file-input" type="file" accept=".json"/><table class="label-container"><tr><td><select-menu ng-model="$ctrl.selectedMapName" ng-change="$ctrl.change()" options="$ctrl.items"></select-menu><div class="label"><span class="unselectable" localize="Visual_ShapeMap_PropertyPaneLabel"></span></div></td></tr></table><div class="viewkeyslink-container"><a class="viewkeyslink" ng-show="$ctrl.viewModel.content" localize="Visual_ShapeMap_ViewMapKeys" ng-click="$ctrl.showDialog()" href=""></a></div><div class="custom-map-container" ng-if="!$ctrl.customMapName()"><div class="add-custom-map unselectable"><span localize="PropertyPane_AddShapeMap" ng-click="$ctrl.addCustomMap()"></span></div></div><div class="custom-map-container custom-map-name-spacing" ng-if="$ctrl.customMapName()"><div class="trimmedTextWithEllipsis"><span class="unselectable" ng-attr-title="{{$ctrl.customMapName()}}" ng-bind="$ctrl.customMapName()"></span><span class="remove-custom-map glyphicon pbi-glyph-close unselectable" ng-click="$ctrl.removeCustomMap()"></span></div></div></div>'),e.put("components/tableViewDialog/tableViewDialog.html",'<dialog-frame><dialog-header><span localize="$ctrl.titleKey"></span></dialog-header><dialog-body><section class="table" ng-if="::($ctrl.columnNames && $ctrl.columnNames.length> 0) || ($ctrl.tableValues && $ctrl.tableValues.length > 0)"><div class="tableViewDialogOverflow"><table><thead ng-if="::($ctrl.columnNames && $ctrl.columnNames.length> 0)"><tr><th ng-repeat="th in ::$ctrl.columnNames track by $index" ng-bind="::th"></th></tr></thead><tbody ng-if="::($ctrl.tableValues && $ctrl.tableValues.length> 0)"><tr ng-repeat="tr in ::$ctrl.tableValues track by $index"><td ng-repeat="td in ::tr track by $index" ng-bind="::td"></td></tr></tbody></table></div></section></dialog-body><dialog-footer> <button autofocus type="submit" ng-click="$ctrl.close()" class="primary" localize="TableViewDialog_CloseButtonText"></button></dialog-footer></dialog-frame>'),e.put("components/tableViewDialog/tableViewDialogDefinition.html",'<table-view-dialog title-key="titleKey" column-names="columnNames" table-values="tableValues"></table-view-dialog>'),e.put("components/topNFilter/topNFilter.html",'<form name="$ctrl.topNFilterForm" class="topNFilter" ng-submit="$ctrl.applyFilter()" ng-class="{ invalid: $ctrl.viewModel.cardType.invalid }"><pbi-alert ng-if="$ctrl.viewModel.cardType.invalid" kind="\'warning\'" message-warning="\'TopNFilter_SingleTopNAllowedWarning\'"></pbi-alert><fieldset class="filterOptions" ng-disabled="$ctrl.viewModel.cardType.invalid"><legend localize="TopNFilter_ShowItems"></legend><div class="topNSelector topNInputArea flex"> <select class="item-fill topNInputBox" ng-options="filterType.text for filterType in ::$ctrl.vm.filterTypes track by filterType.text" ng-model="$ctrl.vm.targetType"/> <input class="item-fill topNInputBox" type="number" ng-pattern="/^[1-9][0-9]{0,6}$/" ng-model="$ctrl.vm.itemCount"/></div></fieldset><fieldset class="orderBy" ng-disabled="$ctrl.viewModel.cardType.invalid"><legend localize="TopNFilter_Value"></legend><div class="topNInputArea ui-droppable dropzone topNInputBox" ng-class="{filled: $ctrl.vm.orderByDisplayName}" drop="$ctrl.dropConfig" drop-handler="$ctrl.dropFilterTarget()" drop-action="$ctrl.getDropAction()"><div class="flex orderByPill" ng-if="$ctrl.vm.orderByDisplayName"><span class="displayName trimmedTextWithEllipsis item-fill" ng-bind="$ctrl.vm.orderByDisplayName"></span> <button ng-if="$ctrl.vm.availableAggregates.items.length> 0" class="fieldWellIcon dropDown item-auto" type="button" ng-click="$ctrl.showContextMenu($event)"></button><pbi-button ng-click="$ctrl.removeOrderBy()" class="removeOrderBy" kind="icon" icon-name="close" icon-size="micro"></pbi-button></div><div class="dragHereWatermark trimmedTextWithEllipsis" localize="FieldDropZone_Watermark" ng-if="!$ctrl.vm.orderByDisplayName"></div></div></fieldset> <button type="submit" class="applyFilter smallFontSize" localize="Filter_ApplyFilter" localize-tooltip="Filter_ApplyFilterDescription" ng-disabled="!$ctrl.canApplyFilter()"/></form>'),e.put("components/visualContainerDrill/visualContainerDrill.html",'<button class="drillUp" ng-click="$ctrl.drillUp()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillUp" localize-tooltip="DrillUp_ToolTip"></button> <button class="drillDownLevel" ng-click="$ctrl.drillDownLevel()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillDownWithoutCurrentGroup" title="{{$ctrl.drillLevelTitle()}}"></button> <button class="drillDownLevelGrouped glyphicon glyph-small pbi-glyph-inline-drill" ng-click="$ctrl.drillDownLevelGrouped()" ng-if="$ctrl.canDrill()" ng-disabled="!$ctrl.canDrillDownWithCurrentGroup" title="{{$ctrl.drillLevelGroupedTitle()}}"></button>'),e.put("components/visualContainerDrillToggle/visualContainerDrillToggle.html",'<button class="drillToggle" ng-class="{\'enabled\': $ctrl.isDrillDownEnabled() }" ng-click="$ctrl.toggleDrillMode(1)" ng-if="$ctrl.canDrill()" title="{{$ctrl.drillTitle()}}"></button>'),e.put("components/visualContainerHeader/visualContainerHeader.html",'<div class="vcHeader"><div class="iconContainer"><canvas-visual-header-icon ng-if="$ctrl.visual.warningInfo" details="$ctrl.visual.warningInfo.details" icon-type="\'warning\'" ng-click="$ctrl.showWarningDetails()"></canvas-visual-header-icon><canvas-visual-header-icon ng-if="$ctrl.visual.transformWarningInfo" details="$ctrl.visual.transformWarningInfo.details" icon-type="\'error\'" ng-click="$ctrl.showTransformWarningDetails()" show-by-default="true"></canvas-visual-header-icon><canvas-visual-header-icon ng-if="$ctrl.visual.visualInfo" details="$ctrl.visual.visualInfo.details" icon-type="\'info\'" ng-click="$ctrl.showInfoDetails()"></canvas-visual-header-icon></div><visual-container-drill visual="::$ctrl.visual"></visual-container-drill><i class="dragGrip glyphicon pbi-glyph-gripperbarhorizontal glyph-small"></i><div class="optionsMenu"><visual-container-relationship-filters class="optionSection visualRelationshipFilters" visual="::$ctrl.visual" on-visual-container-changed="$ctrl.onVisualContainerChanged()" ng-if="$ctrl.canSetVisualRelationshipFilterAction()"></visual-container-relationship-filters><visual-container-drill-toggle class="optionSection" visual="::$ctrl.visual"></visual-container-drill-toggle><visual-container-pin-button class="optionSection" visual="::$ctrl.visual" disable-pin="$ctrl.disablePin"></visual-container-pin-button><div class="optionSection"> <button class="vcPopOutBtn" ng-click="$ctrl.popOutVisualContainer()" ng-if="$ctrl.canPopOut()" localize-tooltip="FocusModeVisual_ToolTip"><i class="glyphicon pbi-glyph-miniexpand glyph-small"></i></button> <button class="toggleSeeDataLayout" ng-click="$ctrl.toggleSeeDataLayout()" ng-if="$ctrl.visual.contract.popOutMode === 2" title="{{$ctrl.getSeeDataLayoutTitle()}}"><i class="glyphicon pbi-glyph-rotatevertical glyph-small" ng-class="{ \'pbi-glyph-rotatevertical\': $ctrl.visual.contract.detailVisualLayout !== 2, \'pbi-glyph-rotatehorizontal\': $ctrl.visual.contract.detailVisualLayout === 2 }"></i></button> <button class="vcMenuBtn" dropdown-overlay-invoke="vcMenu{{::$ctrl.menuId}}" localize-tooltip="Options_Menu" ng-if="$ctrl.menuOptions.hasMoreOptions"><i class="glyphicon pbi-glyph-more glyph-small"></i></button></div></div><visual-container-options-menu menu-id="::$ctrl.menuId" visual="::$ctrl.visual" menu-options="::$ctrl.menuOptions" ng-if="$ctrl.menuOptions.hasMoreOptions"></visual-container-options-menu></div>'),e.put("components/visualContainerPinButton/visualContainerPinButton.html",'<button class="vcPinBtn" ng-disabled="$ctrl.disablePin" ng-click="$ctrl.pinVisualContainer($event)" ng-show="$ctrl.showPin()" ng-if="$ctrl.canPin()" title="{{$ctrl.getPinTileTitle()}}"><i class="glyphicon pbi-glyph-pinned glyph-small"></i></button>'),e.put("components/visualContainerRelationshipFilters/visualContainerRelationshipFilters.html",'<button class="glyphicon glyph-small alwaysVisible" ng-if="$ctrl.supportsVisualRelationshipFilterAction(1)" ng-class="{ \'pbi-glyph-filterfilled\': $ctrl.filterAction === 1,  \'pbi-glyph-filter\': $ctrl.filterAction !== 1}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 1)" localize-tooltip="VisualRelationships_DataFilter"></button> <button class="glyphicon glyph-small alwaysVisible" ng-if="$ctrl.supportsVisualRelationshipFilterAction(2)" ng-class="{ \'pbi-glyph-crosshighlightfilled\': $ctrl.filterAction === 2,  \'pbi-glyph-crosshighlight\': $ctrl.filterAction !== 2}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 2)" localize-tooltip="VisualRelationships_HighlightFilter"></button> <button class="glyphicon glyph-small alwaysVisible" ng-if="$ctrl.supportsVisualRelationshipFilterAction(3)" ng-class="{ \'pbi-glyph-disablefilled\': $ctrl.filterAction === 3, \'pbi-glyph-disable\': $ctrl.filterAction !== 3}" ng-click="$ctrl.setVisualRelationshipFilterAction($event, 3)" localize-tooltip="VisualRelationships_NoFilter"></button>'),e.put("components/visualContainerThumbnail/visualContainerThumbnail.html",'<div apply-style="::$ctrl.style"><div class="thumbnailContainer disable-visual-interactivity" apply-style="::$ctrl.visualStyle"><div class="visualContainerScreen"></div><visual view-model="$ctrl.visualDefinition" allow-deferred-rendering="true"></visual></div><canvas-visual-error-overlay ng-if="$ctrl.errorInfo" error-info="$ctrl.errorInfo" view-mode="$ctrl.viewMode" viewport="$ctrl.viewport"></canvas-visual-error-overlay></div>'),e.put("components/visualOptionsMenu/visualContainerOptionsMenu.html",'<dropdown-overlay dropdown-overlay-name="vcMenu{{::$ctrl.menuId}}" class="vcOptionsMenu"><ul ng-if="$ctrl.isSelected"><li ng-if="$ctrl.menuOptions.canSearch" ng-click="$ctrl.toggleSearch($event);" class="trimmedTextWithEllipsis toggle" ng-class="{\'selected\': $ctrl.isSearchOn}"><i class="itemIcon glyphicon pbi-glyph-search glyph-small"></i><span class="itemLabel trimmedTextWithEllipsis" localize="Slicer_SearchBox_Text"></span></li><li class="sort toggle" ng-repeat="sortableField in $ctrl.menuOptions.sortSetting.sortableFields" ng-if="$ctrl.menuOptions.canSort" ng-class="{\'selected\': sortableField.active}"> <button class="toggleSortBtn" ng-disabled="!sortableField.active || !$ctrl.visual.readOnlyState.actualSortDirection" ng-click="$ctrl.toggleSort($event)"><ng-switch on="$ctrl.visual.readOnlyState.actualSortDirection"><span ng-switch-when="1" class="glyphicon pbi-glyph-atoz glyph-small" localize-tooltip="Sort_Desc"></span><span ng-switch-when="2" class="glyphicon pbi-glyph-ztoa glyph-small" localize-tooltip="Sort_Asc"></span><span ng-switch-default class="glyphicon pbi-glyph-atoz glyph-small" localize-tooltip="Sort_SortBy"></span></ng-switch></button><span localize="Sort_SortBy" ng-click="$ctrl.toggleSort($event, sortableField)" class="caption itemLabel trimmedTextWithEllipsis" localize-fragments><span fragment-index="0" ng-bind="sortableField.displayName"></span></span></li><li ng-if="$ctrl.menuOptions.canExport" ng-click="$ctrl.exportVisualData($event);" class="trimmedTextWithEllipsis"><i class="itemIcon glyphicon pbi-glyph-export glyph-small"></i><span class="itemLabel trimmedTextWithEllipsis" localize="ExportData_MenuItem"></span></li><li ng-if="$ctrl.menuOptions.canDelete" ng-click="$ctrl.deleteVisualContainer($event);" class="trimmedTextWithEllipsis"><i class="itemIcon glyphicon pbi-glyph-close glyph-mini"></i><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Remove_ToolTip" localize="Remove_visual"></span></li><li ng-if="$ctrl.menuOptions.canCluster" ng-click="$ctrl.getClusters();" class="trimmedTextWithEllipsis"><span class="itemLabel trimmedTextWithEllipsis" localize-tooltip="Visual_Cluster_FindGroups" localize="Visual_Cluster_FindGroups"></span></li><li ng-if="$ctrl.menuOptions.canSpatialCluster" ng-click="$ctrl.getSpatialClusters();" class="trimmedTextWIthEllipsis"><span class="itemLable trimmedTextWithEllipsis" localize-tooltip="Visual_Cluster_FindGroups_Spatial" localize="Visual_Cluster_FindGroups_Spatial"></span></li></ul></dropdown-overlay>'),e.put("views/svg/visualsWatermarks.svg",'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 479 492" enable-background="new 0 0 479 492" xml:space="preserve"><symbol id="100stackedbar"><rect x="0" y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="74.7" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="129.8" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="184" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="241" fill="#E1E2E3" width="380.4" height="39"/><rect x="0" y="20.6" fill="#D0D2D3" width="313.6" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="284.9" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="318.8" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="308.6" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="278.6" height="39"/><rect x="0" y="20.6" opacity="0.5" fill="#A6A8AB" width="211.1" height="39"/><rect x="0" y="74.7" opacity="0.5" fill="#A6A8AB" width="186.2" height="39"/><rect x="0" y="129.8" opacity="0.5" fill="#A6A8AB" width="211.1" height="39"/><rect x="0" y="184" opacity="0.5" fill="#A6A8AB" width="200" height="39"/><rect x="0" y="241" opacity="0.5" fill="#A6A8AB" width="184" height="39"/></symbol><symbol id="100stackedcolumn"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.4" x2="400" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.8" x2="400" y2="147.8"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222.3" x2="400" y2="222.3"/><rect x="19" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="83.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="147.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="211.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="275.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="339.1" y="20" fill="#E1E2E3" width="40.9" height="280.1"/><rect x="19" y="104.6" fill="#D0D2D3" width="40.9" height="195.5"/><rect x="83.1" y="58" fill="#D0D2D3" width="40.9" height="242.1"/><rect x="147.1" y="94.6" fill="#D0D2D3" width="40.9" height="205.5"/><rect x="211.1" y="99.5" fill="#D0D2D3" width="40.9" height="200.6"/><rect x="275.1" y="60.6" fill="#D0D2D3" width="40.9" height="239.5"/><rect x="339.1" y="136.5" fill="#D0D2D3" width="40.9" height="163.6"/><rect x="19" y="197.6" opacity="0.5" fill="#A6A8AB" width="40.9" height="102.5"/><rect x="83.1" y="173.2" opacity="0.5" fill="#A6A8AB" width="40.9" height="126.9"/><rect x="147.1" y="192.3" opacity="0.5" fill="#A6A8AB" width="40.9" height="107.8"/><rect x="211.1" y="184.7" opacity="0.5" fill="#A6A8AB" width="40.9" height="115.4"/><rect x="275.1" y="162.3" opacity="0.5" fill="#A6A8AB" width="40.9" height="137.8"/><rect x="339.1" y="206" opacity="0.5" fill="#A6A8AB" width="40.9" height="94.1"/></symbol><symbol id="area"><rect x="0.1" fill="#F4F4F4" width="399.8" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="73.5" x2="399.8" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="147.9" x2="399.8" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="222.4" x2="399.8" y2="222.4"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.2" y1="73.5" x2="399.8" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.9" x2="399.8" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.7" y1="222.4" x2="399.8" y2="222.4"/><g><g><g><polygon fill="#E1E2E3" points="345.1,93.4 287.8,77 230.6,82.1 173.9,211.9 115.1,204.3 56.9,217.5 0.1,172.3 0.1,300           399.8,300 399.8,82.3"/></g></g></g><g><polygon fill="#D0D2D3" points="115.1,206.7 175,214.5 231.8,84.9 287.3,80 344.6,96.4 399.8,85.2 399.8,81.1 344.8,92.3       288.1,76.1 287.7,76 229,81.2 172.5,210.1 114.9,202.7 57.5,215.7 0.1,170.2 0.1,175.3 56.5,220"/></g></symbol><symbol id="bar"><rect y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#D0D2D3" width="179.9" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="253.4" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="224.6" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="311.1" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="367.2" height="39"/></symbol><symbol id="kpi"><g id="Creation" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><g id="KPI-Canvas" sketch:type="MSArtboardGroup"><rect id="BG" fill="#FAFAFA" sketch:type="MSShapeGroup" x="0" y="0" width="400" height="299.441341"></rect><g id="Rectangle-20-+-Rectangle-21-+-Triangle-3" sketch:type="MSLayerGroup" transform="translate(122.000000, 123.000000)"><rect id="Rectangle-20" fill="#BABABA" sketch:type="MSShapeGroup" x="0" y="0" width="146" height="24"></rect><rect id="Rectangle-21" fill="#DDDDDD" sketch:type="MSShapeGroup" x="32" y="35" width="82" height="10"></rect><polygon id="Triangle-3" fill="#DDDDDD" sketch:type="MSShapeGroup" points="173.444444 1 186.888889 23 160 23 "></polygon></g><path d="M-2.30078125 266.449219 32.9472656 292.931641 66.9375 285.017578 100.927734 291.078125 134.900391 222.228516 167.779297 219.632812 198.302734 227.175781 242.171875 250.173828 286.412109 226.193359 316.695312 229.787109 352.632812 216.943359 425.914062 225.597656 425.914062 367.497434-34.7301703 367.497434-34.7301703 273.284528-2.30078125 266.449219Z" id="Path-2" stroke="#DDDDDD" stroke-width="2" fill="#EAEAEA" sketch:type="MSShapeGroup"></path></g></g></symbol><symbol id="card"><rect x="0" y="0.3" fill="#F4F4F4" width="400" height="299.6"/><rect x="0" y="0.3" fill="#A6A6A6" width="8" height="299.6"/><rect x="221.6" y="42.2" fill="#A6A6A6" width="139.9" height="4"/><rect x="221.6" y="109.7" fill="#A6A6A6" width="139.9" height="4"/><rect x="221.6" y="180" fill="#A6A6A6" width="141.7" height="4"/><rect x="221.6" y="249.5" fill="#A6A6A6" width="141.7" height="4"/><rect x="34.1" y="41.8" opacity="0.5" fill="#A6A8AB" width="142" height="142"/><rect x="36.1" y="249.5" fill="#A6A6A6" width="141.7" height="4"/></symbol><symbol id="clusteredBar"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.1" height="300"/><rect x="0" y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="25.1" fill="#E1E2E3" width="290.1" height="13.5"/><rect x="0" y="71.1" fill="#E1E2E3" width="338.1" height="13.5"/><rect x="0" y="103.8" fill="#E1E2E3" width="237.1" height="13.5"/><rect x="0" y="182.6" fill="#E1E2E3" width="237.1" height="13.5"/><rect x="0" y="260.8" fill="#E1E2E3" width="313.1" height="13.5"/><rect x="0" y="38.8" fill="#ACACAC" width="211.1" height="13.5"/><rect x="0" y="136.5" fill="#E1E2E3" width="284.1" height="13.5"/><rect x="0" y="215" fill="#E1E2E3" width="240.1" height="13.5"/><rect x="0" y="150.2" fill="#ACACAC" width="336.1" height="13.5"/><rect x="0" y="228.4" fill="#ACACAC" width="284.1" height="13.5"/></symbol><symbol id="clusteredColumn"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.4" x2="400" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.8" x2="400" y2="147.8"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222.3" x2="400" y2="222.3"/><rect x="43.7" y="163.6" fill="#D0D2D3" width="40.9" height="135.7"/><rect x="84.4" y="196.8" fill="#ACACAC" width="40.9" height="102.5"/><rect x="147.7" y="52.2" fill="#D0D2D3" width="40.9" height="247.1"/><rect x="315.4" y="131" fill="#D0D2D3" width="40.9" height="168.3"/><rect x="252" y="160.6" fill="#ACACAC" width="40.9" height="138.7"/><rect x="211.1" y="103.8" fill="#D0D2D3" width="40.9" height="195.5"/></symbol><symbol id="column"><rect x="0" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="73.5" x2="400" y2="73.5"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="147.9" x2="400" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="222.4" x2="400" y2="222.4"/><rect x="19.1" y="193.3" fill="#D0D2D3" width="40.9" height="106.9"/><rect x="83.1" y="167.8" fill="#D0D2D3" width="40.9" height="132.4"/><rect x="147.1" y="187.8" fill="#D0D2D3" width="40.9" height="112.4"/><rect x="211.2" y="82.1" fill="#D0D2D3" width="40.9" height="218.1"/><rect x="275.2" y="39.9" fill="#D0D2D3" width="40.9" height="260.3"/><rect x="339.2" y="122.3" fill="#D0D2D3" width="40.9" height="177.9"/></symbol><symbol id="combo"><rect x="0" y="0.3" fill="#F4F4F4" width="399.8" height="299.7"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="73.4" x2="399.7" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="147.9" x2="399.7" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="222.3" x2="399.7" y2="222.3"/><rect x="20.4" y="189.5" fill="#D0D2D3" width="40.7" height="110.6"/><rect x="84.1" y="163.1" fill="#D0D2D3" width="40.7" height="137"/><rect x="147.9" y="183.8" fill="#D0D2D3" width="40.7" height="116.4"/><rect x="211.6" y="74.4" fill="#D0D2D3" width="40.7" height="225.8"/><rect x="275.3" y="30.7" fill="#D0D2D3" width="40.7" height="269.5"/><rect x="339" y="116.1" fill="#D0D2D3" width="40.7" height="184.1"/><polyline opacity="0.5" fill="none" stroke="#A6A8AB" stroke-width="4" stroke-miterlimit="10" points="399.3,95.6 344.1,106.8     287.4,90.5 230.7,95.6 174.6,224.8 116.4,217.1 58.8,230.3 2.4,185.2 "/></symbol><symbol id="defaultWatermark"><g><rect x="0" y="1" opacity="0.5" fill="#F4F4F4" width="400" height="300"/><path fill="#929497" d="m93.79999 69.79999v47l30.20001 36.09998c10.29999-8.59998 16.79999-21.59998 16.79999-36.09998l0 0c0-25.89999-21.09998-47-47-47z"/><path fill="#D0D2D3" d="m46.7 116.9c0 22.1 15.3 40.49999 35.6 45.7l11.39999-45.7h-47l0 0 0 0z"/><path fill="#E1E2E3" d="m93.79999 116.89999-11.39999 45.69999c3.69998.90001 7.39999 1.5 11.39999 1.5 11.5 0 22-4.09999 30.20001-11l-30.20001-36.19999z"/><path fill="#A6A8AB" d="m93.79999 69.79999c-25.99998 0-46.99998 21-46.99998 47l0 0h46.99998v-47l0 0z"/><g><polygon fill="#E1E2E3" points="200.89999389648438 193.5999755859375 167.70001220703125 185.0999755859375 134.29998779296875 187.70001220703125 101.29998779296875 254.9000244140625 67.10000610351562 251 33.30000305175781 257.79998779296875 0.1999969482421875 234.4000244140625 0.1999969482421875 300.5 399.9000244140625 300.5 399.9000244140625 187.9000244140625 349.20001220703125 182.0999755859375 314.1000061035156 194.5999755859375 286.8999938964844 191.0999755859375 242 214.5 "/></g><g><polyline fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" points="399.9000244140625 187.70001220703125 349.20001220703125 182.0999755859375 314.1000061035156 194.5999755859375 286.8999938964844 191.0999755859375 242 214.5 200.89999389648438 193.4000244140625 167.70001220703125 185 134.29998779296875 187.5999755859375 101.29998779296875 254.79998779296875 67.10000610351562 251 33.30000305175781 257.70001220703125 0.1999969482421875 234.4000244140625 "/></g><rect x="185.6" y="115.9" fill="#E1E2E3" width="20.7" height="48"/><rect x="217.8" y="104.4" fill="#E1E2E3" width="20.7" height="59.5"/><rect x="250.1" y="113.4" fill="#E1E2E3" width="20.7" height="50.5"/><rect x="282.3" y="66" fill="#E1E2E3" width="20.7" height="97.9"/><rect x="314.6" y="47" fill="#E1E2E3" width="20.7" height="116.9"/><rect x="346.8" y="84" fill="#E1E2E3" width="20.7" height="79.9"/><rect x="185.6" y="129.5" fill="#D0D2D3" width="20.7" height="34.4"/><rect x="217.8" y="121.2" fill="#D0D2D3" width="20.7" height="42.7"/><rect x="250.1" y="127.7" fill="#D0D2D3" width="20.7" height="36.1"/><rect x="282.3" y="93.7" fill="#D0D2D3" width="20.7" height="70.2"/><rect x="314.6" y="80.1" fill="#D0D2D3" width="20.7" height="83.8"/><rect x="346.8" y="106.6" fill="#D0D2D3" width="20.7" height="57.2"/><rect x="185.6" y="145.1" opacity="0.5" fill="#A6A8AB" width="20.7" height="18.7"/><rect x="217.8" y="140.7" opacity="0.5" fill="#A6A8AB" width="20.7" height="23.2"/><rect x="250.1" y="144.1" opacity="0.5" fill="#A6A8AB" width="20.7" height="19.7"/><rect x="282.3" y="125.6" opacity="0.5" fill="#A6A8AB" width="20.7" height="38.2"/><rect x="314.6" y="118.3" opacity="0.5" fill="#A6A8AB" width="20.7" height="45.6"/><rect x="346.8" y="132.7" opacity="0.5" fill="#A6A8AB" width="20.7" height="31.1"/></g></symbol><symbol id="donut"><rect x="1.3" y="0.2" fill="#F4F4F4" width="398.7" height="299.8"/><path fill="#929497" d="M200.6 55.6v94.5l60.6 72.5c20.7-17.3 33.9-43.4 33.9-72.5v0C295.1 97.9 252.8 55.6 200.6 55.6z"/><path fill="#D0D2D3" d="M106.1 150.1c0 44.3 30.5 81.4 71.6 91.7l22.9-91.7H106.1z"/><path fill="#E1E2E3" d="M200.6 150.1l-22.9 91.7c7.3 1.8 15 2.8 22.9 2.8 23.1 0 44.2-8.3 60.6-22L200.6 150.1z"/><path fill="#A6A8AB" d="M200.6 55.6c-52.2 0-94.5 42.3-94.5 94.5v0h94.5V55.6z"/><circle fill="#F4F4F4" cx="200.6" cy="151" r="53.4"/></symbol><symbol id="funnel"><rect x="1.3" y="0" fill="#F4F4F4" width="398.7" height="300"/><g><g><g><rect x="46.5" y="59.7" fill="#D0D2D3" width="317.6" height="33.9"/></g><g><rect x="82.7" y="97.9" fill="#D0D2D3" width="245.2" height="33.9"/></g><g><rect x="141.2" y="136.2" fill="#D0D2D3" width="128.3" height="33.9"/></g><g><rect x="181.2" y="174.4" fill="#D0D2D3" width="48.3" height="33.9"/></g><g><rect x="194.1" y="212.6" fill="#D0D2D3" width="23.4" height="33.9"/></g></g></g></symbol><symbol id="filledMap"><rect x="0.7" y="0" opacity="0.5" fill="#F4F4F4" width="401.4" height="302.1"/><g><defs><rect id="SVGID_1_" x="0.2" y="0" width="401.4" height="302.1"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#E1E2E3" d="M49.4-9.3l18.3 44.6-97.2 30.3c-2.2.7-3.4 3-2.7 5.2.6 1.8 2.2 2.9 4 2.9.4 0 .8-.1 1.2-.2l57.4-17.9-1.9 32.9-59.3-4c-2.3-.2-4.3 1.6-4.4 3.9-.2 2.3 1.6 4.3 3.9 4.4l59.4 4-6.3 111-50.9-26.4c-2-1.1-4.5-.3-5.6 1.8-1.1 2-.3 4.5 1.8 5.6l56.6 29.4c0 0 0 0 0 0l21.2 11-71 60c-1.1.9-1.6 2.3-1.4 3.7.2 1.4 1 2.6 2.2 3.2l62.9 31.8c.6.3 1.2.4 1.9.4 1.5 0 3-.8 3.7-2.3 1-2 .2-4.5-1.8-5.6l-57.3-29 68.8-58.1 20.9 10.9-4.6 79.7c-.1 2.3 1.6 4.2 3.9 4.4.1 0 .2 0 .2 0 2.2 0 4-1.7 4.1-3.9l4.3-76 39 20.2-41.7 53c-1.4 1.8-1.1 4.4.7 5.8.8.6 1.7.9 2.6.9 1.2 0 2.4-.5 3.3-1.6L180.7 206l54.3 26.3-44.4 89.9c-1 2.1-.2 4.5 1.9 5.6.6.3 1.2.4 1.8.4 1.5 0 3-.8 3.7-2.3l44.4-90 40.4 19.6-34.1 66.7c-1 2-.2 4.5 1.8 5.6.6.3 1.2.5 1.9.5 1.5 0 3-.8 3.7-2.3l34.2-66.8 63.2 30.6-2.9 34c-.2 2.3 1.5 4.3 3.8 4.5.1 0 .2 0 .4 0 2.1 0 3.9-1.6 4.1-3.8l2.9-34.6L400 295c2.2-.5 3.6-2.8 3-5-.5-2.2-2.8-3.6-5-3l-35.5-5.9 4.3-51H399c2.3 0 4.1-1.9 4.1-4.1 0-2.3-1.9-4.1-4.1-4.1h-48.8l-32.4-16.4 1.2-2.4c.1-.3.2-.5.3-.8l3.4-12.9 76.1 2.9c.1 0 .1 0 .2 0 2.2 0 4.1-1.8 4.1-4 .1-2.3-1.7-4.2-4-4.3l-74.2-2.8 14.3-54c14.8 3.5 31.6 5.8 50.3 5.8 3.2 0 6.4-.1 9.6-.2 2.3-.1 4.1-2 4-4.3-.1-2.3-2-4.1-4.3-4-21.6.9-40.8-1.5-57.4-5.5l4.7-17.8c14.6 3.3 27.6 4.2 37.1 4.2 9.7 0 15.8-.9 16.3-1 2.3-.3 3.8-2.5 3.5-4.7-.3-2.3-2.4-3.8-4.7-3.5-.2 0-21.4 3.1-48.3-2.7l5.8-76.7 42.9 3.3c2.3.2 4.3-1.5 4.5-3.8.2-2.3-1.5-4.3-3.8-4.5l-45.4-3.5-17.5-31.4c-1.5-1.5-3.9-1.7-5.6-.3l-62.7 64.2c-9.9-13.8-17.7-30.2-23.5-48.9-.7-2.2-3-3.4-5.2-2.7-2.2.7-3.4 3-2.7 5.2 6.5 20.9 15.2 37.9 25.2 51.6l-19.1 16.1c-2.6-1.8-33.6-24.6-44.4-76.8-.5-2.2-2.7-3.7-4.9-3.2-2.2.5-3.7 2.7-3.2 4.9.7 3.3 1.4 6.5 2.3 9.5l-80.5 25.1c-11.6-10.9-7.7-34.5-7.7-34.8.4-2.3-1.1-4.4-3.4-4.8-2.3-.4-4.4 1.1-4.8 3.4-.2 1.1-4.1 24.4 7.2 38.9l-27.8 8.7c0 0 0 0 0-.1L55.8-15.6c-.8-1.8-2.7-2.9-4.7-2.5M307.8 206.7l-7 13.6-40.7-20.2 10.9-22 16 9.2c.6.3 1.2.5 1.9.6l25.4 1-2.8 10.7-2.2 4.3M286.3 71.9c6.9 5.7 13.9 10.4 20.9 14.3-.1.2-.3.4-.4.6l-8.1 16.4c-12.3-6.2-20.8-12.1-25-15.3l12.4-15.8C286.2 72.1 286.2 72 286.3 71.9zM268.5 94.5c4.5 3.5 13.4 9.8 26.4 16.3l-42.2 85.6-46.3-23.1L268.5 94.5zM316.5 180.6l-26.2-1-15.6-9 27.7-56.2c8.3 3.8 17.9 7.4 28.8 10.4L316.5 180.6zM333.4 116.7c-10.2-2.9-19.3-6.4-27.2-9.9l8-16.3c.1-.2.1-.4.2-.6 6.4 3.1 12.7 5.5 18.7 7.4 1.7.5 3.4 1 5 1.5L333.4 116.7zM333.1-14.8l14.6 28.5-5.8 77.7c-2.1-.6-4.1-1.2-6.2-1.9-25.4-8.2-46.3-22.3-62.4-42.3L333.1-14.8zM280.2 66.5c-.2.2-.4.4-.6.6l-82.9 105.2 0 0-18.4 23.4-51.4-24.9L267 52.3C271.2 57.5 275.6 62.3 280.2 66.5zM86.8 160.6l24.9 12.1-26.9 22.7L86.8 160.6zM87.4 151.6l3-52.7 8.4-4.6 2.2 3.5v14.7c0 2.3 1.9 4.1 4.1 4.1h27.7c1.1 0 2.1-.4 2.9-1.1L165.6 87l20.7 22.7-67.6 57.1L87.4 151.6zM184.9 47.6l4 5.6-57.7 55.1h-21.9V96.6c0-.8-.2-1.6-.6-2.2l-2.6-4L184.9 47.6zM236.3 67.4l-43.7 36.9-21-23.1 25.7-24.5c1.5-1.4 1.7-3.7.5-5.4l-5.5-7.7 16.2-8.8C219.5 53.4 231.5 63.7 236.3 67.4zM204.5 27.5 90.9 89.1l3-53.3L194.9 4.3C197.7 13 201 20.7 204.5 27.5zM38.8 53l46.7-14.6-3.1 53.8-45.7-3.1L38.8 53zM29.8 212l6.5-114.6 45.7 3.1-5.8 102.2-24.4 20.6L29.8 212zM59.7 227.5l15.8-13.4L74.3 235 59.7 227.5zM126.1 261.9l-43.7-22.7 1.9-32.5 35.7-30.2 53.1 25.7L126.1 261.9zM185.9 199.3l15.2-19.3 47.9 23.8-10.4 21L185.9 199.3zM246.1 228.5l10.3-21 40.6 20.2-10.4 20.4L246.1 228.5zM294.1 251.7l12.3-24c0 0 0 0 0 0l0 0 7.7-15 33.3 16.9c.6.3 1.2.4 1.9.4h9.3l-4.3 50.8L294.1 251.7z"/></g><g><polygon fill="#A6A8AB" points="119.4,172.5 81.5,203.8 79.7,244.4 127.5,265.1 178.4,199.4 \t"/><path fill="#A6A8AB" d="M127.5 270.4c-.7 0-1.4-.1-2.1-.4l-47.8-20.7c-2-.9-3.3-2.9-3.2-5.1l1.8-40.5c.1-1.5.8-2.9 1.9-3.8l37.9-31.3c1.6-1.3 3.7-1.6 5.6-.7l59 26.9c1.5.7 2.6 2 2.9 3.5.4 1.6 0 3.2-1 4.5l-50.9 65.7C130.7 269.6 129.1 270.4 127.5 270.4zM85.2 240.9l40.7 17.6 44.3-57.1-50-22.7-33.5 27.7L85.2 240.9z"/></g><g><path fill="#A6A8AB" d="M301.3 108.4l-30.6 62.9L289 183l30.9.6 16-61.9C336 121.7 324 121 301.3 108.4z"/><path fill="#A6A8AB" d="M320 188.9C319.9 188.9 319.9 188.9 320 188.9l-31-.6c-1 0-1.9-.3-2.8-.8l-18.3-11.7c-2.3-1.5-3.1-4.4-1.9-6.8l30.6-62.9c.6-1.3 1.8-2.3 3.2-2.8 1.4-.4 2.9-.3 4.2.4 20.9 11.7 32.2 12.6 32.4 12.6 1.6.1 3 .9 4 2.2.9 1.3 1.2 2.9.9 4.4l-16 61.9C324.5 187.3 322.4 188.9 320 188.9zM290.6 177.7l25.2.5 13.5-52.3c-5.3-1.3-14-4.1-25.7-10.2l-26.1 53.6L290.6 177.7z"/></g><g><polygon fill="#A6A8AB" points="99.7,90.8 104.9,98.1 104.9,111.3 132,111.3 192.9,53.8 185.9,42.8 \t"/><path fill="#A6A8AB" d="M132 116.6h-27.1c-2.9 0-5.3-2.4-5.3-5.3V99.8l-4.3-5.9c-.9-1.2-1.2-2.8-.9-4.3.3-1.5 1.3-2.8 2.6-3.5l86.3-47.9c1.9-1 4.2-.8 5.8.5l6.9 10.9c1.2 1 1.9 2.4 2 3.9.1 1.5-.5 3-1.6 4.1l-60.8 57.5C134.7 116 133.4 116.6 132 116.6zM110.2 106h19.7l54.9-51.9-2.4-1.9-74.9 40.4 1.7 2.4c.7.9 1 2 1 3.1V106z"/></g><g><polygon fill="#A6A8AB" points="4.8,91.4 30.6,92.8 24.6,213.1 4.8,201.8 \t"/><path fill="#A6A8AB" d="M24.6 218.4c-.9 0-1.8-.2-2.6-.7L2.2 206.4c-1.7-.9-2.7-2.7-2.7-4.6V91.4c0-1.4.6-2.8 1.6-3.8 1.1-1 2.5-1.5 3.9-1.4l25.8 1.3c2.9.1 5.2 2.6 5 5.5l-5.9 120.3c-.1 1.8-1.1 3.5-2.7 4.4C26.4 218.1 25.5 218.4 24.6 218.4zM10.1 198.7l9.7 5.5L25 97.8 10.1 97V198.7z"/></g><g><polygon fill="#A6A8AB" points="240.1,229.5 255.4,202.2 301.3,225.5 287.4,251.5 \t"/><path fill="#A6A8AB" d="M287.4 256.8c-.8 0-1.5-.2-2.2-.5l-47.3-22c-1.3-.6-2.4-1.8-2.8-3.2s-.3-2.9.4-4.2l15.3-27.3c1.4-2.5 4.5-3.4 7.1-2.1l45.9 23.3c1.3.6 2.2 1.8 2.7 3.2.4 1.4.3 2.9-.4 4.1l-14 26C291.1 255.8 289.3 256.8 287.4 256.8zM247.6 227.1l37.5 17.4 9-16.7-36.5-18.5L247.6 227.1z"/></g><g><polygon fill="#A6A8AB" points="358.4,272.1 364.6,226.4 396.5,226.4 397,271.7 \t"/><path fill="#A6A8AB" d="M358.4 277.4c-1.5 0-3-.7-4-1.8-1-1.2-1.5-2.7-1.3-4.2l6.2-45.7c.4-2.6 2.6-4.6 5.3-4.6h31.9c2.9 0 5.3 2.4 5.3 5.3l.4 45.3c0 2.9-2.3 5.3-5.3 5.4L358.4 277.4C358.4 277.4 358.4 277.4 358.4 277.4zM369.2 231.7l-4.8 35 27.1-.3-.3-34.7H369.2z"/></g><g><path fill="#A6A8AB" d="M198.6 5c0 0 6.2 34.2 43.5 62.6L314 5.4 198.6 5z"/><path fill="#A6A8AB" d="M242.1 72.9c-1.1 0-2.3-.4-3.2-1.1-38.5-29.3-45.2-64.4-45.5-65.8-.3-1.6.1-3.2 1.2-4.4 1-1.2 2.5-1.9 4.1-1.9L314 .1c2.2 0 4.2 1.4 5 3.5.8 2.1.2 4.4-1.5 5.9l-71.9 62.1C244.6 72.4 243.4 72.9 242.1 72.9zM205.7 10.3c3.5 10.3 13 31.4 36.3 50.3l57.8-49.9L205.7 10.3z"/></g><g><path fill="#A6A8AB" d="M56.3 5l15 31.3 37-11.5c0 0-3.1-4.4-7.9-20.3L56.3 5z"/><path fill="#A6A8AB" d="M71.2 41.5c-2 0-3.9-1.1-4.8-3l-15-31.3c-.8-1.6-.7-3.5.3-5.1s2.6-2.5 4.4-2.5l44.1-.4c0 0 0 0 .1 0 2.3 0 4.4 1.5 5.1 3.7 4.4 14.4 7.2 18.8 7.3 18.9 1 1.4 1.2 3.1.6 4.7-.5 1.6-1.9 2.8-3.5 3.3l-37 11.5C72.3 41.5 71.8 41.5 71.2 41.5zM64.6 10.2 74 29.8l26.7-8.3c-1.2-2.7-2.6-6.5-4.3-11.7L64.6 10.2z"/></g><g><path fill="#A6A8AB" d="M397.4 21.9l-1.6 78.5c-29.3 4.7-49.9-4.7-49.9-4.7L353 17l-8.4-12h53.2L397.4 21.9z"/><path fill="#A6A8AB" d="M379.4 107c-21.2 0-35.1-6.2-35.7-6.4-2.1-.9-3.3-3.1-3.1-5.3l6.9-76.8-7.3-10.4c-1.1-1.6-1.3-3.8-.4-5.5.9-1.8 2.7-2.9 4.7-2.9h53.2c1.4 0 2.8.6 3.8 1.6 1 1 1.5 2.4 1.5 3.9L402.7 22l-1.6 78.5c-.1 2.6-1.9 4.7-4.5 5.2C391 106.6 385.2 107 379.4 107zM351.6 92.2c5 1.6 14.9 4.2 27.8 4.2 3.7 0 7.5-.2 11.2-.6l1.5-74 .3-11.4h-37.5l2.5 3.6c.7 1 1.1 2.3.9 3.5L351.6 92.2z"/></g></symbol><symbol id="gauge"><rect y="0.4" opacity="0.5" fill="#F4F4F4" width="400.1" height="299.6"/><path fill="#E1E2E3" d="M200 82.3c-73.7 0-133.4 59.7-133.4 133.4h51.6c0-45.2 36.6-81.8 81.8-81.8s81.8 36.6 81.8 81.8h51.6C333.4 142 273.7 82.3 200 82.3z"/><path fill="#A6A8AB" d="M94.4 134.3C77 156.8 66.7 185 66.7 215.7h51.6c0-18.9 6.4-36.2 17.1-50.1L94.4 134.3z"/></symbol><symbol id="line"><rect x="0.1" fill="#F4F4F4" width="399.3" height="300.2"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="73" x2="399.4" y2="73"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="147" x2="399.4" y2="147"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.1" y1="220.9" x2="399.4" y2="220.9"/><g><polygon fill="#D0D2D3" points="115.1,206.7 175,214.5 231.8,84.9 287.3,80 344.6,96.4 399.8,85.2 399.8,81.1 344.8,92.3       288.1,76.1 287.7,76 229,81.2 172.5,210.1 114.9,202.7 57.5,215.7 0.1,170.2 0.1,175.3 56.5,220 \t"/></g></symbol><symbol id="map"><g><defs><rect id="SVGID_1_" x="0.9" y="0.2" width="399.1" height="299.6"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#E1E2E3" d="M54.1-9.8l19.8 48.3L-31.3 71.3c-2.4.7-3.7 3.3-2.9 5.6.6 1.9 2.4 3.2 4.3 3.2.4 0 .9-.1 1.3-.2l62.1-19.4-2 35.6-64.1-4.4c-2.5-.2-4.6 1.7-4.8 4.2-.2 2.5 1.7 4.6 4.2 4.8L31 105l-6.8 120.1-55-28.5c-2.2-1.1-4.9-.3-6.1 1.9-1.1 2.2-.3 4.9 1.9 6.1l61.3 31.8c0 0 0 0 0 0l22.9 11.9-76.8 64.9c-1.2 1-1.7 2.5-1.6 4 .2 1.5 1.1 2.8 2.4 3.5l68.1 34.4c.6.3 1.3.5 2 .5 1.6 0 3.2-.9 4-2.5 1.1-2.2.2-4.9-2-6l-62-31.4 74.4-62.9 22.7 11.8-4.9 86.3c-.1 2.5 1.8 4.6 4.2 4.7.1 0 .2 0 .3 0 2.4 0 4.3-1.8 4.5-4.2l4.7-82.2 42.2 21.9-45.2 57.3c-1.5 1.9-1.2 4.8.7 6.3.8.6 1.8 1 2.8 1 1.3 0 2.6-.6 3.5-1.7l102.9-130.5 58.8 28.5-48 97.3c-1.1 2.2-.2 4.9 2 6 .6.3 1.3.5 2 .5 1.7 0 3.2-.9 4-2.5l48-97.4 43.7 21.2-36.9 72.2c-1.1 2.2-.3 4.9 2 6 .7.3 1.4.5 2 .5 1.6 0 3.2-.9 4-2.4l37-72.3 68.4 33.1-3.1 36.8c-.2 2.5 1.6 4.6 4.1 4.9.1 0 .3 0 .4 0 2.3 0 4.3-1.8 4.5-4.1l3.2-37.5 41.3 5.7c2.4-.6 3.9-3 3.3-5.4-.6-2.4-3-3.9-5.4-3.3l-38.4-6.4 4.7-55.2h34.8c2.5 0 4.5-2 4.5-4.5s-2-4.5-4.5-4.5h-52.8l-35.1-17.8 1.4-2.6c.1-.3.3-.6.3-.9l3.7-14 82.3 3.1c.1 0 .1 0 .2 0 2.4 0 4.4-1.9 4.5-4.3.1-2.5-1.8-4.6-4.3-4.7l-80.3-3 15.5-58.4c16 3.8 34.2 6.3 54.4 6.3 3.4 0 6.9-.1 10.4-.2 2.5-.1 4.4-2.2 4.3-4.7-.1-2.5-2.2-4.4-4.7-4.3-23.3 1-44.1-1.6-62.1-6l5.1-19.3c15.8 3.6 29.9 4.5 40.2 4.5 10.5 0 17.1-1 17.7-1 2.5-.4 4.1-2.7 3.8-5.1-.4-2.5-2.7-4.1-5.1-3.8-.3 0-23.2 3.3-52.3-2.9l6.2-83 46.4 3.6c2.5.2 4.6-1.7 4.8-4.1.2-2.5-1.7-4.6-4.1-4.8L383.6 9l-18.9-34c-1.6-1.7-4.2-1.8-6.1-.4l-67.8 69.5c-10.7-15-19.2-32.6-25.5-52.9-.7-2.4-3.3-3.7-5.6-3-2.4.7-3.7 3.2-3 5.6 7 22.7 16.5 41 27.2 55.9l-20.7 17.5c-2.8-2-36.3-26.7-48-83.1-.5-2.4-2.9-4-5.3-3.5-2.4.5-4 2.9-3.5 5.3.7 3.6 1.6 7 2.5 10.3l-87.1 27.2c-12.6-11.8-8.4-37.4-8.3-37.6.4-2.4-1.2-4.8-3.6-5.2-2.5-.4-4.8 1.2-5.2 3.6-.2 1.2-4.4 26.4 7.8 42.1l-30.1 9.4c0 0 0 0 0-.1L61-16.7c-.8-2-2.9-3.1-5-2.7M333.7 223.9l-7.5 14.7-44-21.9 11.8-23.8 17.3 10c.6.4 1.3.6 2.1.6l27.4 1-3.1 11.6-2.4 4.6M310.5 78c7.4 6.2 15.1 11.3 22.6 15.4-.2.2-.3.4-.4.7l-8.8 17.8c-13.3-6.7-22.5-13.1-27-16.5l13.4-17.1C310.3 78.2 310.4 78.1 310.5 78zM291.2 102.5c4.9 3.8 14.6 10.6 28.6 17.7l-45.7 92.6L224 187.8 291.2 102.5zM343.1 195.6l-28.4-1.1-16.9-9.7 30-60.8c9 4.1 19.4 8 31.2 11.3L343.1 195.6zM361.4 126.5c-11.1-3.1-20.9-6.9-29.4-10.7l8.7-17.7c.1-.2.2-.4.2-.6 7 3.4 13.8 6 20.2 8.1 1.8.6 3.6 1.1 5.4 1.6L361.4 126.5zM361.1-15.8 376.9 15l-6.3 84c-2.2-.6-4.5-1.3-6.8-2-27.5-8.8-50.1-24.2-67.6-45.8L361.1-15.8zM303.8 72.2c-.2.2-.4.4-.6.6l-89.7 113.8 0 0-19.9 25.3-55.7-27L289.5 56.9C294.1 62.5 298.9 67.6 303.8 72.2zM94.6 174l26.9 13-29.1 24.6L94.6 174zM95.2 164.3l3.3-57.1 9.1-4.9 2.4 3.8V122c0 2.5 2 4.5 4.5 4.5h29.9c1.2 0 2.3-.4 3.1-1.2l32.3-30.9 22.4 24.6L129 180.7 95.2 164.3zM200.7 51.7l4.3 6.1-62.5 59.7h-23.7v-12.7c0-.9-.2-1.7-.7-2.4l-2.8-4.4L200.7 51.7zM256.3 73.2 209 113.1l-22.8-25L214 61.6c1.6-1.5 1.9-4 .6-5.8l-5.9-8.3 17.6-9.5C238.2 58.1 251.1 69.2 256.3 73.2zM221.9 30 99 96.7l3.3-57.7L211.5 4.9C214.6 14.3 218.1 22.7 221.9 30zM42.7 57.6l50.5-15.8L89.9 100l-49.4-3.4L42.7 57.6zM32.9 229.6l7.1-124 49.4 3.4L83 219.6l-26.4 22.3L32.9 229.6zM65.2 246.4l17.1-14.5L81 254.6 65.2 246.4zM137 283.6l-47.3-24.5 2-35.2 38.6-32.6 57.5 27.8L137 283.6zM201.8 215.9l16.5-20.9 51.8 25.8-11.2 22.8L201.8 215.9zM267 247.5l11.2-22.7 43.9 21.8-11.3 22L267 247.5zM318.9 272.6l13.3-26c0 0 0 0 0 0l0 0 8.3-16.3 36.1 18.3c.6.3 1.3.5 2 .5h10.1l-4.6 55L318.9 272.6z"/></g><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="45.5" cy="62.9" r="18.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="158.8" cy="177.3" r="12.8"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="228.2" cy="235" r="12.8"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="297.6" cy="157.2" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="20.8" cy="230.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="382.6" cy="250.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="374.7" cy="22.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="240.9" cy="111.1" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="182.7" cy="26" r="6.5"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.3183" stroke-miterlimit="10" cx="268.6" cy="95.6" r="13.6"/><circle fill="#D0D2D3" stroke="#A6A8AB" stroke-width="1.0954" stroke-miterlimit="10" cx="63.2" cy="124.9" r="11.3"/></symbol><symbol id="matrix"><rect x="0" y="0.1" fill="#F4F4F4" width="400" height="299.9"/><rect x="0.3" y="0" fill="#E1E2E3" width="92.8" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0.5" x2="199.7" y2="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="300"/><rect x="14.7" y="46.4" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="46.4" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="79.7" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="79.7" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="114" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="114" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="148.5" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="148.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="182.3" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="182.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="215.3" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="215.3" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="248.6" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="248.6" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="281.5" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="281.5" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="14.7" y="15.2" fill="#A6A6A6" width="61.2" height="3.1"/><rect x="108.8" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="212.2" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="311.1" y="15.2" fill="#A6A6A6" width="76.8" height="3.1"/><rect x="0" y="0" fill="#D0D2D3" width="399.8" height="30.4"/></symbol><symbol id="multiRowCard"><rect x="-0.1" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><rect x="22" y="21" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="91" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="160.3" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="22" y="231" fill="#A6A6A6" width="3.1" height="47.2"/><rect x="36.7" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="46.2" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="36.7" y="105.4" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="116.1" fill="#D0D2D3" width="46.3" height="7.7"/><rect x="36.7" y="174.7" fill="#ACACAC" width="65.8" height="7.7"/><rect x="36.7" y="185.4" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="36.7" y="245.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="36.7" y="256.2" fill="#D0D2D3" width="28.2" height="7.7"/><rect x="163.1" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="163.1" y="46.2" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="163.1" y="105.4" fill="#ACACAC" width="56.4" height="7.7"/><rect x="163.1" y="116.1" fill="#D0D2D3" width="46.3" height="7.7"/><rect x="163.1" y="174.7" fill="#ACACAC" width="65.8" height="7.7"/><rect x="163.1" y="185.4" fill="#D0D2D3" width="39.3" height="7.7"/><rect x="163.1" y="245.5" fill="#ACACAC" width="39.3" height="7.7"/><rect x="163.1" y="256.2" fill="#D0D2D3" width="28.2" height="7.7"/><rect x="289.5" y="35.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="289.5" y="46.2" fill="#D0D2D3" width="75.4" height="7.7"/><rect x="289.5" y="105.4" fill="#ACACAC" width="37.7" height="7.7"/><rect x="289.5" y="116.1" fill="#D0D2D3" width="87.4" height="7.7"/><rect x="289.5" y="174.7" fill="#ACACAC" width="28.2" height="7.7"/><rect x="289.5" y="185.4" fill="#D0D2D3" width="56.4" height="7.7"/><rect x="289.5" y="245.5" fill="#ACACAC" width="56.4" height="7.7"/><rect x="289.5" y="256.2" fill="#D0D2D3" width="87.4" height="7.7"/></symbol><symbol id="pie"><rect y="0.2" fill="#F4F4F4" width="400" height="299.8"/><path fill="#929497" d="M200 55.3v94.8l60.8 72.7c20.8-17.4 34-43.5 34-72.7v0C294.8 97.7 252.3 55.3 200 55.3z"/><path fill="#D0D2D3" d="M105.2 150.1c0 44.4 30.6 81.7 71.8 92l23-92H105.2z"/><path fill="#E1E2E3" d="M200 150.1l-23 92c7.4 1.8 15.1 2.8 23 2.8 23.1 0 44.3-8.3 60.8-22.1L200 150.1z"/><path fill="#A6A8AB" d="M200 55.3c-52.3 0-94.8 42.4-94.8 94.8v0H200V55.3z"/></symbol><symbol id="scatterplot"><rect x="1.3" y="0" fill="#F4F4F4" width="398.7" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="133.9" y1="0.4" x2="133.9" y2="298"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="266.9" y1="0.4" x2="266.9" y2="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="149.8" x2="400" y2="149.8"/><circle fill="#D0D2D3" cx="74.9" cy="214.1" r="36.2"/><circle fill="#D0D2D3" cx="186" cy="94" r="12.9"/><circle fill="#D0D2D3" cx="266.9" cy="124.1" r="17.2"/><circle fill="#D0D2D3" cx="310.4" cy="193.8" r="26.3"/><circle fill="#D0D2D3" cx="214.5" cy="176.3" r="18.6"/><circle fill="#D0D2D3" cx="137" cy="150.2" r="12.9"/><circle fill="#D0D2D3" cx="346.4" cy="68.1" r="12.9"/></symbol><symbol id="shapeMap"><rect x="0.7" y="0" opacity="0.5" fill="#F4F4F4" width="401.4" height="302.1"/><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#EEEEEE" d="M379.2 0H400v10.75l-14.2-1.5c-1.672-.266-2.738-1.016-3.2-2.25L379.2 0zM218.775 0h39c7.22 18.663 16.17 35.087 26.85 49.275L261.85 68.55C243.634 49.55 229.275 26.7 218.775 0zM0 62V0h57.725L73.15 38.875 0 62zM78.175 300H1.25l55.925-47.325L80.2 264.775 78.175 300zM231.05 300h-96.475l60.575-76.7 59.575 28.851L231.05 300zM400 206.675v34.575h-18.5l-37.15-18.025 1.825-3.475 3.875-14.825L400 206.675zM400 142.875v55.05l-47.675-1.649 15.725-59.95C378.267 138.94 388.917 141.123 400 142.875zM361.275 125.875c-10.32-2.924-20.153-6.332-29.5-10.225l9.5-19.175c7.915 3.922 16.273 7.272 25.074 10.05L361.275 125.875zM326.425 238.75 281.6 217.025 293.45 193.1l17.3 9.15c1.639.954 3.472 1.454 5.5 1.5l24.4.85-3.7 14.15L326.425 238.75zM304.65 71.4 192.9 212.875l-56.4-27.3 153.325-129.75C294.472 61.398 299.414 66.59 304.65 71.4zM121.25 187.5l-30.1 25.475L93.375 174 121.25 187.5zM39.55 105.2l49.6 3.2-6.375 111.65L56.25 242.475l-24.7-12.949L39.55 105.2zM258.45 244.65l-57.976-28.101 17.075-21.625L270.4 220.5 258.45 244.65z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M369.4 0l7.024 14.975L371 99.15c-30.688-8.892-55.647-25.2-74.875-48.925L345.425 0H369.4zM400 114.05v20.15c-10.34-1.591-20.281-3.575-29.825-5.95l5-19.175C383.115 111.174 391.39 112.833 400 114.05zM333.675 0l-42.85 43.325C281.736 30.743 274.086 16.301 267.875 0H333.675zM353.45 300H304l10.05-19.1L353.45 300zM240.55 300l21.825-44.15 43.9 21.275L294.25 300H240.55zM0 212.95V102.675l30.925 1.975-7.75 120.475L0 212.95zM111.975 0H196.1l-75.025 23.725C115.636 18.07 112.603 10.162 111.975 0zM0 290.075v-67.4l49.175 25.8L0 290.075zM124.1 300H86.175l1.775-31.15 42.95 22.525L124.1 300zM392.025 300l5.225-49.85H400V300H392.025zM384.275 300H372.7l-54.75-26.525 22.524-42.875 37.551 18.226c1.563.898 3.389 1.34 5.475 1.325h6L384.275 300zM359.175 133.9l-16.25 62.05L316 195l-18.6-9.875 30.75-62.15C337.978 127.132 348.319 130.773 359.175 133.9zM295.35 96.425l15.5-19.625c7.126 5.878 14.751 11.103 22.875 15.675l-9.774 19.75C313.812 107.567 304.277 102.3 295.35 96.425zM199.925 51.6l4.575 5.9-62 59.75h-25.3l.75-11.25c-.098-2.051-.498-3.617-1.2-4.7L114.3 98 199.925 51.6zM40.075 97l2.575-39.975L93 41.1l-3.375 59.075L40.075 97zM80.75 255.325l-16.475-8.65L82.1 231.6 80.75 255.325zM136.325 284.5 88.5 259.4l2-34.9 39-33 58.075 28.125L136.325 284.5zM310.175 269.7 266.1 248.35l11.95-24.149 44.65 21.649L310.175 269.7z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#F8F8F8" d="M66.725 0h36.325c.458 11.727 3.549 20.561 9.275 26.5L81.15 36.35 66.725 0zM0 94.425V70.5l33.8-10.675L31.45 96.45 0 94.425zM400 19.825V105.1c-6.929-.898-13.62-2.106-20.075-3.625l5.351-83.225L400 19.825zM223.075 29.2l-125.3 67.925 3.35-58.6L211.05 3.775C214.647 12.659 218.656 21.134 223.075 29.2zM207.675 47.4l19.7-10.7c8.162 13.625 17.57 26 28.225 37.125l-46.875 39.65-23.3-25.825L213.5 60.6c1.147-1.6 1.364-3.2.65-4.8L207.675 47.4zM320.35 119.525l-46.399 93.8-51.3-24.851 67.675-85.7C299.695 108.996 309.704 114.579 320.35 119.525zM179.125 93.725l22.925 25.4-73.775 62.45L93.9 164.925l3.3-57.625 9.7-5.275 2.95 3.975-1 15.1c.133 3.4 1.916 5.15 5.35 5.25h28.65c1.682.015 3.099-.568 4.25-1.75L179.125 93.725z"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#D9D9D9" d="M400 10.75v9.075l-14.725-1.575-5.351 83.225c6.455 1.519 13.146 2.727 20.075 3.625v8.95c-8.61-1.217-16.885-2.875-24.825-4.975l-5 19.175c9.544 2.375 19.485 4.359 29.825 5.95v8.675c-11.083-1.752-21.733-3.935-31.95-6.55l-15.725 59.95L400 197.925v8.75l-49.95-1.75-3.875 14.825-1.825 3.475 37.15 18.025H400v8.9h-2.75L392.025 300h-7.75l5.225-49.85h-6c-2.086.015-3.911-.427-5.475-1.325L340.475 230.6l-22.524 42.875L372.7 300h-19.25l-39.4-19.1L304 300h-9.75l12.025-22.875-43.9-21.275L240.55 300h-9.5l23.675-47.85L195.15 223.3 134.575 300H124.1l6.8-8.625L87.95 268.85 86.175 300h-8l2.025-35.225-23.025-12.101L1.25 300H0v-9.925l49.175-41.601L0 222.675v-9.725l23.175 12.175 7.75-120.475L0 102.675v-8.25l31.45 2.025 2.35-36.625L0 70.5V62l73.15-23.125L57.725 0h9L81.15 36.35l31.175-9.85c-5.726-5.939-8.818-14.773-9.275-26.5h8.925c.627 10.162 3.661 18.07 9.1 23.725L196.1 0h22.675c10.5 26.7 24.858 49.55 43.074 68.55l22.775-19.275c-10.68-14.188-19.63-30.612-26.85-49.275h10.1c6.211 16.301 13.861 30.743 22.95 43.325L333.675 0h11.75l-49.3 50.225C315.353 73.95 340.312 90.258 371 99.15l5.425-84.175L369.4 0h9.8l3.399 7c.462 1.234 1.528 1.984 3.2 2.25L400 10.75zM361.275 125.875l5.074-19.35c-8.801-2.778-17.159-6.128-25.074-10.05l-9.5 19.175C341.122 119.543 350.955 122.951 361.275 125.875zM359.175 133.9c-10.855-3.126-21.197-6.768-31.024-10.925l-30.75 62.15L316 195l26.925.95L359.175 133.9zM326.425 238.75l10.525-20 3.7-14.15-24.4-.85c-2.028-.046-3.861-.546-5.5-1.5l-17.3-9.15L281.6 217.025 326.425 238.75zM304.65 71.4c-5.236-4.81-10.179-10.001-14.825-15.575L136.5 185.575l56.4 27.3L304.65 71.4zM295.35 96.425c8.928 5.875 18.462 11.142 28.601 15.8l9.774-19.75c-8.124-4.572-15.749-9.797-22.875-15.675L295.35 96.425zM223.075 29.2c-4.419-8.066-8.428-16.541-12.025-25.425l-109.925 34.75-3.35 58.6L223.075 29.2zM207.675 47.4l6.476 8.4c.714 1.6.497 3.2-.65 4.8l-28.075 27.05 23.3 25.825 46.875-39.65c-10.654-11.125-20.063-23.5-28.225-37.125L207.675 47.4zM199.925 51.6 114.3 98l2.45 3.3c.703 1.083 1.103 2.649 1.2 4.7l-.75 11.25h25.3l62-59.75L199.925 51.6zM320.35 119.525c-10.646-4.946-20.654-10.529-30.024-16.75l-67.675 85.7 51.3 24.851L320.35 119.525zM179.125 93.725 147.1 124.6c-1.151 1.182-2.568 1.765-4.25 1.75H114.2c-3.434-.1-5.217-1.85-5.35-5.25l1-15.1-2.95-3.975-9.7 5.275-3.3 57.625 34.375 16.65 73.775-62.45L179.125 93.725zM40.075 97l49.55 3.175L93 41.1 42.65 57.025 40.075 97zM121.25 187.5 93.375 174l-2.225 38.975L121.25 187.5zM39.55 105.2l-8 124.325 24.7 12.949 26.525-22.425L89.15 108.4 39.55 105.2zM136.325 284.5l51.25-64.875L129.5 191.5l-39 33-2 34.9L136.325 284.5zM80.75 255.325 82.1 231.6l-17.825 15.075L80.75 255.325zM258.45 244.65l11.95-24.15-52.851-25.575-17.075 21.625L258.45 244.65zM310.175 269.7 322.7 245.85 278.05 224.2 266.1 248.35 310.175 269.7z"/></g></symbol><symbol id="slicer"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.1" height="300"/><rect x="11.8" y="17.7" fill="#D0D2D3" width="34.7" height="15.3"/><rect x="34.1" y="57" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="55" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="12.8" y="79" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="105" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="103" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="129" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="127" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="153" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="151" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="177" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="175" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="201" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="199" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="225" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="223" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="249" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="247" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="273" fill="#D0D2D3" width="33.8" height="7.7"/><rect x="12.8" y="271" fill="none" stroke="#D0D2D3" stroke-width="2" stroke-miterlimit="10" width="11.3" height="11.3"/><rect x="34.1" y="81.7" fill="#D0D2D3" width="33.8" height="7.7"/><line fill="none" stroke="#D0D2D3" stroke-miterlimit="10" x1="3.4" y1="44.3" x2="389.4" y2="44.3"/></symbol><symbol id="stackedarea"><rect id="XMLID_263_" x="0" opacity="0.5" fill="#F1F2F2" width="400" height="300"/><line id="XMLID_262_" opacity="0.5" fill="#F4F4F4" x1="0" y1="38" x2="400" y2="38"/><line id="XMLID_261_" opacity="0.5" fill="#F4F4F4" x1="0" y1="75.4" x2="400" y2="75.4"/><line id="XMLID_260_" opacity="0.5" fill="#F4F4F4" x1="0" y1="112.8" x2="400" y2="112.8"/><line id="XMLID_259_" opacity="0.5" fill="#F4F4F4" x1="0" y1="150.3" x2="400" y2="150.3"/><line id="XMLID_258_" opacity="0.5" fill="#F4F4F4" x1="400" y1="187.7" x2="0" y2="187.7"/><line id="XMLID_257_" opacity="0.5" fill="#F4F4F4" x1="0" y1="225.1" x2="400" y2="225.1"/><line id="XMLID_256_" opacity="0.5" fill="#F4F4F4" x1="0" y1="262.6" x2="400" y2="262.6"/><polygon id="XMLID_242_" fill="#A6A8AB" points="0,107.5 83.6,96.9 139.6,113 200,97.1 265.8,116.6 336,107.7 400,116.3 400,199.3 \t  0,199.3 "/><polygon id="XMLID_239_" fill="#D0D2D3" points="0,157.6 60.4,153 132.4,169.6 216.9,159 279.1,177.7 334.2,162.7 400,172.5 400,253.2 \t  0,253.2 "/><polygon id="XMLID_236_" fill="#E1E2E3" points="0,224.1 69.3,241.5 156,219.5 252,241.5 332,219.5 400,227.8 400,300 0,300 "/><polyline id="XMLID_138_" fill="none" stroke="#797A7A" stroke-width="4" stroke-miterlimit="10" points="0,107.5 83.6,96.9 139.6,113 200,97.1 265.8,116.6 336,107.7 400,116.3 "/><polyline id="XMLID_294_" fill="none" stroke="#929497" stroke-width="4" stroke-miterlimit="10" points="0,157.6 60.4,153 132.4,169.6 216.9,159 279.1,177.7 334.2,162.7 400,172.5 "/><polyline id="XMLID_301_" fill="none" stroke="#A6A8AB" stroke-width="4" stroke-miterlimit="10" points="0,224.1 69.3,241.5 156,219.5 252,241.5 332,219.5 400,227.8 "/></symbol><symbol id="stackedbar"><rect y="0" fill="#F4F4F4" width="400" height="299.8"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="93.1" y1="0" x2="93.1" y2="299.5"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="199.7" y1="0" x2="199.7" y2="299.3"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="298.6" y1="0" x2="298.6" y2="299.5"/><rect x="0" y="20.6" fill="#E1E2E3" width="179.9" height="39"/><rect x="0" y="74.7" fill="#E1E2E3" width="253.4" height="39"/><rect x="0" y="129.8" fill="#E1E2E3" width="224.6" height="39"/><rect x="0" y="184" fill="#E1E2E3" width="311.1" height="39"/><rect x="0" y="241" fill="#E1E2E3" width="367.2" height="39"/><rect x="0" y="20.6" fill="#D0D2D3" width="138.7" height="39"/><rect x="0" y="74.7" fill="#D0D2D3" width="195.3" height="39"/><rect x="0" y="129.8" fill="#D0D2D3" width="173.1" height="39"/><rect x="0" y="184" fill="#D0D2D3" width="239.8" height="39"/><rect x="0" y="241" fill="#D0D2D3" width="283" height="39"/><rect x="0" y="20.6" opacity="0.5" fill="#A6A8AB" width="90.2" height="39"/><rect x="0" y="74.7" opacity="0.5" fill="#A6A8AB" width="127" height="39"/><rect x="0" y="129.8" opacity="0.5" fill="#A6A8AB" width="112.5" height="39"/><rect x="0" y="184" opacity="0.5" fill="#A6A8AB" width="155.9" height="39"/><rect x="0" y="241" opacity="0.5" fill="#A6A8AB" width="184" height="39"/></symbol><symbol id="stackedcolumn"><rect x="0.2" y="-0.1" fill="#F4F4F4" width="400.1" height="300"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="73.4" x2="400.2" y2="73.4"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="147.9" x2="400.2" y2="147.9"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0.2" y1="222.3" x2="400.2" y2="222.3"/><rect x="19.3" y="193.2" fill="#E1E2E3" width="40.9" height="106.9"/><rect x="83.3" y="167.7" fill="#E1E2E3" width="40.9" height="132.4"/><rect x="147.3" y="187.7" fill="#E1E2E3" width="40.9" height="112.4"/><rect x="211.3" y="82" fill="#E1E2E3" width="40.9" height="218.1"/><rect x="275.4" y="39.8" fill="#E1E2E3" width="40.9" height="260.3"/><rect x="339.4" y="122.3" fill="#E1E2E3" width="40.9" height="177.9"/><rect x="19.3" y="219.2" fill="#D0D2D3" width="40.9" height="80.9"/><rect x="83.3" y="199.9" fill="#D0D2D3" width="40.9" height="100.2"/><rect x="147.3" y="215.1" fill="#D0D2D3" width="40.9" height="85"/><rect x="211.3" y="129.8" fill="#D0D2D3" width="40.9" height="170.3"/><rect x="275.4" y="103.2" fill="#D0D2D3" width="40.9" height="197"/><rect x="339.4" y="165.6" fill="#D0D2D3" width="40.9" height="134.6"/><rect x="19.3" y="254" opacity="0.5" fill="#A6A8AB" width="40.9" height="46.1"/><rect x="83.3" y="243" opacity="0.5" fill="#A6A8AB" width="40.9" height="57.1"/><rect x="147.3" y="251.6" opacity="0.5" fill="#A6A8AB" width="40.9" height="48.5"/><rect x="211.3" y="206.1" opacity="0.5" fill="#A6A8AB" width="40.9" height="94.1"/><rect x="275.4" y="187.8" opacity="0.5" fill="#A6A8AB" width="40.9" height="112.3"/><rect x="339.4" y="223.4" opacity="0.5" fill="#A6A8AB" width="40.9" height="76.7"/></symbol><symbol id="table"><rect x="0" y="0" fill="#F4F4F4" width="399.8" height="265.4"/><rect x="0" y="0" fill="#D0D2D3" width="399.8" height="30.1"/><rect x="14.4" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="46.6" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="64.8" x2="400" y2="64.8"/><rect x="14.4" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="79.6" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="98.6" x2="399.3" y2="98.6"/><rect x="14.4" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="113.4" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="132.7" x2="400" y2="132.7"/><rect x="14.4" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="147.5" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="166.2" x2="400" y2="166.2"/><rect x="14.4" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="181" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="198.8" x2="400" y2="198.8"/><rect x="14.4" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="213.7" fill="#A6A6A6" width="76.7" height="3.1"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="231.7" x2="400" y2="231.7"/><rect x="14.4" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="246.5" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="0" y="265.4" fill="#F4F4F4" width="399.3" height="34.6"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="0" y1="265.4" x2="400" y2="265.4"/><rect x="14.4" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="111.4" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="208.5" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/><rect x="304.8" y="281.1" fill="#A6A6A6" width="76.7" height="3.1"/></symbol><symbol id="tree"><rect x="204.3" y="0" fill="#E1E2E3" width="195.3" height="150"/><rect x="0" y="0" fill="#D0D2D3" width="204.3" height="150"/><rect x="0" y="150" fill="#E1E2E3" width="180.9" height="79.6"/><rect x="0" y="229.6" fill="#A6A8AB" width="180.9" height="70.4"/><rect x="180.9" y="150" fill="#F4F4F4" width="121.1" height="103.8"/><rect x="302" y="150" opacity="0.5" fill="#A6A8AB" width="97.7" height="103.8"/><rect x="180.9" y="253.8" fill="#E1E2E3" width="218.8" height="46.2"/></symbol><symbol id="waterfall"><rect x="-0.1" y="0" fill="#F4F4F4" width="400.3" height="299.6"/><line fill="none" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="73.1" x2="400.2" y2="73.1"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="147.6" x2="400.2" y2="147.6"/><line fill="#D0D2D3" stroke="#FFFFFF" stroke-width="2" stroke-miterlimit="10" x1="-0.1" y1="222" x2="400.2" y2="222"/><rect x="75.3" y="128" fill="#D0D2D3" width="44" height="89.1"/><rect x="143.8" y="27.1" fill="#D0D2D3" width="44" height="103"/><rect x="212.3" y="27.1" fill="#D0D2D3" width="44" height="205.3"/><rect x="280.8" y="230.2" fill="#D0D2D3" width="44" height="55"/><rect x="349.2" y="283.1" fill="#D0D2D3" width="44" height="16.5"/><rect x="6.9" y="214.9" fill="#D0D2D3" width="44" height="84.7"/><rect x="50.8" y="214.9" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="119.3" y="128" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="187.8" y="27.1" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="256.3" y="230.2" fill="#D0D2D3" width="24.5" height="2.1"/><rect x="324.7" y="283.1" fill="#D0D2D3" width="24.5" height="2.1"/></symbol><symbol id="scriptvisual"><rect x="0" y="0" fill="#F4F4F4" width="400" height="100"/><rect x="0" y="100" fill="#FFFFFF" width="400" height="100"/><rect x="0" y="200" fill="#F4F4F4" width="400" height="100"/><path fill="#E1E2E3" d="M138.8 90h-65.5v-8h65.5V90z"/><path fill="#E1E2E3" d="M22.3 81l-8.2-9.7 25.1-21.2-25.1-21.3 8.2-9.7 35.9 30.3v1.4L22.3 81z"/><path fill="#E1E2E3" d="M168.2 193.4h-14.5v-14.5h14.5V193.4z"/><path fill="#E1E2E3" d="M199.3 160.2v33.4h-16v-87.2h36.3c3 0 6 .5 9.1 1.5 3.1 1.1 5.9 2.6 8.4 4.8 2.5 2.1 4.6 4.9 6.2 8.3 1.6 3.4 2.4 7.5 2.4 12.3 0 3.6-.4 6.6-1.3 9.4-.8 2.8-2 5.1-3.5 7.2-1.5 2-3.2 3.8-5.2 5.2-1.9 1.4-4 2.5-6.2 3.3l18.5 35.1h-17.2l-16.6-33.4h-14.9V160.2zM217.2 145.5c1.4 0 2.8-.2 4.3-.5 1.5-.4 2.9-1.1 4.2-2 1.2-1 2.4-2.2 3.2-3.7.8-1.5 1.2-3.5 1.2-5.9 0-2.4-.4-4.4-1.2-5.9-.9-1.6-1.9-2.8-3.2-3.8-1.2-1-2.6-1.6-4.2-2-1.5-.4-2.9-.6-4.3-.6h-18v24.3L217.2 145.5 217.2 145.5z"/></symbol></svg>');
}]);

window.parseTimeMarkers['powerbiportal.explore.bundle.min.js'].end = Date.now();
